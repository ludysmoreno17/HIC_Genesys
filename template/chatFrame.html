<!doctype html>
<html lang="en">

<head>

    <script type="text/javascript" charset="utf-8">
        (function(g, e, n, es, ys) {
            g['_genesysJs'] = e;
            g[e] = g[e] || function() {
                (g[e].q = g[e].q || []).push(arguments)
            };
            g[e].t = 1 * new Date();
            g[e].c = es;
            ys = document.createElement('script');
            ys.async = 1;
            ys.src = n;
            ys.charset = 'utf-8';
            document.head.appendChild(ys);
        })(window, 'Genesys', 'https://apps.mypurecloud.com/genesys-bootstrap/genesys.min.js', {
            environment: 'use1',
            deploymentId: '4826e24f-58e6-4c7f-935d-fae4af49377a'
        });

        Genesys("subscribe", "Launcher.ready", function(o) {
            var boton = document.getElementById("toggle");
            boton.className = "toggleVisible";
        });

        Genesys("subscribe", "Conversations.started", function(o) {
            console.log("******* Conversations.started*******");
            enviarAParent("Conversations.started");
        });
        Genesys("subscribe", "Conversations.messageAdded", function(o) {
            console.log("*******Conversations.messageAdded*******");
            enviarAParent("Conversations.messageAdded");
            console.log(o);
        });
        Genesys("subscribe", "MessagingService.messagesReceived", function(o) {
            console.log("*******MessagingService.messagesReceived*******");
            enviarAParent("MessagingService.messagesReceived");
        });

        function ToggleWidget() {

            var boton = document.getElementById("toggle");
            if (boton.innerHTML == "Mostrar Chat") {
                Genesys("command", "Messenger.open", {},
                    function(o) {},
                );
                boton.innerHTML = "Ocultar Chat";
                boton.style.fontSize = 0;
                boton.style.visibility = "hidden";

            } else {
                Genesys("command", "Messenger.close", {},
                    function(o) {},
                );
                boton.innerHTML = "Mostrar Chat";
                boton.style.fontSize = 0;
                boton.style.visibility = "hidden";
            }

        }

        function enviarAParent(msgEnviar) {

            var domain = 'file://';
            const messageObj = {
                message: msgEnviar
            };
            const stringifiedMessageObj = JSON.stringify(messageObj);
            parent.postMessage(stringifiedMessageObj, domain);
            console.log('evento enviado al contenedor');

        }

        window.addEventListener("message", (event) => {
            //console.log(event);
            //console.log(event.data);
            if (typeof event.data === 'string') {
                if (event.data == "alertaInactividad") {
                    console.log("----- recibido mensaje del contenedor ----");
                    alertaInactividad();
                }
            }

        });

        function alertaInactividad() {
            var notificaciones = document.getElementById("notificaciones");
            notificaciones.innerHTML = "**** Alerta por inactividad ****";
            setTimeout(function() {
                notificaciones.innerHTML = "-";
            }, 5000);
        }

        document.addEventListener('readystatechange', event => {
            // When HTML/DOM elements are ready:
            if (event.target.readyState === "interactive") {
                //alert("hi 1");
                console.log("--- readystatechange --- ");
                console.log(window.location);
                console.log(window.parent.location);
                enviarAParent("pagina cargada");
            }
            // When window loaded ( external resources are loaded too- `css`,`src`, etc...)
            if (event.target.readyState === "complete") {
                //alert("hi 2");
            }
        });

        function Abrir() {
            Genesys('command', 'Messenger.open', {}, function(o) {}, );
            console.log("abrir");
        }
    </script>

    <style>
        .toggleOculto {
            display: none;
        }

        .toggleVisible {
            display: block;
        }

        .div1 {
            padding-top: 1%;
            padding-bottom: 1%;
            padding-left: 1%;
        }
    </style>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <title>ethack - The Ethical Hacking Company</title>
</head>

<body onload="Abrir()">
    <!-- Messenger Snipp Start -->

    <!-- Messenger Snipp End -->

    <div class="div1">
        <button id="toggle" class="toggleOculto" onclick="ToggleWidget()" onload="ToggleWidget()" style="height:0px;width:0px;font-size: 0;">Mostrar Chat</button>
    </div>
    <div class="div1">
        <label id="notificaciones"></label>
    </div>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->

    <div class="contenedor_pop">
        <article>
            <h1>Ventana Emergente </h1>
            <button id="btn-abrir-popup" class="btn-abrir-popup" onclick="genesysWebchat.startCobrowse()">Abrir Ventana Emergente</button>

            <br>
            <br>
            <br>
            <iframe src="https://richardsuan.github.io/prueba_dav/template/contenido.html" id="miframe" height="400" width="500" name="demo">
        <p>Su navegador no es compatible con iframes</p>
        </iframe>
        <br>
        <br>
        <iframe src="./template/Chat.html" id="miframe" height="400" width="500" name="demo">
    <p>Su navegador no es compatible con iframes</p>
    </iframe>
            <br>

            <p class="cobrowse-masked" >
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce bibendum, tortor ut commodo elementum, felis dui pharetra arcu, id vulputate neque orci ut velit. Vestibulum facilisis mauris sapien, ut rutrum lacus sollicitudin eu. Curabitur odio ligula,
                eleifend sodales nisl et, feugiat mattis sapien. Nulla commodo gravida est a lacinia. Fusce cursus eleifend dui at tincidunt. Aliquam eu metus odio. Morbi metus erat, mattis sit amet ultricies ullamcorper, dignissim nec ante. Nulla congue
                purus quis interdum tincidunt. Nam at libero leo. Nunc dignissim auctor turpis sit amet ornare. Duis vulputate faucibus sem id dignissim. Vivamus sed orci odio. Maecenas nec dapibus mauris. Pellentesque a massa et lectus volutpat gravida
                eget id neque.
            </p>
            <p class="mascara">
                Nunc eleifend venenatis est vel finibus. Mauris vel arcu sit amet risus vulputate gravida a pulvinar felis. In nulla turpis, dignissim ac orci sit amet, suscipit luctus eros. Ut luctus blandit mi. Donec lacinia vehicula fringilla. Vivamus nec ligula ut
                dui vestibulum iaculis. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Cras ac sem in mi pulvinar eleifend vitae in sapien. Mauris vel dui nibh. Maecenas fermentum ante cursus nisi tincidunt
                mattis. Phasellus quis sapien sollicitudin, tempor diam nec, ullamcorper sapien.
            </p>
            <p>
                Fusce tempor arcu nec ante congue, nec tempor ipsum eleifend. Pellentesque consequat ac ipsum et euismod. Donec posuere massa in felis scelerisque feugiat. Mauris id arcu enim. Curabitur pulvinar elit nec turpis mollis tincidunt. Curabitur lectus elit,
                scelerisque nec facilisis ac, semper vel libero. Pellentesque efficitur velit nunc, eu vehicula est pretium quis. Nunc urna tellus, tempus vitae eros eget, efficitur molestie lorem. Phasellus ut facilisis libero. Mauris laoreet libero
                diam, a tempor risus pharetra eget. Mauris nibh urna, accumsan vel accumsan euismod, lobortis nec lectus. Mauris elementum urna vel feugiat ultrices. Nulla sodales nisl sit amet ante fermentum, sit amet porttitor diam sollicitudin. Pellentesque
                ut pellentesque turpis. In rutrum augue dui, vel molestie ipsum pulvinar facilisis.
            </p>
        </article>


    </div>

</body>

</html>
