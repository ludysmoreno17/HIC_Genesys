/*
 RequireJS 2.1.8 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details
*/
/*global define*/
var requirejs,require;
(function(Z){function H(b){return"[object Function]"===L.call(b)}function I(b){return"[object Array]"===L.call(b)}function y(b,c){if(b){var d;for(d=0;d<b.length&&(!b[d]||!c(b[d],d,b));d+=1);}}function M(b,c){if(b){var d;for(d=b.length-1;-1<d&&(!b[d]||!c(b[d],d,b));d-=1);}}function s(b,c){return ga.call(b,c)}function l(b,c){return s(b,c)&&b[c]}function F(b,c){for(var d in b)if(s(b,d)&&c(b[d],d))break}function Q(b,c,d,h){c&&F(c,function(c,j){if(d||!s(b,j))h&&"string"!==typeof c?(b[j]||(b[j]={}),Q(b[j],
c,d,h)):b[j]=c});return b}function u(b,c){return function(){return c.apply(b,arguments)}}function aa(b){throw b;}function ba(b){if(!b)return b;var c=Z;y(b.split("."),function(b){c=c[b]});return c}function A(b,c,d,h){c=Error(c+"\nhttp://requirejs.org/docs/errors.html#"+b);c.requireType=b;c.requireModules=h;d&&(c.originalError=d);return c}function ha(b){function c(a,f,b){var e,m,c,g,d,h,j,i=f&&f.split("/");e=i;var n=k.map,p=n&&n["*"];if(a&&"."===a.charAt(0))if(f){e=l(k.pkgs,f)?i=[f]:i.slice(0,i.length-
1);f=a=e.concat(a.split("/"));for(e=0;f[e];e+=1)if(m=f[e],"."===m)f.splice(e,1),e-=1;else if(".."===m)if(1===e&&(".."===f[2]||".."===f[0]))break;else 0<e&&(f.splice(e-1,2),e-=2);e=l(k.pkgs,f=a[0]);a=a.join("/");e&&a===f+"/"+e.main&&(a=f)}else 0===a.indexOf("./")&&(a=a.substring(2));if(b&&n&&(i||p)){f=a.split("/");for(e=f.length;0<e;e-=1){c=f.slice(0,e).join("/");if(i)for(m=i.length;0<m;m-=1)if(b=l(n,i.slice(0,m).join("/")))if(b=l(b,c)){g=b;d=e;break}if(g)break;!h&&(p&&l(p,c))&&(h=l(p,c),j=e)}!g&&
h&&(g=h,d=j);g&&(f.splice(0,d,g),a=f.join("/"))}return a}function d(a){z&&y(document.getElementsByTagName("script"),function(f){if(f.getAttribute("data-requiremodule")===a&&f.getAttribute("data-requirecontext")===i.contextName)return f.parentNode.removeChild(f),!0})}function h(a){var f=l(k.paths,a);if(f&&I(f)&&1<f.length)return d(a),f.shift(),i.require.undef(a),i.require([a]),!0}function $(a){var f,b=a?a.indexOf("!"):-1;-1<b&&(f=a.substring(0,b),a=a.substring(b+1,a.length));return[f,a]}function n(a,
f,b,e){var m,B,g=null,d=f?f.name:null,h=a,j=!0,k="";a||(j=!1,a="_@r"+(L+=1));a=$(a);g=a[0];a=a[1];g&&(g=c(g,d,e),B=l(r,g));a&&(g?k=B&&B.normalize?B.normalize(a,function(a){return c(a,d,e)}):c(a,d,e):(k=c(a,d,e),a=$(k),g=a[0],k=a[1],b=!0,m=i.nameToUrl(k)));b=g&&!B&&!b?"_unnormalized"+(M+=1):"";return{prefix:g,name:k,parentMap:f,unnormalized:!!b,url:m,originalName:h,isDefine:j,id:(g?g+"!"+k:k)+b}}function q(a){var f=a.id,b=l(p,f);b||(b=p[f]=new i.Module(a));return b}function t(a,f,b){var e=a.id,m=l(p,
e);if(s(r,e)&&(!m||m.defineEmitComplete))"defined"===f&&b(r[e]);else if(m=q(a),m.error&&"error"===f)b(m.error);else m.on(f,b)}function v(a,f){var b=a.requireModules,e=!1;if(f)f(a);else if(y(b,function(f){if(f=l(p,f))f.error=a,f.events.error&&(e=!0,f.emit("error",a))}),!e)j.onError(a)}function w(){R.length&&(ia.apply(G,[G.length-1,0].concat(R)),R=[])}function x(a){delete p[a];delete T[a]}function E(a,f,b){var e=a.map.id;a.error?a.emit("error",a.error):(f[e]=!0,y(a.depMaps,function(e,c){var g=e.id,
d=l(p,g);d&&(!a.depMatched[c]&&!b[g])&&(l(f,g)?(a.defineDep(c,r[g]),a.check()):E(d,f,b))}),b[e]=!0)}function C(){var a,f,b,e,m=(b=1E3*k.waitSeconds)&&i.startTime+b<(new Date).getTime(),c=[],g=[],j=!1,l=!0;if(!U){U=!0;F(T,function(b){a=b.map;f=a.id;if(b.enabled&&(a.isDefine||g.push(b),!b.error))if(!b.inited&&m)h(f)?j=e=!0:(c.push(f),d(f));else if(!b.inited&&(b.fetched&&a.isDefine)&&(j=!0,!a.prefix))return l=!1});if(m&&c.length)return b=A("timeout","Load timeout for modules: "+c,null,c),b.contextName=
i.contextName,v(b);l&&y(g,function(a){E(a,{},{})});if((!m||e)&&j)if((z||da)&&!V)V=setTimeout(function(){V=0;C()},50);U=!1}}function D(a){s(r,a[0])||q(n(a[0],null,!0)).init(a[1],a[2])}function J(a){var a=a.currentTarget||a.srcElement,b=i.onScriptLoad;a.detachEvent&&!W?a.detachEvent("onreadystatechange",b):a.removeEventListener("load",b,!1);b=i.onScriptError;(!a.detachEvent||W)&&a.removeEventListener("error",b,!1);return{node:a,id:a&&a.getAttribute("data-requiremodule")}}function K(){var a;for(w();G.length;){a=
G.shift();if(null===a[0])return v(A("mismatch","Mismatched anonymous define() module: "+a[a.length-1]));D(a)}}var U,X,i,N,V,k={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{},config:{}},p={},T={},Y={},G=[],r={},S={},L=1,M=1;N={require:function(a){return a.require?a.require:a.require=i.makeRequire(a.map)},exports:function(a){a.usingExports=!0;if(a.map.isDefine)return a.exports?a.exports:a.exports=r[a.map.id]={}},module:function(a){return a.module?a.module:a.module={id:a.map.id,uri:a.map.url,config:function(){var b=
l(k.pkgs,a.map.id);return(b?l(k.config,a.map.id+"/"+b.main):l(k.config,a.map.id))||{}},exports:r[a.map.id]}}};X=function(a){this.events=l(Y,a.id)||{};this.map=a;this.shim=l(k.shim,a.id);this.depExports=[];this.depMaps=[];this.depMatched=[];this.pluginMaps={};this.depCount=0};X.prototype={init:function(a,b,c,e){e=e||{};if(!this.inited){this.factory=b;if(c)this.on("error",c);else this.events.error&&(c=u(this,function(a){this.emit("error",a)}));this.depMaps=a&&a.slice(0);this.errback=c;this.inited=!0;
this.ignore=e.ignore;e.enabled||this.enabled?this.enable():this.check()}},defineDep:function(a,b){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=b)},fetch:function(){if(!this.fetched){this.fetched=!0;i.startTime=(new Date).getTime();var a=this.map;if(this.shim)i.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],u(this,function(){return a.prefix?this.callPlugin():this.load()}));else return a.prefix?this.callPlugin():this.load()}},load:function(){var a=
this.map.url;S[a]||(S[a]=!0,i.load(this.map.id,a))},check:function(){if(this.enabled&&!this.enabling){var a,b,c=this.map.id;b=this.depExports;var e=this.exports,m=this.factory;if(this.inited)if(this.error)this.emit("error",this.error);else{if(!this.defining){this.defining=!0;if(1>this.depCount&&!this.defined){if(H(m)){if(this.events.error&&this.map.isDefine||j.onError!==aa)try{e=i.execCb(c,m,b,e)}catch(d){a=d}else e=i.execCb(c,m,b,e);this.map.isDefine&&((b=this.module)&&void 0!==b.exports&&b.exports!==
this.exports?e=b.exports:void 0===e&&this.usingExports&&(e=this.exports));if(a)return a.requireMap=this.map,a.requireModules=this.map.isDefine?[this.map.id]:null,a.requireType=this.map.isDefine?"define":"require",v(this.error=a)}else e=m;this.exports=e;if(this.map.isDefine&&!this.ignore&&(r[c]=e,j.onResourceLoad))j.onResourceLoad(i,this.map,this.depMaps);x(c);this.defined=!0}this.defining=!1;this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=
!0)}}else this.fetch()}},callPlugin:function(){var a=this.map,b=a.id,d=n(a.prefix);this.depMaps.push(d);t(d,"defined",u(this,function(e){var m,d;d=this.map.name;var g=this.map.parentMap?this.map.parentMap.name:null,h=i.makeRequire(a.parentMap,{enableBuildCallback:!0});if(this.map.unnormalized){if(e.normalize&&(d=e.normalize(d,function(a){return c(a,g,!0)})||""),e=n(a.prefix+"!"+d,this.map.parentMap),t(e,"defined",u(this,function(a){this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),
d=l(p,e.id)){this.depMaps.push(e);if(this.events.error)d.on("error",u(this,function(a){this.emit("error",a)}));d.enable()}}else m=u(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),m.error=u(this,function(a){this.inited=!0;this.error=a;a.requireModules=[b];F(p,function(a){0===a.map.id.indexOf(b+"_unnormalized")&&x(a.map.id)});v(a)}),m.fromText=u(this,function(e,c){var d=a.name,g=n(d),B=O;c&&(e=c);B&&(O=!1);q(g);s(k.config,b)&&(k.config[d]=k.config[b]);try{j.exec(e)}catch(ca){return v(A("fromtexteval",
"fromText eval for "+b+" failed: "+ca,ca,[b]))}B&&(O=!0);this.depMaps.push(g);i.completeLoad(d);h([d],m)}),e.load(a.name,h,m,k)}));i.enable(d,this);this.pluginMaps[d.id]=d},enable:function(){T[this.map.id]=this;this.enabling=this.enabled=!0;y(this.depMaps,u(this,function(a,b){var c,e;if("string"===typeof a){a=n(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap);this.depMaps[b]=a;if(c=l(N,a.id)){this.depExports[b]=c(this);return}this.depCount+=1;t(a,"defined",u(this,function(a){this.defineDep(b,
a);this.check()}));this.errback&&t(a,"error",u(this,this.errback))}c=a.id;e=p[c];!s(N,c)&&(e&&!e.enabled)&&i.enable(a,this)}));F(this.pluginMaps,u(this,function(a){var b=l(p,a.id);b&&!b.enabled&&i.enable(a,this)}));this.enabling=!1;this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]);c.push(b)},emit:function(a,b){y(this.events[a],function(a){a(b)});"error"===a&&delete this.events[a]}};i={config:k,contextName:b,registry:p,defined:r,urlFetched:S,defQueue:G,Module:X,makeModuleMap:n,
nextTick:j.nextTick,onError:v,configure:function(a){a.baseUrl&&"/"!==a.baseUrl.charAt(a.baseUrl.length-1)&&(a.baseUrl+="/");var b=k.pkgs,c=k.shim,e={paths:!0,config:!0,map:!0};F(a,function(a,b){e[b]?"map"===b?(k.map||(k.map={}),Q(k[b],a,!0,!0)):Q(k[b],a,!0):k[b]=a});a.shim&&(F(a.shim,function(a,b){I(a)&&(a={deps:a});if((a.exports||a.init)&&!a.exportsFn)a.exportsFn=i.makeShimExports(a);c[b]=a}),k.shim=c);a.packages&&(y(a.packages,function(a){a="string"===typeof a?{name:a}:a;b[a.name]={name:a.name,
location:a.location||a.name,main:(a.main||"main").replace(ja,"").replace(ea,"")}}),k.pkgs=b);F(p,function(a,b){!a.inited&&!a.map.unnormalized&&(a.map=n(b))});if(a.deps||a.callback)i.require(a.deps||[],a.callback)},makeShimExports:function(a){return function(){var b;a.init&&(b=a.init.apply(Z,arguments));return b||a.exports&&ba(a.exports)}},makeRequire:function(a,f){function d(e,c,h){var g,k;f.enableBuildCallback&&(c&&H(c))&&(c.__requireJsBuild=!0);if("string"===typeof e){if(H(c))return v(A("requireargs",
"Invalid require call"),h);if(a&&s(N,e))return N[e](p[a.id]);if(j.get)return j.get(i,e,a,d);g=n(e,a,!1,!0);g=g.id;return!s(r,g)?v(A("notloaded",'Module name "'+g+'" has not been loaded yet for context: '+b+(a?"":". Use require([])"))):r[g]}K();i.nextTick(function(){K();k=q(n(null,a));k.skipMap=f.skipMap;k.init(e,c,h,{enabled:!0});C()});return d}f=f||{};Q(d,{isBrowser:z,toUrl:function(b){var d,f=b.lastIndexOf("."),g=b.split("/")[0];if(-1!==f&&(!("."===g||".."===g)||1<f))d=b.substring(f,b.length),b=
b.substring(0,f);return i.nameToUrl(c(b,a&&a.id,!0),d,!0)},defined:function(b){return s(r,n(b,a,!1,!0).id)},specified:function(b){b=n(b,a,!1,!0).id;return s(r,b)||s(p,b)}});a||(d.undef=function(b){w();var c=n(b,a,!0),f=l(p,b);delete r[b];delete S[c.url];delete Y[b];f&&(f.events.defined&&(Y[b]=f.events),x(b))});return d},enable:function(a){l(p,a.id)&&q(a).enable()},completeLoad:function(a){var b,c,e=l(k.shim,a)||{},d=e.exports;for(w();G.length;){c=G.shift();if(null===c[0]){c[0]=a;if(b)break;b=!0}else c[0]===
a&&(b=!0);D(c)}c=l(p,a);if(!b&&!s(r,a)&&c&&!c.inited){if(k.enforceDefine&&(!d||!ba(d)))return h(a)?void 0:v(A("nodefine","No define call for "+a,null,[a]));D([a,e.deps||[],e.exportsFn])}C()},nameToUrl:function(a,b,c){var e,d,h,g,i,n;if(j.jsExtRegExp.test(a))g=a+(b||"");else{e=k.paths;d=k.pkgs;g=a.split("/");for(i=g.length;0<i;i-=1)if(n=g.slice(0,i).join("/"),h=l(d,n),n=l(e,n)){I(n)&&(n=n[0]);g.splice(0,i,n);break}else if(h){a=a===h.name?h.location+"/"+h.main:h.location;g.splice(0,i,a);break}g=g.join("/");
g+=b||(/\?/.test(g)||c?"":".js");g=("/"===g.charAt(0)||g.match(/^[\w\+\.\-]+:/)?"":k.baseUrl)+g}return k.urlArgs?g+((-1===g.indexOf("?")?"?":"&")+k.urlArgs):g},load:function(a,b){j.load(i,a,b)},execCb:function(a,b,c,e){return b.apply(e,c)},onScriptLoad:function(a){if("load"===a.type||ka.test((a.currentTarget||a.srcElement).readyState))P=null,a=J(a),i.completeLoad(a.id)},onScriptError:function(a){var b=J(a);if(!h(b.id))return v(A("scripterror","Script error for: "+b.id,a,[b.id]))}};i.require=i.makeRequire();
return i}var j,w,x,C,J,D,P,K,q,fa,la=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,ma=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,ea=/\.js$/,ja=/^\.\//;w=Object.prototype;var L=w.toString,ga=w.hasOwnProperty,ia=Array.prototype.splice,z=!!("undefined"!==typeof window&&navigator&&window.document),da=!z&&"undefined"!==typeof importScripts,ka=z&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,W="undefined"!==typeof opera&&"[object Opera]"===opera.toString(),E={},t={},R=[],O=
!1;if("undefined"===typeof define){if("undefined"!==typeof requirejs){if(H(requirejs))return;t=requirejs;requirejs=void 0}"undefined"!==typeof require&&!H(require)&&(t=require,require=void 0);j=requirejs=function(b,c,d,h){var q,n="_";!I(b)&&"string"!==typeof b&&(q=b,I(c)?(b=c,c=d,d=h):b=[]);q&&q.context&&(n=q.context);(h=l(E,n))||(h=E[n]=j.s.newContext(n));q&&h.configure(q);return h.require(b,c,d)};j.config=function(b){return j(b)};j.nextTick="undefined"!==typeof setTimeout?function(b){setTimeout(b,
4)}:function(b){b()};require||(require=j);j.version="2.1.8";j.jsExtRegExp=/^\/|:|\?|\.js$/;j.isBrowser=z;w=j.s={contexts:E,newContext:ha};j({});y(["toUrl","undef","defined","specified"],function(b){j[b]=function(){var c=E._;return c.require[b].apply(c,arguments)}});if(z&&(x=w.head=document.getElementsByTagName("head")[0],C=document.getElementsByTagName("base")[0]))x=w.head=C.parentNode;j.onError=aa;j.createNode=function(b){var c=b.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):
document.createElement("script");c.type=b.scriptType||"text/javascript";c.charset="utf-8";c.async=!0;return c};j.load=function(b,c,d){var h=b&&b.config||{};if(z)return h=j.createNode(h,c,d),h.setAttribute("data-requirecontext",b.contextName),h.setAttribute("data-requiremodule",c),h.attachEvent&&!(h.attachEvent.toString&&0>h.attachEvent.toString().indexOf("[native code"))&&!W?(O=!0,h.attachEvent("onreadystatechange",b.onScriptLoad)):(h.addEventListener("load",b.onScriptLoad,!1),h.addEventListener("error",
b.onScriptError,!1)),h.src=d,K=h,C?x.insertBefore(h,C):x.appendChild(h),K=null,h;if(da)try{importScripts(d),b.completeLoad(c)}catch(l){b.onError(A("importscripts","importScripts failed for "+c+" at "+d,l,[c]))}};z&&M(document.getElementsByTagName("script"),function(b){x||(x=b.parentNode);if(J=b.getAttribute("data-main"))return q=J,t.baseUrl||(D=q.split("/"),q=D.pop(),fa=D.length?D.join("/")+"/":"./",t.baseUrl=fa),q=q.replace(ea,""),j.jsExtRegExp.test(q)&&(q=J),t.deps=t.deps?t.deps.concat(q):[q],!0});
define=function(b,c,d){var h,j;"string"!==typeof b&&(d=c,c=b,b=null);I(c)||(d=c,c=null);!c&&H(d)&&(c=[],d.length&&(d.toString().replace(la,"").replace(ma,function(b,d){c.push(d)}),c=(1===d.length?["require"]:["require","exports","module"]).concat(c)));if(O){if(!(h=K))P&&"interactive"===P.readyState||M(document.getElementsByTagName("script"),function(b){if("interactive"===b.readyState)return P=b}),h=P;h&&(b||(b=h.getAttribute("data-requiremodule")),j=E[h.getAttribute("data-requirecontext")])}(j?j.defQueue:
R).push([b,c,d])};define.amd={jQuery:!0};j.exec=function(b){return eval(b)};j(t)}})(this);

require.config({"waitSeconds":30,"paths":{"jQuery":"libs/jquery/jquery-loader","jquery":"libs/jquery/jquery-1.11.3","lodash":"libs/lodash/lodash.custom","backbone":"libs/backbone/backbone","backbone.wreqr":"libs/backbone/backbone.wreqr","backbone.babysitter":"libs/backbone/backbone.babysitter","backbone-super":"libs/backbone/backbone-super","backbone-view-el":"libs/backbone/backbone-view-el","backbone-adapter":"libs/backbone/backbone-adapter","backbone-ajax":"libs/backbone/backbone-ajax","backbone-localstorage":"libs/backbone/backbone-localstorage","marionette":"libs/marionette/backbone.marionette.custom","marionette-asynchronous":"libs/marionette/backbone.marionette-asynchronous","marionette-adapter":"libs/marionette/backbone.marionette-adapter","hbs":"libs/handlebars/hbs","Handlebars":"libs/handlebars/handlebars","i18nprecompile":"libs/handlebars/hbs/i18nprecompile","json2":"libs/handlebars/hbs/json2","parsley":"libs/parsley","fastclick":"libs/fastclick","touch":"libs/require-is/touch","iPad":"libs/require-is/iPad","ie":"libs/require-is/ie","ie8":"libs/require-is/ie8","development":"libs/require-is/development","mobile-browser":"libs/require-is/mobile-browser","phone":"libs/require-is/phone","tablet":"libs/require-is/tablet","sinon":"libs/sinon/sinon","sinon-ie":"libs/sinon/sinon-ie","sinon-adapter":"libs/sinon/sinon-adapter","qtip":"libs/qtip/qtip","d3":"libs/d3/d3","domready":"libs/domready/domready","requireLib":"libs/require/require","require":"libs/require/require-loader"},"hbs":{"templateExtension":"hbs","disableHelpers":true,"disableI18n":true},"shim":{"libs/pickadate/picker.date":{"deps":["libs/pickadate/picker","is!ie?libs/legacy"],"exports":"Picker"},"qtip":{"deps":["css!libs/qtip/qtip"]},"fastclick":{"exports":"FastClick"},"sinon":{"exports":"sinon"},"d3":{"exports":"d3"}},"map":{"*":{"is":"libs/require-is/is","css":"libs/require/css/css","underscore":"lodash","backbone":"backbone-adapter","marionette":"marionette-adapter","Handlebars":"utils/helpers/helpers","sinon":"sinon-adapter","desktop-application":"classes/application","touch-application":"classes/touch-application","modules/accounts-filter/accounts-filter-module":"modules/accounts-filter/extensions/accounts-filter-dropdown/accounts-filter-dropdown-module","modules/category-selector/category-selector-module":"modules/category-selector/extensions/category-selector-popup/category-selector-popup-module","ui/modules/timerange-filter/timerange-filter-module":"ui/modules/timerange-filter/extensions/timerange-filter-simple-dropdown/timerange-filter-simple-dropdown-module","ui/modules/navbar/navbar-module":"ui/modules/navbar/navbar-module-pfm-extension","utils/fixtures-server":"utils/fixtures-server-pfm","data/locale/locale":"data/locale/locale-extension","classes/application":"classes/application-extension","classes/ui/widget/widget":"classes/ui/widget/widget-extension","classes/budget-item-view":"classes/budget-item-view-extension","classes/networth/networth-overtime-chart":"classes/networth/networth-overtime-chart-extension","modules/analysis-content/analysis-content-module":"modules/analysis-content/analysis-content-module-extension","modules/budget-content/budget-content-module":"modules/budget-content/budget-content-module-extension","modules/budget-editor/budget-editor-module":"modules/budget-editor/budget-editor-module-extension","modules/networth-content/networth-content-module":"modules/networth-content/networth-content-module-extension","modules/networth-filters/networth-filters-module":"modules/networth-filters/networth-filters-module-extension","modules/networth-overtime-columnchart/networth-overtime-columnchart-module":"modules/networth-overtime-columnchart/networth-overtime-columnchart-module-extension","modules/networth-overtime-columnchart/views/networth-overtime-columnchart-accessible-chart":"modules/networth-overtime-columnchart/views/networth-overtime-columnchart-accessible-chart-extension","modules/networth-product-editor/views/networth-product-balance":"modules/networth-product-editor/views/networth-product-balance-extension","modules/networth-product-editor/views/networth-product-balance-row":"modules/networth-product-editor/views/networth-product-balance-row-extension","modules/networth-product-editor/views/networth-product-form":"modules/networth-product-editor/views/networth-product-form-extension","modules/networth-product-manager/networth-product-manager-module":"modules/networth-product-manager/networth-product-manager-module-extension","modules/networth-product-manager/views/networth-category":"modules/networth-product-manager/views/networth-category-extension","modules/networth-product-manager/views/networth-product-set":"modules/networth-product-manager/views/networth-product-set-extension","modules/networth-product-manager/views/networth-product-set-chart":"modules/networth-product-manager/views/networth-product-set-chart-extension","modules/transactions-datagrid/transactions-datagrid-module":"modules/transactions-datagrid/transactions-datagrid-details-module","modules/transactions-filters/transactions-filters-module":"modules/transactions-details-filters/transactions-details-filters-module","services/networth-service":"services/networth-service-extension","modules/patterns-datagrid/patterns-datagrid-module":"modules/patterns-datagrid/patterns-datagrid-module-extension","modules/patterns/patterns-module":"modules/patterns/patterns-module-extension","modules/pattern-editor/pattern-editor-module":"modules/pattern-editor/pattern-editor-module-extension","ui/modules/budget-calendar/budget-calendar-module":"ui/modules/budget-calendar/budget-calendar-module-extension","ui/modules/columnchart/columnchart-module":"ui/modules/columnchart/columnchart-module-extension","ui/modules/donutchart/donutchart-module":"ui/modules/donutchart/donutchart-module-extension","ui/modules/popup/popup-module":"ui/modules/popup/popup-module-extension","ui/modules/mode-filter/mode-filter-module":"ui/modules/mode-filter/mode-filter-module-extension","modules/transactions-details/extensions/transactions-details-accordion/transactions-details-accordion-module":"modules/transactions-details/extensions/transactions-details-accordion/transactions-details-accordion-module-extension","modules/transactions-details/transactions-details-module":"modules/transactions-details/transactions-details-module-extension","modules/balance-cashflowchart/views/balance-cashflowchart-columnchart":"modules/balance-cashflowchart/views/balance-cashflowchart-columnchart-extension","modules/balance-content/balance-content-module":"modules/balance-content/balance-content-module-extension","classes/platform-application":"classes/platform-application-extension","modules/rules/rules-module":"modules/rules/rules-module-extension","widgets/balance/balance-widget":"widgets/balance/balance-widget-extension","ui/modules/treemap/treemap-module":"ui/modules/treemap/treemap-module-extension","ui/modules/timerange-filter/extensions/timerange-filter-simple-dropdown/timerange-filter-simple-dropdown-module":"modules/dav-accounts-filter/dav-accounts-filter-module","utils/formatters/amount-formatter":"utils/formatters/amount-formatter-extension","utils/formatters/date-formatter":"utils/formatters/date-formatter-extension","widgets/analysis/analysis-widget":"widgets/analysis/analysis-widget-extension","widgets/details/details-widget":"widgets/details/details-widget-extension","widgets/details/views/details-content-view":"widgets/details/views/details-content-view-extension","widgets/details/views/details-grid-view":"widgets/details/views/details-grid-view-extension","widgets/financial-calendar/views/financial-calendar-content-view":"widgets/financial-calendar/views/financial-calendar-content-view-extension","modules/rules/rules-form-view":"modules/rules/rules-form-view-extension","modules/rules/rules-list-view":"modules/rules/rules-list-view-extension","modules/transactions-edit/transactions-edit-module":"modules/transactions-edit/transactions-edit-module-extension","classes/ui/chart/accessible-chart":"classes/ui/chart/accessible-chart-extension","classes/analysis/analysis-accessible-chart":"classes/analysis/analysis-accessible-chart-extension","ui/modules/autocomplete/autocomplete-module":"ui/modules/autocomplete/autocomplete-module-extension","services/transactions-export-service":"services/transactions-export-service-extension","modules/transactions-category-editor/transactions-category-editor-module":"modules/transactions-category-editor/transactions-category-editor-module-extension","modules/rules-inline/rules-inline-module":"modules/rules-inline/rules-inline-module-extension","modules/category-selector/extensions/category-selector-popup/views/category-selector-view":"modules/category-selector/extensions/category-selector-popup/views/category-selector-view-extension","modules/transactions-export/transactions-export-module":"modules/transactions-export/transactions-export-module-extension","classes/ui/chart/chart":"classes/ui/chart/chart-extension","services/analysis-service":"services/analysis-service-extension","classes/balance/balance-accessible-chart":"classes/balance/balance-accessible-chart-extension","ui/modules/planetchart/planetchart-module":"ui/modules/planetchart/planetchart-module-extension","modules/analysis-barchart/analysis-barchart-module":"modules/analysis-barchart/analysis-barchart-module-extension","ui/modules/bubblechart/bubblechart-module":"ui/modules/bubblechart/bubblechart-module-extension","widgets/networth/networth-widget":"widgets/networth/networth-widget-extension","classes/budget-history-accessible-chart":"classes/budget-history-accessible-chart-extension","widgets/alerts/views/alerts-content-view":"widgets/alerts/views/alerts-content-view-extension","modules/alerts-list/views/alerts-list-view":"modules/alerts-list/views/alerts-list-view-extension","modules/alerts-config/alerts-config-module":"modules/alerts-config/alerts-config-module-extension","widgets/ok-to-spend/views/ok-to-spend-content-view":"widgets/ok-to-spend/views/ok-to-spend-content-view-extension","modules/transactions-calendar/transactions-calendar-module":"modules/transactions-calendar/transactions-calendar-module-extension","ui/modules/calendar/layouts/month/views/calendar-month-view":"ui/modules/calendar/layouts/month/views/calendar-month-view-extension","modules/transactions-calendar/views/transactions-calendar-month-item-view":"modules/transactions-calendar/views/transactions-calendar-month-item-view-extension","ui/modules/calendar/layouts/day/views/calendar-day-view":"ui/modules/calendar/layouts/day/views/calendar-day-view-extension","modules/transactions-calendar/views/transactions-calendar-day-item-view":"modules/transactions-calendar/views/transactions-calendar-day-item-view-extension","modules/networth-ytd-header/networth-ytd-header-module":"modules/networth-ytd-header/networth-ytd-header-module-extension","services/reports-service":"services/reports-service-extension","services/budget-service":"services/budget-service-extension","services/patterns-service":"services/patterns-service-extension","services/savings-service":"services/savings-service-extension","services/session-service":"services/session-service-extension","classes/model":"classes/model-extension","modules/category-selector/views/category-create-view":"modules/category-selector/views/category-create-view-extension","modules/category-selector/views/category-remove-view":"modules/category-selector/views/category-remove-view-extension","modules/category-selector/views/category-select-view":"modules/category-selector/views/category-select-view-extension","modules/category-selector/views/category-update-view":"modules/category-selector/views/category-update-view-extension","modules/networth-product-manager/views/networth-category-extra-payments":"modules/networth-product-manager/views/networth-category-extra-payments-extension","ui/modules/datagrid/datagrid-module":"ui/modules/datagrid/datagrid-module-extension","modules/transactions-advanced-search/transactions-advanced-search-module":"modules/transactions-advanced-search/transactions-advanced-search-module-extension","modules/accounts-accordion/views/accounts-view":"modules/accounts-accordion/views/accounts-view-extension","modules/category-selector/extensions/category-selector-columns/views/category-selector-view":"modules/category-selector/extensions/category-selector-columns/views/category-selector-view-extension"},"backbone-view-el":{"backbone":"libs/backbone/backbone"},"backbone-adapter":{"backbone":"libs/backbone/backbone"},"backbone-super":{"backbone":"libs/backbone/backbone"},"backbone-ajax":{"backbone":"libs/backbone/backbone"},"marionette-adapter":{"marionette":"marionette"},"marionette-asynchronous":{"marionette":"marionette"},"libs/handlebars/helpers-nested":{"Handlebars":"Handlebars"},"hbs":{"Handlebars":"Handlebars"},"sinon-adapter":{"sinon":"sinon"},"sinon-ie":{"sinon":"sinon"},"utils/helpers":{"Handlebars":"Handlebars"},"ui":{"Handlebars":"Handlebars"},"qtip":{"jquery":"jQuery","imagesloaded":"jQuery"},"data/locale/locale-extension":{"data/locale/locale":"data/locale/locale"},"classes/application-pfm":{"classes/application":"classes/application"},"classes/ui/widget/widget-extension":{"classes/ui/widget/widget":"classes/ui/widget/widget"},"modules/accounts-filter/extensions/accounts-filter-dropdown/accounts-filter-dropdown-module":{"modules/accounts-filter/accounts-filter-module":"modules/accounts-filter/accounts-filter-module"},"modules/accounts-filter/extensions/accounts-filter-popup/accounts-filter-popup-module":{"modules/accounts-filter/accounts-filter-module":"modules/accounts-filter/accounts-filter-module"},"modules/category-selector/extensions/category-selector-popup/category-selector-popup-module":{"modules/category-selector/category-selector-module":"modules/category-selector/category-selector-module-extension"},"ui/modules/mode-filter/extensions/mode-filter-selector/mode-filter-selector-module":{"ui/modules/mode-filter/mode-filter-module":"ui/modules/mode-filter/mode-filter-module"},"ui/modules/timerange-filter/extensions/timerange-filter-simple-dropdown/timerange-filter-simple-dropdown-module":{"ui/modules/timerange-filter/timerange-filter-module":"ui/modules/timerange-filter/timerange-filter-module"},"ui/modules/timerange-filter/extensions/timerange-filter-dropdown/timerange-filter-dropdown-module":{"ui/modules/timerange-filter/timerange-filter-module":"ui/modules/timerange-filter/timerange-filter-module"},"ui/modules/timerange-filter/extensions/timerange-filter-popup/timerange-filter-popup-module":{"ui/modules/timerange-filter/timerange-filter-module":"ui/modules/timerange-filter/timerange-filter-module"},"ui/modules/navbar/navbar-module-pfm":{"ui/modules/navbar/navbar-module":"ui/modules/navbar/navbar-module"},"widgets/analysis/views/analysis-chart-view":{"modules/transactions-details/transactions-details-module":"modules/transactions-details/extensions/transactions-details-accordion/transactions-details-accordion-module"},"widgets/balance/views/balance-content-view":{"modules/transactions-details/transactions-details-module":"modules/transactions-details/extensions/transactions-details-accordion/transactions-details-accordion-module"},"utils/fixtures-server-pfm":{"utils/fixtures-server":"utils/fixtures-server"},"services/reports-service-extension":{"services/reports-service":"services/reports-service"},"modules/rules/rules-module-extension":{"modules/rules/rules-module":"modules/rules/rules-module"},"modules/networth-ytd-header/networth-ytd-header-module-extension":{"modules/networth-ytd-header/networth-ytd-header-module":"modules/networth-ytd-header/networth-ytd-header-module"},"modules/patterns-datagrid/patterns-datagrid-module-extension":{"modules/patterns-datagrid/patterns-datagrid-module":"modules/patterns-datagrid/patterns-datagrid-module"},"modules/patterns/patterns-module-extension":{"modules/patterns/patterns-module":"modules/patterns/patterns-module"},"modules/pattern-editor/pattern-editor-module-extension":{"modules/pattern-editor/pattern-editor-module":"modules/pattern-editor/pattern-editor-module"},"ui/modules/calendar/layouts/day/views/calendar-day-view-extension":{"ui/modules/calendar/layouts/day/views/calendar-day-view":"ui/modules/calendar/layouts/day/views/calendar-day-view"},"modules/transactions-calendar/views/transactions-calendar-month-item-view-extension":{"modules/transactions-calendar/views/transactions-calendar-month-item-view":"modules/transactions-calendar/views/transactions-calendar-month-item-view"},"ui/modules/calendar/layouts/month/views/calendar-month-view-extension":{"ui/modules/calendar/layouts/month/views/calendar-month-view":"ui/modules/calendar/layouts/month/views/calendar-month-view-mobile"},"ui/modules/calendar/layouts/month/views/calendar-month-view-mobile":{"ui/modules/calendar/layouts/month/views/calendar-month-view":"ui/modules/calendar/layouts/month/views/calendar-month-view"},"modules/transactions-calendar/transactions-calendar-module-extension":{"modules/transactions-calendar/transactions-calendar-module":"modules/transactions-calendar/transactions-calendar-module"},"modules/transactions-calendar/views/transactions-calendar-day-item-view-extension":{"modules/transactions-calendar/views/transactions-calendar-day-item-view":"modules/transactions-calendar/views/transactions-calendar-day-item-view"},"modules/transactions-export/transactions-export-module-extension":{"modules/transactions-export/transactions-export-module":"modules/transactions-export/transactions-export-module"},"modules/category-selector/extensions/category-selector-popup/views/category-selector-view-extension":{"modules/category-selector/extensions/category-selector-popup/views/category-selector-view":"modules/category-selector/extensions/category-selector-popup/views/category-selector-view"},"modules/rules-inline/rules-inline-module-extension":{"modules/rules-inline/rules-inline-module":"modules/rules-inline/rules-inline-module"},"modules/transactions-category-editor/transactions-category-editor-module-extension":{"modules/transactions-category-editor/transactions-category-editor-module":"modules/transactions-category-editor/transactions-category-editor-module"},"services/transactions-export-service-extension":{"services/transactions-export-service":"services/transactions-export-service"},"ui/modules/autocomplete/autocomplete-module-extension":{"ui/modules/autocomplete/autocomplete-module":"ui/modules/autocomplete/autocomplete-module"},"modules/category-selector/category-selector-module-extension":{"modules/category-selector/category-selector-module":"modules/category-selector/category-selector-module"},"ui/modules/datagrid/transactions-v-datagrid-module":{"ui/modules/datagrid/v-datagrid-module":"ui/modules/datagrid/v-datagrid-module"},"modules/transactions-edit/transactions-edit-module-extension":{"modules/transactions-edit/transactions-edit-module":"modules/transactions-edit/transactions-edit-module"},"modules/rules/rules-form-view-extension":{"modules/rules/rules-form-view":"modules/rules/rules-form-view"},"modules/rules/rules-list-view-extension":{"modules/rules/rules-list-view":"modules/rules/rules-list-view"},"classes/application-extension":{"classes/application":"classes/application-pfm"},"classes/analysis/analysis-accessible-chart-extension":{"classes/analysis/analysis-accessible-chart":"classes/analysis/analysis-accessible-chart"},"classes/budget-item-view-extension":{"classes/budget-item-view":"classes/budget-item-view"},"classes/networth/networth-overtime-chart-extension":{"classes/networth/networth-overtime-chart":"classes/networth/networth-overtime-chart"},"modules/accounts-filter/extensions/accounts-filter-dropdown/accounts-filter-dropdown-module-extension":{"modules/accounts-filter/extensions/accounts-filter-dropdown/accounts-filter-dropdown-module":"modules/accounts-filter/extensions/accounts-filter-dropdown/accounts-filter-dropdown-module"},"modules/analysis-content/analysis-content-module-extension":{"modules/analysis-content/analysis-content-module":"modules/analysis-content/analysis-content-module"},"modules/budget-content/budget-content-module-extension":{"modules/budget-content/budget-content-module":"modules/budget-content/budget-content-module"},"modules/budget-editor/budget-editor-module-extension":{"modules/budget-editor/budget-editor-module":"modules/budget-editor/budget-editor-module"},"modules/dav-timerange-filter/dav-timerange-filter-module":{"ui/modules/timerange-filter/extensions/timerange-filter-simple-dropdown/timerange-filter-simple-dropdown-module":"ui/modules/timerange-filter/extensions/timerange-filter-simple-dropdown/timerange-filter-simple-dropdown-module"},"modules/networth-content/networth-content-module-extension":{"modules/networth-content/networth-content-module":"modules/networth-content/networth-content-module"},"modules/networth-filters/networth-filters-module-extension":{"modules/networth-filters/networth-filters-module":"modules/networth-filters/networth-filters-module"},"modules/networth-overtime-columnchart/networth-overtime-columnchart-module-extension":{"modules/networth-overtime-columnchart/networth-overtime-columnchart-module":"modules/networth-overtime-columnchart/networth-overtime-columnchart-module"},"modules/networth-overtime-columnchart/views/networth-overtime-columnchart-accessible-chart-extension":{"modules/networth-overtime-columnchart/views/networth-overtime-columnchart-accessible-chart":"modules/networth-overtime-columnchart/views/networth-overtime-columnchart-accessible-chart"},"modules/networth-product-editor/views/networth-product-balance-extension":{"modules/networth-product-editor/views/networth-product-balance":"modules/networth-product-editor/views/networth-product-balance"},"modules/networth-product-editor/views/networth-product-balance-row-extension":{"modules/networth-product-editor/views/networth-product-balance-row":"modules/networth-product-editor/views/networth-product-balance-row"},"modules/networth-product-editor/views/networth-product-form-extension":{"modules/networth-product-editor/views/networth-product-form":"modules/networth-product-editor/views/networth-product-form"},"modules/networth-product-manager/networth-product-manager-module-extension":{"modules/networth-product-manager/networth-product-manager-module":"modules/networth-product-manager/networth-product-manager-module"},"modules/networth-product-manager/views/networth-category-extension":{"modules/networth-product-manager/views/networth-category":"modules/networth-product-manager/views/networth-category"},"modules/networth-product-manager/views/networth-product-set-chart":{"ui/modules/donutchart/donutchart-module":"ui/modules/donutchart/donutchart-module-networth"},"modules/networth-product-manager/views/networth-product-set-chart-extension":{"modules/networth-product-manager/views/networth-product-set-chart":"modules/networth-product-manager/views/networth-product-set-chart"},"modules/networth-product-manager/views/networth-product-set-extension":{"modules/networth-product-manager/views/networth-product-set":"modules/networth-product-manager/views/networth-product-set"},"modules/transactions-datagrid/transactions-datagrid-details-module":{"modules/transactions-datagrid/transactions-datagrid-module":"modules/transactions-datagrid/transactions-datagrid-module"},"modules/transactions-details/extensions/transactions-details-accordion/transactions-details-accordion-module-extension":{"modules/transactions-details/extensions/transactions-details-accordion/transactions-details-accordion-module":"modules/transactions-details/extensions/transactions-details-accordion/transactions-details-accordion-module"},"modules/transactions-details-filters/transactions-details-filters-module":{"modules/transactions-filters/transactions-filters-module":"modules/transactions-filters/transactions-filters-module"},"services/networth-service-extension":{"services/networth-service":"services/networth-service"},"ui/modules/budget-calendar/budget-calendar-module-extension":{"ui/modules/budget-calendar/budget-calendar-module":"ui/modules/budget-calendar/budget-calendar-module"},"ui/modules/columnchart/columnchart-module-extension":{"ui/modules/columnchart/columnchart-module":"ui/modules/columnchart/columnchart-module"},"ui/modules/donutchart/donutchart-module-extension":{"ui/modules/donutchart/donutchart-module":"ui/modules/donutchart/donutchart-module"},"ui/modules/navbar/navbar-module-pfm-extension":{"ui/modules/navbar/navbar-module-pfm":"ui/modules/navbar/navbar-module-pfm"},"ui/modules/popup/popup-module-extension":{"ui/modules/popup/popup-module":"ui/modules/popup/popup-module"},"ui/modules/mode-filter/mode-filter-module-extension":{"ui/modules/mode-filter/mode-filter-module":"ui/modules/mode-filter/mode-filter-module"},"ui/modules/tabs/tabs-module-extension":{"ui/modules/tabs/tabs-module":"ui/modules/tabs/tabs-module"},"ui/modules/tabs/tabs-module-networth":{"ui/modules/tabs/tabs-module-extension":"ui/modules/tabs/tabs-module-extension"},"ui/modules/treemap/treemap-module-extension":{"ui/modules/treemap/treemap-module":"ui/modules/treemap/treemap-module"},"modules/dav-accounts-filter/dav-accounts-filter-module":{"ui/modules/timerange-filter/extensions/timerange-filter-simple-dropdown/timerange-filter-simple-dropdown-module":"ui/modules/timerange-filter/extensions/timerange-filter-simple-dropdown/timerange-filter-simple-dropdown-module"},"utils/formatters/amount-formatter-extension":{"utils/formatters/amount-formatter":"utils/formatters/amount-formatter"},"utils/formatters/date-formatter-extension":{"utils/formatters/date-formatter":"utils/formatters/date-formatter"},"widgets/analysis/analysis-widget-extension":{"widgets/analysis/analysis-widget":"widgets/analysis/analysis-widget"},"widgets/details/details-widget-extension":{"widgets/details/details-widget":"widgets/details/details-widget"},"widgets/details/views/details-content-view-extension":{"widgets/details/views/details-content-view":"widgets/details/views/details-content-view"},"modules/transactions-details/transactions-details-module-extension":{"modules/transactions-details/transactions-details-module":"modules/transactions-details/transactions-details-module"},"modules/balance-cashflowchart/views/balance-cashflowchart-columnchart-extension":{"modules/balance-cashflowchart/views/balance-cashflowchart-columnchart":"modules/balance-cashflowchart/views/balance-cashflowchart-columnchart"},"modules/balance-content/balance-content-module-extension":{"modules/balance-content/balance-content-module":"modules/balance-content/balance-content-module"},"classes/platform-application-extension":{"classes/platform-application":"classes/platform-application"},"widgets/balance/balance-widget-extension":{"widgets/balance/balance-widget":"widgets/balance/balance-widget"},"widgets/details/views/details-grid-view-extension":{"widgets/details/views/details-grid-view":"widgets/details/views/details-grid-view"},"widgets/financial-calendar/views/financial-calendar-content-view-extension":{"widgets/financial-calendar/views/financial-calendar-content-view":"widgets/financial-calendar/views/financial-calendar-content-view"},"classes/ui/chart/accessible-chart-extension":{"classes/ui/chart/accessible-chart":"classes/ui/chart/accessible-chart"},"ui/modules/bubblechart/bubblechart-module-extension":{"ui/modules/bubblechart/bubblechart-module":"ui/modules/bubblechart/bubblechart-module"},"services/analysis-service-extension":{"services/analysis-service":"services/analysis-service"},"classes/ui/chart/chart-extension":{"classes/ui/chart/chart":"classes/ui/chart/chart"},"classes/budget-history-accessible-chart-extension":{"classes/budget-history-accessible-chart":"classes/budget-history-accessible-chart"},"ui/modules/planetchart/planetchart-module-extension":{"ui/modules/planetchart/planetchart-module":"ui/modules/planetchart/planetchart-module"},"modules/analysis-barchart/analysis-barchart-module-extension":{"modules/analysis-barchart/analysis-barchart-module":"modules/analysis-barchart/analysis-barchart-module"},"widgets/networth/networth-widget-extension":{"widgets/networth/networth-widget":"widgets/networth/networth-widget"},"widgets/alerts/views/alerts-content-view-extension":{"widgets/alerts/views/alerts-content-view":"widgets/alerts/views/alerts-content-view"},"modules/alerts-list/views/alerts-list-view-extension":{"modules/alerts-list/views/alerts-list-view":"modules/alerts-list/views/alerts-list-view"},"modules/alerts-config/alerts-config-module-extension":{"modules/alerts-config/alerts-config-module":"modules/alerts-config/alerts-config-module"},"classes/balance/balance-accessible-chart-extension":{"classes/balance/balance-accessible-chart":"classes/balance/balance-accessible-chart"},"widgets/ok-to-spend/views/ok-to-spend-content-view-extension":{"widgets/ok-to-spend/views/ok-to-spend-content-view":"widgets/ok-to-spend/views/ok-to-spend-content-view"},"services/budget-service-extension":{"services/budget-service":"services/budget-service"},"services/patterns-service-extension":{"services/patterns-service":"services/patterns-service"},"services/savings-service-extension":{"services/savings-service":"services/savings-service"},"services/session-service-extension":{"services/session-service":"services/session-service"},"classes/model-extension":{"classes/model":"classes/model"},"ui/modules/datagrid/datagrid-module-extension":{"ui/modules/datagrid/datagrid-module":"ui/modules/datagrid/datagrid-module"},"modules/accounts-accordion/views/accounts-view-extension":{"modules/accounts-accordion/views/accounts-view":"modules/accounts-accordion/views/accounts-view"},"modules/category-selector/views/category-create-view-extension":{"modules/category-selector/views/category-create-view":"modules/category-selector/views/category-create-view"},"modules/category-selector/views/category-remove-view-extension":{"modules/category-selector/views/category-remove-view":"modules/category-selector/views/category-remove-view"},"modules/category-selector/views/category-select-view-extension":{"modules/category-selector/views/category-select-view":"modules/category-selector/views/category-select-view"},"modules/category-selector/views/category-update-view-extension":{"modules/category-selector/views/category-update-view":"modules/category-selector/views/category-update-view"},"modules/networth-product-manager/views/networth-category-extra-payments-extension":{"modules/networth-product-manager/views/networth-category-extra-payments":"modules/networth-product-manager/views/networth-category-extra-payments"},"modules/transactions-advanced-search/transactions-advanced-search-module-extension":{"modules/transactions-advanced-search/transactions-advanced-search-module":"modules/transactions-advanced-search/transactions-advanced-search-module"},"modules/category-selector/extensions/category-selector-columns/views/category-selector-view-extension":{"modules/category-selector/extensions/category-selector-columns/views/category-selector-view":"modules/category-selector/extensions/category-selector-columns/views/category-selector-view"}},"baseUrl":"/"});
(function(e,t){typeof module=="object"&&typeof module.exports=="object"?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)})(typeof window!="undefined"?window:this,function(e,t){function g(e){var t=e.length,n=h.type(e);return n==="function"||h.isWindow(e)?!1:e.nodeType===1&&t?!0:n==="array"||t===0||typeof t=="number"&&t>0&&t-1 in e}function S(e,t,n){if(h.isFunction(t))return h.grep(e,function(e,r){return!!t.call(e,r,e)!==n});if(t.nodeType)return h.grep(e,function(e){return e===t!==n});if(typeof t=="string"){if(E.test(t))return h.filter(t,e,n);t=h.filter(t,e)}return h.grep(e,function(e){return h.inArray(e,t)>=0!==n})}function A(e,t){do e=e[t];while(e&&e.nodeType!==1);return e}function _(e){var t=M[e]={};return h.each(e.match(O)||[],function(e,n){t[n]=!0}),t}function P(){T.addEventListener?(T.removeEventListener("DOMContentLoaded",H,!1),e.removeEventListener("load",H,!1)):(T.detachEvent("onreadystatechange",H),e.detachEvent("onload",H))}function H(){if(T.addEventListener||event.type==="load"||T.readyState==="complete")P(),h.ready()}function q(e,t,n){if(n===undefined&&e.nodeType===1){var r="data-"+t.replace(I,"-$1").toLowerCase();n=e.getAttribute(r);if(typeof n=="string"){try{n=n==="true"?!0:n==="false"?!1:n==="null"?null:+n+""===n?+n:F.test(n)?h.parseJSON(n):n}catch(i){}h.data(e,t,n)}else n=undefined}return n}function R(e){var t;for(t in e){if(t==="data"&&h.isEmptyObject(e[t]))continue;if(t!=="toJSON")return!1}return!0}function U(e,t,r,i){if(!h.acceptData(e))return;var s,o,u=h.expando,a=e.nodeType,f=a?h.cache:e,l=a?e[u]:e[u]&&u;if((!l||!f[l]||!i&&!f[l].data)&&r===undefined&&typeof t=="string")return;l||(a?l=e[u]=n.pop()||h.guid++:l=u),f[l]||(f[l]=a?{}:{toJSON:h.noop});if(typeof t=="object"||typeof t=="function")i?f[l]=h.extend(f[l],t):f[l].data=h.extend(f[l].data,t);return o=f[l],i||(o.data||(o.data={}),o=o.data),r!==undefined&&(o[h.camelCase(t)]=r),typeof t=="string"?(s=o[t],s==null&&(s=o[h.camelCase(t)])):s=o,s}function z(e,t,n){if(!h.acceptData(e))return;var r,i,s=e.nodeType,o=s?h.cache:e,u=s?e[h.expando]:h.expando;if(!o[u])return;if(t){r=n?o[u]:o[u].data;if(r){h.isArray(t)?t=t.concat(h.map(t,h.camelCase)):t in r?t=[t]:(t=h.camelCase(t),t in r?t=[t]:t=t.split(" ")),i=t.length;while(i--)delete r[t[i]];if(n?!R(r):!h.isEmptyObject(r))return}}if(!n){delete o[u].data;if(!R(o[u]))return}s?h.cleanData([e],!0):l.deleteExpando||o!=o.window?delete o[u]:o[u]=null}function et(){return!0}function tt(){return!1}function nt(){try{return T.activeElement}catch(e){}}function rt(e){var t=it.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}function wt(e,t){var n,r,i=0,s=typeof e.getElementsByTagName!==B?e.getElementsByTagName(t||"*"):typeof e.querySelectorAll!==B?e.querySelectorAll(t||"*"):undefined;if(!s)for(s=[],n=e.childNodes||e;(r=n[i])!=null;i++)!t||h.nodeName(r,t)?s.push(r):h.merge(s,wt(r,t));return t===undefined||t&&h.nodeName(e,t)?h.merge([e],s):s}function Et(e){J.test(e.type)&&(e.defaultChecked=e.checked)}function St(e,t){return h.nodeName(e,"table")&&h.nodeName(t.nodeType!==11?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function xt(e){return e.type=(h.find.attr(e,"type")!==null)+"/"+e.type,e}function Tt(e){var t=vt.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function Nt(e,t){var n,r=0;for(;(n=e[r])!=null;r++)h._data(n,"globalEval",!t||h._data(t[r],"globalEval"))}function Ct(e,t){if(t.nodeType!==1||!h.hasData(e))return;var n,r,i,s=h._data(e),o=h._data(t,s),u=s.events;if(u){delete o.handle,o.events={};for(n in u)for(r=0,i=u[n].length;r<i;r++)h.event.add(t,n,u[n][r])}o.data&&(o.data=h.extend({},o.data))}function kt(e,t){var n,r,i;if(t.nodeType!==1)return;n=t.nodeName.toLowerCase();if(!l.noCloneEvent&&t[h.expando]){i=h._data(t);for(r in i.events)h.removeEvent(t,r,i.handle);t.removeAttribute(h.expando)}if(n==="script"&&t.text!==e.text)xt(t).text=e.text,Tt(t);else if(n==="object")t.parentNode&&(t.outerHTML=e.outerHTML),l.html5Clone&&e.innerHTML&&!h.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML);else if(n==="input"&&J.test(e.type))t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value);else if(n==="option")t.defaultSelected=t.selected=e.defaultSelected;else if(n==="input"||n==="textarea")t.defaultValue=e.defaultValue}function Ot(t,n){var r,i=h(n.createElement(t)).appendTo(n.body),s=e.getDefaultComputedStyle&&(r=e.getDefaultComputedStyle(i[0]))?r.display:h.css(i[0],"display");return i.detach(),s}function Mt(e){var t=T,n=At[e];if(!n){n=Ot(e,t);if(n==="none"||!n)Lt=(Lt||h("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=(Lt[0].contentWindow||Lt[0].contentDocument).document,t.write(),t.close(),n=Ot(e,t),Lt.detach();At[e]=n}return n}function jt(e,t){return{get:function(){var n=e();if(n==null)return;if(n){delete this.get;return}return(this.get=t).apply(this,arguments)}}}function Vt(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=Xt.length;while(i--){t=Xt[i]+n;if(t in e)return t}return r}function $t(e,t){var n,r,i,s=[],o=0,u=e.length;for(;o<u;o++){r=e[o];if(!r.style)continue;s[o]=h._data(r,"olddisplay"),n=r.style.display,t?(!s[o]&&n==="none"&&(r.style.display=""),r.style.display===""&&V(r)&&(s[o]=h._data(r,"olddisplay",Mt(r.nodeName)))):(i=V(r),(n&&n!=="none"||!i)&&h._data(r,"olddisplay",i?n:h.css(r,"display")))}for(o=0;o<u;o++){r=e[o];if(!r.style)continue;if(!t||r.style.display==="none"||r.style.display==="")r.style.display=t?s[o]||"":"none"}return e}function Jt(e,t,n){var r=Rt.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function Kt(e,t,n,r,i){var s=n===(r?"border":"content")?4:t==="width"?1:0,o=0;for(;s<4;s+=2)n==="margin"&&(o+=h.css(e,n+X[s],!0,i)),r?(n==="content"&&(o-=h.css(e,"padding"+X[s],!0,i)),n!=="margin"&&(o-=h.css(e,"border"+X[s]+"Width",!0,i))):(o+=h.css(e,"padding"+X[s],!0,i),n!=="padding"&&(o+=h.css(e,"border"+X[s]+"Width",!0,i)));return o}function Qt(e,t,n){var r=!0,i=t==="width"?e.offsetWidth:e.offsetHeight,s=Pt(e),o=l.boxSizing&&h.css(e,"boxSizing",!1,s)==="border-box";if(i<=0||i==null){i=Ht(e,t,s);if(i<0||i==null)i=e.style[t];if(Dt.test(i))return i;r=o&&(l.boxSizingReliable()||i===e.style[t]),i=parseFloat(i)||0}return i+Kt(e,t,n||(o?"border":"content"),r,s)+"px"}function Gt(e,t,n,r,i){return new Gt.prototype.init(e,t,n,r,i)}function on(){return setTimeout(function(){Yt=undefined}),Yt=h.now()}function un(e,t){var n,r={height:e},i=0;t=t?1:0;for(;i<4;i+=2-t)n=X[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function an(e,t,n){var r,i=(sn[t]||[]).concat(sn["*"]),s=0,o=i.length;for(;s<o;s++)if(r=i[s].call(n,t,e))return r}function fn(e,t,n){var r,i,s,o,u,a,f,c,p=this,d={},v=e.style,m=e.nodeType&&V(e),g=h._data(e,"fxshow");n.queue||(u=h._queueHooks(e,"fx"),u.unqueued==null&&(u.unqueued=0,a=u.empty.fire,u.empty.fire=function(){u.unqueued||a()}),u.unqueued++,p.always(function(){p.always(function(){u.unqueued--,h.queue(e,"fx").length||u.empty.fire()})})),e.nodeType===1&&("height"in t||"width"in t)&&(n.overflow=[v.overflow,v.overflowX,v.overflowY],f=h.css(e,"display"),c=f==="none"?h._data(e,"olddisplay")||Mt(e.nodeName):f,c==="inline"&&h.css(e,"float")==="none"&&(!l.inlineBlockNeedsLayout||Mt(e.nodeName)==="inline"?v.display="inline-block":v.zoom=1)),n.overflow&&(v.overflow="hidden",l.shrinkWrapBlocks()||p.always(function(){v.overflow=n.overflow[0],v.overflowX=n.overflow[1],v.overflowY=n.overflow[2]}));for(r in t){i=t[r];if(en.exec(i)){delete t[r],s=s||i==="toggle";if(i===(m?"hide":"show")){if(i!=="show"||!g||g[r]===undefined)continue;m=!0}d[r]=g&&g[r]||h.style(e,r)}else f=undefined}if(!h.isEmptyObject(d)){g?"hidden"in g&&(m=g.hidden):g=h._data(e,"fxshow",{}),s&&(g.hidden=!m),m?h(e).show():p.done(function(){h(e).hide()}),p.done(function(){var t;h._removeData(e,"fxshow");for(t in d)h.style(e,t,d[t])});for(r in d)o=an(m?g[r]:0,r,p),r in g||(g[r]=o.start,m&&(o.end=o.start,o.start=r==="width"||r==="height"?1:0))}else(f==="none"?Mt(e.nodeName):f)==="inline"&&(v.display=f)}function ln(e,t){var n,r,i,s,o;for(n in e){r=h.camelCase(n),i=t[r],s=e[n],h.isArray(s)&&(i=s[1],s=e[n]=s[0]),n!==r&&(e[r]=s,delete e[n]),o=h.cssHooks[r];if(o&&"expand"in o){s=o.expand(s),delete e[r];for(n in s)n in e||(e[n]=s[n],t[n]=i)}else t[r]=i}}function cn(e,t,n){var r,i,s=0,o=rn.length,u=h.Deferred().always(function(){delete a.elem}),a=function(){if(i)return!1;var t=Yt||on(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,s=1-r,o=0,a=f.tweens.length;for(;o<a;o++)f.tweens[o].run(s);return u.notifyWith(e,[f,s,n]),s<1&&a?n:(u.resolveWith(e,[f]),!1)},f=u.promise({elem:e,props:h.extend({},t),opts:h.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Yt||on(),duration:n.duration,tweens:[],createTween:function(t,n){var r=h.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(r),r},stop:function(t){var n=0,r=t?f.tweens.length:0;if(i)return this;i=!0;for(;n<r;n++)f.tweens[n].run(1);return t?u.resolveWith(e,[f,t]):u.rejectWith(e,[f,t]),this}}),l=f.props;ln(l,f.opts.specialEasing);for(;s<o;s++){r=rn[s].call(f,e,l,f.opts);if(r)return r}return h.map(l,an,f),h.isFunction(f.opts.start)&&f.opts.start.call(e,f),h.fx.timer(h.extend(a,{elem:e,anim:f,queue:f.opts.queue})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function Fn(e){return function(t,n){typeof t!="string"&&(n=t,t="*");var r,i=0,s=t.toLowerCase().match(O)||[];if(h.isFunction(n))while(r=s[i++])r.charAt(0)==="+"?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function In(e,t,n,r){function o(u){var a;return i[u]=!0,h.each(e[u]||[],function(e,u){var f=u(t,n,r);if(typeof f=="string"&&!s&&!i[f])return t.dataTypes.unshift(f),o(f),!1;if(s)return!(a=f)}),a}var i={},s=e===Hn;return o(t.dataTypes[0])||!i["*"]&&o("*")}function qn(e,t){var n,r,i=h.ajaxSettings.flatOptions||{};for(r in t)t[r]!==undefined&&((i[r]?e:n||(n={}))[r]=t[r]);return n&&h.extend(!0,e,n),e}function Rn(e,t,n){var r,i,s,o,u=e.contents,a=e.dataTypes;while(a[0]==="*")a.shift(),i===undefined&&(i=e.mimeType||t.getResponseHeader("Content-Type"));if(i)for(o in u)if(u[o]&&u[o].test(i)){a.unshift(o);break}if(a[0]in n)s=a[0];else{for(o in n){if(!a[0]||e.converters[o+" "+a[0]]){s=o;break}r||(r=o)}s=s||r}if(s)return s!==a[0]&&a.unshift(s),n[s]}function Un(e,t,n,r){var i,s,o,u,a,f={},l=e.dataTypes.slice();if(l[1])for(o in e.converters)f[o.toLowerCase()]=e.converters[o];s=l.shift();while(s){e.responseFields[s]&&(n[e.responseFields[s]]=t),!a&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),a=s,s=l.shift();if(s)if(s==="*")s=a;else if(a!=="*"&&a!==s){o=f[a+" "+s]||f["* "+s];if(!o)for(i in f){u=i.split(" ");if(u[1]===s){o=f[a+" "+u[0]]||f["* "+u[0]];if(o){o===!0?o=f[i]:f[i]!==!0&&(s=u[0],l.unshift(u[1]));break}}}if(o!==!0)if(o&&e["throws"])t=o(t);else try{t=o(t)}catch(c){return{state:"parsererror",error:o?c:"No conversion from "+a+" to "+s}}}}return{state:"success",data:t}}function Jn(e,t,n,r){var i;if(h.isArray(t))h.each(t,function(t,i){n||Wn.test(e)?r(e,i):Jn(e+"["+(typeof i=="object"?t:"")+"]",i,n,r)});else if(!n&&h.type(t)==="object")for(i in t)Jn(e+"["+i+"]",t[i],n,r);else r(e,t)}function Yn(){try{return new e.XMLHttpRequest}catch(t){}}function Zn(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function ir(e){return h.isWindow(e)?e:e.nodeType===9?e.defaultView||e.parentWindow:!1}var n=[],r=n.slice,i=n.concat,s=n.push,o=n.indexOf,u={},a=u.toString,f=u.hasOwnProperty,l={},c="1.11.1",h=function(e,t){return new h.fn.init(e,t)},p=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,d=/^-ms-/,v=/-([\da-z])/gi,m=function(e,t){return t.toUpperCase()};h.fn=h.prototype={jquery:c,constructor:h,selector:"",length:0,toArray:function(){return r.call(this)},get:function(e){return e!=null?e<0?this[e+this.length]:this[e]:r.call(this)},pushStack:function(e){var t=h.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return h.each(this,e,t)},map:function(e){return this.pushStack(h.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(r.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:s,sort:n.sort,splice:n.splice},h.extend=h.fn.extend=function(){var e,t,n,r,i,s,o=arguments[0]||{},u=1,a=arguments.length,f=!1;typeof o=="boolean"&&(f=o,o=arguments[u]||{},u++),typeof o!="object"&&!h.isFunction(o)&&(o={}),u===a&&(o=this,u--);for(;u<a;u++)if((i=arguments[u])!=null)for(r in i){e=o[r],n=i[r];if(o===n)continue;f&&n&&(h.isPlainObject(n)||(t=h.isArray(n)))?(t?(t=!1,s=e&&h.isArray(e)?e:[]):s=e&&h.isPlainObject(e)?e:{},o[r]=h.extend(f,s,n)):n!==undefined&&(o[r]=n)}return o},h.extend({expando:"jQuery"+(c+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return h.type(e)==="function"},isArray:Array.isArray||function(e){return h.type(e)==="array"},isWindow:function(e){return e!=null&&e==e.window},isNumeric:function(e){return!h.isArray(e)&&e-parseFloat(e)>=0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},isPlainObject:function(e){var t;if(!e||h.type(e)!=="object"||e.nodeType||h.isWindow(e))return!1;try{if(e.constructor&&!f.call(e,"constructor")&&!f.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}if(l.ownLast)for(t in e)return f.call(e,t);for(t in e);return t===undefined||f.call(e,t)},type:function(e){return e==null?e+"":typeof e=="object"||typeof e=="function"?u[a.call(e)]||"object":typeof e},globalEval:function(t){t&&h.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(d,"ms-").replace(v,m)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,s=e.length,o=g(e);if(n)if(o)for(;i<s;i++){r=t.apply(e[i],n);if(r===!1)break}else for(i in e){r=t.apply(e[i],n);if(r===!1)break}else if(o)for(;i<s;i++){r=t.call(e[i],i,e[i]);if(r===!1)break}else for(i in e){r=t.call(e[i],i,e[i]);if(r===!1)break}return e},trim:function(e){return e==null?"":(e+"").replace(p,"")},makeArray:function(e,t){var n=t||[];return e!=null&&(g(Object(e))?h.merge(n,typeof e=="string"?[e]:e):s.call(n,e)),n},inArray:function(e,t,n){var r;if(t){if(o)return o.call(t,e,n);r=t.length,n=n?n<0?Math.max(0,r+n):n:0;for(;n<r;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,t){var n=+t.length,r=0,i=e.length;while(r<n)e[i++]=t[r++];if(n!==n)while(t[r]!==undefined)e[i++]=t[r++];return e.length=i,e},grep:function(e,t,n){var r,i=[],s=0,o=e.length,u=!n;for(;s<o;s++)r=!t(e[s],s),r!==u&&i.push(e[s]);return i},map:function(e,t,n){var r,s=0,o=e.length,u=g(e),a=[];if(u)for(;s<o;s++)r=t(e[s],s,n),r!=null&&a.push(r);else for(s in e)r=t(e[s],s,n),r!=null&&a.push(r);return i.apply([],a)},guid:1,proxy:function(e,t){var n,i,s;return typeof t=="string"&&(s=e[t],t=e,e=s),h.isFunction(e)?(n=r.call(arguments,2),i=function(){return e.apply(t||this,n.concat(r.call(arguments)))},i.guid=e.guid=e.guid||h.guid++,i):undefined},now:function(){return+(new Date)},support:l}),h.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){u["[object "+t+"]"]=t.toLowerCase()});var y=function(e){function st(e,t,r,i){var s,u,f,l,c,d,g,y,S,x;(t?t.ownerDocument||t:E)!==p&&h(t),t=t||p,r=r||[];if(!e||typeof e!="string")return r;if((l=t.nodeType)!==1&&l!==9)return[];if(v&&!i){if(s=Z.exec(e))if(f=s[1]){if(l===9){u=t.getElementById(f);if(!u||!u.parentNode)return r;if(u.id===f)return r.push(u),r}else if(t.ownerDocument&&(u=t.ownerDocument.getElementById(f))&&b(t,u)&&u.id===f)return r.push(u),r}else{if(s[2])return P.apply(r,t.getElementsByTagName(e)),r;if((f=s[3])&&n.getElementsByClassName&&t.getElementsByClassName)return P.apply(r,t.getElementsByClassName(f)),r}if(n.qsa&&(!m||!m.test(e))){y=g=w,S=t,x=l===9&&e;if(l===1&&t.nodeName.toLowerCase()!=="object"){d=o(e),(g=t.getAttribute("id"))?y=g.replace(tt,"\\$&"):t.setAttribute("id",y),y="[id='"+y+"'] ",c=d.length;while(c--)d[c]=y+mt(d[c]);S=et.test(e)&&dt(t.parentNode)||t,x=d.join(",")}if(x)try{return P.apply(r,S.querySelectorAll(x)),r}catch(T){}finally{g||t.removeAttribute("id")}}}return a(e.replace(z,"$1"),t,r,i)}function ot(){function t(n,i){return e.push(n+" ")>r.cacheLength&&delete t[e.shift()],t[n+" "]=i}var e=[];return t}function ut(e){return e[w]=!0,e}function at(e){var t=p.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ft(e,t){var n=e.split("|"),i=e.length;while(i--)r.attrHandle[n[i]]=t}function lt(e,t){var n=t&&e,r=n&&e.nodeType===1&&t.nodeType===1&&(~t.sourceIndex||A)-(~e.sourceIndex||A);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function ct(e){return function(t){var n=t.nodeName.toLowerCase();return n==="input"&&t.type===e}}function ht(e){return function(t){var n=t.nodeName.toLowerCase();return(n==="input"||n==="button")&&t.type===e}}function pt(e){return ut(function(t){return t=+t,ut(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function dt(e){return e&&typeof e.getElementsByTagName!==L&&e}function vt(){}function mt(e){var t=0,n=e.length,r="";for(;t<n;t++)r+=e[t].value;return r}function gt(e,t,n){var r=t.dir,i=n&&r==="parentNode",s=x++;return t.first?function(t,n,s){while(t=t[r])if(t.nodeType===1||i)return e(t,n,s)}:function(t,n,o){var u,a,f=[S,s];if(o){while(t=t[r])if(t.nodeType===1||i)if(e(t,n,o))return!0}else while(t=t[r])if(t.nodeType===1||i){a=t[w]||(t[w]={});if((u=a[r])&&u[0]===S&&u[1]===s)return f[2]=u[2];a[r]=f;if(f[2]=e(t,n,o))return!0}}}function yt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function bt(e,t,n){var r=0,i=t.length;for(;r<i;r++)st(e,t[r],n);return n}function wt(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=t!=null;for(;u<a;u++)if(s=e[u])if(!n||n(s,r,i))o.push(s),f&&t.push(u);return o}function Et(e,t,n,r,i,s){return r&&!r[w]&&(r=Et(r)),i&&!i[w]&&(i=Et(i,s)),ut(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||bt(t||"*",u.nodeType?[u]:u,[]),m=e&&(s||!t)?wt(v,h,e,u,a):v,g=n?i||(s?e:d||r)?[]:o:m;n&&n(m,g,u,a);if(r){f=wt(g,p),r(f,[],u,a),l=f.length;while(l--)if(c=f[l])g[p[l]]=!(m[p[l]]=c)}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?B.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=wt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):P.apply(o,g)})}function St(e){var t,n,i,s=e.length,o=r.relative[e[0].type],u=o||r.relative[" "],a=o?1:0,l=gt(function(e){return e===t},u,!0),c=gt(function(e){return B.call(t,e)>-1},u,!0),h=[function(e,n,r){return!o&&(r||n!==f)||((t=n).nodeType?l(e,n,r):c(e,n,r))}];for(;a<s;a++)if(n=r.relative[e[a].type])h=[gt(yt(h),n)];else{n=r.filter[e[a].type].apply(null,e[a].matches);if(n[w]){i=++a;for(;i<s;i++)if(r.relative[e[i].type])break;return Et(a>1&&yt(h),a>1&&mt(e.slice(0,a-1).concat({value:e[a-2].type===" "?"*":""})).replace(z,"$1"),n,a<i&&St(e.slice(a,i)),i<s&&St(e=e.slice(i)),i<s&&mt(e))}h.push(n)}return yt(h)}function xt(e,t){var n=t.length>0,i=e.length>0,s=function(s,o,u,a,l){var c,h,d,v=0,m="0",g=s&&[],y=[],b=f,w=s||i&&r.find.TAG("*",l),E=S+=b==null?1:Math.random()||.1,x=w.length;l&&(f=o!==p&&o);for(;m!==x&&(c=w[m])!=null;m++){if(i&&c){h=0;while(d=e[h++])if(d(c,o,u)){a.push(c);break}l&&(S=E)}n&&((c=!d&&c)&&v--,s&&g.push(c))}v+=m;if(n&&m!==v){h=0;while(d=t[h++])d(g,y,o,u);if(s){if(v>0)while(m--)!g[m]&&!y[m]&&(y[m]=_.call(a));y=wt(y)}P.apply(a,y),l&&!s&&y.length>0&&v+t.length>1&&st.uniqueSort(a)}return l&&(S=E,f=b),g};return n?ut(s):s}var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w="sizzle"+ -(new Date),E=e.document,S=0,x=0,T=ot(),N=ot(),C=ot(),k=function(e,t){return e===t&&(c=!0),0},L=typeof undefined,A=1<<31,O={}.hasOwnProperty,M=[],_=M.pop,D=M.push,P=M.push,H=M.slice,B=M.indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(this[t]===e)return t;return-1},j="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",F="[\\x20\\t\\r\\n\\f]",I="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",q=I.replace("w","w#"),R="\\["+F+"*("+I+")(?:"+F+"*([*^$|!~]?=)"+F+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+q+"))|)"+F+"*\\]",U=":("+I+")(?:\\(("+"('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|"+"((?:\\\\.|[^\\\\()[\\]]|"+R+")*)|"+".*"+")\\)|)",z=new RegExp("^"+F+"+|((?:^|[^\\\\])(?:\\\\.)*)"+F+"+$","g"),W=new RegExp("^"+F+"*,"+F+"*"),X=new RegExp("^"+F+"*([>+~]|"+F+")"+F+"*"),V=new RegExp("="+F+"*([^\\]'\"]*?)"+F+"*\\]","g"),$=new RegExp(U),J=new RegExp("^"+q+"$"),K={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\.("+I+")"),TAG:new RegExp("^("+I.replace("w","w*")+")"),ATTR:new RegExp("^"+R),PSEUDO:new RegExp("^"+U),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+F+"*(even|odd|(([+-]|)(\\d*)n|)"+F+"*(?:([+-]|)"+F+"*(\\d+)|))"+F+"*\\)|)","i"),bool:new RegExp("^(?:"+j+")$","i"),needsContext:new RegExp("^"+F+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+F+"*((?:-\\d)?\\d*)"+F+"*\\)|)(?=[^-]|$)","i")},Q=/^(?:input|select|textarea|button)$/i,G=/^h\d$/i,Y=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,et=/[+~]/,tt=/'|\\/g,nt=new RegExp("\\\\([\\da-f]{1,6}"+F+"?|("+F+")|.)","ig"),rt=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,r&1023|56320)};try{P.apply(M=H.call(E.childNodes),E.childNodes),M[E.childNodes.length].nodeType}catch(it){P={apply:M.length?function(e,t){D.apply(e,H.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}n=st.support={},s=st.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?t.nodeName!=="HTML":!1},h=st.setDocument=function(e){var t,i=e?e.ownerDocument||e:E,o=i.defaultView;if(i===p||i.nodeType!==9||!i.documentElement)return p;p=i,d=i.documentElement,v=!s(i),o&&o!==o.top&&(o.addEventListener?o.addEventListener("unload",function(){h()},!1):o.attachEvent&&o.attachEvent("onunload",function(){h()})),n.attributes=at(function(e){return e.className="i",!e.getAttribute("className")}),n.getElementsByTagName=at(function(e){return e.appendChild(i.createComment("")),!e.getElementsByTagName("*").length}),n.getElementsByClassName=Y.test(i.getElementsByClassName)&&at(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",e.getElementsByClassName("i").length===2}),n.getById=at(function(e){return d.appendChild(e).id=w,!i.getElementsByName||!i.getElementsByName(w).length}),n.getById?(r.find.ID=function(e,t){if(typeof t.getElementById!==L&&v){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},r.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){return e.getAttribute("id")===t}}):(delete r.find.ID,r.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){var n=typeof e.getAttributeNode!==L&&e.getAttributeNode("id");return n&&n.value===t}}),r.find.TAG=n.getElementsByTagName?function(e,t){if(typeof t.getElementsByTagName!==L)return t.getElementsByTagName(e)}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if(e==="*"){while(n=s[i++])n.nodeType===1&&r.push(n);return r}return s},r.find.CLASS=n.getElementsByClassName&&function(e,t){if(typeof t.getElementsByClassName!==L&&v)return t.getElementsByClassName(e)},g=[],m=[];if(n.qsa=Y.test(i.querySelectorAll))at(function(e){e.innerHTML="<select msallowclip=''><option selected=''></option></select>",e.querySelectorAll("[msallowclip^='']").length&&m.push("[*^$]="+F+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||m.push("\\["+F+"*(?:value|"+j+")"),e.querySelectorAll(":checked").length||m.push(":checked")}),at(function(e){var t=i.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&m.push("name"+F+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||m.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),m.push(",.*:")});return(n.matchesSelector=Y.test(y=d.matches||d.webkitMatchesSelector||d.mozMatchesSelector||d.oMatchesSelector||d.msMatchesSelector))&&at(function(e){n.disconnectedMatch=y.call(e,"div"),y.call(e,"[s!='']:x"),g.push("!=",U)}),m=m.length&&new RegExp(m.join("|")),g=g.length&&new RegExp(g.join("|")),t=Y.test(d.compareDocumentPosition),b=t||Y.test(d.contains)?function(e,t){var n=e.nodeType===9?e.documentElement:e,r=t&&t.parentNode;return e===r||!!r&&r.nodeType===1&&!!(n.contains?n.contains(r):e.compareDocumentPosition&&e.compareDocumentPosition(r)&16)}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},k=t?function(e,t){if(e===t)return c=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r?r:(r=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,r&1||!n.sortDetached&&t.compareDocumentPosition(e)===r?e===i||e.ownerDocument===E&&b(E,e)?-1:t===i||t.ownerDocument===E&&b(E,t)?1:l?B.call(l,e)-B.call(l,t):0:r&4?-1:1)}:function(e,t){if(e===t)return c=!0,0;var n,r=0,s=e.parentNode,o=t.parentNode,u=[e],a=[t];if(!s||!o)return e===i?-1:t===i?1:s?-1:o?1:l?B.call(l,e)-B.call(l,t):0;if(s===o)return lt(e,t);n=e;while(n=n.parentNode)u.unshift(n);n=t;while(n=n.parentNode)a.unshift(n);while(u[r]===a[r])r++;return r?lt(u[r],a[r]):u[r]===E?-1:a[r]===E?1:0},i},st.matches=function(e,t){return st(e,null,null,t)},st.matchesSelector=function(e,t){(e.ownerDocument||e)!==p&&h(e),t=t.replace(V,"='$1']");if(n.matchesSelector&&v&&(!g||!g.test(t))&&(!m||!m.test(t)))try{var r=y.call(e,t);if(r||n.disconnectedMatch||e.document&&e.document.nodeType!==11)return r}catch(i){}return st(t,p,null,[e]).length>0},st.contains=function(e,t){return(e.ownerDocument||e)!==p&&h(e),b(e,t)},st.attr=function(e,t){(e.ownerDocument||e)!==p&&h(e);var i=r.attrHandle[t.toLowerCase()],s=i&&O.call(r.attrHandle,t.toLowerCase())?i(e,t,!v):undefined;return s!==undefined?s:n.attributes||!v?e.getAttribute(t):(s=e.getAttributeNode(t))&&s.specified?s.value:null},st.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},st.uniqueSort=function(e){var t,r=[],i=0,s=0;c=!n.detectDuplicates,l=!n.sortStable&&e.slice(0),e.sort(k);if(c){while(t=e[s++])t===e[s]&&(i=r.push(s));while(i--)e.splice(r[i],1)}return l=null,e},i=st.getText=function(e){var t,n="",r=0,s=e.nodeType;if(!s)while(t=e[r++])n+=i(t);else if(s===1||s===9||s===11){if(typeof e.textContent=="string")return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=i(e)}else if(s===3||s===4)return e.nodeValue;return n},r=st.selectors={cacheLength:50,createPseudo:ut,match:K,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(nt,rt),e[3]=(e[3]||e[4]||e[5]||"").replace(nt,rt),e[2]==="~="&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),e[1].slice(0,3)==="nth"?(e[3]||st.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*(e[3]==="even"||e[3]==="odd")),e[5]=+(e[7]+e[8]||e[3]==="odd")):e[3]&&st.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return K.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&$.test(n)&&(t=o(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(nt,rt).toLowerCase();return e==="*"?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=T[e+" "];return t||(t=new RegExp("(^|"+F+")"+e+"("+F+"|$)"))&&T(e,function(e){return t.test(typeof e.className=="string"&&e.className||typeof e.getAttribute!==L&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=st.attr(r,e);return i==null?t==="!=":t?(i+="",t==="="?i===n:t==="!="?i!==n:t==="^="?n&&i.indexOf(n)===0:t==="*="?n&&i.indexOf(n)>-1:t==="$="?n&&i.slice(-n.length)===n:t==="~="?(" "+i+" ").indexOf(n)>-1:t==="|="?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var s=e.slice(0,3)!=="nth",o=e.slice(-4)!=="last",u=t==="of-type";return r===1&&i===0?function(e){return!!e.parentNode}:function(t,n,a){var f,l,c,h,p,d,v=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=u&&t.nodeName.toLowerCase(),y=!a&&!u;if(m){if(s){while(v){c=t;while(c=c[v])if(u?c.nodeName.toLowerCase()===g:c.nodeType===1)return!1;d=v=e==="only"&&!d&&"nextSibling"}return!0}d=[o?m.firstChild:m.lastChild];if(o&&y){l=m[w]||(m[w]={}),f=l[e]||[],p=f[0]===S&&f[1],h=f[0]===S&&f[2],c=p&&m.childNodes[p];while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if(c.nodeType===1&&++h&&c===t){l[e]=[S,p,h];break}}else if(y&&(f=(t[w]||(t[w]={}))[e])&&f[0]===S)h=f[1];else while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if((u?c.nodeName.toLowerCase()===g:c.nodeType===1)&&++h){y&&((c[w]||(c[w]={}))[e]=[S,h]);if(c===t)break}return h-=i,h===r||h%r===0&&h/r>=0}}},PSEUDO:function(e,t){var n,i=r.pseudos[e]||r.setFilters[e.toLowerCase()]||st.error("unsupported pseudo: "+e);return i[w]?i(t):i.length>1?(n=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?ut(function(e,n){var r,s=i(e,t),o=s.length;while(o--)r=B.call(e,s[o]),e[r]=!(n[r]=s[o])}):function(e){return i(e,0,n)}):i}},pseudos:{not:ut(function(e){var t=[],n=[],r=u(e.replace(z,"$1"));return r[w]?ut(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)if(s=o[u])e[u]=!(t[u]=s)}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:ut(function(e){return function(t){return st(e,t).length>0}}),contains:ut(function(e){return function(t){return(t.textContent||t.innerText||i(t)).indexOf(e)>-1}}),lang:ut(function(e){return J.test(e||"")||st.error("unsupported lang: "+e),e=e.replace(nt,rt).toLowerCase(),function(t){var n;do if(n=v?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||n.indexOf(e+"-")===0;while((t=t.parentNode)&&t.nodeType===1);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===d},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&!!e.checked||t==="option"&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return G.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&e.type==="button"||t==="button"},text:function(e){var t;return e.nodeName.toLowerCase()==="input"&&e.type==="text"&&((t=e.getAttribute("type"))==null||t.toLowerCase()==="text")},first:pt(function(){return[0]}),last:pt(function(e,t){return[t-1]}),eq:pt(function(e,t,n){return[n<0?n+t:n]}),even:pt(function(e,t){var n=0;for(;n<t;n+=2)e.push(n);return e}),odd:pt(function(e,t){var n=1;for(;n<t;n+=2)e.push(n);return e}),lt:pt(function(e,t,n){var r=n<0?n+t:n;for(;--r>=0;)e.push(r);return e}),gt:pt(function(e,t,n){var r=n<0?n+t:n;for(;++r<t;)e.push(r);return e})}},r.pseudos.nth=r.pseudos.eq;for(t in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=ct(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=ht(t);return vt.prototype=r.filters=r.pseudos,r.setFilters=new vt,o=st.tokenize=function(e,t){var n,i,s,o,u,a,f,l=N[e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=r.preFilter;while(u){if(!n||(i=W.exec(u)))i&&(u=u.slice(i[0].length)||u),a.push(s=[]);n=!1;if(i=X.exec(u))n=i.shift(),s.push({value:n,type:i[0].replace(z," ")}),u=u.slice(n.length);for(o in r.filter)(i=K[o].exec(u))&&(!f[o]||(i=f[o](i)))&&(n=i.shift(),s.push({value:n,type:o,matches:i}),u=u.slice(n.length));if(!n)break}return t?u.length:u?st.error(e):N(e,a).slice(0)},u=st.compile=function(e,t){var n,r=[],i=[],s=C[e+" "];if(!s){t||(t=o(e)),n=t.length;while(n--)s=St(t[n]),s[w]?r.push(s):i.push(s);s=C(e,xt(i,r)),s.selector=e}return s},a=st.select=function(e,t,i,s){var a,f,l,c,h,p=typeof e=="function"&&e,d=!s&&o(e=p.selector||e);i=i||[];if(d.length===1){f=d[0]=d[0].slice(0);if(f.length>2&&(l=f[0]).type==="ID"&&n.getById&&t.nodeType===9&&v&&r.relative[f[1].type]){t=(r.find.ID(l.matches[0].replace(nt,rt),t)||[])[0];if(!t)return i;p&&(t=t.parentNode),e=e.slice(f.shift().value.length)}a=K.needsContext.test(e)?0:f.length;while(a--){l=f[a];if(r.relative[c=l.type])break;if(h=r.find[c])if(s=h(l.matches[0].replace(nt,rt),et.test(f[0].type)&&dt(t.parentNode)||t)){f.splice(a,1),e=s.length&&mt(f);if(!e)return P.apply(i,s),i;break}}}return(p||u(e,d))(s,t,!v,i,et.test(e)&&dt(t.parentNode)||t),i},n.sortStable=w.split("").sort(k).join("")===w,n.detectDuplicates=!!c,h(),n.sortDetached=at(function(e){return e.compareDocumentPosition(p.createElement("div"))&1}),at(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild.getAttribute("href")==="#"})||ft("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,t.toLowerCase()==="type"?1:2)}),(!n.attributes||!at(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),e.firstChild.getAttribute("value")===""}))&&ft("value",function(e,t,n){if(!n&&e.nodeName.toLowerCase()==="input")return e.defaultValue}),at(function(e){return e.getAttribute("disabled")==null})||ft(j,function(e,t,n){var r;if(!n)return e[t]===!0?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),st}(e);h.find=y,h.expr=y.selectors,h.expr[":"]=h.expr.pseudos,h.unique=y.uniqueSort,h.text=y.getText,h.isXMLDoc=y.isXML,h.contains=y.contains;var b=h.expr.match.needsContext,w=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,E=/^.[^:#\[\.,]*$/;h.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),t.length===1&&r.nodeType===1?h.find.matchesSelector(r,e)?[r]:[]:h.find.matches(e,h.grep(t,function(e){return e.nodeType===1}))},h.fn.extend({find:function(e){var t,n=[],r=this,i=r.length;if(typeof e!="string")return this.pushStack(h(e).filter(function(){for(t=0;t<i;t++)if(h.contains(r[t],this))return!0}));for(t=0;t<i;t++)h.find(e,r[t],n);return n=this.pushStack(i>1?h.unique(n):n),n.selector=this.selector?this.selector+" "+e:e,n},filter:function(e){return this.pushStack(S(this,e||[],!1))},not:function(e){return this.pushStack(S(this,e||[],!0))},is:function(e){return!!S(this,typeof e=="string"&&b.test(e)?h(e):e||[],!1).length}});var x,T=e.document,N=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,C=h.fn.init=function(e,t){var n,r;if(!e)return this;if(typeof e=="string"){e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3?n=[null,e,null]:n=N.exec(e);if(n&&(n[1]||!t)){if(n[1]){t=t instanceof h?t[0]:t,h.merge(this,h.parseHTML(n[1],t&&t.nodeType?t.ownerDocument||t:T,!0));if(w.test(n[1])&&h.isPlainObject(t))for(n in t)h.isFunction(this[n])?this[n](t[n]):this.attr(n,t[n]);return this}r=T.getElementById(n[2]);if(r&&r.parentNode){if(r.id!==n[2])return x.find(e);this.length=1,this[0]=r}return this.context=T,this.selector=e,this}return!t||t.jquery?(t||x).find(e):this.constructor(t).find(e)}return e.nodeType?(this.context=this[0]=e,this.length=1,this):h.isFunction(e)?typeof x.ready!="undefined"?x.ready(e):e(h):(e.selector!==undefined&&(this.selector=e.selector,this.context=e.context),h.makeArray(e,this))};C.prototype=h.fn,x=h(T);var k=/^(?:parents|prev(?:Until|All))/,L={children:!0,contents:!0,next:!0,prev:!0};h.extend({dir:function(e,t,n){var r=[],i=e[t];while(i&&i.nodeType!==9&&(n===undefined||i.nodeType!==1||!h(i).is(n)))i.nodeType===1&&r.push(i),i=i[t];return r},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)e.nodeType===1&&e!==t&&n.push(e);return n}}),h.fn.extend({has:function(e){var t,n=h(e,this),r=n.length;return this.filter(function(){for(t=0;t<r;t++)if(h.contains(this,n[t]))return!0})},closest:function(e,t){var n,r=0,i=this.length,s=[],o=b.test(e)||typeof e!="string"?h(e,t||this.context):0;for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(o?o.index(n)>-1:n.nodeType===1&&h.find.matchesSelector(n,e))){s.push(n);break}return this.pushStack(s.length>1?h.unique(s):s)},index:function(e){return e?typeof e=="string"?h.inArray(this[0],h(e)):h.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(h.unique(h.merge(this.get(),h(e,t))))},addBack:function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}}),h.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return h.dir(e,"parentNode")},parentsUntil:function(e,t,n){return h.dir(e,"parentNode",n)},next:function(e){return A(e,"nextSibling")},prev:function(e){return A(e,"previousSibling")},nextAll:function(e){return h.dir(e,"nextSibling")},prevAll:function(e){return h.dir(e,"previousSibling")},nextUntil:function(e,t,n){return h.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return h.dir(e,"previousSibling",n)},siblings:function(e){return h.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return h.sibling(e.firstChild)},contents:function(e){return h.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:h.merge([],e.childNodes)}},function(e,t){h.fn[e]=function(n,r){var i=h.map(this,t,n);return e.slice(-5)!=="Until"&&(r=n),r&&typeof r=="string"&&(i=h.filter(r,i)),this.length>1&&(L[e]||(i=h.unique(i)),k.test(e)&&(i=i.reverse())),this.pushStack(i)}});var O=/\S+/g,M={};h.Callbacks=function(e){e=typeof e=="string"?M[e]||_(e):h.extend({},e);var t,n,r,i,s,o,u=[],a=!e.once&&[],f=function(c){n=e.memory&&c,r=!0,s=o||0,o=0,i=u.length,t=!0;for(;u&&s<i;s++)if(u[s].apply(c[0],c[1])===!1&&e.stopOnFalse){n=!1;break}t=!1,u&&(a?a.length&&f(a.shift()):n?u=[]:l.disable())},l={add:function(){if(u){var r=u.length;(function s(t){h.each(t,function(t,n){var r=h.type(n);r==="function"?(!e.unique||!l.has(n))&&u.push(n):n&&n.length&&r!=="string"&&s(n)})})(arguments),t?i=u.length:n&&(o=r,f(n))}return this},remove:function(){return u&&h.each(arguments,function(e,n){var r;while((r=h.inArray(n,u,r))>-1)u.splice(r,1),t&&(r<=i&&i--,r<=s&&s--)}),this},has:function(e){return e?h.inArray(e,u)>-1:!!u&&!!u.length},empty:function(){return u=[],i=0,this},disable:function(){return u=a=n=undefined,this},disabled:function(){return!u},lock:function(){return a=undefined,n||l.disable(),this},locked:function(){return!a},fireWith:function(e,n){return u&&(!r||a)&&(n=n||[],n=[e,n.slice?n.slice():n],t?a.push(n):f(n)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!r}};return l},h.extend({Deferred:function(e){var t=[["resolve","done",h.Callbacks("once memory"),"resolved"],["reject","fail",h.Callbacks("once memory"),"rejected"],["notify","progress",h.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return h.Deferred(function(n){h.each(t,function(t,s){var o=h.isFunction(e[t])&&e[t];i[s[1]](function(){var e=o&&o.apply(this,arguments);e&&h.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[s[0]+"With"](this===r?n.promise():this,o?[e]:arguments)})}),e=null}).promise()},promise:function(e){return e!=null?h.extend(e,r):r}},i={};return r.pipe=r.then,h.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add,u&&o.add(function(){n=u},t[e^1][2].disable,t[2][2].lock),i[s[0]]=function(){return i[s[0]+"With"](this===i?r:this,arguments),this},i[s[0]+"With"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=r.call(arguments),i=n.length,s=i!==1||e&&h.isFunction(e.promise)?i:0,o=s===1?e:h.Deferred(),u=function(e,t,n){return function(i){t[e]=this,n[e]=arguments.length>1?r.call(arguments):i,n===a?o.notifyWith(t,n):--s||o.resolveWith(t,n)}},a,f,l;if(i>1){a=new Array(i),f=new Array(i),l=new Array(i);for(;t<i;t++)n[t]&&h.isFunction(n[t].promise)?n[t].promise().done(u(t,l,n)).fail(o.reject).progress(u(t,f,a)):--s}return s||o.resolveWith(l,n),o.promise()}});var D;h.fn.ready=function(e){return h.ready.promise().done(e),this},h.extend({isReady:!1,readyWait:1,holdReady:function(e){e?h.readyWait++:h.ready(!0)},ready:function(e){if(e===!0?--h.readyWait:h.isReady)return;if(!T.body)return setTimeout(h.ready);h.isReady=!0;if(e!==!0&&--h.readyWait>0)return;D.resolveWith(T,[h]),h.fn.triggerHandler&&(h(T).triggerHandler("ready"),h(T).off("ready"))}}),h.ready.promise=function(t){if(!D){D=h.Deferred();if(T.readyState==="complete")setTimeout(h.ready);else if(T.addEventListener)T.addEventListener("DOMContentLoaded",H,!1),e.addEventListener("load",H,!1);else{T.attachEvent("onreadystatechange",H),e.attachEvent("onload",H);var n=!1;try{n=e.frameElement==null&&T.documentElement}catch(r){}n&&n.doScroll&&function i(){if(!h.isReady){try{n.doScroll("left")}catch(e){return setTimeout(i,50)}P(),h.ready()}}()}}return D.promise(t)};var B=typeof undefined,j;for(j in h(l))break;l.ownLast=j!=="0",l.inlineBlockNeedsLayout=!1,h(function(){var e,t,n,r;n=T.getElementsByTagName("body")[0];if(!n||!n.style)return;t=T.createElement("div"),r=T.createElement("div"),r.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",n.appendChild(r).appendChild(t),typeof t.style.zoom!==B&&(t.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1",l.inlineBlockNeedsLayout=e=t.offsetWidth===3,e&&(n.style.zoom=1)),n.removeChild(r)}),function(){var e=T.createElement("div");if(l.deleteExpando==null){l.deleteExpando=!0;try{delete e.test}catch(t){l.deleteExpando=!1}}e=null}(),h.acceptData=function(e){var t=h.noData[(e.nodeName+" ").toLowerCase()],n=+e.nodeType||1;return n!==1&&n!==9?!1:!t||t!==!0&&e.getAttribute("classid")===t};var F=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,I=/([A-Z])/g;h.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(e){return e=e.nodeType?h.cache[e[h.expando]]:e[h.expando],!!e&&!R(e)},data:function(e,t,n){return U(e,t,n)},removeData:function(e,t){return z(e,t)},_data:function(e,t,n){return U(e,t,n,!0)},_removeData:function(e,t){return z(e,t,!0)}}),h.fn.extend({data:function(e,t){var n,r,i,s=this[0],o=s&&s.attributes;if(e===undefined){if(this.length){i=h.data(s);if(s.nodeType===1&&!h._data(s,"parsedAttrs")){n=o.length;while(n--)o[n]&&(r=o[n].name,r.indexOf("data-")===0&&(r=h.camelCase(r.slice(5)),q(s,r,i[r])));h._data(s,"parsedAttrs",!0)}}return i}return typeof e=="object"?this.each(function(){h.data(this,e)}):arguments.length>1?this.each(function(){h.data(this,e,t)}):s?q(s,e,h.data(s,e)):undefined},removeData:function(e){return this.each(function(){h.removeData(this,e)})}}),h.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=h._data(e,t),n&&(!r||h.isArray(n)?r=h._data(e,t,h.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=h.queue(e,t),r=n.length,i=n.shift(),s=h._queueHooks(e,t),o=function(){h.dequeue(e,t)};i==="inprogress"&&(i=n.shift(),r--),i&&(t==="fx"&&n.unshift("inprogress"),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return h._data(e,n)||h._data(e,n,{empty:h.Callbacks("once memory").add(function(){h._removeData(e,t+"queue"),h._removeData(e,n)})})}}),h.fn.extend({queue:function(e,t){var n=2;return typeof e!="string"&&(t=e,e="fx",n--),arguments.length<n?h.queue(this[0],e):t===undefined?this:this.each(function(){var n=h.queue(this,e,t);h._queueHooks(this,e),e==="fx"&&n[0]!=="inprogress"&&h.dequeue(this,e)})},dequeue:function(e){return this.each(function(){h.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=h.Deferred(),s=this,o=this.length,u=function(){--r||i.resolveWith(s,[s])};typeof e!="string"&&(t=e,e=undefined),e=e||"fx";while(o--)n=h._data(s[o],e+"queueHooks"),n&&n.empty&&(r++,n.empty.add(u));return u(),i.promise(t)}});var W=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,X=["Top","Right","Bottom","Left"],V=function(e,t){return e=t||e,h.css(e,"display")==="none"||!h.contains(e.ownerDocument,e)},$=h.access=function(e,t,n,r,i,s,o){var u=0,a=e.length,f=n==null;if(h.type(n)==="object"){i=!0;for(u in n)h.access(e,t,u,n[u],!0,s,o)}else if(r!==undefined){i=!0,h.isFunction(r)||(o=!0),f&&(o?(t.call(e,r),t=null):(f=t,t=function(e,t,n){return f.call(h(e),n)}));if(t)for(;u<a;u++)t(e[u],n,o?r:r.call(e[u],u,t(e[u],n)))}return i?e:f?t.call(e):a?t(e[0],n):s},J=/^(?:checkbox|radio)$/i;(function(){var e=T.createElement("input"),t=T.createElement("div"),n=T.createDocumentFragment();t.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",l.leadingWhitespace=t.firstChild.nodeType===3,l.tbody=!t.getElementsByTagName("tbody").length,l.htmlSerialize=!!t.getElementsByTagName("link").length,l.html5Clone=T.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",e.type="checkbox",e.checked=!0,n.appendChild(e),l.appendChecked=e.checked,t.innerHTML="<textarea>x</textarea>",l.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue,n.appendChild(t),t.innerHTML="<input type='radio' checked='checked' name='t'/>",l.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,l.noCloneEvent=!0,t.attachEvent&&(t.attachEvent("onclick",function(){l.noCloneEvent=!1}),t.cloneNode(!0).click());if(l.deleteExpando==null){l.deleteExpando=!0;try{delete t.test}catch(r){l.deleteExpando=!1}}})(),function(){var t,n,r=T.createElement("div");for(t in{submit:!0,change:!0,focusin:!0})n="on"+t,(l[t+"Bubbles"]=n in e)||(r.setAttribute(n,"t"),l[t+"Bubbles"]=r.attributes[n].expando===!1);r=null}();var K=/^(?:input|select|textarea)$/i,Q=/^key/,G=/^(?:mouse|pointer|contextmenu)|click/,Y=/^(?:focusinfocus|focusoutblur)$/,Z=/^([^.]*)(?:\.(.+)|)$/;h.event={global:{},add:function(e,t,n,r,i){var s,o,u,a,f,l,c,p,d,v,m,g=h._data(e);if(!g)return;n.handler&&(a=n,n=a.handler,i=a.selector),n.guid||(n.guid=h.guid++),(o=g.events)||(o=g.events={}),(l=g.handle)||(l=g.handle=function(e){return typeof h===B||!!e&&h.event.triggered===e.type?undefined:h.event.dispatch.apply(l.elem,arguments)},l.elem=e),t=(t||"").match(O)||[""],u=t.length;while(u--){s=Z.exec(t[u])||[],d=m=s[1],v=(s[2]||"").split(".").sort();if(!d)continue;f=h.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=h.event.special[d]||{},c=h.extend({type:d,origType:m,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&h.expr.match.needsContext.test(i),namespace:v.join(".")},a);if(!(p=o[d])){p=o[d]=[],p.delegateCount=0;if(!f.setup||f.setup.call(e,r,v,l)===!1)e.addEventListener?e.addEventListener(d,l,!1):e.attachEvent&&e.attachEvent("on"+d,l)}f.add&&(f.add.call(e,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),h.event.global[d]=!0}e=null},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,p,d,v,m,g=h.hasData(e)&&h._data(e);if(!g||!(l=g.events))return;t=(t||"").match(O)||[""],f=t.length;while(f--){u=Z.exec(t[f])||[],d=m=u[1],v=(u[2]||"").split(".").sort();if(!d){for(d in l)h.event.remove(e,d+t[f],n,r,!0);continue}c=h.event.special[d]||{},d=(r?c.delegateType:c.bindType)||d,p=l[d]||[],u=u[2]&&new RegExp("(^|\\.)"+v.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=s=p.length;while(s--)o=p[s],(i||m===o.origType)&&(!n||n.guid===o.guid)&&(!u||u.test(o.namespace))&&(!r||r===o.selector||r==="**"&&o.selector)&&(p.splice(s,1),o.selector&&p.delegateCount--,c.remove&&c.remove.call(e,o));a&&!p.length&&((!c.teardown||c.teardown.call(e,v,g.handle)===!1)&&h.removeEvent(e,d,g.handle),delete l[d])}h.isEmptyObject(l)&&(delete g.handle,h._removeData(e,"events"))},trigger:function(t,n,r,i){var s,o,u,a,l,c,p,d=[r||T],v=f.call(t,"type")?t.type:t,m=f.call(t,"namespace")?t.namespace.split("."):[];u=c=r=r||T;if(r.nodeType===3||r.nodeType===8)return;if(Y.test(v+h.event.triggered))return;v.indexOf(".")>=0&&(m=v.split("."),v=m.shift(),m.sort()),o=v.indexOf(":")<0&&"on"+v,t=t[h.expando]?t:new h.Event(v,typeof t=="object"&&t),t.isTrigger=i?2:3,t.namespace=m.join("."),t.namespace_re=t.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=undefined,t.target||(t.target=r),n=n==null?[t]:h.makeArray(n,[t]),l=h.event.special[v]||{};if(!i&&l.trigger&&l.trigger.apply(r,n)===!1)return;if(!i&&!l.noBubble&&!h.isWindow(r)){a=l.delegateType||v,Y.test(a+v)||(u=u.parentNode);for(;u;u=u.parentNode)d.push(u),c=u;c===(r.ownerDocument||T)&&d.push(c.defaultView||c.parentWindow||e)}p=0;while((u=d[p++])&&!t.isPropagationStopped())t.type=p>1?a:l.bindType||v,s=(h._data(u,"events")||{})[t.type]&&h._data(u,"handle"),s&&s.apply(u,n),s=o&&u[o],s&&s.apply&&h.acceptData(u)&&(t.result=s.apply(u,n),t.result===!1&&t.preventDefault());t.type=v;if(!i&&!t.isDefaultPrevented()&&(!l._default||l._default.apply(d.pop(),n)===!1)&&h.acceptData(r)&&o&&r[v]&&!h.isWindow(r)){c=r[o],c&&(r[o]=null),h.event.triggered=v;try{r[v]()}catch(g){}h.event.triggered=undefined,c&&(r[o]=c)}return t.result},dispatch:function(e){e=h.event.fix(e);var t,n,i,s,o,u=[],a=r.call(arguments),f=(h._data(this,"events")||{})[e.type]||[],l=h.event.special[e.type]||{};a[0]=e,e.delegateTarget=this;if(l.preDispatch&&l.preDispatch.call(this,e)===!1)return;u=h.event.handlers.call(this,e,f),t=0;while((s=u[t++])&&!e.isPropagationStopped()){e.currentTarget=s.elem,o=0;while((i=s.handlers[o++])&&!e.isImmediatePropagationStopped())if(!e.namespace_re||e.namespace_re.test(i.namespace))e.handleObj=i,e.data=i.data,n=((h.event.special[i.origType]||{}).handle||i.handler).apply(s.elem,a),n!==undefined&&(e.result=n)===!1&&(e.preventDefault(),e.stopPropagation())}return l.postDispatch&&l.postDispatch.call(this,e),e.result},handlers:function(e,t){var n,r,i,s,o=[],u=t.delegateCount,a=e.target;if(u&&a.nodeType&&(!e.button||e.type!=="click"))for(;a!=this;a=a.parentNode||this)if(a.nodeType===1&&(a.disabled!==!0||e.type!=="click")){i=[];for(s=0;s<u;s++)r=t[s],n=r.selector+" ",i[n]===undefined&&(i[n]=r.needsContext?h(n,this).index(a)>=0:h.find(n,this,null,[a]).length),i[n]&&i.push(r);i.length&&o.push({elem:a,handlers:i})}return u<t.length&&o.push({elem:this,handlers:t.slice(u)}),o},fix:function(e){if(e[h.expando])return e;var t,n,r,i=e.type,s=e,o=this.fixHooks[i];o||(this.fixHooks[i]=o=G.test(i)?this.mouseHooks:Q.test(i)?this.keyHooks:{}),r=o.props?this.props.concat(o.props):this.props,e=new h.Event(s),t=r.length;while(t--)n=r[t],e[n]=s[n];return e.target||(e.target=s.srcElement||T),e.target.nodeType===3&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,o.filter?o.filter(e,s):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return e.which==null&&(e.which=t.charCode!=null?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,r,i,s=t.button,o=t.fromElement;return e.pageX==null&&t.clientX!=null&&(r=e.target.ownerDocument||T,i=r.documentElement,n=r.body,e.pageX=t.clientX+(i&&i.scrollLeft||n&&n.scrollLeft||0)-(i&&i.clientLeft||n&&n.clientLeft||0),e.pageY=t.clientY+(i&&i.scrollTop||n&&n.scrollTop||0)-(i&&i.clientTop||n&&n.clientTop||0)),!e.relatedTarget&&o&&(e.relatedTarget=o===e.target?t.toElement:o),!e.which&&s!==undefined&&(e.which=s&1?1:s&2?3:s&4?2:0),e}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==nt()&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){if(this===nt()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if(h.nodeName(this,"input")&&this.type==="checkbox"&&this.click)return this.click(),!1},_default:function(e){return h.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){e.result!==undefined&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=h.extend(new h.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?h.event.trigger(i,null,t):h.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},h.removeEvent=T.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]===B&&(e[r]=null),e.detachEvent(r,n))},h.Event=function(e,t){if(!(this instanceof h.Event))return new h.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.defaultPrevented===undefined&&e.returnValue===!1?et:tt):this.type=e,t&&h.extend(this,t),this.timeStamp=e&&e.timeStamp||h.now(),this[h.expando]=!0},h.Event.prototype={isDefaultPrevented:tt,isPropagationStopped:tt,isImmediatePropagationStopped:tt,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=et;if(!e)return;e.preventDefault?e.preventDefault():e.returnValue=!1},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=et;if(!e)return;e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=et,e&&e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()}},h.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){h.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj;if(!i||i!==r&&!h.contains(r,i))e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t;return n}}}),l.submitBubbles||(h.event.special.submit={setup:function(){if(h.nodeName(this,"form"))return!1;h.event.add(this,"click._submit keypress._submit",function(e){var t=e.target,n=h.nodeName(t,"input")||h.nodeName(t,"button")?t.form:undefined;n&&!h._data(n,"submitBubbles")&&(h.event.add(n,"submit._submit",function(e){e._submit_bubble=!0}),h._data(n,"submitBubbles",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&h.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){if(h.nodeName(this,"form"))return!1;h.event.remove(this,"._submit")}}),l.changeBubbles||(h.event.special.change={setup:function(){if(K.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")h.event.add(this,"propertychange._change",function(e){e.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),h.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),h.event.simulate("change",this,e,!0)});return!1}h.event.add(this,"beforeactivate._change",function(e){var t=e.target;K.test(t.nodeName)&&!h._data(t,"changeBubbles")&&(h.event.add(t,"change._change",function(e){this.parentNode&&!e.isSimulated&&!e.isTrigger&&h.event.simulate("change",this.parentNode,e,!0)}),h._data(t,"changeBubbles",!0))})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||t.type!=="radio"&&t.type!=="checkbox")return e.handleObj.handler.apply(this,arguments)},teardown:function(){return h.event.remove(this,"._change"),!K.test(this.nodeName)}}),l.focusinBubbles||h.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){h.event.simulate(t,e.target,h.event.fix(e),!0)};h.event.special[t]={setup:function(){var r=this.ownerDocument||this,i=h._data(r,t);i||r.addEventListener(e,n,!0),h._data(r,t,(i||0)+1)},teardown:function(){var r=this.ownerDocument||this,i=h._data(r,t)-1;i?h._data(r,t,i):(r.removeEventListener(e,n,!0),h._removeData(r,t))}}}),h.fn.extend({on:function(e,t,n,r,i){var s,o;if(typeof e=="object"){typeof t!="string"&&(n=n||t,t=undefined);for(s in e)this.on(s,t,n,e[s],i);return this}n==null&&r==null?(r=t,n=t=undefined):r==null&&(typeof t=="string"?(r=n,n=undefined):(r=n,n=t,t=undefined));if(r===!1)r=tt;else if(!r)return this;return i===1&&(o=r,r=function(e){return h().off(e),o.apply(this,arguments)},r.guid=o.guid||(o.guid=h.guid++)),this.each(function(){h.event.add(this,e,r,n,t)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,h(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if(typeof e=="object"){for(i in e)this.off(i,t,e[i]);return this}if(t===!1||typeof t=="function")n=t,t=undefined;return n===!1&&(n=tt),this.each(function(){h.event.remove(this,e,n,t)})},trigger:function(e,t){return this.each(function(){h.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return h.event.trigger(e,t,n,!0)}});var it="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",st=/ jQuery\d+="(?:null|\d+)"/g,ot=new RegExp("<(?:"+it+")[\\s/>]","i"),ut=/^\s+/,at=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,ft=/<([\w:]+)/,lt=/<tbody/i,ct=/<|&#?\w+;/,ht=/<(?:script|style|link)/i,pt=/checked\s*(?:[^=]|=\s*.checked.)/i,dt=/^$|\/(?:java|ecma)script/i,vt=/^true\/(.*)/,mt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,gt={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:l.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},yt=rt(T),bt=yt.appendChild(T.createElement("div"));gt.optgroup=gt.option,gt.tbody=gt.tfoot=gt.colgroup=gt.caption=gt.thead,gt.th=gt.td,h.extend({clone:function(e,t,n){var r,i,s,o,u,a=h.contains(e.ownerDocument,e);l.html5Clone||h.isXMLDoc(e)||!ot.test("<"+e.nodeName+">")?s=e.cloneNode(!0):(bt.innerHTML=e.outerHTML,bt.removeChild(s=bt.firstChild));if((!l.noCloneEvent||!l.noCloneChecked)&&(e.nodeType===1||e.nodeType===11)&&!h.isXMLDoc(e)){r=wt(s),u=wt(e);for(o=0;(i=u[o])!=null;++o)r[o]&&kt(i,r[o])}if(t)if(n){u=u||wt(e),r=r||wt(s);for(o=0;(i=u[o])!=null;o++)Ct(i,r[o])}else Ct(e,s);return r=wt(s,"script"),r.length>0&&Nt(r,!a&&wt(e,"script")),r=u=i=null,s},buildFragment:function(e,t,n,r){var i,s,o,u,a,f,c,p=e.length,d=rt(t),v=[],m=0;for(;m<p;m++){s=e[m];if(s||s===0)if(h.type(s)==="object")h.merge(v,s.nodeType?[s]:s);else if(!ct.test(s))v.push(t.createTextNode(s));else{u=u||d.appendChild(t.createElement("div")),a=(ft.exec(s)||["",""])[1].toLowerCase(),c=gt[a]||gt._default,u.innerHTML=c[1]+s.replace(at,"<$1></$2>")+c[2],i=c[0];while(i--)u=u.lastChild;!l.leadingWhitespace&&ut.test(s)&&v.push(t.createTextNode(ut.exec(s)[0]));if(!l.tbody){s=a==="table"&&!lt.test(s)?u.firstChild:c[1]==="<table>"&&!lt.test(s)?u:0,i=s&&s.childNodes.length;while(i--)h.nodeName(f=s.childNodes[i],"tbody")&&!f.childNodes.length&&s.removeChild(f)}h.merge(v,u.childNodes),u.textContent="";while(u.firstChild)u.removeChild(u.firstChild);u=d.lastChild}}u&&d.removeChild(u),l.appendChecked||h.grep(wt(v,"input"),Et),m=0;while(s=v[m++]){if(r&&h.inArray(s,r)!==-1)continue;o=h.contains(s.ownerDocument,s),u=wt(d.appendChild(s),"script"),o&&Nt(u);if(n){i=0;while(s=u[i++])dt.test(s.type||"")&&n.push(s)}}return u=null,d},cleanData:function(e,t){var r,i,s,o,u=0,a=h.expando,f=h.cache,c=l.deleteExpando,p=h.event.special;for(;(r=e[u])!=null;u++)if(t||h.acceptData(r)){s=r[a],o=s&&f[s];if(o){if(o.events)for(i in o.events)p[i]?h.event.remove(r,i):h.removeEvent(r,i,o.handle);f[s]&&(delete f[s],c?delete r[a]:typeof r.removeAttribute!==B?r.removeAttribute(a):r[a]=null,n.push(s))}}}}),h.fn.extend({text:function(e){return $(this,function(e){return e===undefined?h.text(this):this.empty().append((this[0]&&this[0].ownerDocument||T).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var t=St(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var t=St(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){var n,r=e?h.filter(e,this):this,i=0;for(;(n=r[i])!=null;i++)!t&&n.nodeType===1&&h.cleanData(wt(n)),n.parentNode&&(t&&h.contains(n.ownerDocument,n)&&Nt(wt(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){var e,t=0;for(;(e=this[t])!=null;t++){e.nodeType===1&&h.cleanData(wt(e,!1));while(e.firstChild)e.removeChild(e.firstChild);e.options&&h.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=e==null?!1:e,t=t==null?e:t,this.map(function(){return h.clone(this,e,t)})},html:function(e){return $(this,function(e){var t=this[0]||{},n=0,r=this.length;if(e===undefined)return t.nodeType===1?t.innerHTML.replace(st,""):undefined;if(typeof e=="string"&&!ht.test(e)&&(l.htmlSerialize||!ot.test(e))&&(l.leadingWhitespace||!ut.test(e))&&!gt[(ft.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(at,"<$1></$2>");try{for(;n<r;n++)t=this[n]||{},t.nodeType===1&&(h.cleanData(wt(t,!1)),t.innerHTML=e);t=0}catch(i){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=arguments[0];return this.domManip(arguments,function(t){e=this.parentNode,h.cleanData(wt(this)),e&&e.replaceChild(t,this)}),e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t){e=i.apply([],e);var n,r,s,o,u,a,f=0,c=this.length,p=this,d=c-1,v=e[0],m=h.isFunction(v);if(m||c>1&&typeof v=="string"&&!l.checkClone&&pt.test(v))return this.each(function(n){var r=p.eq(n);m&&(e[0]=v.call(this,n,r.html())),r.domManip(e,t)});if(c){a=h.buildFragment(e,this[0].ownerDocument,!1,this),n=a.firstChild,a.childNodes.length===1&&(a=n);if(n){o=h.map(wt(a,"script"),xt),s=o.length;for(;f<c;f++)r=a,f!==d&&(r=h.clone(r,!0,!0),s&&h.merge(o,wt(r,"script"))),t.call(this[f],r,f);if(s){u=o[o.length-1].ownerDocument,h.map(o,Tt);for(f=0;f<s;f++)r=o[f],dt.test(r.type||"")&&!h._data(r,"globalEval")&&h.contains(u,r)&&(r.src?h._evalUrl&&h._evalUrl(r.src):h.globalEval((r.text||r.textContent||r.innerHTML||"").replace(mt,"")))}a=n=null}}return this}}),h.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){h.fn[e]=function(e){var n,r=0,i=[],o=h(e),u=o.length-1;for(;r<=u;r++)n=r===u?this:this.clone(!0),h(o[r])[t](n),s.apply(i,n.get());return this.pushStack(i)}});var Lt,At={};(function(){var e;l.shrinkWrapBlocks=function(){if(e!=null)return e;e=!1;var t,n,r;n=T.getElementsByTagName("body")[0];if(!n||!n.style)return;return t=T.createElement("div"),r=T.createElement("div"),r.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",n.appendChild(r).appendChild(t),typeof t.style.zoom!==B&&(t.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1",t.appendChild(T.createElement("div")).style.width="5px",e=t.offsetWidth!==3),n.removeChild(r),e}})();var _t=/^margin/,Dt=new RegExp("^("+W+")(?!px)[a-z%]+$","i"),Pt,Ht,Bt=/^(top|right|bottom|left)$/;e.getComputedStyle?(Pt=function(e){return e.ownerDocument.defaultView.getComputedStyle(e,null)},Ht=function(e,t,n){var r,i,s,o,u=e.style;return n=n||Pt(e),o=n?n.getPropertyValue(t)||n[t]:undefined,n&&(o===""&&!h.contains(e.ownerDocument,e)&&(o=h.style(e,t)),Dt.test(o)&&_t.test(t)&&(r=u.width,i=u.minWidth,s=u.maxWidth,u.minWidth=u.maxWidth=u.width=o,o=n.width,u.width=r,u.minWidth=i,u.maxWidth=s)),o===undefined?o:o+""}):T.documentElement.currentStyle&&(Pt=function(e){return e.currentStyle},Ht=function(e,t,n){var r,i,s,o,u=e.style;return n=n||Pt(e),o=n?n[t]:undefined,o==null&&u&&u[t]&&(o=u[t]),Dt.test(o)&&!Bt.test(t)&&(r=u.left,i=e.runtimeStyle,s=i&&i.left,s&&(i.left=e.currentStyle.left),u.left=t==="fontSize"?"1em":o,o=u.pixelLeft+"px",u.left=r,s&&(i.left=s)),o===undefined?o:o+""||"auto"}),function(){function a(){var t,n,r,a;n=T.getElementsByTagName("body")[0];if(!n||!n.style)return;t=T.createElement("div"),r=T.createElement("div"),r.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",n.appendChild(r).appendChild(t),t.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",i=s=!1,u=!0,e.getComputedStyle&&(i=(e.getComputedStyle(t,null)||{}).top!=="1%",s=(e.getComputedStyle(t,null)||{width:"4px"}).width==="4px",a=t.appendChild(T.createElement("div")),a.style.cssText=t.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",a.style.marginRight=a.style.width="0",t.style.width="1px",u=!parseFloat((e.getComputedStyle(a,null)||{}).marginRight)),t.innerHTML="<table><tr><td></td><td>t</td></tr></table>",a=t.getElementsByTagName("td"),a[0].style.cssText="margin:0;border:0;padding:0;display:none",o=a[0].offsetHeight===0,o&&(a[0].style.display="",a[1].style.display="none",o=a[0].offsetHeight===0),n.removeChild(r)}var t,n,r,i,s,o,u;t=T.createElement("div"),t.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",r=t.getElementsByTagName("a")[0],n=r&&r.style;if(!n)return;n.cssText="float:left;opacity:.5",l.opacity=n.opacity==="0.5",l.cssFloat=!!n.cssFloat,t.style.backgroundClip="content-box",t.cloneNode(!0).style.backgroundClip="",l.clearCloneStyle=t.style.backgroundClip==="content-box",l.boxSizing=n.boxSizing===""||n.MozBoxSizing===""||n.WebkitBoxSizing==="",h.extend(l,{reliableHiddenOffsets:function(){return o==null&&a(),o},boxSizingReliable:function(){return s==null&&a(),s},pixelPosition:function(){return i==null&&a(),i},reliableMarginRight:function(){return u==null&&a(),u}})}(),h.swap=function(e,t,n,r){var i,s,o={};for(s in t)o[s]=e.style[s],e.style[s]=t[s];i=n.apply(e,r||[]);for(s in t)e.style[s]=o[s];return i};var Ft=/alpha\([^)]*\)/i,It=/opacity\s*=\s*([^)]*)/,qt=/^(none|table(?!-c[ea]).+)/,Rt=new RegExp("^("+W+")(.*)$","i"),Ut=new RegExp("^([+-])=("+W+")","i"),zt={position:"absolute",visibility:"hidden",display:"block"},Wt={letterSpacing:"0",fontWeight:"400"},Xt=["Webkit","O","Moz","ms"];h.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Ht(e,"opacity");return n===""?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":l.cssFloat?"cssFloat":"styleFloat"},style:function(e,t,n,r){if(!e||e.nodeType===3||e.nodeType===8||!e.style)return;var i,s,o,u=h.camelCase(t),a=e.style;t=h.cssProps[u]||(h.cssProps[u]=Vt(a,u)),o=h.cssHooks[t]||h.cssHooks[u];if(n===undefined)return o&&"get"in o&&(i=o.get(e,!1,r))!==undefined?i:a[t];s=typeof n,s==="string"&&(i=Ut.exec(n))&&(n=(i[1]+1)*i[2]+parseFloat(h.css(e,t)),s="number");if(n==null||n!==n)return;s==="number"&&!h.cssNumber[u]&&(n+="px"),!l.clearCloneStyle&&n===""&&t.indexOf("background")===0&&(a[t]="inherit");if(!o||!("set"in o)||(n=o.set(e,n,r))!==undefined)try{a[t]=n}catch(f){}},css:function(e,t,n,r){var i,s,o,u=h.camelCase(t);return t=h.cssProps[u]||(h.cssProps[u]=Vt(e.style,u)),o=h.cssHooks[t]||h.cssHooks[u],o&&"get"in o&&(s=o.get(e,!0,n)),s===undefined&&(s=Ht(e,t,r)),s==="normal"&&t in Wt&&(s=Wt[t]),n===""||n?(i=parseFloat(s),n===!0||h.isNumeric(i)?i||0:s):s}}),h.each(["height","width"],function(e,t){h.cssHooks[t]={get:function(e,n,r){if(n)return qt.test(h.css(e,"display"))&&e.offsetWidth===0?h.swap(e,zt,function(){return Qt(e,t,r)}):Qt(e,t,r)},set:function(e,n,r){var i=r&&Pt(e);return Jt(e,n,r?Kt(e,t,r,l.boxSizing&&h.css(e,"boxSizing",!1,i)==="border-box",i):0)}}}),l.opacity||(h.cssHooks.opacity={get:function(e,t){return It.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=h.isNumeric(t)?"alpha(opacity="+t*100+")":"",s=r&&r.filter||n.filter||"";n.zoom=1;if((t>=1||t==="")&&h.trim(s.replace(Ft,""))===""&&n.removeAttribute){n.removeAttribute("filter");if(t===""||r&&!r.filter)return}n.filter=Ft.test(s)?s.replace(Ft,i):s+" "+i}}),h.cssHooks.marginRight=jt(l.reliableMarginRight,function(e,t){if(t)return h.swap(e,{display:"inline-block"},Ht,[e,"marginRight"])}),h.each({margin:"",padding:"",border:"Width"},function(e,t){h.cssHooks[e+t]={expand:function(n){var r=0,i={},s=typeof n=="string"?n.split(" "):[n];for(;r<4;r++)i[e+X[r]+t]=s[r]||s[r-2]||s[0];return i}},_t.test(e)||(h.cssHooks[e+t].set=Jt)}),h.fn.extend({css:function(e,t){return $(this,function(e,t,n){var r,i,s={},o=0;if(h.isArray(t)){r=Pt(e),i=t.length;for(;o<i;o++)s[t[o]]=h.css(e,t[o],!1,r);return s}return n!==undefined?h.style(e,t,n):h.css(e,t)},e,t,arguments.length>1)},show:function(){return $t(this,!0)},hide:function(){return $t(this)},toggle:function(e){return typeof e=="boolean"?e?this.show():this.hide():this.each(function(){V(this)?h(this).show():h(this).hide()})}}),h.Tween=Gt,Gt.prototype={constructor:Gt,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(h.cssNumber[n]?"":"px")},cur:function(){var e=Gt.propHooks[this.prop];return e&&e.get?e.get(this):Gt.propHooks._default.get(this)},run:function(e){var t,n=Gt.propHooks[this.prop];return this.options.duration?this.pos=t=h.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Gt.propHooks._default.set(this),this}},Gt.prototype.init.prototype=Gt.prototype,Gt.propHooks={_default:{get:function(e){var t;return e.elem[e.prop]==null||!!e.elem.style&&e.elem.style[e.prop]!=null?(t=h.css(e.elem,e.prop,""),!t||t==="auto"?0:t):e.elem[e.prop]},set:function(e){h.fx.step[e.prop]?h.fx.step[e.prop](e):e.elem.style&&(e.elem.style[h.cssProps[e.prop]]!=null||h.cssHooks[e.prop])?h.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},Gt.propHooks.scrollTop=Gt.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},h.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},h.fx=Gt.prototype.init,h.fx.step={};var Yt,Zt,en=/^(?:toggle|show|hide)$/,tn=new RegExp("^(?:([+-])=|)("+W+")([a-z%]*)$","i"),nn=/queueHooks$/,rn=[fn],sn={"*":[function(e,t){var n=this.createTween(e,t),r=n.cur(),i=tn.exec(t),s=i&&i[3]||(h.cssNumber[e]?"":"px"),o=(h.cssNumber[e]||s!=="px"&&+r)&&tn.exec(h.css(n.elem,e)),u=1,a=20;if(o&&o[3]!==s){s=s||o[3],i=i||[],o=+r||1;do u=u||".5",o/=u,h.style(n.elem,e,o+s);while(u!==(u=n.cur()/r)&&u!==1&&--a)}return i&&(o=n.start=+o||+r||0,n.unit=s,n.end=i[1]?o+(i[1]+1)*i[2]:+i[2]),n}]};h.Animation=h.extend(cn,{tweener:function(e,t){h.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;r<i;r++)n=e[r],sn[n]=sn[n]||[],sn[n].unshift(t)},prefilter:function(e,t){t?rn.unshift(e):rn.push(e)}}),h.speed=function(e,t,n){var r=e&&typeof e=="object"?h.extend({},e):{complete:n||!n&&t||h.isFunction(e)&&e,duration:e,easing:n&&t||t&&!h.isFunction(t)&&t};r.duration=h.fx.off?0:typeof r.duration=="number"?r.duration:r.duration in h.fx.speeds?h.fx.speeds[r.duration]:h.fx.speeds._default;if(r.queue==null||r.queue===!0)r.queue="fx";return r.old=r.complete,r.complete=function(){h.isFunction(r.old)&&r.old.call(this),r.queue&&h.dequeue(this,r.queue)},r},h.fn.extend({fadeTo:function(e,t,n,r){return this.filter(V).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=h.isEmptyObject(e),s=h.speed(t,n,r),o=function(){var t=cn(this,h.extend({},e),s);(i||h._data(this,"finish"))&&t.stop(!0)};return o.finish=o,i||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return typeof e!="string"&&(n=t,t=e,e=undefined),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=e!=null&&e+"queueHooks",s=h.timers,o=h._data(this);if(i)o[i]&&o[i].stop&&r(o[i]);else for(i in o)o[i]&&o[i].stop&&nn.test(i)&&r(o[i]);for(i=s.length;i--;)s[i].elem===this&&(e==null||s[i].queue===e)&&(s[i].anim.stop(n),t=!1,s.splice(i,1));(t||!n)&&h.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=h._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],s=h.timers,o=r?r.length:0;n.finish=!0,h.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0);for(t=s.length;t--;)s[t].elem===this&&s[t].queue===e&&(s[t].anim.stop(!0),s.splice(t,1));for(t=0;t<o;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),h.each(["toggle","show","hide"],function(e,t){var n=h.fn[t];h.fn[t]=function(e,r,i){return e==null||typeof e=="boolean"?n.apply(this,arguments):this.animate(un(t,!0),e,r,i)}}),h.each({slideDown:un("show"),slideUp:un("hide"),slideToggle:un("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){h.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),h.timers=[],h.fx.tick=function(){var e,t=h.timers,n=0;Yt=h.now();for(;n<t.length;n++)e=t[n],!e()&&t[n]===e&&t.splice(n--,1);t.length||h.fx.stop(),Yt=undefined},h.fx.timer=function(e){h.timers.push(e),e()?h.fx.start():h.timers.pop()},h.fx.interval=13,h.fx.start=function(){Zt||(Zt=setInterval(h.fx.tick,h.fx.interval))},h.fx.stop=function(){clearInterval(Zt),Zt=null},h.fx.speeds={slow:600,fast:200,_default:400},h.fn.delay=function(e,t){return e=h.fx?h.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},function(){var e,t,n,r,i;t=T.createElement("div"),t.setAttribute("className","t"),t.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",r=t.getElementsByTagName("a")[0],n=T.createElement("select"),i=n.appendChild(T.createElement("option")),e=t.getElementsByTagName("input")[0],r.style.cssText="top:1px",l.getSetAttribute=t.className!=="t",l.style=/top/.test(r.getAttribute("style")),l.hrefNormalized=r.getAttribute("href")==="/a",l.checkOn=!!e.value,l.optSelected=i.selected,l.enctype=!!T.createElement("form").enctype,n.disabled=!0,l.optDisabled=!i.disabled,e=T.createElement("input"),e.setAttribute("value",""),l.input=e.getAttribute("value")==="",e.value="t",e.setAttribute("type","radio"),l.radioValue=e.value==="t"}();var hn=/\r/g;h.fn.extend({val:function(e){var t,n,r,i=this[0];if(!arguments.length){if(i)return t=h.valHooks[i.type]||h.valHooks[i.nodeName.toLowerCase()],t&&"get"in t&&(n=t.get(i,"value"))!==undefined?n:(n=i.value,typeof n=="string"?n.replace(hn,""):n==null?"":n);return}return r=h.isFunction(e),this.each(function(n){var i;if(this.nodeType!==1)return;r?i=e.call(this,n,h(this).val()):i=e,i==null?i="":typeof i=="number"?i+="":h.isArray(i)&&(i=h.map(i,function(e){return e==null?"":e+""})),t=h.valHooks[this.type]||h.valHooks[this.nodeName.toLowerCase()];if(!t||!("set"in t)||t.set(this,i,"value")===undefined)this.value=i})}}),h.extend({valHooks:{option:{get:function(e){var t=h.find.attr(e,"value");return t!=null?t:h.trim(h.text(e))}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,s=e.type==="select-one"||i<0,o=s?null:[],u=s?i+1:r.length,a=i<0?u:s?i:0;for(;a<u;a++){n=r[a];if((n.selected||a===i)&&(l.optDisabled?!n.disabled:n.getAttribute("disabled")===null)&&(!n.parentNode.disabled||!h.nodeName(n.parentNode,"optgroup"))){t=h(n).val();if(s)return t;o.push(t)}}return o},set:function(e,t){var n,r,i=e.options,s=h.makeArray(t),o=i.length;while(o--){r=i[o];if(h.inArray(h.valHooks.option.get(r),s)>=0)try{r.selected=n=!0}catch(u){r.scrollHeight}else r.selected=!1}return n||(e.selectedIndex=-1),i}}}}),h.each(["radio","checkbox"],function(){h.valHooks[this]={set:function(e,t){if(h.isArray(t))return e.checked=h.inArray(h(e).val(),t)>=0}},l.checkOn||(h.valHooks[this].get=function(e){return e.getAttribute("value")===null?"on":e.value})});var pn,dn,vn=h.expr.attrHandle,mn=/^(?:checked|selected)$/i,gn=l.getSetAttribute,yn=l.input;h.fn.extend({attr:function(e,t){return $(this,h.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){h.removeAttr(this,e)})}}),h.extend({attr:function(e,t,n){var r,i,s=e.nodeType;if(!e||s===3||s===8||s===2)return;if(typeof e.getAttribute===B)return h.prop(e,t,n);if(s!==1||!h.isXMLDoc(e))t=t.toLowerCase(),r=h.attrHooks[t]||(h.expr.match.bool.test(t)?dn:pn);if(n===undefined)return r&&"get"in r&&(i=r.get(e,t))!==null?i:(i=h.find.attr(e,t),i==null?undefined:i);if(n!==null)return r&&"set"in r&&(i=r.set(e,n,t))!==undefined?i:(e.setAttribute(t,n+""),n);h.removeAttr(e,t)},removeAttr:function(e,t){var n,r,i=0,s=t&&t.match(O);if(s&&e.nodeType===1)while(n=s[i++])r=h.propFix[n]||n,h.expr.match.bool.test(n)?yn&&gn||!mn.test(n)?e[r]=!1:e[h.camelCase("default-"+n)]=e[r]=!1:h.attr(e,n,""),e.removeAttribute(gn?n:r)},attrHooks:{type:{set:function(e,t){if(!l.radioValue&&t==="radio"&&h.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}}}),dn={set:function(e,t,n){return t===!1?h.removeAttr(e,n):yn&&gn||!mn.test(n)?e.setAttribute(!gn&&h.propFix[n]||n,n):e[h.camelCase("default-"+n)]=e[n]=!0,n}},h.each(h.expr.match.bool.source.match(/\w+/g),function(e,t){var n=vn[t]||h.find.attr;vn[t]=yn&&gn||!mn.test(t)?function(e,t,r){var i,s;return r||(s=vn[t],vn[t]=i,i=n(e,t,r)!=null?t.toLowerCase():null,vn[t]=s),i}:function(e,t,n){if(!n)return e[h.camelCase("default-"+t)]?t.toLowerCase():null}});if(!yn||!gn)h.attrHooks.value={set:function(e,t,n){if(!h.nodeName(e,"input"))return pn&&pn.set(e,t,n);e.defaultValue=t}};gn||(pn={set:function(e,t,n){var r=e.getAttributeNode(n);r||e.setAttributeNode(r=e.ownerDocument.createAttribute(n)),r.value=t+="";if(n==="value"||t===e.getAttribute(n))return t}},vn.id=vn.name=vn.coords=function(e,t,n){var r;if(!n)return(r=e.getAttributeNode(t))&&r.value!==""?r.value:null},h.valHooks.button={get:function(e,t){var n=e.getAttributeNode(t);if(n&&n.specified)return n.value},set:pn.set},h.attrHooks.contenteditable={set:function(e,t,n){pn.set(e,t===""?!1:t,n)}},h.each(["width","height"],function(e,t){h.attrHooks[t]={set:function(e,n){if(n==="")return e.setAttribute(t,"auto"),n}}})),l.style||(h.attrHooks.style={get:function(e){return e.style.cssText||undefined},set:function(e,t){return e.style.cssText=t+""}});var bn=/^(?:input|select|textarea|button|object)$/i,wn=/^(?:a|area)$/i;h.fn.extend({prop:function(e,t){return $(this,h.prop,e,t,arguments.length>1)},removeProp:function(e){return e=h.propFix[e]||e,this.each(function(){try{this[e]=undefined,delete this[e]}catch(t){}})}}),h.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,n){var r,i,s,o=e.nodeType;if(!e||o===3||o===8||o===2)return;return s=o!==1||!h.isXMLDoc(e),s&&(t=h.propFix[t]||t,i=h.propHooks[t]),n!==undefined?i&&"set"in i&&(r=i.set(e,n,t))!==undefined?r:e[t]=n:i&&"get"in i&&(r=i.get(e,t))!==null?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=h.find.attr(e,"tabindex");return t?parseInt(t,10):bn.test(e.nodeName)||wn.test(e.nodeName)&&e.href?0:-1}}}}),l.hrefNormalized||h.each(["href","src"],function(e,t){h.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}}),l.optSelected||(h.propHooks.selected={get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}}),h.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){h.propFix[this.toLowerCase()]=this}),l.enctype||(h.propFix.enctype="encoding");var En=/[\t\r\n\f]/g;h.fn.extend({addClass:function(e){var t,n,r,i,s,o,u=0,a=this.length,f=typeof e=="string"&&e;if(h.isFunction(e))return this.each(function(t){h(this).addClass(e.call(this,t,this.className))});if(f){t=(e||"").match(O)||[];for(;u<a;u++){n=this[u],r=n.nodeType===1&&(n.className?(" "+n.className+" ").replace(En," "):" ");if(r){s=0;while(i=t[s++])r.indexOf(" "+i+" ")<0&&(r+=i+" ");o=h.trim(r),n.className!==o&&(n.className=o)}}}return this},removeClass:function(e){var t,n,r,i,s,o,u=0,a=this.length,f=arguments.length===0||typeof e=="string"&&e;if(h.isFunction(e))return this.each(function(t){h(this).removeClass(e.call(this,t,this.className))});if(f){t=(e||"").match(O)||[];for(;u<a;u++){n=this[u],r=n.nodeType===1&&(n.className?(" "+n.className+" ").replace(En," "):"");if(r){s=0;while(i=t[s++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");o=e?h.trim(r):"",n.className!==o&&(n.className=o)}}}return this},toggleClass:function(e,t){var n=typeof e;return typeof t=="boolean"&&n==="string"?t?this.addClass(e):this.removeClass(e):h.isFunction(e)?this.each(function(n){h(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if(n==="string"){var t,r=0,i=h(this),s=e.match(O)||[];while(t=s[r++])i.hasClass(t)?i.removeClass(t):i.addClass(t)}else if(n===B||n==="boolean")this.className&&h._data(this,"__className__",this.className),this.className=this.className||e===!1?"":h._data(this,"__className__")||""})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;n<r;n++)if(this[n].nodeType===1&&(" "+this[n].className+" ").replace(En," ").indexOf(t)>=0)return!0;return!1}}),h.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){h.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),h.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return arguments.length===1?this.off(e,"**"):this.off(t,e||"**",n)}});var Sn=h.now(),xn=/\?/,Tn=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;h.parseJSON=function(t){if(e.JSON&&e.JSON.parse)return e.JSON.parse(t+"");var n,r=null,i=h.trim(t+"");return i&&!h.trim(i.replace(Tn,function(e,t,i,s){return n&&t&&(r=0),r===0?e:(n=i||t,r+=!s-!i,"")}))?Function("return "+i)():h.error("Invalid JSON: "+t)},h.parseXML=function(t){var n,r;if(!t||typeof t!="string")return null;try{e.DOMParser?(r=new DOMParser,n=r.parseFromString(t,"text/xml")):(n=new ActiveXObject("Microsoft.XMLDOM"),n.async="false",n.loadXML(t))}catch(i){n=undefined}return(!n||!n.documentElement||n.getElementsByTagName("parsererror").length)&&h.error("Invalid XML: "+t),n};var Nn,Cn,kn=/#.*$/,Ln=/([?&])_=[^&]*/,An=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,On=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Mn=/^(?:GET|HEAD)$/,_n=/^\/\//,Dn=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Pn={},Hn={},Bn="*/".concat("*");try{Cn=location.href}catch(jn){Cn=T.createElement("a"),Cn.href="",Cn=Cn.href}Nn=Dn.exec(Cn.toLowerCase())||[],h.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Cn,type:"GET",isLocal:On.test(Nn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Bn,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":h.parseJSON,"text xml":h.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?qn(qn(e,h.ajaxSettings),t):qn(h.ajaxSettings,e)},ajaxPrefilter:Fn(Pn),ajaxTransport:Fn(Hn),ajax:function(e,t){function x(e,t,n,r){var f,g,y,w,S,x=t;if(b===2)return;b=2,o&&clearTimeout(o),a=undefined,s=r||"",E.readyState=e>0?4:0,f=e>=200&&e<300||e===304,n&&(w=Rn(l,E,n)),w=Un(l,w,E,f);if(f)l.ifModified&&(S=E.getResponseHeader("Last-Modified"),S&&(h.lastModified[i]=S),S=E.getResponseHeader("etag"),S&&(h.etag[i]=S)),e===204||l.type==="HEAD"?x="nocontent":e===304?x="notmodified":(x=w.state,g=w.data,y=w.error,f=!y);else{y=x;if(e||!x)x="error",e<0&&(e=0)}E.status=e,E.statusText=(t||x)+"",f?d.resolveWith(c,[g,x,E]):d.rejectWith(c,[E,x,y]),E.statusCode(m),m=undefined,u&&p.trigger(f?"ajaxSuccess":"ajaxError",[E,l,f?g:y]),v.fireWith(c,[E,x]),u&&(p.trigger("ajaxComplete",[E,l]),--h.active||h.event.trigger("ajaxStop"))}typeof e=="object"&&(t=e,e=undefined),t=t||{};var n,r,i,s,o,u,a,f,l=h.ajaxSetup({},t),c=l.context||l,p=l.context&&(c.nodeType||c.jquery)?h(c):h.event,d=h.Deferred(),v=h.Callbacks("once memory"),m=l.statusCode||{},g={},y={},b=0,w="canceled",E={readyState:0,getResponseHeader:function(e){var t;if(b===2){if(!f){f={};while(t=An.exec(s))f[t[1].toLowerCase()]=t[2]}t=f[e.toLowerCase()]}return t==null?null:t},getAllResponseHeaders:function(){return b===2?s:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return b||(e=y[n]=y[n]||e,g[e]=t),this},overrideMimeType:function(e){return b||(l.mimeType=e),this},statusCode:function(e){var t;if(e)if(b<2)for(t in e)m[t]=[m[t],e[t]];else E.always(e[E.status]);return this},abort:function(e){var t=e||w;return a&&a.abort(t),x(0,t),this}};d.promise(E).complete=v.add,E.success=E.done,E.error=E.fail,l.url=((e||l.url||Cn)+"").replace(kn,"").replace(_n,Nn[1]+"//"),l.type=t.method||t.type||l.method||l.type,l.dataTypes=h.trim(l.dataType||"*").toLowerCase().match(O)||[""],l.crossDomain==null&&(n=Dn.exec(l.url.toLowerCase()),l.crossDomain=!(!n||n[1]===Nn[1]&&n[2]===Nn[2]&&(n[3]||(n[1]==="http:"?"80":"443"))===(Nn[3]||(Nn[1]==="http:"?"80":"443")))),l.data&&l.processData&&typeof l.data!="string"&&(l.data=h.param(l.data,l.traditional)),In(Pn,l,t,E);if(b===2)return E;u=l.global,u&&h.active++===0&&h.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!Mn.test(l.type),i=l.url,l.hasContent||(l.data&&(i=l.url+=(xn.test(i)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=Ln.test(i)?i.replace(Ln,"$1_="+Sn++):i+(xn.test(i)?"&":"?")+"_="+Sn++)),l.ifModified&&(h.lastModified[i]&&E.setRequestHeader("If-Modified-Since",h.lastModified[i]),h.etag[i]&&E.setRequestHeader("If-None-Match",h.etag[i])),(l.data&&l.hasContent&&l.contentType!==!1||t.contentType)&&E.setRequestHeader("Content-Type",l.contentType),E.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+(l.dataTypes[0]!=="*"?", "+Bn+"; q=0.01":""):l.accepts["*"]);for(r in l.headers)E.setRequestHeader(r,l.headers[r]);if(!l.beforeSend||l.beforeSend.call(c,E,l)!==!1&&b!==2){w="abort";for(r in{success:1,error:1,complete:1})E[r](l[r]);a=In(Hn,l,t,E);if(!a)x(-1,"No Transport");else{E.readyState=1,u&&p.trigger("ajaxSend",[E,l]),l.async&&l.timeout>0&&(o=setTimeout(function(){E.abort("timeout")},l.timeout));try{b=1,a.send(g,x)}catch(S){if(!(b<2))throw S;x(-1,S)}}return E}return E.abort()},getJSON:function(e,t,n){return h.get(e,t,n,"json")},getScript:function(e,t){return h.get(e,undefined,t,"script")}}),h.each(["get","post"],function(e,t){h[t]=function(e,n,r,i){return h.isFunction(n)&&(i=i||r,r=n,n=undefined),h.ajax({url:e,type:t,dataType:i,data:n,success:r})}}),h.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){h.fn[t]=function(e){return this.on(t,e)}}),h._evalUrl=function(e){return h.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},h.fn.extend({wrapAll:function(e){if(h.isFunction(e))return this.each(function(t){h(this).wrapAll(e.call(this,t))});if(this[0]){var t=h(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&e.firstChild.nodeType===1)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return h.isFunction(e)?this.each(function(t){h(this).wrapInner(e.call(this,t))}):this.each(function(){var t=h(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=h.isFunction(e);return this.each(function(n){h(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){h.nodeName(this,"body")||h(this).replaceWith(this.childNodes)}).end()}}),h.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0||!l.reliableHiddenOffsets()&&(e.style&&e.style.display||h.css(e,"display"))==="none"},h.expr.filters.visible=function(e){return!h.expr.filters.hidden(e)};var zn=/%20/g,Wn=/\[\]$/,Xn=/\r?\n/g,Vn=/^(?:submit|button|image|reset|file)$/i,$n=/^(?:input|select|textarea|keygen)/i;h.param=function(e,t){var n,r=[],i=function(e,t){t=h.isFunction(t)?t():t==null?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};t===undefined&&(t=h.ajaxSettings&&h.ajaxSettings.traditional);if(h.isArray(e)||e.jquery&&!h.isPlainObject(e))h.each(e,function(){i(this.name,this.value)});else for(n in e)Jn(n,e[n],t,i);return r.join("&").replace(zn,"+")},h.fn.extend({serialize:function(){return h.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=h.prop(this,"elements");return e?h.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!h(this).is(":disabled")&&$n.test(this.nodeName)&&!Vn.test(e)&&(this.checked||!J.test(e))}).map(function(e,t){var n=h(this).val();return n==null?null:h.isArray(n)?h.map(n,function(e){return{name:t.name,value:e.replace(Xn,"\r\n")}}):{name:t.name,value:n.replace(Xn,"\r\n")}}).get()}}),h.ajaxSettings.xhr=e.ActiveXObject!==undefined?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&Yn()||Zn()}:Yn;var Kn=0,Qn={},Gn=h.ajaxSettings.xhr();e.ActiveXObject&&h(e).on("unload",function(){for(var e in Qn)Qn[e](undefined,!0)}),l.cors=!!Gn&&"withCredentials"in Gn,Gn=l.ajax=!!Gn,Gn&&h.ajaxTransport(function(e){if(!e.crossDomain||l.cors){var t;return{send:function(n,r){var i,s=e.xhr(),o=++Kn;s.open(e.type,e.url,e.async,e.username,e.password);if(e.xhrFields)for(i in e.xhrFields)s[i]=e.xhrFields[i];e.mimeType&&s.overrideMimeType&&s.overrideMimeType(e.mimeType),!e.crossDomain&&!n["X-Requested-With"]&&(n["X-Requested-With"]="XMLHttpRequest");for(i in n)n[i]!==undefined&&s.setRequestHeader(i,n[i]+"");s.send(e.hasContent&&e.data||null),t=function(n,i){var u,a,f;if(t&&(i||s.readyState===4)){delete Qn[o],t=undefined,s.onreadystatechange=h.noop;if(i)s.readyState!==4&&s.abort();else{f={},u=s.status,typeof s.responseText=="string"&&(f.text=s.responseText);try{a=s.statusText}catch(l){a=""}!u&&e.isLocal&&!e.crossDomain?u=f.text?200:404:u===1223&&(u=204)}}f&&r(u,a,f,s.getAllResponseHeaders())},e.async?s.readyState===4?setTimeout(t):s.onreadystatechange=Qn[o]=t:t()},abort:function(){t&&t(undefined,!0)}}}}),h.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return h.globalEval(e),e}}}),h.ajaxPrefilter("script",function(e){e.cache===undefined&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),h.ajaxTransport("script",function(e){if(e.crossDomain){var t,n=T.head||h("head")[0]||T.documentElement;return{send:function(r,i){t=T.createElement("script"),t.async=!0,e.scriptCharset&&(t.charset=e.scriptCharset),t.src=e.url,t.onload=t.onreadystatechange=function(e,n){if(n||!t.readyState||/loaded|complete/.test(t.readyState))t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),t=null,n||i(200,"success")},n.insertBefore(t,n.firstChild)},abort:function(){t&&t.onload(undefined,!0)}}}});var er=[],tr=/(=)\?(?=&|$)|\?\?/;h.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=er.pop()||h.expando+"_"+Sn++;return this[e]=!0,e}}),h.ajaxPrefilter("json jsonp",function(t,n,r){var i,s,o,u=t.jsonp!==!1&&(tr.test(t.url)?"url":typeof t.data=="string"&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&tr.test(t.data)&&"data");if(u||t.dataTypes[0]==="jsonp")return i=t.jsonpCallback=h.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,u?t[u]=t[u].replace(tr,"$1"+i):t.jsonp!==!1&&(t.url+=(xn.test(t.url)?"&":"?")+t.jsonp+"="+i),t.converters["script json"]=function(){return o||h.error(i+" was not called"),o[0]},t.dataTypes[0]="json",s=e[i],e[i]=function(){o=arguments},r.always(function(){e[i]=s,t[i]&&(t.jsonpCallback=n.jsonpCallback,er.push(i)),o&&h.isFunction(s)&&s(o[0]),o=s=undefined}),"script"}),h.parseHTML=function(e,t,n){if(!e||typeof e!="string")return null;typeof t=="boolean"&&(n=t,t=!1),t=t||T;var r=w.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=h.buildFragment([e],t,i),i&&i.length&&h(i).remove(),h.merge([],r.childNodes))};var nr=h.fn.load;h.fn.load=function(e,t,n){if(typeof e!="string"&&nr)return nr.apply(this,arguments);var r,i,s,o=this,u=e.indexOf(" ");return u>=0&&(r=h.trim(e.slice(u,e.length)),e=e.slice(0,u)),h.isFunction(t)?(n=t,t=undefined):t&&typeof t=="object"&&(s="POST"),o.length>0&&h.ajax({url:e,type:s,dataType:"html",data:t}).done(function(e){i=arguments,o.html(r?h("<div>").append(h.parseHTML(e)).find(r):e)}).complete(n&&function(e,t){o.each(n,i||[e.responseText,t,e])}),this},h.expr.filters.animated=function(e){return h.grep(h.timers,function(t){return e===t.elem}).length};var rr=e.document.documentElement;h.offset={setOffset:function(e,t,n){var r,i,s,o,u,a,f,l=h.css(e,"position"),c=h(e),p={};l==="static"&&(e.style.position="relative"),u=c.offset(),s=h.css(e,"top"),a=h.css(e,"left"),f=(l==="absolute"||l==="fixed")&&h.inArray("auto",[s,a])>-1,f?(r=c.position(),o=r.top,i=r.left):(o=parseFloat(s)||0,i=parseFloat(a)||0),h.isFunction(t)&&(t=t.call(e,n,u)),t.top!=null&&(p.top=t.top-u.top+o),t.left!=null&&(p.left=t.left-u.left+i),"using"in t?t.using.call(e,p):c.css(p)}},h.fn.extend({offset:function(e){if(arguments.length)return e===undefined?this:this.each(function(t){h.offset.setOffset(this,e,t)});var t,n,r={top:0,left:0},i=this[0],s=i&&i.ownerDocument;if(!s)return;return t=s.documentElement,h.contains(t,i)?(typeof i.getBoundingClientRect!==B&&(r=i.getBoundingClientRect()),n=ir(s),{top:r.top+(n.pageYOffset||t.scrollTop)-(t.clientTop||0),left:r.left+(n.pageXOffset||t.scrollLeft)-(t.clientLeft||0)}):r},position:function(){if(!this[0])return;var e,t,n={top:0,left:0},r=this[0];return h.css(r,"position")==="fixed"?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),h.nodeName(e[0],"html")||(n=e.offset()),n.top+=h.css(e[0],"borderTopWidth",!0),n.left+=h.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-h.css(r,"marginTop",!0),left:t.left-n.left-h.css(r,"marginLeft",!0)}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||rr;while(e&&!h.nodeName(e,"html")&&h.css(e,"position")==="static")e=e.offsetParent;return e||rr})}}),h.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n=/Y/.test(t);h.fn[e]=function(r){return $(this,function(e,r,i){var s=ir(e);if(i===undefined)return s?t in s?s[t]:s.document.documentElement[r]:e[r];s?s.scrollTo(n?h(s).scrollLeft():i,n?i:h(s).scrollTop()):e[r]=i},e,r,arguments.length,null)}}),h.each(["top","left"],function(e,t){h.cssHooks[t]=jt(l.pixelPosition,function(e,n){if(n)return n=Ht(e,t),Dt.test(n)?h(e).position()[t]+"px":n})}),h.each({Height:"height",Width:"width"},function(e,t){h.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){h.fn[r]=function(r,i){var s=arguments.length&&(n||typeof r!="boolean"),o=n||(r===!0||i===!0?"margin":"border");return $(this,function(t,n,r){var i;return h.isWindow(t)?t.document.documentElement["client"+e]:t.nodeType===9?(i=t.documentElement,Math.max(t.body["scroll"+e],i["scroll"+e],t.body["offset"+e],i["offset"+e],i["client"+e])):r===undefined?h.css(t,n,o):h.style(t,n,r,o)},t,s?r:undefined,s,null)}})}),h.fn.size=function(){return this.length},h.fn.andSelf=h.fn.addBack,typeof define=="function"&&define.amd&&define("jquery",[],function(){return h});var sr=e.jQuery,or=e.$;return h.noConflict=function(t){return e.$===h&&(e.$=or),t&&e.jQuery===h&&(e.jQuery=sr),h},typeof t===B&&(e.jQuery=e.$=h),e.pfm$=e.jQuery.noConflict(!0),h}),define("libs/jquery/jquery-1.11.1",function(){}),define("jQuery",["libs/jquery/jquery-1.11.1"],function(){return window.pfm$}),function(e){function U(e,t,n){var r=(n||0)-1,i=e.length;while(++r<i)if(e[r]===t)return r;return-1}function z(e,t){var n=typeof t;e=e.cache;if(n=="boolean"||t==null)return e[t];n!="number"&&n!="string"&&(n="object");var r=n=="number"?t:o+t;return e=e[n]||(e[n]={}),n=="object"?e[r]&&U(e[r],t)>-1?0:-1:e[r]?0:-1}function W(e){var t=this.cache,n=typeof e;if(n=="boolean"||e==null)t[e]=!0;else{n!="number"&&n!="string"&&(n="object");var r=n=="number"?e:o+e,i=t[n]||(t[n]={});n=="object"?(i[r]||(i[r]=[])).push(e)==this.array.length&&(t[n]=!1):i[r]=!0}}function X(e){return e.charCodeAt(0)}function V(e,t){var n=e.index,r=t.index;e=e.criteria,t=t.criteria;if(e!==t){if(e>t||typeof e=="undefined")return 1;if(e<t||typeof t=="undefined")return-1}return n<r?-1:1}function $(e){var t=-1,n=e.length,r=Q();r["false"]=r["null"]=r["true"]=r["undefined"]=!1;var i=Q();i.array=e,i.cache=r,i.push=W;while(++t<n)i.push(e[t]);return r.object===!1?(et(i),null):i}function J(e){return"\\"+F[e]}function K(){return n.pop()||[]}function Q(){return r.pop()||{args:"",array:null,bottom:"",cache:null,criteria:null,"false":!1,firstArg:"",index:0,init:"",leading:!1,loop:"",maxWait:0,"null":!1,number:null,object:null,push:null,shadowedProps:null,string:null,top:"",trailing:!1,"true":!1,"undefined":!1,useHas:!1,useKeys:!1,value:null}}function G(e){return typeof e.toString!="function"&&typeof (e+"")=="string"}function Y(){}function Z(e){e.length=0,n.length<a&&n.push(e)}function et(e){var t=e.cache;t&&et(t),e.array=e.cache=e.criteria=e.object=e.number=e.string=e.value=null,r.length<a&&r.push(e)}function tt(e,t,n){t||(t=0),typeof n=="undefined"&&(n=e?e.length:0);var r=-1,i=n-t||0,s=Array(i<0?0:i);while(++r<i)s[r]=e[t+r];return s}function nt(n){function Ut(e){return e&&typeof e=="object"&&!sn(e)&&Et.call(e,"__wrapped__")?e:new zt(e)}function zt(e){this.__wrapped__=e}function Kt(e,t,n,r){function a(){var r=arguments,f=s?this:t;i||(e=t[o]),n.length&&(r=r.length?(r=jt.call(r),u?r.concat(n):n.concat(r)):n);if(this instanceof a){f=Gt(e.prototype);var l=e.apply(f,r);return Ln(l)?l:f}return e.apply(f,r)}var i=kn(e),s=!n,o=t;if(s){var u=r;n=t}else if(!i){if(!r)throw new at;t=e}return a}function Qt(){var e=Q();e.shadowedProps=x,e.array=e.bottom=e.loop=e.top="",e.init="iterable",e.useHas=!0,e.useKeys=!!un;for(var t,n=0;t=arguments[n];n++)for(var r in t)e[r]=t[r];var i=e.args;e.firstArg=/^[^,]+/.exec(i)[0];var s=R("errorClass, errorProto, hasOwnProperty, isArguments, isArray, isString, keys, lodash, objectProto, objectTypes, nonEnumProps, stringClass, stringProto, toString","return function("+i+") {\n"+Xt(e)+"\n}");return et(e),s(O,lt,Et,rn,sn,Pn,un,Ut,ct,j,Rt,H,ht,Ct)}function Gt(e){return Ln(e)?Lt(e):{}}function Yt(e){return fn[e]}function Zt(e,t,n){var r=(r=Ut.indexOf)===vr?U:r;return r}function en(e){return function(n,r,i,s){return typeof r!="boolean"&&r!=null&&(s=i,i=!s||s[r]!==n?r:t,r=!1),i!=null&&(i=Ut.createCallback(i,s)),e(n,r,i,s)}}function tn(e){var n,r;return!e||Ct.call(e)!=D||(n=e.constructor,kn(n)&&!(n instanceof n))||!Wt.argsClass&&rn(e)||!Wt.nodeClass&&G(e)?!1:Wt.ownLast?(mn(e,function(e,t,n){return r=Et.call(n,t),!1}),r!==!1):(mn(e,function(e,t){r=t}),r===t||Et.call(e,r))}function nn(e){return ln[e]}function rn(e){return Ct.call(e)==N}function hn(e,n,r,i,s,o){var u=e;typeof n!="boolean"&&n!=null&&(i=r,r=n,n=!1);if(typeof r=="function"){r=typeof i=="undefined"?r:Ut.createCallback(r,i,1),u=r(u);if(typeof u!="undefined")return u;u=e}var a=Ln(u);if(a){var f=Ct.call(u);if(!B[f]||!Wt.nodeClass&&G(u))return u;var l=sn(u)}if(!a||!n)return a?l?tt(u):cn({},u):u;var c=qt[f];switch(f){case L:case A:return new c(+u);case _:case H:return new c(u);case P:return c(u.source,d.exec(u))}var h=!s;s||(s=K()),o||(o=K());var p=s.length;while(p--)if(s[p]==e)return o[p];return u=l?c(u.length):{},l&&(Et.call(e,"index")&&(u.index=e.index),Et.call(e,"input")&&(u.input=e.input)),s.push(e),o.push(u),(l?an:gn)(e,function(e,i){u[i]=hn(e,n,r,t,s,o)}),h&&(Z(s),Z(o)),u}function pn(e,t,n){return hn(e,!0,t,n)}function vn(e,t,n){var r;return t=Ut.createCallback(t,n),gn(e,function(e,n,i){if(t(e,n,i))return r=n,!1}),r}function yn(e){var t=[];return mn(e,function(e,n){kn(e)&&t.push(n)}),t.sort()}function bn(e,t){return e?Et.call(e,t):!1}function wn(e){var t=-1,n=un(e),r=n.length,i={};while(++t<r){var s=n[t];i[e[s]]=s}return i}function En(e){return e===!0||e===!1||Ct.call(e)==L}function Sn(e){return e?typeof e=="object"&&Ct.call(e)==A:!1}function xn(e){return e?e.nodeType===1:!1}function Tn(e){var t=!0;if(!e)return t;var n=Ct.call(e),r=e.length;return n==C||n==H||(Wt.argsClass?n==N:rn(e))||n==D&&typeof r=="number"&&kn(e.splice)?!r:(gn(e,function(){return t=!1}),t)}function Nn(e,t,n,r,i,o){var u=n===s;if(typeof n=="function"&&!u){n=Ut.createCallback(n,r,2);var a=n(e,t);if(typeof a!="undefined")return!!a}if(e===t)return e!==0||1/e==1/t;var f=typeof e,l=typeof t;if(e===e&&(!e||f!="function"&&f!="object")&&(!t||l!="function"&&l!="object"))return!1;if(e==null||t==null)return e===t;var c=Ct.call(e),h=Ct.call(t);c==N&&(c=D),h==N&&(h=D);if(c!=h)return!1;switch(c){case L:case A:return+e==+t;case _:return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case P:case H:return e==ut(t)}var p=c==C;if(!p){if(Et.call(e,"__wrapped__ ")||Et.call(t,"__wrapped__"))return Nn(e.__wrapped__||e,t.__wrapped__||t,n,r,i,o);if(c!=D||!Wt.nodeClass&&(G(e)||G(t)))return!1;var d=!Wt.argsObject&&rn(e)?st:e.constructor,v=!Wt.argsObject&&rn(t)?st:t.constructor;if(d!=v&&!(kn(d)&&d instanceof d&&kn(v)&&v instanceof v))return!1}var m=!i;i||(i=K()),o||(o=K());var g=i.length;while(g--)if(i[g]==e)return o[g]==t;var y=0;a=!0,i.push(e),o.push(t);if(p){g=e.length,y=t.length,a=y==e.length;if(!a&&!u)return a;while(y--){var b=g,w=t[y];if(u){while(b--)if(a=Nn(e[b],w,n,r,i,o))break}else if(!(a=Nn(e[y],w,n,r,i,o)))break}return a}return mn(t,function(t,s,u){if(Et.call(u,s))return y++,a=Et.call(e,s)&&Nn(e[s],t,n,r,i,o)}),a&&!u&&mn(e,function(e,t,n){if(Et.call(n,t))return a=--y>-1}),m&&(Z(i),Z(o)),a}function Cn(e){return Ot(e)&&!Mt(parseFloat(e))}function kn(e){return typeof e=="function"}function Ln(e){return!!e&&!!j[typeof e]}function An(e){return Mn(e)&&e!=+e}function On(e){return e===null}function Mn(e){return typeof e=="number"||Ct.call(e)==_}function Dn(e){return!!e&&!!j[typeof e]&&Ct.call(e)==P}function Pn(e){return typeof e=="string"||Ct.call(e)==H}function Hn(e){return typeof e=="undefined"}function Bn(e,t,n){var r=arguments,i=0,o=2;if(!Ln(e))return e;if(n===s)var u=r[3],a=r[4],f=r[5];else{var l=!0;a=K(),f=K(),typeof n!="number"&&(o=r.length),o>3&&typeof r[o-2]=="function"?u=Ut.createCallback(r[--o-1],r[o--],2):o>2&&typeof r[o-1]=="function"&&(u=r[--o])}while(++i<o)(sn(r[i])?Jn:gn)(r[i],function(t,n){var r,i,o=t,l=e[n];if(t&&((i=sn(t))||_n(t))){var c=a.length;while(c--)if(r=a[c]==t){l=f[c];break}if(!r){var h;if(u){o=u(l,t);if(h=typeof o!="undefined")l=o}h||(l=i?sn(l)?l:[]:_n(l)?l:{}),a.push(t),f.push(l),h||(l=Bn(l,t,s,u,a,f))}}else u&&(o=u(l,t),typeof o=="undefined"&&(o=t)),typeof o!="undefined"&&(l=o);e[n]=l});return l&&(Z(a),Z(f)),e}function jn(e,t,n){var r=Zt(),i=typeof t=="function",s={};if(i)t=Ut.createCallback(t,n);else var o=gt.apply(ft,jt.call(arguments,1));return mn(e,function(e,n,u){if(i?!t(e,n,u):r(o,n)<0)s[n]=e}),s}function Fn(e){var t=-1,n=un(e),i=n.length,s=r(i);while(++t<i){var o=n[t];s[t]=[o,e[o]]}return s}function In(e,t,n){var r={};if(typeof t!="function"){var i=-1,s=gt.apply(ft,jt.call(arguments,1)),o=Ln(e)?s.length:0;while(++i<o){var u=s[i];u in e&&(r[u]=e[u])}}else t=Ut.createCallback(t,n),mn(e,function(e,n,i){t(e,n,i)&&(r[n]=e)});return r}function qn(e,t,n,r){var i=sn(e);t=Ut.createCallback(t,r,4);if(n==null)if(i)n=[];else{var s=e&&e.constructor,o=s&&s.prototype;n=Gt(o)}return(i?an:gn)(e,function(e,r,i){return t(n,e,r,i)}),n}function Rn(e){var t=-1,n=un(e),i=n.length,s=r(i);while(++t<i)s[t]=e[n[t]];return s}function Un(e){var t=-1,n=gt.apply(ft,jt.call(arguments,1)),i=n.length,s=r(i);Wt.unindexedChars&&Pn(e)&&(e=e.split(""));while(++t<i)s[t]=e[n[t]];return s}function zn(e,t,n){var r=-1,i=Zt(),s=e?e.length:0,o=!1;return n=(n<0?Dt(0,s+n):n)||0,s&&typeof s=="number"?o=(Pn(e)?e.indexOf(t,n):i(e,t,n))>-1:an(e,function(e){if(++r>=n)return!(o=e===t)}),o}function Wn(e,t,n){var r={};return t=Ut.createCallback(t,n),Jn(e,function(e,n,i){n=ut(t(e,n,i)),Et.call(r,n)?r[n]++:r[n]=1}),r}function Xn(e,t,n){var r=!0;t=Ut.createCallback(t,n);if(sn(e)){var i=-1,s=e.length;while(++i<s)if(!(r=!!t(e[i],i,e)))break}else an(e,function(e,n,i){return r=!!t(e,n,i)});return r}function Vn(e,t,n){var r=[];t=Ut.createCallback(t,n);if(sn(e)){var i=-1,s=e.length;while(++i<s){var o=e[i];t(o,i,e)&&r.push(o)}}else an(e,function(e,n,i){t(e,n,i)&&r.push(e)});return r}function $n(e,t,n){t=Ut.createCallback(t,n);if(!sn(e)){var o;return an(e,function(e,n,r){if(t(e,n,r))return o=e,!1}),o}var r=-1,i=e.length;while(++r<i){var s=e[r];if(t(s,r,e))return s}}function Jn(e,t,n){if(t&&typeof n=="undefined"&&sn(e)){var r=-1,i=e.length;while(++r<i)if(t(e[r],r,e)===!1)break}else an(e,t,n);return e}function Kn(e,t,n){var r={};return t=Ut.createCallback(t,n),Jn(e,function(e,n,i){n=ut(t(e,n,i)),(Et.call(r,n)?r[n]:r[n]=[]).push(e)}),r}function Qn(e,t){var n=jt.call(arguments,2),i=-1,s=typeof t=="function",o=e?e.length:0,u=r(typeof o=="number"?o:0);return Jn(e,function(e){u[++i]=(s?t:e[t]).apply(e,n)}),u}function Gn(e,t,n){var i=-1,s=e?e.length:0,o=r(typeof s=="number"?s:0);t=Ut.createCallback(t,n);if(sn(e))while(++i<s)o[i]=t(e[i],i,e);else an(e,function(e,n,r){o[++i]=t(e,n,r)});return o}function Yn(e,t,n){var r=-Infinity,i=r;if(!t&&sn(e)){var s=-1,o=e.length;while(++s<o){var u=e[s];u>i&&(i=u)}}else t=!t&&Pn(e)?X:Ut.createCallback(t,n),an(e,function(e,n,s){var o=t(e,n,s);o>r&&(r=o,i=e)});return i}function Zn(e,t,n){var r=Infinity,i=r;if(!t&&sn(e)){var s=-1,o=e.length;while(++s<o){var u=e[s];u<i&&(i=u)}}else t=!t&&Pn(e)?X:Ut.createCallback(t,n),an(e,function(e,n,s){var o=t(e,n,s);o<r&&(r=o,i=e)});return i}function tr(e,t,n,r){var i=arguments.length<3;t=Ut.createCallback(t,r,4);if(sn(e)){var s=-1,o=e.length;i&&(n=e[++s]);while(++s<o)n=t(n,e[s],s,e)}else an(e,function(e,r,s){n=i?(i=!1,e):t(n,e,r,s)});return n}function nr(e,t,n,r){var i=e,s=e?e.length:0,o=arguments.length<3;if(typeof s!="number"){var u=un(e);s=u.length}else Wt.unindexedChars&&Pn(e)&&(i=e.split(""));return t=Ut.createCallback(t,r,4),Jn(e,function(e,r,a){r=u?u[--s]:--s,n=o?(o=!1,i[r]):t(n,i[r],r,a)}),n}function rr(e,t,n){return t=Ut.createCallback(t,n),Vn(e,function(e,n,r){return!t(e,n,r)})}function ir(e){var t=-1,n=e?e.length:0,i=r(typeof n=="number"?n:0);return Jn(e,function(e){var n=yt(Bt()*(++t+1));i[t]=i[n],i[n]=e}),i}function sr(e){var t=e?e.length:0;return typeof t=="number"?t:un(e).length}function or(e,t,n){var r;t=Ut.createCallback(t,n);if(sn(e)){var i=-1,s=e.length;while(++i<s)if(r=t(e[i],i,e))break}else an(e,function(e,n,i){return!(r=t(e,n,i))});return!!r}function ur(e,t,n){var i=-1,s=e?e.length:0,o=r(typeof s=="number"?s:0);t=Ut.createCallback(t,n),Jn(e,function(e,n,r){var s=o[++i]=Q();s.criteria=t(e,n,r),s.index=i,s.value=e}),s=o.length,o.sort(V);while(s--){var u=o[s];o[s]=u.value,et(u)}return o}function ar(e){return e&&typeof e.length=="number"?Wt.unindexedChars&&Pn(e)?e.split(""):tt(e):Rn(e)}function lr(e){var t=-1,n=e?e.length:0,r=[];while(++t<n){var i=e[t];i&&r.push(i)}return r}function cr(e){var t=-1,n=Zt(),r=e?e.length:0,i=gt.apply(ft,jt.call(arguments,1)),s=[],o=r>=u&&n===U;if(o){var a=$(i);a?(n=z,i=a):o=!1}while(++t<r){var f=e[t];n(i,f)<0&&s.push(f)}return o&&et(i),s}function hr(e,t,n){var r=-1,i=e?e.length:0;t=Ut.createCallback(t,n);while(++r<i)if(t(e[r],r,e))return r;return-1}function pr(e,t,n){if(e){var r=0,i=e.length;if(typeof t!="number"&&t!=null){var s=-1;t=Ut.createCallback(t,n);while(++s<i&&t(e[s],s,e))r++}else{r=t;if(r==null||n)return e[0]}return tt(e,0,Pt(Dt(0,r),i))}}function vr(e,t,n){if(typeof n=="number"){var r=e?e.length:0;n=n<0?Dt(0,r+n):n||0}else if(n){var i=Sr(e,t);return e[i]===t?i:-1}return e?U(e,t,n):-1}function mr(e,t,n){if(!e)return[];var r=0,i=e.length;if(typeof t!="number"&&t!=null){var s=i;t=Ut.createCallback(t,n);while(s--&&t(e[s],s,e))r++}else r=t==null||n?1:t||r;return tt(e,0,Pt(Dt(0,i-r),i))}function gr(e){var t=arguments,n=t.length,r=-1,i=K(),s=-1,o=Zt(),a=e?e.length:0,f=[],l=K();while(++r<n){var c=t[r];i[r]=o===U&&(c?c.length:0)>=u&&$(r?t[r]:l)}e:while(++s<a){var h=i[0];c=e[s];if((h?z(h,c):o(l,c))<0){r=n,(h||l).push(c);while(--r){h=i[r];if((h?z(h,c):o(t[r],c))<0)continue e}f.push(c)}}while(n--)h=i[n],h&&et(h);return Z(i),Z(l),f}function yr(e,t,n){if(e){var r=0,i=e.length;if(typeof t!="number"&&t!=null){var s=i;t=Ut.createCallback(t,n);while(s--&&t(e[s],s,e))r++}else{r=t;if(r==null||n)return e[i-1]}return tt(e,Dt(0,i-r))}}function br(e,t,n){var r=e?e.length:0;typeof n=="number"&&(r=(n<0?Dt(0,r+n):Pt(n,r-1))+1);while(r--)if(e[r]===t)return r;return-1}function wr(e,t,n){e=+e||0,n=+n||1,t==null&&(t=e,e=0);var i=-1,s=Dt(0,vt((t-e)/n)),o=r(s);while(++i<s)o[i]=e,e+=n;return o}function Er(e,t,n){if(typeof t!="number"&&t!=null){var r=0,i=-1,s=e?e.length:0;t=Ut.createCallback(t,n);while(++i<s&&t(e[i],i,e))r++}else r=t==null||n?1:Dt(0,t);return tt(e,r)}function Sr(e,t,n,r){var i=0,s=e?e.length:i;n=n?Ut.createCallback(n,r,1):Xr,t=n(t);while(i<s){var o=i+s>>>1;n(e[o])<t?i=o+1:s=o}return i}function xr(e){return sn(e)||(arguments[0]=e?jt.call(e):ft),Tr(gt.apply(ft,arguments))}function Nr(e){var t=-1,n=e?Yn(er(e,"length")):0,i=r(n<0?0:n);while(++t<n)i[t]=er(e,t);return i}function Cr(e){return cr(e,jt.call(arguments,1))}function kr(e){return e?Nr(arguments):[]}function Lr(e,t){var n=-1,r=e?e.length:0,i={};while(++n<r){var s=e[n];t?i[s]=t[n]:i[s[0]]=s[1]}return i}function Ar(e,t){return e<1?t():function(){if(--e<1)return t.apply(this,arguments)}}function Or(e,t){return Wt.fastBind||kt&&arguments.length>2?kt.call.apply(kt,arguments):Kt(e,t,jt.call(arguments,2))}function Mr(e){var t=arguments.length>1?gt.apply(ft,jt.call(arguments,1)):yn(e),n=-1,r=t.length;while(++n<r){var i=t[n];e[i]=Or(e[i],e)}return e}function _r(e,t){return Kt(e,t,jt.call(arguments,2),s)}function Dr(){var e=arguments;return function(){var t=arguments,n=e.length;while(n--)t=[e[n].apply(this,t)];return t[0]}}function Pr(e,t,n){if(e==null)return Xr;var r=typeof e;if(r!="function"){if(r!="object")return function(t){return t[e]};var i=un(e);return function(t){var n=i.length,r=!1;while(n--)if(!(r=Nn(t[i[n]],e[i[n]],s)))break;return r}}return typeof t=="undefined"||m&&!m.test(bt.call(e))?e:n===1?function(n){return e.call(t,n)}:n===2?function(n,r){return e.call(t,n,r)}:n===4?function(n,r,i,s){return e.call(t,n,r,i,s)}:function(n,r,i){return e.call(t,n,r,i)}}function Hr(e,t,n){function h(){mt(f),mt(l),o=0,f=l=null}function p(){var t=c&&(!v||o>1);h(),t&&(a!==!1&&(u=new F),i=e.apply(s,r))}function d(){h();if(c||a!==t)u=new F,i=e.apply(s,r)}var r,i,s,o=0,u=0,a=!1,f=null,l=null,c=!0;t=Dt(0,t||0);if(n===!0){var v=!0;c=!1}else Ln(n)&&(v=n.leading,a="maxWait"in n&&Dt(t,n.maxWait||0),c="trailing"in n?n.trailing:c);return function(){r=arguments,s=this,o++,mt(l);if(a===!1)v&&o<2&&(i=e.apply(s,r));else{var n=new F;!f&&!v&&(u=n);var c=a-(n-u);c<=0?(mt(f),f=null,u=n,i=e.apply(s,r)):f||(f=Nt(d,c))}return t!==a&&(l=Nt(p,t)),i}}function Br(e){var n=jt.call(arguments,1);return Nt(function(){e.apply(t,n)},1)}function jr(e,n){var r=jt.call(arguments,2);return Nt(function(){e.apply(t,r)},n)}function Fr(e,t){function n(){var r=n.cache,i=o+(t?t.apply(this,arguments):arguments[0]);return Et.call(r,i)?r[i]:r[i]=e.apply(this,arguments)}return n.cache={},n}function Ir(e){var t,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}}function qr(e){return Kt(e,jt.call(arguments,1))}function Rr(e){return Kt(e,jt.call(arguments,1),null,s)}function Ur(e,t,n){var r=!0,i=!0;n===!1?r=!1:Ln(n)&&(r="leading"in n?n.leading:r,i="trailing"in n?n.trailing:i),n=Q(),n.leading=r,n.maxWait=t,n.trailing=i;var s=Hr(e,t,n);return et(n),s}function zr(e,t){return function(){var n=[e];return St.apply(n,arguments),t.apply(this,n)}}function Wr(e){return e==null?"":ut(e).replace(w,Yt)}function Xr(e){return e}function Vr(e){Jn(yn(e),function(t){var n=Ut[t]=e[t];Ut.prototype[t]=function(){var e=this.__wrapped__,t=[e];St.apply(t,arguments);var r=n.apply(Ut,t);return e&&typeof e=="object"&&e===r?this:new zt(r)}})}function $r(){return n._=pt,this}function Kr(e,t){e==null&&t==null&&(t=1),e=+e||0,t==null?(t=e,e=0):t=+t||0;var n=Bt();return e%1||t%1?e+Pt(n*(t-e+parseFloat("1e-"+((n+"").length-1))),t):e+yt(n*(t-e+1))}function Qr(e,n){var r=e?e[n]:t;return kn(r)?e[n]():r}function Gr(e,n,r){var i=Ut.templateSettings;e||(e=""),r=dn({},r,i);var s=dn({},r.imports,i.imports),o=un(s),u=Rn(s),a,h=0,d=r.interpolate||b,m="__p += '",g=ot((r.escape||b).source+"|"+d.source+"|"+(d===v?p:b).source+"|"+(r.evaluate||b).source+"|$","g");e.replace(g,function(t,n,r,i,s,o){return r||(r=i),m+=e.slice(h,o).replace(E,J),n&&(m+="' +\n__e("+n+") +\n'"),s&&(a=!0,m+="';\n"+s+";\n__p += '"),r&&(m+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),h=o+t.length,t}),m+="';\n";var y=r.variable,w=y;w||(y="obj",m="with ("+y+") {\n"+m+"\n}\n"),m=(a?m.replace(f,""):m).replace(l,"$1").replace(c,"$1;"),m="function("+y+") {\n"+(w?"":y+" || ("+y+" = {});\n")+"var __t, __p = '', __e = _.escape"+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+m+"return __p\n}";var S="\n/*\n//@ sourceURL="+(r.sourceURL||"/lodash/template/source["+T++ +"]")+"\n*/";try{var x=R(o,"return "+m+S).apply(t,u)}catch(N){throw N.source=m,N}return n?x(n):(x.source=m,x)}function Yr(e,t,n){e=(e=+e)>-1?e:0;var i=-1,s=r(e);t=Ut.createCallback(t,n,1);while(++i<e)s[i]=t(i);return s}function Zr(e){return e==null?"":ut(e).replace(h,nn)}function ei(e){var t=++i;return ut(e==null?"":e)+t}function ti(e,t){return t(e),e}function ni(){return ut(this.__wrapped__)}function ri(){return this.__wrapped__}n=n?rt.defaults(e.Object(),n,rt.pick(e,S)):e;var r=n.Array,a=n.Boolean,F=n.Date,I=n.Error,R=n.Function,W=n.Math,it=n.Number,st=n.Object,ot=n.RegExp,ut=n.String,at=n.TypeError,ft=[],lt=I.prototype,ct=st.prototype,ht=ut.prototype,pt=n._,dt=ot("^"+ut(ct.valueOf).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),vt=W.ceil,mt=n.clearTimeout,gt=ft.concat,yt=W.floor,bt=R.prototype.toString,wt=dt.test(wt=st.getPrototypeOf)&&wt,Et=ct.hasOwnProperty,St=ft.push,xt=ct.propertyIsEnumerable,Tt=n.setImmediate,Nt=n.setTimeout,Ct=ct.toString,kt=dt.test(kt=Ct.bind)&&kt,Lt=dt.test(Lt=st.create)&&Lt,At=dt.test(At=r.isArray)&&At,Ot=n.isFinite,Mt=n.isNaN,_t=dt.test(_t=st.keys)&&_t,Dt=W.max,Pt=W.min,Ht=n.parseInt,Bt=W.random,jt=ft.slice,Ft=dt.test(n.attachEvent),It=kt&&!/\n|true/.test(kt+Ft),qt={};qt[C]=r,qt[L]=a,qt[A]=F,qt[M]=R,qt[D]=st,qt[_]=it,qt[P]=ot,qt[H]=ut;var Rt={};Rt[C]=Rt[A]=Rt[_]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},Rt[L]=Rt[H]={constructor:!0,toString:!0,valueOf:!0},Rt[O]=Rt[M]=Rt[P]={constructor:!0,toString:!0},Rt[D]={constructor:!0},function(){var e=x.length;while(e--){var t=x[e];for(var n in Rt)Et.call(Rt,n)&&!Et.call(Rt[n],t)&&(Rt[n][t]=!1)}}(),zt.prototype=Ut.prototype;var Wt=Ut.support={};(function(){var e=function(){this.x=1},t={0:1,length:1},n=[];e.prototype={valueOf:1,y:1};for(var i in new e)n.push(i);for(i in arguments);Wt.argsObject=arguments.constructor==st&&!(arguments instanceof r),Wt.argsClass=rn(arguments),Wt.enumErrorProps=xt.call(lt,"message")||xt.call(lt,"name"),Wt.enumPrototypes=xt.call(e,"prototype"),Wt.fastBind=kt&&!It,Wt.ownLast=n[0]!="x",Wt.nonEnumArgs=i!=0,Wt.nonEnumShadows=!/valueOf/.test(n),Wt.spliceObjects=(ft.splice.call(t,0,1),!t[0]),Wt.unindexedChars="x"[0]+st("x")[0]!="xx";try{Wt.nodeClass=Ct.call(document)!=D||!!({toString:0}+"")}catch(s){Wt.nodeClass=!0}})(1),Ut.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:v,variable:"",imports:{_:Ut}};var Xt=function(e){var t="var index, iterable = "+e.firstArg+", result = "+e.init+";\nif (!iterable) return result;\n"+e.top+";";e.array?(t+="\nvar length = iterable.length; index = -1;\nif ("+e.array+") {  ",Wt.unindexedChars&&(t+="\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  "),t+="\n  while (++index < length) {\n    "+e.loop+";\n  }\n}\nelse {  "):Wt.nonEnumArgs&&(t+="\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      "+e.loop+";\n    }\n  } else {  "),Wt.enumPrototypes&&(t+="\n  var skipProto = typeof iterable == 'function';\n  "),Wt.enumErrorProps&&(t+="\n  var skipErrorProps = iterable === errorProto || iterable instanceof Error;\n  ");var n=[];Wt.enumPrototypes&&n.push('!(skipProto && index == "prototype")'),Wt.enumErrorProps&&n.push('!(skipErrorProps && (index == "message" || index == "name"))');if(e.useHas&&e.useKeys)t+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] && keys(iterable),\n      length = ownProps ? ownProps.length : 0;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n",n.length&&(t+="    if ("+n.join(" && ")+") {\n  "),t+=e.loop+";    ",n.length&&(t+="\n    }"),t+="\n  }  ";else{t+="\n  for (index in iterable) {\n",e.useHas&&n.push("hasOwnProperty.call(iterable, index)"),n.length&&(t+="    if ("+n.join(" && ")+") {\n  "),t+=e.loop+";    ",n.length&&(t+="\n    }"),t+="\n  }    ";if(Wt.nonEnumShadows){t+="\n\n  if (iterable !== objectProto) {\n    var ctor = iterable.constructor,\n        isProto = iterable === (ctor && ctor.prototype),\n        className = iterable === stringProto ? stringClass : iterable === errorProto ? errorClass : toString.call(iterable),\n        nonEnum = nonEnumProps[className];\n      ";for(k=0;k<7;k++)t+="\n    index = '"+e.shadowedProps[k]+"';\n    if ((!(isProto && nonEnum[index]) && hasOwnProperty.call(iterable, index))",e.useHas||(t+=" || (!nonEnum[index] && iterable[index] !== objectProto[index])"),t+=") {\n      "+e.loop+";\n    }      ";t+="\n  }    "}}if(e.array||Wt.nonEnumArgs)t+="\n}";return t+=e.bottom+";\nreturn result",t},Vt={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},$t={args:"collection, callback, thisArg",top:"callback = callback && typeof thisArg == 'undefined' ? callback : lodash.createCallback(callback, thisArg)",array:"typeof length == 'number'",loop:"if (callback(iterable[index], index, collection) === false) return result"},Jt={top:"if (!objectTypes[typeof iterable]) return result;\n"+$t.top,array:!1};if(!Lt)var Gt=function(e){if(Ln(e)){Y.prototype=e;var t=new Y;Y.prototype=null}return t||{}};Wt.argsClass||(rn=function(e){return e?Et.call(e,"callee"):!1});var sn=At||function(e){return e?typeof e=="object"&&Ct.call(e)==C:!1},on=Qt({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)"}),un=_t?function(e){return Ln(e)?Wt.enumPrototypes&&typeof e=="function"||Wt.nonEnumArgs&&e.length&&rn(e)?on(e):_t(e):[]}:on,an=Qt($t),fn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ln=wn(fn),cn=Qt(Vt,{top:Vt.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = lodash.createCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),dn=Qt(Vt),mn=Qt($t,Jt,{useHas:!1}),gn=Qt($t,Jt);kn(/x/)&&(kn=function(e){return typeof e=="function"&&Ct.call(e)==M});var _n=wt?function(e){if(!e||Ct.call(e)!=D||!Wt.argsClass&&rn(e))return!1;var t=e.valueOf,n=typeof t=="function"&&(n=wt(t))&&wt(n);return n?e==n||wt(e)==n:tn(e)}:tn,er=Gn,fr=Vn,dr=en(function ii(e,t,n){var r=-1,i=e?e.length:0,s=[];while(++r<i){var o=e[r];n&&(o=n(o,r,e)),sn(o)?St.apply(s,t?o:ii(o)):s.push(o)}return s}),Tr=en(function(e,t,n){var r=-1,i=Zt(),s=e?e.length:0,o=[],a=!t&&s>=u&&i===U,f=n||a?K():o;if(a){var l=$(f);l?(i=z,f=l):(a=!1,f=n?f:(Z(f),o))}while(++r<s){var c=e[r],h=n?n(c,r,e):c;if(t?!r||f[f.length-1]!==h:i(f,h)<0)(n||a)&&f.push(h),o.push(c)}return a?(Z(f.array),et(f)):n&&Z(f),o});It&&q&&typeof Tt=="function"&&(Br=Or(Tt,n));var Jr=Ht(g+"08")==8?Ht:function(e,t){return Ht(Pn(e)?e.replace(y,""):e,t||0)};return Ut.after=Ar,Ut.assign=cn,Ut.at=Un,Ut.bind=Or,Ut.bindAll=Mr,Ut.bindKey=_r,Ut.compact=lr,Ut.compose=Dr,Ut.countBy=Wn,Ut.createCallback=Pr,Ut.debounce=Hr,Ut.defaults=dn,Ut.defer=Br,Ut.delay=jr,Ut.difference=cr,Ut.filter=Vn,Ut.flatten=dr,Ut.forEach=Jn,Ut.forIn=mn,Ut.forOwn=gn,Ut.functions=yn,Ut.groupBy=Kn,Ut.initial=mr,Ut.intersection=gr,Ut.invert=wn,Ut.invoke=Qn,Ut.keys=un,Ut.map=Gn,Ut.max=Yn,Ut.memoize=Fr,Ut.merge=Bn,Ut.min=Zn,Ut.omit=jn,Ut.once=Ir,Ut.pairs=Fn,Ut.partial=qr,Ut.partialRight=Rr,Ut.pick=In,Ut.pluck=er,Ut.range=wr,Ut.reject=rr,Ut.rest=Er,Ut.shuffle=ir,Ut.sortBy=ur,Ut.tap=ti,Ut.throttle=Ur,Ut.times=Yr,Ut.toArray=ar,Ut.transform=qn,Ut.union=xr,Ut.uniq=Tr,Ut.unzip=Nr,Ut.values=Rn,Ut.where=fr,Ut.without=Cr,Ut.wrap=zr,Ut.zip=kr,Ut.zipObject=Lr,Ut.collect=Gn,Ut.drop=Er,Ut.each=Jn,Ut.extend=cn,Ut.methods=yn,Ut.object=Lr,Ut.select=Vn,Ut.tail=Er,Ut.unique=Tr,Vr(Ut),Ut.chain=Ut,Ut.prototype.chain=function(){return this},Ut.clone=hn,Ut.cloneDeep=pn,Ut.contains=zn,Ut.escape=Wr,Ut.every=Xn,Ut.find=$n,Ut.findIndex=hr,Ut.findKey=vn,Ut.has=bn,Ut.identity=Xr,Ut.indexOf=vr,Ut.isArguments=rn,Ut.isArray=sn,Ut.isBoolean=En,Ut.isDate=Sn,Ut.isElement=xn,Ut.isEmpty=Tn,Ut.isEqual=Nn,Ut.isFinite=Cn,Ut.isFunction=kn,Ut.isNaN=An,Ut.isNull=On,Ut.isNumber=Mn,Ut.isObject=Ln,Ut.isPlainObject=_n,Ut.isRegExp=Dn,Ut.isString=Pn,Ut.isUndefined=Hn,Ut.lastIndexOf=br,Ut.mixin=Vr,Ut.noConflict=$r,Ut.parseInt=Jr,Ut.random=Kr,Ut.reduce=tr,Ut.reduceRight=nr,Ut.result=Qr,Ut.runInContext=nt,Ut.size=sr,Ut.some=or,Ut.sortedIndex=Sr,Ut.template=Gr,Ut.unescape=Zr,Ut.uniqueId=ei,Ut.all=Xn,Ut.any=or,Ut.detect=$n,Ut.findWhere=$n,Ut.foldl=tr,Ut.foldr=nr,Ut.include=zn,Ut.inject=tr,gn(Ut,function(e,t){Ut.prototype[t]||(Ut.prototype[t]=function(){var t=[this.__wrapped__];return St.apply(t,arguments),e.apply(Ut,t)})}),Ut.first=pr,Ut.last=yr,Ut.take=pr,Ut.head=pr,gn(Ut,function(e,t){Ut.prototype[t]||(Ut.prototype[t]=function(t,n){var r=e(this.__wrapped__,t,n);return t==null||n&&typeof t!="function"?r:new zt(r)})}),Ut.VERSION="1.3.1",Ut.prototype.toString=ni,Ut.prototype.value=ri,Ut.prototype.valueOf=ri,an(["join","pop","shift"],function(e){var t=ft[e];Ut.prototype[e]=function(){return t.apply(this.__wrapped__,arguments)}}),an(["push","reverse","sort","unshift"],function(e){var t=ft[e];Ut.prototype[e]=function(){return t.apply(this.__wrapped__,arguments),this}}),an(["concat","slice","splice"],function(e){var t=ft[e];Ut.prototype[e]=function(){return new zt(t.apply(this.__wrapped__,arguments))}}),Wt.spliceObjects||an(["pop","shift","splice"],function(e){var t=ft[e],n=e=="splice";Ut.prototype[e]=function(){var e=this.__wrapped__,r=t.apply(e,arguments);return e.length===0&&delete e[0],n?new zt(r):r}}),Ut}var t,n=[],r=[],i=0,s={},o=+(new Date)+"",u=75,a=40,f=/\b__p \+= '';/g,l=/\b(__p \+=) '' \+/g,c=/(__e\(.*?\)|\b__t\)) \+\n'';/g,h=/&(?:amp|lt|gt|quot|#39);/g,p=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,d=/\w*$/,v=/<%=([\s\S]+?)%>/g,m=(m=/\bthis\b/)&&m.test(nt)&&m,g=" 	\f ﻿\n\r\u2028\u2029 ᠎             　",y=RegExp("^["+g+"]*0+(?=.$)"),b=/($^)/,w=/[&<>"']/g,E=/['\n\r\t\u2028\u2029\\]/g,S=["Array","Boolean","Date","Error","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setImmediate","setTimeout"],x=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],T=0,N="[object Arguments]",C="[object Array]",L="[object Boolean]",A="[object Date]",O="[object Error]",M="[object Function]",_="[object Number]",D="[object Object]",P="[object RegExp]",H="[object String]",B={};B[M]=!1,B[N]=B[C]=B[L]=B[A]=B[_]=B[D]=B[P]=B[H]=!0;var j={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,"undefined":!1},F={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},I=j[typeof exports]&&exports,q=j[typeof module]&&module&&module.exports==I&&module,R=j[typeof global]&&global;R&&(R.global===R||R.window===R)&&(e=R);var rt=nt();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(e._=rt,define("lodash",[],function(){return rt})):I&&!I.nodeType?q?(q.exports=rt)._=rt:I._=rt:e._=rt}(this),define("libs/backbone/backbone",["jQuery","underscore"],function(e,t){var n=t.extend({},this,{jQuery:e}),r=n.Backbone,i=[],s=i.push,o=i.slice,u=i.splice,a;typeof exports!="undefined"?a=exports:a=n.Backbone={},a.VERSION="1.0.0";var f=n._;!f&&typeof require!="undefined"&&(f=require("underscore")),a.$=n.jQuery||n.Zepto||n.ender||n.$,a.noConflict=function(){return n.Backbone=r,this},a.emulateHTTP=!1,a.emulateJSON=!1;var l=a.Events={on:function(e,t,n){if(!h(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,n){if(!h(this,"once",e,[t,n])||!t)return this;var r=this,i=f.once(function(){r.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,n)},off:function(e,t,n){var r,i,s,o,u,a,l,c;if(!this._events||!h(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events={},this;o=e?[e]:f.keys(this._events);for(u=0,a=o.length;u<a;u++){e=o[u];if(s=this._events[e]){this._events[e]=r=[];if(t||n)for(l=0,c=s.length;l<c;l++)i=s[l],(t&&t!==i.callback&&t!==i.callback._callback||n&&n!==i.context)&&r.push(i);r.length||delete this._events[e]}}return this},trigger:function(e){if(!this._events)return this;var t=o.call(arguments,1);if(!h(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&p(n,t),r&&p(r,arguments),this},stopListening:function(e,t,n){var r=this._listeners;if(!r)return this;var i=!t&&!n;typeof t=="object"&&(n=this),e&&((r={})[e._listenerId]=e);for(var s in r)r[s].off(t,n,this),i&&delete this._listeners[s];return this}},c=/\s+/,h=function(e,t,n,r){if(!n)return!0;if(typeof n=="object"){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(c.test(n)){var s=n.split(c);for(var o=0,u=s.length;o<u;o++)e[t].apply(e,[s[o]].concat(r));return!1}return!0},p=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,s);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o,u);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t)}},d={listenTo:"on",listenToOnce:"once"};f.each(d,function(e,t){l[t]=function(t,n,r){var i=this._listeners||(this._listeners={}),s=t._listenerId||(t._listenerId=f.uniqueId("l"));return i[s]=t,typeof n=="object"&&(r=this),t[e](n,r,this),this}}),l.bind=l.on,l.unbind=l.off,f.extend(a,l);var v=a.Model=function(e,t){var n,r=e||{};t||(t={}),this.cid=f.uniqueId("c"),this.attributes={},f.extend(this,f.pick(t,m)),t.parse&&(r=this.parse(r,t)||{});if(n=f.result(this,"defaults"))r=f.defaults({},r,n);this.set(r,t),this.changed={},this.initialize.apply(this,arguments)},m=["url","urlRoot","collection"];f.extend(v.prototype,l,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return f.clone(this.attributes)},sync:function(){return a.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return f.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,n){var r,i,s,o,u,a,l,c;if(e==null)return this;typeof e=="object"?(i=e,n=t):(i={})[e]=t,n||(n={});if(!this._validate(i,n))return!1;s=n.unset,u=n.silent,o=[],a=this._changing,this._changing=!0,a||(this._previousAttributes=f.clone(this.attributes),this.changed={}),c=this.attributes,l=this._previousAttributes,this.idAttribute in i&&(this.id=i[this.idAttribute]);for(r in i)t=i[r],f.isEqual(c[r],t)||o.push(r),f.isEqual(l[r],t)?delete this.changed[r]:this.changed[r]=t,s?delete c[r]:c[r]=t;if(!u){o.length&&(this._pending=!0);for(var h=0,p=o.length;h<p;h++)this.trigger("change:"+o[h],this,c[o[h]],n)}if(a)return this;if(!u)while(this._pending)this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,f.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,f.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!f.isEmpty(this.changed):f.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?f.clone(this.changed):!1;var t,n=!1,r=this._changing?this._previousAttributes:this.attributes;for(var i in e){if(f.isEqual(r[i],t=e[i]))continue;(n||(n={}))[i]=t}return n},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return f.clone(this._previousAttributes)},fetch:function(e){e=e?f.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,n=e.success;return e.success=function(r){if(!t.set(t.parse(r,e),e))return!1;n&&n(t,r,e),t.trigger("sync",t,r,e)},I(this,e),this.sync("read",this,e)},save:function(e,t,n){var r,i,s,o=this.attributes;e==null||typeof e=="object"?(r=e,n=t):(r={})[e]=t;if(r&&(!n||!n.wait)&&!this.set(r,n))return!1;n=f.extend({validate:!0},n);if(!this._validate(r,n))return!1;r&&n.wait&&(this.attributes=f.extend({},o,r)),n.parse===void 0&&(n.parse=!0);var u=this,a=n.success;return n.success=function(e){u.attributes=o;var t=u.parse(e,n);n.wait&&(t=f.extend(r||{},t));if(f.isObject(t)&&!u.set(t,n))return!1;a&&a(u,e,n),u.trigger("sync",u,e,n)},I(this,n),i=this.isNew()?"create":n.patch?"patch":"update",i==="patch"&&(n.attrs=r),s=this.sync(i,this,n),r&&n.wait&&(this.attributes=o),s},destroy:function(e){e=e?f.clone(e):{};var t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(i){(e.wait||t.isNew())&&r(),n&&n(t,i,e),t.isNew()||t.trigger("sync",t,i,e)};if(this.isNew())return e.success(),!1;I(this,e);var i=this.sync("delete",this,e);return e.wait||r(),i},url:function(){var e=f.result(this,"urlRoot")||f.result(this.collection,"url")||F();return this.isNew()?e:e+(e.charAt(e.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(e){return this._validate({},f.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=f.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return n?(this.trigger("invalid",this,n,f.extend(t||{},{validationError:n})),!1):!0}});var g=["keys","values","pairs","invert","pick","omit"];f.each(g,function(e){v.prototype[e]=function(){var t=o.call(arguments);return t.unshift(this.attributes),f[e].apply(f,t)}});var y=a.Collection=function(e,t){t||(t={}),t.url&&(this.url=t.url),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,f.extend({silent:!0},t))},b={add:!0,remove:!0,merge:!0},w={add:!0,merge:!1,remove:!1};f.extend(y.prototype,l,{model:v,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return a.sync.apply(this,arguments)},add:function(e,t){return this.set(e,f.defaults(t||{},w))},remove:function(e,t){e=f.isArray(e)?e.slice():[e],t||(t={});var n,r,i,s,o;for(n=0,r=e.length;n<r;n++){s=this.get(e[n]);if(!s)continue;delete this._byId[s.id],delete this._byId[s.cid],i=this.indexOf(s),this.models.splice(i,1),this.length--,o=!0,t.silent||(t.index=i,s.trigger("remove",s,this,t)),this._removeReference(s)}return!t.silent&&o&&this.trigger("update",this,t),this},set:function(e,t){t=f.defaults(t||{},b),t.parse&&(e=this.parse(e,t)),f.isArray(e)||(e=e?[e]:[]);var n,r,i,o,a,l,c=t.at,h=this.comparator&&c==null&&t.sort!==!1,p=f.isString(this.comparator)?this.comparator:null,d=[],v=[],m={};for(n=0,r=e.length;n<r;n++){if(!(i=this._prepareModel(e[n],t)))continue;(a=this.get(i))?(t.remove&&(m[a.cid]=!0),t.merge&&(a.set(i.attributes,t),h&&!l&&a.hasChanged(p)&&(l=!0))):t.add&&(d.push(i),i.on("all",this._onModelEvent,this),this._byId[i.cid]=i,i.id!=null&&(this._byId[i.id]=i))}if(t.remove){for(n=0,r=this.length;n<r;++n)m[(i=this.models[n]).cid]||v.push(i);v.length&&this.remove(v,t)}d.length&&(h&&(l=!0),this.length+=d.length,c!=null?u.apply(this.models,[c,0].concat(d)):s.apply(this.models,d)),l&&this.sort({silent:!0});if(t.silent)return this;for(n=0,r=d.length;n<r;n++)(i=d[n]).trigger("add",i,this,t);return l&&this.trigger("sort",this,t),(d.length||v.length)&&this.trigger("update",this,t),this},reset:function(e,t){t||(t={});for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n]);return t.previousModels=this.models,this._reset(),this.add(e,f.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,f.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,f.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return e==null?void 0:this._byId[e.id!=null?e.id:e.cid||e]},at:function(e){return this.models[e]},where:function(e,t){return f.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),f.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(f.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},sortedIndex:function(e,t,n){t||(t=this.comparator);var r=f.isFunction(t)?t:function(e){return e.get(t)};return f.sortedIndex(this.models,e,r,n)},pluck:function(e){return f.invoke(this.models,"get",e)},fetch:function(e){e=e?f.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success,n=this;return e.success=function(r){var i=e.reset?"reset":"set";n[i](r,e),t&&t(n,r,e),n.trigger("sync",n,r,e)},I(this,e),this.sync("read",this,e)},create:function(e,t){t=t?f.clone(t):{};if(!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var n=this,r=t.success;return t.success=function(i){t.wait&&n.add(e,t),r&&r(e,i,t)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof v)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var n=new this.model(e,t);return n._validate(e,t)?n:(this.trigger("invalid",this,e,t),!1)},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)}});var E=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];f.each(E,function(e){y.prototype[e]=function(){var t=o.call(arguments);return t.unshift(this.models),f[e].apply(f,t)}});var S=["groupBy","countBy","sortBy"];f.each(S,function(e){y.prototype[e]=function(t,n){var r=f.isFunction(t)?t:function(e){return e.get(t)};return f[e](this.models,r,n)}});var x=a.View=function(e){this.cid=f.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},T=/^(\S+)\s*(.*)$/,N=["model","collection","el","id","attributes","className","tagName","events"];f.extend(x.prototype,l,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof a.$?e:a.$(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=f.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var n=e[t];f.isFunction(n)||(n=this[e[t]]);if(!n)continue;var r=t.match(T),i=r[1],s=r[2];n=f.bind(n,this),i+=".delegateEvents"+this.cid,s===""?this.$el.on(i,n):this.$el.on(i,s,n)}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(e){this.options&&(e=f.extend({},f.result(this,"options"),e)),f.extend(this,f.pick(e,N)),this.options=e},_ensureElement:function(){if(!this.el){var e=f.extend({},f.result(this,"attributes"));this.id&&(e.id=f.result(this,"id")),this.className&&(e["class"]=f.result(this,"className"));var t=a.$("<"+f.result(this,"tagName")+">").attr(e);this.setElement(t,!1)}else this.setElement(f.result(this,"el"),!1)}}),a.sync=function(e,t,n){var r=C[e];f.defaults(n||(n={}),{emulateHTTP:a.emulateHTTP,emulateJSON:a.emulateJSON});var i={type:r,dataType:"json"};n.url||(i.url=f.result(t,"url")||F()),n.data==null&&t&&(e==="create"||e==="update"||e==="patch")&&(i.contentType="application/json",i.data=JSON.stringify(n.attrs||t.toJSON(n))),n.emulateJSON&&(i.contentType="application/x-www-form-urlencoded",i.data=i.data?{model:i.data}:{});if(n.emulateHTTP&&(r==="PUT"||r==="DELETE"||r==="PATCH")){i.type="POST",n.emulateJSON&&(i.data._method=r);var s=n.beforeSend;n.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r);if(s)return s.apply(this,arguments)}}i.type!=="GET"&&!n.emulateJSON&&(i.processData=!1),i.type==="PATCH"&&window.ActiveXObject&&(!window.external||!window.external.msActiveXFilteringEnabled)&&(i.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var o=n.xhr=a.ajax(f.extend(i,n));return t.trigger("request",t,o,n),o};var C={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};a.ajax=function(){return a.$.ajax.apply(a.$,arguments)};var k=a.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},L=/\((.*?)\)/g,A=/(\(\?)?:\w+/g,O=/\*\w+/g,M=/[\-{}\[\]+?.,\\\^$|#\s]/g;f.extend(k.prototype,l,{initialize:function(){},route:function(e,t,n){f.isRegExp(e)||(e=this._routeToRegExp(e)),f.isFunction(t)&&(n=t,t=""),n||(n=this[t]);var r=this;return a.history.route(e,function(i){var s=r._extractParameters(e,i);n&&n.apply(r,s),r.trigger.apply(r,["route:"+t].concat(s)),r.trigger("route",t,s),a.history.trigger("route",r,t,s)}),this},navigate:function(e,t){return a.history.navigate(e,t),this},_bindRoutes:function(){if(!this.routes)return;this.routes=f.result(this,"routes");var e,t=f.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(M,"\\$&").replace(L,"(?:$1)?").replace(A,function(e,t){return t?e:"([^/]+)"}).replace(O,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return f.map(n,function(e){return e?decodeURIComponent(e):null})}});var _=a.History=function(){this.handlers=[],f.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},D=/^[#\/]|\s+$/g,P=/^\/+|\/+$/g,H=/msie [\w.]+/,B=/\/$/;_.started=!1,f.extend(_.prototype,l,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(B,"");e.indexOf(n)||(e=e.substr(n.length))}else e=this.getHash();return e.replace(D,"")},start:function(e){if(_.started)throw new Error("Backbone.history has already been started");_.started=!0,this.options=f.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var t=this.getFragment(),n=document.documentMode,r=H.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);this.root=("/"+this.root+"/").replace(P,"/"),r&&this._wantsHashChange&&(this.iframe=a.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?a.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?a.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var i=this.location,s=i.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!s)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&s&&i.hash&&(this.fragment=this.getHash().replace(D,""),this.history.replaceState({},document.title,this.root+this.fragment+i.search));if(!this.options.silent)return this.loadUrl()},stop:function(){a.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),_.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),n=f.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return n},navigate:function(e,t){if(!_.started)return!1;if(!t||t===!0)t={trigger:t};e=this.getFragment(e||"");if(this.fragment===e)return;this.fragment=e;var n=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),a.history=new _;var j=function(e,t){var n=this,r;e&&f.has(e,"constructor")?r=e.constructor:r=function(){return n.apply(this,arguments)},f.extend(r,n,t);var i=function(){this.constructor=r};return i.prototype=n.prototype,r.prototype=new i,e&&f.extend(r.prototype,e),r.__super__=n.prototype,r};v.extend=y.extend=k.extend=x.extend=_.extend=j;var F=function(){throw new Error('A "url" property or function must be specified')},I=function(e,t){var n=t.error;t.error=function(r){n&&n(e,r,t),e.trigger("error",e,r,t)}};return a}),define("backbone-super",["backbone","underscore"],function(e,t){var n=e;n.Model.extend=n.Collection.extend=n.Router.extend=n.View.extend=function(e,t){var n=i(this,e,t);return n.extend=this.extend,n};var r=function(e){throw"Super does not implement this method: "+e},i=function(e,t,n){var i=function(){},s,o=e.prototype,u=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;t&&t.hasOwnProperty("constructor")?s=t.constructor:s=function(){e.apply(this,arguments)},_.extend(s,e),i.prototype=e.prototype,s.prototype=new i;if(t){_.extend(s.prototype,t);for(var a in t)typeof t[a]=="function"&&u.test(t[a])&&(s.prototype[a]=function(e,t){var n=function(){var n=this._super;this._super=o[e]||r(e);var i;try{i=t.apply(this,arguments)}finally{this._super=n}return i};for(var i in t)n[i]=t[i],delete t[i];return n}(a,t[a]))}return n&&_.extend(s,n),s.prototype.constructor=s,s.__super__=e.prototype,s}}),define("backbone-view-el",["backbone"],function(e){var t=e;t.View.prototype.onRender=function(){var e=this.$el.children(),t=this.$el;this.setElement(e),t.replaceWith(e)}}),define("touch",[],function(){function e(){return"ontouchstart"in window}return e()}),define("iPad",[],function(){function e(){return navigator.userAgent.match(/iPad/i)!=null}return e()}),define("ie8",[],function(){function e(){var e=-1;if(navigator.appName=="Microsoft Internet Explorer"){var t=navigator.userAgent,n=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");n.exec(t)!=null&&(e=parseFloat(RegExp.$1))}return e}return e()===8}),define("mobile-browser",[],function(){function e(){var e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego)|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return e()}),define("phone",["mobile-browser","jQuery"],function(e,t){function n(){return e&&t(window).width()<=480}return n()}),define("tablet",["mobile-browser","jQuery"],function(e,t){function n(){return e&&t(window).width()>480}return n()}),define("utils/util",["lodash","jQuery","touch","iPad","ie8","mobile-browser","phone","tablet"],function(e,t,n,r,i,s,o,u){var a={ajax:t.ajax,ajaxSetup:t.ajaxSetup,when:t.when,serializeForm:function(e){var t=a.reduce(a.uniq(e.serializeArray(),"name"),function(e,t){return e=a.objectifyKeyValue(t.name,t.value,e,"-"),e},{},this);return t},obtainUrlParameters:function(e){var t=/([\?\&]([\-\+;%@\.\w]*)=([\-\+;%@\.\w]*)*)/g,n=e?e.match(t):window.location.href.match(t),r=a.reduce(n,function(e,t){var n=t.split("="),r=decodeURIComponent(n[0].substr(1)),i=decodeURIComponent(n[1]);return e[r]=i,e},{},this);return r},obtainUrlParamsQueryString:function(e){var t={},n=e.split("&");for(var r=0;r<n.length;r++){var i=n[r].split("=");i[0]=decodeURIComponent(i[0]),i[1]=decodeURIComponent(i[1]);if(typeof t[i[0]]=="undefined")t[i[0]]=i[1];else if(typeof t[i[0]]=="string"){var s=[t[i[0]],i[1]];t[i[0]]=s}else t[i[0]].push(i[1])}return t},objectifyKeyValue:function(e,t,n,r){var i=e.split(r),s=n||{},o;return a.each(i,function(e,n){o=n+1<i.length?i[n+1]:null,o!==null?(isNaN(parseInt(o,10))?a.isPlainObject(s[e])||(s[e]={}):a.isArray(s[e])||(s[e]=[]),s=s[e]):s[e]=t},this),n},i18nObjectifyKeyValue:function(e,t,n,r){var i=e.split(r),s=n||{},o;return a.each(i,function(e,n){o=n+1<i.length?i[n+1]:null,o!==null?(a.isPlainObject(s[e])||(s[e]={}),s=s[e]):s[e]=t},this),n},objectify:function(e,t,n){var r={};return a.each(e,function(e,i){r=a.objectifyKeyValue(n?n+t+i:i,e,r,t);if(!a.isString(e)&&!a.isArray(e)){var s={};s[i]=a.objectify(e,t),a.extend(r,s)}},this),r},i18nObjectify:function(e,t,n){var r={};return a.each(e,function(e,i){r=a.i18nObjectifyKeyValue(n?n+t+i:i,e,r,t);if(!a.isString(e)&&!a.isArray(e)){var s={};s[i]=a.objectify(e,t),a.extend(r,s)}},this),r},Deferred:t.Deferred,param:function(e,n){function r(e,t){var n={};return t=t?a.isArray(e)?t:t+".":"",a.each(e,function(i,s){a.isArray(e)&&(s="["+s+"]"),a.isPlainObject(i)||a.isArray(i)?a.extend(n,r(i,t+s)):n[t+s]=i},this),n}var i=r(e);return t.param(i,n)},isEqual:e.isEqual,isArray:e.isArray,isPlainObject:e.isPlainObject,isBoolean:e.isBoolean,isEmpty:e.isEmpty,isFunction:e.isFunction,isNumber:e.isNumber,isString:e.isString,isDate:e.isDate,isiPad:function(){return r},isIE8:function(){return i},isTouch:function(){return n},isMobileBrowser:function(){return s},isPhone:function(){return o},isTablet:function(){return u},size:e.size,clone:e.clone,cloneDeep:e.cloneDeep,extend:e.extend,merge:e.merge,union:e.union,defaults:e.defaults,each:e.each,pluck:e.pluck,pick:e.pick,last:e.last,invoke:e.invoke,map:e.map,mapObj:function(e,t){var n={},r,i,s;for(r in e)e.hasOwnProperty(r)&&(i=e[r],s=t(r,i),s!=="undefined"&&(n[r]=s));return n},result:e.result,reduce:e.reduce,contains:e.contains,indexOf:e.indexOf,filter:e.filter,omit:e.omit,keys:e.keys,find:e.find,findKey:e.findKey,findIndex:e.findIndex,findKeyDeep:function(e,t){if(!e||!t)return null;var n=e,r=t.split("."),i=0,s=r.length;for(;i<s;i++){n=n[r[i]];if(!n)return null}return n},bind:e.bind,values:e.values,hyphenate:function(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()},camelCase:function(e){return e.replace(/-([a-z])/g,function(e){return e[1].toUpperCase()})},stripTags:function(e){return e.replace(/<\/?[^>]+(>|$)/g,"")},where:e.where,first:e.first,uniqueId:e.uniqueId,initial:e.initial,difference:e.difference,some:e.some,every:e.every,flatten:e.flatten,uniq:e.uniq,has:e.has,reject:e.reject,groupBy:e.groupBy,debounce:e.debounce,trim:function(e){return e?e.replace(/^\s+|\s+$/g,""):""},sortBy:e.sortBy,without:e.without,compact:e.compact,zipObject:e.zipObject,rest:e.rest,once:e.once,unicodeHTMLCodes:function(e){return typeof e!="string"?e:(e=e.replace(/&#([0-9]*);/g,function(e){var t=document.createElement("div");return t.innerHTML=e,t.childNodes[0].nodeValue}),e)},scroll:function(e){return e.parents("body, html").animate({scrollTop:e.offset().top}).promise()},apiURL:function(e){return this.config.getGlobals().environment.contextPath+e}};return a}),define("backbone-ajax",["backbone","utils/util"],function(e,t){return e.ajax=t.ajax,e}),define("backbone-adapter",["backbone","backbone-super","backbone-view-el","backbone-ajax"],function(e){return e}),define("classes/class",["backbone"],function(e){var t=function(){this.initialize.apply(this,arguments)};return t.prototype.initialize=function(){},t.extend=e.Model.extend,t}),define("classes/singleton",["classes/class","utils/util"],function(e,t){var n=e.extend({},{destroyInstance:function(){this._instance=undefined},getInstance:function(e){return this._instance===undefined&&(this._instance=this._applyToConstructor(this,e)),this._instance},_applyToConstructor:function(e,n){var r=t.bind(e,e,n);return new r}});return n.extend=function(){var t=e.extend.apply(this,arguments);return t._instance!==undefined&&delete t._instance,t},n}),define("libs/require-is/is-api",[],function(){var e={};return e.normalize=function(t,n){var r=e.parse(t);r.feature=n(r.feature),r.yesModuleId&&(r.yesModuleId=n(r.yesModuleId)),r.noModuleId&&(r.noModuleId=n(r.noModuleId));if(r.type=="lookup")return r.feature;r.yesBuild||(r.yesModuleId="["+r.yesModuleId+"]"),r.noBuild||(r.noModuleId="["+r.noModuleId+"]");if(r.type=="load_if_not")return"~"+r.feature+"?"+r.yesModuleId+(r.noModuleId?":"+r.noModuleId:"");if(r.type=="load_if")return r.feature+"?"+r.yesModuleId+(r.noModuleId?":"+r.noModuleId:"")},e.parse=function(e){var t=e.substr(0,e.indexOf("?")),n=e.substr(t.length+1,e.length-t.length-1),r=n.substr(0,n.indexOf(":"));n.substr(r.length+1,2)=="//"&&(r=n.substr(0,n.indexOf(":",r.length+1)));var i=n.substr(r.length+1,n.length-r.length-1);r==""&&(r=n,i=null);var s=!0,o=!0;return r&&r.substr(0,1)=="["&&r.substr(r.length-1,1)=="]"&&(r=r.substr(1,r.length-2),s=!1),i&&i.substr(0,1)=="["&&i.substr(i.length-1,1)=="]"&&(i=i.substr(1,i.length-2),o=!1),t==""?{feature:e,type:"lookup"}:t.substr(0,1)=="~"?{feature:t.substr(1,e.length-1),type:"load_if_not",yesModuleId:r,noModuleId:i,yesBuild:s,noBuild:o}:{feature:t,type:"load_if",yesModuleId:r,noModuleId:i,yesBuild:s,noBuild:o}},e}),define("libs/require-is/is",["module","./is-api","require"],function(e,t,n){return is={},is.pluginBuilder="./is-builder",is.normalize=t.normalize,is.features=e.config()||{},is.features.browser===undefined&&(is.features.browser=typeof window!="undefined"),is.features.build===undefined&&(is.features.build=!1),is.curModule=null,is.modules=null,is.empty=function(){return null},is.lookup=function(e,t){if(is.features[e]!==undefined){t(is.features[e]);return}n([e],function(n){if(n!==!0&&n!==!1)throw"Feature module "+e+" must return true or false.";is.features[e]=n,t(n)})},is.load=function(e,r,i,s){var o=t.parse(e);o.type=="lookup"&&is.lookup(o.feature,i),(o.type=="load_if"||o.type=="load_if_not")&&is.lookup(o.feature,function(e){e&&o.type=="load_if"||!e&&o.type=="load_if_not"?n([o.yesModuleId],i):!e&&o.type=="load_if"&&o.noModuleId||e&&o.type=="load_if_not"&&o.noModuleId?n([o.noModuleId],i):i(is.empty())})},is}),function(e,t){if(typeof exports=="object"){var n=require("underscore"),r=require("backbone");module.exports=t(n,r)}else typeof define=="function"&&define.amd&&define("backbone.wreqr",["underscore","backbone"],t)}(this,function(e,t){"use strict";return t.Wreqr=function(e,t,n){var r={};return r.Handlers=function(e,t){var n=function(e){this.options=e,this._wreqrHandlers={},t.isFunction(this.initialize)&&this.initialize(e)};return n.extend=e.Model.extend,t.extend(n.prototype,e.Events,{setHandlers:function(e){t.each(e,function(e,n){var r=null;t.isObject(e)&&!t.isFunction(e)&&(r=e.context,e=e.callback),this.setHandler(n,e,r)},this)},setHandler:function(e,t,n){var r={callback:t,context:n};this._wreqrHandlers[e]=r,this.trigger("handler:add",e,t,n)},hasHandler:function(e){return!!this._wreqrHandlers[e]},getHandler:function(e){var t=this._wreqrHandlers[e];if(!t)throw new Error("Handler not found for '"+e+"'");return function(){var e=Array.prototype.slice.apply(arguments);return t.callback.apply(t.context,e)}},removeHandler:function(e){delete this._wreqrHandlers[e]},removeAllHandlers:function(){this._wreqrHandlers={}}}),n}(e,n),r.CommandStorage=function(){var t=function(e){this.options=e,this._commands={},n.isFunction(this.initialize)&&this.initialize(e)};return n.extend(t.prototype,e.Events,{getCommands:function(e){var t=this._commands[e];return t||(t={command:e,instances:[]},this._commands[e]=t),t},addCommand:function(e,t){var n=this.getCommands(e);n.instances.push(t)},clearCommands:function(e){var t=this.getCommands(e);t.instances=[]}}),t}(),r.Commands=function(e){return e.Handlers.extend({storageType:e.CommandStorage,constructor:function(t){this.options=t||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this);var n=Array.prototype.slice.call(arguments);e.Handlers.prototype.constructor.apply(this,n)},execute:function(e,t){e=arguments[0],t=Array.prototype.slice.call(arguments,1),this.hasHandler(e)?this.getHandler(e).apply(this,t):this.storage.addCommand(e,t)},_executeCommands:function(e,t,r){var i=this.storage.getCommands(e);n.each(i.instances,function(e){t.apply(r,e)}),this.storage.clearCommands(e)},_initializeStorage:function(e){var t,r=e.storageType||this.storageType;n.isFunction(r)?t=new r:t=r,this.storage=t}})}(r),r.RequestResponse=function(e){return e.Handlers.extend({request:function(){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);return this.getHandler(e).apply(this,t)}})}(r),r.EventAggregator=function(e,t){var n=function(){};return n.extend=e.Model.extend,t.extend(n.prototype,e.Events),n}(e,n),r}(t,t.Marionette,e),t.Wreqr}),define("classes/event-aggregator",["backbone.wreqr"],function(e){var t=e.EventAggregator.extend({});return t}),define("classes/sf-error",["classes/class"],function(e){var t=e.extend({constructor:function(e){this.id=++t._idSeq,this._data=e,this.errorMessage="",this.errorTitle="",this.initialize.apply(this,arguments)},getErrorMessage:function(){return this.errorMessage},getErrorTitle:function(){return this.errorTitle}},{type:"SFError",_idSeq:0});return t}),define("data/i18n/i18n",["classes/singleton","utils/util"],function(e,t){var n=e.extend({url:"/i18n/get.action",initialize:function(){this._resources={}},_resolve:function(e,r){var i=e.split(n.KEY_SEPARATOR),s=this._resources;for(var o=0;o<i.length;o+=1){if(s[i[o]]===undefined)return null;s=s[i[o]]}return t.isString(s)&&(s=this._applyReplacement(s,r||{})),s},_applyReplacement:function(e,t){var r=null;if(e!==undefined)for(var i in t)r=new RegExp([n.PARAM_PREFIX,i,n.PARAM_SUFFIX].join(""),"g"),e=e.replace(r,t[i]);return e},_mergeResources:function(e){t.each(e,function(e,r){this._resources[r]=t.i18nObjectify(e,n.KEY_SEPARATOR)},this)},get:function(e,r){if(t.obtainUrlParameters().showKeys)return e;var i,s=e;do{i=this._resolve(s,r);if(i!=null)return i;s=s.replace(/[a-zA-Z0-9_\\\-]+\./,"")}while(s.indexOf(n.KEY_SEPARATOR)!=-1);return e},getDict:function(e){return this._resolve(e)},getDateDict:function(e){var t={};for(var n in e)t[n]=e[n].replace(/ /g,"").split(",");return t},load:function(e){var n=[],r=this,i=0,s=e.length,o=t.Deferred();for(;i<s;i++)this._resources[e[i]]||n.push(e[i]);if(n.length){var u={url:t.config.getGlobals().environment.contextPath+this.url,type:"get",dataType:"json",traditional:!1,data:{modules:n.join(",")},success:function(e){r.addResources(e),o.resolve(e)},error:function(e){console.log("[i18n] There was an error loading the i18n resources: %o",n),o.reject(e)}};return this.constructor.defaults.i18nVariant&&(u.data.variant=this.constructor.defaults.i18nVariant),t.ajax(u),o.promise()}return!0},addResources:function(e){this._mergeResources(e)},toLowerCase:function(e){return e.toLocaleLowerCase().replace(/ i /g,function(e){return e.toLocaleUpperCase()})}},{KEY_SEPARATOR:".",PARAM_PREFIX:"{",PARAM_SUFFIX:"}",defaults:{i18nVariant:null}});return n}),define("utils/i18n",["utils/util","data/i18n/i18n"],function(e,t){return e.i18n=t.getInstance(),e}),define("classes/remote-error",["classes/sf-error","utils/i18n"],function(e,t){var n=e.extend({initialize:function(){this._super.apply(this,arguments),this.errorMessage=t.i18n.get("common.errors.e"+this._data.status)}},{type:"RemoteError"});return n}),define("data/config/config",["classes/singleton","utils/util"],function(e,t){var n=e.extend({url:"/config/get.action",initialize:function(){this._resources={},this._globals=n.defaults},_mergeResources:function(e){for(var t in e)this._resources[t]=e[t]},setGlobals:function(e){return t.merge(this._globals,e),this._globals},getGlobals:function(){return this._globals},get:function(e){return this._resources[e]},load:function(e){var n=[],r=this,i=0,s=e.length,o=t.Deferred();for(;i<s;i++)this._resources[e[i]]||n.push(e[i]);if(n.length){var u={url:t.config.getGlobals().environment.contextPath+this.url,type:"get",dataType:"json",traditional:!1,data:{modules:n.join(",")},success:function(e){r._mergeResources(e),o.resolve(e)},error:function(){console.log("[config] There was an error loading the config resources"),o.fail()}};return this._globals.i18nVariant&&(u.data.variant=this._globals.i18nVariant),t.ajax(u),o.promise()}return!0}},{defaults:{i18nVariant:null,contrast:0,fontSize:0,viewType:0,environment:{contextPath:"/api",serverDate:null},format:{numberFormat:{decimalSeparator:",",groupingSeparator:".",groupingSize:3,maximumFractionDigits:2,minimumFractionDigits:2,negativePrefix:"-",negativeSuffix:" CUR",positivePrefix:"",positiveSuffix:" CUR",percentSuffix:"{{*}}"},dateFormat:{shortDate:"d/MM/yy",mediumDate:"dd-MMM-yyyy",longDate:"MMMM d, yyyy",shortMonthYear:"MMM yy",mediumMonthYear:"MMM yyyy",longMonthYear:"MMMM yyyy",backendDate:"yyyy-MM-dd"}},validator:{}}});return n}),define("utils/config",["utils/util","data/config/config"],function(e,t){return e.config=t.getInstance(),e}),define("classes/data-manager",["classes/singleton","classes/event-aggregator","classes/remote-error","utils/util","utils/config"],function(e,t,n,r){var i=e.extend({constructor:function(){this.clearData(),i.hub=i.hub||new t,this._destroy=r.bind(this._destroy,this),this.subscribe("destroy",this._destroy),this.initialize()},registerCollection:function(e,t){this.collectionDefs[e]=t},initCollections:function(e,t){r.each(e,function(e){this.initCollection(e.name,e.models,t)},this)},initCollection:function(e,t,n,r){this._collections[e]===undefined?this._createCollection(e,t):n&&this._collections[e].set(t),this.collectionDefs[e]._params=r||{}},getEventNamespace:function(){return i.EVENT_NAMESPACE},clearData:function(){this._collections={},this._models={},this.collectionDefs={},this.modelDefs={}},reset:function(){this.clearData(),this.initialize()},_popDeferreds:function(e){var t=this.collectionDefs[e]&&this.collectionDefs[e]._deferredQueue?this.collectionDefs[e]._deferredQueue.pop():null,n=this;t&&(console.log('[DataManager] "%s" queued request being now fulfilled.',e),r.when(this.getCollection.apply(this,t.args)).then(function(){t.def.resolve(n._collections[e])}).fail(function(){t.def.fail()}).always(function(){n._popDeferreds(e)}))},_rejectDeferreds:function(e,t){var n=this.collectionDefs[e]._deferredQueue.pop();while(n)console.error('[DataManager] "%s" queued request has to be rejected.',e,t),n.def.reject(t),n=this.collectionDefs[e]._deferredQueue.pop()},subscribe:function(e,t){i.hub.on(e,t)},unsubscribe:function(e){i.hub.off(e)},publish:function(e){i.hub.trigger(e)},_createCollection:function(e,t){var n=this,s=this.collectionDefs[e],o;s.subscriptions?s.subscriptions.push("data:update"):s.subscriptions=["data:update"],this._collections[e]=new s.type(t),s._params={},s._deferredQueue=[],s._currentState={loadError:!1},r.each(s.subscriptions,function(t){this.subscribe(t,r.debounce(function(){console.log("[DataManager] Event %s triggered a refresh of %s collection",t,e);if(s.loader){var i=s.loader;o=r.extend({},i.params||s._params,{force:!0}),r.when(i.method.apply(i.context,[o])).then(function(){n._collections[e].trigger("change")})}else o=r.extend({},s._params,{force:!0}),r.when(n.getCollection(e,o)).then(function(){n._collections[e].trigger("change")})},i.MINIMUM_REFRESH_WAIT))},this),this._collections[e].on("change",function(t,n){t!==undefined&&this.collectionDefs[e].modelUpdated&&this.collectionDefs[e].modelUpdated.call(this,t,n)},this),this._collections[e].on("remove",function(t){this.collectionDefs[e].modelRemoved&&this.collectionDefs[e].modelRemoved.call(this,t)},this),this._collections[e].on("add",function(t){this.collectionDefs[e].modelAdded&&this.collectionDefs[e].modelAdded.call(this,t)},this)},getCollection:function(e,t){console.log("[DataManager] Collection %s requested with params %o",e,t),t=t||{};var n=this,i={force:!!t.force,remove:!!t.remove,reset:!!t.force,load:!1},s=r.Deferred();if(this._collections[e]===undefined||this.collectionDefs[e]._currentState.loadError===!0)this._createCollection(e),i.load=!0;if(this.collectionDefs[e].loading)console.log("[DataManager] Collection %s requested while being already retrieved. Queueing request.",e),this.collectionDefs[e]._deferredQueue.unshift({args:arguments,def:s});else{this.evaluateRequestParams(e,t,i);if(i.load||i.force){var o=this.getRequestData(e,t,i);return console.log("[DataManager] Remote request necessary for %s with params %o",e,t),this.fetchCollection(e,o,i,t)}console.log("[DataManager] No remote request needed for %s with params %o",e,t),setTimeout(function(){s.resolve(n._collections[e])})}return s.promise()},fetchCollection:function(e,t,i,s){this.collectionDefs[e].loading=!0;var o=this,u=new r.Deferred;return r.isFunction(this._collections[e].url)?i.url=r.config.getGlobals().environment.contextPath+this._collections[e].url(s,i):i.url=r.config.getGlobals().environment.contextPath+this._collections[e].url,i.remove=i.force||i.remove,typeof t=="object"&&(i.data=t),r.when(this._collections[e].fetch(i)).done(function(){o.collectionDefs[e].loading=!1,o.collectionDefs[e]._currentState.loadError=!1,o.onCollectionFetched(e,t,i),u.resolve(o._collections[e]),o._popDeferreds(e)}).fail(function(t){o.collectionDefs[e].loading=!1,o.collectionDefs[e]._currentState.loadError=!0,console.error("[DataManager] Error fetching collection %s: ",e,t);var r=new n(t);u.reject(r),o._rejectDeferreds(e,r)}),u.promise()},evaluateRequestParams:function(){},onCollectionFetched:function(){},getRequestData:function(e,t){return t},_destroy:function(){this.reset()}},{MINIMUM_REFRESH_WAIT:300});return i}),function(e,t){if(typeof exports=="object"){var n=require("underscore"),r=require("backbone");module.exports=t(n,r)}else typeof define=="function"&&define.amd&&define("backbone.babysitter",["underscore","backbone"],t)}(this,function(e,t){"option strict";return t.ChildViewContainer=function(e,t){var n=function(e){this._views={},this._indexByModel={},this._indexByCollection={},this._indexByCustom={},this._updateLength(),this._addInitialViews(e)};t.extend(n.prototype,{add:function(e,t){var n=e.cid;this._views[n]=e,e.model&&(this._indexByModel[e.model.cid]=n),e.collection&&(this._indexByCollection[e.collection.cid]=n),t&&(this._indexByCustom[t]=n),this._updateLength()},findByModel:function(e){var t=this._indexByModel[e.cid];return this.findByCid(t)},findByCollection:function(e){var t=this._indexByCollection[e.cid];return this.findByCid(t)},findByCustom:function(e){var t=this._indexByCustom[e];return this.findByCid(t)},findByIndex:function(e){return t.values(this._views)[e]},findByCid:function(e){return this._views[e]},remove:function(e){var t=e.cid;e.model&&delete this._indexByModel[e.model.cid],e.collection&&delete this._indexByCollection[e.collection.cid];var n;for(var r in this._indexByCustom)if(this._indexByCustom.hasOwnProperty(r)&&this._indexByCustom[r]===t){n=r;break}n&&delete this._indexByCustom[n],delete this._views[t],this._updateLength()},call:function(e,t){t=Array.prototype.slice.call(arguments,1),this.apply(e,t)},apply:function(e,n){var r;n=n||[],t.each(this._views,function(r,i){t.isFunction(r[e])&&r[e].apply(r,n)})},_updateLength:function(){this.length=t.size(this._views)},_addInitialViews:function(e){if(!e)return;var t,n,r=e.length;for(n=0;n<r;n++)t=e[n],this.add(t)}});var r=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];return t.each(r,function(e){n.prototype[e]=function(){var n=t.values(this._views),r=[n].concat(t.toArray(arguments));return t[e].apply(t,r)}}),n}(t,e),t.ChildViewContainer}),function(e,t){if(typeof exports=="object"){var n=require("underscore"),r=require("backbone"),i=require("backbone.wreqr"),s=require("backbone.babysitter");module.exports=t(n,r,i,s)}else typeof define=="function"&&define.amd&&define("marionette",["underscore","backbone","backbone.wreqr","backbone.babysitter"],t)}(this,function(e,t){var n=function(e,t,n){"use strict";function s(e){return i.call(e)}function o(e,t){var n=new Error(e);throw n.name=t||"Error",n}var r={};t.Marionette=r,r.$=t.$;var i=Array.prototype.slice;return r.extend=t.Model.extend,r.getOption=function(e,t){if(!e||!t)return;var n;return e.options&&t in e.options&&e.options[t]!==undefined?n=e.options[t]:n=e[t],n},r.triggerMethod=function(){function t(e,t,n){return n.toUpperCase()}var e=/(^|:)(\w)/gi,r=function(r){var i="on"+r.replace(e,t),s=this[i];n.isFunction(this.trigger)&&this.trigger.apply(this,arguments);if(n.isFunction(s))return s.apply(this,n.tail(arguments))};return r}(),r.MonitorDOMRefresh=function(){function e(e){e._isShown=!0,r(e)}function t(e){e._isRendered=!0,r(e)}function r(e){e._isShown&&e._isRendered&&n.isFunction(e.triggerMethod)&&e.triggerMethod("dom:refresh")}return function(n){n.listenTo(n,"show",function(){e(n)}),n.listenTo(n,"render",function(){t(n)})}}(),function(e){function t(e,t,r,i){var s=i.split(/\s+/);n.each(s,function(n){var i=e[n];i||o("Method '"+n+"' was configured as an event handler, but does not exist."),e.listenTo(t,r,i,e)})}function r(e,t,n,r){e.listenTo(t,n,r,e)}function i(e,t,r,i){var s=i.split(/\s+/);n.each(s,function(n){var i=e[n];e.stopListening(t,r,i,e)})}function s(e,t,n,r){e.stopListening(t,n,r,e)}function u(e,t,r,i,s){if(!t||!r)return;n.isFunction(r)&&(r=r.call(e)),n.each(r,function(r,o){n.isFunction(r)?i(e,t,o,r):s(e,t,o,r)})}e.bindEntityEvents=function(e,n,i){u(e,n,i,r,t)},e.unbindEntityEvents=function(e,t,n){u(e,t,n,s,i)}}(r),r.Callbacks=function(){this._deferred=r.$.Deferred(),this._callbacks=[]},n.extend(r.Callbacks.prototype,{add:function(e,t){this._callbacks.push({cb:e,ctx:t}),this._deferred.done(function(n,r){t&&(n=t),e.call(n,r)})},run:function(e,t){this._deferred.resolve(t,e)},reset:function(){var e=this._callbacks;this._deferred=r.$.Deferred(),this._callbacks=[],n.each(e,function(e){this.add(e.cb,e.ctx)},this)}}),r.Controller=function(e){this.triggerMethod=r.triggerMethod,this.options=e||{},n.isFunction(this.initialize)&&this.initialize(this.options)},r.Controller.extend=r.extend,n.extend(r.Controller.prototype,t.Events,{close:function(){this.stopListening(),this.triggerMethod("close"),this.unbind()}}),r.Region=function(e){this.options=e||{},this.el=r.getOption(this,"el");if(!this.el){var t=new Error("An 'el' must be specified for a region.");throw t.name="NoElError",t}if(this.initialize){var n=Array.prototype.slice.apply(arguments);this.initialize.apply(this,n)}},n.extend(r.Region,{buildRegion:function(e,t){var r=typeof e=="string",i=typeof e.selector=="string",s=typeof e.regionType=="undefined",o=typeof e=="function";if(!o&&!r&&!i)throw new Error("Region must be specified as a Region type, a selector string or an object with selector property");var u,a;r&&(u=e),e.selector&&(u=e.selector),o&&(a=e),!o&&s&&(a=t),e.regionType&&(a=e.regionType);var f=new a({el:u});return e.parentEl&&(f.getEl=function(t){var r=e.parentEl;return n.isFunction(r)&&(r=r()),r.find(t)}),f}}),n.extend(r.Region.prototype,t.Events,{show:function(e){this.ensureEl();var t=e.isClosed||n.isUndefined(e.$el),i=e!==this.currentView;i&&this.close(),e.render(),(i||t)&&this.open(e),this.currentView=e,r.triggerMethod.call(this,"show",e),r.triggerMethod.call(e,"show")},ensureEl:function(){if(!this.$el||this.$el.length===0)this.$el=this.getEl(this.el)},getEl:function(e){return r.$(e)},open:function(e){this.$el.empty().append(e.el)},close:function(){var e=this.currentView;if(!e||e.isClosed)return;e.close?e.close():e.remove&&e.remove(),r.triggerMethod.call(this,"close"),delete this.currentView},attachView:function(e){this.currentView=e},reset:function(){this.close(),delete this.$el}}),r.Region.extend=r.extend,r.RegionManager=function(e){var t=e.Controller.extend({constructor:function(t){this._regions={},e.Controller.prototype.constructor.call(this,t)},addRegions:function(e,t){var r={};return n.each(e,function(e,i){typeof e=="string"&&(e={selector:e}),e.selector&&(e=n.defaults({},e,t));var s=this.addRegion(i,e);r[i]=s},this),r},addRegion:function(t,r){var i,s=n.isObject(r),o=n.isString(r),u=!!r.selector;return o||s&&u?i=e.Region.buildRegion(r,e.Region):n.isFunction(r)?i=e.Region.buildRegion(r,e.Region):i=r,this._store(t,i),this.triggerMethod("region:add",t,i),i},get:function(e){return this._regions[e]},removeRegion:function(e){var t=this._regions[e];this._remove(e,t)},removeRegions:function(){n.each(this._regions,function(e,t){this._remove(t,e)},this)},closeRegions:function(){n.each(this._regions,function(e,t){e.close()},this)},close:function(){this.removeRegions();var t=Array.prototype.slice.call(arguments);e.Controller.prototype.close.apply(this,t)},_store:function(e,t){this._regions[e]=t,this._setLength()},_remove:function(e,t){t.close(),delete this._regions[e],this._setLength(),this.triggerMethod("region:remove",e,t)},_setLength:function(){this.length=n.size(this._regions)}}),r=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];return n.each(r,function(e){t.prototype[e]=function(){var t=n.values(this._regions),r=[t].concat(n.toArray(arguments));return n[e].apply(n,r)}}),t}(r),r.TemplateCache=function(e){this.templateId=e},n.extend(r.TemplateCache,{templateCaches:{},get:function(e){var t=this.templateCaches[e];return t||(t=new r.TemplateCache(e),this.templateCaches[e]=t),t.load()},clear:function(){var e,t=s(arguments),n=t.length;if(n>0)for(e=0;e<n;e++)delete this.templateCaches[t[e]];else this.templateCaches={}}}),n.extend(r.TemplateCache.prototype,{load:function(){if(this.compiledTemplate)return this.compiledTemplate;var e=this.loadTemplate(this.templateId);return this.compiledTemplate=this.compileTemplate(e),this.compiledTemplate},loadTemplate:function(e){var t=r.$(e).html();return(!t||t.length===0)&&o("Could not find template: '"+e+"'","NoTemplateError"),t},compileTemplate:function(e){return n.template(e)}}),r.Renderer={render:function(e,t){if(!e){var n=new Error("Cannot render the template since it's false, null or undefined.");throw n.name="TemplateNotFoundError",n}var i;return typeof e=="function"?i=e:i=r.TemplateCache.get(e),i(t)}},r.View=t.View.extend({constructor:function(e){n.bindAll(this,"render");var i=Array.prototype.slice.apply(arguments);this.options=e||{},t.View.prototype.constructor.apply(this,i),r.MonitorDOMRefresh(this),this.listenTo(this,"show",this.onShowCalled,this)},triggerMethod:r.triggerMethod,getTemplate:function(){return r.getOption(this,"template")},mixinTemplateHelpers:function(e){e=e||{};var t=r.getOption(this,"templateHelpers");return n.isFunction(t)&&(t=t.call(this)),n.extend(e,t)},configureTriggers:function(){if(!this.triggers)return;var e={},t=n.result(this,"triggers");return n.each(t,function(t,r){var i=n.isObject(t),s=i?t.event:t;e[r]=function(e){if(e){var n=e.preventDefault,r=e.stopPropagation,o=i?t.preventDefault:n,u=i?t.stopPropagation:r;o&&n&&n.apply(e),u&&r&&r.apply(e)}var a={view:this,model:this.model,collection:this.collection};this.triggerMethod(s,a)}},this),e},delegateEvents:function(e){this._delegateDOMEvents(e),r.bindEntityEvents(this,this.model,r.getOption(this,"modelEvents")),r.bindEntityEvents(this,this.collection,r.getOption(this,"collectionEvents"))},_delegateDOMEvents:function(e){e=e||this.events,n.isFunction(e)&&(e=e.call(this));var r={},i=this.configureTriggers();n.extend(r,e,i),t.View.prototype.delegateEvents.call(this,r)},undelegateEvents:function(){var e=Array.prototype.slice.call(arguments);t.View.prototype.undelegateEvents.apply(this,e),r.unbindEntityEvents(this,this.model,r.getOption(this,"modelEvents")),r.unbindEntityEvents(this,this.collection,r.getOption(this,"collectionEvents"))},onShowCalled:function(){},close:function(){if(this.isClosed)return;var e=this.triggerMethod("before:close");if(e===!1)return;this.isClosed=!0,this.triggerMethod("close"),this.unbindUIElements(),this.remove()},bindUIElements:function(){if(!this.ui)return;this._uiBindings||(this._uiBindings=this.ui);var e=n.result(this,"_uiBindings");this.ui={},n.each(n.keys(e),function(t){var n=e[t];this.ui[t]=this.$(n)},this)},unbindUIElements:function(){if(!this.ui||!this._uiBindings)return;n.each(this.ui,function(e,t){delete this.ui[t]},this),this.ui=this._uiBindings,delete this._uiBindings}}),r.ItemView=r.View.extend({constructor:function(){r.View.prototype.constructor.apply(this,s(arguments))},serializeData:function(){var e={};return this.model?e=this.model.toJSON():this.collection&&(e={items:this.collection.toJSON()}),e},render:function(){this.isClosed=!1,this.triggerMethod("before:render",this),this.triggerMethod("item:before:render",this);var e=this.serializeData();e=this.mixinTemplateHelpers(e);var t=this.getTemplate(),n=r.Renderer.render(t,e);return this.$el.html(n),this.bindUIElements(),this.triggerMethod("render",this),this.triggerMethod("item:rendered",this),this},close:function(){if(this.isClosed)return;this.triggerMethod("item:before:close"),r.View.prototype.close.apply(this,s(arguments)),this.triggerMethod("item:closed")}}),r.CollectionView=r.View.extend({itemViewEventPrefix:"itemview",constructor:function(e){this._initChildViewStorage(),r.View.prototype.constructor.apply(this,s(arguments)),this._initialEvents()},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this.addChildView,this),this.listenTo(this.collection,"remove",this.removeItemView,this),this.listenTo(this.collection,"reset",this.render,this))},addChildView:function(e,t,n){this.closeEmptyView();var r=this.getItemView(e),i=this.collection.indexOf(e);this.addItemView(e,r,i)},onShowCalled:function(){this.children.each(function(e){r.triggerMethod.call(e,"show")})},triggerBeforeRender:function(){this.triggerMethod("before:render",this),this.triggerMethod("collection:before:render",this)},triggerRendered:function(){this.triggerMethod("render",this),this.triggerMethod("collection:rendered",this)},render:function(){return this.isClosed=!1,this.triggerBeforeRender(),this._renderChildren(),this.triggerRendered(),this},_renderChildren:function(){this.closeEmptyView(),this.closeChildren(),this.collection&&this.collection.length>0?this.showCollection():this.showEmptyView()},showCollection:function(){var e;this.collection.each(function(t,n){e=this.getItemView(t),this.addItemView(t,e,n)},this)},showEmptyView:function(){var e=this.getEmptyView();if(e&&!this._showingEmptyView){this._showingEmptyView=!0;var n=new t.Model;this.addItemView(n,e,0)}},closeEmptyView:function(){this._showingEmptyView&&(this.closeChildren(),delete this._showingEmptyView)},getEmptyView:function(){return r.getOption(this,"emptyView")},getItemView:function(e){var t=r.getOption(this,"itemView");return t||o("An `itemView` must be specified","NoItemViewError"),t},addItemView:function(e,t,i){var s=r.getOption(this,"itemViewOptions");n.isFunction(s)&&(s=s.call(this,e,i));var o=this.buildItemView(e,t,s);this.addChildViewEventForwarding(o),this.triggerMethod("before:item:added",o),this.children.add(o),this.renderItemView(o,i),this._isShown&&r.triggerMethod.call(o,"show"),this.triggerMethod("after:item:added",o)},addChildViewEventForwarding:function(e){var t=r.getOption(this,"itemViewEventPrefix");this.listenTo(e,"all",function(){var n=s(arguments);n[0]=t+":"+n[0],n.splice(1,0,e),r.triggerMethod.apply(this,n)},this)},renderItemView:function(e,t){e.render(),this.appendHtml(this,e,t)},buildItemView:function(e,t,r){var i=n.extend({model:e},r);return new t(i)},removeItemView:function(e){var t=this.children.findByModel(e);this.removeChildView(t),this.checkEmpty()},removeChildView:function(e){e&&(this.stopListening(e),e.close?e.close():e.remove&&e.remove(),this.children.remove(e)),this.triggerMethod("item:removed",e)},checkEmpty:function(){(!this.collection||this.collection.length===0)&&this.showEmptyView()},appendHtml:function(e,t,n){e.$el.append(t.el)},_initChildViewStorage:function(){this.children=new t.ChildViewContainer},close:function(){if(this.isClosed)return;this.triggerMethod("collection:before:close"),this.closeChildren(),this.triggerMethod("collection:closed"),r.View.prototype.close.apply(this,s(arguments))},closeChildren:function(){this.children.each(function(e){this.removeChildView(e)},this),this.checkEmpty()}}),r.CompositeView=r.CollectionView.extend({constructor:function(){r.CollectionView.prototype.constructor.apply(this,s(arguments))},_initialEvents:function(){this.once("render",function(){this.collection&&(this.listenTo(this.collection,"add",this.addChildView,this),this.listenTo(this.collection,"remove",this.removeItemView,this),this.listenTo(this.collection,"reset",this._renderChildren,this))})},getItemView:function(e){var t=r.getOption(this,"itemView")||this.constructor;return t||o("An `itemView` must be specified","NoItemViewError"),t},serializeData:function(){var e={};return this.model&&(e=this.model.toJSON()),e},render:function(){this.isRendered=!0,this.isClosed=!1,this.resetItemViewContainer(),this.triggerBeforeRender();var e=this.renderModel();return this.$el.html(e),this.bindUIElements(),this.triggerMethod("composite:model:rendered"),this._renderChildren(),this.triggerMethod("composite:rendered"),this.triggerRendered(),this},_renderChildren:function(){this.isRendered&&(r.CollectionView.prototype._renderChildren.call(this),this.triggerMethod("composite:collection:rendered"))},renderModel:function(){var e={};e=this.serializeData(),e=this.mixinTemplateHelpers(e);var t=this.getTemplate();return r.Renderer.render(t,e)},appendHtml:function(e,t,n){var r=this.getItemViewContainer(e);r.append(t.el)},getItemViewContainer:function(e){if("$itemViewContainer"in e)return e.$itemViewContainer;var t,i=r.getOption(e,"itemViewContainer");if(i){var s=n.isFunction(i)?i():i;t=e.$(s),t.length<=0&&o("The specified `itemViewContainer` was not found: "+e.itemViewContainer,"ItemViewContainerMissingError")}else t=e.$el;return e.$itemViewContainer=t,t},resetItemViewContainer:function(){this.$itemViewContainer&&delete this.$itemViewContainer}}),r.Layout=r.ItemView.extend({regionType:r.Region,constructor:function(e){e=e||{},this._firstRender=!0,this._initializeRegions(e),r.ItemView.prototype.constructor.call(this,e)},render:function(){this.isClosed&&this._initializeRegions(),this._firstRender?this._firstRender=!1:this.isClosed||this._reInitializeRegions();var e=Array.prototype.slice.apply(arguments),t=r.ItemView.prototype.render.apply(this,e);return t},close:function(){if(this.isClosed)return;this.regionManager.close();var e=Array.prototype.slice.apply(arguments);r.ItemView.prototype.close.apply(this,e)},addRegion:function(e,t){var n={};return n[e]=t,this._buildRegions(n)[e]},addRegions:function(e){return this.regions=n.extend({},this.regions,e),this._buildRegions(e)},removeRegion:function(e){return delete this.regions[e],this.regionManager.removeRegion(e)},_buildRegions:function(e){var t=this,n={regionType:r.getOption(this,"regionType"),parentEl:function(){return t.$el}};return this.regionManager.addRegions(e,n)},_initializeRegions:function(e){var t;this._initRegionManager(),n.isFunction(this.regions)?t=this.regions(e):t=this.regions||{},this.addRegions(t)},_reInitializeRegions:function(){this.regionManager.closeRegions(),this.regionManager.each(function(e){e.reset()})},_initRegionManager:function(){this.regionManager=new r.RegionManager,this.listenTo(this.regionManager,"region:add",function(e,t){this[e]=t,this.trigger("region:add",e,t)}),this.listenTo(this.regionManager,"region:remove",function(e,t){delete this[e],this.trigger("region:remove",e,t)})}}),r.AppRouter=t.Router.extend({constructor:function(e){t.Router.prototype.constructor.apply(this,s(arguments)),this.options=e||{};var n=r.getOption(this,"appRoutes"),i=this._getController();this.processAppRoutes(i,n)},appRoute:function(e,t){var n=this._getController();this._addAppRoute(n,e,t)},processAppRoutes:function(e,t){if(!t)return;var r=n.keys(t).reverse();n.each(r,function(n){this._addAppRoute(e,n,t[n])},this)},_getController:function(){return r.getOption(this,"controller")},_addAppRoute:function(e,t,r){var i=e[r];if(!i)throw new Error("Method '"+r+"' was not found on the controller");this.route(t,r,n.bind(i,e))}}),r.Application=function(e){this._initRegionManager(),this._initCallbacks=new r.Callbacks,this.vent=new t.Wreqr.EventAggregator,this.commands=new t.Wreqr.Commands,this.reqres=new t.Wreqr.RequestResponse,this.submodules={},n.extend(this,e),this.triggerMethod=r.triggerMethod},n.extend(r.Application.prototype,t.Events,{execute:function(){var e=Array.prototype.slice.apply(arguments);this.commands.execute.apply(this.commands,e)},request:function(){var e=Array.prototype.slice.apply(arguments);return this.reqres.request.apply(this.reqres,e)},addInitializer:function(e){this._initCallbacks.add(e)},start:function(e){this.triggerMethod("initialize:before",e),this._initCallbacks.run(e,this),this.triggerMethod("initialize:after",e),this.triggerMethod("start",e)},addRegions:function(e){return this._regionManager.addRegions(e)},closeRegions:function(){this._regionManager.closeRegions()},removeRegion:function(e){this._regionManager.removeRegion(e)},getRegion:function(e){return this._regionManager.get(e)},module:function(e,t){var n=s(arguments);return n.unshift(this),r.Module.create.apply(r.Module,n)},_initRegionManager:function(){this._regionManager=new r.RegionManager,this.listenTo(this._regionManager,"region:add",function(e,t){this[e]=t}),this.listenTo(this._regionManager,"region:remove",function(e,t){delete this[e]})}}),r.Application.extend=r.extend,r.Module=function(e,t){this.moduleName=e,this.submodules={},this._setupInitializersAndFinalizers(),this.app=t,this.startWithParent=!0,this.triggerMethod=r.triggerMethod},n.extend(r.Module.prototype,t.Events,{addInitializer:function(e){this._initializerCallbacks.add(e)},addFinalizer:function(e){this._finalizerCallbacks.add(e)},start:function(e){if(this._isInitialized)return;n.each(this.submodules,function(t){t.startWithParent&&t.start(e)}),this.triggerMethod("before:start",e),this._initializerCallbacks.run(e,this),this._isInitialized=!0,this.triggerMethod("start",e)},stop:function(){if(!this._isInitialized)return;this._isInitialized=!1,r.triggerMethod.call(this,"before:stop"),n.each(this.submodules,function(e){e.stop()}),this._finalizerCallbacks.run(undefined,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),r.triggerMethod.call(this,"stop")},addDefinition:function(e,t){this._runModuleDefinition(e,t)},_runModuleDefinition:function(e,i){if(!e)return;var s=n.flatten([this,this.app,t,r,r.$,n,i]);e.apply(this,s)},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new r.Callbacks,this._finalizerCallbacks=new r.Callbacks}}),n.extend(r.Module,{create:function(e,t,r){var i=e,o=s(arguments);o.splice(0,3),t=t.split(".");var u=t.length,a=[];return a[u-1]=r,n.each(t,function(t,n){var r=i;i=this._getModule(r,t,e),this._addModuleDefinition(r,i,a[n],o)},this),i},_getModule:function(e,t,n,i,s){var o=e[t];return o||(o=new r.Module(t,n),e[t]=o,e.submodules[t]=o),o},_addModuleDefinition:function(e,t,r,i){var s,o;n.isFunction(r)?(s=r,o=!0):n.isObject(r)?(s=r.define,o=r.startWithParent):o=!0,s&&t.addDefinition(s,i),t.startWithParent=t.startWithParent&&o,t.startWithParent&&!t.startWithParentIsConfigured&&(t.startWithParentIsConfigured=!0,e.addInitializer(function(e){t.startWithParent&&t.start(e)}))}}),r}(this,t,e);return t.Marionette}),define("marionette-asynchronous",["underscore","marionette"],function(e,t){return t.Region.prototype.show=function(n){this.ensureEl();var r=n.isClosed||e.isUndefined(n.$el),i=n!==this.currentView;i&&this.close(),n.once("item:rendered collection:rendered",function(){(i||r)&&this.open(n),this.currentView=n,t.triggerMethod.call(this,"show",n),t.triggerMethod.call(n,"show")},this),n.render()},t}),define("marionette-adapter",["marionette","marionette-asynchronous"],function(e){return e}),define("classes/region-manager",["marionette"],function(e){var t=e.RegionManager.extend({});return t}),define("classes/resource-loader",["classes/class","utils/util"],function(e,t){var n=e.extend({constructor:function(e,t){this.loaded=!1,this.context=e,this.func=t,this.params=Array.prototype.slice.call(arguments,2),this.data=null},load:function(){var e=this,n=new t.Deferred;return t.when(this.func.apply(this.context,this.params)).done(function(t){t!==null&&t!==undefined?(e.loaded=!0,e.data=t,n.resolve(e)):(e.loaded=!1,n.reject())}).fail(function(t){console.error("[ResourceLoader] Error loading resource",t),e.loaded=!1,n.reject(t)}),this.loaded?this:n.promise()}});return n}),define("data/locale/locale",["classes/singleton","utils/util"],function(e,t){var n=e.extend({initialize:function(){this._super.apply(this,arguments),this._config=this._getDefaults(),this.id="dev"},_getDefaults:function(){return t.cloneDeep(this.constructor.defaults)},get:function(e){return e&&this._config[e]?this._config[e]:{}},defaults:function(){return this._config["*"]},config:function(e){return t.merge({},this.defaults(),this.get(e))},setLocale:function(e){return this._config=t.merge(this._getDefaults(),this.constructor[e]),this.id=e,this}},{defaults:{"*":{textDirection:"ltr",axisDirection:"auto",timeDirection:"auto",yAxisPosition:"start"}}});return n}),define("data/locale/locale-extension",["data/locale/locale"],function(e){var t=e.extend({},{es_ES:{},en_US:{}});return t}),define("utils/locale",["data/locale/locale","utils/util"],function(e,t){return t.locale=e.getInstance(),t}),define("classes/extensions/config-manager",["backbone","utils/util","utils/config","utils/locale"],function(e,t){var n=function(e){return e&&(e.constructor.ID||n(e.options.parent))},r={_setupConfig:function(e){var r=this,i=r.constructor,s=e.parent||{config:{}},o=n(this),u=this._ancestorDefaults(i);this.config=t.merge({},u,t.locale.defaults(),s.config,i.defaults,t.locale.get(o),t.config.get(o),e.config)},_ancestorDefaults:function(e){return e.__super__?(e.defaults=t.merge({},this._ancestorDefaults(e.__super__.constructor),e.defaults),e.defaults):e.defaults}};return r}),define("utils/formatters/number-formatter",["classes/singleton","utils/util"],function(e,t){var n=e.extend({initialize:function(){this.config=t.extend({},n.defaults)},setConfig:function(e){t.merge(this.config,e)},format:function(e,t,n,r){var i=r||this.config,s;s=Math.round((e-0)*Math.pow(10,i.maximumFractionDigits))/Math.pow(10,i.maximumFractionDigits),s=s==Math.floor(s)?s+".00":s*10==Math.floor(s*10)?s+"0":s,t===!1&&(s=Math.round(s)),s=String(Math.abs(s));var o=s.split("."),u=o[0],a=o[1]?i.decimalSeparator+o[1]:i.decimalSeparator+"00";a.length==2&&(a+="0");if(n!==!1){var f=new RegExp("(\\d+)(\\d{"+i.groupingSize+"})");while(f.test(u))u=u.replace(f,"$1"+i.groupingSeparator+"$2")}return t===!1?s=u:s=u+a,s},parse:function(e,n){var r=n||this.config,i=this.getRegExp(r);return e===null||e===""?null:t.isNumber(e)?e:i.test(e)?Number(e.replace(new RegExp("\\"+r.groupingSeparator,"g"),"").replace(r.decimalSeparator,".")):null},round:function(e,t){return t=t===0?t:t||this.config.maximumFractionDigits,!e&&e!==0?null:Math.round(e*Math.pow(10,t))/Math.pow(10,t)},getRegExp:function(e){var t=e||this.config;return new RegExp("^-?(?:\\d+|\\d{1,"+t.groupingSize+"}(?:\\"+t.groupingSeparator+"\\d{"+t.groupingSize+"})+)?(?:\\"+t.decimalSeparator+"\\d{0,"+t.maximumFractionDigits+"})?$")}},{defaults:{decimalSeparator:",",groupingSeparator:".",groupingSize:3,maximumFractionDigits:2}});return n}),define("utils/number",["utils/util","utils/formatters/number-formatter"],function(e,t){return e.number=t.getInstance(),e}),define("utils/formatters/amount-formatter",["classes/singleton","utils/util","utils/number"],function(e,t){var n=e.extend({initialize:function(){this.config=t.extend({},n.defaults)},setConfig:function(e){t.merge(this.config,e)},getCurrSymbol:function(e,t){t=t||this.config.systemCurrency,e=e||t,e=e.toUpperCase();var n={ALL:"&#76;&#101;&#107;",AFN:"&#1547;",ARS:"&#36;",AWG:"&#402;",AUD:"&#36;",AZN:"&#1084;&#1072;&#1085;",BSD:"&#36;",BBD:"&#36;",BYR:"&#112;&#46;",BEF:"&#8355;",BZD:"&#66;&#90;&#36;",BMD:"&#36;",BOB:"&#36;&#98;",BAM:"&#75;&#77;",BWP:"&#80;",BGN:"&#1083;&#1074;",BRL:"&#82;&#36;",BRC:"&#8354;",BND:"&#36;",KHR:"&#6107;",CAD:"&#36;",KYD:"&#36;",CLP:"&#36;",CNY:"&#20803;",COP:"&#36;",CRC:"&#8353;",HRK:"&#107;&#110;",CUP:"&#8369;",CYP:"&#163;",CZK:"&#75;&#269;",DKK:"&#107;&#114;",DOP:"&#82;&#68;&#36;",XCD:"&#36;",EGP:"&#163;",SVC:"&#36;",EEK:"&#107;&#114;",XEU:"&#8352;",FKP:"&#163;",FJD:"&#36;",FRF:"&#8355;",GHC:"&#162;",GIP:"&#163;",GRD:"&#8367;",GTQ:"&#81;",GGP:"&#163;",GYD:"&#36;",HNL:"&#76;",HKD:"&#20803;",HUF:"&#70;&#116;",ISK:"&#107;&#114;",INR:"&#82;&#115;",IDR:"&#82;&#112;",IRR:"&#65020;",IEP:"&#163;",IMP:"&#163;",ILS:"&#8362;",ITL:"&#8356;",JMD:"&#74;&#36;",JPY:"&#165;",JEP:"&#163;",KZT:"&#1083;&#1074;",KGS:"&#1083;&#1074;",LAK:"&#8365;",LVL:"&#76;&#115;",LBP:"&#163;",LRD:"&#36;",LTL:"&#76;&#116;",LUF:"&#8355;",MKD:"&#1076;&#1077;&#1085;",MYR:"&#82;&#77;",MTL:"&#76;&#109;",MUR:"&#8360;",MXN:"&#36;",MNT:"&#8366;",MZN:"&#77;&#84;",NAD:"&#36;",NPR:"&#8360;",ANG:"&#402;",NLG:"&#402;",NZD:"&#36;",NIO:"&#67;&#36;",NGN:"&#8358;",KPW:"&#8361;",NOK:"&#107;&#114;",OMR:"&#65020;",PKR:"&#8360;",PAB:"&#66;&#47;&#46;",PYG:"&#71;&#115;",PEN:"&#83;&#47;&#46;",PHP:"&#80;&#104;&#112;",PLN:"&#122;&#322;",QAR:"&#65020;",RON:"&#108;&#101;&#105;",RUB:"&#1088;&#1091;&#1073;&#46;",SHP:"&#163;",SAR:"&#65020;",RSD:"&#1044;&#1080;&#1085;&#46;",SCR:"&#8360;",SGD:"&#36;",SKK:"&#83;&#73;&#84;",EUR:"&#8364;",SBD:"&#36;",SOS:"&#83;",ZAR:"&#82;",KRW:"&#8361;",ESP:"&#8359;",LKR:"&#8360;",SEK:"&#107;&#114;",CHF:"&#67;&#72;&#70;",SRD:"&#36;",SYP:"&#163;",TWD:"&#78;&#84;&#36;",THB:"&#3647;",TTD:"&#84;&#84;&#36;",TRY:"&#8378;",TRL:"&#8356;",TVD:"&#36;",UAH:"&#8372;",GBP:"&#163;",USD:"&#36;",UYU:"&#36;&#85;",UZS:"&#1083;&#1074;",VAL:"&#8356;",VEB:"&#66;&#115;",VND:"&#8363;",YER:"&#65020;",ZWD:"&#90;&#3;"};return t===e?n[e]?n[e]:e:e},getCurrPrefix:function(e,t,n,r){e=e===!1?!1:!0;var i=this.getCurrSymbol(t,n),s=r||this.config,o;return e?o=s.positivePrefix.replace("CUR",i):o=s.negativePrefix.replace("CUR",i),o},getCurrSuffix:function(e,t,n,r){e=e===!1?!1:!0;var i=this.getCurrSymbol(t,n),s=r||this.config,o;return e?o=s.positiveSuffix.replace("CUR",i):o=s.negativeSuffix.replace("CUR",i),o},format:function(e,n,r,i,s,o){e=t.number.parse(e);if(e===null)return null;var u=t.number.format(e,n,s,o),a=o||this.config,f=this.getCurrSymbol(r,i);return e>0?a.positivePrefix.replace("CUR",f)+u+a.positiveSuffix.replace("CUR",f):e<0?a.negativePrefix.replace("CUR",f)+u+a.negativeSuffix.replace("CUR",f):a.zeroPrefix!==undefined&&a.zeroSuffix!==undefined?a.zeroPrefix.replace("CUR",f)+u+a.zeroSuffix.replace("CUR",f):a.positivePrefix.replace("CUR",f)+u+a.positiveSuffix.replace("CUR",f)}},{defaults:{systemCurrency:"EUR",negativePrefix:"-",negativeSuffix:" CUR",positivePrefix:"",positiveSuffix:" CUR"}});return n}),define("utils/formatters/amount-formatter-extension",["utils/formatters/amount-formatter","utils/util","utils/number"],function(e,t){var n=e.extend({initialize:function(){this.config=t.extend({},n.defaults)},setConfig:function(e){t.merge(e,this.config)},format:function(e,n,r,i,s,o){e=t.number.parse(e);if(e===null)return null;var u=t.number.format(e,n,s,o),a=o||this.config,f=this.getCurrSymbol(r,i);return e>0?a.positivePrefix.replace("CUR",f)+u+a.positiveSuffix.replace("CUR",f):e<0?a.negativePrefix.replace("CUR",f)+u+a.negativeSuffix.replace("CUR",f):a.zeroPrefix!==undefined&&a.zeroSuffix!==undefined?a.zeroPrefix.replace("CUR",f)+u+a.zeroSuffix.replace("CUR",f):a.positivePrefix.replace("CUR",f)+u+a.positiveSuffix.replace("CUR",f)}},{defaults:{systemCurrency:"COP",negativePrefix:"-CUR",negativeSuffix:"",positivePrefix:"CUR",positiveSuffix:""}});return n}),define("utils/amount",["utils/util","utils/formatters/amount-formatter"],function(e,t){return e.amount=t.getInstance(),e}),define("libs/date/simpledateformat",[],function(){function e(e){return typeof e=="undefined"}var t,n=/('[^']*')|(G+|y+|M+|w+|W+|D+|d+|F+|E+|a+|H+|k+|K+|h+|m+|s+|S+|Z+)|([a-zA-Z]+)|([^a-zA-Z']+)/,r=["January","February","March","April","May","June","July","August","September","October","November","December"],i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],s=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],o=0,u=1,a=2,f=3,l=4,c=5,h={G:o,y:f,M:l,w:a,W:a,D:a,d:a,F:a,E:u,a:o,H:a,k:a,K:a,h:a,m:a,s:a,S:a,Z:c},p=864e5,d=7*p,v=1,m=function(e,t,n){var r=new Date(e,t,n,0,0,0);return r.setMilliseconds(0),r};return Date.prototype.getDifference=function(e){return this.getTime()-e.getTime()},Date.prototype.isBefore=function(e){return this.getTime()<e.getTime()},Date.prototype.getUTCTime=function(){return Date.UTC(this.getFullYear(),this.getMonth(),this.getDate(),this.getHours(),this.getMinutes(),this.getSeconds(),this.getMilliseconds())},Date.prototype.getTimeSince=function(e){return this.getUTCTime()-e.getUTCTime()},Date.prototype.getPreviousSunday=function(){var e=new Date(this.getFullYear(),this.getMonth(),this.getDate(),12,0,0),t=new Date(e.getTime()-this.getDay()*p);return m(t.getFullYear(),t.getMonth(),t.getDate())},Date.prototype.getWeekInYear=function(t){e(this.minimalDaysInFirstWeek)&&(t=v);var n=this.getPreviousSunday(),r=m(this.getFullYear(),0,1),i=n.isBefore(r)?0:1+Math.floor(n.getTimeSince(r)/d),s=7-r.getDay(),o=i;return s<t&&o--,o},Date.prototype.getISO8601Week=function(){var e=new Date(+this);return e.setHours(0,0,0),e.setDate(e.getDate()+4-(e.getDay()||7)),Math.ceil(((e-new Date(e.getFullYear(),0,1))/864e5+1)/7)},Date.prototype.getISO8601WeekYear=function(){var e=this.getISO8601Week();if(e>1&&e<52)return this.getFullYear();var t=new Date(+this);return t.setDate(t.getDate()-t.getDay()+4),t.getFullYear()},Date.prototype.getWeekInMonth=function(t){e(this.minimalDaysInFirstWeek)&&(t=v);var n=this.getPreviousSunday(),r=m(this.getFullYear(),this.getMonth(),1),i=n.isBefore(r)?0:1+Math.floor(n.getTimeSince(r)/d),s=7-r.getDay(),o=i;return s>=t&&o++,o},Date.prototype.getDayInYear=function(){var e=m(this.getFullYear(),0,1);return 1+Math.floor(this.getTimeSince(e)/p)},t=function(e,t){this.formatString=e,this.monthNames=t&&t.monthNames?t.monthNames:r,this.shortMonthNames=t&&t.shortMonthNames?t.shortMonthNames:i,this.dayNames=t&&t.dayNames?t.dayNames:s},t.prototype.setMinimalDaysInFirstWeek=function(e){this.minimalDaysInFirstWeek=e},t.prototype.getMinimalDaysInFirstWeek=function(t){return e(this.minimalDaysInFirstWeek)?v:this.minimalDaysInFirstWeek},t.prototype.format=function(e){var t="",r,i=function(e,t){while(e.length<t)e="0"+e;return e},s=function(e,t,n){return t>=4?e:e.substr(0,Math.max(n,t))},p=function(e,t){var n=""+e;return i(n,t)},d=this.formatString;while(r=n.exec(d)){var v=r[0],m=r[1],g=r[2],y=r[3],b=r[4];if(m)m=="''"?t+="'":t+=m.substring(1,m.length-1);else if(b)t+=b;else if(g){var w=g.charAt(0),E=g.length,S="";switch(w){case"G":S="AD";break;case"y":S=e.getFullYear();break;case"M":S=e.getMonth();break;case"w":S=e.getWeekInYear(this.getMinimalDaysInFirstWeek());break;case"W":S=e.getWeekInMonth(this.getMinimalDaysInFirstWeek());break;case"D":S=e.getDayInYear();break;case"d":S=e.getDate();break;case"F":S=1+Math.floor((e.getDate()-1)/7);break;case"E":S=this.dayNames[e.getDay()];break;case"a":S=e.getHours()>=12?"PM":"AM";break;case"H":S=e.getHours();break;case"k":S=e.getHours()||24;break;case"K":S=e.getHours()%12;break;case"h":S=e.getHours()%12||12;break;case"m":S=e.getMinutes();break;case"s":S=e.getSeconds();break;case"S":S=e.getMilliseconds();break;case"Z":S=e.getTimezoneOffset()}switch(h[w]){case o:t+=s(S,E,2);break;case u:t+=s(S,E,3);break;case a:t+=p(S,E);break;case f:if(E<=3){var x=""+S;t+=x.substr(2,2)}else t+=p(S,E);break;case l:E>=3?E==3&&typeof this.shortMonthNames!="undefined"?t+=this.shortMonthNames[S]:t+=s(this.monthNames[S],E,E):t+=p(S+1,E);break;case c:var T=S>0,N=T?"-":"+",C=Math.abs(S),k=""+Math.floor(C/60);k=i(k,2);var L=""+C%60;L=i(L,2),t+=N+k+L}}d=d.substr(r.index+r[0].length)}return t},t}),define("libs/date/nicedate",[],function(){var e=function(){var e={minute:"minute",minutes:"minutes",hour:"hour",hours:"hours",day:"day",days:"days",month:"month",months:"months",year:"year",years:"years",ago:"%s ago"},t=function(e){return Math.floor(e/60)},n=function(e){return Math.floor(e/3600)},r=function(e){return Math.floor(e/86400)},i=function(e){return Math.floor(e/2678400)},s=function(e){return Math.floor(e/31536e3)},o=function(e,t){return e.replace("%s",t)},u=function(e,t,n){return e!=1?e+" "+n:"1 "+t},a={};return a.niceDate=function(i,s,a){var f=60,l=f*60,c=l*24,h=c*31,p=c*365,d,v;if(typeof a=="undefined"||typeof a.ago=="undefined")a=e;if(!i)return d;typeof s=="undefined"?v=new Date:v=s;var m=i,g=Math.floor((v.getTime()-m.getTime())/1e3);if(g<f)d=o(a.ago,"1 "+a.minute);else if(g<l){var y=t(g);d=o(a.ago,u(y,a.minute,a.minutes))}else if(g<c){var b=n(g);d=o(a.ago,u(b,a.hour,a.hours))}else if(g<h){var w=r(g);d=o(a.ago,u(w,a.day,a.days))}else{var E=Math.floor(g/p),S=v.getMonth()-m.getMonth();S<0&&(S+=12);var x=new Date(m.getTime()),T=v.getFullYear(),N=v.getMonth();m.getDate()>v.getDate()&&(N-=1),N==-1&&(N=11,T-=1),x.setFullYear(T),x.setMonth(N),E>0?d=o(a.ago,u(E,a.year,a.years)):S>0&&(d=o(a.ago,u(S,a.month,a.months)))}return d},a.niceDate}();return e}),define("utils/formatters/date-formatter",["classes/singleton","libs/date/simpledateformat","libs/date/nicedate","utils/util","utils/i18n"],function(e,t,n,r){var i=e.extend({initialize:function(){this.config=r.extend({},i.defaults)},setConfig:function(e){r.merge(this.config,e)},today:function(){return this.parseBackendDate(this.config.serverDate)},format:function(e,n){if(!r.isDate(e)){if(r.isString(e))return this.format(this.parseBackendDate(e),n);throw new Error("[DateFormatter] format() 'date' is not a Date or valid String")}if(n===undefined)throw new Error("[DateFormatter] format() 'pattern' is not defined");n=this.getFormat(n);var i=new t(n,this.config.i18n);return i.format(e)},formatBackendDate:function(e){var n=new t(i.BACKEND_FORMAT,this.config.i18n);return n.format(e)},formatLongBackendDate:function(e){var n=new t(i.BACKEND_LONG_FORMAT,this.config.i18n);return n.format(e)},formatNice:function(e,t,r){var i=t||(this.config.serverDate?this.parseBackendDate(this.config.serverDate):null),s=r||(this.config.i18n&&this.config.i18n.nice?this.config.i18n.nice:null);return n(e,i,s)},formatSemanticRange:function(e,t,n){var s=this.difference(i.MONTH,e,t)+1;return n=n||i.MEDIUM_MONTH_YEAR,this.difference(i.MONTH,t,new Date)===0?r.indexOf([1,3,6,12],s)>=0?r.i18n.get("common.date.semanticRange.predefined-"+s):r.i18n.get("common.date.semanticRange.lastMonths",{monthsRange:s}):r.i18n.get("common.date.semanticRange.fromTo",{fromDate:this.format(e,n),toDate:this.format(t,n)})},parseBackendDate:function(e){if(!e)throw new Error("[DateFormatter] parseBackendDate() 'value' is null or undefined");var t=e.split("-");if(t.length>2){var n=t[2].split("T");t[2]=n[0],n[1]!==undefined&&(t[3]=n[1]);var r=new Date(t[0],t[1]-1,t[2]);if(t.length==3)return r;if(t.length==4){var i=t[3].split(":");return r.setHours(i[0]),r.setMinutes(i[1]),r.setSeconds(i[2]),r}return null}return new Date(t[0],t[1]-1,1)},add:function(e,t,n){if(!r.isDate(t))throw new Error("[DateFormatter] add() 'date' is not a Date");switch(e){case i.DAY:return this._addDays(t,n);case i.MONTH:return this._addMonths(t,n);case i.YEAR:return this._addYears(t,n)}throw new Error("[DateFormatter] add() 'field' doesn't match the options: 'day', 'month', 'year'")},subtract:function(e,t,n){return this.add(e,t,-n)},difference:function(e,t,n,s){if(!r.isDate(t))throw new Error("[DateFormatter] difference() 'firstDate' is not a Date");if(!r.isDate(n))throw new Error("[DateFormatter] difference() 'secondDate' is not a Date");switch(e){case i.DAY:if(s)return this._daysDifference(t,n);return this._totalDaysDifference(t,n);case i.MONTH:if(s)return this._monthsDifference(t,n);return this._totalMonthsDifference(t,n);case i.YEAR:return this._totalYearsDifference(t,n)}throw new Error("[DateFormatter] difference() 'field' doesn't match the options: 'day', 'month', 'year'")},datesInPeriod:function(e,t,n){if(!r.isDate(t))throw new Error("[DateFormatter] difference() 'firstDate' is not a Date");if(!r.isDate(n))throw new Error("[DateFormatter] difference() 'secondDate' is not a Date");var i=this.difference(e,t,n)+1,s=new Date(t.getTime()),o=[],u=0;for(;u<i;u++)o.push(s),s=this.add(e,s,1);return o},daysInMonth:function(e,t){if(!e&&e!==0)throw new Error("[DateFormatter] daysInMonth() 'month' is null or undefined");if(!t)throw new Error("[DateFormatter] daysInMonth() 'year' is null or undefined");return 32-(new Date(t,e,32)).getDate()},truncate:function(e,t){if(!r.isDate(t))throw new Error("[DateFormatter] truncate() 'date' is not a Date");var n=new Date(t.getTime());switch(e){case i.DAY:return n.setHours(0),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0),n;case i.MONTH:return n.setDate(1),n=this.truncate(i.DAY,n),n;case i.YEAR:return n.setMonth(0),n=this.truncate(i.MONTH,n),n}throw new Error("[DateFormatter] truncate() 'field' doesn't match the options: 'day', 'month', 'year'")},ceiling:function(e,t){if(!r.isDate(t))throw new Error("[DateFormatter] ceiling() 'date' is not a Date");var n=new Date(t.getTime());switch(e){case i.DAY:return n.setHours(23),n.setMinutes(59),n.setSeconds(59),n.setMilliseconds(999),n;case i.MONTH:return n.setDate(this.daysInMonth(n.getMonth(),n.getFullYear())),n=this.ceiling(i.DAY,n),n;case i.YEAR:return n.setMonth(11),n=this.ceiling(i.MONTH,n),n}throw new Error("[DateFormatter] ceiling() 'field' doesn't match the options: 'day', 'month', 'year'")},getDatepickerFormat:function(e){var t=this.getFormat(e).replace("EEEE","dddd").replace("EEE","ddd").replace("MMM","mmm").replace("MM","mm").replace("M","m");return t},getFormat:function(e){if(!e)throw new Error("[DateFormatter] getFormat() 'format' is not defined");switch(e){case i.SHORT_DATE:e=this.config.shortDate;break;case i.MEDIUM_DATE:e=this.config.mediumDate;break;case i.LONG_DATE:e=this.config.longDate;break;case i.SHORT_DAY_MONTH:e=this.config.shortDayMonth;break;case i.SHORT_MONTH_YEAR:e=this.config.shortMonthYear;break;case i.MEDIUM_MONTH_YEAR:e=this.config.mediumMonthYear;break;case i.LONG_MONTH_YEAR:e=this.config.longMonthYear}return e},_addDays:function(e,t){var n=new Date(e.getTime());return n.setDate(e.getDate()+t),n},_subtractDays:function(e,t){return this._addDays(e,-t)},_addMonths:function(e,t){var n=new Date(e.getTime()),r;return e.getMonth()+t%12<0?r=12+(e.getMonth()+t)%12:r=(e.getMonth()+t)%12,n.setMonth(e.getMonth()+t),n.getMonth()!=(12+r)%12&&n.setDate(0),n},_subtractMonths:function(e,t){return this._addMonths(e,-t)},_addYears:function(e,t){var n=new Date(e.getTime());return n.setYear(e.getFullYear()+t),n},_subtractYears:function(e,t){return this._addYears(e,-t)},_totalDaysDifference:function(e,t){return Math.floor(Math.abs(e.getUTCTime()-t.getUTCTime())/864e5)},_daysDifference:function(e,t){return Math.abs(e.getDate()-t.getDate())},_totalMonthsDifference:function(e,t){var n=new Date(e.getTime()),r=e.getMonth(),i=e.getFullYear(),s=t.getMonth(),o=t.getFullYear(),u=Math.abs((i-o)*12+r-s),a=e>t;return n.setFullYear(o),n.setMonth(s),(a&&e<t||!a&&t<e)&&u--,u},_monthsDifference:function(e,t){var n=e.getMonth(),r=e.getFullYear(),i=t.getMonth(),s=t.getFullYear();return Math.abs((r-s)*12+(n-i))},_totalYearsDifference:function(e,t){return Math.abs(e.getFullYear()-t.getFullYear())}},{DAY:"day",WEEK:"week",MONTH:"month",YEAR:"year",BACKEND_LONG_FORMAT:"yyyy-MM-dd'T'HH:mm:ss",BACKEND_FORMAT:"yyyy-MM-dd",BACKEND_MONTH_YEAR_FORMAT:"yyyy-MM",SHORT_DATE:"short",MEDIUM_DATE:"medium",LONG_DATE:"long",SHORT_MONTH:"MMM",SHORT_DAY_MONTH:"short_day_month",SHORT_MONTH_YEAR:"short_month_year",MEDIUM_MONTH_YEAR:"medium_month_year",LONG_MONTH:"MMMM",SHORT_WEEK_DAY:"EE",LONG_WEEK_DAY:"EEEE",LONG_MONTH_YEAR:"long_month_year",defaults:{shortDate:"d/MM/yy",mediumDate:"dd/MM/yyyy",longDate:"MMMM d, yyyy",shortDayMonth:"MMM d",shortMonthYear:"MMM yy",mediumMonthYear:"MMM yyyy",longMonthYear:"MMMM yyyy",i18n:{},serverDate:(new Date).toISOString().replace("Z","")}});return i}),define("utils/formatters/date-formatter-extension",["utils/formatters/date-formatter","utils/util","utils/i18n"],function(e,t){var n=e.extend({formatSemanticRange:function(n,r,i){var s=this.difference(e.MONTH,n,r)+1;return i=i||e.MEDIUM_MONTH_YEAR,this.difference(e.MONTH,r,new Date)===0?t.indexOf([1,3,6,12],s)>=0?t.i18n.get("common.date.web.semanticRange.predefined-"+s):t.i18n.get("common.date.web.semanticRange.lastMonths",{monthsRange:s}):t.i18n.get("common.date.web.semanticRange.fromTo",{fromDate:this.format(n,i),toDate:this.format(r,i)})}},{});return n}),define("utils/date",["utils/util","utils/formatters/date-formatter"],function(e,t){return e.date=t.getInstance(),e}),define("libs/require/css/normalize",["require","module"],function(e,t){function o(e,t,n){if(e.indexOf("data:")===0)return e;e=r(e);if(e.match(/^\//)||e.match(s))return e;var i=n.match(s),o=t.match(s);return o&&(!i||i[1]!=o[1]||i[2]!=o[2])?u(e,t):a(u(e,t),n)}function u(e,t){e.substr(0,2)=="./"&&(e=e.substr(2));var n=t.split("/"),r=e.split("/");n.pop();while(curPart=r.shift())curPart==".."?n.pop():n.push(curPart);return n.join("/")}function a(e,t){var n=t.split("/");n.pop(),t=n.join("/")+"/",i=0;while(t.substr(i,1)==e.substr(i,1))i++;while(t.substr(i,1)!="/")i--;t=t.substr(i+1),e=e.substr(i+1),n=t.split("/");var r=e.split("/");out="";while(n.shift())out+="../";while(curPart=r.shift())out+=curPart+"/";return out.substr(0,out.length-1)}var n=/([^:])\/+/g,r=function(e){return e.replace(n,"$1/")},s=/[^\:\/]*:\/\/([^\/])*/,f=function(e,t,n,i){t=r(t),n=r(n);var s=/@import\s*("([^"]*)"|'([^']*)')|url\s*\(\s*(\s*"([^"]*)"|'([^']*)'|[^\)]*\s*)\s*\)/ig,u,a,e;while(u=s.exec(e)){a=u[3]||u[2]||u[5]||u[6]||u[4];var f;i&&a.substr(0,1)=="/"?f=i+a:f=o(a,t,n);var l=u[5]||u[6]?1:0;e=e.substr(0,s.lastIndex-a.length-l-1)+f+e.substr(s.lastIndex-l-1),s.lastIndex=s.lastIndex+(f.length-a.length)}return e};return f.convertURIBase=o,f}),define("libs/require/css/css",["./normalize"],function(e){function t(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}if(typeof window=="undefined")return{load:function(e,t,n){n()}};var n=window.strands||n,r=n&&n.require?n.require:r,i=!1,s=document.getElementsByTagName("head")[0],o=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)/),u=!1;!o||(o[1]||o[7]?(u=parseInt(o[1])<6||parseInt(o[7])<=9,o="trident"):o[2]?(u=!0,o="webkit"):o[3]||(o[4]?(u=parseInt(o[4])<18,o="gecko"):i&&alert("Engine detection failed")));var a={},f=/^\/|([^\:\/]*:)/;a.pluginBuilder="./css-builder";var l=[],c={},h=[];a.addBuffer=function(e){if(t(l,e)!=-1)return;if(t(h,e)!=-1)return;l.push(e),h.push(e)},a.setBuffer=function(t,n){var i=window.location.pathname.split("/");i.pop(),i=i.join("/")+"/";var s=r.toUrl("base_url").split("/");s.pop();var o=s.join("/")+"/";o=e.convertURIBase(o,i,"/"),o.match(f)||(o="/"+o),o.substr(o.length-1,1)!="/"&&(o+="/"),a.inject(e(t,o,i));for(var u=0;u<l.length;u++)(n&&l[u].substr(l[u].length-5,5)==".less"||!n&&l[u].substr(l[u].length-4,4)==".css")&&(function(e){c[e]=c[e]||!0,setTimeout(function(){typeof c[e]=="function"&&c[e](),delete c[e]},7)}(l[u]),l.splice(u--,1))},a.attachBuffer=function(e,n){for(var r=0;r<l.length;r++)if(l[r]==e)return c[e]=n,!0;if(c[e]===!0)return c[e]=n,!0;if(t(h,e)!=-1)return n(),!0};var p=function(e,t){setTimeout(function(){for(var n=0;n<document.styleSheets.length;n++){var r=document.styleSheets[n];if(r.href==e.href)return t()}p(e,t)},10)},d=function(e,t){setTimeout(function(){try{return e.sheet.cssRules,t()}catch(n){}d(e,t)},10)};if(o=="trident"&&u)var v=[],m=[],g=0,y=function(e,t){var n;m.push({url:e,cb:t}),n=v.shift(),!n&&g++<32&&(n=document.createElement("style"),s.appendChild(n)),b(n)},b=function(e){var t=m.shift();if(!t){e.onload=E,v.push(e);return}e.onload=function(){t.cb(t.ss),b(e)};var n=e.styleSheet;t.ss=n.imports[n.addImport(t.url)]};var w=function(e){var t=document.createElement("link");return t.type="text/css",t.rel="stylesheet",t.href=e,t},E=function(){};a.linkLoad=function(e,t){var n=setTimeout(function(){i&&alert("timeout"),t()},O*1e3-100),r=function(){clearTimeout(n),a&&(a.onload=E),setTimeout(t,7)};if(!u){var a=w(e);a.onload=r,s.appendChild(a)}else if(o=="webkit"){var a=w(e);p(a,r),s.appendChild(a)}else if(o=="gecko"){var f=document.createElement("style");f.textContent='@import "'+e+'"',d(f,r),s.appendChild(f)}else o=="trident"&&y(e,r)};var S=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],x={},T=function(e,t,n){if(x[e]){t(x[e]);return}var r,i,s;if(typeof XMLHttpRequest!="undefined")r=new XMLHttpRequest;else if(typeof ActiveXObject!="undefined")for(i=0;i<3;i+=1){s=S[i];try{r=new ActiveXObject(s)}catch(o){}if(r){S=[s];break}}r.open("GET",e,requirejs.inlineRequire?!1:!0),r.onreadystatechange=function(i){var s,o;r.readyState===4&&(s=r.status,s>399&&s<600?(o=new Error(e+" HTTP status: "+s),o.xhr=r,n(o)):(x[e]=r.responseText,t(r.responseText)))},r.send(null)},N=0,C;a.inject=function(e){N<31&&(C=document.createElement("style"),C.type="text/css",s.appendChild(C),N++),C.styleSheet?C.styleSheet.cssText+=e:C.appendChild(document.createTextNode(e))};var k=/@import\s*(url)?\s*(('([^']*)'|"([^"]*)")|\(('([^']*)'|"([^"]*)"|([^\)]*))\))\s*;?/g,L=window.location.pathname.split("/");L.pop(),L=L.join("/")+"/";var A=function(t,n,r){t.match(f)||(t="/"+e.convertURIBase(t,L,"/")),T(t,function(i){i=e(i,t,L);var s=[],o=[],u=[],a;while(a=k.exec(i)){var f=a[4]||a[5]||a[7]||a[8]||a[9];s.push(f),o.push(k.lastIndex-a[0].length),u.push(a[0].length)}var l=0;for(var c=0;c<s.length;c++)(function(e){A(s[e],function(t){i=i.substr(0,o[e])+t+i.substr(o[e]+u[e]);var r=t.length-u[e];for(var a=e+1;a<s.length;a++)o[a]+=r;l++,l==s.length&&n(i)},r)})(c);s.length==0&&n(i)},r)};a.normalize=function(e,t){return e.substr(e.length-4,4)==".css"&&(e=e.substr(0,e.length-4)),t(e)};var O,M=!1;return a.load=function(e,t,n,r,s){O=O||r.waitSeconds||7;var o=e+(s?".less":".css");if(a.attachBuffer(o,n))return;fileUrl=t.toUrl(o),!M&&i&&(alert(u?"hacking links":"not hacking"),M=!0),s?A(fileUrl,function(e){s&&(e=s(e,function(e){a.inject(e),setTimeout(n,7)}))}):a.linkLoad(fileUrl,n)},i&&(a.inspect=function(){if(stylesheet.styleSheet)return stylesheet.styleSheet.cssText;if(stylesheet.innerHTML)return stylesheet.innerHTML}),a}),define("libs/require/css/css!libs/qtip/qtip",[],function(){}),function(e,t,n){(function(e){"use strict";typeof define=="function"&&define.amd?define("qtip",["jquery","imagesloaded"],e):jQuery&&!jQuery.fn.qtip&&e(jQuery)})(function(r){function F(e,t,n,i){this.id=n,this.target=e,this.tooltip=o,this.elements=elements={target:e},this._id=T+"-"+n,this.timers={img:{}},this.options=t,this.plugins={},this.cache=cache={event:{},target:r(),disabled:s,attr:i,onTooltip:s,lastClass:""},this.rendered=this.destroyed=this.disabled=this.waiting=this.hiddenDuringWait=this.positioning=this.triggering=s}function I(e){return e===o||r.type(e)!=="object"}function q(e){return!(r.isFunction(e)||e&&e.attr||e.length||r.type(e)==="object"&&(e.jquery||e.then))}function R(e){var t,n,u,a;return I(e)?s:(I(e.metadata)&&(e.metadata={type:e.metadata}),"content"in e&&(t=e.content,I(t)||t.jquery||t.done?t=e.content={text:n=q(t)?s:t}:n=t.text,"ajax"in t&&(u=t.ajax,a=u&&u.once!==s,delete t.ajax,t.text=function(e,t){var i=n||r(this).attr(t.options.content.attr)||"Loading...",s=r.ajax(r.extend({},u,{context:t})).then(u.success,o,u.error).then(function(e){return e&&a&&t.set("content.text",e),e},function(e,n,r){if(t.destroyed||e.status===0)return;t.set("content.text",n+": "+r)});return a?i:(t.set("content.text",i),s)}),"title"in t&&(I(t.title)||(t.button=t.title.button,t.title=t.title.text),q(t.title||s)&&(t.title=s))),"position"in e&&I(e.position)&&(e.position={my:e.position,at:e.position}),"show"in e&&I(e.show)&&(e.show=e.show.jquery?{target:e.show}:e.show===i?{ready:i}:{event:e.show}),"hide"in e&&I(e.hide)&&(e.hide=e.hide.jquery?{target:e.hide}:{event:e.hide}),"style"in e&&I(e.style)&&(e.style={classes:e.style}),r.each(x,function(){this.sanitize&&this.sanitize(e)}),e)}function U(e,t){var n=0,r,i=e,s=t.split(".");while(i=i[s[n++]])n<s.length&&(r=i);return[r||e,s.pop()]}function z(e,t){var n,r,i;for(n in this.checks)for(r in this.checks[n])if(i=(new RegExp(r,"i")).exec(e))t.push(i),(n==="builtin"||this.plugins[n])&&this.checks[n][r].apply(this.plugins[n]||this,t)}function $(e){return k.concat("").join(e?"-"+e+" ":" ")}function J(e){if(this.tooltip.hasClass(P))return s;clearTimeout(this.timers.show),clearTimeout(this.timers.hide);var t=r.proxy(function(){this.toggle(i,e)},this);this.options.show.delay>0?this.timers.show=setTimeout(t,this.options.show.delay):t()}function K(e){if(this.tooltip.hasClass(P))return s;var t=r(e.relatedTarget),n=t.closest(L)[0]===this.tooltip[0],i=t[0]===this.options.show.target[0];clearTimeout(this.timers.show),clearTimeout(this.timers.hide);if(this!==t[0]&&this.options.position.target==="mouse"&&n||this.options.hide.fixed&&/mouse(out|leave|move)/.test(e.type)&&(n||i)){try{e.preventDefault(),e.stopImmediatePropagation()}catch(o){}return}var u=r.proxy(function(){this.toggle(s,e)},this);this.options.hide.delay>0?this.timers.hide=setTimeout(u,this.options.hide.delay):u()}function Q(e){if(this.tooltip.hasClass(P)||!this.options.hide.inactive)return s;clearTimeout(this.timers.inactive),this.timers.inactive=setTimeout(r.proxy(function(){this.hide(e)},this),this.options.hide.inactive)}function G(e){this.rendered&&this.tooltip[0].offsetWidth>0&&this.reposition(e)}function Z(e,n,i){r(t.body).delegate(e,(n.split?n:n.join(Y+" "))+Y,function(){var e=b.api[r.attr(this,C)];e&&!e.disabled&&i.apply(e,arguments)})}function et(e,n,u){var a,f,l,c,h,p=r(t.body),d=e[0]===t?p:e,v=e.metadata?e.metadata(u.metadata):o,m=u.metadata.type==="html5"&&v?v[u.metadata.name]:o,g=e.data(u.metadata.name||"qtipopts");try{g=typeof g=="string"?r.parseJSON(g):g}catch(y){}c=r.extend(i,{},b.defaults,u,typeof g=="object"?R(g):o,R(m||v)),f=c.position,c.id=n;if("boolean"==typeof c.content.text){l=e.attr(c.content.attr);if(c.content.attr===s||!l)return s;c.content.text=l}f.container.length||(f.container=p),f.target===s&&(f.target=d),c.show.target===s&&(c.show.target=d),c.show.solo===i&&(c.show.solo=f.container.closest("body")),c.hide.target===s&&(c.hide.target=d),c.position.viewport===i&&(c.position.viewport=f.container),f.container=f.container.eq(0),f.at=new E(f.at,i),f.my=new E(f.my);if(e.data(T))if(c.overwrite)e.qtip("destroy");else if(c.overwrite===s)return s;return e.attr(N,n),c.suppress&&(h=e.attr("title"))&&e.removeAttr("title").attr(B,h).attr("title",""),a=new F(e,c,n,!!l),e.data(T,a),e.one("remove.qtip-"+n+" removeqtip.qtip-"+n,function(){var e;(e=r(this).data(T))&&e.destroy()}),a}var i=!0,s=!1,o=null,u="x",a="y",f="width",l="height",c="top",h="left",p="bottom",d="right",v="center",m="flip",g="flipinvert",y="shift",b,w,E,S,x={},T="qtip",N="data-hasqtip",C="data-qtip-id",k=["ui-widget","ui-tooltip"],L="."+T,A="click dblclick mousedown mouseup mousemove mouseleave mouseenter".split(" "),O=T+"-fixed",M=T+"-default",_=T+"-focus",D=T+"-hover",P=T+"-disabled",H="_replacedByqTip",B="oldtitle",j;BROWSER={ie:function(){var e=3,n=t.createElement("div");while(n.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->")if(!n.getElementsByTagName("i")[0])break;return e>4?e:NaN}(),iOS:parseFloat((""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))||s},w=F.prototype,w.render=function(e){if(this.rendered||this.destroyed)return this;var t=this,n=this.options,o=this.cache,u=this.elements,a=n.content.text,f=n.content.title,l=n.content.button,c=n.position,h="."+this._id+" ",p=[];return r.attr(this.target[0],"aria-describedby",this._id),this.tooltip=u.tooltip=tooltip=r("<div/>",{id:this._id,"class":[T,M,n.style.classes,T+"-pos-"+n.position.my.abbrev()].join(" "),width:n.style.width||"",height:n.style.height||"",tracking:c.target==="mouse"&&c.adjust.mouse,role:"alert","aria-live":"polite","aria-atomic":s,"aria-describedby":this._id+"-content","aria-hidden":i}).toggleClass(P,this.disabled).attr(C,this.id).data(T,this).appendTo(c.container).append(u.content=r("<div />",{"class":T+"-content",id:this._id+"-content","aria-atomic":i})),this.rendered=-1,this.positioning=i,f&&(this._createTitle(),r.isFunction(f)||p.push(this._updateTitle(f,s))),l&&this._createButton(),r.isFunction(a)||p.push(this._updateContent(a,s)),this.rendered=i,this._setWidget(),r.each(n.events,function(e,t){r.isFunction(t)&&tooltip.bind((e==="toggle"?["tooltipshow","tooltiphide"]:["tooltip"+e]).join(h)+h,t)}),r.each(x,function(e){var n;this.initialize==="render"&&(n=this(t))&&(t.plugins[e]=n)}),this._assignEvents(),r.when.apply(r,p).then(function(){t._trigger("render"),t.positioning=s,!t.hiddenDuringWait&&(n.show.ready||e)&&t.toggle(i,o.event,s),t.hiddenDuringWait=s}),b.api[this.id]=this,this},w.destroy=function(e){function t(){if(this.destroyed)return;this.destroyed=i;var e=this.target,t=e.attr(B);this.rendered&&this.tooltip.stop(1,0).find("*").remove().end().remove(),r.each(this.plugins,function(e){this.destroy&&this.destroy()}),clearTimeout(this.timers.show),clearTimeout(this.timers.hide),this._unassignEvents(),e.removeData(T).removeAttr(C).removeAttr("aria-describedby"),this.options.suppress&&t&&e.attr("title",t).removeAttr(B),this._unbind(e),this.options=this.elements=this.cache=this.timers=this.plugins=this.mouse=o,delete b.api[this.id]}return this.destroyed?this.target:(e!==i&&this.rendered?(tooltip.one("tooltiphidden",r.proxy(t,this)),!this.triggering&&this.hide()):t.call(this),this.target)},S=w.checks={builtin:{"^id$":function(e,t,n,o){var u=n===i?b.nextid:n,a=T+"-"+u;u!==s&&u.length>0&&!r("#"+a).length?(this._id=a,this.rendered&&(this.tooltip[0].id=this._id,this.elements.content[0].id=this._id+"-content",this.elements.title[0].id=this._id+"-title")):e[t]=o},"^prerender":function(e,t,n){n&&!this.rendered&&this.render(this.options.show.ready)},"^content.text$":function(e,t,n){this._updateContent(n)},"^content.attr$":function(e,t,n,r){this.options.content.text===this.target.attr(r)&&this._updateContent(this.target.attr(n))},"^content.title$":function(e,t,n){if(!n)return this._removeTitle();n&&!this.elements.title&&this._createTitle(),this._updateTitle(n)},"^content.button$":function(e,t,n){this._updateButton(n)},"^content.title.(text|button)$":function(e,t,n){this.set("content."+t,n)},"^position.(my|at)$":function(e,t,n){"string"==typeof n&&(e[t]=new E(n,t==="at"))},"^position.container$":function(e,t,n){this.tooltip.appendTo(n)},"^show.ready$":function(e,t,n){n&&(!this.rendered&&this.render(i)||this.toggle(i))},"^style.classes$":function(e,t,n,r){this.tooltip.removeClass(r).addClass(n)},"^style.width|height":function(e,t,n){this.tooltip.css(t,n)},"^style.widget|content.title":function(){this._setWidget()},"^style.def":function(e,t,n){this.tooltip.toggleClass(M,!!n)},"^events.(render|show|move|hide|focus|blur)$":function(e,t,n){tooltip[(r.isFunction(n)?"":"un")+"bind"]("tooltip"+t,n)},"^(show|hide|position).(event|target|fixed|inactive|leave|distance|viewport|adjust)":function(){var e=this.options.position;tooltip.attr("tracking",e.target==="mouse"&&e.adjust.mouse),this._unassignEvents(),this._assignEvents()}}},w.get=function(e){if(this.destroyed)return this;var t=U(this.options,e.toLowerCase()),n=t[0][t[1]];return n.precedance?n.string():n};var W=/^position\.(my|at|adjust|target|container|viewport)|style|content|show\.ready/i,X=/^prerender|show\.ready/i;w.set=function(e,t){if(this.destroyed)return this;var n=this.rendered,u=s,a=this.options,f=this.checks,l;return"string"==typeof e?(l=e,e={},e[l]=t):e=r.extend({},e),r.each(e,function(t,i){if(!n&&!X.test(t)){delete e[t];return}var s=U(a,t.toLowerCase()),o;o=s[0][s[1]],s[0][s[1]]=i&&i.nodeType?r(i):i,u=W.test(t)||u,e[t]=[s[0],s[1],i,o]}),R(a),this.positioning=i,r.each(e,r.proxy(z,this)),this.positioning=s,this.rendered&&this.tooltip[0].offsetWidth>0&&u&&this.reposition(a.position.target==="mouse"?o:this.cache.event),this},w._update=function(e,t,n){var u=this,a=this.cache;return!this.rendered||!e?s:(r.isFunction(e)&&(e=e.call(this.elements.target,a.event,this)||""),r.isFunction(e.then)?(a.waiting=i,e.then(function(e){return a.waiting=s,u._update(e,t)},o,function(e){return u._update(e,t)})):e===s||!e&&e!==""?s:(e.jquery&&e.length>0?t.children().detach().end().append(e.css({display:"block"})):t.html(e),a.waiting=i,(r.fn.imagesLoaded?t.imagesLoaded():r.Deferred().resolve(r([]))).done(function(e){a.waiting=s,e.length&&u.rendered&&u.tooltip[0].offsetWidth>0&&u.reposition(a.event,!e.length)}).promise()))},w._updateContent=function(e,t){this._update(e,this.elements.content,t)},w._updateTitle=function(e,t){this._update(e,this.elements.title,t)===s&&this._removeTitle(s)},w._createTitle=function(){var e=this.elements,t=this._id+"-title";e.titlebar&&this._removeTitle(),e.titlebar=r("<div />",{"class":T+"-titlebar "+(this.options.style.widget?$("header"):"")}).append(e.title=r("<div />",{id:t,"class":T+"-title","aria-atomic":i})).insertBefore(e.content).delegate(".qtip-close","mousedown keydown mouseup keyup mouseout",function(e){r(this).toggleClass("ui-state-active ui-state-focus",e.type.substr(-4)==="down")}).delegate(".qtip-close","mouseover mouseout",function(e){r(this).toggleClass("ui-state-hover",e.type==="mouseover")}),this.options.content.button&&this._createButton()},w._removeTitle=function(e){var t=this.elements;t.title&&(t.titlebar.remove(),t.titlebar=t.title=t.button=o,e!==s&&this.reposition())},w.reposition=function(n,o){if(!this.rendered||this.positioning||this.destroyed)return this;this.positioning=i;var u=this.cache,a=this.tooltip,f=this.options.position,l=f.target,m=f.my,g=f.at,y=f.viewport,b=f.container,w=f.adjust,E=w.method.split(" "),S=a.outerWidth(s),T=a.outerHeight(s),N=0,C=0,k=a.css("position"),L={left:0,top:0},A=a[0].offsetWidth>0,O=n&&n.type==="scroll",M=r(e),_=b[0].ownerDocument,D=this.mouse,P,H;if(r.isArray(l)&&l.length===2)g={x:h,y:c},L={left:l[0],top:l[1]};else if(l==="mouse"&&(n&&n.pageX||u.event.pageX))g={x:h,y:c},n=D&&D.pageX&&(w.mouse||!n||!n.pageX)?D:(!n||n.type!=="resize"&&n.type!=="scroll"?n&&n.pageX&&n.type==="mousemove"?n:(!w.mouse||this.options.show.distance)&&u.origin&&u.origin.pageX?u.origin:n:u.event)||n||u.event||D||{},k!=="static"&&(L=b.offset()),_.body.offsetWidth!==(e.innerWidth||_.documentElement.clientWidth)&&(H=r(_.body).offset()),L={left:n.pageX-L.left+(H&&H.left||0),top:n.pageY-L.top+(H&&H.top||0)},w.mouse&&O&&D&&(L.left-=D.scrollX-M.scrollLeft(),L.top-=D.scrollY-M.scrollTop());else{l==="event"&&n&&n.target&&n.type!=="scroll"&&n.type!=="resize"?u.target=r(n.target):l!=="event"&&(u.target=r(l.jquery?l:elements.target)),l=u.target,l=r(l).eq(0);if(l.length===0)return this;l[0]===t||l[0]===e?(N=BROWSER.iOS?e.innerWidth:l.width(),C=BROWSER.iOS?e.innerHeight:l.height(),l[0]===e&&(L={top:(y||l).scrollTop(),left:(y||l).scrollLeft()})):x.imagemap&&l.is("area")?P=x.imagemap(this,l,g,x.viewport?E:s):x.svg&&l[0].ownerSVGElement?P=x.svg(this,l,g,x.viewport?E:s):(N=l.outerWidth(s),C=l.outerHeight(s),L=l.offset()),P&&(N=P.width,C=P.height,H=P.offset,L=P.position),L=this.reposition.offset(l,L,b);if(BROWSER.iOS>3.1&&BROWSER.iOS<4.1||BROWSER.iOS>=4.3&&BROWSER.iOS<4.33||!BROWSER.iOS&&k==="fixed")L.left-=M.scrollLeft(),L.top-=M.scrollTop();if(!P||P&&P.adjustable!==s)L.left+=g.x===d?N:g.x===v?N/2:0,L.top+=g.y===p?C:g.y===v?C/2:0}return L.left+=w.x+(m.x===d?-S:m.x===v?-S/2:0),L.top+=w.y+(m.y===p?-T:m.y===v?-T/2:0),x.viewport?(L.adjusted=x.viewport(this,L,f,N,C,S,T),H&&L.adjusted.left&&(L.left+=H.left),H&&L.adjusted.top&&(L.top+=H.top)):L.adjusted={left:0,top:0},this._trigger("move",[L,y.elem||y],n)?(delete L.adjusted,o===s||!A||isNaN(L.left)||isNaN(L.top)||l==="mouse"||!r.isFunction(f.effect)?a.css(L):r.isFunction(f.effect)&&(f.effect.call(a,this,r.extend({},L)),a.queue(function(e){r(this).css({opacity:"",height:""}),BROWSER.ie&&this.style.removeAttribute("filter"),e()})),this.positioning=s,this):this},w.reposition.offset=function(e,n,i){function h(e,t){n.left+=t*e.scrollLeft(),n.top+=t*e.scrollTop()}if(!i[0])return n;var s=r(e[0].ownerDocument),o=!!BROWSER.ie&&t.compatMode!=="CSS1Compat",u=i[0],a,f,l,c;do(f=r.css(u,"position"))!=="static"&&(f==="fixed"?(l=u.getBoundingClientRect(),h(s,-1)):(l=r(u).position(),l.left+=parseFloat(r.css(u,"borderLeftWidth"))||0,l.top+=parseFloat(r.css(u,"borderTopWidth"))||0),n.left-=l.left+(parseFloat(r.css(u,"marginLeft"))||0),n.top-=l.top+(parseFloat(r.css(u,"marginTop"))||0),!a&&(c=r.css(u,"overflow"))!=="hidden"&&c!=="visible"&&(a=r(u)));while(u=u.offsetParent);return a&&(a[0]!==s[0]||o)&&h(a,1),n};var V=(E=w.reposition.Corner=function(e,t){e=(""+e).replace(/([A-Z])/," $1").replace(/middle/gi,v).toLowerCase(),this.x=(e.match(/left|right/i)||e.match(/center/)||["inherit"])[0].toLowerCase(),this.y=(e.match(/top|bottom|center/i)||["inherit"])[0].toLowerCase(),this.forceY=!!t;var n=e.charAt(0);this.precedance=n==="t"||n==="b"?a:u}).prototype;V.invert=function(e,t){this[e]=this[e]===h?d:this[e]===d?h:t||this[e]},V.string=function(){var e=this.x,t=this.y;return e===t?e:this.precedance===a||this.forceY&&t!=="center"?t+" "+e:e+" "+t},V.abbrev=function(){var e=this.string().split(" ");return e[0].charAt(0)+(e[1]&&e[1].charAt(0)||"")},V.clone=function(){return new E(this.string(),this.forceY)},w.toggle=function(e,n){var u=this.cache,a=this.options,f=this.tooltip;if(n){if(/over|enter/.test(n.type)&&/out|leave/.test(u.event.type)&&a.show.target.add(n.target).length===a.show.target.length&&f.has(n.relatedTarget).length)return this;u.event=r.extend({},n)}this.waiting&&!e&&(this.hiddenDuringWait=i);if(!this.rendered)return e?this.render(1):this;if(this.destroyed||this.disabled)return this;var l=e?"show":"hide",c=this.options[l],h=this.options[e?"hide":"show"],p=this.options.position,d=this.options.content,v=this.tooltip.css("width"),m=this.tooltip[0].offsetWidth>0,g=e||c.target.length===1,y=!n||c.target.length<2||u.target[0]===n.target,b,w,E,S;return(typeof e).search("boolean|number")&&(e=!m),b=!f.is(":animated")&&m===e&&y,w=b?o:!!this._trigger(l,[90]),w!==s&&e&&this.focus(n),!w||b?this:(r.attr(f[0],"aria-hidden",!e),e?(u.origin=r.extend({},this.mouse),r.isFunction(d.text)&&this._updateContent(d.text,s),r.isFunction(d.title)&&this._updateTitle(d.title,s),!j&&p.target==="mouse"&&p.adjust.mouse&&(r(t).bind("mousemove."+T,this._storeMouse),j=i),v||f.css("width",f.outerWidth(s)),this.reposition(n,arguments[2]),v||f.css("width",""),!c.solo||(typeof c.solo=="string"?r(c.solo):r(L,c.solo)).not(f).not(c.target).qtip("hide",r.Event("tooltipsolo"))):(clearTimeout(this.timers.show),delete u.origin,j&&!r(L+'[tracking="true"]:visible',c.solo).not(f).length&&(r(t).unbind("mousemove."+T),j=s),this.blur(n)),after=r.proxy(function(){e?(BROWSER.ie&&f[0].style.removeAttribute("filter"),f.css("overflow",""),"string"==typeof c.autofocus&&r(this.options.show.autofocus,f).focus(),this.options.show.target.trigger("qtip-"+this.id+"-inactive")):f.css({display:"",visibility:"",opacity:"",left:"",top:""}),this._trigger(e?"visible":"hidden")},this),c.effect===s||g===s?(f[l](),after()):r.isFunction(c.effect)?(f.stop(1,1),c.effect.call(f,this),f.queue("fx",function(e){after(),e()})):f.fadeTo(90,e?1:0,after),e&&c.target.trigger("qtip-"+this.id+"-inactive"),this)},w.show=function(e){return this.toggle(i,e)},w.hide=function(e){return this.toggle(s,e)},w.focus=function(e){if(!this.rendered||this.destroyed)return this;var t=r(L),n=this.tooltip,i=parseInt(n[0].style.zIndex,10),s=b.zindex+t.length,o;return n.hasClass(_)||this._trigger("focus",[s],e)&&(i!==s&&(t.each(function(){this.style.zIndex>i&&(this.style.zIndex=this.style.zIndex-1)}),t.filter("."+_).qtip("blur",e)),n.addClass(_)[0].style.zIndex=s),this},w.blur=function(e){return!this.rendered||this.destroyed?this:(this.tooltip.removeClass(_),this._trigger("blur",[this.tooltip.css("zIndex")],e),this)},w.disable=function(e){return this.destroyed?this:("boolean"!=typeof e&&(e=!this.tooltip.hasClass(P)&&!this.disabled),this.rendered&&this.tooltip.toggleClass(P,e).attr("aria-disabled",e),this.disabled=!!e,this)},w.enable=function(){return this.disable(s)},w._createButton=function(){var e=this,t=this.elements,n=t.tooltip,i=this.options.content.button,o=typeof i=="string",u=o?i:"Close tooltip";t.button&&t.button.remove(),i.jquery?t.button=i:t.button=r("<a />",{"class":"qtip-close "+(this.options.style.widget?"":T+"-icon"),title:u,"aria-label":u}).prepend(r("<span />",{"class":"ui-icon ui-icon-close",html:"&times;"})),t.button.appendTo(t.titlebar||n).attr("role","button").click(function(t){return n.hasClass(P)||e.hide(t),s})},w._updateButton=function(e){if(!this.rendered)return s;var t=this.elements.button;e?this._createButton():t.remove()},w._setWidget=function(){var e=this.options.style.widget,t=this.elements,n=t.tooltip,r=n.hasClass(P);n.removeClass(P),P=e?"ui-state-disabled":"qtip-disabled",n.toggleClass(P,r),n.toggleClass("ui-helper-reset "+$(),e).toggleClass(M,this.options.style.def&&!e),t.content&&t.content.toggleClass($("content"),e),t.titlebar&&t.titlebar.toggleClass($("header"),e),t.button&&t.button.toggleClass(T+"-icon",!e)},w._storeMouse=function(n){this.mouse={pageX:n.pageX,pageY:n.pageY,type:"mousemove",scrollX:e.pageXOffset||t.body.scrollLeft||t.documentElement.scrollLeft,scrollY:e.pageYOffset||t.body.scrollTop||t.documentElement.scrollTop}},w._bind=function(e,t,n,i,s){var o="."+this._id+(i?"-"+i:"");t.length&&r(e).bind((t.split?t:t.join(o+" "))+o,r.proxy(n,s||this))},w._unbind=function(e,t){r(e).unbind("."+this._id+(t?"-"+t:""))};var Y="."+T;r(function(){Z(L,["mouseenter","mouseleave"],function(e){var t=e.type==="mouseenter",n=r(e.currentTarget),i=r(e.relatedTarget||e.target),s=this.options;t?(this.focus(e),n.hasClass(O)&&!n.hasClass(P)&&clearTimeout(this.timers.hide)):s.position.target==="mouse"&&s.hide.event&&s.show.target&&!i.closest(s.show.target[0]).length&&this.hide(e),n.toggleClass(D,t)}),Z("["+C+"]",A,Q)}),w._trigger=function(e,t,n){var u=r.Event("tooltip"+e);return u.originalEvent=n&&r.extend({},n)||this.cache.event||o,this.triggering=i,this.tooltip.trigger(u,[this].concat(t||[])),this.triggering=s,!u.isDefaultPrevented()},w._assignEvents=function(){var n=this.options,i=n.position,s=this.tooltip,o=n.show.target,u=n.hide.target,a=i.container,f=i.viewport,l=r(t),c=r(t.body),h=r(e),p=n.show.event?r.trim(""+n.show.event).split(" "):[],d=n.hide.event?r.trim(""+n.hide.event).split(" "):[],v=[];/mouse(out|leave)/i.test(n.hide.event)&&n.hide.leave==="window"&&this._bind(l,["mouseout","blur"],function(e){!/select|option/.test(e.target.nodeName)&&!e.relatedTarget&&this.hide(e)}),n.hide.fixed?u=u.add(s.addClass(O)):/mouse(over|enter)/i.test(n.show.event)&&this._bind(u,"mouseleave",function(){clearTimeout(this.timers.show)}),(""+n.hide.event).indexOf("unfocus")>-1&&this._bind(a.closest("html"),["mousedown","touchstart"],function(e){var t=r(e.target),n=this.rendered&&!this.tooltip.hasClass(P)&&this.tooltip[0].offsetWidth>0,i=t.parents(L).filter(this.tooltip[0]).length>0;t[0]!==this.target[0]&&t[0]!==this.tooltip[0]&&!i&&!this.target.has(t[0]).length&&n&&this.hide(e)}),"number"==typeof n.hide.inactive&&(this._bind(o,"qtip-"+this.id+"-inactive",Q),this._bind(u.add(s),b.inactiveEvents,Q,"-inactive")),d=r.map(d,function(e){var t=r.inArray(e,p);if(t>-1&&u.add(o).length===u.length){v.push(p.splice(t,1)[0]);return}return e}),this._bind(o,p,J),this._bind(u,d,K),this._bind(o,v,function(e){(this.tooltip[0].offsetWidth>0?K:J).call(this,e)}),this._bind(o.add(s),"mousemove",function(e){if("number"==typeof n.hide.distance){var t=this.cache.origin||{},r=this.options.hide.distance,i=Math.abs;(i(e.pageX-t.pageX)>=r||i(e.pageY-t.pageY)>=r)&&this.hide(e)}this._storeMouse(e)}),i.target==="mouse"&&i.adjust.mouse&&(n.hide.event&&this._bind(o,["mouseenter","mouseleave"],function(e){this.cache.onTarget=e.type==="mouseenter"}),this._bind(l,"mousemove",function(e){this.rendered&&this.cache.onTarget&&!this.tooltip.hasClass(P)&&this.tooltip[0].offsetWidth>0&&this.reposition(e)})),(i.adjust.resize||f.length)&&this._bind(r.event.special.resize?f:h,"resize",G),i.adjust.scroll&&this._bind(h.add(i.container),"scroll",G)},w._unassignEvents=function(){var n=[this.options.show.target[0],this.options.hide.target[0],this.rendered&&this.tooltip[0],this.options.position.container[0],this.options.position.viewport[0],this.options.position.container.closest("html")[0],e,t];this.rendered?this._unbind(r([]).pushStack(r.grep(n,function(e){return typeof e=="object"}))):r(n[0]).unbind("."+this._id+"-create")},b=r.fn.qtip=function(e,t,u){var a=(""+e).toLowerCase(),f=o,l=r.makeArray(arguments).slice(1),c=l[l.length-1],h=this[0]?r.data(this[0],T):o;if(!arguments.length&&h||a==="api")return h;if("string"==typeof e)return this.each(function(){var e=r.data(this,T);if(!e)return i;c&&c.timeStamp&&(e.cache.event=c);if(!t||a!=="option"&&a!=="options")e[a]&&e[a].apply(e,l);else{if(u===n&&!r.isPlainObject(t))return f=e.get(t),s;e.set(t,u)}}),f!==o?f:this;if("object"==typeof e||!arguments.length)return h=R(r.extend(i,{},e)),b.bind.call(this,h,c)},b.bind=function(e,t){return this.each(function(o){function p(e){function t(){c.render(typeof e=="object"||u.show.ready),a.show.add(a.hide).unbind(l)}if(c.disabled)return s;c.cache.event=r.extend({},e),c.cache.target=e?r(e.target):[n],u.show.delay>0?(clearTimeout(c.timers.show),c.timers.show=setTimeout(t,u.show.delay),f.show!==f.hide&&a.hide.bind(f.hide,function(){clearTimeout(c.timers.show)})):t()}var u,a,f,l,c,h;h=r.isArray(e.id)?e.id[o]:e.id,h=!h||h===s||h.length<1||b.api[h]?b.nextid++:h,l=".qtip-"+h+"-create",c=et(r(this),h,e);if(c===s)return i;b.api[h]=c,u=c.options,r.each(x,function(){this.initialize==="initialize"&&this(c)}),a={show:u.show.target,hide:u.hide.target},f={show:r.trim(""+u.show.event).replace(/ /g,l+" ")+l,hide:r.trim(""+u.hide.event).replace(/ /g,l+" ")+l},/mouse(over|enter)/i.test(f.show)&&!/mouse(out|leave)/i.test(f.hide)&&(f.hide+=" mouseleave"+l),a.show.bind("mousemove"+l,function(e){c._storeMouse(e),c.cache.onTarget=i}),a.show.bind(f.show,p),(u.show.ready||u.prerender)&&p(t)})},b.api={},r.each({attr:function(e,t){if(this.length){var n=this[0],i="title",s=r.data(n,"qtip");if(e===i&&s&&"object"==typeof s&&s.options.suppress)return arguments.length<2?r.attr(n,B):(s&&s.options.content.attr===i&&s.cache.attr&&s.set("content.text",t),this.attr(B,t))}return r.fn["attr"+H].apply(this,arguments)},clone:function(e){var t=r([]),n="title",i=r.fn["clone"+H].apply(this,arguments);return e||i.filter("["+B+"]").attr("title",function(){return r.attr(this,B)}).removeAttr(B),i}},function(e,t){if(!t||r.fn[e+H])return i;var n=r.fn[e+H]=r.fn[e];r.fn[e]=function(){return t.apply(this,arguments)||n.apply(this,arguments)}}),r.ui||(r["cleanData"+H]=r.cleanData,r.cleanData=function(e){for(var t=0,n;(n=r(e[t])).length;t++)if(n.attr(N))try{n.triggerHandler("removeqtip")}catch(i){}r["cleanData"+H].apply(this,arguments)}),b.version="2.1.1",b.nextid=0,b.inactiveEvents=A,b.zindex=15e3,b.defaults={prerender:s,id:s,overwrite:i,suppress:i,content:{text:i,attr:"title",title:s,button:s},position:{my:"top left",at:"bottom right",target:s,container:s,viewport:s,adjust:{x:0,y:0,mouse:i,scroll:i,resize:i,method:"flipinvert flipinvert"},effect:function(e,t,n){r(this).animate(t,{duration:200,queue:s})}},show:{target:s,event:"mouseenter",effect:i,delay:90,solo:s,ready:s,autofocus:s},hide:{target:s,event:"mouseleave",effect:i,delay:0,fixed:s,inactive:s,leave:"window",distance:s},style:{classes:"",widget:s,width:s,height:s,def:i},events:{render:o,move:o,show:o,hide:o,toggle:o,visible:o,hidden:o,focus:o,blur:o}},x.viewport=function(n,r,i,o,m,b,w){function F(e,t,n,i,s,o,u,a,f){var l=r[s],c=x[e],h=N[e],p=n===y,d=-M.offset[s]+O.offset[s]+O["scroll"+s],m=c===s?f:c===o?-f:-f/2,b=h===s?a:h===o?-a:-a/2,w=D&&D.size?D.size[u]||0:0,E=D&&D.corner&&D.corner.precedance===e&&!p?w:0,S=d-l+E,T=l+f-O[u]-d+E,C=m-(x.precedance===e||c===x[t]?b:0)-(h===v?a/2:0);return p?(E=D&&D.corner&&D.corner.precedance===t?w:0,C=(c===s?1:-1)*m-E,r[s]+=S>0?S:T>0?-T:0,r[s]=Math.max(-M.offset[s]+O.offset[s]+(E&&D.corner[e]===v?D.offset:0),l-C,Math.min(Math.max(-M.offset[s]+O.offset[s]+O[u],l+C),r[s]))):(i*=n===g?2:0,S>0&&(c!==s||T>0)?(r[s]-=C+i,B.invert(e,s)):T>0&&(c!==o||S>0)&&(r[s]-=(c===v?-C:C)+i,B.invert(e,o)),r[s]<d&&-r[s]>T&&(r[s]=l,B=x.clone())),r[s]-l}var E=i.target,S=n.elements.tooltip,x=i.my,N=i.at,C=i.adjust,k=C.method.split(" "),L=k[0],A=k[1]||k[0],O=i.viewport,M=i.container,_=n.cache,D=n.plugins.tip,P={left:0,top:0},H,B,j;if(!O.jquery||E[0]===e||E[0]===t.body||C.method==="none")return P;H=S.css("position")==="fixed",O={elem:O,width:O[0]===e?O.width():O.outerWidth(s),height:O[0]===e?O.height():O.outerHeight(s),scrollleft:H?0:O.scrollLeft(),scrolltop:H?0:O.scrollTop(),offset:O.offset()||{left:0,top:0}},M={elem:M,scrollLeft:M.scrollLeft(),scrollTop:M.scrollTop(),offset:M.offset()||{left:0,top:0}};if(L!=="shift"||A!=="shift")B=x.clone();return P={left:L!=="none"?F(u,a,L,C.x,h,d,f,o,b):0,top:A!=="none"?F(a,u,A,C.y,c,p,l,m,w):0},B&&_.lastClass!==(j=T+"-pos-"+B.abbrev())&&S.removeClass(n.cache.lastClass).addClass(n.cache.lastClass=j),P}})}(window,document),define("libs/require/css/css!ui/modules/tooltip/css/tooltip",[],function(){}),define("ui/modules/tooltip/tooltip-module",["classes/singleton","jQuery","utils/util","qtip","css!ui/modules/tooltip/css/tooltip"],function(e,t,n){var r=e.extend({initialize:function(e){this.config=n.merge({},r.defaults,e)},setConfig:function(e){n.merge(this.config,e)},getConfig:function(e){return e==="error"?this.config.errorTooltip:this.config.tooltip},add:function(e,t){var i=n.clone(t&&t.type==="error"?this.config.errorTooltip:this.config.tooltip,!0);if(!n.isMobileBrowser()&&!n.isTouch()){e.qtip("destroy",!0),e.qtip(n.merge(i,t));return}var s=r.$;e.each(function(e,r){var o=s(r);if(!o.attr("title"))return;var u=o.attr("touch-tooltip");if(u){var a=n.merge({},i,t,{overwrite:!1,show:{solo:!0,event:"click"},hide:{event:"unfocus click"}});o.qtip("destroy",!0),o.qtip(a)}})},toggle:function(e){e.data("qtip-visible")?(e.qtip("hide"),e.data("qtip-visible",!1)):(e.qtip("show"),e.data("qtip-visible",!0))},update:function(e,t){e.qtip("option",t)},destroy:function(e){e.qtip&&e.qtip("api")&&e.qtip("api").destroy(!0)}},{ID:"tooltip",TYPE:{DEFAULT:"default",ERROR:"error"},$:t,defaults:{tooltip:{style:{classes:"sf-tooltip",tip:{height:15,width:8}},position:{my:"bottom center",at:"top center",adjust:{x:0,y:-10}}},errorTooltip:{style:{classes:"sf-tooltip sf-tooltip-error",tip:{height:15,width:8}},overwrite:!0,position:{my:"left center",at:"right center",adjust:{x:5}},show:{ready:!0}}}});return r}),define("utils/tooltip",["utils/util","ui/modules/tooltip/tooltip-module"],function(e,t){return e.tooltip=t.getInstance(),e}),define("utils/formatters/percentage-formatter",["classes/singleton","utils/util","utils/number"],function(e,t){var n=e.extend({initialize:function(){this.config=t.extend({},n.defaults)},setConfig:function(e){t.merge(this.config,e)},format:function(e,n,r){var i=t.number.format(e,n,r),s=r||this.config;return e>=0?s.positivePrefix.replace("CUR","")+i+s.positiveSuffix.replace("CUR","")+s.percentSuffix.replace("{{*}}","%"):s.negativePrefix.replace("CUR","")+i+s.negativeSuffix.replace("CUR","")+s.percentSuffix.replace("{{*}}","%")}},{defaults:{negativePrefix:"-",negativeSuffix:" CUR",positivePrefix:"",positiveSuffix:" CUR",percentSuffix:"{{*}}"}});return n}),define("utils/percentage",["utils/util","utils/formatters/percentage-formatter"],function(e,t){return e.percentage=t.getInstance(),e}),define("parsley",["jQuery"],function(e){var t=e||window.Zepto;"use strict";var n=function(e){this.messages={defaultMessage:"This value seems to be invalid.",type:{email:"This value should be a valid email.",url:"This value should be a valid url.",urlstrict:"This value should be a valid url.",number:"This value should be a valid number.",digits:"This value should be digits.",dateIso:"This value should be a valid date (YYYY-MM-DD).",alphanum:"This value should be alphanumeric.",phone:"This value should be a valid phone number."},notnull:"This value should not be null.",notblank:"This value should not be blank.",required:"This value is required.",regexp:"This value seems to be invalid.",min:"This value should be greater than %s.",max:"This value should be lower than %s.",range:"This value should be between %s and %s.",minlength:"This value is too short. It should have %s characters or more.",maxlength:"This value is too long. It should have %s characters or less.",rangelength:"This value length is invalid. It should be between %s and %s characters long.",mincheck:"You must select at least %s choices.",maxcheck:"You must select %s choices or less.",rangecheck:"You must select between %s and %s choices.",equalto:"This value should be the same."},this.init(e)};n.prototype={constructor:n,validators:{notnull:function(e){return e.length>0},notblank:function(e){return null!==e&&""!==e.replace(/^\s+/g,"").replace(/\s+$/g,"")},required:function(e){if("object"==typeof e){for(var t in e)if(this.required(e[t]))return!0;return!1}return this.notnull(e)&&this.notblank(e)},type:function(e,t){var n;switch(t){case"number":n=/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/;break;case"digits":n=/^\d+$/;break;case"alphanum":n=/^\w+$/;break;case"email":n=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i;break;case"url":e=(new RegExp("(https?|s?ftp|git)","i")).test(e)?e:"http://"+e;case"urlstrict":n=/^(https?|s?ftp|git):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i;break;case"dateIso":n=/^(\d{4})\D?(0[1-9]|1[0-2])\D?([12]\d|0[1-9]|3[01])$/;break;case"phone":n=/^((\+\d{1,3}(-| )?\(?\d\)?(-| )?\d{1,5})|(\(?\d{2,6}\)?))(-| )?(\d{3,4})(-| )?(\d{4})(( x| ext)\d{1,5}){0,1}$/;break;default:return!1}return""!==e?n.test(e):!1},regexp:function(e,t,n){return(new RegExp(t,n.options.regexpFlag||"")).test(e)},minlength:function(e,t){return e.length>=t},maxlength:function(e,t){return e.length<=t},rangelength:function(e,t){return this.minlength(e,t[0])&&this.maxlength(e,t[1])},min:function(e,t){return Number(e)>=t},max:function(e,t){return Number(e)<=t},range:function(e,t){return e>=t[0]&&e<=t[1]},equalto:function(e,n,r){return r.options.validateIfUnchanged=!0,e===t(n).val()},remote:function(e,n,r){var i=null,s={},o={};s[r.$element.attr("name")]=e,"undefined"!=typeof r.options.remoteDatatype&&(o={dataType:r.options.remoteDatatype});var u=function(e,n){"undefined"!=typeof n&&"undefined"!=typeof r.Validator.messages.remote&&n!==r.Validator.messages.remote&&t(r.ulError+" .remote").remove(),r.updtConstraint({name:"remote",valid:e},n),r.manageValidationResult()},a=function(e){if("object"==typeof e)return e;try{e=t.parseJSON(e)}catch(n){}return e},f=function(e){return"object"==typeof e&&null!==e?"undefined"!=typeof e.error?e.error:"undefined"!=typeof e.message?e.message:null:null};return t.ajax(t.extend({},{url:n,data:s,type:r.options.remoteMethod||"GET",success:function(e){e=a(e),u(1===e||!0===e||"object"==typeof e&&null!==e&&"undefined"!=typeof e.success,f(e))},error:function(e){e=a(e),u(!1,f(e))}},o)),i},mincheck:function(e,t){return this.minlength(e,t)},maxcheck:function(e,t){return this.maxlength(e,t)},rangecheck:function(e,t){return this.rangelength(e,t)}},init:function(e){var t=e.validators,n=e.messages,r;for(r in t)this.addValidator(r,t[r]);for(r in n)this.addMessage(r,n[r])},formatMesssage:function(e,t){if("object"==typeof t){for(var n in t)e=this.formatMesssage(e,t[n]);return e}return"string"==typeof e?e.replace(new RegExp("%s","i"),t):""},addValidator:function(e,t){this.validators[e]=t},addMessage:function(e,t,n){if("undefined"!=typeof n&&!0===n){this.messages.type[e]=t;return}if("type"===e){for(var r in t)this.messages.type[r]=t[r];return}this.messages[e]=t}};var r=function(e,t,r){this.options=t,this.Validator=new n(t);if(r==="ParsleyFieldMultiple")return this;this.init(e,r||"ParsleyField")};r.prototype={constructor:r,init:function(e,n){this.type=n,this.valid=!0,this.element=e,this.validatedOnce=!1,this.$element=t(e),this.val=this.$element.val(),this.isRequired=!1,this.constraints={},"undefined"==typeof this.isRadioOrCheckbox&&(this.isRadioOrCheckbox=!1,this.hash=this.generateHash(),this.errorClassHandler=this.options.errors.classHandler(e,this.isRadioOrCheckbox)||this.$element),this.ulErrorManagement(),this.bindHtml5Constraints(),this.addConstraints(),this.hasConstraints()&&this.bindValidationEvents()},setParent:function(e){this.$parent=t(e)},getParent:function(){return this.$parent},bindHtml5Constraints:function(){if(this.$element.hasClass("required")||this.$element.attr("required"))this.options.required=!0;"undefined"!=typeof this.$element.attr("type")&&(new RegExp(this.$element.attr("type"),"i")).test("email url number range")&&(this.options.type=this.$element.attr("type"),(new RegExp(this.options.type,"i")).test("number range")&&(this.options.type="number","undefined"!=typeof this.$element.attr("min")&&this.$element.attr("min").length&&(this.options.min=this.$element.attr("min")),"undefined"!=typeof this.$element.attr("max")&&this.$element.attr("max").length&&(this.options.max=this.$element.attr("max")))),"string"==typeof this.$element.attr("pattern")&&this.$element.attr("pattern").length&&(this.options.regexp=this.$element.attr("pattern"))},addConstraints:function(){for(var e in this.options){var t={};t[e]=this.options[e],this.addConstraint(t,!0)}},addConstraint:function(e,t){for(var n in e)n=n.toLowerCase(),"function"==typeof this.Validator.validators[n]&&(this.constraints[n]={name:n,requirements:e[n],valid:null},n==="required"&&(this.isRequired=!0),this.addCustomConstraintMessage(n));"undefined"==typeof t&&this.bindValidationEvents()},updateConstraint:function(e,t){for(var n in e)this.updtConstraint({name:n,requirements:e[n],valid:null},t)},updtConstraint:function(e,n){this.constraints[e.name]=t.extend(!0,this.constraints[e.name],e),"string"==typeof n&&(this.Validator.messages[e.name]=n),this.bindValidationEvents()},removeConstraint:function(e){var e=e.toLowerCase();delete this.constraints[e],e==="required"&&(this.isRequired=!1);if(!this.hasConstraints()){if("ParsleyForm"==typeof this.getParent()){this.getParent().removeItem(this.$element);return}this.destroy();return}this.bindValidationEvents()},addCustomConstraintMessage:function(e){var t=e+("type"===e&&"undefined"!=typeof this.options[e]?this.options[e].charAt(0).toUpperCase()+this.options[e].substr(1):"")+"Message";"undefined"!=typeof this.options[t]&&this.Validator.addMessage("type"===e?this.options[e]:e,this.options[t],"type"===e)},bindValidationEvents:function(){this.valid=null,this.$element.addClass("parsley-validated"),this.$element.off("."+this.type),this.options.remote&&!(new RegExp("change","i")).test(this.options.trigger)&&(this.options.trigger=this.options.trigger?" change":"change");var e=(this.options.trigger?this.options.trigger:"")+((new RegExp("key","i")).test(this.options.trigger)?"":" keyup");this.$element.is("select")&&(e+=(new RegExp("change","i")).test(e)?"":" change"),e=e.replace(/^\s+/g,"").replace(/\s+$/g,""),this.$element.on((e+" ").split(" ").join("."+this.type+" "),!1,t.proxy(this.eventValidation,this))},generateHash:function(){return"parsley-"+(Math.random()+"").substring(2)},getHash:function(){return this.hash},getVal:function(){return this.$element.val()},eventValidation:function(e){var t=this.getVal();if(e.type==="keyup"&&!/keyup/i.test(this.options.trigger)&&!this.validatedOnce)return!0;if(e.type==="change"&&!/change/i.test(this.options.trigger)&&!this.validatedOnce)return!0;if(!this.isRadioOrCheckbox&&t.length<this.options.validationMinlength&&!this.validatedOnce)return!0;this.validate(!0)},isValid:function(){return this.validate(!1)},hasConstraints:function(){for(var e in this.constraints)return!0;return!1},validate:function(e){var t=this.getVal(),n=null;return this.hasConstraints()?this.options.listeners.onFieldValidate(this.element,this)||""===t&&!this.isRequired?(this.reset(),null):this.needsValidation(t)?(this.errorBubbling="undefined"!=typeof e?e:!0,n=this.applyValidators(),this.errorBubbling&&this.manageValidationResult(),n):this.valid:null},needsValidation:function(e){return!this.options.validateIfUnchanged&&this.valid!==null&&this.val===e&&this.validatedOnce?!1:(this.val=e,this.validatedOnce=!0)},applyValidators:function(){var e=null;for(var t in this.constraints){var n=this.Validator.validators[this.constraints[t].name](this.val,this.constraints[t].requirements,this);!1===n?(e=!1,this.constraints[t].valid=e):!0===n&&(this.constraints[t].valid=!0,e=!1!==e)}return e},manageValidationResult:function(){var e=null;for(var t in this.constraints)!1===this.constraints[t].valid?(this.manageError(this.constraints[t]),e=!1):!0===this.constraints[t].valid&&(this.removeError(this.constraints[t].name),e=!1!==e);return this.valid=e,!0===this.valid?(this.removeErrors(),this.errorClassHandler.removeClass(this.options.errorClass).addClass(this.options.successClass),this.options.listeners.onFieldSuccess(this.element,this.constraints,this),!0):!1===this.valid?(this.errorClassHandler.removeClass(this.options.successClass).addClass(this.options.errorClass),this.options.listeners.onFieldError(this.element,this.constraints,this),!1):e},ulErrorManagement:function(){this.ulError="#"+this.hash,this.ulTemplate=t(this.options.errors.errorsWrapper).attr("id",this.hash).addClass("parsley-error-list")},removeError:function(e){var n=this.ulError+" ."+e;this.options.animate?t(n).fadeOut(this.options.animateDuration,function(){t(this).remove()}):t(n).remove(),this.ulError&&t(this.ulError).children().length===0&&this.removeErrors()},addError:function(e){for(var n in e){var r=t(this.options.errors.errorElem).addClass(n);t(this.ulError).append(this.options.animate?t(r).text(e[n]).hide().fadeIn(this.options.animateDuration):t(r).text(e[n]))}},removeErrors:function(){this.options.animate?t(this.ulError).fadeOut(this.options.animateDuration,function(){t(this).remove()}):t(this.ulError).remove()},reset:function(){this.valid=null,this.removeErrors(),this.validatedOnce=!1,this.errorClassHandler.removeClass(this.options.successClass).removeClass(this.options.errorClass);for(var e in this.constraints)this.constraints[e].valid=null;return this},manageError:function(e){t(this.ulError).length||this.manageErrorContainer();if("required"===e.name&&null!==this.getVal()&&this.getVal().length>0)return;if(!(!this.isRequired||"required"===e.name||null!==this.getVal()&&0!==this.getVal().length))return;var n=e.name,r=!1!==this.options.errorMessage?"custom-error-message":n,i={},s=!1!==this.options.errorMessage?this.options.errorMessage:e.name==="type"?this.Validator.messages[n][e.requirements]:"undefined"==typeof this.Validator.messages[n]?this.Validator.messages.defaultMessage:this.Validator.formatMesssage(this.Validator.messages[n],e.requirements);t(this.ulError+" ."+r).length||(i[r]=s,this.addError(i))},manageErrorContainer:function(){var e=this.options.errorContainer||this.options.errors.container(this.element,this.isRadioOrCheckbox),n=this.options.animate?this.ulTemplate.show():this.ulTemplate;if("undefined"!=typeof e){t(e).append(n);return}this.isRadioOrCheckbox?this.$element.parent().after(n):this.$element.after(n)},addListener:function(e){for(var t in e)this.options.listeners[t]=e[t]},destroy:function(){this.$element.removeClass("parsley-validated"),this.reset().$element.off("."+this.type).removeData(this.type)}};var i=function(e,t,r){this.initMultiple(e,t),this.inherit(e,t),this.Validator=new n(t),this.init(e,r||"ParsleyFieldMultiple")};i.prototype={constructor:i,initMultiple:function(e,n){this.element=e,this.$element=t(e),this.group=n.group||!1,this.hash=this.getName(),this.siblings=this.group?'[data-group="'+this.group+'"]':'input[name="'+this.$element.attr("name")+'"]',this.isRadioOrCheckbox=!0,this.isRadio=this.$element.is("input[type=radio]"),this.isCheckbox=this.$element.is("input[type=checkbox]"),this.errorClassHandler=n.errors.classHandler(e,this.isRadioOrCheckbox)||this.$element.parent()},inherit:function(e,t){var n=new r(e,t,"ParsleyFieldMultiple");for(var i in n)"undefined"==typeof this[i]&&(this[i]=n[i])},getName:function(){if(this.group)return"parsley-"+this.group;if("undefined"==typeof this.$element.attr("name"))throw"A radio / checkbox input must have a data-group attribute or a name to be Parsley validated !";return"parsley-"+this.$element.attr("name").replace(/(:|\.|\[|\])/g,"")},getVal:function(){if(this.isRadio)return t(this.siblings+":checked").val()||"";if(this.isCheckbox){var e=[];return t(this.siblings+":checked").each(function(){e.push(t(this).val())}),e}},bindValidationEvents:function(){this.valid=null,this.$element.addClass("parsley-validated"),this.$element.off("."+this.type);var e=this,n=(this.options.trigger?this.options.trigger:"")+((new RegExp("change","i")).test(this.options.trigger)?"":" change");n=n.replace(/^\s+/g,"").replace(/\s+$/g,""),t(this.siblings).each(function(){t(this).on(n.split(" ").join("."+e.type+" "),!1,t.proxy(e.eventValidation,e))})}};var s=function(e,t,n){this.init(e,t,n||"parsleyForm")};s.prototype={constructor:s,init:function(e,n,r){this.type=r,this.items=[],this.$element=t(e),this.options=n;var i=this;this.$element.find(n.inputs).each(function(){i.addItem(this)}),this.$element.on("submit."+this.type,!1,t.proxy(this.validate,this))},addListener:function(e){for(var t in e)if((new RegExp("Field")).test(t))for(var n=0;n<this.items.length;n++)this.items[n].addListener(e);else this.options.listeners[t]=e[t]},addItem:function(e){if(t(e).is(this.options.excluded))return!1;var n=t(e).parsley(this.options);n.setParent(this),this.items.push(n)},removeItem:function(e){var n=t(e).parsley();for(var r=0;r<this.items.length;r++)if(this.items[r].hash===n.hash)return this.items[r].destroy(),this.items.splice(r,1),!0;return!1},validate:function(e){var t=!0;this.focusedField=!1;for(var n=0;n<this.items.length;n++)if("undefined"!=typeof this.items[n]&&!1===this.items[n].validate()){t=!1;if(!this.focusedField&&"first"===this.options.focus||"last"===this.options.focus)this.focusedField=this.items[n].$element}return this.focusedField&&!t&&this.focusedField.focus(),this.options.listeners.onFormSubmit(t,e,this),t},isValid:function(){for(var e=0;e<this.items.length;e++)if(!1===this.items[e].isValid())return!1;return!0},removeErrors:function(){for(var e=0;e<this.items.length;e++)this.items[e].parsley("reset")},destroy:function(){for(var e=0;e<this.items.length;e++)this.items[e].destroy();this.$element.off("."+this.type).removeData(this.type)},reset:function(){for(var e=0;e<this.items.length;e++)this.items[e].reset()}},t.fn.parsley=function(e,n){function a(u,a){var f=t(u).data(a);if(!f){switch(a){case"parsleyForm":f=new s(u,o,"parsleyForm");break;case"parsleyField":f=new r(u,o,"parsleyField");break;case"parsleyFieldMultiple":f=new i(u,o,"parsleyFieldMultiple");break;default:return}t(u).data(a,f)}if("string"==typeof e&&"function"==typeof f[e]){var l=f[e](n);return"undefined"!=typeof l?l:t(u)}return f}var o=t.extend(!0,{},t.fn.parsley.defaults,"undefined"!=typeof window.ParsleyConfig?window.ParsleyConfig:{},e,this.data()),u=null,f=function(e){var n=t(e);return n[0]&&n[0].classList&&n[0].classList.toString().indexOf("form")>=0?!0:n.selector&&n.selector.toString().indexOf("form")>=0?!0:!1};return t(this).is("form")||f(this)?u=a(t(this),"parsleyForm"):t(this).is(o.inputs)&&!t(this).is(o.excluded)&&(u=a(t(this),t(this).is("input[type=radio], input[type=checkbox]")?"parsleyFieldMultiple":"parsleyField")),"function"==typeof n?n():u},t.fn.parsley.Constructor=s,t.fn.parsley.defaults={inputs:"input, textarea, select",excluded:"input[type=hidden], :disabled",trigger:!1,animate:!0,animateDuration:300,focus:"first",validationMinlength:3,successClass:"parsley-success",errorClass:"parsley-error",errorMessage:!1,validators:{},messages:{},validateIfUnchanged:!1,errors:{classHandler:function(e,t){},container:function(e,t){},errorsWrapper:"<ul></ul>",errorElem:"<li></li>"},listeners:{onFieldValidate:function(e,t){return!1},onFormSubmit:function(e,t,n){},onFieldError:function(e,t,n){},onFieldSuccess:function(e,t,n){}}},t(window).on("load",function(){t('[data-validate="parsley"]').each(function(){t(this).parsley()})})}),define("ie",[],function(){function e(){var e=-1;if(navigator.appName=="Microsoft Internet Explorer"){var t=navigator.userAgent,n=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");n.exec(t)!=null&&(e=parseFloat(RegExp.$1))}return e}return e()!==-1}),Array.isArray||(Array.isArray=function(e){return{}.toString.call(e)=="[object Array]"}),[].map||(Array.prototype.map=function(e,t){var n=this,r=n.length,i=new Array(r);for(var s=0;s<r;s++)s in n&&(i[s]=e.call(t,n[s],s,n));return i}),[].filter||(Array.prototype.filter=function(e){if(this==null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(typeof e!="function")throw new TypeError;var r=[],i=arguments[1];for(var s=0;s<n;s++)if(s in t){var o=t[s];e.call(i,o,s,t)&&r.push(o)}return r}),[].indexOf||(Array.prototype.indexOf=function(e){if(this==null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(n===0)return-1;var r=0;arguments.length>1&&(r=Number(arguments[1]),r!=r?r=0:r!==0&&r!=Infinity&&r!=-Infinity&&(r=(r>0||-1)*Math.floor(Math.abs(r))));if(r>=n)return-1;var i=r>=0?r:Math.max(n-Math.abs(r),0);for(;i<n;i++)if(i in t&&t[i]===e)return i;return-1});var nativeSplit=String.prototype.split,compliantExecNpcg=/()??/.exec("")[1]===undefined;String.prototype.split=function(e,t){var n=this;if(Object.prototype.toString.call(e)!=="[object RegExp]")return nativeSplit.call(n,e,t);var r=[],i=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.extended?"x":"")+(e.sticky?"y":""),s=0,o,u,a,f;e=new RegExp(e.source,i+"g"),n+="",compliantExecNpcg||(o=new RegExp("^"+e.source+"$(?!\\s)",i)),t=t===undefined?-1>>>0:t>>>0;while(u=e.exec(n)){a=u.index+u[0].length;if(a>s){r.push(n.slice(s,u.index)),!compliantExecNpcg&&u.length>1&&u[0].replace(o,function(){for(var e=1;e<arguments.length-2;e++)arguments[e]===undefined&&(u[e]=undefined)}),u.length>1&&u.index<n.length&&Array.prototype.push.apply(r,u.slice(1)),f=u[0].length,s=a;if(r.length>=t)break}e.lastIndex===u.index&&e.lastIndex++}return s===n.length?(f||!e.test(""))&&r.push(""):r.push(n.slice(s)),r.length>t?r.slice(0,t):r},define("libs/legacy",function(){}),define("utils/validator/validator",["classes/singleton","utils/util","jQuery","parsley","utils/number","utils/tooltip","is!ie?libs/legacy"],function(e,t,n){var r=e.extend({initialize:function(){this.config=t.extend({},r.defaults),this._rules={},this._extraMessages={},this._validators=t.reduce(r.validators,function(e,n,r){return e[r]=t.bind(n,this),e},{},this),this._bindFieldValidation=t.bind(this._bindFieldValidation,this),this._keepFormStatus=t.bind(this._keepFormStatus,this)},setConfig:function(e){t.merge(this.config,e)},setRules:function(e){t.merge(this._rules,e)},setExtraMessages:function(e){t.merge(this._extraMessages,e)},getRules:function(e){var n=t.findKeyDeep(this._rules,e),r=t.findKeyDeep(this._extraMessages,e);return t.each(n,function(e,t){r&&r[t]&&(n[t+(t!=="type"?"":"-"+e)+"-message"]=r[t])},this),n},validate:function(e,n){return e.parsley(t.extend({},this.config.validator,{validators:this._validators},n))},isValid:function(e){return e.parsley("isValid")},reloadValidation:function(e){e.parsley("validate")},reset:function(e){e.parsley("reset")},destroy:function(e){e.parsley("destroy")},addItem:function(e,t){this._parsleyAction(e,t,"addItem")},removeItem:function(e,t){this._parsleyAction(e,t,"removeItem")},_parsleyAction:function(e,t,r){var i=this;t=t.is(this.config.validator.inputs)?t:t.find(this.config.validator.inputs),t.each(function(t,s){n(s).is(i.config.validator.excluded)||e.parsley(r,s)})},_getOriginalData:function(e,n,r){var i=r.constraints[e].replaced;return i===undefined?r.constraints[e].replaced=t.clone(n):n=i,n},_getDateData:function(e){var n=t.date.getDatepickerFormat(t.date.constructor.BACKEND_FORMAT),r,i;return t.isString(e)?t.date.parseBackendDate(e):(r=e.pickadate("picker"),i=r.get("select",n),t.date.parseBackendDate(i))},_verifyContext:function(e,r){var i=r.$parent[0].$element,s=i.find(e),o=r.$element;t.each(s,function(e){this._bindFieldValidation(r.options.trigger,i,n(e),o)},this)},_setUpLinkedFieldsValidation:function(e,t){t.options.validateIfUnchanged=!0,n(t.ulError+" ."+e).remove()},_getSumData:function(e,r){var i=r.$parent[0].$element,s=i.find(e),o=r.$element,u=t.reduce(s,function(e,s){return e+=t.number.parse(n(s).val()),this._bindFieldValidation(r.options.trigger,i,n(s),o),e},0,this);return u},_getNumberData:function(e,r,i){var s=[],o,u=this;if(t.isArray(r))return s=t.map(r,function(t){return this._getNumberData(e,t,i)},this),Math[e].apply(null,s);if(t.isString(r)){var a=i.$parent[0].$element,f=i.$element;return a.find(r).each(function(){o=t.number.parse(n(this).val()),u._bindFieldValidation(i.options.trigger,a,n(this),f),t.isNumber(o)&&s.push(o)}),Math[e].apply(null,s)}return r},_getMonthYearData:function(e,n){var r=n.$element,i=n.$parent[0].$element,s,o=t.reduce(e,function(e,t){return s=i.find(t),this._bindFieldValidation(n.options.trigger,i,s,r),e.push({$el:s,val:parseInt(s.val(),10)}),e},[],this);return o},_getMonthYearVal:function(e){return e.$el.is("select")?e.$el.find("option[value="+e.val+"]").text():e.$el.data("val")||e.val},_bindFieldValidation:function(e,n,r,i){var s=n.data("linkedfields")||[],o=r.attr("id"),u=i.attr("id"),a=t.find(s,function(e){return e.field===o&&e.validateField===u},this),f=this;a||(r.bind(e,function(){i.parsley("validate"),f._keepFormStatus(n,i)}),s.push({field:o,validateField:u}),n.data("linkedfields",s))},_keepFormStatus:function(e,n){var r=this.config.validator.errors.classHandler(n),i=t.reduce(e.parsley().items,function(e,t){return t.valid?e.valid++:t.valid===null?e.toValidate++:e.noValid++,e},{valid:0,noValid:0,toValidate:0});i.noValid!==0&&r.hasClass("sf-form-row")&&r.hasClass(this.config.validator.successClass)&&r.removeClass(this.config.validator.successClass).addClass(this.config.validator.errorClass)}},{validators:{type:function(e,n){var r;switch(n){case"number":r=t.number.getRegExp();break;case"alias":r=this.config.regularExpressions.alias;break;case"description":r=this.config.regularExpressions.description;break;case"digits":r=/^\d+$/;break;case"alphanumeric":r=this.config.regularExpressions.alphanumeric;break;default:return!1}return""!==e?r.test(e):!1},max:function(e,n,r){var i="max",s=this._getOriginalData(i,n,r);return this._setUpLinkedFieldsValidation(i,r),n=this._getNumberData("min",s,r),r.constraints[i].requirements=t.number.format(n),t.number.parse(e)<=n},min:function(e,n,r){var i="min",s=this._getOriginalData(i,n,r);return this._setUpLinkedFieldsValidation(i,r),n=this._getNumberData("max",s,r),r.constraints[i].requirements=t.number.format(n),t.number.parse(e)>=n},range:function(e,n,r){var i="range",s=this._getOriginalData(i,n,r);return this._setUpLinkedFieldsValidation(i,r),n[0]=this._getNumberData("max",s[0],r),n[1]=this._getNumberData("min",s[1],r),r.constraints[i].requirements=[t.number.format(n[0]),t.number.format(n[1])],e=t.number.parse(e),e>=n[0]&&e<=n[1]},sum:function(e,n,r){var i="sum",s=this._getOriginalData(i,n,r),o,u;return this._setUpLinkedFieldsValidation(i,r),o=t.number.round(this._getSumData(s[0],r)),u=t.number.round(this._getNumberData("min",s[1],r)),r.constraints[i].requirements=t.number.format(u),o<=u},inlist:function(e,t,n){var r=n.constraints.inlist.replaced;r||(t=n.$element.data(t)+"");var i=(t+"").split(new RegExp("\\s*\\,\\s*"));return r||(n.constraints.inlist.requirements=t.replace(/\,/g,", "),n.constraints.inlist.replaced=!0),i.indexOf(e)!==-1},notinlist:function(e,t,n){var r=n.constraints.notinlist.replaced;r||(t=n.$element.data(t)+"");var i=t.split(new RegExp("\\s*\\,\\s*"));return r||(n.constraints.notinlist.requirements=t.replace(/\,/g,", "),n.constraints.notinlist.replaced=!0),i.indexOf(e)===-1},maxmonth:function(e,t,n){var r="maxmonth",i=this._getOriginalData(r,t,n);return this._setUpLinkedFieldsValidation(r,n),t=this._getMonthYearData(i,n),t[0].val===t[2].val&&parseInt(e,10)>t[1].val?(n.constraints[r].requirements=this._getMonthYearVal(t[1]),!1):!0},maxyear:function(e,t,n){var r="maxyear",i=this._getOriginalData(r,t,n);return this._setUpLinkedFieldsValidation(r,n),t=this._getMonthYearData(i,n),parseInt(e,10)>t[2].val?(n.constraints[r].requirements=this._getMonthYearVal(t[2]),!1):!0},minmonth:function(e,t,n){var r="minmonth",i=this._getOriginalData(r,t,n);return this._setUpLinkedFieldsValidation(r,n),t=this._getMonthYearData(i,n),t[0].val===t[2].val&&parseInt(e,10)<t[1].val?(n.constraints[r].requirements=this._getMonthYearVal(t[1]),!1):!0},minyear:function(e,t,n){var r="minyear",i=this._getOriginalData(r,t,n);return this._setUpLinkedFieldsValidation(r,n),t=this._getMonthYearData(i,n),parseInt(e,10)<t[2].val?(n.constraints[r].requirements=this._getMonthYearVal(t[2]),!1):!0},mindate:function(e,n,r){var i="mindate",s=this._getOriginalData(i,n,r);this._setUpLinkedFieldsValidation(i,r),this._verifyContext(s,r);var o=this._getDateData(r.element),u=r.$parent[0].$element,a=u.find(s),f=this._getDateData(a);return!isNaN(o)&&!isNaN(f)?(r.constraints[i].requirements=t.date.format(o,t.date.constructor.BACKEND_FORMAT),o.getTime()>=f.getTime()):!1},maxdate:function(e,n,r){var i="maxdate",s=this._getOriginalData(i,n,r);this._setUpLinkedFieldsValidation(i,r),this._verifyContext(s,r);var o=this._getDateData(r.element),u=r.$parent[0].$element,a=u.find(s),f=this._getDateData(a);return!isNaN(o)&&!isNaN(f)?(r.constraints[i].requirements=t.date.format(o,t.date.constructor.BACKEND_FORMAT),o.getTime()<=f.getTime()):!1},rangelength:function(e,n,r){return e=t.trim(e),r.Validator.validators.minlength(e,n[0])&&r.Validator.validators.maxlength(e,n[1])}},defaults:{regularExpressions:{alias:/^[a-z 0-9 œ ž š à á â ã ä å æ ç è é ê ë ì í î ï ð ñ ò ó ô õ ö ø ù ú û ü ý þ ÿ $ ¢ £ € ¥ - + _ , . ' ( ) &]+$/i,description:/^[a-zA-Z0-9\w\sÇçÑñ´¨@_:,;.#='%\(\)\[\]\$\+\*\.\?\$!`&\/\-\u00C0-\u00FF]*$/i,alphanumeric:/^[a-zA-Z0-9_ ]*$/},validator:{validationMinlength:1,inputs:"input, textarea, select",excluded:"input[type=hidden], :disabled",trigger:"change keyup",successClass:"sf-form-success",errorClass:"sf-form-error",animate:!1,errors:{container:function(e){return e.closest(".sf-form-row")},classHandler:function(e){var t=e.closest(".sf-form-cell");return t.length?t:e.closest(".sf-form-row")},errorsWrapper:'<ul class="sf-form-errors-placeholder" style="display:none;"></ul>',errorElem:'<li class="sf-form-error-description"></li>'},listeners:{onFieldError:function(e,n,i){var s=i.ulTemplate,o=r.getInstance();e.closest("form").hasClass("sf-tooltip-errors")?(t.tooltip.destroy(e),t.tooltip.add(e,{content:{text:s.text()},position:{container:e.closest(".sf-widget-placeholder"),viewport:!0},type:"error"})):s.css({display:"block"}),t.isFunction(o.onFieldError)&&o.onFieldError(e,n,i)},onFieldSuccess:function(e){e.closest("form").hasClass("sf-tooltip-errors")&&t.tooltip.destroy(e)}}}}});return r}),define("utils/validator",["utils/util","utils/validator/validator"],function(e,t){return e.validator=t.getInstance(),e}),define("utils/console",["jQuery","utils/util"],function(e,t){return t.console={enabled:!0,mode:"default",emptyFn:function(){},methods:{log:null,info:null,debug:null,warn:null,trace:null,error:null,group:null,groupEnd:null,clear:null},init:function(){if(typeof window.console!="undefined"){this.mode="default";for(var e in this.methods)this.methods[e]=window.console[e]}else this.mode="ie",this.enabled=!1,window.console={};this.enabled?this.enable():this.disable()},enable:function(){this.mode=="default"?this.createDefault():this.createIE()},disable:function(){for(var e in this.methods)window.console[e]=t.console.emptyFn;this.mode=="ie"&&this.loaded&&this.close()},createDefault:function(){for(var e in this.methods)window.console[e]=this.methods[e]},createIE:function(){if(this.loaded)return;this.element=e('<div id="JSLogger" style="position:absolute;top:10px;left:10px;z-index:1000000;width:250px;min-height:25px;color:#999;font-size:10px;line-height:15px;background-color:#fff;opacity:0.8;filter:alpha(opacity=80);border:1px solid #aaa;border-color:rgba(0, 0, 0, 0.5);border-radius:10px 10px 10px 10px;box-shadow:0 3px 10px rgba(0, 0, 0, 0.75);"></div>').appendTo(e("body")),this.panel=e('<div id="JSLoggerPanel" style="margin-bottom:25px;padding:0px 10px;text-align:left; height:300px; overflow:auto;"></div>').appendTo(e("#JSLogger")),this.controls=e('<div id="JSLoggerControls" style="position:absolute;left:0;bottom:0;height:25px;width:100%;text-align:right;border-top:1px dotted #ccc;"></div>').appendTo(e("#JSLogger")),this.controlClear=e('<button id="JSLoggerControlClear" style="margin:3px;padding:0px 5px;height:19px;line-height:19px;color:#999;outline:0 none;cursor:pointer;border:1px solid #ccc;">Clear</button>').appendTo(e("#JSLoggerControls")),this.controlToggle=e('<button id="JSLoggerControlToggle" style="margin:3px;padding:0px 5px;height:19px;line-height:19px;color:#999;outline:0 none;cursor:pointer;border:1px solid #ccc;">Toggle</button>').appendTo(e("#JSLoggerControls")),this.controlClose=e('<button id="JSLoggerControlClose" style="float:left;margin:3px;padding:0px 5px;height:19px;line-height:19px;color:#999;outline:0 none;cursor:pointer;border:1px solid #ccc;">Close</button>').appendTo(e("#JSLoggerControls")),this.messageWrap='<div style="border-bottom:1px dotted #ddd;"></div>',this.errorWrap='<div style="color:red;border-bottom:1px dotted #ddd;"></div>',this.controlClear.click(function(){t.console.clear()}),this.controlToggle.click(function(){t.console.toggle()}),this.controlClose.click(function(){t.console.disable()}),this.element.draggable&&this.element.draggable(),this.hidden=!1,this.loaded=!0,window.console.log=function(n){if(!t.console.loaded)return;e(t.console.messageWrap).appendTo(t.console.panel).text(n)},window.console.info=function(e){window.console.log("[INFO] "+e)},window.console.debug=function(e){window.console.log("[DEBUG] "+e)},window.console.warn=function(e){window.console.log("[WARNING] "+e)},window.console.trace=function(e){window.console.log("[TRACE] "+e)},window.console.error=function(n){if(!t.console.loaded)return;e(t.console.errorWrap).appendTo(t.console.panel).text("[ERROR] "+n)},window.console.group=this.emptyFn(),window.console.groupEnd=this.emptyFn(),this.clear=function(){if(!this.loaded)return;this.panel.empty()},this.show=function(){if(!this.loaded)return;this.panel.animate({height:"show",opacity:"show"},200),this.hidden=!1},this.hide=function(){if(!this.loaded)return;this.panel.animate({height:"hide",opacity:"hide"},200),this.hidden=!0},this.toggle=function(){if(!this.loaded)return;this.hidden?this.show():this.hide()},this.close=function(){if(!this.loaded)return;this.element.hide(200,function(){t.console.destroy()})},this.destroy=function(){this.controlClear.unbind(),this.controlToggle.unbind(),this.controlClose.unbind(),this.element.remove(),this.loaded=!1}}},t.console.init(),t}),define("utils/datalayer-wrapper",["utils/util"],function(e){return e.pushToDataLayer=function(e){window.pfmDataLayer=window.pfmDataLayer||[],window.pfmDataLayer.push(e)},e.bindEventToPush=function(e,t,n){var r=this,i=document.querySelector(e);i!==null?document.querySelector(e).addEventListener(t,function(e){r.pushToDataLayer(n)},!1):console.log("Selector not found",e)},e.addAnalyticsTags=function(e){var t=this;e.forEach(function(e){console.log(e),t.bindEventToPush(e.selector,e.event,e.data)})},e}),define("classes/application",["classes/class","classes/data-manager","classes/event-aggregator","classes/region-manager","backbone","marionette","classes/resource-loader","classes/extensions/config-manager","jQuery","utils/util","utils/i18n","utils/config","utils/number","utils/amount","utils/date","utils/tooltip","utils/percentage","utils/validator","utils/console","utils/datalayer-wrapper"],function(e,t,n,r,i,s,o,u,a,f){var l=e.extend({constructor:function(e){console.log("[app] constructor()... options: %o",e),this.options=e,this._widgets=f.reduce(e.widgets,function(e,t,n){return e[n]=f.extend(t,{type:"widget"}),e},{}),this._modules=f.reduce(e.modules,function(e,t,n){return e[n]=f.extend(t,{type:"module"}),e},{}),this._uiModules=f.reduce(e.uiModules,function(e,t,n){return e[n]=f.extend(t,{type:"ui-module"}),e},{}),this._items=f.merge({},this._widgets,this._modules,this._uiModules),this._widgetPlugins=e.widgetPlugins,this._resourcesIds=["common","tooltip","popup","mask"],this._services=[],this._resources={},this._starting=!1,this._started=!1,this._resourcesReady=!1,this._regionManager=new r,this.globalHubEvents=["contrast:change","fontSize:change","viewType:change"],this._widgetClasses=["sf-widget-placeholder"],f.isMobileBrowser()&&(this._widgetClasses.push("sf-device-mobile"),f.isPhone()?this._widgetClasses.push("sf-device-phone"):this._widgetClasses.push("sf-device-tablet")),this._moduleClasses=["sf-widget-placeholder","sf-widget"],this._itemClasses=["sf-base"],e.config.projectId&&this._itemClasses.push("sf-"+e.config.projectId),this.initialize()},initialize:function(){this.trigger("initialize")},triggerMethod:s.triggerMethod,start:function(){console.log("[app] start()..."),f.pushToDataLayer({eventCategory:"PFM Ingreso a la funcionalidad",eventAction:"Pagina",eventLabel:"Ingreso PFM",event:"eventClick"});if(this._started||this._starting){console.log("[app] start()... already started or starting");return}this._starting=!0,this.triggerMethod("before:start"),this._setupConfig(),this._addResources(),this._getResources()},stop:function(){console.log("[app] stop()...");if(!this._started)return;this.triggerMethod("before:stop"),this._starting=!1,this._started=!1,this.triggerMethod("stop"),this.off()},show:function(e,t,n){console.log("[app] show(%s)... ",e);if(!this._started){this.once("start",function(){n&&n.gtag&&function(e,t,n,r,i){e[r]=e[r]||[],e[r].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var s=t.getElementsByTagName(n)[0],o=t.createElement(n),u=r!="dataLayer"?"&l="+r:"";o.async=!0,o.src="https://www.googletagmanager.com/gtm.js?id="+i+u,s.parentNode.insertBefore(o,s)}(window,document,"script","pfmDataLayer",n.gtag),this.show(e,t,n)}),this._starting||this.start();return}if(!this._regionManager._regions[e]){t=t.indexOf("#")===0?t:"#"+t;if(a(t).length===0){console.error("[app] placeholder %s doesn't exist. The placeholder needs to exist in the DOM",t);return}console.log("[app] Region for "+e+" doesn't exist, adding a region "+t),this._regionManager.addRegion(e,t)}var r=this._items[e];r._rendered||(this._initializeItem(e,n),this._regionManager._regions[e].show(r.instance),this._items[e]._rendered=!0,a(this._regionManager._regions[e].el).addClass(this._getItemClasses(r.type)));switch(e){case"details":f.pushToDataLayer({eventCategory:"PFM Movimientos",eventAction:"Pagina",eventLabel:"Home Movimientos",event:"eventClick"});break;case"budget":f.pushToDataLayer({eventCategory:"PFM Presupuesto",eventAction:"Pagina",eventLabel:"Home Presupuesto ",event:"eventClick"});break;case"analysis":f.pushToDataLayer({eventCategory:"PFM Ingresos y gastos",eventAction:"Pagina",eventLabel:"Home Ingresos y Gastos",event:"eventClick"});break;case"networth":f.pushToDataLayer({eventCategory:"PFM Patrimonio",eventAction:"Pagina",eventLabel:"Home Patrimonio ",event:"eventClick"});break;case"financial-calendar":f.pushToDataLayer({eventCategory:"PFM Calendario",eventAction:"Pagina",eventLabel:"Home Calendario ",event:"eventClick"})}return console.log("[app] "+r.type+" %s shown",e),this.triggerMethod("show:"+e),this.triggerMethod("show:"+r.type,e),this._items[e].instance},showCustom:function(e,t,n){console.log("[app] show custom item (%s)... ",e.itemId),this._items[e.itemId]=e;if(!this._started){this.once("start",function(){this.showCustom(e,t,n)}),this._starting||this.start();return}if(!this._regionManager._regions[e.itemId]){t=t.indexOf("#")===0?t:"#"+t;if(a(t).length===0){console.error("[app] placeholder %s doesn't exist. The placeholder needs to exist in the DOM",t);return}console.log("[app] Region for "+e.itemId+" doesn't exist, adding a region "+t),this._regionManager.addRegion(e.itemId,t)}return e._rendered||(this._initializeCustomItem(e,n),this._regionManager._regions[e.itemId].show(e.instance),e._rendered=!0,a(this._regionManager._regions[e.itemId].el).addClass(this._getItemClasses(e.type))),console.log("[app] "+e.type+" %s shown",e.itemId),this.triggerMethod("show:"+e.itemId),this.triggerMethod("show:"+e.type,e.itemId),e.instance},close:function(e){var t=this._items[e];t.instance&&(this.triggerMethod("before:close:"+e),this.triggerMethod("before:close:"+t.type,e),t.type!=="widget"&&t.instance.hub.off(),t.instance.close(),this._regionManager.removeRegion(e),delete t.instance,console.log("[app] "+t.type+" %s closed",e),t._rendered=!1,this.triggerMethod("close:"+e),this.triggerMethod("close:"+t.type,e))},closeCustom:function(e){e.instance&&(this.triggerMethod("before:close:"+e.itemId),this.triggerMethod("before:close:"+e.type,e.itemId),e.type!=="widget"&&e.instance.hub.off(),e.instance.close(),this._regionManager.removeRegion(e.itemId),delete e.instance,console.log("[app] "+e.type+" %s closed",e.itemId),e._rendered=!1,this.triggerMethod("close:"+e.itemId),this.triggerMethod("close:"+e.type,e.itemId))},destroy:function(){console.log("[app] destroy()..."),this.triggerMethod("before:destroy"),f.each(this._items,function(e,t){this.close(t)},this),this._resources={},this._starting=!1,this._started=!1,this._resourcesReady=!1,this.publish("data","destroy"),this.triggerMethod("destroy")},subscribeAllEvents:function(e,t){f.each(e,function(e,n){this.subscribeAll(e,t)},this)},subscribeAll:function(e,t){var n=this._getHubs();f.each(n,function(n,r){this.subscribe(r,e,t)},this)},subscribe:function(e,t,n){var r=this,i=this._getHubs(),s=i[e];s?s.on(t,n):this.once("initialize:"+e,function(){r.subscribe(e,t,n)})},unsubscribeAll:function(e,t,n){var r=this._getHubs();f.each(r,function(r,i){this.unsubscribe(i,e,t,n)},this)},unsubscribe:function(e,t,n,r){var i=this._getHubs(),s=i[e];s&&s.stopListening(s,t,n,r)},publishAll:function(e,t){var n=this._getHubs();f.each(n,function(n,r){this.publish(r,e,t)},this)},publish:function(e,t,n){var r=this._getHubs(),i=r[e];i&&i.trigger(t,n)},_getHubs:function(){var e={};return f.each(this._items,function(t){e[t.id]=t.instance?t.instance.hub:!1}),e.data=t.hub,e.integration=new n,e},changeContrast:function(e){this.config=f.config.setGlobals({contrast:e}),this.publishAll("contrast:change",e),this._updateClasses(this.config.contrastClasses.join(" "),this.config.contrastClasses[e])},changeFontSize:function(e){this.config=f.config.setGlobals({fontSize:e}),this.publishAll("fontSize:change",e),this._updateClasses(this.config.fontSizeClasses.join(" "),this.config.fontSizeClasses[e])},changeViewType:function(e){this.config=f.config.setGlobals({viewType:e}),this.publishAll("viewType:change",e)},_initializeItem:function(e,t){var n=this._items[e],r=n.type==="widget"?this._getWidgetOptions(e):this._getModuleOptions(e);n.options=n.options||{},n.options.config=n.options.config||{},t&&f.merge(n.options.config,t),f.extend(n.options,r),n.instance=new n.constructor(n.options),this.triggerMethod("initialize:"+e,e)},_initializeCustomItem:function(e,t){var n=e.type==="widget"?this._getWidgetOptions(e.itemId):this._getModuleOptions(e.itemId);e.options=e.options||{},e.options.config=e.options.config||{},t&&f.merge(e.options.config,t),f.extend(e.options,n),e.instance=new e.prototype.constructor(e.options),this.triggerMethod("initialize:"+e.itemId,e.itemId)},_getWidgetOptions:function(e){return{id:e,parent:this,plugins:this._widgetPlugins,globalHubEvents:this.globalHubEvents}},_getModuleOptions:function(e){return{id:e,parent:this,hub:new n,$tooltipContainer:a(this._items[e].placeholder),$popupContainer:a(this._items[e].placeholder),globalHubEvents:this.globalHubEvents}},_updateClasses:function(e,t){f.each(this._items,function(n,r){var i=this._regionManager._regions[r];i&&a(i.el).removeClass(e).addClass(t)},this)},_getItemClasses:function(e){var t=e==="widget"?this._widgetClasses:this._moduleClasses;return t=f.union(t,this._itemClasses),t.push(this.config.fontSizeClasses[this.config.fontSize]),t.push(this.config.contrastClasses[this.config.contrast]),t.push("sf-locale-"+f.locale.id),t.push(this.config.textDirection==="rtl"?"sf-rtl":"sf-ltr"),t.join(" ")},_addResources:function(){console.log("[app] _addResources()..."),this._getResourcesIds(),this._resources={i18n:new o(f.i18n,f.i18n.load,this._resourcesIds)}},_getResourcesIds:function(){console.log("[app] _getResourcesIds()..."),f.each(this._items,function(e){f.contains(this._resourcesIds,e.constructor.ID)||this._resourcesIds.push(e.constructor.ID),e.constructor.submodules&&this._addResourcesIds(e.constructor.submodules),e.constructor.services&&this._addServices(e.constructor.services)},this)},_addResourcesIds:function(e){f.each(e,function(e){f.contains(this._resourcesIds,e.ID)||this._resourcesIds.push(e.ID),e.submodules&&this._addResourcesIds(e.submodules),e.services&&this._addServices(e.services)},this)},_addServices:function(e){f.each(e,function(e){f.contains(this._resourcesIds,e.ID)||(this._resourcesIds.push(e.ID),this._services.push(e))},this)},_getResources:function(){console.log("[app] _getResources()...");var e=f.map(this._resources,function(e){return e.load()});f.when.apply(null,e).then(f.bind(this._resourcesReceived,this)).fail(f.bind(this._resourcesReceivedError,this))},_resourcesReceived:function(){this._started=!0,this._starting=!1,this._setUpResources.apply(this,arguments),console.log("[app] started"),this.triggerMethod("start"),this.publish("integration","application:startup:ready")},_resourcesReceivedError:function(e){console.log("[app] Error loading resources",e),this.publish("integration","application:startup:error",e)},_ancestorDefaults:u._ancestorDefaults,_setupConfig:function(){this.config=f.config.setGlobals(f.merge({},this._ancestorDefaults(this.constructor),f.locale.config("application"),f.config.get("common"),{environment:{serverDate:f.date.formatLongBackendDate(new Date)}},this.options.config))},_setUpResources:function(){f.config.setGlobals(this.config),this.config.format.numberFormat.decimalSeparator=",",this.config.format.numberFormat.groupingSeparator=".",f.number.setConfig(this.config.format.numberFormat),f.amount.setConfig(f.extend({systemCurrency:this.config.user.currency},this.config.format.numberFormat)),f.percentage.setConfig(this.config.format.numberFormat),f.date.setConfig(f.extend({},this.config.format.dateFormat,{i18n:f.i18n.get("common.date")},{serverDate:this.config.environment.serverDate})),f.tooltip.setConfig(f.config.get("tooltip"));var e={},t={},n;f.each(this._services,function(r){var i=this._ancestorDefaults(r);f.extend(e,f.findKeyDeep(i,"validator.rules"),f.findKeyDeep(f.config.get(r.ID),"validator.rules")),n=f.i18n.get(r.ID+".validator"),f.isString(n)||f.extend(t,n)},this),f.validator.setRules(e),f.validator.setExtraMessages(t),f.validator.setConfig(f.extend({},this.config.format.numberFormat,this.config.validator,{validator:{messages:f.i18n.get("common.validator")}})),this._resourcesReady=!0,this.trigger("resources:ready")}},{CONTRASTS:{DEFAULT:0,HIGH:1},FONT_SIZES:{DEFAULT:0,SMALL:1,LARGE:2,XLARGE:3,XXLARGE:4,XXXLARGE:5},VIEW_TYPES:{GRAPHICAL:0,TABULAR:1},defaults:{fontSizeClasses:["sf-font-default","sf-font-small","sf-font-large","sf-font-xlarge","sf-font-xxlarge","sf-font-xxxlarge"],contrastClasses:["sf-contrast-regular","sf-contrast-high"],contrast:0,fontSize:0,viewType:0,environment:{contextPath:"/api",serverDate:null},user:{},format:{numberFormat:{decimalSeparator:",",groupingSeparator:".",groupingSize:3,maximumFractionDigits:2,minimumFractionDigits:2,negativePrefix:"-",negativeSuffix:"CUR",positivePrefix:"",positiveSuffix:"CUR",percentSuffix:"{{*}}"},dateFormat:{shortDate:"d/MM/yy",mediumDate:"dd-MMM-yyyy",longDate:"MMMM d, yyyy",shortMonthYear:"MMM yy",mediumMonthYear:"MMM yyyy",longMonthYear:"MMMM yyyy",backendDate:"yyyy-MM-dd"}},validator:{}}});return f.extend(l.prototype,i.Events),l}),define("classes/observable",["classes/class","backbone"],function(e,t){var n=e.extend(t.Events);return n}),define("classes/service",["classes/class","classes/singleton","utils/util","classes/observable"],function(e,t,n,r){var i=t.extend({constructor:function(){t.prototype.constructor.apply(this,arguments)},initialize:function(){this.resources={}},reset:function(){this.initialize()},executeJob:function(e,t,n){var r=new i.ServiceJob(e,t,n);return this._executeJob(r)},_executeJob:function(e){var t=this;for(var r in e.resources){if(!e.resources.hasOwnProperty(r))continue;var i=e.resources[r];if(!i.loaded){var s=i.load();if(s===i&&i.loaded)continue;n.when(s).done(function(){t._executeJob(e)}).fail(function(t){console.error("[Service] Error loading service resources",t),e.deferred!==undefined&&e.deferred.reject(t)});if(e.deferred===undefined)return e.deferred=new n.Deferred,e.deferred.promise();return}}e.watchResources(),e.run();if(e.deferred===undefined)return e.result;e.deferred.resolve(e.result)}});return i.ServiceResult=r.extend({initialize:function(e){this.ownerJob=e,this.data=null},dispose:function(){this.ownerJob.unwatchResources(),this.off()},setData:function(e){this.data=e,this.trigger("change",this)}}),i.ServiceJob=e.extend({constructor:function(e,t,n){this.context=e,this.task=t,this.resources=n,this.result=new i.ServiceResult(this),this.subscribeToResources=!0},run:function(){this.result.setData(this.task.call(this.context))},watchResources:function(){this.subscribeToResources&&n.each(this.resources,function(e){e.loaded&&e.data.on("change",this._reExecute,this)},this)},unwatchResources:function(){this.subscribeToResources&&n.each(this.resources,function(e){e.loaded&&e.data.off("change",this._reExecute,this)},this)},_reExecute:function(){console.log("[Service] Resource change detected. Re-run task."),this.run()}}),i}),define("classes/model",["backbone"],function(e){var t=e.Model.extend({});return t}),define("classes/model-extension",["classes/model","utils/util"],function(e,t){var n=/[<>]/g,r=e.extend({parse:function(e){var n=this;return t.each(e,function(t,r){e[r]=n.sanitize(t)},e),e},sanitize:function(e){var t=e.isNull?"":String(JSON.stringify(e)).replace(n,"");return JSON.parse(t)}});return r}),define("data/session/session-model",["classes/model","utils/util","utils/config"],function(e,t){var n=e.extend({ping:function(e){var n=t.extend({url:t.config.getGlobals().environment.contextPath+"/config/status.action",type:"GET"},e);return t.ajax(n)}});return n}),define("data/session/users-connection-status-model",["classes/model","utils/util","utils/config"],function(e,t){var n=e.extend({refresh:function(e){var n=t.extend({url:t.config.getGlobals().environment.contextPath+"/accounts/userconnection/refresh/all.action",type:"GET"},e);return t.ajax(n)}});return n}),define("data/session/session-data-manager",["classes/data-manager","data/session/session-model","data/session/users-connection-status-model","classes/remote-error","utils/util"],function(e,t,n,r,i){var s=e.extend({initialize:function(){this._super.apply(this,arguments),this._session=null,this._ucStatus=null},setSession:function(e,n){return this._session=new t(e,{silent:!0}),this._session.on("change",this._checkSessionStatus,this,n.timeout),this._session.get("status")==="ok"&&this._session.get("sessionTime")>0&&this.publish("session:ready"),this._session},setUsersConnectionStatus:function(e,t){return this._ucStatus=new n(e,{silent:!0}),this._ucStatus.on("change",this._checkUsersConnectionStatus,this,t.timeout),this._ucStatus},ping:function(e){var n=this,s=new t,o=new i.Deferred;return i.when(s.ping(e)).done(function(e){n._pingSuccess(e),o.resolve(e)}).fail(function(e,t,n){n==="Unauthorized"&&window.cerrarSesion&&window.cerrarSesion(),o.reject(new r(e))}),o},refreshUsersConnection:function(){if(this._ucStatus)return this._ucStatus.refresh();return},publishSessionError:function(e){this.publish(e)},_checkSessionStatus:function(e){var t=this._session.get("sessionTime");console.log("[SessionDataManager] Session time left: "+t),t<0?this.publish("session:expired"):t<e&&this.publish("session:timeout",t)},_pingSuccess:function(e){this._session.set(e.result.session),this._ucStatus.set(e.result.usersConnection)},_checkUsersConnectionStatus:function(){var e=this,t=i.reduce(this.constructor.STATUS,function(t,n,r){return t[r]=i.find(e._ucStatus.get("userConnections"),function(e){return i.indexOf(n,e.status)>-1}),t},{});t.UPDATING?(console.log("[SessionDataManager] _checkUsersConnectionStatus()... entities are updating..."),this.publish("data:updating"),this._accountsUpdating=!0):t.ERROR?(console.log("[SessionDataManager] _checkUsersConnectionStatus()... error thrown while updating entities."),this.publish("data:update:error"),this._accountsUpdating=!1):t.OK&&(this._accountsUpdating?(console.log("[SessionDataManager] _checkUsersConnectionStatus()... entities updated"),this.publish("data:updated"),this._accountsUpdating=!1,this.publish("data:update")):(console.log("[SessionDataManager] _checkUsersConnectionStatus()... entities data is ready, do not need to be updated"),this.publish("data:ready")))}},{STATUS:{OK:["OK","UPDATE_PARTIAL_ERROR"],UPDATING:["LOGIN_IN_PROGRESS","REFRESHING_IN_PROGRESS","GETTING_IN_PROGRESS","COMPUTING_IN_PROGRESS"],ERROR:["CREATED","USER_ACTION_REQUIRED","ERROR","LOGIN_FAILED","PASSWORD_EXPIRED","ACCOUNT_LOCKED","UNAVAILABLE_DATA_SOURCE","CANCELLED_ACCOUNT","ACCOUNT_ALREADY_REGISTERED","ACCOUNT_REGISTRATION_TIME_OUT"]}});return s}),define("services/session-service",["classes/service","data/session/session-data-manager","utils/util","backbone"],function(e,t,n,r){var i=e.extend({initialize:function(){this._super.apply(this,arguments),this.config=n.extend({},i.defaults),this.sessionDM=t.getInstance()},setConfig:function(e){n.merge(this.config,e)},start:function(e,t){var r=this.sessionDM.setSession(e.session,t);this.sessionDM.setUsersConnectionStatus(e.usersConnection,t),r.get("status")==="ok"&&r.get("sessionTime")>0&&this._timeout==null&&this.config.accountsInterval?this._timeout=setTimeout(n.bind(this._keepAlivePing,this),this.config.accountsInterval):(this.publish("session:error"),console.log("[SessionService] start()... error",r))},stop:function(){this._timeout&&(clearTimeout(this._timeout),delete this._timeout)},ping:function(e){return this.sessionDM.ping(e)},refreshUsersConnection:function(){return this.sessionDM.refreshUsersConnection()},publishSessionError:function(e){this.sessionDM.publishSessionError(e)},_keepAlivePingError:function(e){console.log("[SessionService] _keepAlivePingError()... error",e),this.stop()},_keepAlivePing:function(){n.when(this.ping()).done(n.bind(this._keepAlivePingSuccess,this)).fail(n.bind(this._keepAlivePingError,this))},_keepAlivePingSuccess:function(e){console.log("[SessionService] _keepAlivePingSuccess()... success",e);var t=n.find(e.result.usersConnection.userConnections,function(e){return n.indexOf(this.constructor.UPDATING_STATUS,e.status)>-1},this),r=t?this.config.accountsInterval:this.config.pingInterval;this._timeout&&(this._timeout=setTimeout(n.bind(this._keepAlivePing,this),r))}},{ID:"session-service",STATUS:t.STATUS,defaults:{pingInterval:3e4,accountsInterval:3e3,entityStatus:{}}});return i.extend(r.Events)}),define("services/session-service-extension",["services/session-service","utils/util"],function(e,t){var n=e.extend({start:function(e,n){var r=this.sessionDM.setSession(e.session,n);this.sessionDM.setUsersConnectionStatus(e.usersConnection,n),r.get("status")==="ok"&&r.get("sessionTime")>0&&this.config.accountsInterval?this._timeout=setTimeout(t.bind(this._keepAlivePing,this),this.config.accountsInterval):console.log("[SessionService] start()... error",r)},_keepAlivePingSuccess:function(e){console.log("[SessionService] _keepAlivePingSuccess()... success",e);var n=t.find(e.result.usersConnection.userConnections,function(e){return t.indexOf(this.constructor.UPDATING_STATUS,e.status)>-1},this),r=n?this.config.accountsInterval:this.config.pingInterval;this._timeout&&(this._timeout=setTimeout(t.bind(this._keepAlivePing,this),5e3))}},{});return n}),define("utils/session",["utils/util","services/session-service"],function(e,t){return e.session=t.getInstance(),e}),define("classes/application-pfm",["classes/application","classes/data-manager","classes/resource-loader","utils/util","utils/i18n","utils/session","utils/config","utils/locale"],function(e,t,n,r){var i=e.extend({_addResources:function(){console.log("[app] _addResources()..."),this._getResourcesIds(),this._resources={config:new n(r.config,r.config.load,this._resourcesIds)}},_setUpResources:function(e){console.log("[app] _setUpResources()..."),r.config.setGlobals({format:r.config.get("format")}),r.i18n.addResources(r.config.get("i18n")),r.session.setConfig(this.config.session),r.session.start(e.data,{timeout:this.config.session.sessionTimeout}),this._setUpUserPreferences(e.data),this._setUpLastImportationDate(e.data),this._super()},_setUpUserPreferences:function(e){e.profile&&e.profile.uprName&&(e.profile.uprSurname1?this.config.user.name=e.profile.uprName+" "+e.profile.uprSurname1:this.config.user.name=e.profile.uprName),e.profile&&e.profile.uprCurrency&&(this.config.user.currency=e.profile.uprCurrency),e.profile&&e.profile.locale&&r.locale.setLocale(e.profile.locale)},_setUpLastImportationDate:function(e){if(e.usersConnection&&e.usersConnection.attributes&&e.usersConnection.attributes.userConnections){var t=e.usersConnection.attributes.userConnections,n=r.config.getGlobals().lastUpdate;n&&r.isDate(n)&&(n=n.getTime()),r.each(t,function(e){if(!n||n<e.lastUpdate)n=e.lastUpdate}),r.config.setGlobals({lastUpdate:new Date(n)})}}},{defaults:{session:{sessionTimeout:60}}});return i}),define("classes/application-extension",["classes/application"],function(e){var t=e.extend({},{defaults:{environment:{contextPath:"/api"},format:{numberFormat:{decimalSeparator:",",groupingSeparator:".",groupingSize:3,maximumFractionDigits:2,minimumFractionDigits:2,negativePrefix:"-CUR ",negativeSuffix:"",positivePrefix:"CUR ",positiveSuffix:"",zeroPrefix:"",zeroSuffix:" CUR",percentSuffix:"{{*}}"},dateFormat:{shortDate:"d/MM/yy",mediumDate:"dd-MMM-yyyy",longDate:"MMMM d, yyyy",shortMonthYear:"MMM yy",mediumMonthYear:"MMM yyyy",longMonthYear:"MMMM yyyy",backendDate:"yyyy-MM-dd"}},validator:{}}});return t}),function(){"use strict";function e(t,r){function s(e,t){return function(){return e.apply(t,arguments)}}var i;r=r||{},this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=r.touchBoundary||10,this.layer=t,this.tapDelay=r.tapDelay||200,this.tapTimeout=r.tapTimeout||700;if(e.notNeeded(t))return;var o=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"],u=this;for(var a=0,f=o.length;a<f;a++)u[o[a]]=s(u[o[a]],u);n&&(t.addEventListener("mouseover",this.onMouse,!0),t.addEventListener("mousedown",this.onMouse,!0),t.addEventListener("mouseup",this.onMouse,!0)),t.addEventListener("click",this.onClick,!0),t.addEventListener("touchstart",this.onTouchStart,!1),t.addEventListener("touchmove",this.onTouchMove,!1),t.addEventListener("touchend",this.onTouchEnd,!1),t.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(t.removeEventListener=function(e,n,r){var i=Node.prototype.removeEventListener;e==="click"?i.call(t,e,n.hijacked||n,r):i.call(t,e,n,r)},t.addEventListener=function(e,n,r){var i=Node.prototype.addEventListener;e==="click"?i.call(t,e,n.hijacked||(n.hijacked=function(e){e.propagationStopped||n(e)}),r):i.call(t,e,n,r)}),typeof t.onclick=="function"&&(i=t.onclick,t.addEventListener("click",function(e){i(e)},!1),t.onclick=null)}var t=navigator.userAgent.indexOf("Windows Phone")>=0,n=navigator.userAgent.indexOf("Android")>0&&!t,r=/iP(ad|hone|od)/.test(navigator.userAgent)&&!t,i=r&&/OS 4_\d(_\d)?/.test(navigator.userAgent),s=r&&/OS [6-7]_\d/.test(navigator.userAgent),o=navigator.userAgent.indexOf("BB10")>0;e.prototype.needsClick=function(e){switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled)return!0;break;case"input":if(r&&e.type==="file"||e.disabled)return!0;break;case"label":case"iframe":case"video":return!0}return/\bneedsclick\b/.test(e.className)},e.prototype.needsFocus=function(e){switch(e.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!n;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}},e.prototype.sendClick=function(e,t){var n,r;document.activeElement&&document.activeElement!==e&&document.activeElement.blur(),r=t.changedTouches[0],n=document.createEvent("MouseEvents"),n.initMouseEvent(this.determineEventType(e),!0,!0,window,1,r.screenX,r.screenY,r.clientX,r.clientY,!1,!1,!1,!1,0,null),n.forwardedTouchEvent=!0,e.dispatchEvent(n)},e.prototype.determineEventType=function(e){return n&&e.tagName.toLowerCase()==="select"?"mousedown":"click"},e.prototype.focus=function(e){var t;r&&e.setSelectionRange&&e.type.indexOf("date")!==0&&e.type!=="time"&&e.type!=="month"?(t=e.value.length,e.setSelectionRange(t,t)):e.focus()},e.prototype.updateScrollParent=function(e){var t,n;t=e.fastClickScrollParent;if(!t||!t.contains(e)){n=e;do{if(n.scrollHeight>n.offsetHeight){t=n,e.fastClickScrollParent=n;break}n=n.parentElement}while(n)}t&&(t.fastClickLastScrollTop=t.scrollTop)},e.prototype.getTargetElementFromEventTarget=function(e){return e.nodeType===Node.TEXT_NODE?e.parentNode:e},e.prototype.onTouchStart=function(e){var t,n,s;if(e.targetTouches.length>1)return!0;t=this.getTargetElementFromEventTarget(e.target),n=e.targetTouches[0];if(r){s=window.getSelection();if(s.rangeCount&&!s.isCollapsed)return!0;if(!i){if(n.identifier&&n.identifier===this.lastTouchIdentifier)return e.preventDefault(),!1;this.lastTouchIdentifier=n.identifier,this.updateScrollParent(t)}}return this.trackingClick=!0,this.trackingClickStart=e.timeStamp,this.targetElement=t,this.touchStartX=n.pageX,this.touchStartY=n.pageY,e.timeStamp-this.lastClickTime<this.tapDelay&&e.preventDefault(),!0},e.prototype.touchHasMoved=function(e){var t=e.changedTouches[0],n=this.touchBoundary;return Math.abs(t.pageX-this.touchStartX)>n||Math.abs(t.pageY-this.touchStartY)>n?!0:!1},e.prototype.onTouchMove=function(e){if(!this.trackingClick)return!0;if(this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e))this.trackingClick=!1,this.targetElement=null;return!0},e.prototype.findControl=function(e){return e.control!==undefined?e.control:e.htmlFor?document.getElementById(e.htmlFor):e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},e.prototype.onTouchEnd=function(e){var t,o,u,a,f,l=this.targetElement;if(!this.trackingClick)return!0;if(e.timeStamp-this.lastClickTime<this.tapDelay)return this.cancelNextClick=!0,!0;if(e.timeStamp-this.trackingClickStart>this.tapTimeout)return!0;this.cancelNextClick=!1,this.lastClickTime=e.timeStamp,o=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,s&&(f=e.changedTouches[0],l=document.elementFromPoint(f.pageX-window.pageXOffset,f.pageY-window.pageYOffset)||l,l.fastClickScrollParent=this.targetElement.fastClickScrollParent),u=l.tagName.toLowerCase();if(u==="label"){t=this.findControl(l);if(t){this.focus(l);if(n)return!1;l=t}}else if(this.needsFocus(l)){if(e.timeStamp-o>100||r&&window.top!==window&&u==="input")return this.targetElement=null,!1;this.focus(l),this.sendClick(l,e);if(!r||u!=="select")this.targetElement=null,e.preventDefault();return!1}if(r&&!i){a=l.fastClickScrollParent;if(a&&a.fastClickLastScrollTop!==a.scrollTop)return!0}return this.needsClick(l)||(e.preventDefault(),this.sendClick(l,e)),!1},e.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},e.prototype.onMouse=function(e){return this.targetElement?e.forwardedTouchEvent?!0:e.cancelable?!this.needsClick(this.targetElement)||this.cancelNextClick?(e.stopImmediatePropagation?e.stopImmediatePropagation():e.propagationStopped=!0,e.stopPropagation(),e.preventDefault(),!1):!0:!0:!0},e.prototype.onClick=function(e){var t;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):e.target.type==="submit"&&e.detail===0?!0:(t=this.onMouse(e),t||(this.targetElement=null),t)},e.prototype.destroy=function(){var e=this.layer;n&&(e.removeEventListener("mouseover",this.onMouse,!0),e.removeEventListener("mousedown",this.onMouse,!0),e.removeEventListener("mouseup",this.onMouse,!0)),e.removeEventListener("click",this.onClick,!0),e.removeEventListener("touchstart",this.onTouchStart,!1),e.removeEventListener("touchmove",this.onTouchMove,!1),e.removeEventListener("touchend",this.onTouchEnd,!1),e.removeEventListener("touchcancel",this.onTouchCancel,!1)},e.notNeeded=function(e){var t,r,i,s;if(typeof window.ontouchstart=="undefined")return!0;r=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1];if(r){if(!n)return!0;t=document.querySelector("meta[name=viewport]");if(t){if(t.content.indexOf("user-scalable=no")!==-1)return!0;if(r>31&&document.documentElement.scrollWidth<=window.outerWidth)return!0}}if(o){i=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/);if(i[1]>=10&&i[2]>=3){t=document.querySelector("meta[name=viewport]");if(t){if(t.content.indexOf("user-scalable=no")!==-1)return!0;if(document.documentElement.scrollWidth<=window.outerWidth)return!0}}}if(e.style.msTouchAction==="none"||e.style.touchAction==="manipulation")return!0;s=+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1];if(s>=27){t=document.querySelector("meta[name=viewport]");if(t&&(t.content.indexOf("user-scalable=no")!==-1||document.documentElement.scrollWidth<=window.outerWidth))return!0}return e.style.touchAction==="none"||e.style.touchAction==="manipulation"?!0:!1},e.attach=function(t,n){return new e(t,n)},typeof define=="function"&&typeof define.amd=="object"&&define.amd?define("fastclick",[],function(){return e}):typeof module!="undefined"&&module.exports?(module.exports=e.attach,module.exports.FastClick=e):window.FastClick=e}(),define("classes/touch-application",["classes/application","fastclick","jQuery"],function(e,t,n){var r=e.extend({initialize:function(){console.log("[app] initialize TouchApp()... "),this._widgetClasses.push("sf-touch"),this.on("show:widget",function(e){t.attach(n(this._regionManager._regions[e].el)[0])},this),this._super()}});return r}),define("classes/router",["marionette"],function(e){var t=e.AppRouter.extend({});return t}),define("classes/platform-router",["classes/router"],function(e){var t=e.extend({routes:{":tab":"_navigateToTab"},_navigateToTab:function(e){console.log("[PlatformRouter] navigate to %s",e),e=e||"analysis",this.trigger("show:tab",e),this.trigger("show:tab:"+e)}});return t}),define("classes/extensions/context-hub",["marionette","utils/util"],function(e,t){var n={subscribe:function(e,n,r){if(this.hub===undefined)throw new Error(this.constructor.ID?"[ContextHub] "+this.constructor.ID:this.cid+": subscribe() Hub not defined");t.contains(this.contextConfig.globalHubEvents,e)?this.hub.on(e,n,r||this):this.hub.on(this.hubNamespace+e,n,r||this)},unsubscribe:function(){if(this.hub===undefined)throw new Error(this.constructor.ID?"[ContextHub] "+this.constructor.ID:this.cid+": unsubscribe() Hub not defined");this.hub.off.apply(this.hub,arguments)},publish:function(e){if(this.hub===undefined)throw new Error(this.constructor.ID?"[ContextHub] "+this.constructor.ID:this.cid+": publish() Hub not defined");e!=="error"&&(t.contains(this.contextConfig.globalHubEvents,e)||(e=this.hubNamespace+e)),this.hub.trigger.apply(this.hub,arguments)},delegateEvents:function(){this._super();if(this.hubNamespace){var n=this,r={},i=this.contextConfig.globalHubEvents;t.each(e.getOption(this,"hubEvents"),function(e,s){t.contains(i,s)?r[s]=e:r[n.hubNamespace+s]=e}),e.bindEntityEvents(this,this.hub,r)}else e.bindEntityEvents(this,this.hub,e.getOption(this,"hubEvents"))},undelegateEvents:function(){this._super();if(this.hubNamespace){var n=this,r={},i=this.contextConfig.globalHubEvents;t.each(e.getOption(this,"hubEvents"),function(e,s){t.contains(i,s)?r[s]=e:r[n.hubNamespace+s]=e}),e.unbindEntityEvents(this,this.hub,r)}else e.unbindEntityEvents(this,this.hub,e.getOption(this,"hubEvents"))}};return n}),define("classes/extensions/context-config",["backbone","classes/extensions/config-manager","utils/util","utils/config"],function(e,t,n){var r=n.extend(t,{_configure:function(t){e.View.prototype._configure.call(this,t),this.hub=this.hub||this.options.hub,this.globals=n.config.getGlobals(),this._setupConfig(t),this.hubNamespace=this.config.hubNamespace?this.config.hubNamespace+":":"",this._setupContextConfig(),this._setupFilters()},_setupContextConfig:function(){this.contextConfig={$widget:this.options.$widget,hub:this.options.hub,parent:this,$popupContainer:this.options.$popupContainer,$tooltipContainer:this.options.$popupContainer,widget:this.options.widget,globalHubEvents:this.options.globalHubEvents},this.tooltipOptions={position:{container:this.contextConfig.$tooltipContainer||this.contextConfig.$widget,viewport:!0}}},filtersList:[],_setupFilters:function(){if(!this.hub)return;this.config.filters||(this.config.filters={}),this.config.extraFilters||(this.config.extraFilters=[]);if(this.filtersList.length===0)return;this._updateFilters(),this.subscribe("filters:change",this._onFiltersChange),this.subscribe("extraFilters:change",this._onExtraFiltersChange)},_onFiltersChange:function(e){var t=e.filter,r=e.data;if(this.config.filters[t]===r)return;this.config.filters[t]=r,this._updateFilters(),n.contains(this.filtersList,t)&&this._filtersChanged(t,r)},_onExtraFiltersChange:function(e){var t=e.filter,r=e.data,i=n.findIndex(this.config.extraFilters,{filter:t}),s=this.config.extraFilters[i],o=!1;if(i>-1&&i===this.config.extraFilters.length-1&&s.data===r)return;this.config.extraFilters.splice(i,1);if(r===undefined||r===null){if(!s)return;n.size(n.pick(s.data,this.filtersList))>0&&(this._updateFilters(),o=!0)}else this.config.extraFilters.push(e),o=this._updateFilters();o&&this._filtersChanged(t,r,!0)},_updateFilters:function(){var e=!1;return this.filters=n.pick(this.config.filters,this.filtersList),n.each(this.config.extraFilters,function(t){var r=n.pick(t.data,this.filtersList);n.size(r)>0&&(n.extend(this.filters,r),e=!0)},this),e},_filtersChanged:function(){},_setupDatesRangeFilter:function(){this.config.filters.datesRange||(this.config.filters.datesRange={}),this.config.filters.datesRange.toDate===undefined&&(this.config.filters.datesRange.toDate=n.date.parseBackendDate(this.globals.environment.serverDate),this.config.filters.datesRange.toDate=n.date.ceiling(n.date.constructor.MONTH,this.config.filters.datesRange.toDate));if(this.config.filters.datesRange.fromDate===undefined){var e=this.config.filters.datesRange.toDate;this.config.filters.datesRange.fromDate=new Date(e.getFullYear(),e.getMonth()-(this.config.initialRangeMonths-1),1)}},_setupAccountsFilter:function(e,t){var r=this;n.when(e.get()).done(function(e){r.config.filters.accounts={selected:[]},e.each(function(e){var t=e.get("userConnection");n.each(t.accounts,function(e){if(r.config.providerAccId)e.viewFilter&&r.config.providerAccId.toString()===e.providerId&&r.config.filters.accounts.selected.push(e.accountPK);else if(r.config.accNameType){var t=r.config.accNameType.toString().split(";");e.viewFilter&&t[0]===e.alias&&t[1]===e.type.toString()&&r.config.filters.accounts.selected.push(e.accountPK)}else e.viewFilter&&r.config.filters.accounts.selected.push(e.accountPK)},this)},this),typeof t=="function"&&t()}).fail(function(e){console.error("[ContextConfig] Loading accounts error",e),r.publish("error",e)})}});return r}),define("classes/layout",["marionette","utils/util","classes/extensions/context-hub","classes/extensions/context-config"],function(e,t,n,r){var i=e.Layout.extend(t.extend({},n,r));return i}),function(){var e={};(function(e,t){e.VERSION="1.0.0-rc.3",e.COMPILER_REVISION=2,e.REVISION_CHANGES={1:"<= 1.0.rc.2",2:">= 1.0.0-rc.3"},e.helpers={},e.partials={},e.registerHelper=function(e,t,n){n&&(t.not=n),this.helpers[e]=t},e.registerPartial=function(e,t){this.partials[e]=t},e.registerHelper("helperMissing",function(e){if(arguments.length===2)return t;throw new Error("Could not find property '"+e+"'")});var n=Object.prototype.toString,r="[object Function]";e.registerHelper("blockHelperMissing",function(t,i){var s=i.inverse||function(){},o=i.fn,u=n.call(t);return u===r&&(t=t.call(this)),t===!0?o(this):t===!1||t==null?s(this):u==="[object Array]"?t.length>0?e.helpers.each(t,i):s(this):o(t)}),e.K=function(){},e.createFrame=Object.create||function(t){e.K.prototype=t;var n=new e.K;return e.K.prototype=null,n},e.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,methodMap:{0:"debug",1:"info",2:"warn",3:"error"},log:function(t,n){if(e.logger.level<=t){var r=e.logger.methodMap[t];typeof console!="undefined"&&console[r]&&console[r].call(console,n)}}},e.log=function(t,n){e.logger.log(t,n)},e.registerHelper("each",function(t,n){var r=n.fn,i=n.inverse,s=0,o="",u;n.data&&(u=e.createFrame(n.data));if(t&&typeof t=="object")if(t instanceof Array)for(var a=t.length;s<a;s++)u&&(u.index=s),o+=r(t[s],{data:u});else for(var f in t)t.hasOwnProperty(f)&&(u&&(u.key=f),o+=r(t[f],{data:u}),s++);return s===0&&(o=i(this)),o}),e.registerHelper("if",function(t,i){var s=n.call(t);return s===r&&(t=t.call(this)),!t||e.Utils.isEmpty(t)?i.inverse(this):i.fn(this)}),e.registerHelper("unless",function(t,n){return e.helpers["if"].call(this,t,{fn:n.inverse,inverse:n.fn})}),e.registerHelper("with",function(e,t){return t.fn(e)}),e.registerHelper("log",function(t,n){var r=n.data&&n.data.level!=null?parseInt(n.data.level,10):1;e.log(r,t)})})(e);var t=function(){function n(){this.yy={}}var e={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,simpleInverse:6,statements:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,OPEN_PARTIAL:24,partialName:25,params:26,hash:27,DATA:28,param:29,STRING:30,INTEGER:31,BOOLEAN:32,hashSegments:33,hashSegment:34,ID:35,EQUALS:36,PARTIAL_NAME:37,pathSegments:38,SEP:39,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"OPEN_PARTIAL",28:"DATA",30:"STRING",31:"INTEGER",32:"BOOLEAN",35:"ID",36:"EQUALS",37:"PARTIAL_NAME",39:"SEP"},productions_:[0,[3,2],[4,2],[4,3],[4,2],[4,1],[4,1],[4,0],[7,1],[7,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,3],[13,4],[6,2],[17,3],[17,2],[17,2],[17,1],[17,1],[26,2],[26,1],[29,1],[29,1],[29,1],[29,1],[29,1],[27,1],[33,2],[33,1],[34,3],[34,3],[34,3],[34,3],[34,3],[25,1],[21,1],[38,3],[38,1]],performAction:function(t,n,r,i,s,o,u){var a=o.length-1;switch(s){case 1:return o[a-1];case 2:this.$=new i.ProgramNode([],o[a]);break;case 3:this.$=new i.ProgramNode(o[a-2],o[a]);break;case 4:this.$=new i.ProgramNode(o[a-1],[]);break;case 5:this.$=new i.ProgramNode(o[a]);break;case 6:this.$=new i.ProgramNode([],[]);break;case 7:this.$=new i.ProgramNode([]);break;case 8:this.$=[o[a]];break;case 9:o[a-1].push(o[a]),this.$=o[a-1];break;case 10:this.$=new i.BlockNode(o[a-2],o[a-1].inverse,o[a-1],o[a]);break;case 11:this.$=new i.BlockNode(o[a-2],o[a-1],o[a-1].inverse,o[a]);break;case 12:this.$=o[a];break;case 13:this.$=o[a];break;case 14:this.$=new i.ContentNode(o[a]);break;case 15:this.$=new i.CommentNode(o[a]);break;case 16:this.$=new i.MustacheNode(o[a-1][0],o[a-1][1]);break;case 17:this.$=new i.MustacheNode(o[a-1][0],o[a-1][1]);break;case 18:this.$=o[a-1];break;case 19:this.$=new i.MustacheNode(o[a-1][0],o[a-1][1]);break;case 20:this.$=new i.MustacheNode(o[a-1][0],o[a-1][1],!0);break;case 21:this.$=new i.PartialNode(o[a-1]);break;case 22:this.$=new i.PartialNode(o[a-2],o[a-1]);break;case 23:break;case 24:this.$=[[o[a-2]].concat(o[a-1]),o[a]];break;case 25:this.$=[[o[a-1]].concat(o[a]),null];break;case 26:this.$=[[o[a-1]],o[a]];break;case 27:this.$=[[o[a]],null];break;case 28:this.$=[[new i.DataNode(o[a])],null];break;case 29:o[a-1].push(o[a]),this.$=o[a-1];break;case 30:this.$=[o[a]];break;case 31:this.$=o[a];break;case 32:this.$=new i.StringNode(o[a]);break;case 33:this.$=new i.IntegerNode(o[a]);break;case 34:this.$=new i.BooleanNode(o[a]);break;case 35:this.$=new i.DataNode(o[a]);break;case 36:this.$=new i.HashNode(o[a]);break;case 37:o[a-1].push(o[a]),this.$=o[a-1];break;case 38:this.$=[o[a]];break;case 39:this.$=[o[a-2],o[a]];break;case 40:this.$=[o[a-2],new i.StringNode(o[a])];break;case 41:this.$=[o[a-2],new i.IntegerNode(o[a])];break;case 42:this.$=[o[a-2],new i.BooleanNode(o[a])];break;case 43:this.$=[o[a-2],new i.DataNode(o[a])];break;case 44:this.$=new i.PartialNameNode(o[a]);break;case 45:this.$=new i.IdNode(o[a]);break;case 46:o[a-2].push(o[a]),this.$=o[a-2];break;case 47:this.$=[o[a]]}},table:[{3:1,4:2,5:[2,7],6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],22:[1,14],23:[1,15],24:[1,16]},{1:[3]},{5:[1,17]},{5:[2,6],7:18,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,6],22:[1,14],23:[1,15],24:[1,16]},{5:[2,5],6:20,8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,5],22:[1,14],23:[1,15],24:[1,16]},{17:23,18:[1,22],21:24,28:[1,25],35:[1,27],38:26},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],24:[2,8]},{4:28,6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,7],22:[1,14],23:[1,15],24:[1,16]},{4:29,6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,7],22:[1,14],23:[1,15],24:[1,16]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],24:[2,12]},{5:[2,13],14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],24:[2,13]},{5:[2,14],14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],24:[2,14]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],24:[2,15]},{17:30,21:24,28:[1,25],35:[1,27],38:26},{17:31,21:24,28:[1,25],35:[1,27],38:26},{17:32,21:24,28:[1,25],35:[1,27],38:26},{25:33,37:[1,34]},{1:[2,1]},{5:[2,2],8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,2],22:[1,14],23:[1,15],24:[1,16]},{17:23,21:24,28:[1,25],35:[1,27],38:26},{5:[2,4],7:35,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,4],22:[1,14],23:[1,15],24:[1,16]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],24:[2,9]},{5:[2,23],14:[2,23],15:[2,23],16:[2,23],19:[2,23],20:[2,23],22:[2,23],23:[2,23],24:[2,23]},{18:[1,36]},{18:[2,27],21:41,26:37,27:38,28:[1,45],29:39,30:[1,42],31:[1,43],32:[1,44],33:40,34:46,35:[1,47],38:26},{18:[2,28]},{18:[2,45],28:[2,45],30:[2,45],31:[2,45],32:[2,45],35:[2,45],39:[1,48]},{18:[2,47],28:[2,47],30:[2,47],31:[2,47],32:[2,47],35:[2,47],39:[2,47]},{10:49,20:[1,50]},{10:51,20:[1,50]},{18:[1,52]},{18:[1,53]},{18:[1,54]},{18:[1,55],21:56,35:[1,27],38:26},{18:[2,44],35:[2,44]},{5:[2,3],8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,3],22:[1,14],23:[1,15],24:[1,16]},{14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],24:[2,17]},{18:[2,25],21:41,27:57,28:[1,45],29:58,30:[1,42],31:[1,43],32:[1,44],33:40,34:46,35:[1,47],38:26},{18:[2,26]},{18:[2,30],28:[2,30],30:[2,30],31:[2,30],32:[2,30],35:[2,30]},{18:[2,36],34:59,35:[1,60]},{18:[2,31],28:[2,31],30:[2,31],31:[2,31],32:[2,31],35:[2,31]},{18:[2,32],28:[2,32],30:[2,32],31:[2,32],32:[2,32],35:[2,32]},{18:[2,33],28:[2,33],30:[2,33],31:[2,33],32:[2,33],35:[2,33]},{18:[2,34],28:[2,34],30:[2,34],31:[2,34],32:[2,34],35:[2,34]},{18:[2,35],28:[2,35],30:[2,35],31:[2,35],32:[2,35],35:[2,35]},{18:[2,38],35:[2,38]},{18:[2,47],28:[2,47],30:[2,47],31:[2,47],32:[2,47],35:[2,47],36:[1,61],39:[2,47]},{35:[1,62]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],24:[2,10]},{21:63,35:[1,27],38:26},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],24:[2,11]},{14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],24:[2,16]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],24:[2,19]},{5:[2,20],14:[2,20],15:[2,20],16:[2,20],19:[2,20],20:[2,20],22:[2,20],23:[2,20],24:[2,20]},{5:[2,21],14:[2,21],15:[2,21],16:[2,21],19:[2,21],20:[2,21],22:[2,21],23:[2,21],24:[2,21]},{18:[1,64]},{18:[2,24]},{18:[2,29],28:[2,29],30:[2,29],31:[2,29],32:[2,29],35:[2,29]},{18:[2,37],35:[2,37]},{36:[1,61]},{21:65,28:[1,69],30:[1,66],31:[1,67],32:[1,68],35:[1,27],38:26},{18:[2,46],28:[2,46],30:[2,46],31:[2,46],32:[2,46],35:[2,46],39:[2,46]},{18:[1,70]},{5:[2,22],14:[2,22],15:[2,22],16:[2,22],19:[2,22],20:[2,22],22:[2,22],23:[2,22],24:[2,22]},{18:[2,39],35:[2,39]},{18:[2,40],35:[2,40]},{18:[2,41],35:[2,41]},{18:[2,42],35:[2,42]},{18:[2,43],35:[2,43]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],24:[2,18]}],defaultActions:{17:[2,1],25:[2,28],38:[2,26],57:[2,24]},parseError:function(t,n){throw new Error(t)},parse:function(t){function v(e){r.length=r.length-2*e,i.length=i.length-e,s.length=s.length-e}function m(){var e;return e=n.lexer.lex()||1,typeof e!="number"&&(e=n.symbols_[e]||e),e}var n=this,r=[0],i=[null],s=[],o=this.table,u="",a=0,f=0,l=0,c=2,h=1;this.lexer.setInput(t),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,typeof this.lexer.yylloc=="undefined"&&(this.lexer.yylloc={});var p=this.lexer.yylloc;s.push(p);var d=this.lexer.options&&this.lexer.options.ranges;typeof this.yy.parseError=="function"&&(this.parseError=this.yy.parseError);var g,y,b,w,E,S,x={},T,N,C,k;for(;;){b=r[r.length-1];if(this.defaultActions[b])w=this.defaultActions[b];else{if(g===null||typeof g=="undefined")g=m();w=o[b]&&o[b][g]}if(typeof w=="undefined"||!w.length||!w[0]){var L="";if(!l){k=[];for(T in o[b])this.terminals_[T]&&T>2&&k.push("'"+this.terminals_[T]+"'");this.lexer.showPosition?L="Parse error on line "+(a+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+k.join(", ")+", got '"+(this.terminals_[g]||g)+"'":L="Parse error on line "+(a+1)+": Unexpected "+(g==1?"end of input":"'"+(this.terminals_[g]||g)+"'"),this.parseError(L,{text:this.lexer.match,token:this.terminals_[g]||g,line:this.lexer.yylineno,loc:p,expected:k})}}if(w[0]instanceof Array&&w.length>1)throw new Error("Parse Error: multiple actions possible at state: "+b+", token: "+g);switch(w[0]){case 1:r.push(g),i.push(this.lexer.yytext),s.push(this.lexer.yylloc),r.push(w[1]),g=null,y?(g=y,y=null):(f=this.lexer.yyleng,u=this.lexer.yytext,a=this.lexer.yylineno,p=this.lexer.yylloc,l>0&&l--);break;case 2:N=this.productions_[w[1]][1],x.$=i[i.length-N],x._$={first_line:s[s.length-(N||1)].first_line,last_line:s[s.length-1].last_line,first_column:s[s.length-(N||1)].first_column,last_column:s[s.length-1].last_column},d&&(x._$.range=[s[s.length-(N||1)].range[0],s[s.length-1].range[1]]),S=this.performAction.call(x,u,f,a,this.yy,w[1],i,s);if(typeof S!="undefined")return S;N&&(r=r.slice(0,-1*N*2),i=i.slice(0,-1*N),s=s.slice(0,-1*N)),r.push(this.productions_[w[1]][0]),i.push(x.$),s.push(x._$),C=o[r[r.length-2]][r[r.length-1]],r.push(C);break;case 3:return!0}}return!0}},t=function(){var e={EOF:1,parseError:function(t,n){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,n)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e;var t=e.match(/(?:\r\n?|\n).*/g);return t?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t-1),this.offset-=t;var r=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var i=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===r.length?this.yylloc.first_column:0)+r[r.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[i[0],i[0]+this.yyleng-t]),this},more:function(){return this._more=!0,this},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=(new Array(e.length+1)).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,n,r,i,s;this._more||(this.yytext="",this.match="");var o=this._currentRules();for(var u=0;u<o.length;u++){n=this._input.match(this.rules[o[u]]);if(n&&(!t||n[0].length>t[0].length)){t=n,r=u;if(!this.options.flex)break}}if(t){s=t[0].match(/(?:\r\n?|\n).*/g),s&&(this.yylineno+=s.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:s?s[s.length-1].length-s[s.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,o[r],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1);if(e)return e;return}return this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return typeof t!="undefined"?t:this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(t){this.begin(t)}};return e.options={},e.performAction=function(t,n,r,i){var s=i;switch(r){case 0:n.yytext.slice(-1)!=="\\"&&this.begin("mu"),n.yytext.slice(-1)==="\\"&&(n.yytext=n.yytext.substr(0,n.yyleng-1),this.begin("emu"));if(n.yytext)return 14;break;case 1:return 14;case 2:return n.yytext.slice(-1)!=="\\"&&this.popState(),n.yytext.slice(-1)==="\\"&&(n.yytext=n.yytext.substr(0,n.yyleng-1)),14;case 3:return n.yytext=n.yytext.substr(0,n.yyleng-4),this.popState(),15;case 4:return this.begin("par"),24;case 5:return 16;case 6:return 20;case 7:return 19;case 8:return 19;case 9:return 23;case 10:return 23;case 11:this.popState(),this.begin("com");break;case 12:return n.yytext=n.yytext.substr(3,n.yyleng-5),this.popState(),15;case 13:return 22;case 14:return 36;case 15:return 35;case 16:return 35;case 17:return 39;case 18:break;case 19:return this.popState(),18;case 20:return this.popState(),18;case 21:return n.yytext=n.yytext.substr(1,n.yyleng-2).replace(/\\"/g,'"'),30;case 22:return n.yytext=n.yytext.substr(1,n.yyleng-2).replace(/\\'/g,"'"),30;case 23:return n.yytext=n.yytext.substr(1),28;case 24:return 32;case 25:return 32;case 26:return 31;case 27:return 35;case 28:return n.yytext=n.yytext.substr(1,n.yyleng-2),35;case 29:return"INVALID";case 30:break;case 31:return this.popState(),37;case 32:return 5}},e.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|$)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\{\{>)/,/^(?:\{\{#)/,/^(?:\{\{\/)/,/^(?:\{\{\^)/,/^(?:\{\{\s*else\b)/,/^(?:\{\{\{)/,/^(?:\{\{&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{)/,/^(?:=)/,/^(?:\.(?=[} ]))/,/^(?:\.\.)/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}\}\})/,/^(?:\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@[a-zA-Z]+)/,/^(?:true(?=[}\s]))/,/^(?:false(?=[}\s]))/,/^(?:-?[0-9]+(?=[}\s]))/,/^(?:[a-zA-Z0-9_$-]+(?=[=}\s\/.]))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:\s+)/,/^(?:[a-zA-Z0-9_$-/]+)/,/^(?:$)/],e.conditions={mu:{rules:[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,32],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[3],inclusive:!1},par:{rules:[30,31],inclusive:!1},INITIAL:{rules:[0,1,32],inclusive:!0}},e}();return e.lexer=t,n.prototype=e,e.Parser=n,new n}();e.Parser=t,e.parse=function(t){return t.constructor===e.AST.ProgramNode?t:(e.Parser.yy=e.AST,e.Parser.parse(t))},function(){e.AST={},e.AST.ProgramNode=function(t,n){this.type="program",this.statements=t,n&&(this.inverse=new e.AST.ProgramNode(n))},e.AST.MustacheNode=function(e,t,n){this.type="mustache",this.escaped=!n,this.hash=t;var r=this.id=e[0],i=this.params=e.slice(1),s=this.eligibleHelper=r.isSimple;this.isHelper=s&&(i.length||t)},e.AST.PartialNode=function(e,t){this.type="partial",this.partialName=e,this.context=t},e.AST.BlockNode=function(t,n,r,i){var s=function(t,n){if(t.original!==n.original)throw new e.Exception(t.original+" doesn't match "+n.original)};s(t.id,i),this.type="block",this.mustache=t,this.program=n,this.inverse=r,this.inverse&&!this.program&&(this.isInverse=!0)},e.AST.ContentNode=function(e){this.type="content",this.string=e},e.AST.HashNode=function(e){this.type="hash",this.pairs=e},e.AST.IdNode=function(t){this.type="ID",this.original=t.join(".");var n=[],r=0;for(var i=0,s=t.length;i<s;i++){var o=t[i];if(o===".."||o==="."||o==="this"){if(n.length>0)throw new e.Exception("Invalid path: "+this.original);o===".."?r++:this.isScoped=!0}else n.push(o)}this.parts=n,this.string=n.join("."),this.depth=r,this.isSimple=t.length===1&&!this.isScoped&&r===0,this.stringModeValue=this.string},e.AST.PartialNameNode=function(e){this.type="PARTIAL_NAME",this.name=e},e.AST.DataNode=function(e){this.type="DATA",this.id=e},e.AST.StringNode=function(e){this.type="STRING",this.string=e,this.stringModeValue=e},e.AST.IntegerNode=function(e){this.type="INTEGER",this.integer=e,this.stringModeValue=Number(e)},e.AST.BooleanNode=function(e){this.type="BOOLEAN",this.bool=e,this.stringModeValue=e==="true"},e.AST.CommentNode=function(e){this.type="comment",this.comment=e}}();var n=["description","fileName","lineNumber","message","name","number","stack"];e.Exception=function(e){var t=Error.prototype.constructor.apply(this,arguments);for(var r=0;r<n.length;r++)this[n[r]]=t[n[r]]},e.Exception.prototype=new Error,e.SafeString=function(e){this.string=e},e.SafeString.prototype.toString=function(){return this.string.toString()},function(){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},n=/[&<>"'`]/g,r=/[&<>"'`]/,i=function(e){return t[e]||"&amp;"};e.Utils={escapeExpression:function(t){return t instanceof e.SafeString?t.toString():t==null||t===!1?"":r.test(t)?t.replace(n,i):t},isEmpty:function(e){return!e&&e!==0?!0:Object.prototype.toString.call(e)==="[object Array]"&&e.length===0?!0:!1}}}(),e.Compiler=function(){},e.JavaScriptCompiler=function(){},function(t,n){t.prototype={compiler:t,disassemble:function(){var e=this.opcodes,t,n=[],r,i;for(var s=0,o=e.length;s<o;s++){t=e[s];if(t.opcode==="DECLARE")n.push("DECLARE "+t.name+"="+t.value);else{r=[];for(var u=0;u<t.args.length;u++)i=t.args[u],typeof i=="string"&&(i='"'+i.replace("\n","\\n")+'"'),r.push(i);n.push(t.opcode+" "+r.join(" "))}}return n.join("\n")},equals:function(e){var t=this.opcodes.length;if(e.opcodes.length!==t)return!1;for(var n=0;n<t;n++){var r=this.opcodes[n],i=e.opcodes[n];if(r.opcode!==i.opcode||r.args.length!==i.args.length)return!1;for(var s=0;s<r.args.length;s++)if(r.args[s]!==i.args[s])return!1}t=this.children.length;if(e.children.length!==t)return!1;for(n=0;n<t;n++)if(!this.children[n].equals(e.children[n]))return!1;return!0},guid:0,compile:function(e,t){this.children=[],this.depths={list:[]},this.options=t;var n=this.options.knownHelpers;this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0};if(n)for(var r in n)this.options.knownHelpers[r]=n[r];return this.program(e)},accept:function(e){return this[e.type](e)},program:function(e){var t=e.statements,n;this.opcodes=[];for(var r=0,i=t.length;r<i;r++)n=t[r],this[n.type](n);return this.isSimple=i===1,this.depths.list=this.depths.list.sort(function(e,t){return e-t}),this},compileProgram:function(e){var t=(new this.compiler).compile(e,this.options),n=this.guid++,r;this.usePartial=this.usePartial||t.usePartial,this.children[n]=t;for(var i=0,s=t.depths.list.length;i<s;i++){r=t.depths.list[i];if(r<2)continue;this.addDepth(r-1)}return n},block:function(e){var t=e.mustache,n=e.program,r=e.inverse;n&&(n=this.compileProgram(n)),r&&(r=this.compileProgram(r));var i=this.classifyMustache(t);i==="helper"?this.helperMustache(t,n,r):i==="simple"?(this.simpleMustache(t),this.opcode("pushProgram",n),this.opcode("pushProgram",r),this.opcode("emptyHash"),this.opcode("blockValue")):(this.ambiguousMustache(t,n,r),this.opcode("pushProgram",n),this.opcode("pushProgram",r),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},hash:function(e){var t=e.pairs,n,r;this.opcode("pushHash");for(var i=0,s=t.length;i<s;i++)n=t[i],r=n[1],this.options.stringParams?this.opcode("pushStringParam",r.stringModeValue,r.type):this.accept(r),this.opcode("assignToHash",n[0]);this.opcode("popHash")},partial:function(e){var t=e.partialName;this.usePartial=!0,e.context?this.ID(e.context):this.opcode("push","depth0"),this.opcode("invokePartial",t.name),this.opcode("append")},content:function(e){this.opcode("appendContent",e.string)},mustache:function(e){var t=this.options,n=this.classifyMustache(e);n==="simple"?this.simpleMustache(e):n==="helper"?this.helperMustache(e):this.ambiguousMustache(e),e.escaped&&!t.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ambiguousMustache:function(e,t,n){var r=e.id,i=r.parts[0],s=t!=null||n!=null;this.opcode("getContext",r.depth),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.opcode("invokeAmbiguous",i,s)},simpleMustache:function(e){var t=e.id;t.type==="DATA"?this.DATA(t):t.parts.length?this.ID(t):(this.addDepth(t.depth),this.opcode("getContext",t.depth),this.opcode("pushContext")),this.opcode("resolvePossibleLambda")},helperMustache:function(e,t,n){var r=this.setupFullMustacheParams(e,t,n),i=e.id.parts[0];if(this.options.knownHelpers[i])this.opcode("invokeKnownHelper",r.length,i);else{if(this.knownHelpersOnly)throw new Error("You specified knownHelpersOnly, but used the unknown helper "+i);this.opcode("invokeHelper",r.length,i)}},ID:function(e){this.addDepth(e.depth),this.opcode("getContext",e.depth);var t=e.parts[0];t?this.opcode("lookupOnContext",e.parts[0]):this.opcode("pushContext");for(var n=1,r=e.parts.length;n<r;n++)this.opcode("lookup",e.parts[n])},DATA:function(e){this.options.data=!0,this.opcode("lookupData",e.id)},STRING:function(e){this.opcode("pushString",e.string)},INTEGER:function(e){this.opcode("pushLiteral",e.integer)},BOOLEAN:function(e){this.opcode("pushLiteral",e.bool)},comment:function(){},opcode:function(e){this.opcodes.push({opcode:e,args:[].slice.call(arguments,1)})},declare:function(e,t){this.opcodes.push({opcode:"DECLARE",name:e,value:t})},addDepth:function(e){if(isNaN(e))throw new Error("EWOT");if(e===0)return;this.depths[e]||(this.depths[e]=!0,this.depths.list.push(e))},classifyMustache:function(e){var t=e.isHelper,n=e.eligibleHelper,r=this.options;if(n&&!t){var i=e.id.parts[0];r.knownHelpers[i]?t=!0:r.knownHelpersOnly&&(n=!1)}return t?"helper":n?"ambiguous":"simple"},pushParams:function(e){var t=e.length,n;while(t--)n=e[t],this.options.stringParams?(n.depth&&this.addDepth(n.depth),this.opcode("getContext",n.depth||0),this.opcode("pushStringParam",n.stringModeValue,n.type)):this[n.type](n)},setupMustacheParams:function(e){var t=e.params;return this.pushParams(t),e.hash?this.hash(e.hash):this.opcode("emptyHash"),t},setupFullMustacheParams:function(e,t,n){var r=e.params;return this.pushParams(r),this.opcode("pushProgram",t),this.opcode("pushProgram",n),e.hash?this.hash(e.hash):this.opcode("emptyHash"),r}};var r=function(e){this.value=e};n.prototype={nameLookup:function(e,t){return/^[0-9]+$/.test(t)?e+"["+t+"]":n.isValidJavaScriptVariableName(t)?e+"."+t:e+"['"+t+"']"},appendToBuffer:function(e){return this.environment.isSimple?"return "+e+";":{appendToBuffer:!0,content:e,toString:function(){return"buffer += "+e+";"}}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(t,n,r,i){this.environment=t,this.options=n||{},e.log(e.logger.DEBUG,this.environment.disassemble()+"\n\n"),this.name=this.environment.name,this.isChild=!!r,this.context=r||{programs:[],environments:[],aliases:{}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.registers={list:[]},this.compileStack=[],this.inlineStack=[],this.compileChildren(t,n);var s=t.opcodes,o;this.i=0;for(u=s.length;this.i<u;this.i++)o=s[this.i],o.opcode==="DECLARE"?this[o.name]=o.value:this[o.opcode].apply(this,o.args);return this.createFunctionContext(i)},nextOpcode:function(){var e=this.environment.opcodes;return e[this.i+1]},eat:function(){this.i=this.i+1},preamble:function(){var e=[];if(!this.isChild){var t=this.namespace,n="helpers = helpers || "+t+".helpers;";this.environment.usePartial&&(n=n+" partials = partials || "+t+".partials;"),this.options.data&&(n+=" data = data || {};"),e.push(n)}else e.push("");this.environment.isSimple?e.push(""):e.push(", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=e},createFunctionContext:function(t){var n=this.stackVars.concat(this.registers.list);n.length>0&&(this.source[1]=this.source[1]+", "+n.join(", "));if(!this.isChild)for(var r in this.context.aliases)this.source[1]=this.source[1]+", "+r+"="+this.context.aliases[r];this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.source.push("return buffer;");var i=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"];for(var s=0,o=this.environment.depths.list.length;s<o;s++)i.push("depth"+this.environment.depths.list[s]);var u=this.mergeSource();if(!this.isChild){var a=e.COMPILER_REVISION,f=e.REVISION_CHANGES[a];u="this.compilerInfo = ["+a+",'"+f+"'];\n"+u}if(t)return i.push(u),Function.apply(this,i);var l="function "+(this.name||"")+"("+i.join(",")+") {\n  "+u+"}";return e.log(e.logger.DEBUG,l+"\n\n"),l},mergeSource:function(){var e="",t;for(var n=0,r=this.source.length;n<r;n++){var i=this.source[n];i.appendToBuffer?t?t=t+"\n    + "+i.content:t=i.content:(t&&(e+="buffer += "+t+";\n  ",t=undefined),e+=i+"\n  ")}return e},blockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var e=["depth0"];this.setupParams(0,e),this.replaceStack(function(t){return e.splice(1,0,t),"blockHelperMissing.call("+e.join(", ")+")"})},ambiguousBlockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var e=["depth0"];this.setupParams(0,e);var t=this.topStack();e.splice(1,0,t),e[e.length-1]="options",this.source.push("if (!"+this.lastHelper+") { "+t+" = blockHelperMissing.call("+e.join(", ")+"); }")},appendContent:function(e){this.source.push(this.appendToBuffer(this.quotedString(e)))},append:function(){this.flushInline();var e=this.popStack();this.source.push("if("+e+" || "+e+" === 0) { "+this.appendToBuffer(e)+" }"),this.environment.isSimple&&this.source.push("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){this.context.aliases.escapeExpression="this.escapeExpression",this.source.push(this.appendToBuffer("escapeExpression("+this.popStack()+")"))},getContext:function(e){this.lastContext!==e&&(this.lastContext=e)},lookupOnContext:function(e){this.push(this.nameLookup("depth"+this.lastContext,e,"context"))},pushContext:function(){this.pushStackLiteral("depth"+this.lastContext)},resolvePossibleLambda:function(){this.context.aliases.functionType='"function"',this.replaceStack(function(e){return"typeof "+e+" === functionType ? "+e+".apply(depth0) : "+e})},lookup:function(e){this.replaceStack(function(t){return t+" == null || "+t+" === false ? "+t+" : "+this.nameLookup(t,e,"context")})},lookupData:function(e){this.push(this.nameLookup("data",e,"data"))},pushStringParam:function(e,t){this.pushStackLiteral("depth"+this.lastContext),this.pushString(t),typeof e=="string"?this.pushString(e):this.pushStackLiteral(e)},emptyHash:function(){this.pushStackLiteral("{}"),this.options.stringParams&&this.register("hashTypes","{}")},pushHash:function(){this.hash={values:[],types:[]}},popHash:function(){var e=this.hash;this.hash=undefined,this.options.stringParams&&this.register("hashTypes","{"+e.types.join(",")+"}"),this.push("{\n    "+e.values.join(",\n    ")+"\n  }")},pushString:function(e){this.pushStackLiteral(this.quotedString(e))},push:function(e){return this.inlineStack.push(e),e},pushLiteral:function(e){this.pushStackLiteral(e)},pushProgram:function(e){e!=null?this.pushStackLiteral(this.programExpression(e)):this.pushStackLiteral(null)},invokeHelper:function(e,t){this.context.aliases.helperMissing="helpers.helperMissing";var n=this.lastHelper=this.setupHelper(e,t,!0);this.push(n.name),this.replaceStack(function(e){return e+" ? "+e+".call("+n.callParams+") "+": helperMissing.call("+n.helperMissingParams+")"})},invokeKnownHelper:function(e,t){var n=this.setupHelper(e,t);this.push(n.name+".call("+n.callParams+")")},invokeAmbiguous:function(e,t){this.context.aliases.functionType='"function"',this.pushStackLiteral("{}");var n=this.setupHelper(0,e,t),r=this.lastHelper=this.nameLookup("helpers",e,"helper"),i=this.nameLookup("depth"+this.lastContext,e,"context"),s=this.nextStack();this.source.push("if ("+s+" = "+r+") { "+s+" = "+s+".call("+n.callParams+"); }"),this.source.push("else { "+s+" = "+i+"; "+s+" = typeof "+s+" === functionType ? "+s+".apply(depth0) : "+s+"; }")},invokePartial:function(e){var t=[this.nameLookup("partials",e,"partial"),"'"+e+"'",this.popStack(),"helpers","partials"];this.options.data&&t.push("data"),this.context.aliases.self="this",this.push("self.invokePartial("+t.join(", ")+")")},assignToHash:function(e){var t=this.popStack(),n;this.options.stringParams&&(n=this.popStack(),this.popStack());var r=this.hash;n&&r.types.push("'"+e+"': "+n),r.values.push("'"+e+"': ("+t+")")},compiler:n,compileChildren:function(e,t){var n=e.children,r,i;for(var s=0,o=n.length;s<o;s++){r=n[s],i=new this.compiler;var u=this.matchExistingProgram(r);u==null?(this.context.programs.push(""),u=this.context.programs.length,r.index=u,r.name="program"+u,this.context.programs[u]=i.compile(r,t,this.context),this.context.environments[u]=r):(r.index=u,r.name="program"+u)}},matchExistingProgram:function(e){for(var t=0,n=this.context.environments.length;t<n;t++){var r=this.context.environments[t];if(r&&r.equals(e))return t}},programExpression:function(e){this.context.aliases.self="this";if(e==null)return"self.noop";var t=this.environment.children[e],n=t.depths.list,r,i=[t.index,t.name,"data"];for(var s=0,o=n.length;s<o;s++)r=n[s],r===1?i.push("depth0"):i.push("depth"+(r-1));return n.length===0?"self.program("+i.join(", ")+")":(i.shift(),"self.programWithDepth("+i.join(", ")+")")},register:function(e,t){this.useRegister(e),this.source.push(e+" = "+t+";")},useRegister:function(e){this.registers[e]||(this.registers[e]=!0,this.registers.list.push(e))},pushStackLiteral:function(e){return this.push(new r(e))},pushStack:function(e){this.flushInline();var t=this.incrStack();return e&&this.source.push(t+" = "+e+";"),this.compileStack.push(t),t},replaceStack:function(e){var t="",n=this.isInline(),i;if(n){var s=this.popStack(!0);if(s instanceof r)i=s.value;else{var o=this.stackSlot?this.topStackName():this.incrStack();t="("+this.push(o)+" = "+s+"),",i=this.topStack()}}else i=this.topStack();var u=e.call(this,i);return n?((this.inlineStack.length||this.compileStack.length)&&this.popStack(),this.push("("+t+u+")")):(/^stack/.test(i)||(i=this.nextStack()),this.source.push(i+" = ("+t+u+");")),i},nextStack:function(){return this.pushStack()},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var e=this.inlineStack;if(e.length){this.inlineStack=[];for(var t=0,n=e.length;t<n;t++){var i=e[t];i instanceof r?this.compileStack.push(i):this.pushStack(i)}}},isInline:function(){return this.inlineStack.length},popStack:function(e){var t=this.isInline(),n=(t?this.inlineStack:this.compileStack).pop();return!e&&n instanceof r?n.value:(t||this.stackSlot--,n)},topStack:function(e){var t=this.isInline()?this.inlineStack:this.compileStack,n=t[t.length-1];return!e&&n instanceof r?n.value:n},quotedString:function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"'},setupHelper:function(e,t,n){var r=[];this.setupParams(e,r,n);var i=this.nameLookup("helpers",t,"helper");return{params:r,name:i,callParams:["depth0"].concat(r).join(", "),helperMissingParams:n&&["depth0",this.quotedString(t)].concat(r).join(", ")}},setupParams:function(e,t,n){var r=[],i=[],s=[],o,u,a;r.push("hash:"+this.popStack()),u=this.popStack(),a=this.popStack();if(a||u)a||(this.context.aliases.self="this",a="self.noop"),u||(this.context.aliases.self="this",u="self.noop"),r.push("inverse:"+u),r.push("fn:"+a);for(var f=0;f<e;f++)o=this.popStack(),t.push(o),this.options.stringParams&&(s.push(this.popStack()),i.push(this.popStack()));return this.options.stringParams&&(r.push("contexts:["+i.join(",")+"]"),r.push("types:["+s.join(",")+"]"),r.push("hashTypes:hashTypes")),this.options.data&&r.push("data:data"),r="{"+r.join(",")+"}",n?(this.register("options",r),t.push("options")):t.push(r),t.join(", ")}};var i="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),s=n.RESERVED_WORDS={};for(var o=0,u=i.length;o<u;o++)s[i[o]]=!0;n.isValidJavaScriptVariableName=function(e){return!n.RESERVED_WORDS[e]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(e)?!0:!1},e.precompile=function(r,i){if(!r||typeof r!="string"&&r.constructor!==e.AST.ProgramNode)throw new e.Exception("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+r);i=i||{},"data"in i||(i.data=!0);var s=e.parse(r),o=(new t).compile(s,i);return(new n).compile(o,i)},e.compile=function(r,i){function o(){var s=e.parse(r),o=(new t).compile(s,i),u=(new n).compile(o,i,undefined,!0);return e.template(u)}if(!r||typeof r!="string"&&r.constructor!==e.AST.ProgramNode)throw new e.Exception("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+r);i=i||{},"data"in i||(i.data=!0);var s;return function(e,t){return s||(s=o()),s.call(this,e,t)}},e.VM={template:function(t){var n={escapeExpression:e.Utils.escapeExpression,invokePartial:e.VM.invokePartial,programs:[],program:function(t,n,r){var i=this.programs[t];return r?e.VM.program(n,r):i?i:(i=this.programs[t]=e.VM.program(n),i)},programWithDepth:e.VM.programWithDepth,noop:e.VM.noop,compilerInfo:null};return function(r,i){i=i||{};var s=t.call(n,e,r,i.helpers,i.partials,i.data),o=n.compilerInfo||[],u=o[0]||1,a=e.COMPILER_REVISION;if(u!==a){if(u<a){var f=e.REVISION_CHANGES[a],l=e.REVISION_CHANGES[u];throw"Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+f+") or downgrade your runtime to an older version ("+l+")."}throw"Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+o[1]+")."}return s}},programWithDepth:function(e,t,n){var r=Array.prototype.slice.call(arguments,2);return function(n,i){return i=i||{},e.apply(this,[n,i.data||t].concat(r))}},program:function(e,t){return function(n,r){return r=r||{},e(n,r.data||t)}},noop:function(){return""},invokePartial:function(t,n,r,i,s,o){var u={helpers:i,partials:s,data:o};if(t===undefined)throw new e.Exception("The partial "+n+" could not be found");if(t instanceof Function)return t(r,u);if(!e.compile)throw new e.Exception("The partial "+n+" could not be compiled when running in runtime-only mode");return s[n]=e.compile(t,{data:o!==undefined}),s[n](r,u)}},e.template=e.VM.template}(e.Compiler,e.JavaScriptCompiler),define("Handlebars",[],function(){return e})}(),define("hbs",[],function(){return{get:function(){return Handlebars},write:function(e,t,n){if(t+customNameExtension in buildMap){var r=buildMap[t+customNameExtension];n.asModule(e+"!"+t,r)}},version:"0.4.0",load:function(e,t,n,r){}}}),define("hbs!ui/modules/platform/templates/platform",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i,s;r+='\n		<div id="sf-'+a((i=t.key,typeof i===u?i.apply(e):i))+'-tab" class="sf-tab">\n			',s=n.each.call(e,e.items,{hash:{},inverse:f.noop,fn:f.program(2,c,t),data:t});if(s||s===0)r+=s;return r+="\n		</div>\n		",r}function c(e,t){var n="",r;return n+='<div id="sf-'+a((r=t.key,typeof r===u?r.apply(e):r))+'-placeholder"></div>',n}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="sf-platform sf-base sf-',(o=n.projectId)?o=o.call(t,{hash:{},data:i}):(o=t.projectId,o=typeof o===u?o.apply(t):o),s+=a(o)+'">\n	<div class="sf-platform-header"></div>\n	<div class="sf-platform-content">\n		',o=n.each.call(t,t.tabs,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+='\n	</div>\n	<div class="sf-platform-footer">Copyright © <span class="sf-platform-footer-year">',(o=n.currentYear)?o=o.call(t,{hash:{},data:i}):(o=t.currentYear,o=typeof o===u?o.apply(t):o),s+=a(o)+'</span> <a href="http://spf.strands.com" target="_blank">Strands, Inc.</a> All rights reserved.</div>\n</div>',s});return t.registerPartial("ui_modules_platform_templates_platform",n),n}),define("hbs!ui/modules/popup/templates/popup",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){var r="",i;return r+=" ",(i=n["class"])?i=i.call(e,{hash:{}}):(i=e["class"],i=typeof i===u?i.apply(e):i),r+=a(i)+" ",r}function h(e,t){var r="",i;return r+=" sf-popup-special sf-popup-",(i=n.type)?i=i.call(e,{hash:{}}):(i=e.type,i=typeof i===u?i.apply(e):i),r+=a(i),r}function p(e,t){var r="",i;r+='\n			<div class="sf-popup-title-icon" ',i=n["if"].call(e,e.titleIconBackground,{hash:{},inverse:f.noop,fn:f.program(6,d,t)});if(i||i===0)r+=i;r+='>\n				<img src="resources/pfm/ui/css/icons/app-icons/',(i=n.titleIcon)?i=i.call(e,{hash:{}}):(i=e.titleIcon,i=typeof i===u?i.apply(e):i),r+=a(i)+".",i=n["if"].call(e,e.iconExt,{hash:{},inverse:f.program(10,m,t),fn:f.program(8,v,t)});if(i||i===0)r+=i;r+='" ',i=n["if"].call(e,e.titleIconBackground,{hash:{},inverse:f.noop,fn:f.program(6,d,t)});if(i||i===0)r+=i;return r+=">\n			</div>\n		",r}function d(e,t){var r="",i;return r+=' style="background-color: ',(i=n.titleIconBackground)?i=i.call(e,{hash:{}}):(i=e.titleIconBackground,i=typeof i===u?i.apply(e):i),r+=a(i)+'" ',r}function v(e,t){var r;return(r=n.iconExt)?r=r.call(e,{hash:{}}):(r=e.iconExt,r=typeof r===u?r.apply(e):r),a(r)}function m(e,t){return"svg"}function g(e,t){var r="",i;return r+='<div class="sf-popup-subtitle">',(i=n.subtitle)?i=i.call(e,{hash:{}}):(i=e.subtitle,i=typeof i===u?i.apply(e):i),r+=a(i)+"</div>",r}function y(e,t){var r="",i,s,o;r+='\n			<a href="javascript:void(0);" class="sf-popup-close">\n				<span class="sf-popup-close-icon">\n					<img src="resources/pfm/ui/css/icons/app-icons/dav-plus-red.svg" alt="',o={hash:{}},r+=a((i=n.t,i?i.call(e,"popup.label.close",o):l.call(e,"t","popup.label.close",o)))+'">\n				</span>\n				<span class="sf-popup-close-text">',s=n["if"].call(e,e.closeLabel,{hash:{},inverse:f.program(17,w,t),fn:f.program(15,b,t)});if(s||s===0)r+=s;return r+="</span>\n			</a>\n		",r}function b(e,t){var r;return(r=n.closeLabel)?r=r.call(e,{hash:{}}):(r=e.closeLabel,r=typeof r===u?r.apply(e):r),a(r)}function w(e,t){var r,i;return i={hash:{}},a((r=n.t,r?r.call(e,"popup.label.close",i):l.call(e,"t","popup.label.close",i)))}function E(e,t){return'\n			<img src="resources/pfm/ui/css/icons/app-icons/icon-admiration-white.svg" class="sf-admiration-icon" alt="Signo de admiración">\n		'}function S(e,t,r){var i="",s,o,u;i+='\n	<div class="sf-popup-footer sf-button-controls">\n		',u={hash:{"class":"sf-button-confirm sf-popup-confirm",type:"button",text:"{{#if confirmLabel}}{{confirmLabel}}{{else}}common.button.accept{{/if}}"}},i+=a((s=n.button,s?s.call(e,u):l.call(e,"button",u)))+"\n        ",u={hash:{},inverse:f.noop,fn:f.program(22,x,t)},o=(s=n.ifequal,s?s.call(e,r.type,"confirmation",u):l.call(e,"ifequal",r.type,"confirmation",u));if(o||o===0)i+=o;return i+="\n	</div>\n	",i}function x(e,t){var r,i;return i={hash:{"class":"sf-button-cancel sf-popup-cancel",type:"button",text:"{{#if cancelLabel}}{{cancelLabel}}{{else}}common.button.cancel{{/if}}"}},a((r=n.button,r?r.call(e,i):l.call(e,"button",i)))}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=this,l=n.helperMissing;s+='<div class="sf-popup',o=n["if"].call(t,t["class"],{hash:{},inverse:f.noop,fn:f.program(1,c,i)});if(o||o===0)s+=o;o=n["if"].call(t,t.type,{hash:{},inverse:f.noop,fn:f.program(3,h,i)});if(o||o===0)s+=o;s+='" aria-labelledby="',(o=n.id)?o=o.call(t,{hash:{}}):(o=t.id,o=typeof o===u?o.apply(t):o),s+=a(o)+'-title">\n	<div class="sf-popup-header">\n		',o=n["if"].call(t,t.titleIcon,{hash:{},inverse:f.noop,fn:f.program(5,p,i)});if(o||o===0)s+=o;s+='\n		<div id ="',(o=n.id)?o=o.call(t,{hash:{}}):(o=t.id,o=typeof o===u?o.apply(t):o),s+=a(o)+'-title" class="sf-popup-title">\n			<span class="sf-popup-title-text">',(o=n.title)?o=o.call(t,{hash:{}}):(o=t.title,o=typeof o===u?o.apply(t):o),s+=a(o)+"</span>\n			",o=n["if"].call(t,t.subtitle,{hash:{},inverse:f.noop,fn:f.program(12,g,i)});if(o||o===0)s+=o;s+="\n		</div>\n		",o=n.unless.call(t,t.disableClosePopup,{hash:{},inverse:f.noop,fn:f.program(14,y,i)});if(o||o===0)s+=o;s+="\n		",o=n["if"].call(t,t.showAdmirationIcon,{hash:{},inverse:f.noop,fn:f.program(19,E,i)});if(o||o===0)s+=o;s+='\n	</div>\n	<div class="sf-popup-content-placeholder">\n		<div class="sf-popup-content">',(o=n.content)?o=o.call(t,{hash:{}}):(o=t.content,o=typeof o===u?o.apply(t):o);if(o||o===0)s+=o;s+="</div>\n	</div>\n	",o=n["if"].call(t,t.type,{hash:{},inverse:f.noop,fn:f.programWithDepth(S,i,t)});if(o||o===0)s+=o;return s+="\n</div>\n",s});return t.registerPartial("ui_modules_popup_templates_popup",n),n}),define("hbs!ui/modules/popup/templates/popup-mask",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-popup-mask sf-mask"></div>'});return t.registerPartial("ui_modules_popup_templates_popup-mask",n),n}),define("classes/view",["classes/class","marionette","backbone","classes/extensions/context-hub","classes/extensions/context-config","utils/util"],function(e,t,n,r,i,s){var o=t.View.extend(s.extend({},r,i));return o}),define("utils/constants",["utils/util"],function(e){return e.constants={KEYLEFT:37,KEYUP:38,KEYRIGHT:39,KEYDOWN:40,ENTER:13,BACKSPACE:8,ESCAPE:27,TAB:9,SHIFT:16,CONTROL:17,OPTION:18,COMMAND:224,SPACE:32},e}),define("libs/require/css/css!ui/modules/dialog/css/dialog",[],function(){}),define("ui/modules/dialog/dialog-module",["classes/view","utils/util","utils/constants","css!ui/modules/dialog/css/dialog"],function(e,t){var n=e.extend({tabbableSelector:'input[type!="hidden"],select,textarea,button,a,[tabIndex]',events:{blur:"_onBlur",focus:"_onFocus",click:"_onClick",keydown:"_onKeydown",keypress:"_onKeypress",'blur input[type!="hidden"],select,textarea,button,a,[tabIndex]':"_onBlur",'focus input[type!="hidden"],select,textarea,button,a,[tabIndex]':"_onFocus"},_ensureElement:function(){this.$el=this.options.$el},initialize:function(){this._super.apply(this,arguments),this.cid=t.uniqueId(this.constructor.DROPDOWN_ID),this.$opener=this.options.$opener,this.focused=!1,this.opened=!1,this.timeout=null,this.modal=this.options.modal||!1,this.$el.addClass("sf-"+this.constructor.ID),this.$el.attr("tabindex",0),this.$el.attr("role","dialog"),this.$el.attr("aria-hidden",!0)},_onFocus:function(){this.focused=!0},_onBlur:function(){if(this.modal)return;this.focused=!1;var e=this;this.timeout=setTimeout(function(){e.focused||e.close()},200)},_onClick:function(){this.focused=!0,this.trigger("click")},_onKeydown:function(e){this.focused=!0;switch(e.keyCode){case t.constants.ESCAPE:e.stopPropagation(),e.preventDefault(),this.close(!0);break;case t.constants.ENTER:case t.constants.SPACE:e.stopPropagation();break;case t.constants.TAB:this.$tabbables=this.$el.find(this.tabbableSelector).not("[disabled]").not(":hidden"),this.$firstTabbable=this.$tabbables.first(),this.$lastTabbable=this.$tabbables.last(),this.delegateEvents(),e.target==this.$firstTabbable[0]?e.shiftKey&&(e.stopPropagation(),e.preventDefault(),this.$firstTabbable.trigger("blur"),this.$lastTabbable.trigger("focus")):e.target==this.$lastTabbable[0]&&(e.shiftKey||(e.stopPropagation(),e.preventDefault(),this.$lastTabbable.trigger("blur"),this.$firstTabbable.trigger("focus")))}},reinit:function(){this.$tabbables=this.$el.find(this.tabbableSelector).not("[disabled]").not(":hidden"),this.$firstTabbable=this.$tabbables.first(),this.$lastTabbable=this.$tabbables.last(),this.delegateEvents()},toggle:function(){this.opened?this.close():this.open(),this.trigger("toggle")},open:function(){this.opened||(this.$el.removeClass(this.config.classNames.closed),this.$el.addClass(this.config.classNames.opened),this.$el.attr("aria-hidden",!1),this.opened=!0,this.$el.trigger("open"),this.trigger("open"),this.$tabbables=this.$el.find(this.tabbableSelector).not("[disabled]").not(":hidden"),this.$firstTabbable=this.$tabbables.first(),this.$lastTabbable=this.$tabbables.last(),this.$firstTabbable.trigger("focus"))},close:function(e){this.opened&&(this.$el.removeClass(this.config.classNames.opened),this.$el.addClass(this.config.classNames.closed),this.$el.attr("aria-hidden",!0),this.opened=!1,this.$el.trigger("close"),this.trigger("close"),e&&this.$opener.trigger("focus"))},remove:function(e){return this.close(e),this._super()}},{ID:"dialog",defaults:{classNames:{opened:"sf-opened",closed:""}}});return n}),define("libs/jquery-resize/jquery-resize",["jQuery"],function(e){function l(){i=window[s](function(){n.each(function(){var e=t(this),n=e.width(),r=e.height(),i=t.data(this,u);(n!==i.w||r!==i.h)&&e.trigger(o,[i.w=n,i.h=r])}),l()},r[a])}var t=e;"$:nomunge";var n=t([]),r=t.elementResize=t.extend(t.elementResize,{}),i,s="setTimeout",o="elementResize",u=o+"-special-event",a="delay",f="throttleWindow";r[a]=250,r[f]=!0,t.event.special[o]={setup:function(){if(!r[f]&&this[s])return!1;var e=t(this);n=n.add(e),t.data(this,u,{w:e.width(),h:e.height()}),n.length===1&&l()},teardown:function(){if(!r[f]&&this[s])return!1;var e=t(this);n=n.not(e),e.removeData(u),n.length||clearTimeout(i)},add:function(e){function i(e,r,i){var s=t(this),o=t.data(this,u);o.w=r!==undefined?r:s.width(),o.h=i!==undefined?i:s.height(),n.apply(this,arguments)}if(!r[f]&&this[s])return!1;var n;if(t.isFunction(e))return n=e,i;n=e.handler,e.handler=i}}}),define("libs/require/css/css!ui/modules/popup/css/popup",[],function(){}),define("libs/require/css/css!ui/modules/mask/css/mask",[],function(){}),define("ui/modules/popup/popup-module",["classes/layout","hbs!ui/modules/popup/templates/popup","hbs!ui/modules/popup/templates/popup-mask","ui/modules/dialog/dialog-module","utils/util","jQuery","libs/jquery-resize/jquery-resize","utils/constants","css!ui/modules/popup/css/popup","css!ui/modules/mask/css/mask"],function(e,t,n,r,i,s){var o=e.extend({events:{"click .sf-popup-close":"_onClose","click .sf-popup-confirm":"_onConfirm","click .sf-popup-cancel":"_onCancel"},regions:{contentRegion:".sf-popup-content"},_ensureElement:function(){this.cid=i.uniqueId("sf-popup-"),this.$el=s(t({id:this.cid,modal:this.options.modal||!0,type:this.options.type,title:this.options.title,content:this.options.content,closeLabel:this.options.labelClose,cancelLabel:this.options.labelCancel,confirmLabel:this.options.labelConfirm,"class":this.options["class"]})),this.options.$content!==undefined&&this.$(".sf-popup-content").html(this.options.$content)},initialize:function(){this._super.apply(this,arguments);if(!this.options.$container||!this.options.$container.length)throw new Error("[Popup] a 'container' is required");if(!this.options.$opener||!this.options.$opener.length)throw new Error("[Popup] an 'opener' is required");this.modal=this.options.modal||!0,this.$container=this.options.$container,this.$opener=this.options.$opener,this.$mask=this.modal?s(n()):null,this.$el.appendTo(this.$container).css("visibility","hidden"),this.modal&&(this.$el.before(this.$mask),this.$mask.hide()),this.options.contentView!==undefined&&this.show(this.options.contentView),this.dialog=new r({$el:this.$el,$opener:this.$opener,modal:this.modal}),this.dialog.on("close",this._onClose,this),this.$el.on("elementResize",i.bind(this.updatePosition,this))},_onConfirm:function(e){var t=e?s(e.currentTarget).closest(".sf-dialog"):!1,n=t?t[0]===this.$el[0]:!0;n&&(i.isFunction(this.options.confirmCallback)?this.options.confirmCallback():this.close())},_onCancel:function(e){var t=e?s(e.currentTarget).closest(".sf-dialog"):!1,n=t?t[0]===this.$el[0]:!0;n&&(i.isFunction(this.options.cancelCallback)?this.options.cancelCallback():this._onClose())},_onClose:function(e){var t=e?s(e.currentTarget).closest(".sf-dialog"):!1,n=t?t[0]===this.$el[0]:!0;return n&&(i.isFunction(this.options.closeCallback)?this.options.closeCallback():this.close()),!1},updatePosition:function(){console.log("[Popup] updatePosition()...");if(this.options.adaptToParent){var e=this.$el.outerHeight();this.$container.css("minHeight",e),this.$container.css("maxHeight",e+30)}else{this.$el.css("display","block");var t=this.$el,n=this.$(".sf-popup-content-placeholder"),r=t.offsetParent();t.css("top",0),n.css("max-height","none");var i=t.outerHeight(),o=n.height(),u=r.height(),a=r.offset()?r.offset().top:0,f=s(window).height(),l=s(window).scrollTop(),c=30,h=i+2*c>u?0:c;if(i==null||o==null||u==null||f==null||l==null){t.css("top",0);return}var p=u-(i-o);if(i&&o&&u){var d=0;i>u?d=h:(d=f/2-i/2+l-a,d<0&&(d=h),d+i>u&&(d=u-i)),t.css("top",d),n.css("max-height",p-d)}}},open:function(){this.originalContainerMinHeight=this.$container.css("minHeight"),this.originalContainerMaxHeight=this.$container.css("maxHeight"),console.log("[popup] open()..."),this.updatePosition(),this.modal&&this.$mask.show(),this.$el.css("visibility","visible");if(i.isIE8()){var e=this;setTimeout(function(){e.$el.hide().show()},0)}this.dialog.open()},close:function(){console.log("[popup] close()..."),this.modal&&this.$mask.hide(),this.$el.css("visibility","hidden"),this.dialog.off("close"),this.dialog.close(!0),this.$container.css("minHeight",this.originalContainerMinHeight),this.$container.css("maxHeight",this.originalContainerMaxHeight)},remove:function(){return console.log("[popup] remove()..."),this.$mask.remove(),this.close(),this.dialog.remove(!0),this._super()},show:function(e){this.contentRegion.show(e),e.on("view:change",this.updatePosition,this),e.on("show",this.updatePosition,this)}},{ALERT:"alert",CONFIRM:"confirmation",ERROR:"error",INFO:"info",ID:"popup",defaults:{classNames:{opened:"sf-opened",closed:""}}});return o}),define("ui/modules/popup/popup-module-extension",["ui/modules/popup/popup-module","hbs!ui/modules/popup/templates/popup","utils/util","jQuery"],function(e,t,n,r){var i=e.extend({_ensureElement:function(){var e=this.options["class"]||"";this.options.showAdmirationIcon&&(e+=" sf-popup-with-admiration"),this.cid=n.uniqueId("sf-popup-");var i=!1;this.options.standAlone&&(i=this.options.standAlone),this.$el=r(t({id:this.cid,modal:this.options.modal||!0,type:this.options.type,title:this.options.title,subtitle:this.options.subtitle,titleIcon:this.options.titleIcon,titleIconBackground:this.options.titleIconBackground,iconExt:this.options.iconExt,content:this.options.content,closeLabel:this.options.labelClose,cancelLabel:this.options.labelCancel,confirmLabel:this.options.labelConfirm,disableClosePopup:this.options.disableClosePopup,showAdmirationIcon:this.options.showAdmirationIcon,"class":e,standAlone:i})),this.options.$content!==undefined&&this.$(".sf-popup-content").html(this.options.$content)},initialize:function(){this._super.apply(this,arguments),this.options.invisibleMask&&this.$mask.addClass("sf-invisible-mask")}},{});return i}),define("classes/item-view",["marionette","utils/util","classes/extensions/context-hub","classes/extensions/context-config"],function(e,t,n,r){var i=e.ItemView.extend(t.extend({},n,r));return i}),define("hbs!ui/modules/navbar/templates/navbar-menu",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t,r){var i="",s,o,a;i+="<li ",s=n["if"].call(e,e.title,{hash:{},inverse:l.noop,fn:l.program(2,h,t),data:t});if(s||s===0)i+=s;i+='class="sf-navbar-menu-option sf-navbar-option-',o=(s=t.key,typeof s===f?s.apply(e):s);if(o||o===0)i+=o;a={hash:{},inverse:l.noop,fn:l.program(4,p,t),data:t},o=(s=n.ifequal,s?s.call(e,t.key,r.selected,a):u.call(e,"ifequal",t.key,r.selected,a));if(o||o===0)i+=o;i+='">\n		<a href="#',o=(s=t.key,typeof s===f?s.apply(e):s);if(o||o===0)i+=o;i+='"></a>\n		<span class="sf-text">',o=n["if"].call(e,e.name,{hash:{},inverse:l.program(8,v,t),fn:l.program(6,d,t),data:t});if(o||o===0)i+=o;return i+="</span>\n	</li>",i}function h(e,t){var r="",i,s;return r+='title="',s={hash:{},data:t},r+=a((i=n.t,i?i.call(e,e.title,s):u.call(e,"t",e.title,s)))+'" ',r}function p(e,t){return" sf-selected"}function d(e,t){var r;return(r=n.name)?r=r.call(e,{hash:{},data:t}):(r=e.name,r=typeof r===f?r.apply(e):r),r||r===0?r:""}function v(e,t){var r,i;return i={hash:{context:"navbar.menu"},data:t},a((r=n.t,r?r.call(e,t.key,i):u.call(e,"t",t.key,i)))}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,i=i||{};var s="",o,u=n.helperMissing,a=this.escapeExpression,f="function",l=this;s+='<ul class="sf-navbar-menu">\n	',o=n.each.call(t,t.entries,{hash:{},inverse:l.noop,fn:l.programWithDepth(c,i,t),data:i});if(o||o===0)s+=o;return s+="\n</ul>\n",s});return t.registerPartial("ui_modules_navbar_templates_navbar-menu",n),n}),define("ui/modules/navbar/views/navbar-menu-view",["classes/item-view","utils/util","hbs!ui/modules/navbar/templates/navbar-menu","utils/tooltip"],function(e,t,n){var r=e.extend({template:n,tooltipSelector:".sf-navbar-menu [title]",initialize:function(){this._super.apply(this,arguments),this._currentOption=this.options.selected},onRender:function(){this._super(),this._attachTooltips()},serializeData:function(){return console.info("[Navbar] serializeData()... %o",this.options.menuItems),this.options.menuItems},onClose:function(){this._removeTooltips()},_removeTooltips:function(){if(this._$tooltips){while(this._$tooltips.length)t.tooltip.destroy(this._$tooltips),this._$tooltips=this._$tooltips.slice(1);this._$tooltips=null}},_attachTooltips:function(){this.config.tooltipEnable&&(this._$tooltips=this.$(this.tooltipSelector),t.tooltip.add(this._$tooltips,t.merge({},this.tooltipOptions,this.tooltipExtra)))}},{defaults:{tooltipEnable:!0}});return r}),define("libs/require/css/css!ui/modules/dropdown/css/dropdown",[],function(){}),define("ui/modules/dropdown/dropdown-module",["classes/view","ui/modules/dialog/dialog-module","jQuery","utils/util","utils/constants","css!ui/modules/dropdown/css/dropdown"],function(e,t,n,r){var i=e.extend({events:{click:"_onClick",keydown:"_onKeydown",keyup:"_onKeyup","close .sf-dropdown-panel":"close"},_ensureElement:function(){this.options.$el.hasClass("sf-dropdown")?this.$el=this.options.$el:this.$el=this.options.$el.find(".sf-dropdown")},initialize:function(e){this._super.apply(this,arguments),this.$container=this.options.$container,this.$label=this.$el.children(".sf-current").first(),this.$panel=this.$el.children(".sf-dropdown-panel").first(),this.opened=!1,this.focused=!1,this.timeout=null,this.maxHeight=e.maxHeight,this.dialog=new t({$el:this.$panel,$opener:this.$el}),this.updateLabel(this.$label.text())},_onClick:function(e){this.focused=!0,this.trigger("click");if(e.target===this.$panel[0]||n(e.target).closest(this.$panel).length>0)return;if(n(e.target).closest(this.$el).length===0)return;this.toggle()},_onKeydown:function(e){this.focused=!0;switch(e.keyCode){case r.constants.ENTER:case r.constants.SPACE:e.preventDefault(),e.stopPropagation()}},_onKeyup:function(e){this.focused=!0;switch(e.keyCode){case r.constants.ESCAPE:this.opened&&(e.stopPropagation(),this.close());break;case r.constants.ENTER:case r.constants.SPACE:e.stopPropagation(),this.open()}},updateLabel:function(e){e=r.stripTags(e),this.$label.html(e),this.$el.attr("aria-label",r.i18n.get("dropdown.open",{label:e})),this.$panel.attr("aria-label",e),this.updatePosition()},calcOffset:function(e,t){var n=e.offsetParent?e:e.parentNode,r={top:n.offsetTop,left:n.offsetLeft},i=n.offsetParent;while(i&&i!==t)r.top+=i.offsetTop,r.left+=i.offsetLeft,i=i.offsetParent;return r},updatePosition:function(){if(this.opened){this.$panel.addClass(this.config.classNames.opened),this._fixMaxHeight();var e=this.$label,t=this.$panel,n=this.$container,r=e.width(),i=t.width(),s=this.calcOffset(e[0],n[0]),o=s.left,u=0,a=n.outerWidth(),f=0,l=20;if(i>a){t.css({left:"auto",right:-(i-(o-u+r))+"px"});return}o<u+a/2?(o+i>u+a&&(f=a-l-i),t.css({left:-f+"px",right:"auto"})):(o-u+r<i&&(f=l+i-(o-u+r)),t.css({left:"auto",right:-f+"px"}))}},_fixMaxHeight:function(){var e=this.$container[0],t=this.$panel[0],n=this.calcOffset(t,e),r=e.clientHeight-n.top;r-=t.offsetHeight-t.clientHeight,r=Math.min(r,this.maxHeight),this.$panel.css("max-height",r+"px")},toggle:function(){this.opened?this.close():this.open(),this.trigger("toggle")},open:function(){this.opened||(this.opened=!0,this.dialog.open(),this.$el.removeClass(this.config.classNames.closed),this.$el.addClass(this.config.classNames.opened),this.updatePosition(),this.$el.trigger("open"),this.trigger("open"))},close:function(e){this.opened&&(!e||this.$panel[0]===e.target)&&(this.dialog.close(),this.$el.removeClass(this.config.classNames.opened),this.$el.addClass(this.config.classNames.closed),this.opened=!1,this.$el.trigger("close"),this.trigger("close"))},remove:function(){return this.close(),this.dialog.remove(),this._super()}},{ID:"dropdown",defaults:{classNames:{opened:"sf-opened",closed:""}}});return i}),define("hbs!ui/modules/navbar/templates/navbar-userpanel",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<ul>\n	<li><a class="sf-navbar-user-settings" href="javascript:void(0);"><span>',u={hash:{}},s+=f((o=n.t,o?o.call(t,"navbar.settings",u):a.call(t,"t","navbar.settings",u)))+'</span></a></li>\n	<li><a class="sf-navbar-user-logout" href="logout.action"><span>',u={hash:{}},s+=f((o=n.t,o?o.call(t,"navbar.logout",u):a.call(t,"t","navbar.logout",u)))+"</span></a></li>\n</ul>",s});return t.registerPartial("ui_modules_navbar_templates_navbar-userpanel",n),n}),define("hbs!ui/modules/navbar/templates/navbar-user",["hbs","Handlebars","hbs!ui/modules/navbar/templates/navbar-userpanel"],function(e,t){var n=t.template(function(e,t,n,r,i){function h(e,t){var r="",i,s,o;r+='\n		<div class="sf-navbar-user">\n			<div class="sf-navbar-user-picture">\n				<img src="',s=(i=(i=e.user,i==null||i===!1?i:i.picture),typeof i===l?i.apply(e):i);if(s||s===0)r+=s;r+='"/>\n			</div>\n			',o={hash:{"class":"sf-navbar-user-panel-trigger",title:"{{{user.name}}}"},inverse:f.noop,fn:f.program(2,p,t)},s=(i=n.dropdown,i?i.call(e,o):c.call(e,"dropdown",o));if(s||s===0)r+=s;return r+="\n		</div>\n	",r}function p(e,t){var i="",s;i+='\n				<div class="sf-navbar-user-panel">\n					',s=f.invokePartial(r["ui_modules_navbar_templates_navbar-userpanel"],"ui_modules_navbar_templates_navbar-userpanel",e,n,r);if(s||s===0)i+=s;return i+="\n				</div>\n			",i}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,r=r||e.partials;var s="",o,u,a,f=this,l="function",c=n.helperMissing;s+="<div>\n	",a={hash:{},inverse:f.noop,fn:f.program(1,h,i)},u=(o=n.ifnequal,o?o.call(t,t.showUserSection,!1,a):c.call(t,"ifnequal",t.showUserSection,!1,a));if(u||u===0)s+=u;return s+="\n</div>",s});return t.registerPartial("ui_modules_navbar_templates_navbar-user",n),n}),define("ui/modules/navbar/views/navbar-user-view",["classes/item-view","ui/modules/dropdown/dropdown-module","hbs!ui/modules/navbar/templates/navbar-user"],function(e,t,n){var r=e.extend({template:n,ui:{$userDropdown:".sf-dropdown"},events:{"click .sf-navbar-user-picture":"_openUserPanel"},triggers:{"click .sf-navbar-user-settings":"show:settings"},onRender:function(){this._super(),this.dropdown=new t({$el:this.ui.$userDropdown,$container:this.options.$popupContainer})},serializeData:function(){return this.options.menuItems},_openUserPanel:function(){this.dropdown.toggle()}});return r}),define("hbs!ui/modules/navbar/templates/navbar",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function h(e,t){var r="",i;r+='\n		<div class="sf-navbar-brand">',(i=n.title)?i=i.call(e,{hash:{}}):(i=e.title,i=typeof i===f?i.apply(e):i);if(i||i===0)r+=i;return r+="</div>\n	",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f="function",l=this,c=n.helperMissing;s+='<div class="sf-navbar">\n	<div class="sf-navbar-user-placeholder"></div>\n	',a={hash:{},inverse:l.noop,fn:l.program(1,h,i)},u=(o=n.ifnequal,o?o.call(t,t.showBrandSection,!1,a):c.call(t,"ifnequal",t.showBrandSection,!1,a));if(u||u===0)s+=u;return s+='\n	<div class="sf-navbar-menu-placeholder"></div>\n</div>',s});return t.registerPartial("ui_modules_navbar_templates_navbar",n),n}),define("libs/require/css/css!ui/modules/navbar/css/navbar",[],function(){}),define("ui/modules/navbar/navbar-module",["classes/layout","ui/modules/popup/popup-module","ui/modules/navbar/views/navbar-menu-view","ui/modules/navbar/views/navbar-user-view","utils/util","hbs!ui/modules/navbar/templates/navbar","css!ui/modules/navbar/css/navbar"],function(e,t,n,r,i,s){var o=e.extend({template:s,regions:{menuRegion:".sf-navbar-menu-placeholder",userRegion:".sf-navbar-user-placeholder"},initialize:function(){this._super.apply(this,arguments),this.showUserSection=this.options.showUserSection||this.config.showUserSection},onShow:function(){var e=new n(i.extend({menuItems:this.options},this.contextConfig));this.menuRegion.show(e);if(this.showUserSection){var t=new r(i.extend({menuItems:this.options},this.contextConfig));this.userRegion.show(t),this.listenTo(t,"show:settings",this._openSettings)}},setCurrent:function(e){this._currentOption!==e&&(this.$el.find("li.sf-selected").removeClass("sf-selected"),this.$el.find("li.sf-navbar-option-"+e).addClass("sf-selected"),this._currentOption=e)},_openSettings:function(){}},{ID:"navbar",defaults:{showUserSection:!0}});return o}),define("data/profile/profile-model",["classes/model","utils/util","utils/config"],function(e,t){var n=e.extend({save:function(e,n){var r=t.apiURL("/community/filters/profile/update.action"),i=e||this.attributes,s=t.extend({data:t.param(i),url:r,type:"POST",wait:!0},n);return this._super(e,s)},changeLanguage:function(e){return t.ajax({url:t.apiURL("/user/settings/update.action"),type:"POST",data:t.param(e)})}});return n}),define("classes/collection",["backbone"],function(e){var t=e.Collection.extend({});return t}),define("data/profile/profile-collection",["classes/collection","data/profile/profile-model"],function(e,t){var n=e.extend({model:t,url:"/community/filters/get.action",parse:function(e){return e.userTags}});return n}),define("data/profile/profile-data-manager",["classes/data-manager","data/profile/profile-model","data/profile/profile-collection","utils/util","classes/remote-error"],function(e,t,n,r,i){var s=e.extend({initialize:function(){this._super.apply(this,arguments),this.collectionDefs={profile:{type:n,modelUpdated:this._profileUpdated}}},get:function(e){return this.getCollection("profile",{force:e})},update:function(e){var n=this._collections.profile,s=new t,o=this,u=new r.Deferred;return r.when(s.save(e)).done(function(){n.trigger("change"),r.when(o.get(!0)).done(function(e){u.resolve(e)}).fail(function(e){u.fail(n),u.reject(new i(e))})}).fail(function(e){u.fail(n),u.reject(new i(e))}),u},changeLanguage:function(e){var n=new t,s=new r.Deferred;return r.when(n.changeLanguage(e)).done(function(e){s.resolve(e)}).fail(function(e){s.fail(e),s.reject(new i(e))}),s},_profileUpdated:function(e){this.publish("profile:update",e)}});return s}),define("services/profile-service",["classes/service","data/profile/profile-data-manager"],function(e,t){var n=e.extend({initialize:function(){this._super.apply(this,arguments),this.profileDM=t.getInstance()},get:function(e){return this.profileDM.get(e)},update:function(e){return this.profileDM.update(e)},changeLanguage:function(e){return this.profileDM.changeLanguage(e)}},{ID:"profile-service",defaults:{}});return n}),define("classes/reform",["jQuery"],function(e){var t={excludeClass:"sf-no-reform",enable:{Checkbox:!0,Datepicker:!0,TimerangeSlider:!0,CategorySelect:!0,MultilevelSelect:!0,Select:!0,Radio:!0},init:function(e){for(var n in this.enable)this.enable.hasOwnProperty(n)&&this.enable[n]&&t[n]&&this.initPlugin(e,t[n])},isExcluded:function(e){return e.hasClass(this.excludeClass)},initPlugin:function(t,n){var r=n.SELECTOR,i=t!=null&&t.length>0?t.find(r):e(r);for(var s=0;s<i.length;s++){if(this.isExcluded(i.eq(s)))continue;i.eq(s).data("ReForm")||new n({$el:i.eq(s)})}}};return t}),define("classes/reform-plugin",["classes/view","classes/reform","jQuery","utils/util"],function(e,t,n,r){var i=e.extend({constructor:function(t){this.options=t,e.prototype.constructor.apply(this,arguments)},_ensureElement:function(){this.$el=this.options.$el,this.$original=this.$el.find(this.constructor.ORIGINAL_SELECTOR),this.$originallabel=this.getLabel(this.$original),this.cid=r.uniqueId(this.constructor.ID+"-"),this.$el.attr("id",this.cid),this.$original.addClass("sf-original"),this.$original.data(this.constructor.REFORM_ID,this),this.$el.data("ReForm",!0),this.$originallabel.attr("id")?this.$el.attr("aria-labelledby",this.$originallabel.attr("id")):this.$original.attr("aria-labelledby")!==undefined?this.$el.attr("aria-labelledby",this.$original.attr("aria-labelledby")):this.$original.attr("aria-label")!==undefined?this.$el.attr("aria-label",this.$original.attr("aria-label")):this.$el.attr("aria-label",this.getLabelText(this.$originallabel))},getLabel:function(e){var t;e.attr("id")&&(t=n("label[for='"+e.attr("id")+"']"));if(!t||t.length===0)t=e.parent("label");return t},getLabelText:function(e){var t,n="";return e&&e.length>0&&(t=e.eq(0).contents().filter(function(){return this.nodeType==3}),n=t.text()),n}},{REFORM_ID:"",SELECTOR:"",ORIGINAL_SELECTOR:"",defaults:{classNames:{disabled:"sf-disabled"}}});return i}),define("hbs!ui/modules/reform/select/templates/select-option",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression;return s+='<div class="sf-option">',(o=n.label)?o=o.call(t,{hash:{}}):(o=t.label,o=typeof o===u?o.apply(t):o),s+=a(o)+"</div>",s});return t.registerPartial("ui_modules_reform_select_templates_select-option",n),n}),define("hbs!ui/modules/reform/select/templates/select-optiongroup",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-optiongroup"></div>'});return t.registerPartial("ui_modules_reform_select_templates_select-optiongroup",n),n}),define("hbs!ui/modules/reform/select/templates/select-optiongroup-label",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression;return s+='<span class="sf-optiongroup-label">',(o=n.label)?o=o.call(t,{hash:{}}):(o=t.label,o=typeof o===u?o.apply(t):o),s+=a(o)+"</span>",s});return t.registerPartial("ui_modules_reform_select_templates_select-optiongroup-label",n),n}),define("libs/require/css/css!ui/modules/reform/select/css/select",[],function(){}),define("ui/modules/reform/select/select-module",["classes/reform-plugin","classes/reform","jQuery","utils/util","hbs!ui/modules/reform/select/templates/select-option","hbs!ui/modules/reform/select/templates/select-optiongroup","hbs!ui/modules/reform/select/templates/select-optiongroup-label","utils/constants","css!ui/modules/reform/select/css/select","css!ui/modules/dropdown/css/dropdown"],function(e,t,n,r,i,s,o){return t.Select=e.extend({optionTmpl:i,groupTmpl:s,groupLabelTmpl:o,events:{blur:"_onBlur",focus:"_onFocus",click:"_onClick",mousedown:"_onMousedown",mouseup:"_onMouseup",keyup:"_onKeyup",keydown:"_onKeydown",keypress:"_onKeypress","change .sf-original":"_onOriginalChange"},initialize:function(){this._super.apply(this,arguments),this.$originaloptions=this.$original.find("option"),this.$originaloptiongroups=this.$original.find("optgroup"),this.$current=this.$el.find("span.sf-current"),this.$button=this.$el.find("span.sf-button-select"),this.$optionlist=this.$el.find("div.sf-optionlist"),this.options=[],this.optiongroups=[],this.$optionlist.prop("id",this.cid+"-list"),this.initialized=!1,this.opened=!1,this.timeout=null,this.focused=!1,this.disabled=!1,this.clickDisabled=!1,this.mousedown=!1,this.searchString="",this.searchTimer=(new Date).getTime(),this.searchTimeout=500,this.currentIndex=0,this.currentValue=null,this.currentText="",this.markedIndex=0,this._reflect()},_reflect:function(){this.$original.prop("disabled")?(this.disabled=!0,this.$el.addClass(this.config.classNames.disabled),this.$el.prop("aria-disabled","true")):(this.disabled=!1,this.$el.removeClass(this.config.classNames.disabled),this.$el.removeAttr("aria-disabled"));var e=this.$originaloptions.filter(":selected");this.currentValue=e.val(),this.currentText=e.text(),this.$current.text(this.currentText),this.$el.prop("aria-label",this.currentText)},_initialize:function(){this._parseOptions(),this.initialized=!0,this.update(),this.$el.trigger("init"),this.trigger("init")},_onOriginalChange:function(){this.update(),this.trigger("change")},_onBlur:function(e){this.focused=!1;if(!this.opened)return;var t=this;this.timeout=setTimeout(function(){!t.focused&&!t.mousedown?(t.trigger("blur"),e&&e.originalEvent&&t.close()):t.mousedown=!1},this.config.blurDelay)},_onFocus:function(e){e.target==this.$el[0]&&(this.focused=!0,this.$original.trigger("focus"),this.trigger("focus"))},_onMousedown:function(e){this.mousedown=!0,e.target!=this.$original[0]&&this.$original.trigger("mousedown")},_onMouseup:function(e){this.mousedown=!1,e.target!=this.$original[0]&&this.$original.trigger("mouseup")},_onClick:function(e){e.stopPropagation(),this.$el.focus(),this.focused=!0;if(this.disabled||this.clickDisabled){e.preventDefault();return}var t=this;clearTimeout(this.clickTimeout),t.clickDisabled=!0,this.clickTimeout=setTimeout(function(){t.clickDisabled=!1},300),this.$original.triggerHandler("click"),this.trigger("click"),this.toggle()},_onKeydown:function(e){this.focused=!0;if(e.keyCode!==undefined)switch(e.keyCode){case r.constants.KEYLEFT:e.preventDefault(),e.stopPropagation(),this.prevOption();break;case r.constants.KEYUP:e.preventDefault(),e.stopPropagation(),this.prevOption();break;case r.constants.KEYRIGHT:e.preventDefault(),e.stopPropagation(),this.nextOption();break;case r.constants.KEYDOWN:e.preventDefault(),e.stopPropagation(),this.nextOption();break;case r.constants.ESCAPE:this.opened&&(e.preventDefault(),e.stopPropagation(),this.options[this.markedIndex].blur(),this.$el.focus(),this.close());break;case r.constants.ENTER:case r.constants.SPACE:e.preventDefault(),e.stopPropagation(),this.opened?(this.selectOption(this.markedIndex),this.options[this.markedIndex].blur(),this.$el.focus(),this.close()):this.open();break;case r.constants.SHIFT:case r.constants.TAB:break;default:this.initialized||this._initialize(),(new Date).getTime()-this.searchTimer<this.searchTimeout?this.searchString+=String.fromCharCode(e.keyCode):this.searchString=String.fromCharCode(e.keyCode),this.searchTimer=(new Date).getTime();var t=this.searchOptionByText(this.searchString);t!==undefined&&!t.data("disabled")&&(this.opened?this.markOption(t.data("index")):this.selectOption(t.data("index")))}e.target==this.$el[0]&&this.$original.trigger("keydown")},_onKeyup:function(e){e.target==this.$el[0]&&this.$original.trigger("keyup")},_onKeypress:function(e){e.target==this.$el[0]&&this.$original.trigger("keypress")},_parseOptions:function(){var e=this.$original.children("option, optgroup");for(var t=0;t<e.length;t++){var n=e.eq(t);if(n.is("optgroup")){var r=this._createOptionGroup(n).appendTo(this.$optionlist),i=n.children("option");for(var s=0;s<i.length;s++)n=i.eq(s),this._createOption(n,r).appendTo(r)}else this._createOption(n).appendTo(this.$optionlist)}},_createOptionGroup:function(e){var t=n(this.groupTmpl()),r=n(this.groupLabelTmpl({label:e.prop("label")})).appendTo(t);return t.addClass(e.prop("class")),t.click(function(e){if(e.target==t[0]||e.target==r[0])e.preventDefault(),e.stopPropagation();return}),this.optiongroups.push(t),t},_createOption:function(e,t,r,i){if(!r||r.length===0)r=this.$optionlist;!i&&i!==0&&(i=this.options.length);var s=this._renderOption(e);s.data({index:i,value:e.val(),text:e.text(),visible:!0,group:t,list:r}),s.prop("role","option"),s.prop("id",this.cid+"-option-"+i),s.prop("tabindex","-1"),s.addClass(e.prop("class")),i===0&&s.addClass(this.config.classNames.first),i==this.$originaloptions.length-1&&s.addClass(this.config.classNames.last);var o=this;return s.focus(function(){o.focused=!0}),s.blur(function(e){o._onBlur(e)}),s.click(function(e){if(n(this).data("disabled")){e.preventDefault(),e.stopPropagation();return}o.selectOption(n(this).data("index"))}),this.options[i]=s,s},_renderOption:function(e){return n(this.optionTmpl({label:e.text()}))},_renderOptionList:function(){var e=this.$el.offset().top,t=this.$el.height(),r=(this.$el.outerHeight()-t)/2;this.$el.css("overflow","hidden"),this.$optionlist.css({visibility:"hidden",display:"block",height:"","max-height":""});var i=this.$optionlist.height(),s=this.$optionlist.width(),o=(this.$optionlist.outerHeight()-i)/2,u=t+r,a="hidden",f=this.$optionlist.find(".sf-option").length,l=f>0?i/f:0;this.$el.css("overflow",""),this.$optionlist.css({visibility:"",display:""});var c=n(window),h=0,p=c.height(),d=c.scrollTop(),v=this.$el.parent();while(v.css("overflow")!="hidden"&&v.css("overflow")!="scroll"&&v.css("overflow")!="auto"&&v.css("overflow-y")!="hidden"&&v.css("overflow-y")!="scroll"&&v.css("overflow-y")!="auto"&&v.get(0)&&v.get(0).nodeName.toLowerCase()!="body")v=v.parent();if(!v.get(0))return;v.get(0).nodeName.toLowerCase()!="body"&&(c=v,p=v.innerHeight(),h=v.offset().top,d=0);var m=e-h-d+t+r,g=this.config.optionListSpacing,y=this.config.classNames.flipped,b=this.config.classNames.scroll,w=0;m-t-r-g>=i+o*2?(u=-i-r-o*2,this.$el.addClass(y)):m>p-m?(i=m-t-r-o*2-g,w=l>0?Math.floor(i/l):1,i=w*l,s+=15,u=-i-r-o*2,a="scroll",this.$el.addClass(y),this.$el.addClass(b)):p-m-g<i+o*2&&(i=p-m-o*2-g,w=l>0?Math.floor(i/l):1,i=w*l,s+=15,a="scroll",this.$el.addClass(b)),this.$optionlist.css({height:i+"px",width:s+"px",top:u+"px",overflow:a,"overflow-x":"hidden",visibility:"visible",display:"block"})},_scrollToOption:function(e){if(!e||!e.data("list"))return;var t=e.data("list"),n=Math.round(t.height()),r=Math.round(t.scrollTop()),i=Math.round(e.position().top),s=Math.round(e.outerHeight());i+s>n?t.scrollTop(r+(i+s-n)):i<0&&t.scrollTop(r+i)},getOptionByValue:function(e){for(var t=0;t<this.options.length;t++)if(this.options[t].data("value")==e)return this.options[t];return undefined},getOptionByText:function(e){for(var t=0;t<this.options.length;t++)if(this.options[t].data("text")==e)return this.options[t];return undefined},searchOptionByText:function(e){for(var t=0;t<this.options.length;t++)if(this.options[t].data("text").toLowerCase().indexOf(e.toLowerCase())===0)return this.options[t];return undefined},reinit:function(){if(!this.initialized){this.$originaloptions=this.$original.find("option"),this.$originaloptiongroups=this.$original.find("optgroup"),this._reflect();return}var e=this.currentValue,t=this.opened;this.close(!0),this.$originaloptions=this.$original.find("option"),this.$originaloptiongroups=this.$original.find("optgroup"),this.$optionlist.empty(),this.currentIndex=0,this.markedIndex=0,this.options=[],this.optiongroups=[],this._parseOptions(),this.update();try{this.selectOption(this.getOptionByValue(e).data("index"))}catch(n){}t&&this.open(),this.$original.data(this.constructor.REFORM_ID,this)},update:function(){if(!this.initialized){this._reflect();return}var e=this.config.classNames.disabled,t=this.config.classNames.selected,n;this.$original.prop("disabled")?(this.disabled=!0,this.$el.addClass(e),this.$el.prop("aria-disabled","true")):(this.disabled=!1,this.$el.removeClass(e),this.$el.removeAttr("aria-disabled"));for(var r=0;r<this.$originaloptiongroups.length;r++)n=this.optiongroups[r],this.$originaloptiongroups.eq(r).prop("disabled")?(n.data("disabled",!0),n.addClass(e),n.prop("aria-disabled",!0)):(n.data("disabled",!1),n.removeClass(e),n.removeAttr("aria-disabled"));for(r=0;r<this.$originaloptions.length;r++){var i=this.options[r];this.$originaloptions.eq(r).prop("selected")?(this.currentIndex=i.data("index"),this.currentValue=i.data("value"),this.currentText=i.data("text"),i.prop("aria-selected","true"),i.addClass(t),this.$el.prop("aria-activedescendant",i.prop("id")),this.$current.text(this.currentText),this.$el.prop("aria-label",this.currentText)):(i.removeAttr("aria-selected"),i.removeClass(t)),n=i.data("group"),this.$originaloptions.eq(r).prop("disabled")||n&&n.data("disabled")?(i.data("disabled",!0),i.addClass(e),i.prop("aria-disabled",!0)):(i.data("disabled",!1),i.removeClass(e),i.removeAttr("aria-disabled"))}},selectOption:function(e){if(this.disabled||e<0||e>=this.options.length||e==this.currentIndex||this.options[e].data("disabled"))return;this.$originaloptions.prop("selected",!1),this.$originaloptions.eq(e).prop("selected",!0),this.$original.val(this.$originaloptions.eq(e).val()),this.$original.trigger("change")},markOption:function(e){this.unmarkOption(this.markedIndex),this.markedIndex=e,this.options[this.markedIndex].focus(),this.options[this.markedIndex].addClass(this.config.classNames.selected)},unmarkOption:function(e){this.options[e].removeClass(this.config.classNames.selected)},nextOption:function(){if(this.disabled)return;this.initialized||this._initialize();var e=this.opened?this.markedIndex+1:this.currentIndex+1;while(e<this.options.length&&this.options[e].data("disabled"))e++;e<this.options.length&&(this.opened?this.markOption(e):this.selectOption(e))},prevOption:function(){if(this.disabled)return;this.initialized||this._initialize();var e=this.opened?this.markedIndex-1:this.currentIndex-1;while(e>=0&&this.options[e].data("disabled"))e--;e>=0&&(this.opened?this.markOption(e):this.selectOption(e))},toggle:function(){if(this.disabled)return;this.opened?this.close():this.open(),this.$el.trigger("toggle"),this.trigger("toggle")},open:function(){if(this.disabled||this.opened)return;this.initialized||this._initialize(),this._renderOptionList(),this.opened=!0,this.$el.removeClass(this.config.classNames.closed),this.$el.addClass(this.config.classNames.opened),this.$optionlist.removeClass(this.config.classNames.closed),this.$optionlist.addClass(this.config.classNames.opened),this.$optionlist.prop("aria-expanded","true"),this.markOption(this.currentIndex),this.$el.trigger("open"),this.trigger("open")},close:function(e){if(!this.opened)return;this.$optionlist.css({height:"",width:"",top:"",overflow:"","overflow-x":"",visibility:"",display:""}),this.$el.addClass(this.config.classNames.closed),this.$el.removeClass(this.config.classNames.opened),this.$el.removeClass(this.config.classNames.flipped),this.$el.removeClass(this.config.classNames.scroll),this.$optionlist.removeClass(this.config.classNames.opened),this.$optionlist.addClass(this.config.classNames.closed),this.opened=!1,this.$optionlist.prop("aria-expanded","false"),e||(this.$el.trigger("close"),this.trigger("close"))}},{ID:"sf-reform-select",REFORM_ID:"ReForm.Select",SELECTOR:"div.sf-reform-select",ORIGINAL_SELECTOR:"select",defaults:{classNames:{opened:"sf-opened",closed:"",selected:"sf-selected",flipped:"sf-flipped",scroll:"sf-scroll",first:"sf-first",last:"sf-last"},optionListSpacing:10,blurDelay:200}}),t}),define("libs/handlebars/helpers-nested/helpers.nested",["Handlebars","underscore"],function(e,t){return e.oldRegisterHelper=e.registerHelper,e.registerHelper=function(n,r,i){var s,o=function(){return s=this,t.each(arguments,function(n){t.isObject(n)&&n.hash?t.each(n.hash,function(t,r){n.hash[r]=e.resolveNested.apply(s,[t])}):n=e.resolveNested.apply(s,[n])}),r.apply(this,arguments)};e.oldRegisterHelper(n,o,i)},e.resolveNested=function(n){return t.isString(n)&&n.indexOf("{{{")>=0?n=new e.SafeString(e.compile(n)(this)):t.isString(n)&&n.indexOf("{{")>=0&&(n=e.compile(n)(this)),n},e}),define("utils/helpers/flux-control/ifequal-helper",["Handlebars","utils/util"],function(e,t){e.registerHelper("ifequal",function(e,n,r){if(t.isEqual(e,n))return r.fn(this);if(r.inverse)return r.inverse(this)})}),define("utils/helpers/flux-control/ifnequal-helper",["Handlebars","utils/util"],function(e,t){e.registerHelper("ifnequal",function(e,n,r){if(!t.isEqual(e,n))return r.fn(this);if(r.inverse)return r.inverse(this)})}),define("utils/helpers/flux-control/ifdef-helper",["Handlebars"],function(e){e.registerHelper("ifdef",function(e,t){if(e!==undefined)return t.fn(this);if(t.inverse)return t.inverse(this)})}),define("utils/helpers/flux-control/log-helper",["Handlebars"],function(e){e.registerHelper("log",function(e,t){var n="[Handlebars Log "+(t?t:"")+"] %o";return console.info(n,e),""})}),define("utils/helpers/flux-control/iter-helper",["Handlebars","utils/util"],function(e,t){e.registerHelper("iter",function(e,n){var r=n.fn,i=n.inverse,s="";if(e&&e.length>0)for(var o=0,u=e.length;o<u;o++)s+=r(t.extend({},e[o],{i:o,iPlus1:o+1,self:e[o]}));else s=i(this);return s})}),define("utils/helpers/flux-control/at-least-helper",["Handlebars","utils/util"],function(e,t){e.registerHelper("atLeast",function(e,n){var r=n.fn,i="",s;if(e){if(e.length>0)for(var o=0,u=e.length;o<u;o++)i+=r(t.extend({},e[o],{i:o,iPlus1:o+1,self:e[o],parent:this}))}else s={i:0,iPlus1:1,parent:this,isDefault:!0},i=r(s);return i})}),define("utils/helpers/flux-control/ifnull-helper",["Handlebars"],function(e){e.registerHelper("ifnull",function(e,t){if(e===null)return t.fn(this);if(t.inverse)return t.inverse(this)})}),define("hbs!utils/helpers/ui/textfield/templates/textfield",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){var r;return(r=n.extraFormClass)?r=r.call(e,{hash:{}}):(r=e.extraFormClass,r=typeof r===u?r.apply(e):r),r||r===0?r:""}function h(e,t){var r="",i;r+='<span class="',i=n["if"].call(e,e.prefix,{hash:{},inverse:a.noop,fn:a.program(4,p,t)});if(i||i===0)r+=i;i=n["if"].call(e,e.suffix,{hash:{},inverse:a.noop,fn:a.program(6,d,t)});if(i||i===0)r+=i;return r+='">',r}function p(e,t){return"sf-textfield-prepend"}function d(e,t){return" sf-textfield-append"}function v(e,t){var r="",i;r+='<span class="sf-add-on">',(i=n.prefix)?i=i.call(e,{hash:{}}):(i=e.prefix,i=typeof i===u?i.apply(e):i);if(i||i===0)r+=i;return r+="</span>",r}function m(e,t){var r="",i;return r+=" ",(i=n["class"])?i=i.call(e,{hash:{}}):(i=e["class"],i=typeof i===u?i.apply(e):i),r+=f(i),r}function g(e,t){var r="",i;return r+=' id="',(i=n.id)?i=i.call(e,{hash:{}}):(i=e.id,i=typeof i===u?i.apply(e):i),r+=f(i)+'"',r}function y(e,t){var r="",i;return r+=' name="',(i=n.name)?i=i.call(e,{hash:{}}):(i=e.name,i=typeof i===u?i.apply(e):i),r+=f(i)+'"',r}function b(e,t){return' disabled="disabled"'}function w(e,t){var r="",i;return r+=' value="',(i=n.value)?i=i.call(e,{hash:{}}):(i=e.value,i=typeof i===u?i.apply(e):i),r+=f(i)+'"',r}function E(e,t){var r="",i;return r+=' size="',(i=n.size)?i=i.call(e,{hash:{}}):(i=e.size,i=typeof i===u?i.apply(e):i),r+=f(i)+'"',r}function S(e,t){var r="",i;return r+=' maxlength="',(i=n.maxlength)?i=i.call(e,{hash:{}}):(i=e.maxlength,i=typeof i===u?i.apply(e):i),r+=f(i)+'"',r}function x(e,t){return' readonly="readonly"'}function T(e,t){return' aria-required="true"'}function N(e,t){var r="",i;return r+=' aria-live="',(i=n.ariaLive)?i=i.call(e,{hash:{}}):(i=e.ariaLive,i=typeof i===u?i.apply(e):i),r+=f(i)+'"',r}function C(e,t){var r="",i;return r+=' aria-label="',(i=n.ariaLabel)?i=i.call(e,{hash:{}}):(i=e.ariaLabel,i=typeof i===u?i.apply(e):i),r+=f(i)+'"',r}function k(e,t){var r="",i;return r+=' labelledby="',(i=n.labelledby)?i=i.call(e,{hash:{}}):(i=e.labelledby,i=typeof i===u?i.apply(e):i),r+=f(i)+'"',r}function L(e,t){var r;return(r=n.tabindex)?r=r.call(e,{hash:{}}):(r=e.tabindex,r=typeof r===u?r.apply(e):r),f(r)}function A(e,t){return"0"}function O(e,t){var r="",i,s;return r+=" ",s={hash:{}},r+=f((i=n.validator,i?i.call(e,e.validateField,s):l.call(e,"validator",e.validateField,s))),r}function M(e,t){var r="",i;return r+=' placeholder="',(i=n.placeholder)?i=i.call(e,{hash:{}}):(i=e.placeholder,i=typeof i===u?i.apply(e):i),r+=f(i)+'"',r}function _(e,t){var r="",i;r+=" ",(i=n.name)?i=i.call(e,{hash:{}}):(i=e.name,i=typeof i===u?i.apply(e):i),r+=f(i)+'="',(i=n.value)?i=i.call(e,{hash:{}}):(i=e.value,i=typeof i===u?i.apply(e):i);if(i||i===0)r+=i;return r+='"',r}function D(e,t){var r="",i;r+='<span class="sf-add-on">',(i=n.suffix)?i=i.call(e,{hash:{}}):(i=e.suffix,i=typeof i===u?i.apply(e):i);if(i||i===0)r+=i;return r+="</span>",r}function P(e,t){return"</span>"}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this,f=this.escapeExpression,l=n.helperMissing;s+='<span class="sf-form-field ',o=n["if"].call(t,t.extraFormClass,{hash:{},inverse:a.noop,fn:a.program(1,c,i)});if(o||o===0)s+=o;s+='">\n',o=n["if"].call(t,t.affix,{hash:{},inverse:a.noop,fn:a.program(3,h,i)});if(o||o===0)s+=o;s+="\n	",o=n["if"].call(t,t.prefix,{hash:{},inverse:a.noop,fn:a.program(8,v,i)});if(o||o===0)s+=o;s+='\n	<input type="text" class="sf-textfield',o=n["if"].call(t,t["class"],{hash:{},inverse:a.noop,fn:a.program(10,m,i)});if(o||o===0)s+=o;s+='"\n	',o=n["if"].call(t,t.id,{hash:{},inverse:a.noop,fn:a.program(12,g,i)});if(o||o===0)s+=o;s+="\n	",o=n["if"].call(t,t.name,{hash:{},inverse:a.noop,fn:a.program(14,y,i)});if(o||o===0)s+=o;s+="\n	",o=n["if"].call(t,t.disabled,{hash:{},inverse:a.noop,fn:a.program(16,b,i)});if(o||o===0)s+=o;s+="\n	",o=n["if"].call(t,t.value,{hash:{},inverse:a.noop,fn:a.program(18,w,i)});if(o||o===0)s+=o;s+="\n	",o=n["if"].call(t,t.size,{hash:{},inverse:a.noop,fn:a.program(20,E,i)});if(o||o===0)s+=o;s+="\n	",o=n["if"].call(t,t.maxlength,{hash:{},inverse:a.noop,fn:a.program(22,S,i)});if(o||o===0)s+=o;s+="\n	",o=n["if"].call(t,t.readonly,{hash:{},inverse:a.noop,fn:a.program(24,x,i)});if(o||o===0)s+=o;s+="\n	",o=n["if"].call(t,t.disabled,{hash:{},inverse:a.noop,fn:a.program(16,b,i)});if(o||o===0)s+=o;s+="\n	",o=n["if"].call(t,t.ariaRequired,{hash:{},inverse:a.noop,fn:a.program(26,T,i)});if(o||o===0)s+=o;s+="\n	",o=n["if"].call(t,t.ariaLive,{hash:{},inverse:a.noop,fn:a.program(28,N,i)});if(o||o===0)s+=o;s+="\n	",o=n["if"].call(t,t.ariaLabel,{hash:{},inverse:a.noop,fn:a.program(30,C,i)});if(o||o===0)s+=o;s+="\n	",o=n["if"].call(t,t.labelledby,{hash:{},inverse:a.noop,fn:a.program(32,k,i)});if(o||o===0)s+=o;s+='\n	 tabindex="',o=n["if"].call(t,t.tabindex,{hash:{},inverse:a.program(36,A,i),fn:a.program(34,L,i)});if(o||o===0)s+=o;s+='"\n	',o=n["if"].call(t,t.validateField,{hash:{},inverse:a.noop,fn:a.program(38,O,i)});if(o||o===0)s+=o;s+="\n	",o=n["if"].call(t,t.placeholder,{hash:{},inverse:a.noop,fn:a.program(40,M,i)});if(o||o===0)s+=o;s+="\n	",o=n.each.call(t,t.data,{hash:{},inverse:a.noop,fn:a.program(42,_,i)});if(o||o===0)s+=o;s+="/>\n	",o=n["if"].call(t,t.suffix,{hash:{},inverse:a.noop,fn:a.program(44,D,i)});if(o||o===0)s+=o;s+="\n",o=n["if"].call(t,t.affix,{hash:{},inverse:a.noop,fn:a.program(46,P,i)});if(o||o===0)s+=o;return s+="\n</span>",s});return t.registerPartial("utils_helpers_ui_textfield_templates_textfield",n),n}),define("utils/helpers/ui/datepicker-helper",["Handlebars","hbs!utils/helpers/ui/textfield/templates/textfield","utils/util","utils/amount"],function(e,t,n){e.registerHelper("datepicker",function(r){var i=n.extend({},r.hash),s=n.handlebarsGoodies.transformDataAttr(i),o,u=r.hash["class"]||"";u=u.split(" "),n.contains(u)||u.push("sf-datepicker"),u=u.join(" "),s["class"]=u,s.extraFormClass="sf-form-datepicker";if(r.hash.prefix||r.hash.suffix)s.affix=!0;return o=t(s),new e.SafeString(o)})}),define("hbs!ui/modules/dropdown/templates/dropdown",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i;return r+=' id="',(i=n.id)?i=i.call(e,{hash:{}}):(i=e.id,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function c(e,t){var r="",i;return r+=" ",(i=n["class"])?i=i.call(e,{hash:{}}):(i=e["class"],i=typeof i===u?i.apply(e):i),r+=a(i),r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=this;s+="<div",o=n["if"].call(t,t.id,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;s+=' class="sf-dropdown',o=n["if"].call(t,t["class"],{hash:{},inverse:f.noop,fn:f.program(3,c,i)});if(o||o===0)s+=o;s+='" role="application" aria-haspopup=true tabindex="0">\n	<span class="sf-current">',(o=n.title)?o=o.call(t,{hash:{}}):(o=t.title,o=typeof o===u?o.apply(t):o),s+=a(o)+'</span>\n	<span class="sf-button-opener"><span class="sf-button-opener-icon sf-icon"></span></span>\n    <div class="sf-dropdown-panel">\n    	<div class="sf-dropdown-content">\n       		',(o=n.dropdownContent)?o=o.call(t,{hash:{}}):(o=t.dropdownContent,o=typeof o===u?o.apply(t):o);if(o||o===0)s+=o;return s+="\n       	</div>\n    </div>\n</div>",s});return t.registerPartial("ui_modules_dropdown_templates_dropdown",n),n}),define("utils/handlebars-goodies",["utils/util"],function(e){return e.handlebarsGoodies={transformDataAttr:function(t){var n=t,r=[];return e.each(t,function(t,n){n.indexOf("data")===0&&r.push({name:e.hyphenate(n),value:t})}),e.size(r)>0&&(n.data=r),n},toString:function(t){return e.isString(t)?t:e.isArray(t)?(t=e.map(t,function(t){return e.isString(t)?'"'+t+'"':e.handlebarsGoodies.toString(t)}),"["+t+"]"):t.toString()}},e}),define("utils/helpers/ui/dropdown-helper",["Handlebars","hbs!ui/modules/dropdown/templates/dropdown","utils/util","utils/handlebars-goodies"],function(e,t,n){e.registerHelper("dropdown",function(r){var i=r.fn(this),s=n.extend({},r.hash,{dropdownContent:i}),o=n.handlebarsGoodies.transformDataAttr(s),u=t(o);return new e.SafeString(u)})}),define("hbs!ui/modules/pagination/templates/pagination-bar",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i;return r+=" ",(i=n.classes)?i=i.call(e,{hash:{}}):(i=e.classes,i=typeof i===f?i.apply(e):i),r+=l(i),r}function d(e,t){return" sf-pagination-single-page"}function v(e,t){var r="",i;return r+='id="',(i=n.id)?i=i.call(e,{hash:{}}):(i=e.id,i=typeof i===f?i.apply(e):i),r+=l(i)+'"',r}function m(e,t){var r="",i,s;return r+="\n	",s={hash:{"class":"sf-pagination-prev",text:"{{t prevText}}",disabled:"{{#if disabledPrevButton}}disabled{{/if}}"}},r+=l((i=n.button,i?i.call(e,s):c.call(e,"button",s)))+"\n",r}function g(e,t){var r="",i,s;return r+="\n	",s={hash:{"class":"sf-pagination-element {{#if isCurrent}}sf-active{{/if}}",dataCurrent:e.number,textLiteral:e.number}},r+=l((i=n.button,i?i.call(e,s):c.call(e,"button",s)))+"\n",r}function y(e,t){var r="",i,s;return r+="\n	",s={hash:{"class":"sf-pagination-next",text:"{{t nextText}}",disabled:"{{#if disabledNextButton}}disabled{{/if}}"}},r+=l((i=n.button,i?i.call(e,s):c.call(e,"button",s)))+"\n",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;s+='<div class="sf-pagination-bar',o=n["if"].call(t,t.classes,{hash:{},inverse:h.noop,fn:h.program(1,p,i)});if(o||o===0)s+=o;a={hash:{},inverse:h.noop,fn:h.program(3,d,i)},u=(o=n.ifequal,o?o.call(t,t.maxPage,1,a):c.call(t,"ifequal",t.maxPage,1,a));if(u||u===0)s+=u;s+='" ',u=n["if"].call(t,t.id,{hash:{},inverse:h.noop,fn:h.program(5,v,i)});if(u||u===0)s+=u;s+=">\n",u=n.unless.call(t,t.disableButtons,{hash:{},inverse:h.noop,fn:h.program(7,m,i)});if(u||u===0)s+=u;s+="\n",a={hash:{},inverse:h.noop,fn:h.program(9,g,i)},u=(o=n.iter,o?o.call(t,t.elements,a):c.call(t,"iter",t.elements,a));if(u||u===0)s+=u;s+="\n",u=n.unless.call(t,t.disableButtons,{hash:{},inverse:h.noop,fn:h.program(11,y,i)});if(u||u===0)s+=u;return s+="\n</div>",s});return t.registerPartial("ui_modules_pagination_templates_pagination-bar",n),n}),define("utils/helpers/format/t-helper",["Handlebars","utils/i18n"],function(e,t){e.registerHelper("t",function(e,n){return n.hash.context!==undefined&&(e=n.hash.context+t.i18n.constructor.KEY_SEPARATOR+e),t.i18n.get(e,n.hash)})}),define("utils/helpers/ui/pagination-helper",["Handlebars","utils/util","hbs!ui/modules/pagination/templates/pagination-bar","utils/helpers/format/t-helper"],function(e,t,n){e.registerHelper("pagination",function(r){var i=t.extend({},r.hash),s=t.handlebarsGoodies.transformDataAttr(i),o=parseInt(r.hash.page||0,10),u=parseInt(r.hash.maxPage||10,10),a=parseInt(r.hash.limit||2,10),f,l,c;s.elements=[],o+a/2>u?c=u:o<a/2+1?c=a:c=o+Math.ceil(a/2)-1,o<=1&&(s.disabledPrevButton=!0),o>=u&&(s.disabledNextButton=!0);for(l=a;l>0;l--)s.elements.push({number:c-l+1,isCurrent:c-l+1===o});return f=n(s),new e.SafeString(f)})}),define("hbs!utils/helpers/ui/empty/templates/empty",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression;s+='<div class="sf-empty ',(o=n["class"])?o=o.call(t,{hash:{}}):(o=t["class"],o=typeof o===u?o.apply(t):o),s+=a(o)+'">',(o=n.text)?o=o.call(t,{hash:{}}):(o=t.text,o=typeof o===u?o.apply(t):o);if(o||o===0)s+=o;return s+="</div>",s});return t.registerPartial("utils_helpers_ui_empty_templates_empty",n),n}),define("utils/helpers/ui/empty/empty-helper",["Handlebars","hbs!utils/helpers/ui/empty/templates/empty","utils/util"],function(e,t,n){e.registerHelper("empty",function(r){var i=n.extend({},this,r.hash),s=t(i);return new e.SafeString(s)})}),define("hbs!utils/helpers/ui/accessible-switch/templates/accessible-switch",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function h(e,t){var r="",i;return r+=" ",(i=n["class"])?i=i.call(e,{hash:{}}):(i=e["class"],i=typeof i===a?i.apply(e):i),r+=f(i),r}function p(e,t){var r="",i;return r+=' id="',(i=n.id)?i=i.call(e,{hash:{}}):(i=e.id,i=typeof i===a?i.apply(e):i),r+=f(i)+'"',r}function d(e,t){var r="",i;return r+=' name="',(i=n.name)?i=i.call(e,{hash:{}}):(i=e.name,i=typeof i===a?i.apply(e):i),r+=f(i)+'"',r}function v(e,t){var r="",i,s;return r+=' title="',s={hash:{}},r+=f((i=n.t,i?i.call(e,e.title,s):l.call(e,"t",e.title,s)))+'"\n	',r}function m(e,t){var r="",i;r+="\n		",i=n["if"].call(e,e.literalTitle,{hash:{},inverse:c.noop,fn:c.program(10,g,t)});if(i||i===0)r+=i;return r+="\n	",r}function g(e,t){var r="",i;return r+=' title="',(i=n.literalTitle)?i=i.call(e,{hash:{}}):(i=e.literalTitle,i=typeof i===a?i.apply(e):i),r+=f(i)+'"',r}function y(e,t){var r;return(r=n.tabindex)?r=r.call(e,{hash:{}}):(r=e.tabindex,r=typeof r===a?r.apply(e):r),f(r)}function b(e,t){return"0"}function w(e,t){var r="",i;return r+=" ",(i=n.name)?i=i.call(e,{hash:{}}):(i=e.name,i=typeof i===a?i.apply(e):i),r+=f(i)+'="',(i=n.value)?i=i.call(e,{hash:{}}):(i=e.value,i=typeof i===a?i.apply(e):i),r+=f(i)+'"',r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing,c=this;s+='<div class="sf-accessible-switch',o=n["if"].call(t,t["class"],{hash:{},inverse:c.noop,fn:c.program(1,h,i)});if(o||o===0)s+=o;s+='"\n	',o=n["if"].call(t,t.id,{hash:{},inverse:c.noop,fn:c.program(3,p,i)});if(o||o===0)s+=o;s+="\n	",o=n["if"].call(t,t.name,{hash:{},inverse:c.noop,fn:c.program(5,d,i)});if(o||o===0)s+=o;s+="\n	",o=n["if"].call(t,t.title,{hash:{},inverse:c.program(9,m,i),fn:c.program(7,v,i)});if(o||o===0)s+=o;s+='\n     tabindex="',o=n["if"].call(t,t.tabindex,{hash:{},inverse:c.program(14,b,i),fn:c.program(12,y,i)});if(o||o===0)s+=o;s+='"\n	',o=n.each.call(t,t.data,{hash:{},inverse:c.noop,fn:c.program(16,w,i)});if(o||o===0)s+=o;return s+=">\n\n    ",u={hash:{"class":"sf-accessible-show",text:"{{#if showAccessibleText}}{{t showAccessibleText}}{{else}}{{t 'common.accessibility.showAccessible'}}{{/if}}"}},s+=f((o=n.button,o?o.call(t,u):l.call(t,"button",u)))+"\n\n    ",u={hash:{"class":"sf-accessible-hide",text:"{{#if showGraphicText}}{{t showGraphicText}}{{else}}{{t 'common.accessibility.showGraphic'}}{{/if}}"}},s+=f((o=n.button,o?o.call(t,u):l.call(t,"button",u)))+"\n</div>",s});return t.registerPartial("utils_helpers_ui_accessible-switch_templates_accessible-switch",n),n}),define("libs/require/css/css!utils/helpers/ui/accessible-switch/css/accessible-switch",[],function(){}),define("utils/helpers/ui/accessible-switch/accessible-switch-helper",["Handlebars","hbs!utils/helpers/ui/accessible-switch/templates/accessible-switch","utils/util","utils/helpers/format/t-helper","css!utils/helpers/ui/accessible-switch/css/accessible-switch"],function(e,t,n){e.registerHelper("accessibleSwitch",function(r){var i=n.extend({},r.hash),s=n.handlebarsGoodies.transformDataAttr(i),o=t(s);return new e.SafeString(o)})}),define("hbs!utils/helpers/ui/button/templates/button",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){var r="",i;return r+=" ",(i=n["class"])?i=i.call(e,{hash:{}}):(i=e["class"],i=typeof i===u?i.apply(e):i),r+=a(i),r}function h(e,t){var r="",i;return r+=' id="',(i=n.id)?i=i.call(e,{hash:{}}):(i=e.id,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function p(e,t){var r="",i;return r+=' name="',(i=n.name)?i=i.call(e,{hash:{}}):(i=e.name,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function d(e,t){var r="",i,s;return r+=' title="',s={hash:{}},r+=a((i=n.t,i?i.call(e,e.title,s):f.call(e,"t",e.title,s)))+'"\n		',r}function v(e,t){var r="",i;r+="\n			",i=n["if"].call(e,e.literalTitle,{hash:{},inverse:l.noop,fn:l.program(10,m,t)});if(i||i===0)r+=i;return r+="\n		",r}function m(e,t){var r="",i;return r+=' title="',(i=n.literalTitle)?i=i.call(e,{hash:{}}):(i=e.literalTitle,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function g(e,t){return' disabled="disabled"'}function y(e,t){var r;return(r=n.tabindex)?r=r.call(e,{hash:{}}):(r=e.tabindex,r=typeof r===u?r.apply(e):r),a(r)}function b(e,t){return"0"}function w(e,t){var r;return(r=n.type)?r=r.call(e,{hash:{}}):(r=e.type,r=typeof r===u?r.apply(e):r),a(r)}function E(e,t){return"button"}function S(e,t){var r="",i;return r+=" ",(i=n.name)?i=i.call(e,{hash:{}}):(i=e.name,i=typeof i===u?i.apply(e):i),r+=a(i)+'="',(i=n.value)?i=i.call(e,{hash:{}}):(i=e.value,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function x(e,t){var r,i,s;return s={hash:{}},i=(r=n.t,r?r.call(e,e.text,s):f.call(e,"t",e.text,s)),i||i===0?i:""}function T(e,t){var r;return(r=n.textLiteral)?r=r.call(e,{hash:{}}):(r=e.textLiteral,r=typeof r===u?r.apply(e):r),a(r)}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=n.helperMissing,l=this;s+='<button class="sf-button',o=n["if"].call(t,t["class"],{hash:{},inverse:l.noop,fn:l.program(1,c,i)});if(o||o===0)s+=o;s+='"\n		',o=n["if"].call(t,t.id,{hash:{},inverse:l.noop,fn:l.program(3,h,i)});if(o||o===0)s+=o;s+="\n		",o=n["if"].call(t,t.name,{hash:{},inverse:l.noop,fn:l.program(5,p,i)});if(o||o===0)s+=o;s+="\n		",o=n["if"].call(t,t.title,{hash:{},inverse:l.program(9,v,i),fn:l.program(7,d,i)});if(o||o===0)s+=o;s+="\n		",o=n["if"].call(t,t.disabled,{hash:{},inverse:l.noop,fn:l.program(12,g,i)});if(o||o===0)s+=o;s+='\n		 tabindex="',o=n["if"].call(t,t.tabindex,{hash:{},inverse:l.program(16,b,i),fn:l.program(14,y,i)});if(o||o===0)s+=o;s+='"\n		 type="',o=n["if"].call(t,t.type,{hash:{},inverse:l.program(20,E,i),fn:l.program(18,w,i)});if(o||o===0)s+=o;s+='"\n		 ',o=n.each.call(t,t.data,{hash:{},inverse:l.noop,fn:l.program(22,S,i)});if(o||o===0)s+=o;s+='>\n		 <span class="sf-button-text">',o=n["if"].call(t,t.text,{hash:{},inverse:l.noop,fn:l.program(24,x,i)});if(o||o===0)s+=o;o=n["if"].call(t,t.textLiteral,{hash:{},inverse:l.noop,fn:l.program(26,T,i)});if(o||o===0)s+=o;return s+="</span></button>",s});return t.registerPartial("utils_helpers_ui_button_templates_button",n),n}),define("libs/require/css/css!utils/helpers/ui/button/css/button",[],function(){}),define("utils/helpers/ui/button/button-helper",["Handlebars","hbs!utils/helpers/ui/button/templates/button","utils/util","utils/helpers/format/t-helper","css!utils/helpers/ui/button/css/button"],function(e,t,n){e.registerHelper("button",function(r){var i=n.extend({},r.hash),s=n.handlebarsGoodies.transformDataAttr(i),o=t(s);return new e.SafeString(o)})}),define("hbs!utils/helpers/ui/header/templates/widget-header",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r;return(r=n.subtitle)?r=r.call(e,{hash:{}}):(r=e.subtitle,r=typeof r===u?r.apply(e):r),r||r===0?r:""}function c(e,t){var r="",i;r+='\n		<div class="sf-filters-placeholder">\n			',i=n.each.call(e,e.filtersPlaceholders,{hash:{},inverse:f.noop,fn:f.program(4,h,t)});if(i||i===0)r+=i;return r+="\n		</div>\n		",r}function h(e,t){var n="";return n+='<div class="'+a(typeof e===u?e.apply(e):e)+'"></div>',n}function p(e,t){return'<div class="sf-summary-placeholder"></div>'}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="sf-',(o=n.id)?o=o.call(t,{hash:{}}):(o=t.id,o=typeof o===u?o.apply(t):o),s+=a(o)+'-header sf-widget-header">\n	<div class="sf-title"><h2>',(o=n.title)?o=o.call(t,{hash:{}}):(o=t.title,o=typeof o===u?o.apply(t):o);if(o||o===0)s+=o;s+='</h2></div>\n	<div class="sf-header-info">\n		<div class="sf-subtitle">',o=n["if"].call(t,t.subtitle,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;s+="</div>\n		",o=n["if"].call(t,t.filtersPlaceholders,{hash:{},inverse:f.noop,fn:f.program(3,c,i)});if(o||o===0)s+=o;s+="\n		",o=n["if"].call(t,t.summaryPlaceholder,{hash:{},inverse:f.noop,fn:f.program(6,p,i)});if(o||o===0)s+=o;return s+='\n	</div>\n	<div class="sf-clearfix"></div>\n</div>',s});return t.registerPartial("utils_helpers_ui_header_templates_widget-header",n),n}),define("utils/helpers/ui/header/header-helper",["Handlebars","hbs!utils/helpers/ui/header/templates/widget-header","utils/util"],function(e,t,n){e.registerHelper("header",function(r){var i=n.extend({},this,r.hash),s=t(i);return new e.SafeString(s)})}),define("hbs!utils/helpers/ui/progressbar/templates/progressbar",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){var r="",i,s;return r+="\n            ",s={hash:{}},r+=a((i=n.progressbarLegend,i?i.call(e,e.legendTop,s):u.call(e,"progressbarLegend",e.legendTop,s)))+"\n        ",r}function h(e,t){var r="",i;return r+=' title="',(i=n.tooltip)?i=i.call(e,{hash:{}}):(i=e.tooltip,i=typeof i===f?i.apply(e):i),r+=a(i)+'"',r}function p(e,t){var r="",i;return r+='\n                <div class="sf-bar sf-bar-target" style="width: ',(i=n.targetPercentage)?i=i.call(e,{hash:{}}):(i=e.targetPercentage,i=typeof i===f?i.apply(e):i),r+=a(i)+'%;"></div>\n                ',r}function d(e,t){return" sf-bar-danger"}function v(e,t){return" sf-bar-success"}function m(e,t){return" sf-bar-warning"}function g(e,t){var r="",i,s;return r+='\n                <div class="sf-bar-title"><strong>',s={hash:{}},r+=a((i=n.t,i?i.call(e,e.title,s):u.call(e,"t",e.title,s)))+"</strong></div>\n                ",r}function y(e,t){var r="",i,s;return r+="\n            ",s={hash:{}},r+=a((i=n.progressbarLegend,i?i.call(e,e.legendBottom,s):u.call(e,"progressbarLegend",e.legendBottom,s)))+"\n        ",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u=n.helperMissing,a=this.escapeExpression,f="function",l=this;s+='<div class="sf-progressbar sf-progressbar-',(o=n.status)?o=o.call(t,{hash:{}}):(o=t.status,o=typeof o===f?o.apply(t):o),s+=a(o)+" ",(o=n.axisClass)?o=o.call(t,{hash:{}}):(o=t.axisClass,o=typeof o===f?o.apply(t):o),s+=a(o)+'">\n        ',o=n["if"].call(t,t.legendTop,{hash:{},inverse:l.noop,fn:l.program(1,c,i)});if(o||o===0)s+=o;s+='\n        <div class="sf-progressbar-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="',(o=n.valuePercentage)?o=o.call(t,{hash:{}}):(o=t.valuePercentage,o=typeof o===f?o.apply(t):o),s+=a(o)+'">\n            <div class="sf-bar-box sf-bar-tooltip sf-progressbar-tooltip"',o=n.unless.call(t,t.noTooltipOptions,{hash:{},inverse:l.noop,fn:l.program(3,h,i)});if(o||o===0)s+=o;s+=">\n                ",o=n["if"].call(t,t.target,{hash:{},inverse:l.noop,fn:l.program(5,p,i)});if(o||o===0)s+=o;s+='\n                <div class="sf-bar',o=n["if"].call(t,t.danger,{hash:{},inverse:l.noop,fn:l.program(7,d,i)});if(o||o===0)s+=o;o=n["if"].call(t,t.success,{hash:{},inverse:l.noop,fn:l.program(9,v,i)});if(o||o===0)s+=o;o=n["if"].call(t,t.warning,{hash:{},inverse:l.noop,fn:l.program(11,m,i)});if(o||o===0)s+=o;s+='" style="width: ',(o=n.valuePercentage)?o=o.call(t,{hash:{}}):(o=t.valuePercentage,o=typeof o===f?o.apply(t):o),s+=a(o)+'%;"></div>\n                ',o=n["if"].call(t,t.title,{hash:{},inverse:l.noop,fn:l.program(13,g,i)});if(o||o===0)s+=o;s+="\n            </div>\n        </div>\n        ",o=n["if"].call(t,t.legendBottom,{hash:{},inverse:l.noop,fn:l.program(15,y,i)});if(o||o===0)s+=o;return s+="\n</div>",s});return t.registerPartial("utils_helpers_ui_progressbar_templates_progressbar",n),n}),define("hbs!utils/helpers/ui/progressbar/templates/progressbar-legend",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i;return r+=" sf-legend-bar-",(i=n.type)?i=i.call(e,{hash:{}}):(i=e.type,i=typeof i===u?i.apply(e):i),r+=a(i),r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="sf-progressbar-legend sf-legend-',(o=n.position)?o=o.call(t,{hash:{}}):(o=t.position,o=typeof o===u?o.apply(t):o),s+=a(o)+" sf-legend-",(o=n.alignment)?o=o.call(t,{hash:{}}):(o=t.alignment,o=typeof o===u?o.apply(t):o),s+=a(o)+'">\n	<div class="sf-legend-bar',o=n["if"].call(t,t.type,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;s+='" style="',(o=n.anchor)?o=o.call(t,{hash:{}}):(o=t.anchor,o=typeof o===u?o.apply(t):o),s+=a(o)+": ",(o=n.valuePercentage)?o=o.call(t,{hash:{}}):(o=t.valuePercentage,o=typeof o===u?o.apply(t):o),s+=a(o)+'%">',(o=n.label)?o=o.call(t,{hash:{}}):(o=t.label,o=typeof o===u?o.apply(t):o);if(o||o===0)s+=o;return s+="</div>\n</div>",s});return t.registerPartial("utils_helpers_ui_progressbar_templates_progressbar-legend",n),n}),define("utils/helpers/ui/progressbar/progressbar-legend-helper",["Handlebars","hbs!utils/helpers/ui/progressbar/templates/progressbar-legend"],function(e,t){e.registerHelper("progressbarLegend",function(n){var r=t(n);return new e.SafeString(r)})}),define("libs/require/css/css!utils/helpers/ui/progressbar/css/progressbar",[],function(){}),define("utils/helpers/ui/progressbar/progressbar-helper",["Handlebars","hbs!utils/helpers/ui/progressbar/templates/progressbar","utils/util","utils/amount","utils/helpers/ui/progressbar/progressbar-legend-helper","css!utils/helpers/ui/progressbar/css/progressbar"],function(e,t,n){e.registerHelper("progressbar",function(r){var i=r.hash,s=30,o=70,u=.2,a,f=r.hash?r.hash.numberFormat:undefined,l=r.hash?r.hash.curr:undefined,c='<span class="sf-amount">',h="</span>",p=n.locale.config("progressbar"),d=p.textDirection==="rtl",v=i.axisDirection||p.axisDirection,m=v==="auto"?d:v==="rtl",g=m?"right":"left",y=m?"left":"right",b=function(e){return c+n.amount.format(e,undefined,l,undefined,undefined,f)+h},w=function(e,t){return e.replace("{title}",t.title).replace("{value}",b(t.value)).replace("{target}",b(t.target)).replace("{total}",b(t.total)).replace("{left}",b(t.total-t.value)).replace("{over}",b(t.value-t.total)).replace("{expected}",b(t.expected)).replace("{incomeLeft}",b(t.incomeLeft))},E=function(e,t,r,i){var u={alignment:g,position:e,type:i.extraClasses&&t==="value"?i.status:t,value:i[t],valuePercentage:i[t+"Percentage"]};return t==="left"&&(u.valuePercentage=i.valuePercentage,u.value=i.total-i.value,u.value<0&&(u.value=0),u.alignment=y),u.label=r.replace("{value}",n.isNumber(u.value)?b(u.value):u.value),u.valuePercentage>o?u.alignment=g:u.valuePercentage<s&&(u.alignment=y),u.alignment===g?(u.anchor=y,u.valuePercentage=100-u.valuePercentage):u.anchor=g,u};return i.valuePercentage=i.value/i.total*100,i.valuePercentage>100&&(i.valuePercentage=100),i.target!==undefined&&(i.targetPercentage=i.target/i.total*100),i.expected!==undefined&&(i.expectedPercentage=i.expected/i.total*100),i.value===i.total&&i.expected===undefined?(i.status="success",i.extraClasses&&(i.success=!0)):i.value>i.total||i.target&&i.value<i.target-i.target*u?(i.status="danger",i.extraClasses&&(i.danger=!0)):i.target!==undefined&&i.value<i.target||i.expected!==undefined&&i.value>=i.expected?(i.status="warning",i.extraClasses&&(i.warning=!0)):i.status="default",i.tooltip=w(n.i18n.get(i.messages+".tooltip."+i.status),i),i.legendTop&&(i.legendTop=E("top",i.legendTop,n.i18n.get(i.messages+".label.top"),i)),i.legendBottom&&(i.legendBottom=E("bottom",i.legendBottom,n.i18n.get(i.messages+".label.bottom"),i)),i.axisClass=m?"sf-axis-rtl":"sf-axis-ltr",a=t(i),new e.SafeString(a)})}),define("hbs!utils/helpers/ui/progressbar-mobile/templates/progressbar-mobile",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function h(e,t){var r="",i;return r+=' title="',(i=n.tooltip)?i=i.call(e,{hash:{}}):(i=e.tooltip,i=typeof i===a?i.apply(e):i),r+=f(i)+'"',r}function p(e,t){var r="",i;return r+='\n                <div class="sf-bar sf-bar-target" style="width: ',(i=n.targetPercentage)?i=i.call(e,{hash:{}}):(i=e.targetPercentage,i=typeof i===a?i.apply(e):i),r+=f(i)+'%;"></div>\n                ',r}function d(e,t){return" sf-bar-danger"}function v(e,t){return" sf-bar-success"}function m(e,t){return" sf-bar-warning"}function g(e,t){var r="",i,s;return r+='\n                <div class="sf-bar-title"><strong>',s={hash:{}},r+=f((i=n.t,i?i.call(e,e.title,s):l.call(e,"t",e.title,s)))+"</strong></div>\n                ",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing,c=this;s+='<div class="sf-progressbar sf-progressbar-mobile sf-progressbar-',(o=n.status)?o=o.call(t,{hash:{}}):(o=t.status,o=typeof o===a?o.apply(t):o),s+=f(o)+" ",(o=n.axisClass)?o=o.call(t,{hash:{}}):(o=t.axisClass,o=typeof o===a?o.apply(t):o),s+=f(o)+'">\n        <div class="sf-progressbar-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="',(o=n.valuePercentage)?o=o.call(t,{hash:{}}):(o=t.valuePercentage,o=typeof o===a?o.apply(t):o),s+=f(o)+'">\n            <div class="sf-bar-box sf-bar-tooltip sf-progressbar-tooltip"',o=n.unless.call(t,t.noTooltipOptions,{hash:{},inverse:c.noop,fn:c.program(1,h,i)});if(o||o===0)s+=o;s+=">\n                ",o=n["if"].call(t,t.target,{hash:{},inverse:c.noop,fn:c.program(3,p,i)});if(o||o===0)s+=o;s+='\n                <div class="sf-bar',o=n["if"].call(t,t.danger,{hash:{},inverse:c.noop,fn:c.program(5,d,i)});if(o||o===0)s+=o;o=n["if"].call(t,t.success,{hash:{},inverse:c.noop,fn:c.program(7,v,i)});if(o||o===0)s+=o;o=n["if"].call(t,t.warning,{hash:{},inverse:c.noop,fn:c.program(9,m,i)});if(o||o===0)s+=o;s+='" style="width: ',(o=n.valuePercentage)?o=o.call(t,{hash:{}}):(o=t.valuePercentage,o=typeof o===a?o.apply(t):o),s+=f(o)+'%;"></div>\n                ',o=n["if"].call(t,t.title,{hash:{},inverse:c.noop,fn:c.program(11,g,i)});if(o||o===0)s+=o;return s+="\n            </div>\n        </div>\n            ",u={hash:{}},s+=f((o=n.progressbarLegendMobile,o?o.call(t,t.legendBottom,u):l.call(t,"progressbarLegendMobile",t.legendBottom,u)))+"\n</div>",s});return t.registerPartial("utils_helpers_ui_progressbar-mobile_templates_progressbar-mobile",n),n}),define("hbs!utils/helpers/ui/progressbar-mobile/templates/progressbar-mobile-legend",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){var n="",r;return n+=" sf-legend-bar-"+f((r=(r=e.legendLeft,r==null||r===!1?r:r.type),typeof r===a?r.apply(e):r)),n}function h(e,t){var n="",r;return n+=" sf-legend-bar-"+f((r=(r=e.legendRight,r==null||r===!1?r:r.type),typeof r===a?r.apply(e):r)),n}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression,l=this;s+='<div class="sf-progressbar-legend sf-legend-bottom">\n	<div class="sf-legend-bar sf-legend-mobile-left ',u=n["if"].call(t,(o=t.legendLeft,o==null||o===!1?o:o.type),{hash:{},inverse:l.noop,fn:l.program(1,c,i)});if(u||u===0)s+=u;s+='" style="'+f((o=(o=t.legendLeft,o==null||o===!1?o:o.anchor),typeof o===a?o.apply(t):o))+": "+f((o=(o=t.legendLeft,o==null||o===!1?o:o.valuePercentage),typeof o===a?o.apply(t):o))+'%">',u=(o=(o=t.legendLeft,o==null||o===!1?o:o.label),typeof o===a?o.apply(t):o);if(u||u===0)s+=u;s+='</div>\n	<div class="sf-legend-bar sf-legend-mobile-right ',u=n["if"].call(t,(o=t.legendRight,o==null||o===!1?o:o.type),{hash:{},inverse:l.noop,fn:l.program(3,h,i)});if(u||u===0)s+=u;s+='" style="'+f((o=(o=t.legendRight,o==null||o===!1?o:o.anchor),typeof o===a?o.apply(t):o))+": "+f((o=(o=t.legendRight,o==null||o===!1?o:o.valuePercentage),typeof o===a?o.apply(t):o))+'%">',u=(o=(o=t.legendRight,o==null||o===!1?o:o.label),typeof o===a?o.apply(t):o);if(u||u===0)s+=u;return s+="</div>\n</div>",s});return t.registerPartial("utils_helpers_ui_progressbar-mobile_templates_progressbar-mobile-legend",n),n}),define("utils/helpers/ui/progressbar-mobile/progressbar-mobile-legend-helper",["Handlebars","hbs!utils/helpers/ui/progressbar-mobile/templates/progressbar-mobile-legend"],function(e,t){e.registerHelper("progressbarLegendMobile",function(n){var r=t(n);return new e.SafeString(r)})}),define("libs/require/css/css!utils/helpers/ui/progressbar-mobile/css/progressbar-mobile",[],function(){}),define("utils/helpers/ui/progressbar-mobile/progressbar-mobile-helper",["Handlebars","hbs!utils/helpers/ui/progressbar-mobile/templates/progressbar-mobile","utils/util","utils/amount","utils/helpers/ui/progressbar-mobile/progressbar-mobile-legend-helper","css!utils/helpers/ui/progressbar-mobile/css/progressbar-mobile"],function(e,t,n){e.registerHelper("progressbarmobile",function(r){var i=r.hash,s=30,o=70,u=.2,a,f=r.hash?r.hash.numberFormat:undefined,l=r.hash?r.hash.curr:undefined,c='<span class="sf-amount">',h="</span>",p=n.locale.config("progressbar"),d=p.textDirection==="rtl",v=i.axisDirection||p.axisDirection,m=v==="auto"?d:v==="rtl",g=m?"right":"left",y=m?"left":"right",b=function(e){return c+n.amount.format(e,undefined,l,undefined,undefined,f)+h},w=function(e,t){return e.replace("{title}",t.title).replace("{value}",b(t.value)).replace("{target}",b(t.target)).replace("{total}",b(t.total)).replace("{left}",b(t.total-t.value)).replace("{over}",b(t.value-t.total)).replace("{expected}",b(t.expected)).replace("{incomeLeft}",b(t.incomeLeft))},E=function(e,t,r,i){var u={alignment:g,position:e,type:i.extraClasses&&t==="value"?i.status:t,value:i[t],valuePercentage:i[t+"Percentage"]};return t==="left"&&(u.valuePercentage=i.valuePercentage,u.value=i.total-i.value,u.value<0&&(u.value=0),u.alignment=y),u.label=r.replace("{value}",n.isNumber(u.value)?b(u.value):u.value),u.valuePercentage>o?u.alignment=g:u.valuePercentage<s&&(u.alignment=y),u.alignment===g?(u.anchor=y,u.valuePercentage=100-u.valuePercentage):u.anchor=g,u};return i.valuePercentage=i.value/i.total*100,i.valuePercentage>100&&(i.valuePercentage=100),i.target!==undefined&&(i.targetPercentage=i.target/i.total*100),i.expected!==undefined&&(i.expectedPercentage=i.expected/i.total*100),i.value===i.total&&i.expected===undefined?(i.status="success",i.extraClasses&&(i.success=!0)):i.value>i.total||i.target&&i.value<i.target-i.target*u?(i.status="danger",i.extraClasses&&(i.danger=!0)):i.target!==undefined&&i.value<i.target||i.expected!==undefined&&i.value>=i.expected?(i.status="warning",i.extraClasses&&(i.warning=!0)):i.status="default",i.tooltip=w(n.i18n.get(i.messages+".tooltip."+i.status),i),i.legendBottom={legendLeft:E("left",i.legendLeft,n.i18n.get(i.messages+".label.left"),i),legendRight:E("right",i.legendRight,n.i18n.get(i.messages+".label.right"),i)},i.axisClass=m?"sf-axis-rtl":"sf-axis-ltr",a=t(i),new e.SafeString(a)})}),define("hbs!utils/helpers/ui/summary-box/templates/summary-box",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r;return(r=n["class"])?r=r.call(e,{hash:{}}):(r=e["class"],r=typeof r===u?r.apply(e):r),a(r)}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="sf-summary-box ',o=n["if"].call(t,t["class"],{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;s+='">\n	<div class="sf-summary-box-title">',(o=n.title)?o=o.call(t,{hash:{}}):(o=t.title,o=typeof o===u?o.apply(t):o),s+=a(o)+'</div>\n	<div class="sf-summary-box-value">',(o=n.value)?o=o.call(t,{hash:{}}):(o=t.value,o=typeof o===u?o.apply(t):o);if(o||o===0)s+=o;return s+="</div>\n</div>",s});return t.registerPartial("utils_helpers_ui_summary-box_templates_summary-box",n),n}),define("libs/require/css/css!utils/helpers/ui/summary-box/css/summary-box",[],function(){}),define("utils/helpers/ui/summary-box/summary-box-helper",["Handlebars","hbs!utils/helpers/ui/summary-box/templates/summary-box","css!utils/helpers/ui/summary-box/css/summary-box"],function(e,t){e.registerHelper("summaryBox",function(n){var r=t(n.hash);return new e.SafeString(r)})}),define("utils/helpers/ui/textfield/textfield-helper",["Handlebars","hbs!utils/helpers/ui/textfield/templates/textfield","utils/util","utils/amount"],function(e,t,n){e.registerHelper("textfield",function(r){var i=n.extend({},r.hash),s=n.handlebarsGoodies.transformDataAttr(i),o,u;if(r.hash.affix==="currency")u=n.number.parse(r.hash.value),r.hash.multiSign||(!u||u>=0)&&!r.hash.forceNegativeAmount?(s.prefix=n.amount.getCurrPrefix(!0,r.hash.currency),s.suffix=n.amount.getCurrSuffix(!0,r.hash.currency)):(s.prefix=n.amount.getCurrPrefix(!1,r.hash.currency),s.suffix=n.amount.getCurrSuffix(!1,r.hash.currency)),u!==null&&(s.value=n.number.format(u),r.hash.multiSign&&u<0&&(s.value="-"+s.value));else if(r.hash.prefix||r.hash.suffix)s.affix=!0;return o=t(s),new e.SafeString(o)})}),define("hbs!ui/modules/reform/select/templates/select",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){var r="",i;return r+=" ",(i=n["class"])?i=i.call(e,{hash:{}}):(i=e["class"],i=typeof i===u?i.apply(e):i),r+=a(i),r}function h(e,t){var r="",i;return r+='id="',(i=n.id)?i=i.call(e,{hash:{}}):(i=e.id,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function p(e,t){var r="",i;return r+=' class="',(i=n["class"])?i=i.call(e,{hash:{}}):(i=e["class"],i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function d(e,t){var r="",i;return r+=' name="',(i=n.name)?i=i.call(e,{hash:{}}):(i=e.name,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function v(e,t){return' disabled="disabled"'}function m(e,t){var r="",i;return r+=' labelledby="',(i=n.labelledby)?i=i.call(e,{hash:{}}):(i=e.labelledby,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function g(e,t){var r="",i;return r+=' aria-label="',(i=n.ariaLabel)?i=i.call(e,{hash:{}}):(i=e.ariaLabel,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function y(e,t){var r;return(r=n.tabindex)?r=r.call(e,{hash:{}}):(r=e.tabindex,r=typeof r===u?r.apply(e):r),a(r)}function b(e,t){return"0"}function w(e,t){var r="",i,s;return r+=" ",s={hash:{}},r+=a((i=n.validator,i?i.call(e,e.validateField,s):f.call(e,"validator",e.validateField,s))),r}function E(e,t){var r="",i;return r+=" ",(i=n.name)?i=i.call(e,{hash:{}}):(i=e.name,i=typeof i===u?i.apply(e):i),r+=a(i)+'="',(i=n.value)?i=i.call(e,{hash:{}}):(i=e.value,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function S(e,t,r){var i="",s,o,u;i+='\n				<option value="',s=n["if"].call(e,e.value,{hash:{},inverse:l.noop,fn:l.program(24,x,t)});if(s||s===0)i+=s;u={hash:{},inverse:l.noop,fn:l.program(17,b,t)},o=(s=n.ifequal,s?s.call(e,e.value,0,u):f.call(e,"ifequal",e.value,0,u));if(o||o===0)i+=o;i+='" ',u={hash:{},inverse:l.noop,fn:l.program(26,T,t)},o=(s=n.ifequal,s?s.call(e,r.currentOption,e.value,u):f.call(e,"ifequal",r.currentOption,e.value,u));if(o||o===0)i+=o;o=n["if"].call(e,e.color,{hash:{},inverse:l.noop,fn:l.program(28,N,t)});if(o||o===0)i+=o;i+=" ",o=n["if"].call(e,e.isIncome,{hash:{},inverse:l.noop,fn:l.program(30,C,t)});if(o||o===0)i+=o;i+=" ",o=n["if"].call(e,e["class"],{hash:{},inverse:l.noop,fn:l.program(32,k,t)});if(o||o===0)i+=o;i+=">",o=n["if"].call(e,e.name,{hash:{},inverse:l.noop,fn:l.program(34,L,t)});if(o||o===0)i+=o;i+="</option>\n				",o=n["if"].call(e,e.children,{hash:{},inverse:l.noop,fn:l.programWithDepth(A,t,r)});if(o||o===0)i+=o;return i+="\n			",i}function x(e,t){var r;return(r=n.value)?r=r.call(e,{hash:{}}):(r=e.value,r=typeof r===u?r.apply(e):r),a(r)}function T(e,t){return'selected="selected"'}function N(e,t){var r="",i;return r+=' data-color="',(i=n.color)?i=i.call(e,{hash:{}}):(i=e.color,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function C(e,t){var r="",i;return r+=' data-income="',(i=n.isIncome)?i=i.call(e,{hash:{}}):(i=e.isIncome,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function k(e,t){var r="",i;return r+='class="',(i=n["class"])?i=i.call(e,{hash:{}}):(i=e["class"],i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function L(e,t){var r;return(r=n.name)?r=r.call(e,{hash:{}}):(r=e.name,r=typeof r===u?r.apply(e):r),a(r)}function A(e,t,r){var i="",s;i+="\n					",s=n.each.call(e,e.children,{hash:{},inverse:l.noop,fn:l.programWithDepth(O,t,e,r)});if(s||s===0)i+=s;return i+="\n				",i}function O(e,t,r,i){var s="",o,c,h;s+="\n						<option ",o=n["if"].call(e,e.custom,{hash:{},inverse:l.noop,fn:l.program(38,M,t)});if(o||o===0)s+=o;s+=" ",o=n["if"].call(e,e.value,{hash:{},inverse:l.noop,fn:l.program(40,_,t)});if(o||o===0)s+=o;s+=' data-parent="'+a((o=r.value,typeof o===u?o.apply(e):o))+'"',c=n["if"].call(e,e.color,{hash:{},inverse:l.noop,fn:l.program(28,N,t)});if(c||c===0)s+=c;s+=" ",c=n["if"].call(e,e.isIncome,{hash:{},inverse:l.noop,fn:l.program(30,C,t)});if(c||c===0)s+=c;s+=" ",h={hash:{},inverse:l.noop,fn:l.program(26,T,t)},c=(o=n.ifequal,o?o.call(e,i.currentOption,e.value,h):f.call(e,"ifequal",i.currentOption,e.value,h));if(c||c===0)s+=c;s+=">",c=n["if"].call(e,e.name,{hash:{},inverse:l.noop,fn:l.program(34,L,t)});if(c||c===0)s+=c;return s+="</option>\n					",s}function M(e,t){return'class="sf-custom"'}function _(e,t){var r="",i;return r+='value="',(i=n.value)?i=i.call(e,{hash:{}}):(i=e.value,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=n.helperMissing,l=this;s+='<span class="sf-form-field">\n	<div class="sf-reform-select sf-dropdown',o=n["if"].call(t,t["class"],{hash:{},inverse:l.noop,fn:l.program(1,c,i)});if(o||o===0)s+=o;s+='" role="combobox" aria-live="assertive" aria-expanded="false" tabindex="0">\n		<select ',o=n["if"].call(t,t.id,{hash:{},inverse:l.noop,fn:l.program(3,h,i)});if(o||o===0)s+=o;s+="\n		",o=n["if"].call(t,t["class"],{hash:{},inverse:l.noop,fn:l.program(5,p,i)});if(o||o===0)s+=o;s+="\n		",o=n["if"].call(t,t.name,{hash:{},inverse:l.noop,fn:l.program(7,d,i)});if(o||o===0)s+=o;s+="\n		",o=n["if"].call(t,t.disabled,{hash:{},inverse:l.noop,fn:l.program(9,v,i)});if(o||o===0)s+=o;s+="\n		",o=n["if"].call(t,t.labelledby,{hash:{},inverse:l.noop,fn:l.program(11,m,i)});if(o||o===0)s+=o;s+="\n		",o=n["if"].call(t,t.ariaLabel,{hash:{},inverse:l.noop,fn:l.program(13,g,i)});if(o||o===0)s+=o;s+='\n		 tabindex="',o=n["if"].call(t,t.tabindex,{hash:{},inverse:l.program(17,b,i),fn:l.program(15,y,i)});if(o||o===0)s+=o;s+='"\n		',o=n["if"].call(t,t.validateField,{hash:{},inverse:l.noop,fn:l.program(19,w,i)});if(o||o===0)s+=o;s+="\n		",o=n.each.call(t,t.data,{hash:{},inverse:l.noop,fn:l.program(21,E,i)});if(o||o===0)s+=o;s+=">\n			",o=n.each.call(t,t.options,{hash:{},inverse:l.noop,fn:l.programWithDepth(S,i,t)});if(o||o===0)s+=o;return s+='\n		</select>\n		<span class="sf-current"></span>\n		<span class="sf-button-opener"><span class="sf-button-opener-icon sf-icon"></span></span>\n		<div class="sf-optionlist" role="listbox" aria-expanded="false"></div>\n	</div>\n</span>',s});return t.registerPartial("ui_modules_reform_select_templates_select",n),n}),define("utils/helpers/ui/reform/select-helper",["Handlebars","hbs!ui/modules/reform/select/templates/select","utils/util","utils/handlebars-goodies"],function(e,t,n){e.registerHelper("select",function(r){var i=n.extend({},r.hash),s=n.handlebarsGoodies.transformDataAttr(i),o=t(s);return new e.SafeString(o)})}),define("hbs!ui/modules/reform/multilevel-select/templates/multilevel-select-option",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression;return s+='<div class="sf-option"><span class="sf-icon-before"></span>',(o=n.label)?o=o.call(t,{hash:{}}):(o=t.label,o=typeof o===u?o.apply(t):o),s+=a(o)+'<span class="sf-icon-after"></span></div>',s});return t.registerPartial("ui_modules_reform_multilevel-select_templates_multilevel-select-option",n),n}),define("hbs!ui/modules/reform/multilevel-select/templates/multilevel-select-sublist",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-optionlist sf-sublist"></div>'});return t.registerPartial("ui_modules_reform_multilevel-select_templates_multilevel-select-sublist",n),n}),define("hbs!ui/modules/reform/multilevel-select/templates/multilevel-select-scroller",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-scroller"></div>'});return t.registerPartial("ui_modules_reform_multilevel-select_templates_multilevel-select-scroller",n),n}),define("libs/require/css/css!ui/modules/reform/multilevel-select/css/multilevel-select",[],function(){}),define("ui/modules/reform/multilevel-select/multilevel-select-module",["ui/modules/reform/select/select-module","jQuery","utils/util","hbs!ui/modules/reform/multilevel-select/templates/multilevel-select-option","hbs!ui/modules/reform/multilevel-select/templates/multilevel-select-sublist","hbs!ui/modules/reform/multilevel-select/templates/multilevel-select-scroller","utils/constants","css!ui/modules/reform/multilevel-select/css/multilevel-select"],function(e,t,n,r,i,s){return e.MultilevelSelect=e.Select.extend({optionTmpl:r,sublistTmpl:i,scrollerTmpl:s,initialize:function(){this._super.apply(this,arguments),this.sublist={},this.markTimeout=0,this.markDelay=this.config.markDelay,this.LEFT_TO_RIGHT=0,this.RIGHT_TO_LEFT=1,this.direction=this.config.textDirection=="rtl"?this.RIGHT_TO_LEFT:this.LEFT_TO_RIGHT,this.mainCategoriesDisabled=!0,this._hoveredOption=null,this._super()},_onKeydown:function(e){switch(e.keyCode){case n.constants.KEYLEFT:this.direction==this.LEFT_TO_RIGHT?this.parentOption():this.childOption(),e.preventDefault(),e.stopPropagation();return;case n.constants.KEYRIGHT:this.direction==this.LEFT_TO_RIGHT?this.childOption():this.parentOption(),e.preventDefault(),e.stopPropagation();return;case n.constants.ENTER:this.opened?!this.options[this.markedIndex].data("parent")&&this.mainCategoriesDisabled&&!this.options[this.markedIndex].hasClass(this.config.classNames.excludefromdisabled)||(this.selectOption(this.markedIndex),this.options[this.markedIndex].blur(),this.$el.focus(),this.close()):this.accessibleOpen(),e.preventDefault(),e.stopPropagation();break;case n.constants.SPACE:this.opened?!this.options[this.markedIndex].data("parent")&&this.mainCategoriesDisabled&&!this.options[this.markedIndex].hasClass(this.config.classNames.excludefromdisabled)||(this.selectOption(this.markedIndex),this.options[this.markedIndex].blur(),this.$el.focus(),this.close()):this.accessibleOpen(),e.preventDefault(),e.stopPropagation();break;default:this._super(e)}},accessibleOpen:function(){this.open()},_parseOptions:function(){for(var e=0;e<this.$originaloptions.length;e++){var n=this.$originaloptions.eq(e),r=n.data("parent");if(r&&r!==""){var i=this.getParentOptionByIndex(e);this._createSubOption(n,i).appendTo(this.sublist[r])}else this._createOption(n).appendTo(this.$optionlist)}this.$optionlist.children().first().addClass(this.config.classNames.first),this.$optionlist.children().last().addClass(this.config.classNames.last);var o=t(s()).prependTo(this.$optionlist);o.append(this.$optionlist.children(".sf-option")),this.direction==this.LEFT_TO_RIGHT?this.$optionlist.addClass(this.config.classNames.lefttoright):this.$optionlist.addClass(this.config.classNames.righttoleft);for(var u in this.sublist)this.sublist[u].children().first().addClass(this.config.classNames.first),this.sublist[u].children().last().addClass(this.config.classNames.last),this.sublist[u].attr("id",this.cid+"-sublist-"+u),this.sublist[u].data("parent").addClass(this.config.classNames.hassub).attr("aria-haspopup","true").attr("aria-owns",this.cid+"-sublist-"+u),o=t(s()).prependTo(this.sublist[u]),o.append(this.sublist[u].children(".sf-option")),this.direction==this.LEFT_TO_RIGHT?this.sublist[u].addClass(this.config.classNames.lefttoright):this.sublist[u].addClass(this.config.classNames.righttoleft)},_createOption:function(e,r,i,s){var o=this._super(e,null,i,s);r&&r.length>0&&(o.data("parent",r),r.data("children")?r.data("children").push(o):r.data("children",[o]));var u=this;return o.unbind("click"),o.click(function(e){var r=!1;t(this).data("disabled")&&(r=!0),!t(this).data("parent")&&u.mainCategoriesDisabled&&!t(this).hasClass(u.config.classNames.excludefromdisabled)&&(r=!0),n.isTouch()&&!t(this).data("parent")&&u._hoveredOption!==this&&(u._hoveredOption=this,r=!0);if(r){e.preventDefault(),e.stopPropagation();return}u.selectOption(t(this).data("index"))}),o[0].addEventListener&&o[0].addEventListener("touchend",function(e){if(!t(this).data("disabled")){e.stopPropagation(),u.markOptionDelayed(t(this).data("index"));return}}),o.mouseover(function(e){if(!t(this).data("disabled")){e.stopPropagation(),u.markOptionDelayed(t(this).data("index"));return}}),o},_createSubOption:function(e,n){var r=e.data("parent");return this.sublist[r]||(this.sublist[r]=t(i()).appendTo(this.$el),this.sublist[r].data({parent:n,name:r})),this._createOption(e,n,this.sublist[r])},_renderOptionList:function(e){e||(e=this.$optionlist);if(e.data("rendered"))return!1;var n=this.$el.height(),r=this.$el.offset();this.$el.css("overflow","hidden"),e.css({visibility:"hidden",display:"block",height:""});var i=n,s=0,o=e.height(),u=e.width();this.$el.css("overflow",""),e.css({visibility:"",display:""});var a=t(window),f=a.height(),l=a.width(),c={top:0,left:0},h={top:a.scrollTop(),left:a.scrollLeft()},p=this.$el.parent();while(p.css("overflow")!="hidden"&&p.css("overflow")!="scroll"&&p.css("overflow")!="auto"&&p.css("overflow-y")!="hidden"&&p.css("overflow-y")!="scroll"&&p.css("overflow-y")!="auto"&&p.get(0)&&p.get(0).nodeName.toLowerCase()!="body")p=p.parent();if(!p.get(0))return!1;p.get(0).nodeName.toLowerCase()!="body"&&(a=p,f=p.innerHeight(),l=p.innerWidth(),c=p.offset(),h.top=0,h.left=0);var d=this.config.optionListSpacing;f-=d,l-=d;var v={top:r.top+i-c.top-h.top,left:r.left-c.left-h.left},m="hidden",g=this.config.classNames.opened;v.top-i>=o?(i=-o,g+=" "+this.config.classNames.flipped):f-v.top<o&&(f<o&&(o=f,u+=20,m="scroll",g+=" "+this.config.classNames.scroll,e.addClass(this.config.classNames.scroll)),i=-(v.top-i-(f-o)));if(e.data("parent")){var y=e.data("parent"),b=y.data("list"),w=b.width(),E=b.position().left,S=v.left+E+w+u<=l,x=v.left+E-u>=0,T=this,N=function(){v.left+E<=l-v.left-E-w?(T.direction=T.LEFT_TO_RIGHT,s=E+w,u=l-v.left-E-w):(T.direction=T.RIGHT_TO_LEFT,u=v.left+E,s=E-u)},C=function(){T.direction=T.LEFT_TO_RIGHT,s=E+w},k=function(){T.direction=T.RIGHT_TO_LEFT,s=E-u},L=this.config.textDirection;L=="rtl"?x?k():S?C():N():S?C():x?k():N(),this.direction==this.LEFT_TO_RIGHT?(e.addClass(this.config.classNames.lefttoright),b.addClass(this.config.classNames.lefttoright),e.removeClass(this.config.classNames.righttoleft),b.removeClass(this.config.classNames.righttoleft)):(e.addClass(this.config.classNames.righttoleft),b.addClass(this.config.classNames.righttoleft),e.removeClass(this.config.classNames.lefttoright),b.removeClass(this.config.classNames.lefttoright));var A=b.position().top+y.position().top,O=y.outerHeight();i>A?i=A:i+o<A+O&&(i=A+O-o)}this._addOptionListCss(e,{width:u,height:o,top:i,left:s,overflow:m}),e.addClass(this.config.classNames.opened),this.$el.addClass(g),e.data("rendered",!0)},_addOptionListCss:function(e,t){e.css({width:t.width+"px",top:t.top+"px",left:t.left+"px",visibility:"visible",display:"block"}),e.find(".sf-scroller").css({height:t.height+"px",overflow:t.overflow,"overflow-x":"hidden"})},_closeOptionList:function(e){e||(e=this.$optionlist),e.addClass(this.config.classNames.closed),e.removeClass(this.config.classNames.opened),e.css({width:"",top:"",left:"",visibility:"",display:""}),e.find(".sf-scroller").css({height:"",overflow:"","overflow-x":""}),e.data("rendered",!1)},_scrollToOption:function(e){if(!e||!e.data("list"))return;var t=e.data("list").find(".sf-scroller").first(),n=t.height(),r=t.scrollTop(),i=e.position().top,s=e.outerHeight();i+s>n?t.scrollTop(r+(i+s-n)):i<0&&t.scrollTop(r+i)},reinit:function(){for(var e in this.sublist)this.sublist[e].remove(),delete this.sublist[e];this._super()},update:function(){this.$original.hasClass(this.config.classNames.disablemaincategories)&&(this.mainCategoriesDisabled=!0),this._super()},markOption:function(e,t){clearTimeout(this.markTimeout);if(e<0||e>=this.options.length)return;var n=this.options[e],r=n.data("value"),i=this.markedIndex<0?0:this.markedIndex;if(!t){this.markedIndex=e;var s=this.options[i].data("list")==n.data("list"),o=n.data("parent")?n.data("parent").data("index"):-1,u=i==o;u||this.unmarkOption(i,!s&&!u)}n.data("parent")!=null&&this.markOption(n.data("parent").data("index"),!0),n.addClass(this.config.classNames.selected),this._hoveredOption=n,this._scrollToOption(n),this.sublist[r]&&(this.sublist[r].addClass(this.config.classNames.selected),this.opened&&this._renderOptionList(this.sublist[r])),t||(this.$el.blur(),this.options[i].blur(),this.options[this.markedIndex].focus())},markOptionDelayed:function(e,t){clearTimeout(this.markTimeout);if(e==this.markedIndex)return;var n=this;this.markTimeout=setTimeout(function(){n.markOption(e,t)},this.markDelay)},unmarkOption:function(e,t){if(e<0||e>this.options.length||e==this.markedIndex)return;var n=this.options[e],r=n.data("value");n.removeClass(this.config.classNames.selected),n.blur(),this.sublist[r]&&(this.sublist[r].removeClass(this.config.classNames.selected),this._closeOptionList(this.sublist[r])),t&&n.data("parent")!=null&&this.unmarkOption(n.data("parent").data("index"),t)},selectOption:function(e){if(!this.options[e].data("parent")&&this.mainCategoriesDisabled&&!this.options[e].hasClass(this.config.classNames.excludefromdisabled))return;this._super(e)},nextOption:function(){if(this.disabled)return;this.initialized||this._initialize();var e=this.opened?this.markedIndex+1:this.currentIndex+1,t=this.opened?this.options[this.markedIndex].data("list"):this.options[this.currentIndex].data("list");while(e<this.options.length&&(this.options[e].data("disabled")||this.options[e].data("list").get(0)!=t.get(0)))e++;e<this.options.length&&(this.opened?this.markOption(e):this.selectOption(e))},prevOption:function(){if(this.disabled)return;this.initialized||this._initialize();var e=this.opened?this.markedIndex-1:this.currentIndex-1,t=this.opened?this.options[this.markedIndex].data("list"):this.options[this.currentIndex].data("list");while(e>=0&&(this.options[e].data("disabled")||this.options[e].data("list").get(0)!=t.get(0)))e--;e>=0&&(this.opened?this.markOption(e):this.selectOption(e))},childOption:function(){if(this.disabled)return;this.initialized||this._initialize();var e=this.opened?this.options[this.markedIndex]:this.options[this.currentIndex];if(e.data("children")){var t=e.data("children")[0],n=t.data("list"),r=t.data("index");while(r<this.options.length&&(this.options[r].data("disabled")||this.options[r].data("list").get(0)!=n.get(0)))r++;r<this.options.length&&(this.opened?this.markOption(r):this.selectOption(r))}},parentOption:function(){if(this.disabled)return;this.initialized||this._initialize();var e=this.opened?this.options[this.markedIndex]:this.options[this.currentIndex];if(e.data("parent")){var t=e.data("parent"),n=t.data("list"),r=t.data("index");while(r<this.options.length&&(this.options[r].data("disabled")||this.options[r].data("list").get(0)!=n.get(0)))r++;r<this.options.length&&(this.opened?this.markOption(r):this.selectOption(r))}},getParentOptionByIndex:function(e){var t=this.$originaloptions.eq(e).data("parent");for(var n=e-1;n>=0;n--)if(this.options[n].data("value")==t)return this.options[n];return null},enableMainCategories:function(){this.mainCategoriesDisabled=!0,this.$original.addClass(this.config.classNames.disablemaincategories)},disableMainCategories:function(){this.mainCategoriesDisabled=!1,this.$original.removeClass(this.config.classNames.disablemaincategories)},close:function(e){if(!this.opened)return;for(var t in this.sublist)this._closeOptionList(this.sublist[t]);this._closeOptionList(),this.$el.addClass(this.config.classNames.closed),this.$el.removeClass(this.config.classNames.opened),this.$el.removeClass(this.config.classNames.flipped),this.$el.removeClass(this.config.classNames.scroll),this.opened=!1,this.$optionlist.attr("aria-expanded","false"),e||(this.$el.trigger("close"),this.trigger("close"))}},{ID:"sf-reform-multilevel-select",REFORM_ID:"ReForm.MultilevelSelect",SELECTOR:"div.sf-reform-select.sf-reform-multilevel-select",ORIGINAL_SELECTOR:"select",defaults:{classNames:{scroll:"sf-scroll",hassub:"sf-hassub",disablemaincategories:"sf-disablemaincategories",excludefromdisabled:"sf-excludefromdisabled",lefttoright:"sf-ltr",righttoleft:"sf-rtl"},markDelay:150}}),e}),define("hbs!ui/modules/reform/category-select/templates/category-select-button-cancel",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s,o,u=n.helperMissing,a=this.escapeExpression;return o={hash:{text:"common.button.cancel","class":"sf-button-cancel",title:"common.button.cancel",tabindex:"-1"}},a((s=n.button,s?s.call(t,o):u.call(t,"button",o)))});return t.registerPartial("ui_modules_reform_category-select_templates_category-select-button-cancel",n),n}),define("hbs!ui/modules/reform/category-select/templates/category-select-button-confirm",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s,o,u=n.helperMissing,a=this.escapeExpression;return o={hash:{text:"common.button.confirm","class":"sf-button-confirm sf-button-confirm-update",title:"common.button.confirm",tabindex:"-1"}},a((s=n.button,s?s.call(t,o):u.call(t,"button",o)))});return t.registerPartial("ui_modules_reform_category-select_templates_category-select-button-confirm",n),n}),define("hbs!ui/modules/reform/category-select/templates/category-select-button-delete-confirm",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s,o,u=n.helperMissing,a=this.escapeExpression;return o={hash:{text:"common.button.confirm","class":"sf-button-confirm sf-button-delete-confirm",title:"common.button.confirm",tabindex:"-1"}},a((s=n.button,s?s.call(t,o):u.call(t,"button",o)))});return t.registerPartial("ui_modules_reform_category-select_templates_category-select-button-delete-confirm",n),n}),define("hbs!ui/modules/reform/category-select/templates/category-select-button-delete",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s,o,u=n.helperMissing,a=this.escapeExpression;return o={hash:{text:"common.button.delete","class":"sf-button-delete",title:"common.button.delete",tabindex:"-1"}},a((s=n.button,s?s.call(t,o):u.call(t,"button",o)))});return t.registerPartial("ui_modules_reform_category-select_templates_category-select-button-delete",n),n}),define("hbs!ui/modules/reform/category-select/templates/category-select-button-edit",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s,o,u=n.helperMissing,a=this.escapeExpression;return o={hash:{text:"common.button.edit","class":"sf-button-edit",title:"common.button.edit",tabindex:"-1"}},a((s=n.button,s?s.call(t,o):u.call(t,"button",o)))});return t.registerPartial("ui_modules_reform_category-select_templates_category-select-button-edit",n),n}),define("hbs!ui/modules/reform/category-select/templates/category-select-custom-panel",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-add-custom-category sf-category-editor">\n	<div class="sf-add-custom-category-header">',u={hash:{text:"common.button.add","class":"sf-button-add",title:"common.button.add",tabindex:"-1"}},s+=f((o=n.button,o?o.call(t,u):a.call(t,"button",u)))+'</div>\n	<div class="sf-option sf-add-custom-category-body">\n		<form class="custom-category-form sf-tooltip-errors" data-validate="parsley">\n			<div class="sf-form-row">\n				',u={hash:{name:"name","class":"sf-category-label",validateField:"customCategory.name"}},s+=f((o=n.textfield,o?o.call(t,u):a.call(t,"textfield",u)))+"\n				",u={hash:{text:"common.button.confirm","class":"sf-button-confirm",title:"common.button.confirm",tabindex:"-1",type:"submit"}},s+=f((o=n.button,o?o.call(t,u):a.call(t,"button",u)))+"\n				",u={hash:{text:"common.button.cancel","class":"sf-button-cancel",title:"common.button.cancel",tabindex:"-1"}},s+=f((o=n.button,o?o.call(t,u):a.call(t,"button",u)))+"\n			</div>\n		</form>\n	</div>\n</div>",s});return t.registerPartial("ui_modules_reform_category-select_templates_category-select-custom-panel",n),n}),define("hbs!ui/modules/reform/category-select/templates/category-select-option",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression;return s+='<div class="sf-option needsclick" title="',(o=n.label)?o=o.call(t,{hash:{}}):(o=t.label,o=typeof o===u?o.apply(t):o),s+=a(o)+'">\n	<span class="sf-icon-before needsclick"></span>\n	<span class="sf-category-color needsclick" style="background-color:',(o=n.color)?o=o.call(t,{hash:{}}):(o=t.color,o=typeof o===u?o.apply(t):o),s+=a(o)+'"></span>\n	<span class="sf-category-title needsclick">',(o=n.label)?o=o.call(t,{hash:{}}):(o=t.label,o=typeof o===u?o.apply(t):o),s+=a(o)+'</span>\n	<span class="sf-icon-after needsclick"></span>\n</div>',s});return t.registerPartial("ui_modules_reform_category-select_templates_category-select-option",n),n}),define("hbs!ui/modules/reform/category-select/templates/category-select-original-option",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i;return r+='data-parent="',(i=n.parent)?i=i.call(e,{hash:{}}):(i=e.parent,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function c(e,t){var r="",i;return r+='data-color="#',(i=n.color)?i=i.call(e,{hash:{}}):(i=e.color,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=this;s+='<option class="sf-custom" value="',(o=n.id)?o=o.call(t,{hash:{}}):(o=t.id,o=typeof o===u?o.apply(t):o),s+=a(o)+'" ',o=n["if"].call(t,t.parent,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;s+=" ",o=n["if"].call(t,t.color,{hash:{},inverse:f.noop,fn:f.program(3,c,i)});if(o||o===0)s+=o;return s+=">",(o=n.name)?o=o.call(t,{hash:{}}):(o=t.name,o=typeof o===u?o.apply(t):o),s+=a(o)+"</option>",s});return t.registerPartial("ui_modules_reform_category-select_templates_category-select-original-option",n),n}),define("hbs!ui/modules/reform/category-select/templates/category-select-textfield",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<form class="custom-category-form sf-tooltip-errors" data-validate="parsley">\n	<div class="sf-form-row">\n		',u={hash:{"class":"sf-option-field",validateField:"customCategory.name"}},s+=f((o=n.textfield,o?o.call(t,u):a.call(t,"textfield",u)))+"\n	</div>\n</form>",s});return t.registerPartial("ui_modules_reform_category-select_templates_category-select-textfield",n),n}),define("libs/require/css/css!ui/modules/reform/category-select/css/category-select",[],function(){}),define("ui/modules/reform/category-select/category-select-module",["ui/modules/reform/multilevel-select/multilevel-select-module","jQuery","utils/util","hbs!ui/modules/reform/category-select/templates/category-select-button-cancel","hbs!ui/modules/reform/category-select/templates/category-select-button-confirm","hbs!ui/modules/reform/category-select/templates/category-select-button-delete-confirm","hbs!ui/modules/reform/category-select/templates/category-select-button-delete","hbs!ui/modules/reform/category-select/templates/category-select-button-edit","hbs!ui/modules/reform/category-select/templates/category-select-custom-panel","hbs!ui/modules/reform/category-select/templates/category-select-option","hbs!ui/modules/reform/category-select/templates/category-select-original-option","hbs!ui/modules/reform/category-select/templates/category-select-textfield","utils/constants","css!ui/modules/reform/category-select/css/category-select"],function(e,t,n,r,i,s,o,u,a,f,l,c){return e.CategorySelect=e.MultilevelSelect.extend({buttonCancelTmpl:r,buttonConfirmTmpl:i,buttonDeleteConfirmTmpl:s,buttonDeleteTmpl:o,buttonEditTmpl:u,customPanelTmpl:a,optionTmpl:f,textfieldTmpl:c,_initialize:function(){this._excludeSpecialOptions(),this._parseOptions(),this._createCustomPanel(),this.initialized=!0,this.update(),this.$el.trigger("init"),this.trigger("init")},_excludeSpecialOptions:function(){var r=n.where(this.$originaloptions,function(e){return n.indexOf(n.values(this.config.specialOptions),parseInt(t(e).attr("value"),10))!==-1},this);t(r).addClass(e.CategorySelect.defaults.classNames.excludefromdisabled)},_createOption:function(e,t,n,r){var i=this._super(e,t,n,r);return i.hasClass(this.config.classNames.custom)&&this._updateCustomOption(i),i},_renderOption:function(e){return t(this.optionTmpl({label:e.text(),color:e.data("color")}))},_renderOptionList:function(e){if(this._super(e)===!1)return;e||(e=this.$optionlist);if(!n.isMobileBrowser()){var t=e.find(".sf-add-custom-category").first(),r=e.find(".sf-scroller").height()-(t.css("display")!="none"?t.outerHeight():0)+"px";e.find(".sf-scroller").css({height:r})}},_updateCustomOption:function(a,f){function S(e,t,n){l.focused=!0,n&&(n.stopPropagation(),n.preventDefault()),l.onUpdateCategory(e.data("value"),t,function(e,t){l.updateCategory(e,t)})}function x(e,t,n){l.focused=!0,n&&(n.stopPropagation(),n.preventDefault()),e.empty(),l._updateCustomOption(e,t)}var l=this,h=a.data(),p=a.find(".sf-category-color").css("backgroundColor");typeof f!="undefined"&&(p=f),a.html('<span class="sf-category-color" style="background-color:'+p+'"></span><span class="sf-category-title">'+h.text+"</span>"),a.attr("title",h.text),p&&a.find(".sf-category-color").css("background-color",p);var d=t(c()),v=d.find(".sf-form-field"),m=d.find("input"),g=t(u()).appendTo(a),y=t(o()).appendTo(a),b=t(i()),w=t(s()),E=t(r());m.val(h.text),this.$original.hasClass(e.CategorySelect.defaults.classNames.noEditCustomOptions)&&(y.addClass("sf-hidden"),b.addClass("sf-hidden"),w.addClass("sf-hidden"),E.addClass("sf-hidden"),g.addClass("sf-hidden")),g.mousedown(function(){l.focused=!0}),g.click(function(e){l.focused=!0,e&&(e.stopPropagation(),e.preventDefault()),a.empty(),b.appendTo(v),E.appendTo(v),d.prependTo(a),m.focus(function(){l.focused=!0}),m.click(function(e){e.stopPropagation(),e.preventDefault()}),m.blur(function(e){e.stopPropagation(),e.preventDefault(),l._onBlur()}),m.keydown(function(e){switch(e.keyCode){case n.constants.ENTER:S(a,m,e),E.click();break;case n.constants.ESCAPE:x(a,e);break;default:e.stopPropagation()}}),b.mousedown(function(){l.focused=!0}),b.click(function(e){S(a,m,e),E.click()}),E.mousedown(function(){l.focused=!0}),E.click(function(e){x(a,p,e)}),l.trigger("custom:edit",m)}),y.mousedown(function(){l.focused=!0}),this._addDeleteHandler(a,y,g,b,w,E)},_addDeleteHandler:function(e,t,n,r,i,s){var o=this;t.click(function(u){o.focused=!0,u&&(u.stopPropagation(),u.preventDefault());var a=e.find(".sf-category-color").css("background-color");n.remove(),t.remove(),i.appendTo(e),s.appendTo(e),r.mousedown(function(){o.focused=!0}),i.click(function(t){o.focused=!0,t&&(t.stopPropagation(),t.preventDefault()),o.onDeleteCategory(e.data("value"),e.find(".sf-category-title").text(),function(e){o.deleteCategory(e)}),s.click()}),s.mousedown(function(){o.focused=!0}),s.click(function(t){o.focused=!0,t&&(t.stopPropagation(),t.preventDefault()),e.empty(),o._updateCustomOption(e,a)})})},_createCustomPanel:function(){var e=this,r=a();this.$el.find(".sf-sublist").each(function(){function c(t){e.focused=!0,t&&(t.stopPropagation(),t.preventDefault()),u.fadeOut(200,function(){s.fadeIn(200)})}function h(t){e.focused=!0,t&&(t.stopPropagation(),t.preventDefault());var n=a.val(),r=i.data("list").data("name");n!==""&&e.onAddCategory(null,a,r,function(t,n,r,i){e.addCategory(t,n,r,i)})}var i=t(r).appendTo(this);i.data("list",t(this));var s=i.find(".sf-add-custom-category-header"),o=s.find(".sf-button-add"),u=i.find(".sf-add-custom-category-body"),a=u.find(".sf-category-label"),f=u.find(".sf-button-cancel"),l=u.find(".sf-button-confirm");u.hide(0),i.click(function(t){e.focused=!0,t.stopPropagation(),t.preventDefault()}),o.click(function(){s.fadeOut(200,function(){a.val(""),u.fadeIn(200),e.trigger("custom:shown",a)})}),a.focus(function(){e.focused=!0}),a.click(function(t){e.focused=!0,t.stopPropagation(),t.preventDefault()}),a.blur(function(){c(),e._onBlur()}),a.keydown(function(e){switch(e.keyCode){case n.constants.ENTER:h(e);break;case n.constants.ESCAPE:c(e);break;default:e.stopPropagation()}}),f.click(c),l.click(function(n){h(n);var r=function(){e.focused=!0};t(n.currentTarget).closest(".sf-reform-select").one("blur",r)})})},reinit:function(){this._super(),this._createCustomPanel()},onAddCategory:function(e,t,n,r){var i=t.val();i=this.sanitizeCategoryName(i);if(i==="")return;e=i,typeof r=="function"&&r(e,i,n)},onUpdateCategory:function(e,t,n){typeof n=="function"&&n(e,name)},onDeleteCategory:function(e,t,n){typeof n=="function"&&n(e)},addCategory:function(e,n,r,i){var s=this.$original.find("option").last(),o;r!=null&&r!==""?(s=this.$original.find("option[data-parent="+r+"]").last(),s.length>0?s.val()==s.next().data("parent")&&(s=this.$original.find("option[data-parent="+s.val()+"]").last()):s=this.$original.find("option[value="+r+"]").last()):r="",o=l({id:e,parent:r,color:i,name:n}),t(o).insertAfter(s),this.reinit(),this.markOption(s.index()+1)},updateCategory:function(e,t){if(!this.initialized)this.$originaloptions.filter('[value="'+e+'"]').text(t);else{var n=this.getOptionByValue(e);if(!n){console.log("CustomCategorySelect.updateCategory()... updated id: %s with name: %s",e,t);return}this.$originaloptions.eq(n.data("index")).text(t),n.data("text",t),this._updateCustomOption(n)}this._reflect()},deleteCategory:function(e){this.$originaloptions.filter('[value="'+e+'"]').remove(),this.reinit()},sanitizeCategoryName:function(e){var t=/<.*?>/g,n=/<script.*?>.*?<\/script>/g,r=/<style.*?>.*?<\/style>/g;return e=e.replace(n,""),e=e.replace(r,""),e=e.replace(t,""),e}},{ID:"sf-reform-category-select",REFORM_ID:"ReForm.CategorySelect",SELECTOR:"div.sf-reform-select.sf-reform-multilevel-select.sf-reform-category-select",ORIGINAL_SELECTOR:"select",defaults:{classNames:{custom:"sf-custom",disablecustomedition:"sf-disablecustomedition",noEditCustomOptions:"sf-no-edit-custom-options"},specialOptions:{UNCATEGORIZED:0,ALL_OPTIONS:-1}}}),e}),define("utils/helpers/ui/reform/category-select-helper",["Handlebars","hbs!ui/modules/reform/select/templates/select","ui/modules/reform/category-select/category-select-module","utils/util","utils/handlebars-goodies","ui/modules/reform/multilevel-select/multilevel-select-module"],function(e,t,n,r){e.registerHelper("categorySelect",function(i){var s=r.extend({},i.hash),o=r.handlebarsGoodies.transformDataAttr(s),u;return o["class"]=n.CategorySelect.ID+" "+n.MultilevelSelect.ID+" "+o["class"],u=t(o),new e.SafeString(u)})}),define("hbs!ui/modules/reform/checkbox/templates/checkbox",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i;return r+=" ",(i=n["class"])?i=i.call(e,{hash:{}}):(i=e["class"],i=typeof i===f?i.apply(e):i),r+=l(i),r}function d(e,t){var r="",i;return r+='id="',(i=n.id)?i=i.call(e,{hash:{}}):(i=e.id,i=typeof i===f?i.apply(e):i),r+=l(i)+'"',r}function v(e,t){var r="",i;return r+=' class="',(i=n["class"])?i=i.call(e,{hash:{}}):(i=e["class"],i=typeof i===f?i.apply(e):i),r+=l(i)+'"',r}function m(e,t){var r="",i;return r+=' name="',(i=n.name)?i=i.call(e,{hash:{}}):(i=e.name,i=typeof i===f?i.apply(e):i),r+=l(i)+'"',r}function g(e,t){var r="",i;return r+=" ",(i=n.name)?i=i.call(e,{hash:{}}):(i=e.name,i=typeof i===f?i.apply(e):i),r+=l(i)+'="',(i=n.value)?i=i.call(e,{hash:{}}):(i=e.value,i=typeof i===f?i.apply(e):i),r+=l(i)+'"',r}function y(e,t){var r;return(r=n.tabindex)?r=r.call(e,{hash:{}}):(r=e.tabindex,r=typeof r===f?r.apply(e):r),l(r)}function b(e,t){return"0"}function w(e,t){return' disabled="disabled"'}function E(e,t){var r="",i;return r+=' labelledby="',(i=n.labelledby)?i=i.call(e,{hash:{}}):(i=e.labelledby,i=typeof i===f?i.apply(e):i),r+=l(i)+'"',r}function S(e,t){var r="",i;return r+=' value="',(i=n.value)?i=i.call(e,{hash:{}}):(i=e.value,i=typeof i===f?i.apply(e):i),r+=l(i)+'"',r}function x(e,t){return' aria-required="true"'}function T(e,t){var r="",i;return r+=' aria-label="',(i=n.ariaLabel)?i=i.call(e,{hash:{}}):(i=e.ariaLabel,i=typeof i===f?i.apply(e):i),r+=l(i)+'"',r}function N(e,t){var r="",i,s;return r+=" ",s={hash:{}},r+=l((i=n.validator,i?i.call(e,e.validateField,s):c.call(e,"validator",e.validateField,s))),r}function C(e,t){return" checked"}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;s+='<span class="sf-form-field">\n	<div class="sf-reform-checkbox',o=n["if"].call(t,t["class"],{hash:{},inverse:h.noop,fn:h.program(1,p,i)});if(o||o===0)s+=o;s+='" role="checkbox" tabindex="0">\n		<input ',o=n["if"].call(t,t.id,{hash:{},inverse:h.noop,fn:h.program(3,d,i)});if(o||o===0)s+=o;s+="\n		",o=n["if"].call(t,t["class"],{hash:{},inverse:h.noop,fn:h.program(5,v,i)});if(o||o===0)s+=o;s+="\n		",o=n["if"].call(t,t.name,{hash:{},inverse:h.noop,fn:h.program(7,m,i)});if(o||o===0)s+=o;s+="\n		",o=n.each.call(t,t.data,{hash:{},inverse:h.noop,fn:h.program(9,g,i)});if(o||o===0)s+=o;s+='\n		 type="checkbox"\n		 tabindex="',o=n["if"].call(t,t.tabindex,{hash:{},inverse:h.program(13,b,i),fn:h.program(11,y,i)});if(o||o===0)s+=o;s+='"\n		 ',o=n["if"].call(t,t.disabled,{hash:{},inverse:h.noop,fn:h.program(15,w,i)});if(o||o===0)s+=o;s+="\n		",o=n["if"].call(t,t.labelledby,{hash:{},inverse:h.noop,fn:h.program(17,E,i)});if(o||o===0)s+=o;s+="\n		",a={hash:{},inverse:h.noop,fn:h.program(19,S,i)},u=(o=n.ifdef,o?o.call(t,t.value,a):c.call(t,"ifdef",t.value,a));if(u||u===0)s+=u;s+="\n		",u=n["if"].call(t,t.ariaRequired,{hash:{},inverse:h.noop,fn:h.program(21,x,i)});if(u||u===0)s+=u;s+="\n		",u=n["if"].call(t,t.ariaLabel,{hash:{},inverse:h.noop,fn:h.program(23,T,i)});if(u||u===0)s+=u;s+="\n		",u=n["if"].call(t,t.validateField,{hash:{},inverse:h.noop,fn:h.program(25,N,i)});if(u||u===0)s+=u;s+="\n		 ",u=n["if"].call(t,t.checked,{hash:{},inverse:h.noop,fn:h.program(27,C,i)});if(u||u===0)s+=u;return s+="/>\n	</div>\n</span>",s});return t.registerPartial("ui_modules_reform_checkbox_templates_checkbox",n),n}),define("utils/helpers/ui/reform/checkbox-helper",["Handlebars","hbs!ui/modules/reform/checkbox/templates/checkbox","utils/util","utils/handlebars-goodies"],function(e,t,n){e.registerHelper("checkbox",function(r){var i=n.extend({},r.hash),s=n.handlebarsGoodies.transformDataAttr(i),o;return o=t(s),new e.SafeString(o)})}),define("hbs!ui/modules/reform/radio/templates/radio",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){var r="",i;return r+=" ",(i=n["class"])?i=i.call(e,{hash:{}}):(i=e["class"],i=typeof i===u?i.apply(e):i),r+=a(i),r}function h(e,t){var r="",i;return r+='id="',(i=n.id)?i=i.call(e,{hash:{}}):(i=e.id,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function p(e,t){var r="",i;return r+=' class="',(i=n["class"])?i=i.call(e,{hash:{}}):(i=e["class"],i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function d(e,t){var r="",i;return r+=' name="',(i=n.name)?i=i.call(e,{hash:{}}):(i=e.name,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function v(e,t){var r="",i;return r+=' value="',(i=n.value)?i=i.call(e,{hash:{}}):(i=e.value,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function m(e,t){var r="",i;return r+=" ",(i=n.name)?i=i.call(e,{hash:{}}):(i=e.name,i=typeof i===u?i.apply(e):i),r+=a(i)+'="',(i=n.value)?i=i.call(e,{hash:{}}):(i=e.value,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function g(e,t){var r;return(r=n.tabindex)?r=r.call(e,{hash:{}}):(r=e.tabindex,r=typeof r===u?r.apply(e):r),a(r)}function y(e,t){return"0"}function b(e,t){return' disabled="disabled"'}function w(e,t){var r="",i;return r+=' labelledby="',(i=n.labelledby)?i=i.call(e,{hash:{}}):(i=e.labelledby,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function E(e,t){return' aria-required="true"'}function S(e,t){var r="",i;return r+=' aria-label="',(i=n.ariaLabel)?i=i.call(e,{hash:{}}):(i=e.ariaLabel,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function x(e,t){var r="",i,s;return r+=" ",s={hash:{}},r+=a((i=n.validator,i?i.call(e,e.validateField,s):f.call(e,"validator",e.validateField,s))),r}function T(e,t){return" checked"}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=n.helperMissing,l=this;s+='<span class="sf-form-field">\n	<div class="sf-reform-radio',o=n["if"].call(t,t["class"],{hash:{},inverse:l.noop,fn:l.program(1,c,i)});if(o||o===0)s+=o;s+='" role="radio" tabindex="0">\n		<input ',o=n["if"].call(t,t.id,{hash:{},inverse:l.noop,fn:l.program(3,h,i)});if(o||o===0)s+=o;s+="\n		",o=n["if"].call(t,t["class"],{hash:{},inverse:l.noop,fn:l.program(5,p,i)});if(o||o===0)s+=o;s+="\n		",o=n["if"].call(t,t.name,{hash:{},inverse:l.noop,fn:l.program(7,d,i)});if(o||o===0)s+=o;s+="\n		",o=n["if"].call(t,t.value,{hash:{},inverse:l.noop,fn:l.program(9,v,i)});if(o||o===0)s+=o;s+="\n		",o=n.each.call(t,t.data,{hash:{},inverse:l.noop,fn:l.program(11,m,i)});if(o||o===0)s+=o;s+='\n		 type="radio"\n		 tabindex="',o=n["if"].call(t,t.tabindex,{hash:{},inverse:l.program(15,y,i),fn:l.program(13,g,i)});if(o||o===0)s+=o;s+='"\n		 ',o=n["if"].call(t,t.disabled,{hash:{},inverse:l.noop,fn:l.program(17,b,i)});if(o||o===0)s+=o;s+="\n		",o=n["if"].call(t,t.labelledby,{hash:{},inverse:l.noop,fn:l.program(19,w,i)});if(o||o===0)s+=o;s+="\n		",o=n["if"].call(t,t.ariaRequired,{hash:{},inverse:l.noop,fn:l.program(21,E,i)});if(o||o===0)s+=o;s+="\n		",o=n["if"].call(t,t.ariaLabel,{hash:{},inverse:l.noop,fn:l.program(23,S,i)});if(o||o===0)s+=o;s+="\n		",o=n["if"].call(t,t.validateField,{hash:{},inverse:l.noop,fn:l.program(25,x,i)});if(o||o===0)s+=o;s+="\n		 ",o=n["if"].call(t,t.checked,{hash:{},inverse:l.noop,fn:l.program(27,T,i)});if(o||o===0)s+=o;return s+="/>\n	</div>\n</span>",s});return t.registerPartial("ui_modules_reform_radio_templates_radio",n),n}),define("utils/helpers/ui/reform/radio-helper",["Handlebars","hbs!ui/modules/reform/radio/templates/radio","utils/util","utils/handlebars-goodies"],function(e,t,n){e.registerHelper("radio",function(r){var i=n.extend({},r.hash),s=n.handlebarsGoodies.transformDataAttr(i),o;return o=t(s),new e.SafeString(o)})}),define("utils/helpers/format/format-amount-helper",["Handlebars","utils/amount"],function(e,t){e.registerHelper("formatAmount",function(n,r){var i=t.amount.format(n,r.hash.showDecimals,r.hash.curr,r.hash.systemCurrency,r.hash.showGrouping,r.hash.numberFormat);return r.hash.noTag?i:new e.SafeString('<span class="sf-amount">'+i+"</span>")})}),define("utils/helpers/format/format-number-helper",["Handlebars","utils/number"],function(e,t){e.registerHelper("formatNumber",function(e,n){return e?t.number.format(e,n.hash.showDecimals,n.hash.showGrouping,n.hash.numberFormat):""})}),define("utils/helpers/format/format-percentage-helper",["Handlebars","utils/percentage"],function(e,t){e.registerHelper("formatPercentage",function(e,n){return t.percentage.format(e,n.hash.showDecimals,n.hash.numberFormat)})}),define("utils/helpers/format/format-date-helper",["Handlebars","utils/date"],function(e,t){e.registerHelper("formatDate",function(e,n){return t.date.format(e,n)})}),define("utils/helpers/format/format-nice-date-helper",["Handlebars","utils/util","utils/date"],function(e,t){e.registerHelper("formatNiceDate",function(e,n){var r=n.hash.comparedWith||new Date;return t.isString(e)&&(e=new Date(e),t.isDate(e)||(e=new Date)),t.isString(r)&&(r=new Date(r),t.isDate(r)||(r=new Date)),t.date.formatNice(e,r)})}),define("utils/helpers/misc/partial-helper",["Handlebars","utils/util"],function(e,t){e.registerHelper("partial",function(e){var n=t.extend({},this,e.hash);return e.fn(n)})}),define("utils/helpers/misc/validator-helper",["Handlebars","utils/util","utils/validator","utils/handlebars-goodies"],function(e,t){e.registerHelper("validator",function(n){var r=t.validator.getRules(n),i=e.compile(' {{#each data}}data-{{rule}}="{{value}}" {{/each}}'),s,o;return r?(s=t.map(r,function(e,n){return{rule:n,value:t.handlebarsGoodies.toString(e)}}),o=i({data:s}),new e.SafeString(o)):""})}),define("utils/helpers/misc/is-touch-helper",["Handlebars","utils/util"],function(e,t){e.registerHelper("if_istouch",function(e){return t.isMobileBrowser()||t.isTouch()?e.fn(this):e.inverse(this)})}),define("utils/helpers/misc/is-phone-helper",["Handlebars","utils/util"],function(e,t){e.registerHelper("if_isphone",function(e){return t.isPhone()?e.fn(this):e.inverse(this)})}),define("utils/helpers/misc/less1-helper",["Handlebars","utils/util"],function(e,t){e.registerHelper("less1",function(e,t){return parseInt(e)-1})}),define("utils/helpers/helpers",["Handlebars","libs/handlebars/helpers-nested/helpers.nested","utils/helpers/flux-control/ifequal-helper","utils/helpers/flux-control/ifnequal-helper","utils/helpers/flux-control/ifdef-helper","utils/helpers/flux-control/log-helper","utils/helpers/flux-control/iter-helper","utils/helpers/flux-control/at-least-helper","utils/helpers/flux-control/ifnull-helper","utils/helpers/ui/datepicker-helper","utils/helpers/ui/dropdown-helper","utils/helpers/ui/pagination-helper","utils/helpers/ui/empty/empty-helper","utils/helpers/ui/accessible-switch/accessible-switch-helper","utils/helpers/ui/button/button-helper","utils/helpers/ui/header/header-helper","utils/helpers/ui/progressbar/progressbar-helper","utils/helpers/ui/progressbar-mobile/progressbar-mobile-helper","utils/helpers/ui/summary-box/summary-box-helper","utils/helpers/ui/textfield/textfield-helper","utils/helpers/ui/reform/select-helper","utils/helpers/ui/reform/category-select-helper","utils/helpers/ui/reform/checkbox-helper","utils/helpers/ui/reform/radio-helper","utils/helpers/format/format-amount-helper","utils/helpers/format/format-number-helper","utils/helpers/format/format-percentage-helper","utils/helpers/format/format-date-helper","utils/helpers/format/format-nice-date-helper","utils/helpers/format/t-helper","utils/helpers/misc/partial-helper","utils/helpers/misc/validator-helper","utils/helpers/misc/is-touch-helper","utils/helpers/misc/is-phone-helper","utils/helpers/misc/less1-helper"],function(e){return e}),define("hbs!modules/settings/templates/language",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div>\n	<form class="sf-settings-language-form sf-clearfix">\n		<div class="sf-settings-language-title">\n			<span>',u={hash:{}},s+=f((o=n.t,o?o.call(t,"settings.languageTitle",u):a.call(t,"t","settings.languageTitle",u)))+'</span>\n		</div>\n		<fieldset>\n			<label for="name">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"settings.languageLabel",u):a.call(t,"t","settings.languageLabel",u)))+"</label>\n			",u={hash:{name:"language",options:"{{languageOptions}}",currentOption:"{{currentOption}}"}},s+=f((o=n.select,o?o.call(t,u):a.call(t,"select",u)))+"\n		</fieldset>\n		",u={hash:{type:"submit","class":"sf-button-save sf-button-save-language",text:"common.button.save"}},s+=f((o=n.button,o?o.call(t,u):a.call(t,"button",u)))+"\n	</form>\n</div>",s});return t.registerPartial("modules_settings_templates_language",n),n}),define("modules/settings/views/language-view",["classes/item-view","services/profile-service","ui/modules/reform/select/select-module","utils/util","hbs!modules/settings/templates/language","utils/locale"],function(e,t,n,r,i){var s=e.extend({template:i,events:{"submit .sf-settings-language-form":"_changeLanguage"},initialize:function(){this._super.apply(this,arguments),this.profileService=t.getInstance()},onRender:function(){n.init(this.$el)},serializeData:function(){var e=r.locale.id.split("_");return{languageOptions:[{name:"English",value:"en"},{name:"Español",value:"es"}],currentOption:e&&e.length>1?e[1].toLowerCase():"en"}},_changeLanguage:function(){var e=this.$("select[name=language]").val();return r.when(this.profileService.changeLanguage({settings:{language:e}})).done(function(){location.reload()}),!1}});return s}),define("data/accounts/entity-model",["classes/model","utils/util"],function(e,t){var n=e.extend({updateAccount:function(e){var n=t.config.getGlobals().environment.contextPath+"/manualaccounts/update.action";return t.ajax({data:t.param(e),url:n,type:"POST",wait:!0})},deleteAccount:function(e){var n=t.config.getGlobals().environment.contextPath+"/manualaccounts/delete.action";return t.ajax({data:t.param(e),url:n,type:"POST",wait:!0})},createManualAccount:function(e){var n=t.config.getGlobals().environment.contextPath+"/manualaccounts/create.action";return t.ajax({data:t.param(e),url:n,type:"POST",wait:!0})},cancelManualAccount:function(e){var n=t.config.getGlobals().environment.contextPath+"/manualaccounts/file/cancel.action";return t.ajax({data:t.param(e),url:n,type:"POST",wait:!0})},saveFileMapping:function(e){var n=t.config.getGlobals().environment.contextPath+"/manualaccounts/file/mapping.action";return t.ajax({data:t.param(e),url:n,type:"POST",wait:!0})}});return n}),define("data/accounts/account-model",["classes/model","utils/util"],function(e){var t=e.extend({idAttribute:"accountPK",parse:function(e){var t=this._super(e);return t.type!==undefined&&t.id!==undefined&&(t.accountPK=t.type+"-"+t.id),t}});return t}),define("data/accounts/account-collection",["classes/collection","data/accounts/account-model"],function(e,t){var n=e.extend({model:t});return n}),define("data/accounts/entity-collection",["classes/collection","data/accounts/entity-model","data/accounts/account-model","data/accounts/account-collection","classes/remote-error","utils/util","utils/config"],function(e,t,n,r,i,s){var o=e.extend({model:t,url:"/accounts/get/all.action",set:function(t,n){var r=e.prototype.set.apply(this,[t,n]);return this._parseEntities(r)},saveSelection:function(e){console.log("[EntityCollection] Saving new account selection");var t={grouping:e.grouping},n=new s.Deferred;return this.each(function(n,r){var i=n.get("accounts"),o="userconnections["+r+"].";i.each(function(n,r){var i="accounts["+r+"].",u=s.contains(e.selection.selected,n.get("accountPK"));n.set("viewFilter",u),t[o+i+"id"]=n.get("id"),t[o+i+"type"]=n.get("type"),t[o+i+"viewFilter"]=u},this)},this),s.ajax({url:s.config.getGlobals().environment.contextPath+"/accounts/updateAccountFilter.action",type:"POST",data:s.param(t)}).done(function(e){n.resolve(e)}).fail(function(e){n.reject(new i(e))}),n},parse:function(e){var t=e.entities;return t!==undefined?(s.each(t,function(e){e.id=e.userConnection.id,e.alias=e.userConnection.alias,e.cash=e.userConnection.cash,e.manual=e.userConnection.manual,e.lastupdate=e.userConnection.lastupdate,e.accounts=e.userConnection.accounts}),t):e},_parseEntities:function(e){return this.hash={},s.each(e.models,function(e){var t=e.get("accounts");s.each(t,function(e,t){e.cash=this.entity.get("cash"),e[t]=new n(e,{parse:!0}),this.hash[e[t].get("accountPK")]=e[t]},{hash:this.hash,entity:e});var i=new r(t);e.set("accounts",i,{silent:!0}),e.get("userConnection").accounts=i.models,s.each(i.models,function(e){for(var t in e.attributes)e.attributes.hasOwnProperty(t)&&(e[t]=e.attributes[t])})},this),e}});return o}),define("data/accounts/institution-model",["classes/model"],function(e){var t=e.extend({parse:function(e){var t=this._super(e);return t}});return t}),define("data/accounts/institution-collection",["classes/collection","data/accounts/institution-model"],function(e,t){var n=e.extend({model:t,url:"/entities/get/all.action?type=1"});return n}),define("data/accounts/accounts-data-manager",["classes/data-manager","classes/remote-error","data/accounts/entity-collection","data/accounts/institution-collection","data/accounts/entity-model","utils/util"],function(e,t,n,r,i,s){var o=e.extend({initialize:function(){this._super.apply(this,arguments),this.collectionDefs={accounts:{type:n,subscriptions:["account:add","account:change","account:delete","account:update","account:save","transaction:add"]},institutions:{type:r}}},get:function(e){return this.getCollection("accounts",{force:e})},changeDefaultAccounts:function(e){var t=this,n=new s.Deferred;return s.when(this.get()).done(function(r){s.when(r.saveSelection(e)).done(function(){n.resolve(r),t.publish("account:save")}).fail(function(e){console.error("[AccountsService] Error saving account selection",e),n.reject(e)})}).fail(function(e){console.error("[AccountsService] Error saving account selection",e),n.reject(e)}),n},getInstitutions:function(e){return this.getCollection("institutions",{force:e})},updateAccount:function(e){var n=this,r=new i,o=new s.Deferred;return s.when(r.updateAccount(e)).done(function(e){o.resolve(e),n.publish("account:change")}).fail(function(e){o.fail(e),o.reject(new t(e))}),o},deleteAccount:function(e){var n=this,r=new i,o=new s.Deferred;return s.when(r.deleteAccount(e)).done(function(e){o.resolve(e),n.publish("account:delete")}).fail(function(e){o.fail(e),o.reject(new t(e))}),o},cancelManualAccount:function(e){var n=this,r=new i,o=new s.Deferred;return s.when(r.cancelManualAccount(e)).done(function(e){o.resolve(e),n.publish("account:cancel")}).fail(function(e){o.fail(e),o.reject(new t(e))}),o},saveFileMapping:function(e){var n=this,r=new i,o=new s.Deferred;return s.when(r.saveFileMapping(e)).done(function(e){o.resolve(e),n.publish("account:update")}).fail(function(e){o.fail(e),o.reject(new t(e))}),o},createManualAccount:function(e){var n=this,r=new i,o=new s.Deferred;return s.when(r.createManualAccount(e)).done(function(e){o.resolve(e),n.publish("account:add")}).fail(function(e){o.fail(e),o.reject(new t(e))}),o}},{events:{ACCOUNTS_UPDATE:"account:update"}});return o}),define("services/accounts-service",["classes/service","utils/util","data/accounts/accounts-data-manager","classes/resource-loader","utils/validator"],function(e,t,n,r){function i(e,t,n){this.key=e,this.groupName=t,this.elements=n,this.selected=!0;for(var r=0;r<this.elements.length;r++)if(!this.elements[r].viewFilter){this.selected=!1;break}}var s=e.extend({initialize:function(){this._super.apply(this,arguments),this.accountsDM=n.getInstance(),this.resources={entities:new r(this.accountsDM,this.accountsDM.get)}},get:function(){return this.accountsDM.get()},getInstitutions:function(){return this.accountsDM.getInstitutions()},updateAccount:function(e){return this.accountsDM.updateAccount(e)},deleteAccount:function(e){return this.accountsDM.deleteAccount(e)},saveFileMapping:function(e){return this.accountsDM.saveFileMapping(e)},createManualAccount:function(e){return this.accountsDM.createManualAccount(e)},cancelManualAccount:function(e){return this.accountsDM.cancelManualAccount(e)},getAccountList:function(e){var t=function(){return this._groupAccounts(this.resources.entities.data,e)};return this.executeJob(this,t,[this.resources.entities])},saveAccountSelection:function(e){return this.accountsDM.changeDefaultAccounts(e).promise()},getAccountsSelectionTotals:function(e,n){var r=0,i=0;return n?(r=t.size(n.selected),i=t.size(n.unselected)):t.each(e,function(e){t.each(e.elements,function(e){e.viewFilter?r++:i++})}),{selected:r,unselected:i,total:r+i}},getCashAccount:function(){var e=new t.Deferred;return t.when(this.accountsDM.get()).done(function(n){var r=t.find(n.hash,function(e){return e.get("type")===s.ACC_TYPE_CASH});e.resolve(r)}).fail(function(t){console.error("[AccountsService] Error retrieving cash account",t),e.reject(t)}),e.promise()},getManualAccount:function(){var e=new t.Deferred;return t.when(this.accountsDM.get()).done(function(n){var r=t.find(n.hash,function(e){return e.get("id")===s.ACC_ID_MANUAL});e.resolve(r)}).fail(function(t){console.error("[AccountsService] Error retrieving cash account",t),e.reject(t)}),e.promise()},_groupAccounts:function(e,t){var n=[];return t===undefined&&e.length>0&&(t=e.at(0).get("grouping")),t===undefined&&(t=s.PRODUCT_GROUPING),t+="",t===s.PRODUCT_GROUPING?n=this._groupByProduct(e):t===s.ENTITY_GROUPING&&(n=this._groupByEntity(e)),{accounts:n,grouping:t}},_groupByProduct:function(e){var n={};return e.each(function(e){e.get("accounts").each(function(e){var t=e.get("type");n[t]=n[t]||{label:e.get("typeDesc"),entries:[]},n[t].entries.push(e.toJSON())})}),t.map(n,function(e,t){return new i(t,e.label,e.entries)})},_groupByEntity:function(e){var n={};return e.each(function(e){e.get("accounts").each(function(t){var r=e.get("id")+"-"+e.get("etyId");n[r]=n[r]||{label:e.get("alias"),entries:[]},n[r].entries.push(t.toJSON())})}),t.map(n,function(e,t){return new i(t,e.label,e.entries)})}},{ID:"accounts-service",PRODUCT_GROUPING:"0",ENTITY_GROUPING:"1",ACC_TYPE_CASH:7,ACC_TYPE_CCARD:1,ACC_ID_MANUAL:4,defaults:{validator:{rules:{account:{"account-alias":{required:!0,rangelength:[2,50],notinlist:"alias",type:"alias"},number:{required:!0,type:"number"},upload:{required:!0}}}}}});return s.AccountsListPO=i,s}),define("classes/composite-view",["marionette","utils/util","classes/extensions/context-hub","classes/extensions/context-config"],function(e,t,n,r){var i=e.CompositeView.extend(t.extend({},n,r,{buildItemView:function(e,n,r){var i=t.extend({},this.options,{model:e},r);return new n(i)}}));return i}),define("hbs!modules/accounts-accordion/templates/account",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){var r="",i,s;return r+='\n        <input type="hidden" name="accId" value="',(i=n.accId)?i=i.call(e,{hash:{}}):(i=e.accId,i=typeof i===u?i.apply(e):i),r+=a(i)+'" />\n        <input type="hidden" name="accType" value="',(i=n.accType)?i=i.call(e,{hash:{}}):(i=e.accType,i=typeof i===u?i.apply(e):i),r+=a(i)+'" />\n        <input type="hidden" name="currency" value="',(i=n.currency)?i=i.call(e,{hash:{}}):(i=e.currency,i=typeof i===u?i.apply(e):i),r+=a(i)+'"/>\n        <form class="sf-edit-account-form sf-clearfix" data-parsley-validate>\n			<div class="sf-account-name-label sf-label-wrap">\n				<span class="sf-account-name">',(i=n.accountName)?i=i.call(e,{hash:{}}):(i=e.accountName,i=typeof i===u?i.apply(e):i),r+=a(i)+'</span>\n				<span class="sf-edit-icon sf-icon"></span>\n			</div>\n			<div class="sf-account-name-field sf-field-wrap sf-form-row">\n				',s={hash:{name:"alias","class":"sf-edit-account-name",value:"{{accountName}}",dataAlias:"",validateField:"account.account-alias"}},r+=a((i=n.textfield,i?i.call(e,s):f.call(e,"textfield",s)))+'\n				<span class="sf-cancel-button sf-icon"></span>\n				<span class="sf-save-button sf-icon"></span>\n			</div>\n			<div class="sf-account-balance-label sf-label-wrap">\n				<span class="sf-edit-icon sf-icon"></span>\n				<span class="sf-account-balance">',s={hash:{curr:e.currency}},r+=a((i=n.formatAmount,i?i.call(e,e.amount,s):f.call(e,"formatAmount",e.amount,s)))+'</span>\n			</div>\n			<div class="sf-account-balance-field sf-field-wrap sf-form-row">\n				',s={hash:{name:"balance","class":"sf-edit-account-balance",value:"{{{amount}}}",validateField:"account.number"}},r+=a((i=n.textfield,i?i.call(e,s):f.call(e,"textfield",s)))+'\n				<span class="sf-cancel-button sf-icon"></span>\n				<span class="sf-save-button sf-icon"></span>\n			</div>\n			<div class="sf-account-buttons">\n				',s={hash:{"class":"sf-remove-account sf-button-delete",type:"button",text:"accounts-accordion.deleteAccount",title:"accounts-accordion.deleteAccountTitle"}},r+=a((i=n.button,i?i.call(e,s):f.call(e,"button",s)))+"\n				",s={hash:{"class":"sf-import-data sf-call-for-action",type:"button",text:"accounts-accordion.importData",title:"accounts-accordion.importDataTitle"}},r+=a((i=n.button,i?i.call(e,s):f.call(e,"button",s)))+"\n				",s={hash:{"class":"sf-submit-edit-form",type:"button",text:""}},r+=a((i=n.button,i?i.call(e,s):f.call(e,"button",s)))+"\n				",s={hash:{"class":"sf-add-transaction",type:"button",text:"accounts.addTransactionButton"}},r+=a((i=n.button,i?i.call(e,s):f.call(e,"button",s)))+"\n			</div>\n		</form>\n	",r}function h(e,t){var r="",i,s,o;r+='\n		<div class="sf-account-labels">\n			<span class="sf-account-name">',(i=n.accountName)?i=i.call(e,{hash:{}}):(i=e.accountName,i=typeof i===u?i.apply(e):i),r+=a(i)+'</span>\n			<span class="sf-account-amount">',o={hash:{curr:e.currency}},r+=a((i=n.formatAmount,i?i.call(e,e.amount,o):f.call(e,"formatAmount",e.amount,o)))+"</span>\n		</div>\n		",s=n["if"].call(e,e.cashAccount,{hash:{},inverse:l.noop,fn:l.program(4,p,t)});if(s||s===0)r+=s;return r+="\n	",r}function p(e,t){var r="",i,s;return r+='\n			<div class="sf-form-row">\n				<div class="sf-account-buttons">\n					',s={hash:{"class":"sf-add-transaction",text:"accounts.addTransactionButton"}},r+=a((i=n.button,i?i.call(e,s):f.call(e,"button",s)))+"\n				</div>\n            </div>\n		",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=n.helperMissing,l=this;s+='<li class="sf-account sf-clearfix">\n	',o=n["if"].call(t,t.manualAccount,{hash:{},inverse:l.program(3,h,i),fn:l.program(1,c,i)});if(o||o===0)s+=o;return s+="\n</li>",s});return t.registerPartial("modules_accounts-accordion_templates_account",n),n}),define("modules/accounts-accordion/views/account-view",["classes/item-view","classes/reform","services/accounts-service","ui/modules/popup/popup-module","utils/util","hbs!modules/accounts-accordion/templates/account"],function(e,t,n,r,i,s){var o=e.extend({template:s,events:{"click .sf-account-balance-label":"_showAccountEditForm","click .sf-account-name-label":"_showAccountEditForm","submit .sf-edit-account-form":"_saveAccountEditForm","click .sf-save-button":"_saveAccountEditForm","click .sf-cancel-button":"_cancelAccountEditForm","keyup .sf-account-name-field":"_onKeyUp","keyup .sf-account-balance-field":"_onKeyUp","click .sf-remove-account":"_deleteAccount","click .sf-import-data":"_importFile"},ui:{$form:".sf-edit-account-form"},initialize:function(e){this._super.apply(this,arguments),this.uscId=e.uscId,this.accountsService=n.getInstance()},render:function(){this._super(),t.init(),i.validator.validate(this.ui.$form)},serializeData:function(){return{accountName:this.model.get("alias"),amount:this.model.get("balance"),currency:this.model.get("currency"),accType:this.model.get("type"),accId:this.model.get("id"),manualAccount:this.model.get("linkedToCash")||!1,cashAccount:this.model.get("type")==n.ACC_TYPE_CASH}},_showAccountEditForm:function(e){this.$(".sf-field-wrap").hide(),this.$(".sf-label-wrap").show(),this.$(e.currentTarget).hide().next().show()},_saveAccountEditForm:function(e){var t=this,n=i.trim(t.$(".sf-account-name-field input").val()),r=i.trim(t.$(".sf-account-balance-field input").val()),s={alias:n,balance:r,uscId:this.uscId};return this.$(e.currentTarget).closest("form").data("parsleyForm").validate()?(this.publish("account:before:changed",this.$el.closest(".sf-entity").data("id")),i.mask(this.$el,i.MASK_LOADING),i.when(this.accountsService.updateAccount(s)).done(function(){i.unmask(t.$el)}).fail(function(e){console.error("Error while updating accounts ",e),t._createManualAccountError(e),i.unmask(t.$el)}),!1):!1},_createManualAccountError:function(e){e=JSON.parse(e._data.responseText).error;if(e.fieldErrors.alias){var t=this.$("[name=alias]");t.data("alias",t.val()),t.data("parsleyField").constraints.notinlist.replaced=!1,t.data("parsleyField").constraints.notinlist.requirements="alias",this.ui.$form.data("parsleyForm").reset(),this.ui.$form.data("parsleyForm").validate()}},_cancelAccountEditForm:function(e){this.$(".sf-field-wrap").hide(),this.$(".sf-label-wrap").show(),this.$(".sf-edit-account-form")[0].reset(),this.$(e.currentTarget).closest("form").data("parsleyForm").validate()},_deleteAccount:function(e){var t=this,n={uscId:this.$(e.currentTarget).closest(".sf-entity").data("id")},s=new r({title:i.i18n.get("accounts-accordion.confirmDeleteTitle"),content:i.i18n.get("accounts-accordion.confirmDeleteMessage",{accountName:this.model.get("alias")}),type:"confirmation",$container:this.$el,$opener:this.$(e.currentTarget),confirmCallback:function(){s.remove(),i.mask(t.$el,i.MASK_LOADING),i.when(t.accountsService.deleteAccount(n)).done(function(){i.unmask(t.$el)}).fail(function(e){console.error("Error while deleting account ",e),t.publish("error",e),i.unmask(t.$el)})}});s.open()},_importFile:function(e){var t=this.$(e.currentTarget).closest(".sf-entity").data("id");this.publish("account.import-file",t,e)}},{});return o}),define("hbs!modules/accounts-accordion/templates/entities-view",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing;return s+='<li class="sf-entity sf-accordion-item sf-collapsed sf-clearfix sf-entity-',(o=n.id)?o=o.call(t,{hash:{}}):(o=t.id,o=typeof o===a?o.apply(t):o),s+=f(o)+'" data-id="',(o=n.id)?o=o.call(t,{hash:{}}):(o=t.id,o=typeof o===a?o.apply(t):o),s+=f(o)+'">\n	<div class="sf-accordion-header sf-clearfix">\n		<span class="sf-accordion-triangle"></span>\n		<span class="sf-entity-name">',(o=n.entityName)?o=o.call(t,{hash:{}}):(o=t.entityName,o=typeof o===a?o.apply(t):o),s+=f(o)+'</span>\n		<span class="sf-entity-total">',u={hash:{}},s+=f((o=n.formatAmount,o?o.call(t,t.entityTotal,u):l.call(t,"formatAmount",t.entityTotal,u)))+'</span>\n	</div>\n	<ul class="sf-accounts-list sf-accordion-body"></ul>\n</li>',s});return t.registerPartial("modules_accounts-accordion_templates_entities-view",n),n}),define("modules/accounts-accordion/views/entities-view",["classes/composite-view","modules/accounts-accordion/views/account-view","utils/util","hbs!modules/accounts-accordion/templates/entities-view"],function(e,t,n,r){var i=e.extend({itemView:t,itemViewOptions:function(){return n.extend({uscId:this.uscId},this.contextConfig)},itemViewContainer:"ul.sf-accounts-list",template:r,initialize:function(){this._super.apply(this,arguments);var e=this.model.get("accounts");this.uscId=this.options.uscId,this.selectedAccId=this.options.selectedAccId,this.collection=e},render:function(){this._super(),this.$el.hasClass("sf-entity-"+this.selectedAccId)&&this.$el.removeClass("sf-collapsed")},serializeData:function(){var e=n.reduce(this.collection.models,function(e,t){return e+t.get("balanceSysCur")},0);return{entityName:this.model.get("alias"),id:this.model.get("id"),entityTotal:e}}});return i}),define("hbs!modules/accounts-accordion/templates/accounts-accordion",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i,s;return r+='<div class="sf-total-amount">TOTAL: <span>',s={hash:{}},r+=a((i=n.formatAmount,i?i.call(e,e.totalAmount,s):u.call(e,"formatAmount",e.totalAmount,s)))+"</span></div>",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u=n.helperMissing,a=this.escapeExpression,f=this;s+='<div class="sf-accounts-accordion">\n	<ul class="sf-entities-list"></ul>\n	',o=n["if"].call(t,t.showTotalAmount,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;return s+="\n</div>",s});return t.registerPartial("modules_accounts-accordion_templates_accounts-accordion",n),n}),define("libs/require/css/css!modules/accounts-accordion/css/accounts-accordion",[],function(){}),define("modules/accounts-accordion/accounts-accordion-module",["classes/composite-view","services/accounts-service","modules/accounts-accordion/views/entities-view","utils/util","hbs!modules/accounts-accordion/templates/accounts-accordion","css!modules/accounts-accordion/css/accounts-accordion"],function(e,t,n,r,i){var s=e.extend({template:i,itemView:n,appendHtml:function(e,t){var n=this.getItemViewContainer(e);t.model.get("manual")?n.append(t.el):n.prepend(t.el)},itemViewOptions:function(e){return r.extend({uscId:e.get("id"),selectedAccId:this.selectedAccId},this.contextConfig)},itemViewContainer:"ul.sf-entities-list",events:{"click .sf-accordion-header":"_toggleEntity"},hubEvents:{"account:before:changed":"_setSelectedAccount","account:created":"_setSelectedAccount"},initialize:function(){this._super.apply(this,arguments),this.accountsLength=0,this.selectedAccId=null},serializeData:function(){var e=r.reduce(this.collection.models,function(e,t){var n=t.get("accounts"),i=r.reduce(n.models,function(e,t){return e+t.get("balanceSysCur")},0);return e+i},0);return{showTotalAmount:this.config.showTotalAmount,totalAmount:e}},render:function(){this._super();if(!this.selectedAccId&&this.config.unfoldFirstEntity||this.accountsLength!==this.$(".sf-entity").length)this.selectedAccId=null,this.$(".sf-entity:first-child").removeClass("sf-collapsed");this.accountsLength=this.$(".sf-entity").length},_toggleEntity:function(e){var t=this.$(e.currentTarget).closest(".sf-entity"),n=t.hasClass("sf-collapsed");this.$(".sf-entity").addClass("sf-collapsed"),n&&t.removeClass("sf-collapsed")},_setSelectedAccount:function(e){this.selectedAccId=e}},{ID:"accounts-accordion",defaults:{grouping:t.ENTITY_GROUPING,showTotalAmount:!1,unfoldFirstEntity:!0}});return s}),define("classes/extensions/collection-filtering",[],function(){var e={setupFilter:function(e,t){var n=this;this.filterFunc=t,this.originalCollection=e,this.reset(e.filter(t),{silent:!0}),e.on("update",function(){n.reset(e.filter(n.filterFunc))}),e.on("change",function(t){t===undefined?n.reset(e.filter(n.filterFunc)):n.filterFunc!==undefined&&(n.filterFunc(t)?n.filterFunc(t)&&n.get(t)===undefined&&n.add(t):n.remove(t))}),e.on("remove",function(e){n.remove(e)}),e.on("reset",function(){n.reset(e.filter(n.filterFunc))})},updateFilter:function(e,t){this.filterFunc=e,(t||t===undefined)&&this.reset(this.originalCollection.filter(e))}};return e}),define("classes/filtered-collection",["classes/collection","classes/extensions/collection-filtering"],function(e,t){var n=e.extend(t);return n}),define("hbs!modules/account-import/templates/entity",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression;return s+='<li class="sf-entity-item" data-name="',(o=n.name)?o=o.call(t,{hash:{}}):(o=t.name,o=typeof o===u?o.apply(t):o),s+=a(o)+'">\n	<div class="entity-name entity-',(o=n.name)?o=o.call(t,{hash:{}}):(o=t.name,o=typeof o===u?o.apply(t):o),s+=a(o)+'">\n		<img src="',(o=n.imageurl)?o=o.call(t,{hash:{}}):(o=t.imageurl,o=typeof o===u?o.apply(t):o),s+=a(o)+'" alt="',(o=n.name)?o=o.call(t,{hash:{}}):(o=t.name,o=typeof o===u?o.apply(t):o),s+=a(o)+'" />\n		<span class="default-name"></span>\n	</div>\n</li>',s});return t.registerPartial("modules_account-import_templates_entity",n),n}),define("modules/account-import/views/entity-view",["classes/item-view","hbs!modules/account-import/templates/entity"],function(e,t){var n=e.extend({template:t,serializeData:function(){return{imageurl:this.model.get("imageurl")?"/resources/pfm/ui/css/img/bank-logos/"+this.model.get("imageurl")+".png":"/resources/pfm/ui/css/img/bank-logos/defaultlogo.png",name:this.model.get("name")}}});return n}),define("hbs!modules/account-import/templates/account-selection",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-account-selection">\n	<h3>',u={hash:{}},s+=f((o=n.t,o?o.call(t,"account-import.step1",u):a.call(t,"t","account-import.step1",u)))+'</h3>\n	<form class="sf-account-selection-form sf-clearfix" data-parsley-validate>\n		<fieldset>\n			<label>',u={hash:{}},s+=f((o=n.t,o?o.call(t,"account-import.searchBankLabel",u):a.call(t,"t","account-import.searchBankLabel",u)))+"</label>\n			",u={hash:{"class":"search-entity-name",name:"search-entity-name",type:"text",placeholder:"{{t 'account-import.searchPlaceholder'}}"}},s+=f((o=n.textfield,o?o.call(t,u):a.call(t,"textfield",u)))+"\n		</fieldset>\n		<fieldset>\n			<label>",u={hash:{}},s+=f((o=n.t,o?o.call(t,"account-import.chooseBankLabel",u):a.call(t,"t","account-import.chooseBankLabel",u)))+'</label>\n			<div class="sf-entities-list-wrap">\n				<ul class="sf-entities-list sf-clearfix">\n					<li class="sf-default-account"></li>\n				</ul>\n			</div>\n			<div class="sf-form-row">\n				<label>',u={hash:{}},s+=f((o=n.t,o?o.call(t,"account-import.accountAliasLabel",u):a.call(t,"t","account-import.accountAliasLabel",u)))+"</label>\n				",u={hash:{name:"alias",type:"text",dataAlias:"ab",validateField:"account.account-alias"}},s+=f((o=n.textfield,o?o.call(t,u):a.call(t,"textfield",u)))+"\n				",u={hash:{name:"type",options:"{{accTypes}}",currentOption:"0"}},s+=f((o=n.select,o?o.call(t,u):a.call(t,"select",u)))+'\n			</div>\n			<div class="sf-form-row">\n				<label>',u={hash:{}},s+=f((o=n.t,o?o.call(t,"account-import.accountBalanceLabel",u):a.call(t,"t","account-import.accountBalanceLabel",u)))+"</label>\n				",u={hash:{name:"balance",type:"text",value:"0",validateField:"account.number"}},s+=f((o=n.textfield,o?o.call(t,u):a.call(t,"textfield",u)))+"\n				",u={hash:{name:"currency",options:"{{currencies}}",currentOption:"0"}},s+=f((o=n.select,o?o.call(t,u):a.call(t,"select",u)))+'\n			</div>\n		</fieldset>\n		<div class="sf-footer-buttons">\n			',u={hash:{"class":"sf-button-save sf-account-selection-next",type:"submit",text:"account-import.nextButton"}},s+=f((o=n.button,o?o.call(t,u):a.call(t,"button",u)))+"\n			",u={hash:{"class":"sf-button-cancel sf-account-selection-cancel",text:"common.button.cancel"}},s+=f((o=n.button,o?o.call(t,u):a.call(t,"button",u)))+"\n		</div>\n	</form>\n</div>",s});return t.registerPartial("modules_account-import_templates_account-selection",n),n}),define("modules/account-import/views/account-selection-view",["classes/composite-view","classes/filtered-collection","modules/account-import/views/entity-view","services/accounts-service","utils/util","ui/modules/reform/select/select-module","hbs!modules/account-import/templates/account-selection"],function(e,t,n,r,i,s,o){var u=e.extend({template:o,events:{"keyup .search-entity-name":"_filterEntities","click .sf-entity-item":"_selectEntity","click .sf-account-selection-cancel":"_AccountSelectionCancel","submit .sf-account-selection-next":"_AccountSelectionNext","click .sf-account-selection-next":"_AccountSelectionNext"},ui:{$form:".sf-account-selection-form"},itemView:n,itemViewContainer:"ul.sf-entities-list",initialize:function(e){this._super.apply(this,arguments),this.collection=new t,this.collection.setupFilter(e.entities,this._getFilterFunction()),this.accountsService=r.getInstance(),this.automaticImport=this.options.automaticImport},render:function(){this._super(),s.init(this.$el),i.validator.validate(this.ui.$form)},serializeData:function(){return{accTypes:this.config.accountTypes,currencies:this.config.currencies}},onDomRefresh:function(){this.publish("entity:refreshed")},_getFilterFunction:function(e){return function(t){return e?(e=i.trim(e),i.contains(t.get("name").toLowerCase(),e.toLowerCase())||t.get("name")==="default"):!0}},_filterEntities:function(e){var t=this.$(e.currentTarget).val();this.collection.updateFilter(this._getFilterFunction(t)),this.$(".entity-default .default-name").html(t)},_selectEntity:function(e){var t=this.$(e.currentTarget),n=t.data("name")==="default"?t.find(".default-name").html():t.data("name");this.$(".sf-entity-item").removeClass("sf-entity-selected"),t.addClass("sf-entity-selected"),this.$("[name=alias]").val(n),this.ui.$form.data("parsleyForm").validate()},_AccountSelectionCancel:function(){this.trigger("account-selection:cancel")},_AccountSelectionNext:function(){var e=this,t={alias:this.$("[name=alias]").val(),balance:this.$("[name=balance]").val(),type:this.$("[name=type]").val(),currency:this.$("[name=currency]").val()};return this.ui.$form.data("parsleyForm").validate()&&i.when(this.accountsService.createManualAccount(t)).done(function(t){e.automaticImport?(e.publish("account:created",t.result),e.trigger("account-selection:next",{uscId:t.result,automatic:!0})):(e.publish("account:created",t.result),e.trigger("account-selection:next",t.result))}).fail(function(t){console.error("Error while loading accounts ",t),e._createManualAccountError(t)}),!1},_createManualAccountError:function(e){e=JSON.parse(e._data.responseText).error;if(e.fieldErrors.alias){var t=this.$("[name=alias]");t.data("alias",t.val()),t.data("parsleyField").constraints.notinlist.replaced=!1,t.data("parsleyField").constraints.notinlist.requirements="alias",this.ui.$form.data("parsleyForm").reset(),this.ui.$form.data("parsleyForm").validate()}}},{defaults:{accountTypes:[{value:0,name:"Saving"},{value:1,name:"Credit Card"},{value:4,name:"Checking"},{value:5,name:"Loan"}],currencies:[{value:"EUR",name:"EUR"},{value:"USD",name:"USD"},{value:"CRC",name:"CRC"},{value:"CSD",name:"CSD"},{value:"CZK",name:"CZK"},{value:"DKK",name:"DKK"},{value:"DOP",name:"DOP"},{value:"DZD",name:"DZD"},{value:"EEK",name:"EEK"},{value:"EGP",name:"EGP"},{value:"EUR",name:"EUR"},{value:"GBP",name:"GBP"},{value:"GTQ",name:"GTQ"},{value:"HKD",name:"HKD"},{value:"HNL",name:"HNL"},{value:"HRK",name:"HRK"},{value:"HUF",name:"HUF"},{value:"IDR",name:"IDR"},{value:"ILS",name:"ILS"},{value:"INR",name:"INR"},{value:"IQD",name:"IQD"},{value:"ISK",name:"ISK"},{value:"JOD",name:"JOD"},{value:"JPY",name:"JPY"},{value:"KRW",name:"KRW"},{value:"KWD",name:"KWD"},{value:"LBP",name:"LBP"},{value:"LTL",name:"LTL"},{value:"LVL",name:"LVL"},{value:"LYD",name:"LYD"},{value:"MAD",name:"MAD"},{value:"MKD",name:"MKD"},{value:"MXN",name:"MXN"},{value:"MYR",name:"MYR"},{value:"NIO",name:"NIO"},{value:"NOK",name:"NOK"},{value:"NZD",name:"NZD"},{value:"OMR",name:"OMR"},{value:"PAB",name:"PAB"},{value:"PEN",name:"PEN"},{value:"PHP",name:"PHP"},{value:"PLN",name:"PLN"},{value:"PYG",name:"PYG"},{value:"QAR",name:"QAR"},{value:"RON",name:"RON"},{value:"RSD",name:"RSD"},{value:"RUB",name:"RUB"},{value:"SAR",name:"SAR"},{value:"SDG",name:"SDG"},{value:"SEK",name:"SEK"},{value:"SGD",name:"SGD"},{value:"SKK",name:"SKK"},{value:"SVC",name:"SVC"},{value:"SYP",name:"SYP"},{value:"THB",name:"THB"},{value:"TND",name:"TND"},{value:"TRY",name:"TRY"},{value:"TWD",name:"TWD"},{value:"UAH",name:"UAH"},{value:"USD",name:"USD"},{value:"UYU",name:"UYU"},{value:"VEF",name:"VEF"},{value:"VND",name:"VND"},{value:"YER",name:"YER"},{value:"ZAR",name:"ZAR"}]}});return u}),define("hbs!modules/account-import/templates/file-upload",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function";return s+='<div class="sf-file-upload">\n	<h3>',a={hash:{}},s+=l((o=n.t,o?o.call(t,"account-import.step2",a):f.call(t,"t","account-import.step2",a)))+'</h3>\n	<form class="sf-file-upload-form">\n		<fieldset>\n			<p class="sf-file-upload-desc">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"account-import.importFileDesc",a):f.call(t,"t","account-import.importFileDesc",a)))+'</p>\n			<label class="sf-file-upload-label">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"account-import.importFileLabel",a):f.call(t,"t","account-import.importFileLabel",a)))+'</label>\n			<input type="hidden" name="uscId" value="',(u=n.uscId)?u=u.call(t,{hash:{}}):(u=t.uscId,u=typeof u===c?u.apply(t):u),s+=l(u)+'" />\n			<input type="hidden" name="uploadFileName" value="exportAmericanExpress2.csv" />\n			<input type="hidden" name="uploadContentType" value="text/csv" />\n			<input class="sf-file-upload-field" type="file" name="upload" ',a={hash:{}},s+=l((o=n.validator,o?o.call(t,"account.upload",a):f.call(t,"validator","account.upload",a)))+" />\n			",a={hash:{"class":"sf-file-upload-fake-button",text:"Select file to upload"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+'\n			<div>\n				<p class="sf-file-upload-message"></p>\n			</div>\n			<div class="sf-file-upload-drop">\n				<div class="sf-file-drop-image"></div>\n				<div>',a={hash:{}},s+=l((o=n.t,o?o.call(t,"account-import.dropFiles",a):f.call(t,"t","account-import.dropFiles",a)))+'</div>\n			</div>\n		</fieldset>\n		<div class="sf-footer-buttons">\n			',a={hash:{"class":"sf-button-save sf-file-upload-continue",type:"submit",text:"account-import.nextButton"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+"\n			",a={hash:{"class":"sf-button-cancel sf-file-upload-cancel",text:"account-import.skipButton"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+"\n		</div>\n	</form>\n</div>",s});return t.registerPartial("modules_account-import_templates_file-upload",n),n}),function(e){typeof define=="function"&&define.amd?define("libs/jquery-file-upload/jquery.ui.widget",["jquery"],e):typeof exports=="object"?e(require("jquery")):e(jQuery)}(function(e){var t=0,n=Array.prototype.slice;e.cleanData=function(t){return function(n){var r,i,s;for(s=0;(i=n[s])!=null;s++)try{r=e._data(i,"events"),r&&r.remove&&e(i).triggerHandler("remove")}catch(o){}t(n)}}(e.cleanData),e.widget=function(t,n,r){var i,s,o,u,a={},f=t.split(".")[0];return t=t.split(".")[1],i=f+"-"+t,r||(r=n,n=e.Widget),e.expr[":"][i.toLowerCase()]=function(t){return!!e.data(t,i)},e[f]=e[f]||{},s=e[f][t],o=e[f][t]=function(e,t){if(!this._createWidget)return new o(e,t);arguments.length&&this._createWidget(e,t)},e.extend(o,s,{version:r.version,_proto:e.extend({},r),_childConstructors:[]}),u=new n,u.options=e.widget.extend({},u.options),e.each(r,function(t,r){if(!e.isFunction(r)){a[t]=r;return}a[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments)},i=function(e){return n.prototype[t].apply(this,e)};return function(){var t=this._super,n=this._superApply,s;return this._super=e,this._superApply=i,s=r.apply(this,arguments),this._super=t,this._superApply=n,s}}()}),o.prototype=e.widget.extend(u,{widgetEventPrefix:s?u.widgetEventPrefix||t:t},a,{constructor:o,namespace:f,widgetName:t,widgetFullName:i}),s?(e.each(s._childConstructors,function(t,n){var r=n.prototype;e.widget(r.namespace+"."+r.widgetName,o,n._proto)}),delete s._childConstructors):n._childConstructors.push(o),e.widget.bridge(t,o),o},e.widget.extend=function(t){var r=n.call(arguments,1),i=0,s=r.length,o,u;for(;i<s;i++)for(o in r[i])u=r[i][o],r[i].hasOwnProperty(o)&&u!==undefined&&(e.isPlainObject(u)?t[o]=e.isPlainObject(t[o])?e.widget.extend({},t[o],u):e.widget.extend({},u):t[o]=u);return t},e.widget.bridge=function(t,r){var i=r.prototype.widgetFullName||t;e.fn[t]=function(s){var o=typeof s=="string",u=n.call(arguments,1),a=this;return s=!o&&u.length?e.widget.extend.apply(null,[s].concat(u)):s,o?this.each(function(){var n,r=e.data(this,i);if(s==="instance")return a=r,!1;if(!r)return e.error("cannot call methods on "+t+" prior to initialization; "+"attempted to call method '"+s+"'");if(!e.isFunction(r[s])||s.charAt(0)==="_")return e.error("no such method '"+s+"' for "+t+" widget instance");n=r[s].apply(r,u);if(n!==r&&n!==undefined)return a=n&&n.jquery?a.pushStack(n.get()):n,!1}):this.each(function(){var t=e.data(this,i);t?(t.option(s||{}),t._init&&t._init()):e.data(this,i,new r(s,this))}),a}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(n,r){r=e(r||this.defaultElement||this)[0],this.element=e(r),this.uuid=t++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),n),this.bindings=e(),this.hoverable=e(),this.focusable=e(),r!==this&&(e.data(r,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===r&&this.destroy()}}),this.document=e(r.style?r.ownerDocument:r.document||r),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(t,n){var r=t,i,s,o;if(arguments.length===0)return e.widget.extend({},this.options);if(typeof t=="string"){r={},i=t.split("."),t=i.shift();if(i.length){s=r[t]=e.widget.extend({},this.options[t]);for(o=0;o<i.length-1;o++)s[i[o]]=s[i[o]]||{},s=s[i[o]];t=i.pop();if(arguments.length===1)return s[t]===undefined?null:s[t];s[t]=n}else{if(arguments.length===1)return this.options[t]===undefined?null:this.options[t];r[t]=n}}return this._setOptions(r),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,e==="disabled"&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!t),t&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(t,n,r){var i,s=this;typeof t!="boolean"&&(r=n,n=t,t=!1),r?(n=i=e(n),this.bindings=this.bindings.add(n)):(r=n,n=this.element,i=this.widget()),e.each(r,function(r,o){function u(){if(!t&&(s.options.disabled===!0||e(this).hasClass("ui-state-disabled")))return;return(typeof o=="string"?s[o]:o).apply(s,arguments)}typeof o!="string"&&(u.guid=o.guid=o.guid||u.guid||e.guid++);var a=r.match(/^([\w:-]*)\s*(.*)$/),f=a[1]+s.eventNamespace,l=a[2];l?i.delegate(l,f,u):n.bind(f,u)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return(typeof e=="string"?r[e]:e).apply(r,arguments)}var r=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,r){var i,s,o=this.options[t];r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent;if(s)for(i in s)i in n||(n[i]=s[i]);return this.element.trigger(n,r),!(e.isFunction(o)&&o.apply(this.element[0],[n].concat(r))===!1||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(r,i,s){typeof i=="string"&&(i={effect:i});var o,u=i?i===!0||typeof i=="number"?n:i.effect||n:t;i=i||{},typeof i=="number"&&(i={duration:i}),o=!e.isEmptyObject(i),i.complete=s,i.delay&&r.delay(i.delay),o&&e.effects&&e.effects.effect[u]?r[t](i):u!==t&&r[u]?r[u](i.duration,i.easing,s):r.queue(function(n){e(this)[t](),s&&s.call(r[0]),n()})}});var r=e.widget}),function(e){"use strict";typeof define=="function"&&define.amd?define("libs/jquery-file-upload/jquery.fileupload",["jquery","./jquery.ui.widget"],e):typeof exports=="object"?e(require("jquery"),require("./vendor/jquery.ui.widget")):e(window.jQuery)}(function(e){"use strict";function t(t){var n=t==="dragover";return function(r){r.dataTransfer=r.originalEvent&&r.originalEvent.dataTransfer;var i=r.dataTransfer;i&&e.inArray("Files",i.types)!==-1&&this._trigger(t,e.Event(t,{delegatedEvent:r}))!==!1&&(r.preventDefault(),n&&(i.dropEffect="copy"))}}e.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))")).test(window.navigator.userAgent)&&!e('<input type="file">').prop("disabled"),e.support.xhrFileUpload=!!window.ProgressEvent&&!!window.FileReader,e.support.xhrFormDataFileUpload=!!window.FormData,e.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),e.widget("blueimp.fileupload",{options:{dropZone:e(document),pasteZone:undefined,fileInput:undefined,replaceFileInput:!0,paramName:undefined,singleFileUploads:!0,limitMultiFileUploads:undefined,limitMultiFileUploadSize:undefined,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:undefined,forceIframeTransport:!1,redirect:undefined,redirectParamName:undefined,postMessage:undefined,multipart:!0,maxChunkSize:undefined,uploadedBytes:undefined,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(t,n){return t=this.messages[t]||t.toString(),n&&e.each(n,function(e,n){t=t.replace("{"+e+"}",n)}),t},formData:function(e){return e.serializeArray()},add:function(t,n){if(t.isDefaultPrevented())return!1;(n.autoUpload||n.autoUpload!==!1&&e(this).fileupload("option","autoUpload"))&&n.process().done(function(){n.submit()})},processData:!1,contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:e.support.blobSlice&&function(){var e=this.slice||this.webkitSlice||this.mozSlice;return e.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,n){var r=e-this.timestamp;if(!this.bitrate||!n||r>n)this.bitrate=(t-this.loaded)*(1e3/r)*8,this.loaded=t,this.timestamp=e;return this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&e.support.xhrFileUpload||e.support.xhrFormDataFileUpload)},_getFormData:function(t){var n;return e.type(t.formData)==="function"?t.formData(t.form):e.isArray(t.formData)?t.formData:e.type(t.formData)==="object"?(n=[],e.each(t.formData,function(e,t){n.push({name:e,value:t})}),n):[]},_getTotal:function(t){var n=0;return e.each(t,function(e,t){n+=t.size||1}),n},_initProgressObject:function(t){var n={loaded:0,total:0,bitrate:0};t._progress?e.extend(t._progress,n):t._progress=n},_initResponseObject:function(e){var t;if(e._response)for(t in e._response)e._response.hasOwnProperty(t)&&delete e._response[t];else e._response={}},_onProgress:function(t,n){if(t.lengthComputable){var r=Date.now?Date.now():(new Date).getTime(),i;if(n._time&&n.progressInterval&&r-n._time<n.progressInterval&&t.loaded!==t.total)return;n._time=r,i=Math.floor(t.loaded/t.total*(n.chunkSize||n._progress.total))+(n.uploadedBytes||0),this._progress.loaded+=i-n._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(r,this._progress.loaded,n.bitrateInterval),n._progress.loaded=n.loaded=i,n._progress.bitrate=n.bitrate=n._bitrateTimer.getBitrate(r,i,n.bitrateInterval),this._trigger("progress",e.Event("progress",{delegatedEvent:t}),n),this._trigger("progressall",e.Event("progressall",{delegatedEvent:t}),this._progress)}},_initProgressListener:function(t){var n=this,r=t.xhr?t.xhr():e.ajaxSettings.xhr();r.upload&&(e(r.upload).bind("progress",function(e){var r=e.originalEvent;e.lengthComputable=r.lengthComputable,e.loaded=r.loaded,e.total=r.total,n._onProgress(e,t)}),t.xhr=function(){return r})},_isInstanceOf:function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},_initXHRData:function(t){var n=this,r,i=t.files[0],s=t.multipart||!e.support.xhrFileUpload,o=e.type(t.paramName)==="array"?t.paramName[0]:t.paramName;t.headers=e.extend({},t.headers),t.contentRange&&(t.headers["Content-Range"]=t.contentRange);if(!s||t.blob||!this._isInstanceOf("File",i))t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(i.name)+'"';s?e.support.xhrFormDataFileUpload&&(t.postMessage?(r=this._getFormData(t),t.blob?r.push({name:o,value:t.blob}):e.each(t.files,function(n,i){r.push({name:e.type(t.paramName)==="array"&&t.paramName[n]||o,value:i})})):(n._isInstanceOf("FormData",t.formData)?r=t.formData:(r=new FormData,e.each(this._getFormData(t),function(e,t){r.append(t.name,t.value)})),t.blob?r.append(o,t.blob,i.name):e.each(t.files,function(i,s){(n._isInstanceOf("File",s)||n._isInstanceOf("Blob",s))&&r.append(e.type(t.paramName)==="array"&&t.paramName[i]||o,s,s.uploadName||s.name)})),t.data=r):(t.contentType=i.type||"application/octet-stream",t.data=t.blob||i),t.blob=null},_initIframeSettings:function(t){var n=e("<a></a>").prop("href",t.url).prop("host");t.dataType="iframe "+(t.dataType||""),t.formData=this._getFormData(t),t.redirect&&n&&n!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e)},_getParamName:function(t){var n=e(t.fileInput),r=t.paramName;return r?e.isArray(r)||(r=[r]):(r=[],n.each(function(){var t=e(this),n=t.prop("name")||"files[]",i=(t.prop("files")||[1]).length;while(i)r.push(n),i-=1}),r.length||(r=[n.prop("name")||"files[]"])),r},_initFormSettings:function(t){if(!t.form||!t.form.length)t.form=e(t.fileInput.prop("form")),t.form.length||(t.form=e(this.options.fileInput.prop("form")));t.paramName=this._getParamName(t),t.url||(t.url=t.form.prop("action")||location.href),t.type=(t.type||e.type(t.form.prop("method"))==="string"&&t.form.prop("method")||"").toUpperCase(),t.type!=="POST"&&t.type!=="PUT"&&t.type!=="PATCH"&&(t.type="POST"),t.formAcceptCharset||(t.formAcceptCharset=t.form.attr("accept-charset"))},_getAJAXSettings:function(t){var n=e.extend({},this.options,t);return this._initFormSettings(n),this._initDataSettings(n),n},_getDeferredState:function(e){return e.state?e.state():e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(t,n,r){var i=e.Deferred(),s=i.promise();return n=n||this.options.context||s,t===!0?i.resolveWith(n,r):t===!1&&i.rejectWith(n,r),s.abort=i.promise,this._enhancePromise(s)},_addConvenienceMethods:function(t,n){var r=this,i=function(t){return e.Deferred().resolveWith(r,t).promise()};n.process=function(t,s){if(t||s)n._processQueue=this._processQueue=(this._processQueue||i([this])).pipe(function(){return n.errorThrown?e.Deferred().rejectWith(r,[n]).promise():i(arguments)}).pipe(t,s);return this._processQueue||i([this])},n.submit=function(){return this.state()!=="pending"&&(n.jqXHR=this.jqXHR=r._trigger("submit",e.Event("submit",{delegatedEvent:t}),this)!==!1&&r._onSend(t,this)),this.jqXHR||r._getXHRPromise()},n.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",r._trigger("fail",null,this),r._getXHRPromise(!1))},n.state=function(){if(this.jqXHR)return r._getDeferredState(this.jqXHR);if(this._processQueue)return r._getDeferredState(this._processQueue)},n.processing=function(){return!this.jqXHR&&this._processQueue&&r._getDeferredState(this._processQueue)==="pending"},n.progress=function(){return this._progress},n.response=function(){return this._response}},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),n=t&&t.split("-"),r=n&&n.length>1&&parseInt(n[1],10);return r&&r+1},_chunkedUpload:function(t,n){t.uploadedBytes=t.uploadedBytes||0;var r=this,i=t.files[0],s=i.size,o=t.uploadedBytes,u=t.maxChunkSize||s,a=this._blobSlice,f=e.Deferred(),l=f.promise(),c,h;return!(this._isXHRUpload(t)&&a&&(o||u<s))||t.data?!1:n?!0:o>=s?(i.error=t.i18n("uploadedBytes"),this._getXHRPromise(!1,t.context,[null,"error",i.error])):(h=function(){var n=e.extend({},t),l=n._progress.loaded;n.blob=a.call(i,o,o+u,i.type),n.chunkSize=n.blob.size,n.contentRange="bytes "+o+"-"+(o+n.chunkSize-1)+"/"+s,r._initXHRData(n),r._initProgressListener(n),c=(r._trigger("chunksend",null,n)!==!1&&e.ajax(n)||r._getXHRPromise(!1,n.context)).done(function(i,u,a){o=r._getUploadedBytes(a)||o+n.chunkSize,l+n.chunkSize-n._progress.loaded&&r._onProgress(e.Event("progress",{lengthComputable:!0,loaded:o-n.uploadedBytes,total:o-n.uploadedBytes}),n),t.uploadedBytes=n.uploadedBytes=o,n.result=i,n.textStatus=u,n.jqXHR=a,r._trigger("chunkdone",null,n),r._trigger("chunkalways",null,n),o<s?h():f.resolveWith(n.context,[i,u,a])}).fail(function(e,t,i){n.jqXHR=e,n.textStatus=t,n.errorThrown=i,r._trigger("chunkfail",null,n),r._trigger("chunkalways",null,n),f.rejectWith(n.context,[e,t,i])})},this._enhancePromise(l),l.abort=function(){return c.abort()},h(),l)},_beforeSend:function(e,t){this._active===0&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(t),this._initProgressObject(t),t._progress.loaded=t.loaded=t.uploadedBytes||0,t._progress.total=t.total=this._getTotal(t.files)||1,t._progress.bitrate=t.bitrate=0,this._active+=1,this._progress.loaded+=t.loaded,this._progress.total+=t.total},_onDone:function(t,n,r,i){var s=i._progress.total,o=i._response;i._progress.loaded<s&&this._onProgress(e.Event("progress",{lengthComputable:!0,loaded:s,total:s}),i),o.result=i.result=t,o.textStatus=i.textStatus=n,o.jqXHR=i.jqXHR=r,this._trigger("done",null,i)},_onFail:function(e,t,n,r){var i=r._response;r.recalculateProgress&&(this._progress.loaded-=r._progress.loaded,this._progress.total-=r._progress.total),i.jqXHR=r.jqXHR=e,i.textStatus=r.textStatus=t,i.errorThrown=r.errorThrown=n,this._trigger("fail",null,r)},_onAlways:function(e,t,n,r){this._trigger("always",null,r)},_onSend:function(t,n){n.submit||this._addConvenienceMethods(t,n);var r=this,i,s,o,u,a=r._getAJAXSettings(n),f=function(){return r._sending+=1,a._bitrateTimer=new r._BitrateTimer,i=i||((s||r._trigger("send",e.Event("send",{delegatedEvent:t}),a)===!1)&&r._getXHRPromise(!1,a.context,s)||r._chunkedUpload(a)||e.ajax(a)).done(function(e,t,n){r._onDone(e,t,n,a)}).fail(function(e,t,n){r._onFail(e,t,n,a)}).always(function(e,t,n){r._onAlways(e,t,n,a),r._sending-=1,r._active-=1;if(a.limitConcurrentUploads&&a.limitConcurrentUploads>r._sending){var i=r._slots.shift();while(i){if(r._getDeferredState(i)==="pending"){i.resolve();break}i=r._slots.shift()}}r._active===0&&r._trigger("stop")}),i};return this._beforeSend(t,a),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(o=e.Deferred(),this._slots.push(o),u=o.pipe(f)):(this._sequence=this._sequence.pipe(f,f),u=this._sequence),u.abort=function(){return s=[undefined,"abort","abort"],i?i.abort():(o&&o.rejectWith(a.context,s),f())},this._enhancePromise(u)):f()},_onAdd:function(t,n){var r=this,i=!0,s=e.extend({},this.options,n),o=n.files,u=o.length,a=s.limitMultiFileUploads,f=s.limitMultiFileUploadSize,l=s.limitMultiFileUploadSizeOverhead,c=0,h=this._getParamName(s),p,d,v,m,g=0;f&&(!u||o[0].size===undefined)&&(f=undefined);if(!(s.singleFileUploads||a||f)||!this._isXHRUpload(s))v=[o],p=[h];else if(!s.singleFileUploads&&!f&&a){v=[],p=[];for(m=0;m<u;m+=a)v.push(o.slice(m,m+a)),d=h.slice(m,m+a),d.length||(d=h),p.push(d)}else if(!s.singleFileUploads&&f){v=[],p=[];for(m=0;m<u;m+=1){c+=o[m].size+l;if(m+1===u||c+o[m+1].size+l>f||a&&m+1-g>=a)v.push(o.slice(g,m+1)),d=h.slice(g,m+1),d.length||(d=h),p.push(d),g=m+1,c=0}}else p=h;return n.originalFiles=o,e.each(v||o,function(s,o){var u=e.extend({},n);return u.files=v?o:[o],u.paramName=p[s],r._initResponseObject(u),r._initProgressObject(u),r._addConvenienceMethods(t,u),i=r._trigger("add",e.Event("add",{delegatedEvent:t}),u),i}),i},_replaceFileInput:function(t){var n=t.fileInput,r=n.clone(!0);t.fileInputClone=r,e("<form></form>").append(r)[0].reset(),n.after(r).detach(),e.cleanData(n.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(e,t){return t===n[0]?r[0]:t}),n[0]===this.element[0]&&(this.element=r)},_handleFileTreeEntry:function(t,n){var r=this,i=e.Deferred(),s=function(e){e&&!e.entry&&(e.entry=t),i.resolve([e])},o=function(e){r._handleFileTreeEntries(e,n+t.name+"/").done(function(e){i.resolve(e)}).fail(s)},u=function(){a.readEntries(function(e){e.length?(f=f.concat(e),u()):o(f)},s)},a,f=[];return n=n||"",t.isFile?t._file?(t._file.relativePath=n,i.resolve(t._file)):t.file(function(e){e.relativePath=n,i.resolve(e)},s):t.isDirectory?(a=t.createReader(),u()):i.resolve([]),i.promise()},_handleFileTreeEntries:function(t,n){var r=this;return e.when.apply(e,e.map(t,function(e){return r._handleFileTreeEntry(e,n)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){t=t||{};var n=t.items;return n&&n.length&&(n[0].webkitGetAsEntry||n[0].getAsEntry)?this._handleFileTreeEntries(e.map(n,function(e){var t;return e.webkitGetAsEntry?(t=e.webkitGetAsEntry(),t&&(t._file=e.getAsFile()),t):e.getAsEntry()})):e.Deferred().resolve(e.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){t=e(t);var n=t.prop("webkitEntries")||t.prop("entries"),r,i;if(n&&n.length)return this._handleFileTreeEntries(n);r=e.makeArray(t.prop("files"));if(!r.length){i=t.prop("value");if(!i)return e.Deferred().resolve([]).promise();r=[{name:i.replace(/^.*\\/,"")}]}else r[0].name===undefined&&r[0].fileName&&e.each(r,function(e,t){t.name=t.fileName,t.size=t.fileSize});return e.Deferred().resolve(r).promise()},_getFileInputFiles:function(t){return t instanceof e&&t.length!==1?e.when.apply(e,e.map(t,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(t)},_onChange:function(t){var n=this,r={fileInput:e(t.target),form:e(t.target.form)};this._getFileInputFiles(r.fileInput).always(function(i){r.files=i,n.options.replaceFileInput&&n._replaceFileInput(r),n._trigger("change",e.Event("change",{delegatedEvent:t}),r)!==!1&&n._onAdd(t,r)})},_onPaste:function(t){var n=t.originalEvent&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items,r={files:[]};n&&n.length&&(e.each(n,function(e,t){var n=t.getAsFile&&t.getAsFile();n&&r.files.push(n)}),this._trigger("paste",e.Event("paste",{delegatedEvent:t}),r)!==!1&&this._onAdd(t,r))},_onDrop:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var n=this,r=t.dataTransfer,i={};r&&r.files&&r.files.length&&(t.preventDefault(),this._getDroppedFiles(r).always(function(r){i.files=r,n._trigger("drop",e.Event("drop",{delegatedEvent:t}),i)!==!1&&n._onAdd(t,i)}))},_onDragOver:t("dragover"),_onDragEnter:t("dragenter"),_onDragLeave:t("dragleave"),_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave}),this._on(this.options.pasteZone,{paste:this._onPaste})),e.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_setOption:function(t,n){var r=e.inArray(t,this._specialOptions)!==-1;r&&this._destroyEventHandlers(),this._super(t,n),r&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var t=this.options;t.fileInput===undefined?t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):t.fileInput instanceof e||(t.fileInput=e(t.fileInput)),t.dropZone instanceof e||(t.dropZone=e(t.dropZone)),t.pasteZone instanceof e||(t.pasteZone=e(t.pasteZone))},_getRegExp:function(e){var t=e.split("/"),n=t.pop();return t.shift(),new RegExp(t.join("/"),n)},_isRegExpOption:function(t,n){return t!=="url"&&e.type(n)==="string"&&/^\/.*\/[igm]{0,3}$/.test(n)},_initDataAttributes:function(){var t=this,n=this.options,r=this.element.data();e.each(this.element[0].attributes,function(e,i){var s=i.name.toLowerCase(),o;/^data-/.test(s)&&(s=s.slice(5).replace(/-[a-z]/g,function(e){return e.charAt(1).toUpperCase()}),o=r[s],t._isRegExpOption(s,o)&&(o=t._getRegExp(o)),n[s]=o)})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var n=this;if(!t||this.options.disabled)return;t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(e){t.files=e,n._onAdd(null,t)}):(t.files=e.makeArray(t.files),this._onAdd(null,t))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var n=this,r=e.Deferred(),i=r.promise(),s,o;return i.abort=function(){return o=!0,s?s.abort():(r.reject(null,"abort","abort"),i)},this._getFileInputFiles(t.fileInput).always(function(e){if(o)return;if(!e.length){r.reject();return}t.files=e,s=n._onSend(null,t),s.then(function(e,t,n){r.resolve(e,t,n)},function(e,t,n){r.reject(e,t,n)})}),this._enhancePromise(i)}t.files=e.makeArray(t.files);if(t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})}),define("modules/account-import/views/file-upload-view",["classes/item-view","services/accounts-service","ui/modules/popup/popup-module","utils/util","hbs!modules/account-import/templates/file-upload","libs/jquery-file-upload/jquery.fileupload"],function(e,t,n,r,i){var s=e.extend({template:i,events:{"click .sf-file-upload-next":"_fileUploadNext","click .sf-file-upload-fake-button":"_uploadFile","click .sf-file-upload-cancel":"_cancelFileUpload"},ui:{$form:".sf-file-upload-form"},initialize:function(){this._super.apply(this,arguments),this.accountsService=t.getInstance(),this.uscId=this.options.uscId,this.fileUploadData=null},render:function(){this._super();var e=this;r.validator.validate(this.ui.$form),this.$(".sf-file-upload-field").fileupload({dataType:"json",dropZone:this.$(".sf-file-upload-drop"),url:r.config.getGlobals().environment.contextPath+"/manualaccounts/file/upload.action",add:function(t,n){r.mask(e.$el,r.MASK_LOADING),n.submit()},done:function(t,n){console.log(n.result),r.unmask(e.$el),e.fileUploadData=n.result,e._checkFileUploadError(n.result.status)}})},serializeData:function(){return{uscId:this.uscId}},_checkFileUploadError:function(e){e===undefined&&(e=102),e===0||e===3?this.trigger("file-upload:next",this.fileUploadData):e>0&&(r.indexOf([1,5,6,7,100,101,103],e)<0&&(e=102),this.$(".sf-file-upload-message").addClass("sf-error"),this.$(".sf-file-upload-message").html(r.i18n.get("account-import.status.uploadError"+e)))},_fileUploadNext:function(){this.$(".sf-file-upload-message").addClass("sf-error"),this.$(".sf-file-upload-message").html(r.i18n.get("account-import.status.uploadErrorEmpty"))},_uploadFile:function(e){this.$(e.currentTarget).siblings(".sf-file-upload-field").click()},_cancelFileUpload:function(){var e=this;this.trigger("file-upload:cancel"),r.when(this.accountsService.cancelManualAccount({uscId:this.uscId})).done(function(){}).fail(function(t){e.publish("error",t)})}},{defaults:{}});return s}),define("hbs!modules/account-import/templates/automatic-upload",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-automatic-upload">\n	<h3>',u={hash:{}},s+=f((o=n.t,o?o.call(t,"account-import.stepAutomatic",u):a.call(t,"t","account-import.stepAutomatic",u)))+'</h3>\n	<form class="sf-automatic-upload-form">\n		<fieldset>\n			<p class="sf-automatic-upload-desc">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"account-import.automaticUploadDesc",u):a.call(t,"t","account-import.automaticUploadDesc",u)))+'</p>\n			<div class="sf-form-row">\n			<label class="sf-automatic-upload-label">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"account-import.userName",u):a.call(t,"t","account-import.userName",u)))+":</label>\n			",u={hash:{name:"user",type:"text"}},s+=f((o=n.textfield,o?o.call(t,u):a.call(t,"textfield",u)))+'\n			</div>\n			<div class="sf-form-row">\n				<label class="sf-automatic-upload-label">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"account-import.password",u):a.call(t,"t","account-import.password",u)))+":</label>\n				",u={hash:{name:"password",type:"password"}},s+=f((o=n.textfield,o?o.call(t,u):a.call(t,"textfield",u)))+'\n			</div>\n			<div class="sf-form-row">\n				<label class="sf-automatic-upload-label">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"account-import.confirmPassword",u):a.call(t,"t","account-import.confirmPassword",u)))+":</label>\n				",u={hash:{name:"confirm",type:"password"}},s+=f((o=n.textfield,o?o.call(t,u):a.call(t,"textfield",u)))+'\n			</div>\n		</fieldset>\n		<div class="sf-footer-buttons">\n			',u={hash:{"class":"sf-button-save sf-automatic-upload-continue",type:"submit",text:"common.button.save"}},s+=f((o=n.button,o?o.call(t,u):a.call(t,"button",u)))+"\n			",u={hash:{"class":"sf-button-cancel sf-automatic-upload-cancel",text:"common.button.cancel"}},s+=f((o=n.button,o?o.call(t,u):a.call(t,"button",u)))+"\n		</div>\n	</form>\n</div>",s});return t.registerPartial("modules_account-import_templates_automatic-upload",n),n}),define("modules/account-import/views/automatic-upload-view",["classes/item-view","services/accounts-service","utils/util","hbs!modules/account-import/templates/automatic-upload"],function(e,t,n,r){var i=e.extend({template:r,events:{"click .sf-automatic-upload-next":"_automaticUploadNext","click .sf-automatic-upload-cancel":"_cancelAutomaticUpload"},ui:{$form:".sf-file-upload-form"},initialize:function(){this._super.apply(this,arguments),this.accountsService=t.getInstance(),this.uscId=this.options.uscId},render:function(){this._super(),n.validator.validate(this.ui.$form)},serializeData:function(){return{uscId:this.uscId}},_automaticUploadNext:function(){this.trigger("automatic-upload:next",{uscId:this.uscId})},_cancelAutomaticUpload:function(){this.trigger("automatic-upload:cancel")}},{defaults:{}});return i}),define("hbs!modules/account-import/templates/transaction-preview-list-item-view",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing;return s+='<tr>\n	<td class="sf-merchant-col"><div>',(o=n.merchant)?o=o.call(t,{hash:{}}):(o=t.merchant,o=typeof o===a?o.apply(t):o),s+=f(o)+'</div></td>\n	<td class="sf-date-col">',u={hash:{}},s+=f((o=n.formatDate,o?o.call(t,t.date,"MMM dd, yyyy",u):l.call(t,"formatDate",t.date,"MMM dd, yyyy",u)))+'</td>\n	<td class="sf-amount-col">',u={hash:{}},s+=f((o=n.formatAmount,o?o.call(t,t.amount,u):l.call(t,"formatAmount",t.amount,u)))+"</td>\n</tr>",s});return t.registerPartial("modules_account-import_templates_transaction-preview-list-item-view",n),n}),define("modules/account-import/views/transaction-preview-list-item-view",["classes/item-view","utils/util","hbs!modules/account-import/templates/transaction-preview-list-item-view","utils/amount","utils/date"],function(e,t,n){var r=e.extend({template:n,initialize:function(){this._super.apply(this,arguments),this.listenTo(this.model,"change",this.render)},serializeData:function(){var e=this.model.get("merchant").name,t=this.model.get("date").name,n=this.model.get("amount").name;return{merchant:e,date:t,amount:n}}});return r}),define("hbs!modules/account-import/templates/transaction-preview",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var n="",r;return n+='\n					<span class="sf-merchant-name">'+l((r=(r=e.merchant,r==null||r===!1?r:r.name),typeof r===f?r.apply(e):r))+'</span>\n					<input type="hidden" name="mappingName" value="'+l((r=(r=e.merchant,r==null||r===!1?r:r.value),typeof r===f?r.apply(e):r))+'" />\n				',n}function d(e,t){var r="",i,s;return r+="\n					",s={hash:{name:"mappingName","class":"sf-merchant-name",options:"{{merchants}}",currentOption:"0"}},r+=l((i=n.select,i?i.call(e,s):c.call(e,"select",s)))+"\n				",r}function v(e,t){var r="",i,s;return r+='\n					<span class="sf-merchant-date">',s={hash:{}},r+=l((i=n.formatDate,i?i.call(e,(i=e.date,i==null||i===!1?i:i.name),"MMM dd, yyyy",s):c.call(e,"formatDate",(i=e.date,i==null||i===!1?i:i.name),"MMM dd, yyyy",s)))+'</span>\n					<input type="hidden" name="mappingDate" value="'+l((i=(i=e.date,i==null||i===!1?i:i.value),typeof i===f?i.apply(e):i))+'" />\n				',r}function m(e,t){var r="",i,s;return r+="\n					",s={hash:{name:"mappingDate","class":"sf-merchant-date",options:"{{dates}}",currentOption:"0"}},r+=l((i=n.select,i?i.call(e,s):c.call(e,"select",s)))+"\n				",r}function g(e,t){var r="",i,s;return r+='\n					<span class="sf-merchant-amount">',s={hash:{}},r+=l((i=n.formatAmount,i?i.call(e,(i=e.amount,i==null||i===!1?i:i.name),s):c.call(e,"formatAmount",(i=e.amount,i==null||i===!1?i:i.name),s)))+'</span>\n					<input type="hidden" name="mappingAmount" value="'+l((i=(i=e.amount,i==null||i===!1?i:i.value),typeof i===f?i.apply(e):i))+'" />\n				',r}function y(e,t){var r="",i,s;return r+="\n					",s={hash:{name:"mappingAmount","class":"sf-merchant-amount",options:"{{amounts}}",currentOption:"0"}},r+=l((i=n.select,i?i.call(e,s):c.call(e,"select",s)))+"\n				",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;s+='<div class="sf-transaction-preview">\n	<h3>',a={hash:{}},s+=l((o=n.t,o?o.call(t,"account-import.step3",a):c.call(t,"t","account-import.step3",a)))+'</h3>\n	<form class="sf-transaction-preview-form">\n		<fieldset>\n			<p class="sf-transaction-preview-desc">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"account-import.previewDesc",a):c.call(t,"t","account-import.previewDesc",a)))+'</p>\n			<div class="sf-form-row">\n				<label class="sf-merchant-label">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"account-import.merchantLabel",a):c.call(t,"t","account-import.merchantLabel",a)))+":</label>\n				",u=n["if"].call(t,t.merchant,{hash:{},inverse:h.program(3,d,i),fn:h.program(1,p,i)});if(u||u===0)s+=u;s+='\n			</div>\n			<div class="sf-form-row">\n				<label class="sf-date-label">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"account-import.dateLabel",a):c.call(t,"t","account-import.dateLabel",a)))+":</label>\n				",u=n["if"].call(t,t.date,{hash:{},inverse:h.program(7,m,i),fn:h.program(5,v,i)});if(u||u===0)s+=u;s+='\n			</div>\n			<div class="sf-form-row">\n				<label class="sf-amount-label">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"account-import.amountLabel",a):c.call(t,"t","account-import.amountLabel",a)))+":</label>\n				",u=n["if"].call(t,t.amount,{hash:{},inverse:h.program(11,y,i),fn:h.program(9,g,i)});if(u||u===0)s+=u;return s+='\n			</div>\n		</fieldset>\n		<fieldset>\n			<table class="sf-transactions-table">\n				<thead>\n					<th class="sf-merchant-col">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"account-import.merchantLabel",a):c.call(t,"t","account-import.merchantLabel",a)))+'</th>\n					<th class="sf-date-col">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"account-import.dateLabel",a):c.call(t,"t","account-import.dateLabel",a)))+'</th>\n					<th class="sf-amount-col">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"account-import.amountLabel",a):c.call(t,"t","account-import.amountLabel",a)))+'</th>\n				</thead>\n				<tbody class="sf-transactions-list">\n				</tbody>\n			</table>\n			<div class="sf-preview-buttons">\n				',a={hash:{"class":"sf-swap-date",text:"account-import.swapDateButton"}},s+=l((o=n.button,o?o.call(t,a):c.call(t,"button",a)))+'\n				<input type="hidden" name="switchOperamt" value="0" />\n				',a={hash:{"class":"sf-swap-amount",text:"account-import.swapAmountButton"}},s+=l((o=n.button,o?o.call(t,a):c.call(t,"button",a)))+'\n				<input type="hidden" name="switchDayByMonth" value="0" />\n			</div>\n		</fieldset>\n		<div class="sf-footer-buttons">\n			',a={hash:{"class":"sf-transaction-preview-back",text:"account-import.backButton"}},s+=l((o=n.button,o?o.call(t,a):c.call(t,"button",a)))+"\n			",a={hash:{"class":"sf-button-save sf-transaction-preview-continue",type:"submit",text:"account-import.finishButton"}},s+=l((o=n.button,o?o.call(t,a):c.call(t,"button",a)))+"\n			",a={hash:{"class":"sf-button-cancel sf-transaction-preview-cancel",text:"account-import.skipButton"}},s+=l((o=n.button,o?o.call(t,a):c.call(t,"button",a)))+"\n		</div>\n	</form>\n</div>",s});return t.registerPartial("modules_account-import_templates_transaction-preview",n),n}),define("modules/account-import/views/transaction-preview-view",["classes/composite-view","classes/collection","services/accounts-service","modules/account-import/views/transaction-preview-list-item-view","utils/util","ui/modules/reform/select/select-module","hbs!modules/account-import/templates/transaction-preview","utils/date","utils/amount"],function(e,t,n,r,i,s,o){var u=e.extend({itemView:r,itemViewContainer:".sf-transactions-list",template:o,events:{"change select.sf-merchant-name":"_ambiguousMerchantChanged","change select.sf-merchant-date":"_ambiguousDateChanged","change select.sf-merchant-amount":"_ambiguousAmountChanged","click .sf-swap-date":"_swapFormattedDate","click .sf-swap-amount":"_swapFormattedAmount","click .sf-transaction-preview-back":"_transactionPreviewBack","submit .sf-transaction-preview-form":"_saveAccountPreview","click .sf-transaction-preview-cancel":"_cancelTransactionPreview"},ui:{$form:".sf-transaction-preview-form"},initialize:function(e){this._super.apply(this,arguments),this.accountsService=n.getInstance(),this.previewData=e.previewData,this.uscId=e.uscId,this.collection=this._prepareCollectionData()},render:function(){this._super(),s.init(this.$el)},serializeData:function(){var e=this.collection.models[0],t=i.compact(e.get("merchants")),n=i.compact(e.get("dates")),r=i.compact(e.get("amounts"));return{merchant:t.length===1?t[0]:null,merchants:t,date:n.length===1?n[0]:null,dates:n,amount:r.length===1?r[0]:null,amounts:r}},_prepareCollectionData:function(){var e=this,n=[];return i.each(this.previewData.opSample,function(t){var r=[],s=[],o=[];e.previewData.ambiguous?(i.each(e.previewData.ambiguousMap.name,function(e){r[e]={name:t[e],value:e}}),i.each(e.previewData.ambiguousMap.date,function(e){s[e]={name:t[e],value:e}}),i.each(e.previewData.ambiguousMap.amount,function(e){o[e]={name:t[e],value:e}})):(r[0]={name:t[0],value:0},o[1]={name:t[1],value:1},s[2]={name:t[2],value:2}),n.push({merchant:i.compact(r)[0],merchants:r,date:i.compact(s)[0],dates:s,amount:i.compact(o)[0],amounts:o})}),new t(n)},_ambiguousMerchantChanged:function(e){var t=this.$(e.currentTarget).val();i.each(this.collection.models,function(e){e.set("merchant",{name:e.get("merchants")[t].name,value:e.get("merchants")[t].value})})},_ambiguousDateChanged:function(e){var t=this.$(e.currentTarget).val();i.each(this.collection.models,function(e){e.set("date",{name:e.get("dates")[t].name,value:e.get("dates")[t].value})})},_ambiguousAmountChanged:function(e){var t=this.$(e.currentTarget).val();i.each(this.collection.models,function(e){e.set("amount",{name:e.get("amounts")[t].name,value:e.get("amounts")[t].value})})},_swapFormattedDate:function(){i.each(this.collection.models,function(e){var t=e.get("date").name,n=t.substring(0,4),r=t.substring(5,7),i=t.substring(8,10);e.set("date",{name:n+"-"+i+"-"+r,value:e.get("date").value})}),this.$(".sf-transaction-preview-form [name=switchDayByMonth]").val()==="1"?this.$(".sf-transaction-preview-form [name=switchDayByMonth]").val(0):this.$(".sf-transaction-preview-form [name=switchDayByMonth]").val(1)},_swapFormattedAmount:function(){i.each(this.collection.models,function(e){var t=e.get("amount").name;e.set("amount",{name:t*-1,value:e.get("amount").value})}),this.$(".sf-transaction-preview-form [name=switchOperamt]").val()==="1"?this.$(".sf-transaction-preview-form [name=switchOperamt]").val(0):this.$(".sf-transaction-preview-form [name=switchOperamt]").val(1)},_saveAccountPreview:function(){var e=i.serializeForm(this.$(".sf-transaction-preview-form"));return e.uscId=this.uscId,e.opEncodedFile=this.previewData.opEncodedFile,e.uploadFileName=this.previewData.opUploadFileName,e.uploadContentType=this.previewData.opUploadContentType,this.trigger("transaction-preview:next",e),!1},_transactionPreviewBack:function(){this.trigger("transaction-preview:back",this.uscId)},_cancelTransactionPreview:function(){var e=this;this.trigger("transaction-preview:cancel"),i.when(this.accountsService.cancelManualAccount({uscId:this.uscId})).done(function(){}).fail(function(t){e.publish("error",t)})}});return u}),define("hbs!modules/account-import/templates/account-import",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-account-import">\n	<div class="sf-account-import-placeholder"></div>\n	<div class="sf-account-manual"></div>\n</div>'});return t.registerPartial("modules_account-import_templates_account-import",n),n}),define("libs/require/css/css!modules/account-import/css/account-import",[],function(){}),define("modules/account-import/account-import-module",["classes/layout","classes/collection","classes/model","services/accounts-service","modules/account-import/views/account-selection-view","modules/account-import/views/file-upload-view","modules/account-import/views/automatic-upload-view","modules/account-import/views/transaction-preview-view","utils/util","hbs!modules/account-import/templates/account-import","css!modules/account-import/css/account-import"],function(e,t,n,r,i,s,o,u,a,f){var l=e.extend({template:f,regions:{accountImportRegion:".sf-account-import-placeholder"},initialize:function(){this._super.apply(this,arguments),this.accountsService=r.getInstance(),this.uscId=this.options.uscId},render:function(e){var t=this;if(e)return this._super();if(this.uscId)return this._super(),this._showFileUploadView(this.uscId),!1;a.when(this.accountsService.getInstitutions()).done(a.bind(t._dataReceived,t)).fail(function(e){console.error("Error while loading accounts ",e),t.publish("error",e)})},_dataReceived:function(e){this.entities=new t(e.toJSON()),this.entities.push(new n({name:"default"})),this.render(!0),this._showAccountSelectionView()},_showAccountSelectionView:function(){var e=new i(a.extend({entities:this.entities,automaticImport:this.config.automaticImport},this.contextConfig));this.accountImportRegion.show(e),this.listenTo(e,"account-selection:next",this._showAutomaticOrFileView),this.listenTo(e,"account-selection:cancel",this._closeAccountImport)},_showAutomaticOrFileView:function(e){typeof e!="number"&&this.config.automaticImport?this._showAutomaticUploadView(e):this._showFileUploadView(e)},_showFileUploadView:function(e){this.uscId=e;var t=new s(a.extend({uscId:this.uscId},this.contextConfig));this.accountImportRegion.show(t),this.listenTo(t,"file-upload:next",this._showTransactionPreviewView),this.listenTo(t,"file-upload:cancel",this._closeAccountImport)},_showAutomaticUploadView:function(){var e=new o(a.extend({uscId:this.uscId},this.contextConfig));this.accountImportRegion.show(e),this.listenTo(e,"automatic-upload:next",this._showTransactionPreviewView),this.listenTo(e,"automatic-upload:cancel",this._closeAccountImport)},_showTransactionPreviewView:function(e){var t=new u(a.extend({previewData:e,uscId:this.uscId},this.contextConfig));this.accountImportRegion.show(t),this.listenTo(t,"transaction-preview:next",this._saveTransactionPreview),this.listenTo(t,"transaction-preview:cancel",this._closeAccountImport),this.listenTo(t,"transaction-preview:back",this._showFileUploadView)},_saveTransactionPreview:function(e){var t=this;a.mask(this.$el,a.MASK_LOADING),a.when(this.accountsService.saveFileMapping(e)).done(a.bind(this._closeAccountImport,this)).fail(function(e){a.unmask(t.$el),console.error("Error while loading accounts ",e),t.publish("error",e)})},_closeAccountImport:function(){this.trigger("account-import.close")}},{ID:"account-import",defaults:{automaticImport:!1}});return l}),define("data/categories/category-model",["classes/model","utils/util","utils/config"],function(e,t){var n=e.extend({idAttribute:"catId",save:function(e,n){var r=t.config.getGlobals().environment.contextPath+"/categories/create.action";this.isNew()||(e.id=this.id,r=t.config.getGlobals().environment.contextPath+"/categories/update.action");var i=t.extend({data:t.param(e),url:r,type:"POST",parse:!0,wait:!0},n);return this._super(e,i)},preview:function(e){var n=t.config.getGlobals().environment.contextPath+"/details/count.action";return t.ajax({url:n,type:"GET",dataType:"json",data:t.param(e)})},destroy:function(e){var n=t.extend({url:t.config.getGlobals().environment.contextPath+"/categories/delete.action",data:t.param({id:this.id}),type:"POST",wait:!0},e);return this._super(t.extend({},e,n))},discardSubCategory:function(e){var n=this.get("categories");n!==undefined&&n.splice(t.indexOf(n,e),1)}});return n}),define("data/categories/category-collection",["classes/collection","data/categories/category-model","utils/util"],function(e,t,n){var r=e.extend({model:t,url:"/categories/get/all.action",set:function(t,n){var r=e.prototype.set.apply(this,[t,n]);return this._parseCollection(r)},_parseCollection:function(e){this.hash={};var r={silent:!0};return n.each(e.models,function(e){this.hash[e.get("catId")]=e;var i=e.get("categories");i&&i.length>0&&n.each(i,function(n,s){i[s]=new t(n),i[s].set("parent",e,r),this.hash[i[s].get("catId")]=i[s]},this)},this),e}});return r}),define("data/categories/categories-data-manager",["classes/data-manager","data/categories/category-model","data/categories/category-collection","classes/remote-error","utils/util"],function(e,t,n,r,i){var s=e.extend({initialize:function(){this._super.apply(this,arguments),this.collectionDefs={categories:{type:n,modelUpdated:this._categoryUpdated,modelRemoved:this._categoryRemoved,modelAdded:this._categoryAdded}}},get:function(e){return this.getCollection("categories",{force:e})},preview:function(e){var n=new t,s=new i.Deferred;return i.when(n.preview(e)).done(function(e){s.resolve(e)}).fail(function(e){s.reject(new r(e))}),s.promise()},remove:function(e){var t=this._getCat(e),n=new i.Deferred;return t===null?null:(t.once("destroy",this._categoryDestroySuccess,this),i.when(t.destroy()).done(function(e){n.resolve(e)}).fail(function(e){n.reject(new r(e))}),n.promise())},create:function(e){var n=new t,s=new i.Deferred;return n.once("sync",this._categoryCreateSuccess,this),i.when(n.save(e)).done(function(e){s.resolve(e)}).fail(function(e){s.reject(new r(e))}),s.promise()},update:function(e){var t=this._getCat(e.id),n=new i.Deferred;return t===null?null:(t.once("sync",this._categoryUpdateSuccess,this),i.when(t.save({name:e.name,parentCatId:t.get("parentCatId")})).done(function(e){n.resolve(e)}).fail(function(e){n.reject(new r(e))}),n.promise())},_getCat:function(e){var t=this._collections.categories,n;return t===undefined||(n=t.hash[e])===undefined?null:n},_categoryDestroySuccess:function(e){var t=this._collections.categories;e.get("parent").discardSubCategory(e),delete t.hash[e.id],t.trigger("remove",e)},_categoryCreateSuccess:function(e){var t=this._collections.categories,n=this._getCat(e.get("parentCatId"));if(n===null)return null;e.set("parent",n,{silent:!0}),t.hash[e.get("catId")]=e,n.get("categories").push(e),t.trigger("add",e)},_categoryUpdateSuccess:function(e){var t=this._collections.categories;t!==undefined&&t.trigger("change",e)},_categoryUpdated:function(e){this.publish(s.events.CATEGORY_CHANGE,e)},_categoryRemoved:function(e){this.publish(s.events.CATEGORY_REMOVE,e)},_categoryAdded:function(e){this.publish(s.events.CATEGORY_ADD,e)}},{events:{CATEGORY_CHANGE:"category:change",CATEGORY_REMOVE:"category:remove",CATEGORY_ADD:"category:add"}});return s}),define("services/categories-service",["classes/service","classes/observable","utils/util","data/categories/categories-data-manager","classes/resource-loader","data/categories/category-model","classes/collection"],function(e,t,n,r,i,s,o){var u=e.extend({initialize:function(){this._super.apply(this,arguments),this.categoriesDM=r.getInstance()},create:function(e){return this.categoriesDM.create(e)},update:function(e){return this.categoriesDM.update(e)},preview:function(e){return e=e||{},this.categoriesDM.preview(e)},remove:function(e){return this.categoriesDM.remove(e)},getPlainCategories:function(){var e=this,r=new n.Deferred;return n.when(this.categoriesDM.get()).done(function(n){var i=e._parseSimpleCategories({data:n});e.resultObj||(e.resultObj=new t),e.resultObj.data=i,e.resultObj.dispose=function(){this.off()},r.resolve(e.resultObj),n.on("all",function(t){e.resultObj.data=e._parseSimpleCategories({data:n}),e.resultObj.trigger(t,e.resultObj)})}).fail(function(e){r.reject(e)}),r.promise()},get:function(){return this.categoriesDM.get()},_parseCategoryCollection:function(e){return e.map(function(e){var t={value:e.id,name:e.get("catName"),custom:e.get("catIsCustom"),isIncome:e.get("catIsIncome"),color:"#"+e.get("catHexrgbcolor")},n=e.get("categories");return n&&n.length>0&&(t.children=this._parseCategoryCollection(new o(n))),t},this)},_parseSimpleCategories:function(e){var t=e.data;return{categories:this._parseCategoryCollection(t)}}},{ID:"categories-service",defaults:{validator:{rules:{customCategory:{name:{required:!0,rangelength:[3,64],type:"description",notinlist:"names"},select:{required:!0,type:"number",min:1}}}}}});return u}),define("data/transactions/transaction-model",["classes/model","utils/date","utils/amount","utils/config"],function(e,t){var n=e.extend({idAttribute:"transactionId",url:"/details/update.action",initialize:function(e,n){this._super.apply(this,arguments);if(typeof e!="undefined"){var r={};this.get("postedDateStr")!==undefined&&(r.date=t.date.parseBackendDate(this.get("postedDateStr"))),this.get("catId")!==undefined&&n.categories!==undefined&&(r.category=n.categories.hash[this.get("catId")]),this.set(r,{silent:!0}),this.set({freeText:this.computeFreeText()})}},parse:function(e){var t=this._super(e);return t.id!==undefined&&t.accType!==undefined&&(t.transactionId=t.id+"-"+t.accType),t.accType!==undefined&&t.accId!==undefined&&(t.accountPK=t.accType+"-"+t.accId),t},computeFreeText:function(){var e=[this.get("name")],n;return this.get("category")!==undefined&&(e.push(this.get("category").get("catName")),this.get("category").get("parent")&&e.push(this.get("category").get("parent").get("catName"))),e.push(this.get("accName")),e.push(t.date.format(this.get("date"),"MMMM d, 'yyyy")),e.push(t.date.format(this.get("date"),"dd/MM/yy")),e.push(t.amount.format(this.get("amount"))),e.push(this.get("amount").toString()),this.get("tags")&&(n=this.get("tags").split(",").join("##"),e.push(n)),e.join("##").toUpperCase()},save:function(e,n){var r={updateItem:{operations:[this.pick("id","accType","accId")]}},i=this;t.extend(r.updateItem,e);var s=t.extend({data:t.param(r),type:"POST",wait:!0,url:t.config.getGlobals().environment.contextPath+"/details/update.action",success:function(e,t,n){console.log("[TransactionModel] initialize transaction"),i.initialize(i.attributes,n)}},n);return this._super(e,s)},createCash:function(e){var n={cashOperationItem:e};return t.ajax({url:t.config.getGlobals().environment.contextPath+"/accounts/cash/operations/create.action",type:"POST",dataType:"json",data:t.param(n)})},createAccountOperation:function(e){var n={createItem:e};return t.ajax({url:t.config.getGlobals().environment.contextPath+"/details/create.action",type:"POST",dataType:"json",data:t.param(n)})},destroy:function(e){var n={accountOperation:{accId:this.get("accId"),accType:this.get("accType"),id:this.get("id")}},r=t.extend({data:t.param(n),type:"POST",wait:!0,url:t.config.getGlobals().environment.contextPath+"/accounts/cash/operations/delete.action"},e);return this._super(r)},unsplit:function(){var e={parent:this.pick("id","accId","accType")};return t.ajax({url:t.config.getGlobals().environment.contextPath+"/details/split/delete.action",type:"POST",dataType:"json",data:t.param(e)})},split:function(e){var n={parent:this.pick("id","accId","accType"),children:e};return t.ajax({url:t.config.getGlobals().environment.contextPath+"/details/split/update.action",type:"POST",dataType:"json",data:t.param(n)})},transactionParentAndChildren:function(){var e=this.pick("accType","parentAccId","parentOpId");return t.ajax({url:t.config.getGlobals().environment.contextPath+"/details/split/get.action",type:"GET",dataType:"json",data:t.param(e)})},multipleUpdate:function(e,n){var r={updateItem:{operations:t.map(e.get("transactions"),function(e){return e.pick("id","accType","accId")})}};return t.extend(r.updateItem,n),t.ajax({url:t.config.getGlobals().environment.contextPath+"/details/update.action",type:"POST",dataType:"json",data:t.param(r)})},mapping:function(e){return t.ajax({url:t.config.getGlobals().environment.contextPath+"/manualaccounts/file/mapping.action",type:"POST",data:t.param(e)})}});return n}),define("data/transactions/transaction-collection",["classes/collection","data/transactions/transaction-model"],function(e,t){var n=e.extend({model:t,url:"/details/get.action",parse:function(e){return e.operations}});return n}),define("data/rules/rule-model",["classes/model","utils/util","utils/config"],function(e,t){var n=e.extend({save:function(e,n){var r=t.config.getGlobals().environment.contextPath+"/rules/update.action",i=t.extend({data:t.param(e),url:r,type:"POST",parse:!0,wait:!0},n);return this._super(e,i)},preview:function(e){var n=t.config.getGlobals().environment.contextPath+"/rules/preview.action";return t.ajax({data:t.param(e),url:n,type:"POST",dataType:"json"})},quick:function(e){var n=t.config.getGlobals().environment.contextPath+"/rules/update/quick.action";return t.ajax({data:t.param(e),url:n,type:"POST",dataType:"json"})},destroy:function(e){var n=t.clone(e);delete n.id,n.oruId=e.id==null?"":e.id;var r=t.config.getGlobals().environment.contextPath+"/rules/delete.action",i={data:t.param(n),url:r,type:"POST",parse:!0,wait:!0};return this._super(i)}});return n}),define("data/rules/rule-collection",["classes/collection","utils/util","./rule-model"],function(e,t,n){var r=e.extend({model:n,url:"/rules/get/all.action",parse:function(e){return e.rules}});return r}),define("data/rules/rules-data-manager",["classes/data-manager","data/rules/rule-model","data/rules/rule-collection","utils/util","classes/remote-error"],function(e,t,n,r,i){var s=e.extend({initialize:function(){this._super.apply(this,arguments),this.collectionDefs={rules:{type:n,modelAdded:this._ruleAdded,modelRemoved:this._ruleRemoved,modelUpdated:this._ruleUpdated}}},getRules:function(e){return this.getCollection("rules",e)},createRule:function(e){var n=new t,s=this.getCollection("rules"),o=n.save(e),u=new r.Deferred;return r.when(o,s).done(function(e,t){t.add(n,{merge:!0}),u.resolve(n)}).fail(function(e){console.error("[RulesDataManager] Error creating rule",e),u.reject(new i(e))}),u.promise()},previewRule:function(e){var n=new t;return r.when(n.preview(e))},quickCreateRule:function(e){var n=new t,s=this.getCollection("rules"),o=n.quick(e),u=new r.Deferred;return r.when(o).done(function(e){r.when(s).done(function(t){t.add(e,{merge:!0}),u.resolve(e)}).fail(function(e){console.error("[RulesDataManager] Error creating quick rule",e),u.reject(new i(e))})}).fail(function(e){console.error("[RulesDataManager] Error creating quick rule",e),u.reject(new i(e))}),u.promise()},removeRule:function(e){var t=new r.Deferred,n=this.getCollection("rules");return r.when(n).done(function(n){var i=n.find({id:e.id});r.when(i.destroy(e)).done(function(e){t.resolve(e)}).fail(function(){})}).fail(function(e){t.reject(new i(e))}),t.promise()},_ruleAdded:function(e){this.publish(s.events.RULE_ADD,e)},_ruleRemoved:function(e){this.publish(s.events.RULE_REMOVE,e)},_ruleUpdated:function(e){this.publish(s.events.RULE_CHANGE,e)},_ruleDeleteSuccess:function(e){var t=this._collections.rules;t.trigger("remove",e)}},{events:{RULE_ADD:"rule:add",RULE_REMOVE:"rule:remove",RULE_CHANGE:"rule:change"}});return s}),define("data/transactions/transactions-data-manager",["classes/data-manager","data/transactions/transaction-model","data/transactions/transaction-collection","data/categories/categories-data-manager","data/rules/rules-data-manager","utils/util","classes/remote-error","utils/date","utils/config"],function(e,t,n,r,i,s,o){var u=r.events.CATEGORY_REMOVE,a=i.events.RULE_ADD,f=i.events.RULE_CHANGE,l=i.events.RULE_REMOVE,c=e.extend({initialize:function(e){this._super.apply(this,arguments),this.dateBuckets=[],this.collectionDefs={transactions:{type:n,modelUpdated:this._modelUpdated,modelAdded:this._modelAdded,modelRemoved:this._modelRemoved,subscriptions:[u,a,f,l,c.events.TRANSACTIONS_IMPORTED,"account:update","transaction:add"],loader:{method:this.get,context:this}}},this.categoriesDM=r.getInstance(),this.options=s.merge(c.defaults,e)},parseTransactions:function(e){var r=this.categoriesDM.get(),i=new s.Deferred;return s.when(r).done(function(r){var o=s.map(e,function(e){return new t(e,{parse:!0,categories:r})});i.resolve(new n(o))}).fail(function(e){console.error("[TransactionsDataManager] Error retrieveing categories",e),i.reject(new o(e))}),i.promise()},addTransactions:function(e){var t=this._collections.transactions;t===undefined&&(this._createCollection("transactions"),t=this._collections.transactions),t.add(e)},update:function(e,t){var n=this.categoriesDM.get(),r=new s.Deferred,i=s.extend({},e._changedAttributes,t);return s.when(n).done(function(n){var u=s.merge({categories:n},t);s.when(e.save(i,u)).done(function(){console.log("[TransactionsDataManager] transaction update"),r.resolve(e)}).fail(function(e){console.error("[TransactionsDataManager] Error updating transaction",e),r.reject(new o(e))})}).fail(function(e){console.error("[TransactionsDataManager] Error retrieveing categories",e),r.reject(new o(e))}),r.promise()},multipleUpdate:function(e,n){var r=this.categoriesDM.get(),i=new s.Deferred,u=new t;return s.when(r).done(function(t){var r=s.merge({categories:t},n),a=typeof n.catId!="undefined"?t.hash[n.catId]:undefined;a&&(n.computable=a.get("catComputable")),s.when(u.multipleUpdate(e,n)).done(function(){s.each(e.get("transactions"),function(e){e.set(n),e.initialize(e.attributes,r)}),i.resolve(e)}).fail(function(e){console.error("[TransactionsDataManager] Error updating transaction",e),i.reject(new o(e))})}).fail(function(e){console.error("[TransactionsDataManager] Error retrieveing categories",e),i.reject(new o(e))}),i.promise()},createCashTransaction:function(e){var n=new t,r=this.categoriesDM.get(),i=n.createCash(e),u=new s.Deferred,a=this;return s.when(i).done(function(i){s.when(r).done(function(r){n=new t(s.extend(e,i),{parse:!0,categories:r}),a.addTransactions([n]),u.resolve(n)}).fail(function(e){console.error("[TransactionsDataManager] Error retrieving categories",e),u.reject(new o(e))})}).fail(function(e){console.error("[TransactionsDataManager] Error creating cash transaction",e),u.reject(new o(e))}),u.promise()},createManualTransaction:function(e){var n=new t,r=this.categoriesDM.get(),i=n.createAccountOperation(e),u=new s.Deferred,a=this;return s.when(i).done(function(i){s.when(r).done(function(r){n=new t(s.extend(e,i),{parse:!0,categories:r}),a.addTransactions([n]),u.resolve(n)}).fail(function(e){console.error("[TransactionsDataManager] Error retrieving categories",e),u.reject(new o(e))})}).fail(function(e){console.error("[TransactionsDataManager] Error creating manual transaction",e),u.reject(new o(e))}),u.promise()},removeTransactions:function(e){var t=this._collections.transactions,n=new s.Deferred;return typeof t!="undefined"?(s.when(t.remove(e)).done(function(e){n.resolve(e)}).fail(function(e){n.reject(new o(e))}),n.promise()):[]},removeTransactionsByParent:function(e){var t=this._collections.transactions;if(typeof t!="undefined"){var n=t.filter(function(t){var n=t.get("parentOpId")===e.get("id");return n?t.get("accountPK")===e.get("accountPK"):!1});return this.removeTransactions(n)}},get:function(e){var t=this;e=e||{},console.log("[TransactionsDataManager] Transactions get from %s to %s.",e.fromDate,e.toDate);var n=this.categoriesDM.get(),r=new s.Deferred;return s.when(n).done(function(n){console.log("[TransactionsDataManager] Transactions get: Categories ready."),e.categories=n,s.when(t.getCollection("transactions",e)).done(function(e){console.log("[TransactionsDataManager] Transactions resolved."),r.resolve(e)}).fail(function(e){console.error("[TransactionsDataManager] Error retrieveing transactions",e),r.reject(new o(e))})}).fail(function(e){console.error("[TransactionsDataManager] Error retrieveing categories",e),r.reject(new o(e))}),r.promise()},evaluateRequestParams:function(e,t,n){n.numberOfItems=t.numberOfItems||this.options.pageSize,n.fromDate=t.fromDate?t.fromDate:this.options.defaultMinDate,n.toDate=t.toDate?t.toDate:this.options.defaultMaxDate,t["opIds[0]"]&&t["opTypes[0]"]&&(n["opIds[0]"]=t["opIds[0]"],n["opTypes[0]"]=t["opTypes[0]"]),n.fromDate=s.date.truncate(s.date.constructor.DAY,n.fromDate),n.toDate=s.date.truncate(s.date.constructor.DAY,n.toDate),n.silent=!0,n.categories=t.categories,n.parse=!0,n.recoverAllData=t.recoverAllData!==undefined?t.recoverAllData:!0;if(n.force||this.collectionDefs[e]._currentState.fromDate===undefined)console.log("[TransactionsDataManager] First request."),n.load=!0,n.remove=!0;else{var r=n.fromDate<this.collectionDefs[e]._currentState.fromDate,i=n.toDate>this.collectionDefs[e]._currentState.toDate;if(r||i)r&&!i?(n.toDate=new Date(this.collectionDefs[e]._currentState.fromDate.getTime()),n.load=!0,n.remove=!1):i&&!r?(n.fromDate=s.date.add(s.date.constructor.DAY,this.collectionDefs[e]._currentState.toDate,1),n.load=!0,n.remove=!1):i&&r&&(n.load=!0,n.remove=!0)}},onCollectionFetched:function(e,t,n){var r=this.collectionDefs[e]._currentState;if(r.fromDate===undefined||n.fromDate<r.fromDate)r.fromDate=new Date(n.fromDate.getTime());if(r.toDate===undefined||n.toDate>r.toDate)r.toDate=new Date(n.toDate.getTime());this.collectionDefs[e]._params.fromDate=new Date(r.fromDate.getTime()),this.collectionDefs[e]._params.toDate=new Date(r.toDate.getTime())},getRequestData:function(e,t,n){return n["opIds[0]"]?{"params.opIds[0]":n["opIds[0]"],"params.opTypes[0]":n["opTypes[0]"]}:{"params.fromDateStr":s.date.formatBackendDate(n.fromDate),"params.toDateStr":s.date.formatBackendDate(n.toDate),numberOfItems:n.numberOfItems,firstPosition:0,recoverAllData:n.recoverAllData}},split:function(e,t){var n=e.split(t),r=new s.Deferred,i=this;return s.when(n).done(function(t){r.resolve(t),i.publish(c.events.TRANSACTION_SPLIT,e)}).fail(function(e){r.reject(new o(e))}),r.promise()},unsplit:function(e,t){var n=e.unsplit(t),r=new s.Deferred,i=this;return s.when(n).done(function(t){r.resolve(t),i.publish(c.events.TRANSACTION_UNSPLIT,e)}).fail(function(e){r.reject(new o(e))}),r.promise()},_modelRemoved:function(e){this.publish(c.events.TRANSACTION_REMOVE,e)},_modelUpdated:function(e){this.publish(c.events.TRANSACTION_CHANGE,e),e.changed.amount&&this.publish(c.events.TRANSACTION_AMOUNT_CHANGE,e),e.changed.computable&&this.publish(c.events.TRANSACTION_COMPUTABLE_CHANGE,e),e.changed.catId&&this.publish(c.events.TRANSACTION_CATEGORY_CHANGE,e),e.changed.postedDateStr&&this.publish(c.events.TRANSACTION_DATE_CHANGE,e)},_modelAdded:function(e){this.publish(c.events.TRANSACTION_ADD,e)},mappingFile:function(e){var n=new t,r=this.categoriesDM.get(),i=n.mapping(e),u=new s.Deferred,a=this;return s.when(i).done(function(e){var t=e.result;t.opParsed&&s.when(r).done(function(){a.publish(c.events.TRANSACTIONS_IMPORTED)}).fail(function(e){u.reject(new o(e))}),u.resolve(e)}).fail(function(e){u.reject(new o(e))}),u.promise()}},{defaults:{pageSize:1e5,defaultMinDate:new Date(2011,0,1),defaultMaxDate:new Date},events:{TRANSACTION_ADD:"transaction:add",TRANSACTION_CHANGE:"transaction:change",TRANSACTION_AMOUNT_CHANGE:"transaction:amount:change",TRANSACTION_COMPUTABLE_CHANGE:"transaction:computable:change",TRANSACTION_CATEGORY_CHANGE:"transaction:category:change",TRANSACTION_DATE_CHANGE:"transaction:date:change",TRANSACTION_SPLIT:"transaction:split",TRANSACTION_UNSPLIT:"transaction:unsplit",TRANSACTION_REMOVE:"transaction:remove",TRANSACTIONS_IMPORTED:"transactions:imported"}});return c}),define("data/transactions/transaction-count-model",["classes/model","classes/remote-error","utils/util","utils/config"],function(e,t,n){var r=e.extend({url:"/details/count.action",initialize:function(){this._super.apply(this,arguments),this.url=n.apiURL(this.url)},fetch:function(e){var r=new n.Deferred,i="",s=this,o=function(e){s.set({count:e}),r.resolve(this)},u=function(e){console.error("[TransactionsDataManager] Error retrieving transactions count",e),r.reject(new t(e))};return n.each(n.pick(e,"fromDate","toDate"),function(e,t){var r=n.isDate(e)?n.date.format(e,n.date.constructor.BACKEND_FORMAT):e;i+=i.length?"&":"",i+="params."+t+"Str="+r},this),n.ajax({url:this.url,data:i+"&params.catId="+e.categories.catId,dataType:"json",success:o,error:u}),r.promise()}});return r}),define("data/transactions/transaction-count-uncat-model",["classes/model","classes/remote-error","utils/util","utils/config"],function(e,t,n){var r=e.extend({url:"/details/countUncat.action",initialize:function(){this._super.apply(this,arguments),this.url=n.apiURL(this.url)},fetch:function(e){var r=new n.Deferred,i="",s=this,o=function(e){s.set(s.parse(e)),r.resolve(this)},u=function(e){console.error("[TransactionsDataManager] Error retrieveing transactions count uncat",e),r.reject(new t(e))};return n.each(n.pick(e,"fromDate","toDate"),function(e,t){var r=n.isDate(e)?n.date.format(e,n.date.constructor.BACKEND_FORMAT):e;i+=i.length?"&":"",i+="params."+t+"Str="+r},this),n.ajax({url:this.url,data:i,dataType:"json",success:o,error:u}),r.promise()},parse:function(e){var t=this._super(e);return t.categorized=t.countTotal-t.countUncat,t.total=t.countTotal,t.uncategorized=t.countUncat,t.percent=t.categorized/t.countTotal*100,t}});return r}),define("data/transactions/transactions-count-data-manager",["classes/data-manager","data/transactions/transaction-count-model","data/transactions/transaction-count-uncat-model","data/transactions/transactions-data-manager","data/categories/categories-data-manager","classes/remote-error","utils/util"],function(e,t,n,r,i,s,o){var u=e.extend({initialize:function(e){this._super.apply(this,arguments),this.collectionDefs={"transactions-count":{type:t,subscriptions:[r.events.TRANSACTIONS_IMPORTED,r.events.TRANSACTION_ADD,r.events.TRANSACTION_CHANGE,i.events.CATEGORY_REMOVE],loader:{method:this.count,context:this}},"transactions-count-uncategorized":{type:n,subscriptions:[r.events.TRANSACTIONS_IMPORTED,r.events.TRANSACTION_ADD,r.events.TRANSACTION_CHANGE,i.events.CATEGORY_REMOVE],loader:{method:this.countUncategorized,context:this}}},this.options=o.merge(r.defaults,e)},count:function(e){var t=this,n=new o.Deferred;return o.when(t.getCollection("transactions-count",e)).done(function(e){n.resolve(e)}).fail(function(e){n.fail(e),n.reject(new s(e))}),n},countUncategorized:function(e){var t=this,n=new o.Deferred;return o.when(t.getCollection("transactions-count-uncategorized",e)).done(function(e){n.resolve(e)}).fail(function(e){n.fail(e),n.reject(new s(e))}),n},evaluateRequestParams:function(e,t,n){n.fromDate=t.fromDate?t.fromDate:this.options.defaultMinDate,n.toDate=t.toDate?t.toDate:this.options.defaultMaxDate,n.fromDate=o.date.truncate(o.date.constructor.DAY,n.fromDate),n.toDate=o.date.truncate(o.date.constructor.DAY,n.toDate),n.categories=t.categories,n.load=!0},onCollectionFetched:function(e,t,n){if(e==="transactions-count-uncategorized"){var r=this.collectionDefs[e]._currentState;if(r.fromDate===undefined||n.fromDate<r.fromDate)r.fromDate=new Date(n.fromDate.getTime());if(r.toDate===undefined||n.toDate>r.toDate)r.toDate=new Date(n.toDate.getTime());this.collectionDefs[e]._params.fromDate=new Date(r.fromDate.getTime()),this.collectionDefs[e]._params.toDate=new Date(r.toDate.getTime())}else this.collectionDefs[e]._params.categories=n.categories?n.categories:null}},{defaults:{defaultMinDate:new Date(2011,0,1),defaultMaxDate:new Date}});return u}),define("data/tags/tag-model",["classes/model"],function(e){var t=e.extend({});return t}),define("data/tags/tag-collection",["classes/collection","data/tags/tag-model"],function(e,t){var n=e.extend({model:t,url:"/tags/transactions/get/all.action"});return n}),define("data/tags/tags-data-manager",["classes/data-manager","data/tags/tag-collection","data/transactions/transactions-data-manager"],function(e,t,n){var r=n.events.TRANSACTION_CHANGE,i=n.events.TRANSACTION_REMOVE,s=n.events.TRANSACTION_ADD,o=e.extend({initialize:function(){this._super.apply(this,arguments),this.collectionDefs={tags:{type:t,subscriptions:[s,i,r]}}},get:function(e){return this.getCollection("tags",{force:e})}});return o}),define("data/transactions/transaction-filtered-collection",["classes/extensions/collection-filtering","data/transactions/transaction-collection"],function(e,t){var n=t.extend(e);return n}),define("services/transactions-service",["classes/service","utils/util","data/transactions/transactions-data-manager","data/transactions/transactions-count-data-manager","data/tags/tags-data-manager","classes/collection","services/accounts-service","data/transactions/transaction-filtered-collection","classes/resource-loader","classes/remote-error"],function(e,t,n,r,i,s,o,u,a,f){var l=e.extend({initialize:function(){this._super.apply(this,arguments),this.transactionsDM=n.getInstance(),this.transactionsCountDM=r.getInstance(),this.tagsDM=i.getInstance(),this.accountsService=o.getInstance()},get:function(e,n){e=e||{};var r=this,i=new t.Deferred;return t.when(this.transactionsDM.get(e)).done(function(e){var t=r._getFilterFunction(n),s=new u;s.setupFilter(e,t),i.resolve({data:s,dispose:function(){s.off()}})}).fail(function(e){console.error("[TransactionsService] Error retrieving transactions",e),i.reject(e)}),i.promise()},count:function(e){return e=e||{},this.transactionsCountDM.count(e)},countUncategorized:function(e){return e=e||{},this.transactionsCountDM.countUncategorized(e)},getGroupedTransactions:function(e,n){e=e||{};var r=this,i=new t.Deferred;return t.when(this.transactionsDM.get(e)).done(function(t){var o=r._getFilterFunction(n),a=new u;a.setupFilter(t,o);var f=new s(r._groupTransactions(a,e.groupBy)),l={data:f,dispose:function(){a&&(a.off(),a=null,t.off("change",c))}},c=function(){console.log("[TransactionService] Changes in transactions collection detected"),a=new u,a.setupFilter(t,o),l.data.reset(r._groupTransactions(a,e.groupBy))};t.on("change",c,this),i.resolve(l)}).fail(function(e){console.error("[TransactionsService] Error retrieving grouped transactoins",e),i.reject(e)}),i.promise()},getTransactionAndSplits:function(e){var n=this,r=new t.Deferred;return t.when(e.transactionParentAndChildren()).done(function(e){t.when(n.transactionsDM.parseTransactions(e.children),n.transactionsDM.parseTransactions([e.parent])).done(function(e,t){r.resolve({parent:t.at(0),children:e})}).fail(function(e){console.error("[TransactionsService] Error parsing transactions",e),r.reject(e)})}).fail(function(e){console.error("[TransactionsService] Error retrieving transacion's parent and children",e);var t=new f(e);r.reject(t)}),r.promise()},update:function(e,t){return this.transactionsDM.update(e,t)},multipleUpdate:function(e,t){return this.transactionsDM.multipleUpdate(e,t)},createCashTransaction:function(e){var n=new t.Deferred,r=this;return t.when(this.accountsService.getCashAccount()).done(function(i){e.accType=i.get("type"),e.accId=i.get("id"),e.accName=i.get("alias"),t.when(r.transactionsDM.createCashTransaction(e)).done(function(e){n.resolve(e)}).fail(function(e){console.error("[TransactionsService] Error creating cash transaction",e),n.reject(e)})}).fail(function(e){console.error("[TransactionsService] Error retrieving cash account",e),n.reject(e)}),n.promise()},createAccountTransaction:function(e){var n=new t.Deferred,r=this;return t.when(r.transactionsDM.createManualTransaction(e)).done(function(e){n.resolve(e)}).fail(function(e){console.error("[TransactionsService] Error creating manual account transaction",e),n.reject(e)}),n.promise()},splitTransaction:function(e,n){var r=this,i=new t.Deferred;return t.when(this.transactionsDM.split(e,n)).done(function(n){t.when(r.transactionsDM.parseTransactions(n.children)).done(function(t){r.transactionsDM.removeTransactionsByParent(e),r.transactionsDM.removeTransactions(e),r.transactionsDM.addTransactions(t.models),i.resolve(t.models)}).fail(function(e){console.error("[TransactionsService] Error parsing transactions",e),i.reject(e)})}).fail(function(e){var t=new f(e);console.error("[TransactionsService] Error splitting transaction",t),i.reject(t)}),i.promise()},unsplitTransaction:function(e,n){var r=this,i=new t.Deferred;return t.when(this.transactionsDM.unsplit(e,n)).done(function(e){t.when(r.transactionsDM.parseTransactions([e.parent])).done(function(e){var t=e.at(0);r.transactionsDM.removeTransactionsByParent(t),r.transactionsDM.addTransactions(t),i.resolve(t)}).fail(function(e){console.error("[TransactionsService] Error parsing transactions",e),i.reject(e)})}).fail(function(e){var t=new f(e);console.error("[TransactionsService] Error unsplitting transaction",t),i.reject(t)}),i.promise()},getTransactionsTags:function(){return this.tagsDM.get()},_groupTransactions:function(e,n){n=n||[];if(n.length===0)return e;var r=0,i=this,s=e.reduce(function(e,t){var s=i._getGroupKey(t,n);return e[s]===undefined?(e[s]=t.toJSON(),e[s].id=r,e[s].count=1,e[s].amount=t.get("cuxAmnt"),e[s].transactions=[t],r++):(e[s].count++,e[s].amount+=t.get("cuxAmnt"),e[s].transactions.push(t)),e},{});return t.values(s)},_getGroupKey:function(e,n){var r=t.map(n,function(t){return t(e)});return r.join("-")},_getFilterFunction:function(e){return function(n){if(!e)return!0;if(e.mode!==undefined&&e.mode!==null){if(e.mode==="income"&&n.get("amount")<0)return!1;if(e.mode==="expenses"&&n.get("amount")>0)return!1}var r=e.accounts?e.accounts.selected:null;if(r!==undefined&&r!==null&&!t.contains(r,n.get("accountPK")))return!1;if(e.category!==undefined&&e.category!==null&&parseInt(e.category,10)>=0){var i=n.get("category"),s=i.get("parent"),o=i.id===e.category,u=s&&s.id===e.category;if(!o&&!u)return!1}if(e.categories!==undefined&&e.categories!==null&&!t.contains(e.categories,n.get("category").id))return!1;if(e.name!==undefined&&e.name!==null&&n.get("name").toUpperCase().indexOf(e.name.toUpperCase())<0)return!1;if(e.datesRange){var a=e.datesRange.fromDate,f=e.datesRange.toDate;if(a!==undefined&&n.get("date")<a)return!1;if(f!==undefined&&n.get("date")>f)return!1}return e.minAmount!==undefined&&e.minAmount!==null&&n.get("amount")<e.minAmount?!1:e.maxAmount!==undefined&&e.maxAmount!==null&&n.get("amount")>e.maxAmount?!1:e.minAbsAmount!==undefined&&e.minAbsAmount!==null&&Math.abs(n.get("amount"))<e.minAbsAmount?!1:e.maxAbsAmount!==undefined&&e.maxAbsAmount!==null&&Math.abs(n.get("amount"))>e.maxAbsAmount?!1:e.computable!==undefined&&e.computable!==null&&n.get("computable")!==e.computable?!1:e.freeText!==undefined&&e.freeText!==null&&n.get("freeText").indexOf(e.freeText.toUpperCase())<0?!1:!0}}},{ID:"transactions-service",defaults:{validator:{rules:{transactionSearch:{minAbsAmount:{type:"number",range:[0,["[name=maxAbsAmount]",1e6]]},maxAbsAmount:{type:"number",range:[[0,"[name=minAbsAmount]"],1e6]},name:{type:"description"}},transaction:{date:{required:!0},name:{required:!0,rangelength:[4,128],type:"description"},category:{required:!0},amount:{required:!0,type:"number",min:.01},tags:{rangelength:[2,25],type:"alias"}},transactionSplit:{amount:{required:!0,type:"number",min:.01,sum:[".sf-input-transaction-amount",".sf-transaction-total-amount"]}},transactionTag:{name:{rangelength:[2,25],type:"alias",notinlist:"tags"},number:{range:[0,20]}}}}}});return l}),define("hbs!modules/category-selector/templates/category-select-subcategory",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing;return s+='		<label for="sf-select-subcategory-',(o=n.cid)?o=o.call(t,{hash:{}}):(o=t.cid,o=typeof o===a?o.apply(t):o),s+=f(o)+'">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"category-selector.accessible.label.subCategory",u):l.call(t,"t","category-selector.accessible.label.subCategory",u)))+"</label>\n		",u={hash:{name:"subcategory","class":"sf-select-subcategory",id:"sf-select-subcategory-{{cid}}",validateField:"customCategory.select",options:"{{subCategorySelectOptions}}",currentOption:"{{currentCategory}}"}},s+=f((o=n.select,o?o.call(t,u):l.call(t,"select",u)))+"\n",s});return t.registerPartial("modules_category-selector_templates_category-select-subcategory",n),n}),define("hbs!modules/category-selector/templates/category-select",["hbs","Handlebars","hbs!modules/category-selector/templates/category-select-subcategory"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){return"sf-hidden"}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,r=r||e.partials;var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;s+='<div>\n	<form class="sf-category-select-form sf-form-horizontal">\n		<div class="sf-form-row">\n			<label for="sf-select-category-',(o=n.cid)?o=o.call(t,{hash:{}}):(o=t.cid,o=typeof o===f?o.apply(t):o),s+=l(o)+'">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"category-selector.accessible.label.category",a):c.call(t,"t","category-selector.accessible.label.category",a)))+"</label>\n			",a={hash:{name:"category","class":"sf-select-category",id:"sf-select-category-{{cid}}",options:"{{categorySelectOptions}}",currentOption:"{{parentCategory}}"}},s+=l((o=n.select,o?o.call(t,a):c.call(t,"select",a)))+'\n		</div>\n		<div class="sf-form-row sf-subcategory-container ',u=n["if"].call(t,t.allOptionsEnabled,{hash:{},inverse:h.noop,fn:h.program(1,p,i)});if(u||u===0)s+=u;s+='">\n			',u=h.invokePartial(r["modules_category-selector_templates_category-select-subcategory"],"modules_category-selector_templates_category-select-subcategory",t,n,r);if(u||u===0)s+=u;return s+='\n		</div>\n\n		<div class="sf-button-controls">\n			',a={hash:{text:'{{t "common.button.cancel"}}',type:"button","class":"sf-button-cancel sf-select-category-cancel"}},s+=l((o=n.button,o?o.call(t,a):c.call(t,"button",a)))+"\n			",a={hash:{text:'{{t "common.button.save"}}',type:"button","class":"sf-button-save sf-select-category-save"}},s+=l((o=n.button,o?o.call(t,a):c.call(t,"button",a)))+"\n		</div>\n	</form>\n</div>",s});return t.registerPartial("modules_category-selector_templates_category-select",n),n}),define("modules/category-selector/views/category-select-view",["classes/item-view","utils/util","ui/modules/reform/select/select-module","hbs!modules/category-selector/templates/category-select","hbs!modules/category-selector/templates/category-select-subcategory"],function(e,t,n,r,i){var s=e.extend({template:r,events:{"click .sf-select-category-cancel":"_cancelChange","submit .sf-category-select-form":"_selectCategory","change select.sf-select-category":"_mainCategoryChange"},ui:{$mainCatSelect:"select.sf-select-category",$subCatContainer:".sf-subcategory-container"},initialize:function(){this._super.apply(this,arguments),this._categories=this.options.categories,this._mainCategories=this.options.mainCategories,this._subCategories=this.options.subCategories,this._selectedCatId=this.options.catId,this._parentCatId=t.find(this.options.categories,function(e){if(e.children)return t.some(e.children,{value:this._selectedCatId},this)},this),this._parentCatId!==undefined?this._parentCatId=this._parentCatId.value:this.config.allOptionsEnabled?this._parentCatId=-1:(this._parentCatId=parseInt(t.keys(this._subCategories)[0],10),this._selectedCatId=this._subCategories[this._parentCatId][0].value)},onRender:function(){this._super(),n.init(this.$el)},serializeData:function(){return{categorySelectOptions:this._mainCategories,subCategorySelectOptions:this._subCategories[this._parentCatId],currentCategory:this._selectedCatId,parentCategory:this._parentCatId,allOptionsEnabled:this._parentCatId===-1,cid:this.cid}},_cancelChange:function(){this.trigger("cancel")},_selectCategory:function(e){e.preventDefault();var t,n;this.ui.$mainCatSelect.val()===-1?(n=this.ui.$mainCatSelect.val(),t=this.ui.$mainCatSelect.find(":selected").text()):(n=this.ui.$subCatContainer.find("select.sf-select-subcategory").val(),t=this.ui.$subCatContainer.find("select.sf-select-subcategory :selected").text()),this.trigger("selected",{id:n,name:t})},_mainCategoryChange:function(){this._parentCatId=parseInt(this.ui.$mainCatSelect.val(),10),this._subCategories[this._parentCatId]!==undefined?this._selectedCatId=this._subCategories[this._parentCatId][0].value:this._selectedCatId=this._parentCatId,this.ui.$subCatContainer.html(i(this.serializeData())),n.init(this.ui.$subCatContainer)}});return s}),define("modules/category-selector/views/category-select-view-extension",["modules/category-selector/views/category-select-view"],function(e){var t=e.extend({events:{"click .sf-select-category-cancel":"_cancelChange","click .sf-select-category-save":"_selectCategory","change select.sf-select-category":"_mainCategoryChange"}});return t}),define("hbs!modules/category-selector/templates/category-update-name",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing;return s+='		<label for="sf-subcategory-name-',(o=n.cid)?o=o.call(t,{hash:{}}):(o=t.cid,o=typeof o===a?o.apply(t):o),s+=f(o)+'">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"category-selector.accessible.label.subCategoryName",u):l.call(t,"t","category-selector.accessible.label.subCategoryName",u)))+"</label>\n		",u={hash:{id:"sf-subcategory-name-{{cid}}","class":"sf-subcategory-name",name:"subCatName",validateField:"customCategory.name",dataNames:"{{{currentSubCategoriesNames}}}"}},s+=f((o=n.textfield,o?o.call(t,u):l.call(t,"textfield",u))),s});return t.registerPartial("modules_category-selector_templates_category-update-name",n),n}),define("hbs!modules/category-selector/templates/category-create",["hbs","Handlebars","hbs!modules/category-selector/templates/category-update-name"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,r=r||e.partials;var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;s+='<div>\n	<form class="sf-category-create-form sf-form-horizontal" data-validate="parsley">\n		<div class="sf-form-row">\n			<label for="sf-select-category-',(o=n.cid)?o=o.call(t,{hash:{}}):(o=t.cid,o=typeof o===f?o.apply(t):o),s+=l(o)+'">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"category-selector.accessible.label.category",a):c.call(t,"t","category-selector.accessible.label.category",a)))+"</label>\n			",a={hash:{name:"category","class":"sf-select-category",id:"sf-select-category-{{cid}}",options:"{{categorySelectOptions}}",currentOption:"{{parentCategory}}"}},s+=l((o=n.select,o?o.call(t,a):c.call(t,"select",a)))+'\n		</div>\n		<div class="sf-form-row sf-subcategory-container">\n			',u=h.invokePartial(r["modules_category-selector_templates_category-update-name"],"modules_category-selector_templates_category-update-name",t,n,r);if(u||u===0)s+=u;return s+='\n		</div>\n        <div class="sf-form-row sf-success-message">\n			<span>',a={hash:{}},s+=l((o=n.t,o?o.call(t,"category-selector.success.categoryCreated",a):c.call(t,"t","category-selector.success.categoryCreated",a)))+'</span>\n	    </div>\n		<div class="sf-button-controls">\n			',a={hash:{text:'{{t "common.button.cancel"}}',type:"button","class":"sf-button-cancel sf-create-category-cancel"}},s+=l((o=n.button,o?o.call(t,a):c.call(t,"button",a)))+"\n			",a={hash:{text:'{{t "common.button.save"}}',type:"button","class":"sf-button-save sf-create-category-save"}},s+=l((o=n.button,o?o.call(t,a):c.call(t,"button",a)))+"\n		</div>\n	</form>\n</div>",s});return t.registerPartial("modules_category-selector_templates_category-create",n),n}),define("hbs!ui/modules/mask/templates/mask",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-mask" style="display:none;">\n	<div class="sf-loading">\n         <div class="sf-loading-center">\n              <div class="sf-loading-indicator">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"common.mask.loading",u):a.call(t,"t","common.mask.loading",u)))+"</div>\n         </div>\n    </div>\n</div>",s});return t.registerPartial("ui_modules_mask_templates_mask",n),n}),define("ui/modules/mask/mask-module",["classes/class","hbs!ui/modules/mask/templates/mask","css!ui/modules/mask/css/mask"],function(e,t){var n=e.extend({initialize:function(e){this._super(e),this.maskProcesses=0,this.$el=e.$el,this.$el.data("mask",this),this.$elMask=null},show:function(e){this.maskProcesses++;if(!this.$elMask||this.$elMask.length===0)this.$elMask=this.$el.children(".sf-mask").eq(0),this.$elMask.length===0&&(this.$el.prepend(t),this.$elMask=this.$el.children(".sf-mask").eq(0));console.log("[Mask] show(%s)... el: %o, processes: %s",e,this.$elMask,this.maskProcesses);if(e)switch(e){case n.MASK_DEFAULT:this.$elMask.removeClass("sf-mask-loading");break;case n.MASK_LOADING:this.$elMask.addClass("sf-mask-loading")}if(this.$elMask.css("display")!=="none")return;this.$elMask.animate({opacity:"show"},"fast","linear")},hide:function(){this.maskProcesses--,console.log("[Mask] hide()... el: %o, processes: %s",this.$elMask,this.maskProcesses),this.maskProcesses<0&&(this.maskProcesses=0);if(this.maskProcesses>0)return;if(this.$elMask==null){this.$elMask=this.$el.children(".sf-mask").eq(0);if(this.$elMask.length===0)return}var e=this;this.$elMask.animate({opacity:"hide"},"fast","linear",function(){e.$elMask.removeClass("sf-mask-loading")})}},{ID:"mask",MASK_DEFAULT:0,MASK_LOADING:1});return n}),define("utils/mask",["utils/util","ui/modules/mask/mask-module"],function(e,t){return e.mask=function(e,n){var r;e.data("mask")?r=e.data("mask"):r=new t({$el:e}),r.show(n)},e.unmask=function(e){var n;e.data("mask")?n=e.data("mask"):n=new t({$el:e}),n.hide()},e.MASK_DEFAULT=t.MASK_DEFAULT,e.MASK_LOADING=t.MASK_LOADING,e}),define("modules/category-selector/views/category-create-view",["classes/item-view","utils/util","services/categories-service","classes/remote-error","hbs!modules/category-selector/templates/category-create","hbs!modules/category-selector/templates/category-update-name","ui/modules/reform/select/select-module","utils/validator","utils/mask"],function(e,t,n,r,i,s,o){var u=e.extend({template:i,events:{"click .sf-create-category-cancel":"_cancelCreate","submit .sf-category-create-form":"_saveCategory","change select.sf-select-category":"_mainCategoryChange","focus input":"_hideSuccessMessage","change select":"_hideSuccessMessage"},ui:{$mainCatSelect:"select.sf-select-category",$catName:"input.sf-subcategory-name",$form:".sf-category-create-form",$subCatContainer:".sf-subcategory-container",$successMessage:".sf-success-message"},initialize:function(){this._super.apply(this,arguments),this.categoriesService=n.getInstance(),this._categories=this.options.categories,this._mainCategories=this.options.mainCategories,this._subCategories=this.options.subCategories,this._parentCatId=parseInt(t.keys(this._subCategories)[0],10),this._selectedCatId=this._subCategories[this._parentCatId][0].value},onRender:function(){this._super(),o.init(this.$el),t.validator.validate(this.ui.$form)},serializeData:function(){var e=t.map(this._subCategories[this._parentCatId],function(e){return e.name});return{categorySelectOptions:this._mainCategories,currentSubCategoriesNames:e,parentCategory:this._parentCatId,cid:this.cid}},_cancelCreate:function(){this.trigger("cancel")},_saveCategory:function(e){var n=this.ui.$mainCatSelect.val(),r=this.ui.$catName.val(),i=this;e.preventDefault(),console.log("[AccessibleCategoryEditor] Adding category %s to catID %s",r,n),t.mask(this.$el,t.MASK_LOADING),t.when(this.categoriesService.create({name:r,parentCatId:n})).done(function(){t.unmask(i.$el),i.render(),i.ui.$successMessage.show(),console.log("[AccessibleCategoryEditor] custom category created")}).fail(function(e){t.unmask(i.$el),i._handleError(e)})},_mainCategoryChange:function(){this._parentCatId=parseInt(this.ui.$mainCatSelect.val(),10),this._selectedCatId=this._subCategories[this._parentCatId][0].value,this.ui.$subCatContainer.html(s(this.serializeData())),o.init(this.ui.$subCatContainer),t.validator.destroy(this.ui.$form),t.validator.validate(this.ui.$form),this.bindUIElements()},_handleError:function(e){var n=JSON.parse(e._data.responseText);n.error&&n.error.errors&&(e.errorMessage=t.i18n.get("category-selector.error."+n.error.errors[0])),this.publish("error",e)},_hideSuccessMessage:function(){this.ui.$successMessage.hide()}});return u}),define("modules/category-selector/views/category-create-view-extension",["modules/category-selector/views/category-create-view"],function(e){var t=e.extend({events:{"click .sf-create-category-cancel":"_cancelCreate","click .sf-create-category-save":"_saveCategory","change select.sf-select-category":"_mainCategoryChange","focus input":"_hideSuccessMessage","change select":"_hideSuccessMessage"}});return t}),define("hbs!modules/category-selector/templates/category-update",["hbs","Handlebars","hbs!modules/category-selector/templates/category-select-subcategory"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,r=r||e.partials;var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;s+='<div>\n	<form class="sf-category-update-form sf-form-horizontal" data-validate="parsley">\n		<div class="sf-form-row">\n			<label for="sf-select-category-',(o=n.cid)?o=o.call(t,{hash:{}}):(o=t.cid,o=typeof o===f?o.apply(t):o),s+=l(o)+'">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"category-selector.accessible.label.category",a):c.call(t,"t","category-selector.accessible.label.category",a)))+"</label>\n			",a={hash:{name:"category","class":"sf-select-category",id:"sf-select-category-{{cid}}",options:"{{categorySelectOptions}}",currentOption:"{{parentCategory}}"}},s+=l((o=n.select,o?o.call(t,a):c.call(t,"select",a)))+'\n		</div>\n		<div class="sf-form-row sf-subcategory-container">\n			',u=h.invokePartial(r["modules_category-selector_templates_category-select-subcategory"],"modules_category-selector_templates_category-select-subcategory",t,n,r);if(u||u===0)s+=u;return s+='\n		</div>\n		<div class="sf-form-row sf-name-container">\n		</div>\n\n		<div class="sf-button-controls">\n			',a={hash:{text:'{{t "common.button.cancel"}}',type:"button","class":"sf-button-cancel sf-create-category-cancel"}},s+=l((o=n.button,o?o.call(t,a):c.call(t,"button",a)))+"\n			",a={hash:{text:'{{t "common.button.confirm"}}',type:"button","class":"sf-button-confirm sf-create-category-save"}},s+=l((o=n.button,o?o.call(t,a):c.call(t,"button",a)))+"\n		</div>\n	</form>\n</div>",s});return t.registerPartial("modules_category-selector_templates_category-update",n),n}),define("modules/category-selector/views/category-update-view",["classes/item-view","utils/util","ui/modules/reform/select/select-module","services/categories-service","classes/remote-error","hbs!modules/category-selector/templates/category-update","hbs!modules/category-selector/templates/category-select-subcategory","hbs!modules/category-selector/templates/category-update-name"],function(e,t,n,r,i,s,o,u){var a=e.extend({template:s,events:{"click .sf-select-category-cancel":"_cancelChange","submit .sf-category-update-form":"_updateCategory","change select.sf-select-category":"_mainCategoryChange"},ui:{$mainCatSelect:"select.sf-select-category",$subCatContainer:".sf-subcategory-container",$nameContainer:".sf-name-container",$form:".sf-category-update-form"},initialize:function(){this._super.apply(this,arguments),this.categoriesService=r.getInstance(),this._categories=this.options.categories,this._mainCategories=this.options.mainCategories,this._subCategories=this.options.subCategories,this._parentCatId=parseInt(t.keys(this._subCategories)[0],10),this._selectedCatId=this._subCategories[this._parentCatId][0].value},onRender:function(){this._super(),n.init(this.$el),this._evalulateEditor()},serializeData:function(){var e=t.filter(this._subCategories[this._parentCatId],function(e){return e.custom}),n=t.map(this._subCategories[this._parentCatId],function(e){return e.name}),r=!1;return e.length===0&&(e.push({value:-1,name:t.i18n.get("category-selector.accessible.noCustomCats"),custom:!0}),r=!0),{categorySelectOptions:this._mainCategories,currentSubCategoriesNames:n,subCategorySelectOptions:e,currentCategory:this._selectedCatId,parentCategory:this._parentCatId,noCustomSubCategories:r,cid:this.cid}},_cancelChange:function(){this.trigger("cancel")},_updateCategory:function(e){e.preventDefault();var n=this.ui.$subCatContainer.find("select.sf-select-subcategory").val(),r=this.ui.$nameContainer.find(".sf-subcategory-name").val(),i=this;t.mask(this.$el,t.MASK_LOADING),t.when(this.categoriesService.update({id:n,name:r})).done(function(){t.unmask(i.$el),console.log("[AccessibleCategoryEditor] custom category updated"),i.trigger("cancel")}).fail(function(e){t.unmask(i.$el),i._handleError(e)})},_mainCategoryChange:function(){this._parentCatId=parseInt(this.ui.$mainCatSelect.val(),10),this._selectedCatId=this._subCategories[this._parentCatId][0].value,this.ui.$subCatContainer.html(o(this.serializeData())),n.init(this.ui.$subCatContainer),this._evalulateEditor()},_evalulateEditor:function(){var e=this.serializeData();e.subCategorySelectOptions.length===1&&e.subCategorySelectOptions[0].value===-1?this.ui.$nameContainer.empty():this.ui.$nameContainer.html(u(e)),t.validator.destroy(this.ui.$form),t.validator.validate(this.ui.$form)},_handleError:function(e){var n=JSON.parse(e._data.responseText);n.error&&n.error.errors&&(e.errorMessage=t.i18n.get("category-selector.error."+n.error.errors[0])),this.publish("error",e)}});return a}),define("modules/category-selector/views/category-update-view-extension",["modules/category-selector/views/category-update-view"],function(e){var t=e.extend({events:{"click .sf-select-category-cancel":"_cancelChange","click .sf-create-category-save":"_updateCategory","change select.sf-select-category":"_mainCategoryChange"}});return t}),define("hbs!modules/category-selector/templates/category-remove",["hbs","Handlebars","hbs!modules/category-selector/templates/category-select-subcategory"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,r=r||e.partials;var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;s+='<div>\n	<form class="sf-category-remove-form sf-form-horizontal">\n		<div class="sf-form-row">\n			<label for="sf-select-category-',(o=n.cid)?o=o.call(t,{hash:{}}):(o=t.cid,o=typeof o===f?o.apply(t):o),s+=l(o)+'">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"category-selector.accessible.label.category",a):c.call(t,"t","category-selector.accessible.label.category",a)))+"</label>\n			",a={hash:{name:"category","class":"sf-select-category",id:"sf-select-category-{{cid}}",options:"{{categorySelectOptions}}",currentOption:"{{parentCategory}}"}},s+=l((o=n.select,o?o.call(t,a):c.call(t,"select",a)))+'\n		</div>\n		<div class="sf-form-row sf-subcategory-container">\n			',u=h.invokePartial(r["modules_category-selector_templates_category-select-subcategory"],"modules_category-selector_templates_category-select-subcategory",t,n,r);if(u||u===0)s+=u;return s+='\n		</div>\n\n		<div class="sf-button-controls">\n			',a={hash:{text:'{{t "common.button.cancel"}}',type:"button","class":"sf-button-cancel sf-select-category-cancel"}},s+=l((o=n.button,o?o.call(t,a):c.call(t,"button",a)))+"\n			",a={hash:{text:'{{t "common.button.save"}}',type:"button","class":"sf-button-save sf-select-category-save"}},s+=l((o=n.button,o?o.call(t,a):c.call(t,"button",a)))+"\n		</div>\n	</form>\n</div>",s});return t.registerPartial("modules_category-selector_templates_category-remove",n),n}),define("modules/category-selector/views/category-remove-view",["classes/item-view","utils/util","services/categories-service","ui/modules/reform/select/select-module","classes/remote-error","hbs!modules/category-selector/templates/category-remove","hbs!modules/category-selector/templates/category-select-subcategory","utils/mask"],function(e,t,n,r,i,s,o){var u=e.extend({template:s,events:{"click .sf-select-category-cancel":"_cancelRemove","submit .sf-category-remove-form":"_removeCategory","change select.sf-select-category":"_mainCategoryChange"},ui:{$mainCatSelect:"select.sf-select-category",$subCatContainer:".sf-subcategory-container"},initialize:function(){this._super.apply(this,arguments),this.categoriesService=n.getInstance(),this._categories=this.options.categories,this._mainCategories=this.options.mainCategories,this._subCategories=this.options.subCategories,this._parentCatId=parseInt(t.keys(this._subCategories)[0],10),this._selectedCatId=this._subCategories[this._parentCatId][0].value},onRender:function(){this._super(),r.init(this.$el)},serializeData:function(){var e=t.filter(this._subCategories[this._parentCatId],function(e){return e.custom}),n=!1;return e.length===0&&(e.push({value:-1,name:t.i18n.get("category-selector.accessible.noCustomCats"),custom:!0}),n=!0),{categorySelectOptions:this._mainCategories,subCategorySelectOptions:e,currentCategory:this._selectedCatId,parentCategory:this._parentCatId,noCustomSubCategories:n,cid:this.cid}},_cancelRemove:function(){this.trigger("cancel")},_removeCategory:function(e){e.preventDefault();var n=this.ui.$subCatContainer.find("select.sf-select-subcategory").val(),r=this;n!=-1&&(console.log("[AccessibleCategoryEditor] Removing category with id %d",n),t.mask(this.$el,t.MASK_LOADING),t.when(this.categoriesService.remove(n)).done(function(){t.unmask(r.$el),console.log("[AccessibleCategoryEditor] Removed category with id %d",n),r.trigger("cancel")}).fail(function(e){t.unmask(r.$el),r._handleError(e)}))},_mainCategoryChange:function(){this._parentCatId=parseInt(this.ui.$mainCatSelect.val(),10),this._selectedCatId=this._subCategories[this._parentCatId][0].value,this.ui.$subCatContainer.html(o(this.serializeData())),r.init(this.ui.$subCatContainer)},_handleError:function(e){var n=JSON.parse(e._data.responseText);n.error&&n.error.errors&&(e.errorMessage=t.i18n.get("category-selector.error."+n.error.errors[0])),this.publish("error",e)}});return u}),define("modules/category-selector/views/category-remove-view-extension",["modules/category-selector/views/category-remove-view"],function(e){var t=e.extend({events:{"click .sf-select-category-cancel":"_cancelRemove","click .sf-select-category-save":"_removeCategory","change select.sf-select-category":"_mainCategoryChange"}});return t}),define("hbs!modules/category-selector/templates/accessible-category-selector",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){return"sf-form-custom-edition-disabled"}function d(e,t){var r="",i,s,o;r+="\n			",o={hash:{},inverse:h.program(6,m,t),fn:h.program(4,v,t)},s=(i=n.ifdef,i?i.call(e,e.currentCategory,o):c.call(e,"ifdef",e.currentCategory,o));if(s||s===0)r+=s;return r+="\n		",r}function v(e,t){var r="",i,s,o;r+='\n			    <div class="sf-form-row">\n					<label for="sf-category-selected-',(i=n.cid)?i=i.call(e,{hash:{}}):(i=e.cid,i=typeof i===f?i.apply(e):i),r+=l(i)+'">',o={hash:{}},r+=l((i=n.t,i?i.call(e,"category-selector.accessible.label.originalCategory",o):c.call(e,"t","category-selector.accessible.label.originalCategory",o)))+'</label>\n					<span id="sf-category-selected-',(s=n.cid)?s=s.call(e,{hash:{}}):(s=e.cid,s=typeof s===f?s.apply(e):s),r+=l(s)+'" class="sf-category-selected">',(s=n.parentCategory)?s=s.call(e,{hash:{}}):(s=e.parentCategory,s=typeof s===f?s.apply(e):s);if(s||s===0)r+=s;r+='</span>\n				</div>\n			    <div class="sf-form-row">\n					<label for="sf-subcategory-selected-',(s=n.cid)?s=s.call(e,{hash:{}}):(s=e.cid,s=typeof s===f?s.apply(e):s),r+=l(s)+'">',o={hash:{}},r+=l((i=n.t,i?i.call(e,"category-selector.accessible.label.originalSubCategory",o):c.call(e,"t","category-selector.accessible.label.originalSubCategory",o)))+'</label>\n					<span id="sf-subcategory-selected-',(s=n.cid)?s=s.call(e,{hash:{}}):(s=e.cid,s=typeof s===f?s.apply(e):s),r+=l(s)+'" class="sf-subcategory-selected">',(s=n.currentCategory)?s=s.call(e,{hash:{}}):(s=e.currentCategory,s=typeof s===f?s.apply(e):s);if(s||s===0)r+=s;return r+="</span>\n				</div>\n			",r}function m(e,t){var r="",i,s,o;r+='\n			    <div class="sf-form-row">\n					<label for="sf-category-selected-',(i=n.cid)?i=i.call(e,{hash:{}}):(i=e.cid,i=typeof i===f?i.apply(e):i),r+=l(i)+'">',o={hash:{}},r+=l((i=n.t,i?i.call(e,"category-selector.accessible.label.originalCategory",o):c.call(e,"t","category-selector.accessible.label.originalCategory",o)))+'</label>\n					<span id="sf-category-selected-',(s=n.cid)?s=s.call(e,{hash:{}}):(s=e.cid,s=typeof s===f?s.apply(e):s),r+=l(s)+'" class="sf-category-selected">',(s=n.parentCategory)?s=s.call(e,{hash:{}}):(s=e.parentCategory,s=typeof s===f?s.apply(e):s);if(s||s===0)r+=s;return r+="</span>\n				</div>\n			",r}function g(e,t){var r="",i,s;return r+='\n				<label for="sf-category-action-',(i=n.cid)?i=i.call(e,{hash:{}}):(i=e.cid,i=typeof i===f?i.apply(e):i),r+=l(i)+'">',s={hash:{}},r+=l((i=n.t,i?i.call(e,"category-selector.accessible.label.action",s):c.call(e,"t","category-selector.accessible.label.action",s)))+"</label>\n				",s={hash:{name:"category-action","class":"sf-category-action",id:"sf-category-action-{{cid}}",options:"{{actions}}",currentOption:"{{selectedAction}}"}},r+=l((i=n.select,i?i.call(e,s):c.call(e,"select",s)))+"\n			",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;s+='<form class="sf-accessible-category-selector-form sf-form-horizontal ',o=n["if"].call(t,t.disableCustomEdition,{hash:{},inverse:h.noop,fn:h.program(1,p,i)});if(o||o===0)s+=o;s+='">\n    <fieldset>\n    	',a={hash:{},inverse:h.noop,fn:h.program(3,d,i)},u=(o=n.ifdef,o?o.call(t,t.parentCategory,a):c.call(t,"ifdef",t.parentCategory,a));if(u||u===0)s+=u;s+='\n\n		<div class="sf-form-row">\n			',u=n.unless.call(t,t.disableCustomEdition,{hash:{},inverse:h.noop,fn:h.program(8,g,i)});if(u||u===0)s+=u;s+='\n		</div>\n	</fieldset>\n</form>\n<div class="sf-selector-workarea ',u=n["if"].call(t,t.disableCustomEdition,{hash:{},inverse:h.noop,fn:h.program(1,p,i)});if(u||u===0)s+=u;return s+='">\n</div>',s});return t.registerPartial("modules_category-selector_templates_accessible-category-selector",n),n}),define("libs/require/css/css!modules/category-selector/css/accessible-category-selector",[],function(){}),define("modules/category-selector/views/accessible-category-selector-view",["classes/layout","utils/util","services/categories-service","modules/category-selector/views/category-select-view","modules/category-selector/views/category-create-view","modules/category-selector/views/category-update-view","modules/category-selector/views/category-remove-view","hbs!modules/category-selector/templates/accessible-category-selector","jQuery","ui/modules/reform/select/select-module","css!modules/category-selector/css/accessible-category-selector"],function(e,t,n,r,i,s,o,u,a,f){var l=e.extend({template:u,ui:{$categoryAction:"select.sf-category-action"},regions:{workRegion:".sf-selector-workarea"},events:{"change select.sf-category-action":"_changeActionView","change select.sf-select-category":"_selectParentCategory"},actionViews:{select:r,create:i,update:s,remove:o},initialize:function(){this._super.apply(this,arguments),this.categoryActionView=this.actionViews.select,this.categoriesService=n.getInstance(),this._catId=this.options.catId,this.setCategories(this.options.categories)},setCategories:function(e){var n={},r=t.map(e,function(e){var r=t.clone(e);return r.children!==undefined&&(n[r.value]=r.children,delete r.children),r},this);this.config.allOptionsEnabled&&r.unshift({name:t.i18n.get("category-selector.allOptions"),value:"-1","class":"sf-no-color"}),this._categories=e,this._mainCategories=r,this._subCategories=n},onRender:function(){f.init(this.$el),this._renderActionView()},_getActions:function(){var e=[{name:t.i18n.get("category-selector.accessible.actions.select"),value:"select"},{name:t.i18n.get("category-selector.accessible.actions.add"),value:"create"},{name:t.i18n.get("category-selector.accessible.actions.update"),value:"update"},{name:t.i18n.get("category-selector.accessible.actions.remove"),value:"remove"}];return this.config&&this.config.disableCustomEdition&&(e=t.filter(e,{value:"select"})),e},_selectParentCategory:function(e){var t=a(e.currentTarget),n=t.val(),r=this.$(".sf-subcategory-container");n==="-1"?r.addClass("sf-hidden"):r.hasClass("sf-hidden")&&r.removeClass("sf-hidden")},serializeData:function(){var e=this._catId,n,r,i={selectedAction:"select",categorySelectOptions:this._categories,cid:this.cid,actions:this._getActions(),disableCustomEdition:this.config&&this.config.disableCustomEdition};if(e!==undefined&&e!==!1){if(e===-1)return r={name:t.i18n.get("category-selector.allOptions"),value:"-1","class":"sf-no-color"},i.parentCategory=r.name,i;r=t.find(this._categories,function(t){return t.value===e}),r||(n=t.find(this._categories,function(n){if(n.children)return t.some(n.children,{value:e})}),n?r=t.find(n.children,function(t){return t.value===e}):(n=t.find(this._categories,"children"),r=n.children[0]),i.currentCategory=r.name,i.parentCategory=n.name)}else this.config.allOptionsEnabled?(n={name:t.i18n.get("category-selector.allOptions"),value:"-1","class":"sf-no-color"},i.parentCategory=n.name):(n=r,r=undefined);return i},_renderActionView:function(){var e=new this.categoryActionView(t.extend({},this.contextConfig,this.options,{mainCategories:this._mainCategories,subCategories:this._subCategories}));e.on("cancel",t.bind(this._cancelCategorySelect,this)),e.on("selected",t.bind(this._categorySelected,this)),this.workRegion.show(e)},_changeActionView:function(){this.categoryActionView=this.actionViews[this.ui.$categoryAction.val()],this._renderActionView()},_cancelCategorySelect:function(){this.trigger("cancel")},_categorySelected:function(e){this.trigger("selected",e)}});return l}),define("modules/category-selector/category-selector-module",["classes/item-view","services/categories-service","services/transactions-service","ui/modules/reform/category-select/category-select-module","utils/util","ui/modules/popup/popup-module","modules/category-selector/views/accessible-category-selector-view","hbs!ui/modules/reform/select/templates/select","jQuery","utils/i18n","utils/handlebars-goodies"],function(e,t,n,r,i,s,o,u,a){var f=e.extend({template:u,accessibleViewConstructor:o,filtersList:["category"],events:{"change select":"_selectChange"},initialize:function(){this._super.apply(this,arguments),i.extend(this.config,this.options),this.categoriesService=t.getInstance(),this.filters&&this.filters.category!==undefined&&(this.options.catId=this.filters.category),this.transactionService=n.getInstance(),this.removeUncategorized=this.options.removeUncategorized!==undefined?this.options.removeUncategorized:this.config.removeUncategorized},render:function(e){if(e)return this._super();i.when(this.categoriesService.getPlainCategories()).done(i.bind(this._dataReceived,this)).fail(i.bind(this._dataError,this))},update:function(){this._select.update()},_dataError:function(e){this.publish("error",e)},_dataReceived:function(e){this._result=i.clone(e),this._categories=this._setupCategories(this._result.data.categories),e.on("change",this._changeCategories,this),e.on("remove",this._changeCategories,this),e.on("add",this._changeCategories,this),this.render(!0)},_setupCategories:function(e){this.config.separatedCategories&&this.options.isIncome!=="undefined"&&(e=i.where(e,function(e){return e.isIncome===undefined||e.isIncome===this.options.isIncome},this)),this.config.parentCanBeSelected&&(e=i.map(e,function(e){return i.extend({"class":r.MultilevelSelect.defaults.classNames.excludefromdisabled},i.pick(e,"name","value","color","isIncome","children"))},this));if(this.config.showIncomeFirst){var t=i.findIndex(e,{isIncome:!0});if(t!==-1){var n=e.splice(t,1);e=n.concat(e)}}var s=i.findIndex(e,{value:0});if(!this.removeUncategorized&&this.config.showUncategorizedLast&&s!==-1){var o=e.splice(s,1);e=e.concat(o)}return this.config.allOptionsEnabled?e.unshift({name:i.i18n.get("category-selector.allOptions"),value:"-1","class":"sf-no-color"}):this.config.selectOptionEnabled&&e.unshift({name:i.i18n.get("category-selector.selectOption"),value:"-1","class":"sf-no-color"}),e},serializeData:function(){var e=i.handlebarsGoodies.transformDataAttr(this.config);return e["class"]=[r.CategorySelect.ID,r.MultilevelSelect.ID,"sf-fixed-width",this.config&&this.config.disableCustomEdition?r.CategorySelect.defaults.classNames.disablecustomedition:"",e.classes?e.classes:""].join(" "),e.options=this._categories,e.currentOption=this.options.catId!==undefined?this.options.catId:!1,e},onRender:function(){this._super(),r.init(this.$el),this._select=this.$el.find("select").data("ReForm.CategorySelect");var e=this;this._select.accessibleOpen=function(){e._openAccessible()},this._select.onAddCategory=function(t,n,r,s){var o=n.closest("form"),u=i.validator.isValid(o);if(!u)return!1;e._onAddCategory(t,n.val(),r,s)},this._select.onUpdateCategory=function(t,n,r){var s=n.closest("form"),o=i.validator.isValid(s);if(!o)return!1;e._onUpdateCategory(t,n.val(),r)},this._select.onDeleteCategory=function(t,n,r){e._onDeleteCategory(t,n,r)},this._select.on("close",function(){e._ignoreClose||e.trigger("categorySelector:cancel"),e._ignoreClose=!1}),this._select.on("custom:shown",function(t){e._validateCustomForm(t)}),this._select.on("custom:edit",function(t){e._validateCustomForm(t)}),this.customCategories=[],i.each(e._categories,function(t){i.each(t.children,function(t){t.custom&&e.customCategories.push(t.name)})}),this.trigger("categorySelectorShowed")},_validateCustomForm:function(e){var t=this,n=e.val(),r=e.closest("form"),s=t.customCategories.slice(0);if(n!==""){var o=s.indexOf(n);s.splice(o,1)}e.data("customCats",s),r.hasClass("validated")?(i.validator.reset(r),i.tooltip.destroy(e)):(i.validator.validate(r),r.addClass("validated"))},_onAddCategory:function(e,t,n,r){var s=this;console.log("[CategorySelector] Adding category %s to catID %d",t,n),i.mask(this.options.$widget,i.MASK_LOADING),i.when(s.categoriesService.create({name:t,parentCatId:n})).done(function(e){console.log("[CategorySelector] custom category created"),i.unmask(s.options.$widget),r(e.catId,e.catName,e.parentCatId,e.catHexrgbcolor),s.customCategories.push(e.catName)}).fail(function(e){console.log("[CategorySelector] error creating custom category"),i.unmask(s.options.$widget),s._handleError(e)})},_onUpdateCategory:function(e,t,n){var r=this;i.mask(this.options.$widget,i.MASK_LOADING),i.when(this.transactionService.count({categories:{catId:e}})).done(function(o){var u=o.get("count"),a=r.$(".sf-custom.sf-selected .sf-button-edit"),f=r.$(".sf-custom.sf-selected .sf-category-title").text(),l={$container:r.contextConfig.$popupContainer,$opener:a,title:i.i18n.get("category-selector.edit.title"),content:i.i18n.get("category-selector.edit.content",{transNum:u,oldCat:f,newCat:t}),type:s.CONFIRM,confirmCallback:i.bind(r._categorySaved,r,e,t,n),closeCallback:i.bind(r._closeEditPopup,r)};i.unmask(r.options.$widget);if(u===0){r._categorySaved(e,t,n);return}r.editPopup=new s(l),r.editPopup.open()}).fail(function(){i.unmask(r.options.$widget),this._categorySaved(e,t,n)}),console.log("[CategorySelector] Updating category %s with name %s",e,t)},_categorySaved:function(e,t,n){var r=this;this.editPopup&&this.editPopup.remove(),i.mask(this.options.$widget,i.MASK_LOADING),i.when(this.categoriesService.update({id:e,name:t})).done(function(e){console.log("[CategorySelector] custom category updated"),i.unmask(r.options.$widget),n(e.catId,e.catName)}).fail(function(e){console.log("[CategorySelector] error updating custom category"),i.unmask(r.options.$widget),r._handleError(e)})},_closeEditPopup:function(){this.editPopup.remove()},_onDeleteCategory:function(e,t,n){var r=this;i.mask(this.options.$widget,i.MASK_LOADING),i.when(this.transactionService.count({categories:{catId:e}})).done(function(o){var u=o.get("count"),a=r.$(".sf-custom.sf-selected .sf-button-delete"),f={$container:r.contextConfig.$popupContainer,$opener:a,title:i.i18n.get("category-selector.delete.title"),content:i.i18n.get("category-selector.delete.content",{transNum:u,category:t}),type:s.CONFIRM,confirmCallback:i.bind(r._categoryDeleted,r,e,t,n,!0),closeCallback:i.bind(r._closeDeletePopup,r)};i.unmask(r.options.$widget);if(u===0){r._categoryDeleted(e,t,n);return}r.deletePopup=new s(f),r.deletePopup.open()}).fail(function(){i.unmask(r.options.$widget),this._categoryDeleted(e,t,n)}),console.log("[CategorySelector] Deleting category %s with name %s",e,t)},_categoryDeleted:function(e,t,n){var r=this;this.deletePopup&&this.deletePopup.remove(),i.mask(this.options.$widget,i.MASK_LOADING),i.when(r.categoriesService.remove(e)).done(function(){console.log("[CategorySelector] Removed category with id %s",e),i.unmask(r.options.$widget),n(e)}).fail(function(e){console.log("[CategorySelector] error creating custom category"),i.unmask(r.options.$widget),r._handleError(e)})},_closeDeletePopup:function(){this.deletePopup.remove()},open:function(e){var t=e?e.type.indexOf("key")>=0?!0:!1:!1;console.log("[CategorySelectModule] Opening category selector in accessible mode? %s",t),t?this._openAccessible(e):this._select.open()},_openAccessible:function(e){var t=i.extend({},this.contextConfig,this.options,this.config,{categories:this._categories});delete t.$el,delete t.el;if(t.source==="categoryPopupSelector"||t.source==="transactionCategorySelector"){var n=i.findIndex(t.categories,{value:0});t.categories.splice(n,1)}this.accessibleSelector=new this.accessibleViewConstructor(t),this.accessibleSelector.render();var r={$container:this.options.$popupContainer,$opener:e?a(e.currentTarget):this._select.$el,$content:this.accessibleSelector.$el,closeCallback:i.bind(this._cancelCategorySelect,this),title:i.i18n.get("category-selector.accessible.title")};r["class"]="sf-accessible-category-selector",this._accessiblePopup=new s(r),this._accessiblePopup.open(),this.trigger("popupOpened"),this.accessibleSelector.on("cancel",i.bind(this._cancelCategorySelect,this)),this.accessibleSelector.on("selected",i.bind(this._categorySelected,this))},_selectChange:function(){this._ignoreClose=!0;var e={id:this.$("select").val(),name:this.$("select").find(":selected").text()};this.options.catId=parseInt(this.$("select").val(),10),this.trigger("categorySelector:selected",e)},_filtersChanged:function(e,t){console.log(e,t),e=="category"&&(this.$("select").val(t),this.update())},_cancelCategorySelect:function(){this._accessiblePopup.remove(),this.trigger("categorySelector:cancel")},_categorySelected:function(e){this._select.$original.val(e.id).trigger("change"),this._accessiblePopup.remove()},_changeCategories:function(e){this._categories=this._setupCategories(e.data.categories),this._select.opened||this.render(!0),this._accessiblePopup&&this.accessibleSelector.setCategories(this._categories)},_handleError:function(e){var t=JSON.parse(e._data.responseText);t.error&&t.error.errors&&(e.errorMessage=i.i18n.get("category-selector.error."+t.error.errors[0])),this.publish("error",e)}},{ID:"category-selector",services:[t],defaults:{showIncomeFirst:!0,showUncategorizedLast:!0,disableCustomEdition:!1,separatedCategories:!1,parentCanBeSelected:!1,removeUncategorized:!0,allOptionsEnabled:!1,selectOptionEnabled:!1}});return f}),define("modules/category-selector/category-selector-module-extension",["modules/category-selector/category-selector-module","services/categories-service","services/transactions-service","ui/modules/reform/category-select/category-select-module","utils/util","ui/modules/popup/popup-module","modules/category-selector/views/accessible-category-selector-view","hbs!ui/modules/reform/select/templates/select","jQuery","utils/i18n","utils/handlebars-goodies"],function(e,t,n,r,i,s,o,u,a){var f=e.extend({_openAccessible:function(e){var t=i.extend({},this.contextConfig,this.options,this.config,{categories:this._categories});delete t.$el,delete t.el,this.accessibleSelector=new this.accessibleViewConstructor(t),this.accessibleSelector.render();var n={$container:this.options.$popupContainer,$opener:e?a(e.currentTarget):this._select.$el,$content:this.accessibleSelector.$el,closeCallback:i.bind(this._cancelCategorySelect,this),title:i.i18n.get("category-selector.accessible.webTitle")};n["class"]="sf-accessible-category-selector",n.standAlone=!this.config.isPlatform,this._accessiblePopup=new s(n),this._accessiblePopup.open(),this.trigger("popupOpened"),this.accessibleSelector.on("cancel",i.bind(this._cancelCategorySelect,this)),this.accessibleSelector.on("selected",i.bind(this._categorySelected,this)),this.accessibleSelector.on("backToMainCatPopup",i.bind(this._backToMainCatPopup,this)),this.accessibleSelector.on("mainCatSelected",i.bind(this._mainCatSelected,this))},_backToMainCatPopup:function(){var e=i.i18n.get("category-selector.accessible.webTitle");this._accessiblePopup.$el.find(".sf-popup-title-text").html(e)},_mainCatSelected:function(){var e=i.i18n.get("category-selector.accessible.webSubtitle");this._accessiblePopup.$el.find(".sf-popup-title-text").html(e)},_selectChange:function(){this._super.apply(this,arguments),this.options._catIsIncome=this.$("select").find(":selected").attr("data-income"),this.publish("categorySelector:selected",{catId:this.options.catId,catIsIncome:this.options._catIsIncome})}});return f}),define("hbs!modules/category-selector/extensions/category-selector-popup/templates/category-selector-main",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t,r){var i="",s,o,c;i+='\n	<div class="sf-category-main-item">\n		<a href="javascript:void(0);" class="sf-category-main sf-category-main-',(s=n.value)?s=s.call(e,{hash:{}}):(s=e.value,s=typeof s===u?s.apply(e):s),i+=a(s),c={hash:{},inverse:f.noop,fn:f.program(2,h,t)},o=(s=n.ifequal,s?s.call(e,e.value,r.selectedCatId,c):l.call(e,"ifequal",e.value,r.selectedCatId,c));if(o||o===0)i+=o;i+='" data-id="',(o=n.value)?o=o.call(e,{hash:{}}):(o=e.value,o=typeof o===u?o.apply(e):o),i+=a(o)+'">\n			<div class="sf-icon sf-icon-default" ',o=n["if"].call(e,e.color,{hash:{},inverse:f.noop,fn:f.program(4,p,t)});if(o||o===0)i+=o;return i+='>\n				<img src="resources/pfm/ui/css/icons/category-icons/c',(o=n.value)?o=o.call(e,{hash:{}}):(o=e.value,o=typeof o===u?o.apply(e):o),i+=a(o)+'.svg" width="40" height="40" alt="">\n			</div>\n			<div class="sf-category-main-name">',(o=n.name)?o=o.call(e,{hash:{}}):(o=e.name,o=typeof o===u?o.apply(e):o),i+=a(o)+"</div>\n		</a>\n	</div>\n	",i}function h(e,t){return" sf-selected"}function p(e,t){var r="",i;return r+='style="color:',(i=n.color)?i=i.call(e,{hash:{}}):(i=e.color,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=this,l=n.helperMissing;s+='<div class="sf-category-selector-popup-list">\n	',o=n.each.call(t,t.categories,{hash:{},inverse:f.noop,fn:f.programWithDepth(c,i,t)});if(o||o===0)s+=o;return s+="\n</div>\n",s});return t.registerPartial("modules_category-selector_extensions_category-selector-popup_templates_category-selector-main",n),n}),define("hbs!modules/category-selector/extensions/category-selector-popup/templates/category-actions",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-category-actions">\n	',u={hash:{text:"common.button.edit",type:"button","class":"sf-button-edit",title:"common.button.edit"}},s+=f((o=n.button,o?o.call(t,u):a.call(t,"button",u)))+"\n	",u={hash:{text:"common.button.delete","class":"sf-button-delete",title:"common.button.delete"}},s+=f((o=n.button,o?o.call(t,u):a.call(t,"button",u)))+"\n</div>",s});return t.registerPartial("modules_category-selector_extensions_category-selector-popup_templates_category-actions",n),n}),define("hbs!modules/category-selector/extensions/category-selector-popup/templates/category-subcategory",["hbs","Handlebars","hbs!modules/category-selector/extensions/category-selector-popup/templates/category-actions"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){return" sf-selected"}function d(e,t){var r="",i;r+="\n	",i=n["if"].call(e,e.custom,{hash:{},inverse:f.noop,fn:f.program(4,v,t)});if(i||i===0)r+=i;return r+="\n	",r}function v(e,t){var i="",s;i+='\n	<div class="sf-category-actions-placeholder">\n		',s=f.invokePartial(r["modules_category-selector_extensions_category-selector-popup_templates_category-actions"],"modules_category-selector_extensions_category-selector-popup_templates_category-actions",e,n,r);if(s||s===0)i+=s;return i+="\n	</div>\n	",i}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,r=r||e.partials;var s="",o,u,a,f=this,l="function",c=this.escapeExpression,h=n.helperMissing;s+='<div>\n	<a href="javascript:void(0);" class="sf-category-subcategory sf-category-subcategory-',(o=n.value)?o=o.call(t,{hash:{}}):(o=t.value,o=typeof o===l?o.apply(t):o),s+=c(o),a={hash:{},inverse:f.noop,fn:f.program(1,p,i)},u=(o=n.ifequal,o?o.call(t,t.value,t.selectedCatId,a):h.call(t,"ifequal",t.value,t.selectedCatId,a));if(u||u===0)s+=u;s+='" data-id="',(u=n.value)?u=u.call(t,{hash:{}}):(u=t.value,u=typeof u===l?u.apply(t):u),s+=c(u)+'">\n		<span class="sf-category-color" style="background-color: ',(u=n.color)?u=u.call(t,{hash:{}}):(u=t.color,u=typeof u===l?u.apply(t):u),s+=c(u)+';"></span>\n		<span class="sf-category-subcategory-name">',(u=n.name)?u=u.call(t,{hash:{}}):(u=t.name,u=typeof u===l?u.apply(t):u),s+=c(u)+"</span>\n	</a>\n	",u=n.unless.call(t,t.disableCustomEdition,{hash:{},inverse:f.noop,fn:f.program(3,d,i)});if(u||u===0)s+=u;return s+="\n</div>",s});return t.registerPartial("modules_category-selector_extensions_category-selector-popup_templates_category-subcategory",n),n}),define("hbs!modules/category-selector/extensions/category-selector-popup/templates/category-create-link",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<button class="sf-button sf-category-create" type="button">\n	<span class="sf-white-circ"><img src="resources/pfm/ui/css/icons/app-icons/dav-plus-red.svg" alt="',u={hash:{}},s+=f((o=n.t,o?o.call(t,"category-selector.web.accessible.actions.add",u):a.call(t,"t","category-selector.web.accessible.actions.add",u)))+'"></span>\n	<span class="sf-button-text">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"category-selector.web.accessible.actions.add",u):a.call(t,"t","category-selector.web.accessible.actions.add",u)))+"</span>\n</button>",s});return t.registerPartial("modules_category-selector_extensions_category-selector-popup_templates_category-create-link",n),n}),define("hbs!modules/category-selector/extensions/category-selector-popup/templates/category-selector-secondary",["hbs","Handlebars","hbs!modules/category-selector/extensions/category-selector-popup/templates/category-subcategory","hbs!modules/category-selector/extensions/category-selector-popup/templates/category-create-link"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){var r="",i,s;return r+='\n    <div class="sf-back-button-placeholder">\n		<a href="javascript:void(0);" class="sf-back-button">\n			<span class="sf-back-icon">\n				<img src="resources/pfm/ui/css/icons/app-icons/dav-white-arrow-left.svg" alt="',s={hash:{}},r+=a((i=n.t,i?i.call(e,"category-selector.backButton",s):u.call(e,"t","category-selector.backButton",s)))+'">\n			</span>\n			<span class="sf-back-text">',s={hash:{}},r+=a((i=n.t,i?i.call(e,"category-selector.backButton",s):u.call(e,"t","category-selector.backButton",s)))+"</span>\n		</a>\n	</div>\n    ",r}function h(e,t,r){var i="",s,o,a;i+="\n		",a={hash:{disableCustomEdition:r.disableCustomEdition,selectedCatId:r.selectedCatId},inverse:l.noop,fn:l.program(4,p,t)},o=(s=n.partial,s?s.call(e,a):u.call(e,"partial",a));if(o||o===0)i+=o;return i+="\n	",i}function p(e,t){var i="",s;i+='\n			<div class="sf-category-subcategory-item" data-id="',(s=n.value)?s=s.call(e,{hash:{}}):(s=e.value,s=typeof s===f?s.apply(e):s),i+=a(s)+'">\n				',s=l.invokePartial(r["modules_category-selector_extensions_category-selector-popup_templates_category-subcategory"],"modules_category-selector_extensions_category-selector-popup_templates_category-subcategory",e,n,r);if(s||s===0)i+=s;return i+="\n			</div>\n			",i}function d(e,t){var i="",s;i+='\n	<div class="sf-category-create-placeholder">\n		',s=l.invokePartial(r["modules_category-selector_extensions_category-selector-popup_templates_category-create-link"],"modules_category-selector_extensions_category-selector-popup_templates_category-create-link",e,n,r);if(s||s===0)i+=s;return i+="\n	</div>\n	",i}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,r=r||e.partials;var s="",o,u=n.helperMissing,a=this.escapeExpression,f="function",l=this;s+='<div class="sf-category-selector-popup-list">\n    ',o=n.unless.call(t,t.disableBackButton,{hash:{},inverse:l.noop,fn:l.program(1,c,i)});if(o||o===0)s+=o;s+="\n    ",o=n.each.call(t,t.categories,{hash:{},inverse:l.noop,fn:l.programWithDepth(h,i,t)});if(o||o===0)s+=o;s+="\n	",o=n.unless.call(t,t.disableCustomEdition,{hash:{},inverse:l.noop,fn:l.program(6,d,i)});if(o||o===0)s+=o;return s+="\n</div>\n",s});return t.registerPartial("modules_category-selector_extensions_category-selector-popup_templates_category-selector-secondary",n),n}),define("hbs!modules/category-selector/extensions/category-selector-popup/templates/category-create",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div name="sf-category-create-form" class="sf-category-create-form" data-validate="parsley">\n	<div class="sf-form-row">\n	',u={hash:{id:"sf-subcategory-name-{{cid}}","class":"sf-subcategory-name",type:"button",name:"subCatName",validateField:"customCategory.name",dataNames:"{{{currentSubCategoriesNames}}}"}},s+=f((o=n.textfield,o?o.call(t,u):a.call(t,"textfield",u)))+"\n	",u={hash:{text:"common.button.save","class":"sf-button-save sf-create-category-submit",title:"common.button.save",type:"button"}},s+=f((o=n.button,o?o.call(t,u):a.call(t,"button",u)))+"\n	",u={hash:{text:"common.button.cancel","class":"sf-button-cancel",type:"button",title:"common.button.cancel"}},s+=f((o=n.button,o?o.call(t,u):a.call(t,"button",u)))+"\n	</div>\n</div>",s});return t.registerPartial("modules_category-selector_extensions_category-selector-popup_templates_category-create",n),n}),define("hbs!modules/category-selector/extensions/category-selector-popup/templates/category-update",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing;return s+='<span class="sf-color" style="background-color: ',(o=n.color)?o=o.call(t,{hash:{}}):(o=t.color,o=typeof o===a?o.apply(t):o),s+=f(o)+';"></span>\n<div name="sf-category-update-form" class="sf-category-update-form" data-validate="parsley">\n	<div class="sf-form-row">\n	',u={hash:{id:"sf-subcategory-name-{{cid}}","class":"sf-subcategory-name",type:"button",name:"subCatName",value:t.name,validateField:"customCategory.name",dataNames:"{{{currentSubCategoriesNames}}}"}},s+=f((o=n.textfield,o?o.call(t,u):l.call(t,"textfield",u)))+"\n	",u={hash:{text:"common.button.save","class":"sf-button-save sf-update-category-submit",title:"common.button.save",tabindex:"-1",type:"button"}},s+=f((o=n.button,o?o.call(t,u):l.call(t,"button",u)))+"\n	",u={hash:{text:"common.button.cancel","class":"sf-button-cancel",type:"button",title:"common.button.cancel",tabindex:"-1"}},s+=f((o=n.button,o?o.call(t,u):l.call(t,"button",u)))+"\n	</div>\n</div>",s});return t.registerPartial("modules_category-selector_extensions_category-selector-popup_templates_category-update",n),n}),define("modules/category-selector/extensions/category-selector-popup/views/category-selector-view",["classes/item-view","services/categories-service","hbs!modules/category-selector/extensions/category-selector-popup/templates/category-selector-main","hbs!modules/category-selector/extensions/category-selector-popup/templates/category-selector-secondary","hbs!modules/category-selector/extensions/category-selector-popup/templates/category-create","hbs!modules/category-selector/extensions/category-selector-popup/templates/category-create-link","hbs!modules/category-selector/extensions/category-selector-popup/templates/category-subcategory","hbs!modules/category-selector/extensions/category-selector-popup/templates/category-update","jQuery","utils/util","utils/validator"],function(e,t,n,r,i,s,o,u,a,f){var l=e.extend({template:n,events:{"click .sf-category-main":"_selectParentCategory","click .sf-category-subcategory":"_selectSecondaryCategory","click .sf-back-button":"_backButtonClicked","click .sf-category-create":"_showCreateCategory","submit .sf-category-create-form":"_createCategory","click .sf-category-create-form .sf-button-cancel":"_cancelCreateCategory","click .sf-button-edit":"_showUpdateCategory","submit .sf-category-update-form":"_updateCategory","click .sf-category-update-form .sf-button-cancel":"_cancelUpdateCategory","click .sf-button-delete":"_deleteCategory","mouseover .sf-icon":"_mouseoverIcon","mouseout .sf-icon":"_mouseoutIcon"},initialize:function(){f.extend(this.config,this.options),this.categoriesService=t.getInstance(),this.setCategories(this.options.categories),this._catId=this.options.catId,this._parentCatId=null},setCategories:function(e){this._categories=e;if(this.config.selectOptionEnabled){var t=f.findIndex(this._categories,{value:"-1"});t!==-1&&this._categories.splice(t,1)}this._subCategories={},this._mainCategories=f.map(this._categories,function(e){var t=f.clone(e);return t.children!==undefined&&(this._subCategories[t.value]=t.children,delete t.children),t},this),this.config.parentCanBeSelected&&f.each(this._subCategories,function(e,t){var n=f.find(this._mainCategories,{value:parseInt(t,10)});this._subCategories[t][0].value!==parseInt(t,10)&&this._subCategories[t].unshift(f.extend({},n,{name:f.i18n.get("category-selector.allSubcategories")}))},this)},serializeData:function(){var e=null;this._parentCatId!==null&&this._parentCatId>0?(this.template=r,e=this._subCategories[this._parentCatId]):(this.template=n,e=this._mainCategories);var t=f.findIndex(e,{value:0});return t>-1&&this.config.removeUncategorized&&e.splice(t,1),{cid:this.cid,categories:e,selectedCatId:this._catId,disableCustomEdition:this.config.disableCustomEdition}},onRender:function(){this._super();var e=f.i18n.get("category-selector.accessible.title");if(this._parentCatId!==null&&this._parentCatId>0){var t=f.find(this._mainCategories,{value:this._parentCatId});t&&(e=t.name)}f.tooltip.add(this.$("button"),this.tooltipOptions),a(".sf-category-selector-popup .sf-popup-title").html(e)},_mouseoverIcon:function(e){a(e.currentTarget).removeClass("sf-icon-default")},_mouseoutIcon:function(e){a(e.currentTarget).addClass("sf-icon-default")},_selectParentCategory:function(e){var t=a(e.currentTarget),n=t.data("id");return this._parentCatId=n,n<=0?this._categorySelected(n):this.render(),!1},_selectSecondaryCategory:function(e){var t=a(e.currentTarget),n=t.data("id");return this._categorySelected(n),!1},_getCatById:function(e,t){t=t||this._getParentCatId(e);var n=f.find(this._subCategories[t],function(t){return t.value===e},this);return n},_getParentCatId:function(e){var t=f.find(this.options.categories,function(t){if(t.children)return f.some(t.children,{value:e})},this);return t?t.value:null},_backButtonClicked:function(){this._parentCatId=null,this.render()},_showCreateCategory:function(){var e=f.map(this._subCategories[this._parentCatId],function(e){return e.name});this.$(".sf-category-create-placeholder").html(i({currentSubCategoriesNames:e,parentCategory:this._parentCatId,cid:this.cid})),f.validator.validate(this.$("form.sf-category-create-form"))},_cancelCreateCategory:function(){this.$(".sf-category-create-placeholder").html(s())},_createCategory:function(e){var t=this._parentCatId,n=this.$(".sf-category-create-placeholder .sf-subcategory-name").val(),r=this;e.preventDefault(),console.log("[CategorySelectorView] Adding category %s to catID %s",n,t),f.mask(this.$el,f.MASK_LOADING),f.when(this.categoriesService.create({name:n,parentCatId:t})).done(function(){f.unmask(r.$el),r.render(),console.log("[CategorySelectorView] custom category created")}).fail(function(e){f.unmask(r.$el),r._handleError(e)})},_showUpdateCategory:function(e){var t=f.map(this._subCategories[this._parentCatId],function(e){return e.name}),n=a(e.currentTarget).closest(".sf-category-subcategory-item"),r=this._getCatById(n.data("id"),this._parentCatId);return n.toggleClass("sf-edit-category"),n.html(u({currentSubCategoriesNames:t,parentCategory:this._parentCatId,name:r.name,id:n.data("id"),cid:this.cid,color:r.color})),f.validator.validate(this.$("form.sf-category-update-form")),!1},_cancelUpdateCategory:function(e){var t=a(e.currentTarget).closest(".sf-category-subcategory-item"),n=this._getCatById(t.data("id"),this._parentCatId);return t.toggleClass("sf-edit-category"),t.html(o(f.extend({},n,{selectedCatId:this._catId,disableCustomEdition:this.config.disableCustomEdition}))),!1},_updateCategory:function(e){e.preventDefault();var t=a(e.currentTarget).closest(".sf-category-subcategory-item").data("id"),n=a(e.currentTarget).closest(".sf-category-subcategory-item").find(".sf-subcategory-name").val(),r=this;f.mask(this.$el,f.MASK_LOADING),f.when(this.categoriesService.update({id:t,name:n})).done(function(){f.unmask(r.$el),r.render(),console.log("[CategorySelectorView] custom category updated")}).fail(function(e){f.unmask(r.$el),r._handleError(e)})},_deleteCategory:function(e){e.preventDefault();var t=a(e.currentTarget).closest(".sf-category-subcategory-item").data("id"),n=this;t!=-1&&(console.log("[CategorySelectorView] Removing category with id %d",t),f.mask(this.$el,f.MASK_LOADING),f.when(this.categoriesService.remove(t)).done(function(){f.unmask(n.$el),n.render(),console.log("[CategorySelectorView] Removed category with id %d",t)}).fail(function(e){f.unmask(n.$el),n._handleError(e)}))},_cancelCategorySelect:function(){return this.trigger("cancel"),!1},_categorySelected:function(e){return this.trigger("selected",{id:e}),!1},_handleError:function(e){var t=JSON.parse(e._data.responseText);t.error&&t.error.errors&&(e.errorMessage=f.i18n.get("category-selector.error."+t.error.errors[0])),this.publish("error",e)}});return l}),define("modules/category-selector/extensions/category-selector-popup/views/category-selector-view-extension",["modules/category-selector/extensions/category-selector-popup/views/category-selector-view","services/categories-service","hbs!modules/category-selector/extensions/category-selector-popup/templates/category-selector-main","hbs!modules/category-selector/extensions/category-selector-popup/templates/category-selector-secondary","hbs!modules/category-selector/extensions/category-selector-popup/templates/category-create","hbs!modules/category-selector/extensions/category-selector-popup/templates/category-create-link","hbs!modules/category-selector/extensions/category-selector-popup/templates/category-subcategory","hbs!modules/category-selector/extensions/category-selector-popup/templates/category-update","jQuery","utils/util","utils/validator"],function(e,t,n,r,i,s,o,u,a,f){var l=e.extend({events:{"click .sf-category-main":"_selectParentCategory","click .sf-category-subcategory":"_selectSecondaryCategory","click .sf-back-button":"_backButtonClicked","click .sf-category-create":"_showCreateCategory","click .sf-create-category-submit":"_createCategory","click .sf-category-create-form .sf-button-cancel":"_cancelCreateCategory","click .sf-button-edit":"_showUpdateCategory","click .sf-update-category-submit":"_updateCategory","click .sf-category-update-form .sf-button-cancel":"_cancelUpdateCategory","click .sf-button-delete":"_deleteCategory","mouseover .sf-icon":"_mouseoverIcon","mouseout .sf-icon":"_mouseoutIcon"},ui:{$createForm:".sf-category-create-form",$updateForm:".sf-category-update-form"},initialize:function(){f.extend(this.config,this.options),this.categoriesService=t.getInstance(),this.setCategories(this.options.categories),this._catId=this.options.catId,this._parentCatId=this.config.isIncome?110:null},serializeData:function(){var e=null;this._parentCatId!==null&&this._parentCatId>0?(this.template=r,e=this._subCategories[this._parentCatId]):(this.template=n,e=this._mainCategories);var t=f.findIndex(e,{value:0});return t>-1&&this.config.removeUncategorized&&e.splice(t,1),{cid:this.cid,categories:e,selectedCatId:this._catId,disableCustomEdition:this.config.disableCustomEdition,disableBackButton:this.config.hideExpensesCats,isPlatform:this.config.isPlatform}},_selectParentCategory:function(e){this.trigger("mainCatSelected"),this._super(e)},_backButtonClicked:function(){this._super(),this.trigger("backToMainCatPopup")},setCategories:function(e){this._categories=e;if(this.config.selectOptionEnabled){var t=f.findIndex(this._categories,{value:"-1"});t!==-1&&this._categories.splice(t,1)}this._subCategories={},this._mainCategories=f.map(this._categories,function(e){var t=f.clone(e);return t.children!==undefined&&(this._subCategories[t.value]=t.children,delete t.children),t},this),this.config.parentCanBeSelected&&f.each(this._subCategories,function(e,t){var n=f.find(this._mainCategories,{value:parseInt(t,10)});this._subCategories[t][0].value!==parseInt(t,10)&&this._subCategories[t].unshift(f.extend({},n,{name:f.i18n.get("category-selector.allSubcategories")}))},this),this.config.hideIncomeCats&&(this._mainCategories=f.filter(this._mainCategories,function(e){return e.isIncome!==!0})),this.config.hideExpensesCats&&(this._mainCategories=f.filter(this._mainCategories,function(e){return e.isIncome===!0}))},_createCategory:function(e){e.preventDefault();var t=this.$el.find(".sf-category-create-form");if(!t.parsley().validate()||!f.validator.isValid(t))return;var n=this._parentCatId,r=this.$(".sf-category-create-placeholder .sf-subcategory-name").val(),i=this;console.log("[CategorySelectorView] Adding category %s to catID %s",r,n),f.mask(this.$el,f.MASK_LOADING),f.when(this.categoriesService.create({name:r,parentCatId:n})).done(function(){f.pushToDataLayer({eventCategory:"PFM Movimientos-Editar Movimiento",eventAction:"Boton",eventLabel:"Guardar- Edicion Categorias",event:"eventClick"}),f.unmask(i.$el),i.render(),console.log("[CategorySelectorView] custom category created")}).fail(function(e){f.unmask(i.$el),i._handleError(e)})},_updateCategory:function(e){e.preventDefault();var t=this.$el.find(".sf-category-update-form");if(!t.parsley().validate()||!f.validator.isValid(t))return;var n=a(e.currentTarget).closest(".sf-category-subcategory-item").data("id"),r=a(e.currentTarget).closest(".sf-category-subcategory-item").find(".sf-subcategory-name").val(),i=this;f.mask(this.$el,f.MASK_LOADING),f.when(this.categoriesService.update({id:n,name:r})).done(function(){f.unmask(i.$el),i.render(),console.log("[CategorySelectorView] custom category updated")}).fail(function(e){f.unmask(i.$el),i._handleError(e)})},_showCreateCategory:function(){f.pushToDataLayer({eventCategory:"PFM Movimientos-Editar Movimiento",eventAction:"Boton",eventLabel:"Adicionar otra subcategoria- Edicion Categorias",event:"eventClick"});var e=f.map(this._subCategories[this._parentCatId],function(e){return e.name});this.$(".sf-category-create-placeholder").html(i({currentSubCategoriesNames:e,parentCategory:this._parentCatId,cid:this.cid})),f.validator.validate(this.$(".sf-category-create-form"))},_showUpdateCategory:function(e){var t=f.map(this._subCategories[this._parentCatId],function(e){return e.name}),n=a(e.currentTarget).closest(".sf-category-subcategory-item"),r=this._getCatById(n.data("id"),this._parentCatId);return n.toggleClass("sf-edit-category"),n.html(u({currentSubCategoriesNames:t,parentCategory:this._parentCatId,name:r.name,id:n.data("id"),cid:this.cid,color:r.color})),f.validator.validate(this.$(".sf-category-update-form")),!1},_selectSecondaryCategory:function(e){var t=a(e.currentTarget),n=t.data("id");return this._categorySelected(n),this.publish("catSelectedRulesForm",{catId:n}),!1}});return l}),define("libs/require/css/css!modules/category-selector/extensions/category-selector-popup/css/category-selector-popup",[],function(){}),define("modules/category-selector/extensions/category-selector-popup/category-selector-popup-module",["modules/category-selector/category-selector-module","modules/category-selector/extensions/category-selector-popup/views/category-selector-view","css!modules/category-selector/extensions/category-selector-popup/css/category-selector-popup"],function(e,t){var n=e.extend({accessibleViewConstructor:t,onRender:function(){this._super();var e=this;this._select.open=function(){e.open()}},open:function(e){this._openAccessible(e)}});return n}),define("hbs!ui/modules/pillbox/templates/pillbox-tag",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o="function",u=this.escapeExpression;return s+='<li class="sf-pillbox-element" data-value="'+u(typeof t===o?t.apply(t):t)+'" tabIndex="0">'+u(typeof t===o?t.apply(t):t)+'<span class="sf-pillbox-close"></span></li>',s});return t.registerPartial("ui_modules_pillbox_templates_pillbox-tag",n),n}),define("hbs!ui/modules/pillbox/templates/pillbox",["hbs","Handlebars","hbs!ui/modules/pillbox/templates/pillbox-tag"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i;return r+='id="',(i=n.id)?i=i.call(e,{hash:{}}):(i=e.id,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function c(e,t){var i;return i=f.invokePartial(r["ui_modules_pillbox_templates_pillbox-tag"],"ui_modules_pillbox_templates_pillbox-tag",e,n,r),i||i===0?i:""}function h(e,t){return'<input type="text" class="sf-input" />'}function p(e,t,n){var r="",i;return r+='name="'+a((i=n.name,typeof i===u?i.apply(e):i))+'"',r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,r=r||e.partials;var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="sf-pillbox ',(o=n["class"])?o=o.call(t,{hash:{}}):(o=t["class"],o=typeof o===u?o.apply(t):o),s+=a(o)+'" ',o=n["if"].call(t,t.id,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;s+=' >\n	<ul class="sf-pillbox-list">\n		',o=n.each.call(t,t.tags,{hash:{},inverse:f.noop,fn:f.program(3,c,i)});if(o||o===0)s+=o;s+='\n		<li class="sf-input-element sf-pillbox-input">',o=n["if"].call(t,t.inlineAdd,{hash:{},inverse:f.noop,fn:f.program(5,h,i)});if(o||o===0)s+=o;s+='</li>\n	</ul>\n	<input type="hidden" class="sf-pillbox-value" ',o=n["if"].call(t,t.name,{hash:{},inverse:f.noop,fn:f.programWithDepth(p,i,t)});if(o||o===0)s+=o;return s+=' value="',(o=n.tagsValues)?o=o.call(t,{hash:{}}):(o=t.tagsValues,o=typeof o===u?o.apply(t):o),s+=a(o)+'" />\n</div>',s});return t.registerPartial("ui_modules_pillbox_templates_pillbox",n),n}),define("libs/require/css/css!ui/modules/pillbox/css/pillbox",[],function(){}),define("ui/modules/pillbox/pillbox-module",["classes/item-view","jQuery","utils/util","hbs!./templates/pillbox","hbs!./templates/pillbox-tag","utils/constants","utils/i18n","css!./css/pillbox"],function(e,t,n,r,i){var s=e.extend({template:r,events:{"click .sf-pillbox-element":"_deleteTag","keydown .sf-pillbox-element.sf-selected":"_checkKeypressDeletion","focusin .sf-pillbox-element":"_focusTag","focusout .sf-pillbox-element":"_unfocusTag","click .sf-pillbox-list":"_focusInput","focusout .sf-pillbox-list":"_focusLost","keydown .sf-input":"_keyDown","keyup .sf-input":"_keyUp"},ui:{$inputContainer:".sf-pillbox-input",$input:".sf-input",$hidden:".sf-pillbox-value"},initialize:function(){this._super.apply(this,arguments),this.tags=n.clone(this.options.tags,!0)||[]},serializeData:function(){return{inlineAdd:this.options.inlineAdd,tags:this.tags,tagsValues:this.tags.join(","),name:this.options.inputName}},onRender:function(){this._super(),this._initRulers()},addTag:function(e){this._addTag(e)},_keyDown:function(e){if(!this.options.inlineAdd)return;var r=t(e.currentTarget),i=r.val(),s=this.ui.$input.closest("li").prev(),o=!0;switch(e.keyCode){case n.constants.ESCAPE:this._discardTag(),o=!1;break;case n.constants.ENTER:this._addTag(i),o=!1;break;case n.constants.TAB:this._addTag(i).length>0?o=!1:o=!0;break;case n.constants.BACKSPACE:n.isEmpty(i.trim())&&s.trigger("click");break;default:}return o},_keyUp:function(){this.options.inlineAdd&&this._updateInputWidth()},_checkKeypressDeletion:function(e){switch(e.keyCode){case n.constants.ENTER:case n.constants.SPACE:this._deleteTag(e)}},_deleteTag:function(e){var r=t(e.currentTarget),i=r.data("value");this.tags=n.reject(this.tags,function(e){return e===i}),r.remove(),this.ui.$hidden.val(this.tags.join(",")),this.trigger("view:change"),this.trigger("tags:change",this.tags)},_addTag:function(e){if(n.isEmpty(e=e.trim()))return"";var t=e.split(","),r=[];for(var s=0;s<t.length;s++)this.tags.indexOf(t[s])===-1&&(this.tags.push(t[s]),r.push(i(t[s])));return this.ui.$inputContainer.before(r.join("")),this.ui.$hidden.val(this.tags.join(",")),this._clearInput(),this.trigger("view:change"),this.trigger("tags:change",this.tags),e},_discardTag:function(){var e=this;setTimeout(function(){e._clearInput()},100)},_focusInput:function(){this.options.inlineAdd&&this.ui.$input.trigger("focus")},_focusLost:function(){this.options.inlineAdd&&this._addTag(this.ui.$input.val().trim())},_focusTag:function(e){var n=t(e.currentTarget);n.addClass("sf-selected")},_unfocusTag:function(e){var n=t(e.currentTarget);n.removeClass("sf-selected")},_clearInput:function(){this.ui.$input.val(""),this._updateInputWidth()},_updateInputWidth:function(){this.ui.$ruler.html(this.ui.$input.val()),this.ui.$input.width(this.ui.$ruler.width()+this._fontSize*2)},_initRulers:function(){this._fontSize=parseInt(this.ui.$input.css("font-size"),10),this.options.$widget.append('<span class="sf-text-ruler" style="height:1px;overflow:hidden;font-size:'+this._fontSize+';"></span>'),this.ui.$ruler=this.options.$widget.find(".sf-text-ruler")}},{ID:"pillbox",defaults:{inlineAdd:!1}});return s}),define("hbs!modules/transactions-edit/templates/transactions-tags",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression;s+='<div class="sf-transactions-tags-title">',a={hash:{}},u=(o=n.t,o?o.call(t,"transactions-edit.transactions-tags.title",a):f.call(t,"t","transactions-edit.transactions-tags.title",a));if(u||u===0)s+=u;return s+='</div>\n<div class="sf-transactions-tags">\n	<div class="sf-add-tag-container">\n		<div>\n			<form class="sf-add-tags-form">\n				<div class="sf-tag-enter-section sf-form-row">\n					<label>',a={hash:{}},s+=l((o=n.t,o?o.call(t,"transactions-edit.add-tags.intro",a):f.call(t,"t","transactions-edit.add-tags.intro",a)))+'</label>\n					<div class="sf-tag-input">\n						',a={hash:{"class":"sf-new-tag",validateField:"transactionTag.name",dataTags:t.tags,dataTagsNumber:t.tagsNumber}},s+=l((o=n.textfield,o?o.call(t,a):f.call(t,"textfield",a))),a={hash:{type:"submit","class":"sf-button-add sf-add-tag",text:"common.button.add",title:"common.button.add"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+"\n						",a={hash:{"class":"sf-new-tag-number",validateField:"transactionTag.number",value:t.tagsNumber}},s+=l((o=n.textfield,o?o.call(t,a):f.call(t,"textfield",a)))+'\n					</div>\n				</div>\n			</form>\n		</div>\n		<div class="sf-tags-selector sf-hidden"></div>\n	</div>\n	<div class="sf-pillbox-container">\n	</div>\n</div>',s});return t.registerPartial("modules_transactions-edit_templates_transactions-tags",n),n}),define("hbs!ui/modules/autocomplete/templates/autocomplete",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i;return r+='<label for="',(i=n.name)?i=i.call(e,{hash:{}}):(i=e.name,i=typeof i===u?i.apply(e):i),r+=a(i)+'"></label>',r}function c(e,t){var r="",i;return r+=' placeholder="',(i=n.placeholder)?i=i.call(e,{hash:{}}):(i=e.placeholder,i=typeof i===u?i.apply(e):i),r+=a(i)+'" ',r}function h(e,t){var r="",i;return r+=' name="',(i=n.name)?i=i.call(e,{hash:{}}):(i=e.name,i=typeof i===u?i.apply(e):i),r+=a(i)+'" ',r}function p(e,t){var r="",i;return r+=' id="',(i=n.id)?i=i.call(e,{hash:{}}):(i=e.id,i=typeof i===u?i.apply(e):i),r+=a(i)+'" ',r}function d(e,t){var r="",i;return r+=" ",(i=n["class"])?i=i.call(e,{hash:{}}):(i=e["class"],i=typeof i===u?i.apply(e):i),r+=a(i)+" ",r}function v(e,t){var r="",i;return r+=' value="',(i=n.value)?i=i.call(e,{hash:{}}):(i=e.value,i=typeof i===u?i.apply(e):i),r+=a(i)+'" ',r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=this;s+='<span class="sf-autocomplete-container">\n',o=n["if"].call(t,t.name,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;s+='\n	<img src="resources/pfm/ui/css/icons/app-icons/dav-magnifier.png" width="20" height="20">\n<input type="text" ',o=n["if"].call(t,t.placeholder,{hash:{},inverse:f.noop,fn:f.program(3,c,i)});if(o||o===0)s+=o;o=n["if"].call(t,t.name,{hash:{},inverse:f.noop,fn:f.program(5,h,i)});if(o||o===0)s+=o;o=n["if"].call(t,t.id,{hash:{},inverse:f.noop,fn:f.program(7,p,i)});if(o||o===0)s+=o;s+=' class="sf-autocomplete-input',o=n["if"].call(t,t["class"],{hash:{},inverse:f.noop,fn:f.program(9,d,i)});if(o||o===0)s+=o;s+='" ',o=n["if"].call(t,t.value,{hash:{},inverse:f.noop,fn:f.program(11,v,i)});if(o||o===0)s+=o;return s+=" />\n</span>\n",s});return t.registerPartial("ui_modules_autocomplete_templates_autocomplete",n),n}),define("libs/require/css/css!libs/jquery-json-suggest/jquery-json-suggest",[],function(){}),define("libs/jquery-json-suggest/jquery-json-suggest",["jQuery","css!libs/jquery-json-suggest/jquery-json-suggest"],function(e,t){var n=e;n.fn.jsonSuggest=function(e){var t={url:"",data:[],minCharacters:1,maxResults:undefined,wildCard:"",caseSensitive:!1,notCharacter:"!",maxHeight:350,highlightMatches:!0,onSelect:undefined,width:undefined,property:"text",rtl:!1},r,e=n.extend(t,e),i=e.rtl?"right":"left",s=e.rtl?"left":"right";return this.each(function(){function t(e,t){var n=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];if(t)for(var r=0;r<n.length;r++)n[r]===t&&n.splice(r,1);var i=new RegExp("(\\"+n.join("|\\")+")","g");return e.replace(i,"\\$1")}function c(t){s.val(t[e.property]),n(u).html("").hide(),typeof e.onSelect=="function"&&e.onSelect(t)}function h(e){n("li a",u).removeClass("ui-state-hover"),e&&n("a",e).addClass("ui-state-hover"),a=e}function p(t,r){r="("+r+")";var i=!0,s,o=0,f=e.caseSensitive?new RegExp(r,"g"):new RegExp(r,"ig");n(u).html("").hide();for(s=0;s<t.length;s+=1){var l=n("<li />"),p=t[s][e.property];e.highlightMatches===!0&&(p=p.replace(f,"<strong>$1</strong>")),n(l).append('<a class="ui-corner-all">'+p+"</a>"),typeof t[s].image=="string"&&n(">a",l).prepend('<img src="'+t[s].image+'" />'),typeof t[s].extra=="string"&&n(">a",l).append("<small>"+t[s].extra+"</small>"),n(l).addClass("ui-menu-item").addClass(i?"odd":"even").attr("role","menuitem").click(function(e){return function(){c(t[e])}}(s)).mouseover(function(e){return function(){h(e)}}(l)),n(u).append(l),i=!i,o+=1;if(typeof e.maxResults=="number"&&o>=e.maxResults)break}n("li",u).length>0&&(a=undefined,n(u).show().css("height","auto"),n(u).height()>e.maxHeight&&n(u).css({overflow:"auto",height:e.maxHeight+"px"}))}function d(i){var s=function(n){if(this.value.length<e.minCharacters)return v(),!1;var r=[],i=e.wildCard?t(this.value,e.wildCard).replace(o,".*"):t(this.value),s=!0,u,a;e.notCharacter&&i.indexOf(e.notCharacter)===0&&(i=i.substr(e.notCharacter.length,i.length),i.length>0&&(s=!1)),i=i||".*",i=e.wildCard?"^"+i:i,u=e.caseSensitive?new RegExp(i):new RegExp(i,"i");for(a=0;a<n.length;a+=1)u.test(n[a][e.property])===s&&r.push(n[a]);p(r,i)};if(e.data&&e.data.length)s.apply(this,[e.data]);else if(e.url&&typeof e.url=="string"){var a=this.value;if(a.length<e.minCharacters)return v(),!1;n(u).html('<li class="ui-menu-item ajaxSearching"><a class="ui-corner-all">Searching...</a></li>').show().css("height","auto"),r=window.clearTimeout(r),r=window.setTimeout(function(){n.getJSON(e.url,{search:a},function(e){e?p(e,a):v()})},500)}}function v(){n(u).html("").hide()}function m(e){switch(e.keyCode){case 13:return n(a).trigger("click"),!1;case 40:return typeof a=="undefined"?a=n("li:first",u).get(0):a=n(a).next().get(0),h(a),a&&n(u).scrollTop(a.offsetTop),!1;case 38:return typeof a=="undefined"?a=n("li:last",u).get(0):a=n(a).prev().get(0),h(a),a&&n(u).scrollTop(a.offsetTop),!1;default:d.apply(this,[e])}}var s=n(this),o=new RegExp(t(e.wildCard||""),"g"),u=n("<ul />"),a,f,l,g={top:s.position().top+s.outerHeight()+"px",width:e.width||s.outerWidth()+"px","z-index":999};g[i]=s.position()[i]+"px",n(u).addClass("jsonSuggest ui-autocomplete ui-menu ui-widget ui-widget-content ui-corner-all").attr("role","listbox").css(g).hide(),s.after(u).keyup(m).keydown(function(e){if((e.keyCode===9||e.keyCode===13)&&a)return n(a).trigger("click"),!0}).blur(function(e){var t=n(u).offset();t.bottom=t.top+n(u).height(),t.right=t.left+n(u).width(),(l<t.top||l>t.bottom||f<t.left||f>t.right)&&n(u).hide()}).focus(function(t){var r={top:s.position().top+s.outerHeight()+"px"};r[i]=s.position()[i]+"px",n(u).css("width",e.width||s.outerWidth()+"px"),n(u).css(r),n("li",u).length>0&&n(u).show()}).attr("autocomplete","off"),n(window).mousemove(function(e){f=e.pageX,l=e.pageY}),e.notCharacter=t(e.notCharacter||""),e.data&&typeof e.data=="string"&&(e.data=n.parseJSON(e.data))})}}),define("ui/modules/autocomplete/autocomplete-module",["classes/item-view","utils/util","jQuery","hbs!ui/modules/autocomplete/templates/autocomplete","libs/jquery-json-suggest/jquery-json-suggest"],function(e,t,n,r){var i=e.extend({template:r,serializeData:function(){return this.config},onRender:function(){this._super();var e=t.merge({rtl:this.config.textDirection==="rtl"},this.config);n(this.$el.find("input")).jsonSuggest(e)}},{ID:"autocomplete",TYPE:{DEFAULT:"default"},defaults:{url:"''",data:[],minCharacters:1,maxResults:8,wildCard:"''",caseSensitive:!1,notCharacter:"!",maxHeight:350,width:undefined,highlightMaches:!0,onSelect:undefined}});return i}),define("ui/modules/autocomplete/autocomplete-module-extension",["ui/modules/autocomplete/autocomplete-module","utils/util","jQuery","hbs!ui/modules/autocomplete/templates/autocomplete","libs/jquery-json-suggest/jquery-json-suggest"],function(e,t,n,r){var i=e.extend({serializeData:function(){var e=this.config;return e.isPlatform=this.config.isPlatform,e}});return i}),define("modules/transactions-edit/views/transactions-edit-tags-view",["classes/item-view","utils/util","jQuery","ui/modules/pillbox/pillbox-module","hbs!modules/transactions-edit/templates/transactions-tags","ui/modules/autocomplete/autocomplete-module","libs/jquery-json-suggest/jquery-json-suggest"],function(e,t,n,r,i){var s=e.extend({template:i,events:{"submit .sf-add-tags-form":"_addTagToPillbox"},ui:{$tagsManager:".sf-pillbox-container",$tagInput:".sf-tag-enter-section .sf-new-tag"},initialize:function(){this._super.apply(this,arguments);var e=this.options.transaction;e&&e.get("tags")?this._currentTags=e.get("tags").split(","):this._currentTags=[]},onRender:function(){this._super(),this._showTagManager(),t.validator.validate(this.$("form"));var e=t.map(this.options.tags.toJSON(),function(e){return{id:e.id,text:e.name}});this.$(".sf-new-tag").jsonSuggest({data:e,minCharacters:2,maxResults:8,wildCard:"''",caseSensitive:!1,notCharacter:"!",maxHeight:350,width:undefined,highlightMaches:!0,onSelect:undefined})},serializeData:function(){return{tags:this._currentTags,tagsNumber:this._currentTags.length}},_showTagManager:function(){var e=t.extend({},this.contextConfig),n=this.options.transaction,i=this;n?e.inputName="parent-tags":e.inputName="tags",e.tags=this._currentTags,this._pillBox=new r(e),this._pillBox.render(),this._pillBox.on("view:change",function(){i.trigger("view:change")}),this._pillBox.on("tags:change",function(e){i._currentTags=e,i.$(".sf-new-tag-number").val(i._currentTags.length),t.validator.validate(i.$("form")).validate()}),this.ui.$tagsManager.html(this._pillBox.$el)},_addTagToPillbox:function(e){e.preventDefault();var n=t.trim(this.ui.$tagInput.val()),r=0;r=parseInt(this.$(".sf-new-tag-number").val(),10)+1,this.$(".sf-new-tag-number").val(r);if(!t.validator.isValid(this.$("form"))){this.$(".sf-new-tag-number").trigger("keyup");return}n!==""&&this._currentTags.push(n),this.$(".sf-new-tag").data("tags",this._currentTags.toString()),this.$(".sf-new-tag").data("parsleyField").constraints.notinlist.replaced=!1,this.$(".sf-new-tag").data("parsleyField").constraints.notinlist.requirements="tags",this.ui.$tagInput.val(""),this._showTagManager()}});return s}),define("hbs!modules/transactions-edit/templates/transaction-split-cell",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i;r+="sf-split-remainder-fieldset ",i=n["if"].call(e,e.splits,{hash:{},inverse:f.noop,fn:f.program(2,d,t)});if(i||i===0)r+=i;return r}function d(e,t){return"sf-hidden"}function v(e,t){var r="",i,s;return r+='\n		<span class="sf-column-transaction-amount" data-col="',s={hash:{}},r+=c((i=n.t,i?i.call(e,"transactions-edit.transactionWebAmount",s):l.call(e,"t","transactions-edit.transactionWebAmount",s)))+'">\n			',s={hash:{id:"sf-split-amount-{{i}}",value:"{{#if isDefault}}{{parent.initialAmount}}{{else}}{{amount}}{{/if}}",name:"children-{{i}}-amount",affix:"currency",currency:"{{parent.transaction.currency}}","class":"sf-input-transaction-amount",validateField:"transactionSplit.amount",forceNegativeAmount:"{{parent.forceNegativeAmount}}"}},r+=c((i=n.textfield,i?i.call(e,s):l.call(e,"textfield",s)))+"\n		</span>\n		",r}function m(e,t){var r="",i,s,o;return r+='\n		<span class="sf-column-transaction-amount sf-column-remainder-amount" data-col="',o={hash:{}},r+=c((i=n.t,i?i.call(e,"transactions-edit.transactionWebAmount",o):l.call(e,"t","transactions-edit.transactionWebAmount",o)))+'">\n			<span class="sf-remainder-amount-text">\n				',o={hash:{value:"{{{formatAmount parent.transaction.initialReminderAmount curr=parent.transaction.currency noTag=true}}}",disabled:!0}},r+=c((i=n.textfield,i?i.call(e,o):l.call(e,"textfield",o)))+'\n			</span>\n			<input type="hidden" name="children-',(s=n.i)?s=s.call(e,{hash:{}}):(s=e.i,s=typeof s===h?s.apply(e):s),r+=c(s)+'-amount" value="'+c((i=(i=(i=e.parent,i==null||i===!1?i:i.transaction),i==null||i===!1?i:i.amount),typeof i===h?i.apply(e):i))+'" />\n		</span>\n		',r}function g(e,t){var r="",i,s,o;r+='\n			<span class="sf-column-split-delete ',o={hash:{},inverse:f.noop,fn:f.program(9,y,t)},s=(i=n.ifequal,i?i.call(e,e.iPlus1,(i=e.parent,i==null||i===!1?i:i.remainCellNumber),o):l.call(e,"ifequal",e.iPlus1,(i=e.parent,i==null||i===!1?i:i.remainCellNumber),o));if(s||s===0)r+=s;return r+='">\n				<button id="sf-split-delete-',(s=n.i)?s=s.call(e,{hash:{}}):(s=e.i,s=typeof s===h?s.apply(e):s),r+=c(s)+'" class="sf-button sf-split-delete-action sf-button-delete" type="button">\n					<img src="resources/pfm/ui/css/icons/app-icons/dav-details-trash-can.svg" width="25" height="25" alt="',o={hash:{}},r+=c((i=n.t,i?i.call(e,"common.button.delete",o):l.call(e,"t","common.button.delete",o)))+'">\n				</button>\n			</span>\n		',r}function y(e,t){var n="";return n}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=this,l=n.helperMissing,c=this.escapeExpression,h="function";s+='<div id="sf-split-fieldset-',(o=n.i)?o=o.call(t,{hash:{}}):(o=t.i,o=typeof o===h?o.apply(t):o),s+=c(o)+'" class="sf-split-fieldset ',o=n["if"].call(t,t.isRemainder,{hash:{},inverse:f.noop,fn:f.program(1,p,i)});if(o||o===0)s+=o;s+='" >\n	<div class="sf-form-row sf-form-inline sf-row-head">\n		<span class="sf-column-transaction-date">',a={hash:{}},s+=c((o=n.t,o?o.call(t,"transactions-edit.transactionDate",a):l.call(t,"t","transactions-edit.transactionDate",a)))+'</span>\n		<span class="sf-column-transaction-title">',a={hash:{}},s+=c((o=n.t,o?o.call(t,"transactions-edit.transactionTitle",a):l.call(t,"t","transactions-edit.transactionTitle",a)))+'</span>\n		<span class="sf-column-transaction-category">',a={hash:{}},s+=c((o=n.t,o?o.call(t,"transactions-edit.transactionCat",a):l.call(t,"t","transactions-edit.transactionCat",a)))+'</span>\n		<span class="sf-column-transaction-amount">',a={hash:{}},s+=c((o=n.t,o?o.call(t,"transactions-edit.transactionWebAmount",a):l.call(t,"t","transactions-edit.transactionWebAmount",a)))+'</span>\n	</div>\n	<div class="sf-form-row sf-form-inline sf-form-inputs">\n		<span class="sf-column-transaction-date" data-col="',a={hash:{}},s+=c((o=n.t,o?o.call(t,"transactions-edit.transactionDate",a):l.call(t,"t","transactions-edit.transactionDate",a)))+'">\n			',a={hash:{id:"sf-split-date-{{i}}",dataDatepickerName:"children-{{i}}-postedDateStr",dataFormat:"{{parent.format}}",dataFormatSubmit:"{{parent.formatSubmit}}",dataValue:"{{#if isDefault}}{{parent.date}}{{else}}{{date}}{{/if}}",dataMax:"{{parent.today}}",validateField:"transaction.date"}},s+=c((o=n.datepicker,o?o.call(t,a):l.call(t,"datepicker",a)))+'\n		</span>\n		<span class="sf-column-transaction-title" data-col="',a={hash:{}},s+=c((o=n.t,o?o.call(t,"transactions-edit.transactionTitle",a):l.call(t,"t","transactions-edit.transactionTitle",a)))+'">\n			',a={hash:{id:"sf-split-name-{{i}}",name:"children-{{i}}-name",value:"{{#if isDefault}}{{{parent.transaction.name}}}{{else}}{{{name}}}{{/if}}",validateField:"transaction.name"}},s+=c((o=n.textfield,o?o.call(t,a):l.call(t,"textfield",a)))+'\n		</span>\n		<span class="sf-column-transaction-cat" data-col="',a={hash:{}},s+=c((o=n.t,o?o.call(t,"transactions-edit.transactionCat",a):l.call(t,"t","transactions-edit.transactionCat",a)))+'">\n		</span>\n		',u=n.unless.call(t,t.isRemainder,{hash:{},inverse:f.program(6,m,i),fn:f.program(4,v,i)});if(u||u===0)s+=u;s+="\n		",u=n.unless.call(t,t.isRemainder,{hash:{},inverse:f.noop,fn:f.program(8,g,i)});if(u||u===0)s+=u;return s+='\n	</div>\n	<div class="sf-form-row sf-transaction-included-analysis">\n		',a={hash:{id:"sf-split-included-analysis-{{i}}-{{cid}}",type:"checkbox",name:"children-{{i}}-computable",checked:"false"}},s+=c((o=n.checkbox,o?o.call(t,a):l.call(t,"checkbox",a)))+'\n		<label for="sf-split-included-analysis-',(u=n.i)?u=u.call(t,{hash:{}}):(u=t.i,u=typeof u===h?u.apply(t):u),s+=c(u)+"-",(u=n.cid)?u=u.call(t,{hash:{}}):(u=t.cid,u=typeof u===h?u.apply(t):u),s+=c(u)+'">',a={hash:{}},s+=c((o=n.t,o?o.call(t,"transactions-edit.web.includedAnalysis",a):l.call(t,"t","transactions-edit.web.includedAnalysis",a)))+"</label>\n	</div>\n</div>\n",s});return t.registerPartial("modules_transactions-edit_templates_transaction-split-cell",n),n}),define("hbs!modules/transactions-edit/templates/transaction-edit-form",["hbs","Handlebars","hbs!modules/transactions-edit/templates/transaction-split-cell"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var i="",s;i+="\n		",s=f.invokePartial(r["modules_transactions-edit_templates_transaction-split-cell"],"modules_transactions-edit_templates_transaction-split-cell",e,n,r);if(s||s===0)i+=s;return i+="\n	",i}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,r=r||e.partials;var s="",o,u,a,f=this,l=n.helperMissing,c=this.escapeExpression,h="function";s+='<div class="sf-split-form-view">\n	<div class="sf-form-row sf-form-inline sf-row-marked">\n		<span class="sf-column-transaction-date" data-col="',a={hash:{}},s+=c((o=n.t,o?o.call(t,"transactions-edit.transactionDate",a):l.call(t,"t","transactions-edit.transactionDate",a)))+'">',(u=n.labelDate)?u=u.call(t,{hash:{}}):(u=t.labelDate,u=typeof u===h?u.apply(t):u),s+=c(u)+'</span>\n		<span class="sf-column-transaction-title" data-col="',a={hash:{}},s+=c((o=n.t,o?o.call(t,"transactions-edit.transactionTitle",a):l.call(t,"t","transactions-edit.transactionTitle",a)))+'">'+c((o=(o=t.transaction,o==null||o===!1?o:o.name),typeof o===h?o.apply(t):o))+'</span>\n		<span class="sf-column-transaction-cat" data-col="',a={hash:{}},s+=c((o=n.t,o?o.call(t,"transactions-edit.transactionCat",a):l.call(t,"t","transactions-edit.transactionCat",a)))+'">',(u=n.currentCategoryName)?u=u.call(t,{hash:{}}):(u=t.currentCategoryName,u=typeof u===h?u.apply(t):u),s+=c(u)+'</span>\n		<span class="sf-column-transaction-amount" data-col="',a={hash:{}},s+=c((o=n.t,o?o.call(t,"transactions-edit.transactionWebAmount",a):l.call(t,"t","transactions-edit.transactionWebAmount",a)))+'">',a={hash:{curr:"{{transaction.currency}}"}},u=(o=n.formatAmount,o?o.call(t,(o=t.transaction,o==null||o===!1?o:o.amount),a):l.call(t,"formatAmount",(o=t.transaction,o==null||o===!1?o:o.amount),a));if(u||u===0)s+=u;s+="</span>\n	</div>\n	",a={hash:{},inverse:f.noop,fn:f.program(1,p,i)},u=(o=n.atLeast,o?o.call(t,t.splits,a):l.call(t,"atLeast",t.splits,a));if(u||u===0)s+=u;s+="\n	",a={hash:{parent:"{{this}}",i:t.remainCellNumber,isRemainder:"true",isDefault:"true",cid:"{{cid}}"},inverse:f.noop,fn:f.program(1,p,i)},u=(o=n.partial,o?o.call(t,a):l.call(t,"partial",a));if(u||u===0)s+=u;return s+='\n	<div class="sf-button-controls">\n		<button class="sf-button sf-button-add sf-split-add-action" type="button">\n			<span class="sf-button-icon">\n				<img src="resources/pfm/ui/css/icons/app-icons/dav-plus-white.svg" alt="',a={hash:{}},s+=c((o=n.t,o?o.call(t,"transactions-edit.buttonWebAddSplit",a):l.call(t,"t","transactions-edit.buttonWebAddSplit",a)))+'">\n			</span>\n			<span class="sf-button-text">',a={hash:{}},s+=c((o=n.t,o?o.call(t,"transactions-edit.buttonWebAddSplit",a):l.call(t,"t","transactions-edit.buttonWebAddSplit",a)))+'</span>\n		</button>\n	</div>\n	<input type="hidden" value="',(u=n.totalAmount)?u=u.call(t,{hash:{}}):(u=t.totalAmount,u=typeof u===h?u.apply(t):u),s+=c(u)+'" class="sf-transaction-total-amount" />\n	<input type="hidden" name="parent-accId" value="'+c((o=(o=t.transaction,o==null||o===!1?o:o.accId),typeof o===h?o.apply(t):o))+'" />\n	<input type="hidden" name="parent-accType" value="'+c((o=(o=t.transaction,o==null||o===!1?o:o.accType),typeof o===h?o.apply(t):o))+'" />\n	<input type="hidden" name="parent-id" value="'+c((o=(o=t.transaction,o==null||o===!1?o:o.id),typeof o===h?o.apply(t):o))+'" />\n</div>\n',s});return t.registerPartial("modules_transactions-edit_templates_transaction-edit-form",n),n}),define("hbs!modules/transactions-edit/templates/transactions-edit-case",["hbs","Handlebars","hbs!modules/transactions-edit/templates/transaction-edit-form"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){return"sf-collapsed"}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,r=r||e.partials;var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;s+='<div class="sf-transaction-edition-placeholder">\n\n	<div class="sf-form-row sf-transaction-edition sf-form-row-relative">\n		<div class="sf-tx-original-data">\n			<span class="sf-form-cell sf-date-cell">\n			<label for="sf-transaction-date-',(o=n.cid)?o=o.call(t,{hash:{}}):(o=t.cid,o=typeof o===f?o.apply(t):o),s+=l(o)+'">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"transactions-edit.transactionDate",a):c.call(t,"t","transactions-edit.transactionDate",a)))+"</label>\n				",a={hash:{id:"sf-transaction-date-{{cid}}",dataDatepickerName:"parent-postedDateStr",dataFormat:"{{format}}",dataFormatSubmit:"{{formatSubmit}}",dataValue:"{{date}}",dataMin:"{{minDate}}",dataMax:"{{today}}",disabled:"true"}},s+=l((o=n.datepicker,o?o.call(t,a):c.call(t,"datepicker",a)))+'\n		</span>\n		<span class="sf-form-cell sf-description-cell">\n			<label for="sf-transaction-title-',(u=n.cid)?u=u.call(t,{hash:{}}):(u=t.cid,u=typeof u===f?u.apply(t):u),s+=l(u)+'">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"transactions-edit.transactionTitle",a):c.call(t,"t","transactions-edit.transactionTitle",a)))+'</label>\n			<span class="sf-original-description">',u=(o=(o=t.transaction,o==null||o===!1?o:o.name),typeof o===f?o.apply(t):o);if(u||u===0)s+=u;s+='</span>\n		</span>\n		<span class="sf-form-cell sf-amount-cell">\n			<span class="sf-transaction-original-amount-title">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"transactions-edit.originalAmount",a):c.call(t,"t","transactions-edit.originalAmount",a)))+'</span>\n			<span class="sf-transaction-original-amount">',a={hash:{curr:"{{transaction.currency}}"}},u=(o=n.formatAmount,o?o.call(t,(o=t.transaction,o==null||o===!1?o:o.amount),a):c.call(t,"formatAmount",(o=t.transaction,o==null||o===!1?o:o.amount),a));if(u||u===0)s+=u;s+='</span>\n		</span>\n		</div>\n\n		<span class="sf-form-cell sf-description-cell sf-edit-description">\n			<label for="sf-transaction-title-',(u=n.cid)?u=u.call(t,{hash:{}}):(u=t.cid,u=typeof u===f?u.apply(t):u),s+=l(u)+'">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"transactions-edit.transactionTitle",a):c.call(t,"t","transactions-edit.transactionTitle",a)))+"</label>\n			",a={hash:{id:"sf-transaction-title-{{cid}}",name:"parent-name",value:"{{{transaction.name}}}",validateField:"transaction.name",disabled:"{{#if splits}}true{{/if}}"}},s+=l((o=n.textfield,o?o.call(t,a):c.call(t,"textfield",a)))+'\n			<div class="sf-icon-help sf-tx-name-help"></div>\n		</span>\n		<span class="sf-form-cell sf-edit-category">\n			<label for="sf-transaction-catId-',(u=n.cid)?u=u.call(t,{hash:{}}):(u=t.cid,u=typeof u===f?u.apply(t):u),s+=l(u)+'">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"transactions-edit.transactionCat",a):c.call(t,"t","transactions-edit.transactionCat",a)))+'</label>\n			<span class="sf-transaction-category-placeholder"></span>\n		</span>\n		<div class="sf-form-row sf-transaction-included-analysis sf-form-row-relative">\n			',a={hash:{name:"parent-computable",type:"checkbox",id:"sf-transaction-computable-{{cid}}",checked:"{{transaction.computable}}"}},s+=l((o=n.checkbox,o?o.call(t,a):c.call(t,"checkbox",a)))+'\n			<label for="sf-transaction-computable-',(u=n.cid)?u=u.call(t,{hash:{}}):(u=t.cid,u=typeof u===f?u.apply(t):u),s+=l(u)+'">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"transactions-edit.web.includedAnalysis",a):c.call(t,"t","transactions-edit.web.includedAnalysis",a)))+'</label>\n		</div>\n	</div>\n	<div class="sf-box sf-transaction-split-wrapper sf-accordion-item ',u=n.unless.call(t,t.splits,{hash:{},inverse:h.noop,fn:h.program(1,p,i)});if(u||u===0)s+=u;s+='">\n		<div class="sf-transaction-split-toggle sf-accordion-header">\n			<a class="sf-accordion-toggle-link" href="javascript:void(0);">\n				<span class="sf-scissors-icon">\n					<img src="resources/pfm/ui/css/icons/app-icons/dav-scissors.png" width="24" height="24" alt="',a={hash:{}},s+=l((o=n.t,o?o.call(t,"transactions-edit.webSplitTransaction",a):c.call(t,"t","transactions-edit.webSplitTransaction",a)))+'">\n				</span>\n				<span class="sf-icon"></span> ',a={hash:{}},s+=l((o=n.t,o?o.call(t,"transactions-edit.webSplitTransaction",a):c.call(t,"t","transactions-edit.webSplitTransaction",a)))+'\n			</a>\n			<div class="sf-icon-help sf-split-help"></div>\n		</div>\n		<div class="sf-transaction-split-container sf-accordion-body">\n			',u=h.invokePartial(r["modules_transactions-edit_templates_transaction-edit-form"],"modules_transactions-edit_templates_transaction-edit-form",t,n,r);if(u||u===0)s+=u;return s+='\n		</div>\n	</div>\n</div>\n<div class="sf-transaction-tags sf-panel-section">\n	<div class="sf-panel-section-body"></div>\n</div>\n',s});return t.registerPartial("modules_transactions-edit_templates_transactions-edit-case",n),n}),define("hbs!modules/transactions-edit/templates/transactions-add-case",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing;return s+='<div class="sf-transaction-edition">\n	<fieldset>\n		<div class="sf-form-row sf-date-cell">\n			<label for="sf-transaction-date-',(o=n.cid)?o=o.call(t,{hash:{}}):(o=t.cid,o=typeof o===f?o.apply(t):o),s+=l(o)+'">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"transactions-edit.transactionDate",a):c.call(t,"t","transactions-edit.transactionDate",a)))+"</label>\n			",a={hash:{id:"sf-transaction-date-{{cid}}",dataDatepickerName:"postedDateStr",dataFormat:"{{format}}",dataFormatSubmit:"{{formatSubmit}}",dataValue:"{{date}}",dataMax:"{{today}}"}},s+=l((o=n.datepicker,o?o.call(t,a):c.call(t,"datepicker",a)))+'\n		</div>\n		<div class="sf-form-row sf-description-cell">\n			<label for="sf-transaction-title-',(u=n.cid)?u=u.call(t,{hash:{}}):(u=t.cid,u=typeof u===f?u.apply(t):u),s+=l(u)+'">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"details.addTransactionDescription",a):c.call(t,"t","details.addTransactionDescription",a)))+'</label>\n			<div class="sf-tx-name-wrapper">\n				',a={hash:{id:"sf-transaction-title-{{cid}}",name:"name",validateField:"transaction.name"}},s+=l((o=n.textfield,o?o.call(t,a):c.call(t,"textfield",a)))+'\n				<div class="sf-icon-help sf-tx-add-name-help"></div>\n			</div>\n		</div>\n		</fieldset>\n		<div class="sf-form-row sf-form-cat-amount">\n			<div class="sf-form-cell sf-form-cat">\n				<label for="sf-transaction-catId-',(u=n.cid)?u=u.call(t,{hash:{}}):(u=t.cid,u=typeof u===f?u.apply(t):u),s+=l(u)+'">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"transactions-edit.transactionCat",a):c.call(t,"t","transactions-edit.transactionCat",a)))+'</label>\n				<span class="sf-transaction-category-placeholder"></span>\n			</div>\n\n			<div class="sf-form-cell sf-form-amount">\n				<label for="sf-transaction-amount-',(u=n.cid)?u=u.call(t,{hash:{}}):(u=t.cid,u=typeof u===f?u.apply(t):u),s+=l(u)+'">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"transactions-edit.transactionWebAmount",a):c.call(t,"t","transactions-edit.transactionWebAmount",a)))+"</label>\n				",a={hash:{id:"sf-transaction-amount-{{cid}}",value:t.initialAmount,name:"amount",affix:"currency","class":"sf-input-amount",validateField:"transactionSplit.amount",forceNegativeAmount:t.isExpenses}},s+=l((o=n.textfield,o?o.call(t,a):c.call(t,"textfield",a)))+'\n			</div>\n\n            <div class="sf-category-error">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"transactions-edit.categoryError",a):c.call(t,"t","transactions-edit.categoryError",a)))+'</div>\n\n		</div>\n	</fieldset>\n	<fieldset class="sf-tx-included-analysis-wrapper">\n		<div class="sf-form-row sf-transaction-included-analysis sf-form-row-relative">\n			',a={hash:{name:"computable",type:"checkbox",id:"sf-transaction-computable-{{cid}}"}},s+=l((o=n.checkbox,o?o.call(t,a):c.call(t,"checkbox",a)))+'\n			<label for="sf-transaction-computable-',(u=n.cid)?u=u.call(t,{hash:{}}):(u=t.cid,u=typeof u===f?u.apply(t):u),s+=l(u)+'">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"transactions-edit.web.includedAnalysis",a):c.call(t,"t","transactions-edit.web.includedAnalysis",a)))+'</label>\n		</div>\n	</fieldset>\n</div>\n<div class="sf-transaction-tags sf-panel-section">\n	<div class="sf-panel-section-body"></div>\n</div>\n',s});return t.registerPartial("modules_transactions-edit_templates_transactions-add-case",n),n}),define("hbs!modules/transactions-edit/templates/transactions-edit",["hbs","Handlebars","hbs!modules/transactions-edit/templates/transactions-edit-case","hbs!modules/transactions-edit/templates/transactions-add-case"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){return"sf-form-vertical"}function h(e,t){return"sf-form-horizontal"}function p(e,t){var i="",s;i+="\n			",s=a.invokePartial(r["modules_transactions-edit_templates_transactions-edit-case"],"modules_transactions-edit_templates_transactions-edit-case",e,n,r);if(s||s===0)i+=s;return i+="\n		",i}function d(e,t){var i="",s;i+="\n			",s=a.invokePartial(r["modules_transactions-edit_templates_transactions-add-case"],"modules_transactions-edit_templates_transactions-add-case",e,n,r);if(s||s===0)i+=s;return i+="\n		",i}function v(e,t){var r,i;return i={hash:{"class":"sf-swap-amount",type:"button",text:"account-import.swapAmountButton"}},l((r=n.button,r?r.call(e,i):f.call(e,"button",i)))}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,r=r||e.partials;var s="",o,u,a=this,f=n.helperMissing,l=this.escapeExpression;s+='<div class="sf-transactions-split-form-placeholder">\n	<form class="sf-transactions-split-form ',o=n["if"].call(t,t.transaction,{hash:{},inverse:a.program(3,h,i),fn:a.program(1,c,i)});if(o||o===0)s+=o;s+='"  data-validate="parsley">\n		',o=n["if"].call(t,t.transaction,{hash:{},inverse:a.program(7,d,i),fn:a.program(5,p,i)});if(o||o===0)s+=o;s+='\n	<div class="sf-button-controls">\n		',o=n["if"].call(t,t.changeAmountAvailable,{hash:{},inverse:a.noop,fn:a.program(9,v,i)});if(o||o===0)s+=o;return s+="\n\n        ",u={hash:{"class":"sf-button-save sf-action-save-split-button",text:"common.button.save",type:"button"}},s+=l((o=n.button,o?o.call(t,u):f.call(t,"button",u)))+"\n\n		",u={hash:{"class":"sf-popup-cancel",type:"button",text:"common.button.cancel"}},s+=l((o=n.button,o?o.call(t,u):f.call(t,"button",u)))+"\n	</div>\n	</form>\n</div>",s});return t.registerPartial("modules_transactions-edit_templates_transactions-edit",n),n}),define("libs/require/css/css!modules/transactions-edit/css/transactions-edit",[],function(){}),define("libs/require/css/css!ui/modules/reform/datepicker/css/datepicker",[],function(){}),define("libs/require/css/css!libs/pickadate/picker",[],function(){}),define("libs/pickadate/picker",["jQuery","css!libs/pickadate/picker"],function(e,t){var n=e,r=e(document),i=function(e,t,n){function r(i,s,o,u){function d(){return r._.node("div",r._.node("div",r._.node("div",r._.node("div",p.component.nodes(a.open),l.box),l.wrap),l.frame),l.holder)}function v(e){e.stopPropagation(),e.type=="focus"&&p.$root.addClass(l.focused),p.open()}if(!i)return r;var a={id:Math.abs(~~(Math.random()*1e9))},f=o?e.extend(!0,{},o.defaults,u):u||{},l=e.extend({},r.klasses(),f.klass),c=e(i),h=function(){return this.start()},p=h.prototype={constructor:h,$node:c,start:function(){return a&&a.start?p:(a.methods={},a.start=!0,a.open=!1,a.type=i.type,i.autofocus=i==document.activeElement,i.type="text",i.readOnly=!0,p.component=new o(p,f),p.$root=e(r._.node("div",d(),l.picker)).on({focusin:function(e){p.$root.removeClass(l.focused),e.stopPropagation()},mousedown:function(e){e.target!=p.$root.children()[0]&&e.stopPropagation()},click:function(t){var n=t.target,s=n.attributes.length?e(n):e(n).closest("[data-pick]"),o=s.data();n!=p.$root.children()[0]&&(t.stopPropagation(),p.$root.find(document.activeElement).length||i.focus(),o.nav&&!s.hasClass(l.navDisabled)?p.set("highlight",p.component.item.highlight,{nav:o.nav}):r._.isInteger(o.pick)&&!s.hasClass(l.disabled)?p.set("select",o.pick).close(!0):o.clear&&p.clear().close(!0))}}),p._hidden=f.formatSubmit?e("<input type=hidden name="+i.name+(f.hiddenSuffix||"_submit")+(c.data("value")?' value="'+r._.trigger(p.component.formats.toString,p.component,[f.formatSubmit,p.component.item.select])+'"':"")+">")[0]:n,c.addClass(l.input).on("focus.P"+a.id+" click.P"+a.id,v).on("change.P"+a.id,function(){p._hidden&&(p._hidden.value=i.value?r._.trigger(p.component.formats.toString,p.component,[f.formatSubmit,p.component.item.select]):"")}).on("keydown.P"+a.id,function(e){var t=e.keyCode,n=/^(8|46)$/.test(t);if(t==27)return p.close(),!1;if(t==32||n||!a.open&&p.component.key[t])e.preventDefault(),e.stopPropagation(),n?p.clear().close():p.open()}).val(c.data("value")?r._.trigger(p.component.formats.toString,p.component,[f.format,p.component.item.select]):i.value).after(p.$root,p._hidden).data(s,p),p.on({start:p.component.onStart,render:p.component.onRender,stop:p.component.onStop,open:p.component.onOpen,close:p.component.onClose,set:p.component.onSet}).on({start:f.onStart,render:f.onRender,stop:f.onStop,open:f.onOpen,close:f.onClose,set:f.onSet}),i.autofocus&&p.open(),p.trigger("start").trigger("render"))},render:function(){return p.$root.html(d()),p.trigger("render")},stop:function(){return a.start?(p.close(),p._hidden&&p._hidden.parentNode.removeChild(p._hidden),p.$root.remove(),c.removeClass(l.input).off(".P"+a.id).removeData(s),i.type=a.type,i.readOnly=!1,p.trigger("stop"),a.methods={},a.start=!1,p):p},open:function(e){return a.open?p:(c.addClass(l.active),p.$root.addClass(l.opened),e!==!1&&(a.open=!0,c.focus(),t.on("click.P"+a.id+" focusin.P"+a.id,function(e){if(e.type==="focusin"&&p.$node.parents().index(e.target)>=0)return;e.target!=i&&e.target!=document&&p.close()}).on("keydown.P"+a.id,function(e){var t=e.keyCode,n=p.component.key[t],s=e.target;t==27?p.close(!0):s!=i||!n&&t!=13?p.$root.find(s).length&&t==13&&(e.preventDefault(),s.click()):(e.preventDefault(),n?r._.trigger(p.component.key.go,p,[n]):p.$root.find("."+l.highlighted).hasClass(l.disabled)||p.set("select",p.component.item.highlight).close())})),p.trigger("open"))},close:function(e){return e&&(c.off("focus.P"+a.id).focus(),setTimeout(function(){c.on("focus.P"+a.id,v)},0)),c.removeClass(l.active),p.$root.removeClass(l.opened+" "+l.focused),a.open&&(a.open=!1,t.off(".P"+a.id)),p.trigger("close")},clear:function(){return p.set("clear")},set:function(e,t,n){var i,s,o=r._.isObject(e),u=o?e:{};if(e){o||(u[e]=t);for(i in u)s=u[i],p.component.item[i]&&p.component.set(i,s,n||{}),(i=="select"||i=="clear")&&c.val(i=="clear"?"":r._.trigger(p.component.formats.toString,p.component,[f.format,p.component.get(i)])).trigger("change");p.render()}return p.trigger("set",u)},get:function(e,t){e=e||"value";if(a[e]!=null)return a[e];if(e=="value")return i.value;if(p.component.item[e])return typeof t=="string"?r._.trigger(p.component.formats.toString,p.component,[t,p.component.get(e)]):p.component.get(e)},on:function(e,t){var n,i,s=r._.isObject(e),o=s?e:{};if(e){s||(o[e]=t);for(n in o)i=o[n],a.methods[n]=a.methods[n]||[],a.methods[n].push(i)}return p},trigger:function(e,t){var n=a.methods[e];return n&&n.map(function(e){r._.trigger(e,p,[t])}),p}};return new h}return r.klasses=function(e){return e=e||"picker",{picker:e,opened:e+"--opened",focused:e+"--focused",input:e+"__input",active:e+"__input--active",holder:e+"__holder",frame:e+"__frame",wrap:e+"__wrap",box:e+"__box"}},r._={group:function(e){var t,n="",i=r._.trigger(e.min,e);for(;i<=r._.trigger(e.max,e,[i]);i+=e.i)t=r._.trigger(e.item,e,[i]),n+=r._.node(e.node,t[0],t[1],t[2]);return n},node:function(e,t,n,r){return t?(t=Array.isArray(t)?t.join(""):t,n=n?' class="'+n+'"':"",r=r?" "+r:"","<"+e+n+r+">"+t+"</"+e+">"):""},lead:function(e){return(e<10?"0":"")+e},trigger:function(e,t,n){return typeof e=="function"?e.apply(t,n||[]):e},digits:function(e){return/\d/.test(e[1])?2:1},isObject:function(e){return{}.toString.call(e).indexOf("Object")>-1},isDate:function(e){return{}.toString.call(e).indexOf("Date")>-1},isInteger:function(e){return{}.toString.call(e).indexOf("Number")>-1&&e%1===0}},r.extend=function(t,n){e.fn[t]=function(i,s){var o=this.data(t);return i=="picker"?o:o&&typeof i=="string"?(r._.trigger(o[i],o,[s]),this):this.each(function(){var s=e(this);s.data(t)||new r(this,t,n,i)})},e.fn[t].defaults=n.defaults},r}(e,e(document));return i}),define("libs/pickadate/picker.date",["libs/pickadate/picker"],function(e){(function(){function r(e,t){var n=this,r=e.$node.data("value");n.settings=t,n.queue={min:"measure create",max:"measure create",now:"now create",select:"parse create validate",highlight:"navigate create validate",view:"create validate viewset",disable:"flipItem",enable:"flipItem"},n.item={},n.item.disable=(t.disable||[]).slice(0),n.item.enable=-function(e){return e[0]===!0?e.shift():-1}(n.item.disable),n.set("min",t.min).set("max",t.max).set("now").set("select",r||e.$node[0].value||n.item.now,{format:r?t.formatSubmit:t.format,data:!!r,currentCentury:t.formatShortYear}),n.key={40:7,38:-7,39:1,37:-1,go:function(e){n.set("highlight",[n.item.highlight.year,n.item.highlight.month,n.item.highlight.date+e],{interval:e}),this.render()}},e.on("render",function(){e.$root.find("."+t.klass.selectMonth).on("change",function(){e.set("highlight",[e.get("view").year,this.value,e.get("highlight").date]),e.$root.find("."+t.klass.selectMonth).focus()}),e.$root.find("."+t.klass.selectYear).on("change",function(){e.set("highlight",[this.value,e.get("view").month,e.get("highlight").date]),e.$root.find("."+t.klass.selectYear).focus()})}).on("open",function(){e.$root.find("button, select").attr("disabled",!1)}).on("close",function(){e.$root.find("button, select").attr("disabled",!0)})}var t=7,n=6;r.prototype.set=function(e,t,n){var r=this;return r.item[e=="enable"?"disable":e=="flip"?"enable":e]=r.queue[e].split(" ").map(function(i){return t=r[i](e,t,n)}).pop(),e=="select"?r.set("highlight",r.item.select,n):e=="highlight"?r.set("view",r.item.highlight,n):(e=="flip"||e=="min"||e=="max"||e=="disable"||e=="enable")&&r.item.select&&r.item.highlight&&r.set("select",r.item.select,n).set("highlight",r.item.highlight,n),r},r.prototype.get=function(e){return this.item[e]},r.prototype.create=function(t,n,r){var i,s=this;return n=n===undefined?t:n,n==-Infinity||n==Infinity?i=n:e._.isObject(n)&&e._.isInteger(n.pick)?n=n.obj:Array.isArray(n)?(n[0].length==2&&r.currentCentury&&(n[0]=parseInt(r.currentCentury,10)/100+n[0]),n=new Date(n[0],n[1],n[2])):e._.isInteger(n)||e._.isDate(n)?n=s.normalize(new Date(n),r):n=s.now(t,n,r),{year:i||n.getFullYear(),month:i||n.getMonth(),date:i||n.getDate(),day:i||n.getDay(),obj:i||n,pick:i||n.getTime()}},r.prototype.now=function(e,t,n){return t=new Date,n&&n.rel&&t.setDate(t.getDate()+n.rel),this.normalize(t,n)},r.prototype.navigate=function(t,n,r){if(e._.isObject(n)){var i=new Date(n.year,n.month+(r&&r.nav?r.nav:0),1),s=i.getFullYear(),o=i.getMonth(),u=n.date;while((new Date(s,o,u)).getMonth()!==o)u-=1;n=[s,o,u]}return n},r.prototype.normalize=function(e){return e.setHours(0,0,0,0),e},r.prototype.measure=function(t,n){var r=this;return n?e._.isInteger(n)&&(n=r.now(t,n,{rel:n})):n=t=="min"?-Infinity:Infinity,n},r.prototype.viewset=function(e,t){return this.create([t.year,t.month,1])},r.prototype.validate=function(t,n,r){var i=this,s=n,o=r&&r.interval?r.interval:1,u=i.item.enable===-1,a,f,l=i.item.min,c=i.item.max,h,p,d=u&&i.item.disable.filter(function(t){if(Array.isArray(t)){var r=i.create(t).pick;r<n.pick?a=!0:r>n.pick&&(f=!0)}return e._.isInteger(t)}).length;if(!u&&i.disabled(n)||u&&i.disabled(n)&&(d||a||f)||n.pick<=l.pick||n.pick>=c.pick){u&&!d&&(!f&&o>0||!a&&o<0)&&(o*=-1);while(i.disabled(n)){Math.abs(o)>1&&(n.month<s.month||n.month>s.month)&&(n=s,o=Math.abs(o)/o),n.pick<=l.pick?(h=!0,o=1):n.pick>=c.pick&&(p=!0,o=-1);if(h&&p)break;n=i.create([n.year,n.month,n.date+o])}}return n},r.prototype.disabled=function(t){var n=this,r=n.item.disable.filter(function(r){if(e._.isInteger(r))return t.day===(n.settings.firstDay?r:r-1)%7;if(Array.isArray(r))return t.pick===n.create(r).pick}).length;return t.pick<n.item.min.pick||t.pick>n.item.max.pick||n.item.enable===-1?!r:r},r.prototype.parse=function(t,n,r){var i=this,s={};if(!n||e._.isInteger(n)||Array.isArray(n)||e._.isDate(n)||e._.isObject(n)&&e._.isInteger(n.pick))return n;if(!r||!r.format)throw"Need a formatting option to parse this..";return i.formats.toArray(r.format).map(function(t){var r=i.formats[t],o=r?e._.trigger(r,i,[n,s]):t.replace(/^!/,"").length;r&&(s[t]=n.substr(0,o)),n=n.substr(o)}),[s.yyyy||s.yy,+(s.mm||s.m)-(r.data?1:0),s.dd||s.d]},r.prototype.formats=function(){var t=function(e,t,n){var r=e.match(/\w+/)[0];return!n.mm&&!n.m&&(n.m=t.indexOf(r)),r.length};return{d:function(t,n){return t?e._.digits(t):n.date},dd:function(t,n){return t?2:e._.lead(n.date)},ddd:function(e,t){return e?getFirstWordLength(e):this.settings.weekdaysShort[t.day]},dddd:function(e,t){return e?getFirstWordLength(e):this.settings.weekdaysFull[t.day]},m:function(t,n){return t?e._.digits(t):n.month+1},mm:function(t,n){return t?2:e._.lead(n.month+1)},mmm:function(e,n){var r=this.settings.monthsShort;return e?t(e,r,n):r[n.month]},mmmm:function(e,n){var r=this.settings.monthsFull;return e?t(e,r,n):r[n.month]},yy:function(e,t){return e?2:(""+t.year).slice(2)},yyyy:function(e,t){return e?4:t.year},toArray:function(e){return e.split(/(d{1,4}|m{1,4}|y{4}|yy|!.)/g)},toString:function(t,n){var r=this;return r.formats.toArray(t).map(function(t){return e._.trigger(r.formats[t],r,[0,n])||t.replace(/^!/,"")}).join("")}}}(),r.prototype.flipItem=function(e,t){var n=this,r=n.item.disable,i=n.item.enable===-1;if(t=="flip")n.item.enable=i?1:-1;else if(!i&&e=="enable"||i&&e=="disable")r=n.removeDisabled(r,t);else if(!i&&e=="disable"||i&&e=="enable")r=n.addDisabled(r,t);return r},r.prototype.addDisabled=function(e,t){var n=this;return t.map(function(t){n.filterDisabled(e,t).length||e.push(t)}),e},r.prototype.removeDisabled=function(e,t){var n=this;return t.map(function(t){e=n.filterDisabled(e,t,1)}),e},r.prototype.filterDisabled=function(e,t,n){var r=Array.isArray(t);return e.filter(function(e){var i=!r&&t===e||r&&Array.isArray(e)&&t.toString()===e.toString();return n?!i:i})},r.prototype.nodes=function(r){var i=this,s=i.settings,o=i.item.now,u=i.item.select,a=i.item.highlight,f=i.item.view,l=i.item.disable,c=i.item.min,h=i.item.max,p=function(n){return s.firstDay&&n.push(n.shift()),e._.node("thead",e._.group({min:0,max:t-1,i:1,node:"th",item:function(e){return[n[e],s.klass.weekdays]}}))}((s.showWeekdaysFull?s.weekdaysFull:s.weekdaysShort).slice(0)),d=function(t){return e._.node("div"," ",s.klass["nav"+(t?"Next":"Prev")]+(t&&f.year>=h.year&&f.month>=h.month||!t&&f.year<=c.year&&f.month<=c.month?" "+s.klass.navDisabled:""),"data-nav="+(t||-1))},v=function(t){return s.selectMonths?e._.node("select",e._.group({min:0,max:11,i:1,node:"option",item:function(e){return[t[e],0,"value="+e+(f.month==e?" selected":"")+(f.year==c.year&&e<c.month||f.year==h.year&&e>h.month?" disabled":"")]}}),s.klass.selectMonth,r?"":"disabled"):e._.node("div",t[f.month],s.klass.month)},m=function(){var t=f.year,n=s.selectYears===!0?5:~~(s.selectYears/2);if(n){var i=c.year,o=h.year,u=t-n,a=t+n;i>u&&(a+=i-u,u=i);if(o<a){var l=u-i,p=a-o;u-=l>p?p:l,a=o}return e._.node("select",e._.group({min:u,max:a,i:1,node:"option",item:function(e){return[e,0,"value="+e+(t==e?" selected":"")]}}),s.klass.selectYear,r?"":"disabled")}return e._.node("div",t,s.klass.year)};return e._.node("div",d()+d(1)+v(s.showMonthsShort?s.monthsShort:s.monthsFull)+m(),s.klass.header)+e._.node("table",p+e._.node("tbody",e._.group({min:0,max:n-1,i:1,node:"tr",item:function(n){var r=s.firstDay&&i.create([f.year,f.month,1]).day===0?-7:0;return[e._.group({min:t*n-f.day+r+1,max:function(){return this.min+t-1},i:1,node:"td",item:function(t){return t=i.create([f.year,f.month,t+(s.firstDay?1:0)]),[e._.node("div",t.date,function(e){return e.push(f.month==t.month?s.klass.infocus:s.klass.outfocus),o.pick==t.pick&&e.push(s.klass.now),u&&u.pick==t.pick&&e.push(s.klass.selected),a&&a.pick==t.pick&&e.push(s.klass.highlighted),(l&&i.disabled(t)||t.pick<c.pick||t.pick>h.pick)&&e.push(s.klass.disabled),e.join(" ")}([s.klass.day]),"data-pick="+t.pick)]}})]}})),s.klass.table)+e._.node("div",e._.node("button",s.today,s.klass.buttonToday,"data-pick="+o.pick+(r?"":" disabled"))+e._.node("button",s.clear,s.klass.buttonClear,"data-clear=1"+(r?"":" disabled")),s.klass.footer)},r.defaults=function(e){return{monthsFull:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdaysFull:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],today:"Today",clear:"Clear",format:"d mmmm, yyyy",klass:{table:e+"table",header:e+"header",navPrev:e+"nav--prev",navNext:e+"nav--next",navDisabled:e+"nav--disabled",month:e+"month",year:e+"year",selectMonth:e+"select--month",selectYear:e+"select--year",weekdays:e+"weekday",day:e+"day",disabled:e+"day--disabled",selected:e+"day--selected",highlighted:e+"day--highlighted",now:e+"day--today",infocus:e+"day--infocus",outfocus:e+"day--outfocus",footer:e+"footer",buttonClear:e+"button--clear",buttonToday:e+"button--today"}}}(e.klasses().picker+"__"),e.extend("pickadate",r)})()}),define("ui/modules/reform/datepicker/datepicker-module",["classes/reform-plugin","classes/reform","jQuery","utils/util","utils/i18n","css!ui/modules/reform/datepicker/css/datepicker","libs/pickadate/picker.date"],function(e,t,n,r){return t.Datepicker=e.extend({initialize:function(){this._super.apply(this,arguments);var e=this.$el.data("min"),t=this.$el.data("max");e=e?r.isBoolean(e)?e:r.date.parseBackendDate(e):this.config.min,t=t?r.isBoolean(t)?t:r.date.parseBackendDate(t):this.config.max,this.op={showMonthsShort:this.$el.data("show-months-full")||this.config.showMonthsShort,showWeekdaysFull:this.$el.data("show-weekends-full")||this.config.showWeekdaysFull,hiddenSuffix:this.$el.data("datepicker-name")||this.config.datePickerName,today:"",clear:"",format:this.$el.data("format")||this.config.format,formatSubmit:this.$el.data("format-submit")||this.config.formatSubmit,formatShortYear:2e3,firstDay:this.$el.data("firstDay")||this.config.firstDay,min:e,max:t,disable:this.$el.data("disable")||this.config.disable,monthsFull:r.values(r.i18n.get("common.date.monthNames")),monthsShort:r.values(r.i18n.get("common.date.shortMonthNames")),weekdaysFull:r.values(r.i18n.get("common.date.shortDayNames")),weekdaysShort:r.values(r.i18n.get("common.date.shortDayNames")),selectYears:!0,selectMonths:!0},this.$el.pickadate(this.op);var n=this.$el.next().addClass("sf-datepicker-window");n.find(".picker__select--year")[0].disabled=!1,n.find(".picker__select--month")[0].disabled=!1,this._addListeners()},_addListeners:function(){var e=this.$el,t=e.pickadate("picker"),n=["open","close","render","start","stop","set"],i=r.reduce(n,function(e,t){var n="datepicker:"+t;return e[t]=r.bind(function(){this.$el.trigger(n)},this),e},{},this);t.on(i)},reinit:function(){this.update()},update:function(){}},{ID:"sf-reform-datepicker",REFORM_ID:"ReForm.Datepicker",SELECTOR:"input.sf-datepicker",defaults:{datePickerName:"date",showMonthsShort:undefined,showWeekdaysFull:undefined,format:"d mmmm, yyyy",formatSubmit:undefined,firstDay:undefined,min:undefined,max:undefined,disable:!1}}),t}),define("modules/transactions-edit/transactions-edit-module",["classes/item-view","ui/modules/reform/select/select-module","services/categories-service","services/transactions-service","services/accounts-service","utils/util","jQuery","modules/category-selector/category-selector-module","modules/transactions-edit/views/transactions-edit-tags-view","hbs!modules/transactions-edit/templates/transactions-edit","hbs!modules/transactions-edit/templates/transaction-split-cell","css!modules/transactions-edit/css/transactions-edit","ui/modules/reform/datepicker/datepicker-module","utils/validator","utils/number","utils/date"],function(e,t,n,r,i,s,o,u,a,f,l){var c=e.extend({template:f,ui:{$tagsSectionContainer:".sf-transaction-tags .sf-panel-section-body"},events:{"click .sf-accordion-toggle-link":"_toggleList","click button.sf-split-add-action":"_addSplitCell","click .sf-split-delete-action":"_deleteSplitCell","click button.sf-all-split-delete-action":"_deleteAllSplits","submit .sf-transactions-split-form":"_saveSplitTransaction","keyup .sf-input-transaction-amount":"_calculateRemainder","focusin .sf-datepicker":"_fixDatePickersZIndex","click .sf-swap-amount":"_swapFormattedAmount","click .sf-action-delete-transaction-button":"_deleteTransaction"},triggers:{"click .sf-action-cancel-split-triggerer":"cancel"},initialize:function(){this._super.apply(this,arguments),this.categoriesService=n.getInstance(),this.transactionsService=r.getInstance(),this.accountsService=i.getInstance(),this.categories=null,this.accounts=null,typeof this.options.transaction=="undefined"&&(this._isNewTransaction=!0,typeof this.options.isIncome!="undefined"&&(this._isIncome=this.options.isIncome)),this._isSplit=!1},serializeData:function(){var e=this.options.transaction,t=!1;e&&(t=e.get("accType")===i.ACC_TYPE_CASH||e.get("entId")===2),this.transactionData={amountEditable:this._isAmountEditable(e),categoryOptions:s.map(this.categories.data.categories,function(e){return s.pick(e,"name","value","children","color")}),format:s.date.getDatepickerFormat(this.config.datePickerFormat),formatSubmit:s.date.getDatepickerFormat(this.config.datePickerSubmitFormat),initialAmount:s.number.format(0),remainCellNumber:typeof this.options.splits!="undefined"?this.options.splits.length:1,today:!0,minDate:this.contextConfig.widget?this.contextConfig.widget.contextConfig.minDate?s.date.formatBackendDate(this.contextConfig.widget.contextConfig.minDate):null:null,splits:this._serializeSplits(this.options.splits),currency:this.options.accCurrency};if(!this._isNewTransaction)s.extend(this.transactionData,{currentCategoryName:e.get("category").get("catName"),transaction:e.attributes,labelDate:s.date.format(e.get("date"),this.config.datePickerFormat),cashAccount:t,date:s.date.format(e.get("date"),this.config.datePickerSubmitFormat),totalAmount:s.number.format(Math.abs(s.number.parse(e.get("amount")))),forceNegativeAmount:s.number.parse(e.get("amount"))<0,cid:this.cid,changeAmountAvailable:!1});else{var n=new Date;s.extend(this.transactionData,{labelDate:s.date.format(n,this.config.datePickerFormat),date:s.date.format(n,this.config.datePickerSubmitFormat),freeAmount:typeof this._isIncome=="undefined",isExpenses:!this._isIncome,cid:this.cid,changeAmountAvailable:!0})}return this.transactionData},_serializeSplits:function(e){return e?e.map(function(e){return e.attributes.date=s.date.format(e.get("date"),this.config.datePickerSubmitFormat),e.attributes},this):null},_isAmountEditable:function(){return!1},render:function(e){if(e)return this._super();var t=this,n=this.options.transaction;if(!this.categories){s.when(this.categoriesService.getPlainCategories()).done(function(e){t.categories=e,t.render()}).fail(function(e){console.error("[TransactionsEditModule] Categories retrieval error",e),t.publish("error",e)});return}if(!this.accounts){s.when(this.accountsService.get()).done(function(e){t.accounts=e,t.render()}).fail(function(e){console.error("[TransactionsEditModule] Accounts retrieval error",e),t.publish("error",e)});return}if(this.config.showTagsPanel&&!this.tags){s.when(this.transactionsService.getTransactionsTags()).done(function(e){t.tags=e,t.render()}).fail(function(e){console.error("[TransactionsEditModule] Tags retrieval error",e),t.publish("error",e)});return}if(n&&n.has("parentOpId")){this._isSplit=!0,s.when(this.transactionsService.getTransactionAndSplits(n)).done(function(e){t.options.transaction=e.parent,t.options.splits=e.children,t.render(!0)}).fail(function(e){console.error("[TransactionsEditModule] Splits retrieval error",e),t.publish("error",e)});return}this._isSplit=!1,this.render(!0)},onRender:function(){this._super(),this._lastFormValues&&(this.$("form [name=name]").val(this._lastFormValues.name),this.$("form .sf-datepicker").attr("data-value",this._lastFormValues.postedDateStr),this.$("form [name=amount]").val(this._lastFormValues.amount),this.$("form [name=computable]").val(this._lastFormValues.computable)),this._initAllSelects(),t.init(this.$el),this._initialValidation(),this._isSplit&&this._calculateRemainder();if(this.config.showTagsPanel){var e=s.extend({transaction:this.options.transaction,tags:this.tags},this.contextConfig),n=this;this._tagsView=new a(e),this._tagsView.render(),this._tagsView.on("view:change",function(){n.trigger("view:change")}),this.ui.$tagsSectionContainer.html(this._tagsView.$el)}this.trigger("onRenderCompleted")},_initAllSelects:function(){this._initParentSelect();var e=this.$(".sf-split-fieldset");this.splitSelects=[],s.each(e,function(e,t){this._initSplitSelect(t)},this)},_initParentSelect:function(){var e=this.$(".sf-transaction-category-placeholder");if(e.size()>0){var t={el:e,id:"sf-transaction-catId-"+this.cid,name:this._isNewTransaction?"catId":"parent-catId",catId:this._isNewTransaction?s.first(this.categories.data.categories).value:this.options.transaction.get("category").get("catId"),isIncome:this._isIncome,source:"categoryPopupSelector"},n=this;this.parentCategorySelect=new u(s.extend(t,this.contextConfig)),this.parentCategorySelect.render(),this.parentCategorySelect.on("categorySelectorShowed",function(){n.trigger("categorySelectorShowed");if(n._isSplit){var e=n.$(".sf-transaction-edition"),t=e.find("input, select, :checkbox");t.prop("disabled",!0),n.parentCategorySelect.update()}})}},_initSplitSelect:function(e){var t="#sf-split-fieldset-",n=".sf-column-transaction-cat",r="",i,o;r=t+e+" "+n;if(this.$(r).length){var a;this.options.splits&&e<this.options.splits.length?a=this.options.splits.at(e).get("category"):a=this.options.transaction.get("category"),o={el:this.$(r).first(),name:"children-"+e+"-catId",catId:a.get("catId")},i=new u(s.extend(o,this.contextConfig)),this.splitSelects.push(i),i.render()}},_initialValidation:function(){var e=this.$("form"),t=this.$(".sf-split-add-action"),n=this.$(".sf-split-fieldset"),r=n.length;s.validator.validate(this.$("form")),this._isSplit||s.each(n,function(t){s.validator.removeItem(e,o(t))}),r>this.config.limitOfSplits&&t.prop("disabled",!0)},updateSelectors:function(e){if(!e)return!1;if(this.parentCategorySelect._select.currentText==e.get("category").get("catName")){var t=e.get("catName"),n=this.parentCategorySelect._select.getOptionByText(t);n&&(this.parentCategorySelect._select.selectOption(n.data("index")),this.parentCategorySelect._select.close())}s.each(this.splitSelects,function(t){if(t._select.currentText==e.get("category").get("catName")){var n=e.get("catName"),r=t._select.getOptionByText(n);r&&(t._select.selectOption(r.data("index")),t._select.close())}})},_toggleList:function(e){var t=this.$("form"),n=this.$(".sf-transaction-split-container").closest(".sf-accordion-item"),r=this.$(".sf-transaction-edition"),i=r.find("input, select, :checkbox"),u=this.$(".sf-split-fieldset"),a=r.find(":checkbox");return this._isSplit?typeof e=="undefined"&&(this._isSplit=!1,n.addClass("sf-collapsed"),i.prop("disabled",!1),this.parentCategorySelect.update(),a.data("ReForm.Checkbox").reinit(),s.each(u,function(e){s.validator.removeItem(t,o(e))},this)):(this._isSplit=!0,n.removeClass("sf-collapsed"),i.prop("disabled",!0),this.parentCategorySelect.update(),a.data("ReForm.Checkbox").reinit(),a.is(":checked")?u.find(":checkbox").prop("checked",!0):u.find(":checkbox").prop("checked",!1),s.each(u,function(e){o(e).find(":checkbox").data("ReForm.Checkbox").reinit(),s.validator.addItem(t,o(e))})),this.trigger("view:change"),!1},_calculateRemainder:function(){var e=Math.abs(this.options.transaction.get("amount")),t=this.options.transaction.get("currency"),n=this.$(".sf-input-transaction-amount"),r=this.$(".sf-split-remainder-fieldset"),i=r.find("select").length>0,u=this.$(".sf-remainder-amount-text"),a=u.next(),f=this.$(".sf-split-fieldset"),l=f.length,c=s.number.round(s.reduce(n,function(e,t){return e+s.number.parse(o(t).val())},0,this)),h=e-c;h!==0?(h<0?u.addClass("sf-remainder-amount-text-error"):u.removeClass("sf-remainder-amount-text-error"),r.removeClass("sf-hidden"),i||this._initSplitSelect(l-1)):r.addClass("sf-hidden");var p=h*(this.options.transaction.get("amount")>=0?1:-1),d="";h!==0?(h<0&&(d="Error"),this._updateRemainderText(u,d,p,t)):u.html(""),a.val(h),this._changeNumberRule(r,l-1)},_updateRemainderText:function(e,t,n,r){e.html(s.i18n.get("transactions-edit.remainderAmount"+t,{amount:s.amount.format(n,!0,r)}))},_addSplitCell:function(){var e=this.$(".sf-split-fieldset"),n=e.closest(".sf-transaction-split-container").first(),r=e.length,i=parseInt(this.$(".sf-split-remainder-fieldset").length,10),u,a=this.$(".sf-split-add-action"),f=r<=1+i,c=this.$("form"),h=e.find(":checkbox").eq(0),p=l({parent:this.transactionData,i:r-1,isDefault:!0});e.last().before(p),u=this.$("#sf-split-fieldset-"+(r-1)),h.is(":checked")?u.find(":checkbox").prop("checked",!0):u.find(":checkbox").prop("checked",!1),t.init(u),s.each(n.find(".sf-split-fieldset"),function(e,t){this._changeNumberRule(o(e),t)},this),f&&e.first().find(".sf-column-split-delete").removeClass("sf-hidden"),this._calculateRemainder(),this._initSplitSelect(r-1),s.validator.addItem(c,u),r+1>=this.config.limitOfSplits&&a.prop("disabled",!0),this.trigger("view:change")},_deleteSplitCell:function(e){var t=o(e.currentTarget),n=t.closest(".sf-split-fieldset"),r=n.closest(".sf-transaction-split-container").first(),i=this.$(".sf-split-fieldset"),u=this.$(".sf-split-add-action"),a=i.length,f=this.$("form"),l,c=a<=2;if(c)return this._deleteAllSplits(e);s.validator.removeItem(f,n),n.remove(),s.validator.reloadValidation(f),s.each(r.find(".sf-split-fieldset"),function(e,t){this._changeNumberRule(o(e),t)},this),c&&(l=s.find(i,function(e){return o(e).is(":visible")}),o(l).find(".sf-column-split-delete").addClass("sf-hidden")),this._calculateRemainder(),this.trigger("view:change"),a<=this.config.limitOfSplits&&u.prop("disabled")&&u.prop("disabled",!1)},_deleteAllSplits:function(){var e=this.$(".sf-split-add-action");this._toggleList(),e.prop("disabled")&&e.prop("disabled",!1),this.trigger("allSplitsDeleted")},_deleteTransaction:function(){var e=this;s.mask(this.$el,s.MASK_LOADING);var t=this.options.transaction.destroy();s.when(t).done(function(){s.unmask(e.$el),e.trigger("done")}).fail(function(t){console.error("[TransactionEditModule] Deleting Transaction error",t),e.publish("error",t)})},_changeNumberRule:function(e,t){var n=e.find("input,select"),r=e.attr("id").split("-");r[r.length-1]=t,e.attr("id",r.join("-")),n.length&&s.each(n,function(e){typeof o(e).attr("name")!="undefined"&&(r=o(e).attr("name").split("-"),r[1]=t,o(e).attr("name",r.join("-"))),typeof o(e).attr("id")!="undefined"&&(r=o(e).attr("id").split("-"),r[r.length-1]=t,o(e).attr("id",r.join("-")))})},_saveSplitTransaction:function(e){e.preventDefault();var t=this._isNewTransaction?this._sanitizeAddForm(this.$("form")):this._sanitizeEditForm(this.$("form")),n=this.options.transaction,r=t.children,i=this._calculateActionForSplits(t)(n,r),o=this;s.mask(this.$el,s.MASK_LOADING),s.when(i).done(function(){o.trigger("done")}).fail(function(e){o.trigger("done"),console.error("[TransactionsEditModule] Saving Transaction Split error ",e),o.publish("error",e)})},_swapFormattedAmount:function(){this._isIncome=this._isIncome?!1:!0,this._lastFormValues=s.serializeForm(this.$("form")),this.render()},_calculateActionForSplits:function(e){var t=this,n=this.options.transaction,r,i,o=this.options.accId,u=this.options.uscId,a=this.options.accType;return this._isNewTransaction?(isNaN(o)?r=this.transactionsService.createCashTransaction(e):(e=s.extend({accId:o,uscId:u,accType:a},e),r=this.transactionsService.createAccountTransaction(e)),function(){return r}):this.options.splits&&!this._isSplit?(r=this.transactionsService.update(n,e.parent),i=s.when(r).done(function(){t.transactionsService.unsplitTransaction(n)}).fail(function(e){console.error("[TransactionsEditModule] Updating Transaction error",e),t.publish("error",e)}),function(){return i}):this._isSplit?s.bind(this.transactionsService.splitTransaction,this.transactionsService):(r=this.transactionsService.update(n,e.parent),function(){return r})},_sanitizeEditForm:function(e){var t=s.serializeForm(e),n=this.options.transaction.get("amount")>=0?1:-1,r=this.options.transaction.get("currency"),i;return t.parent.id=parseInt(t.parent.id,10),t.parent.computable=t.parent.computable==="on"?!0:!1,t.parent.currency=r,s.isArray(t.children)&&(t.children=s.each(t.children,function(e){i=s.number.parse(e.amount),e.amount=i||e.amount,e.amount*=n,e.computable=e.computable==="on"?!0:!1,e.currency=r},this),s.last(t.children).amount||t.children.pop()),t},_sanitizeAddForm:function(e){var t=s.serializeForm(e),n=typeof this._isIncome=="undefined",r=n?-1:this._isIncome?1:-1;return t.computable=t.computable==="on"?!0:!1,t.amount=s.number.parse(t.amount),t.amount*=r,t},_fixDatePickersZIndex:function(e){var t=o(e.currentTarget),n=t.closest(".sf-split-fieldset"),r=parseInt(n.css("z-index"),10);isNaN(r)||(this.$(".sf-split-fieldset").css({"z-index":r}),n.css({"z-index":r+1}))}},{ID:"transactions-edit",defaults:{datePickerFormat:s.date.constructor.SHORT_DATE,datePickerSubmitFormat:s.date.constructor.BACKEND_FORMAT,limitOfSplits:10,showTagsPanel:!1},submodules:[u],services:[r,n,i]});return c}),define("modules/transactions-edit/transactions-edit-module-extension",["modules/transactions-edit/transactions-edit-module","ui/modules/reform/select/select-module","ui/modules/popup/popup-module","services/categories-service","services/transactions-service","services/accounts-service","utils/util","jQuery","modules/category-selector/category-selector-module","modules/transactions-edit/views/transactions-edit-tags-view","hbs!modules/transactions-edit/templates/transactions-edit","hbs!modules/transactions-edit/templates/transaction-split-cell","css!modules/transactions-edit/css/transactions-edit","ui/modules/reform/datepicker/datepicker-module","utils/validator","utils/number","utils/date"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=e.extend({ui:{$tagsSectionContainer:".sf-transaction-tags .sf-panel-section-body",$accordionButton:".sf-accordion-toggle-link",$form:".sf-transactions-split-form"},events:{"click .sf-accordion-toggle-link":"_toggleList","click button.sf-split-add-action":"_addSplitCell","click .sf-split-delete-action":"_deleteSplitCell","click button.sf-all-split-delete-action":"_deleteAllSplits","click .sf-action-save-split-button":"_saveSplitTransaction","keyup .sf-input-transaction-amount":"_calculateRemainder","focusin .sf-datepicker":"_fixDatePickersZIndex","click .sf-swap-amount":"_swapFormattedAmount","click .sf-action-delete-transaction-button":"_deleteTransaction","click .sf-split-help":"_openHelpSplitPopup","click .sf-tx-name-help":"_openHelpDescEditPopup","click .sf-form-datepicker":"_clickDatepicker","change .sf-transaction-included-analysis .sf-reform-checkbox":"_toggleCheckboxIncludeAnalysis"},hubEvents:{"categorySelector:selected":"_setSignAndCheckCategorySet"},_toggleCheckboxIncludeAnalysis:function(){o.pushToDataLayer({eventCategory:"PFM Movimientos-Editar Movimiento",eventAction:"Boton",eventLabel:"Incluir en ingresos y gastos inicial",event:"eventClick"})},_toggleList:function(e){o.pushToDataLayer({eventCategory:"PFM Movimientos-Editar Movimiento",eventAction:"Boton",eventLabel:"Agregar División",event:"eventClick"});var t=this.$("form"),n=this.$(".sf-transaction-split-container").closest(".sf-accordion-item"),r=this.$(".sf-transaction-edition"),i=r.find("input, select, :checkbox"),s=this.$(".sf-split-fieldset"),a=r.find(":checkbox");return this._isSplit?typeof e=="undefined"&&(this._isSplit=!1,n.addClass("sf-collapsed"),i.prop("disabled",!1),this.parentCategorySelect.update(),a.data("ReForm.Checkbox").reinit(),o.each(s,function(e){o.validator.removeItem(t,u(e))},this),this.ui.$accordionButton.show(),this.ui.$accordionButton.parent().find(".sf-icon-help").show()):(this._isSplit=!0,n.removeClass("sf-collapsed"),i.prop("disabled",!0),this.parentCategorySelect.update(),a.data("ReForm.Checkbox").reinit(),s.find(":checkbox").prop("checked",!1),o.each(s,function(e){u(e).find(":checkbox").data("ReForm.Checkbox").reinit(),o.validator.addItem(t,u(e))}),this.ui.$accordionButton.hide(),this.ui.$accordionButton.parent().find(".sf-icon-help").hide()),this.trigger("view:change"),!1},_saveSplitTransaction:function(e){e.preventDefault();if(!this.ui.$form.parsley().validate()||!o.validator.isValid(this.ui.$form)||this.ui.$form.find("select.sf-reform-category-select option:selected").val()<=0){this.ui.$form.find("select.sf-reform-category-select option:selected").val()<=0?this.ui.$form.find(".sf-category-error").show():this.ui.$form.find(".sf-category-error").hide();return}var t=this._isNewTransaction?this._sanitizeAddForm(this.$("form")):this._sanitizeEditForm(this.$("form")),n=this.options.transaction,r=t.children,i=this._calculateActionForSplits(t)(n,r),s=this;o.mask(this.$el,o.MASK_LOADING),o.when(i).done(function(){s.trigger("done")}).fail(function(e){s.trigger("done"),console.error("[TransactionsEditModule] Saving Transaction Split error ",e),s.publish("error",e)})},_calculateRemainder:function(){var e=Math.abs(this.options.transaction.get("amount")),t=this.options.transaction.get("currency"),n=this.$(".sf-input-transaction-amount"),r=this.$(".sf-split-remainder-fieldset"),i=r.find("select").length>0,s=this.$(".sf-remainder-amount-text"),a=s.next(),f=this.$(".sf-split-fieldset"),l=f.length,c=o.number.round(o.reduce(n,function(e,t){return e+o.number.parse(u(t).val())},0,this)),h=e-c;h!==0?(h<0?s.addClass("sf-remainder-amount-text-error"):s.removeClass("sf-remainder-amount-text-error"),r.removeClass("sf-hidden"),i||this._initSplitSelect(l-1)):r.addClass("sf-hidden");var p=h*(this.options.transaction.get("amount")>=0?1:-1),d="";h!==0?(h<0&&(d="Error"),this._updateRemainderText(s,d,Math.abs(p),t)):s.html(""),a.val(h),this._changeNumberRule(r,l-1)},_addSplitCell:function(){o.pushToDataLayer({eventCategory:"PFM Movimientos-Editar Movimiento",eventAction:"Boton",eventLabel:"Agregar División",event:"eventClick"});var e=this.$(".sf-split-fieldset"),n=e.closest(".sf-transaction-split-container").first(),r=e.length,i=parseInt(this.$(".sf-split-remainder-fieldset").length,10),s,a=this.$(".sf-split-add-action"),f=r<=1+i,l=this.$("form"),h=e.find(":checkbox").eq(0),p=c({parent:this.transactionData,i:r-1,isDefault:!0});e.last().before(p),s=this.$("#sf-split-fieldset-"+(r-1)),s.find(":checkbox").prop("checked",!1),t.init(s),o.each(n.find(".sf-split-fieldset"),function(e,t){this._changeNumberRule(u(e),t)},this),f&&e.first().find(".sf-column-split-delete").removeClass("sf-hidden"),this._calculateRemainder(),this._initSplitSelect(r-1),o.validator.addItem(l,s),r+1>=this.config.limitOfSplits&&a.prop("disabled",!0),this.trigger("view:change")},_openHelpSplitPopup:function(e){o.pushToDataLayer({eventCategory:"PFM Movimientos-Editar Movimiento",eventAction:"Boton",eventLabel:"Tooltip Dividir Movimiento",event:"eventClick"});var t=u(e.currentTarget),r={$container:this.$el,$opener:t,content:o.i18n.get("transactions-edit.info.split"),type:n.INFO,closeCallback:o.bind(this._closePopup,this),maskClass:"sf-dark-mask",standAlone:!this.config.isPlatform};this.infoPopup=new n(r),this.infoPopup.open()},_openHelpDescEditPopup:function(e){o.pushToDataLayer({eventCategory:"PFM Movimientos-Editar Movimiento",eventAction:"Boton",eventLabel:"Tooltip Descripción",event:"eventClick"});var t=u(e.currentTarget),r={$container:this.$el,$opener:t,content:o.i18n.get("details.info.descAdd"),type:n.INFO,closeCallback:o.bind(this._closePopup,this),maskClass:"sf-dark-mask",standAlone:!this.config.isPlatform};this.infoPopup=new n(r),this.infoPopup.open()},_closePopup:function(){this.infoPopup.remove()},_clickDatepicker:function(e){var t=this.$(e.currentTarget);t.closest(".sf-transaction-edition-placeholder").length===0&&t.find(".picker").addClass("picker--opened").addClass("picker--focused")},_setSignAndCheckCategorySet:function(e){this.ui.$form.find("select.sf-reform-category-select option:selected").val()<=0?this.ui.$form.find(".sf-category-error").show():this.ui.$form.find(".sf-category-error").hide(),e.catIsIncome?this._isIncome=!0:this._isIncome=!1,e.catId>0&&this.$el.find(".sf-action-save-split-button").removeAttr("disabled")},serializeData:function(){var e=this._super();return parseInt(e.initialAmount,10)===0&&(e.initialAmount=""),e.isPlatform=this.config.isPlatform,e.transaction&&e.transaction.initialReminderAmount&&(e.transaction.initialReminderAmount=Math.abs(e.transaction.amount)),e.disableSave=this.catSet?!1:!0,e},onRender:function(e){this._super(e);var t=this;this._isNewTransaction&&setTimeout(function(){t.$el.find(".sf-form-cat").find(".sf-reform-category-select").find(".sf-current").html(o.i18n.get("category-selector.allOptions"))},300)},_deleteSplitCell:function(e){o.pushToDataLayer({eventCategory:"PFM Movimientos-Editar Movimiento",eventAction:"Boton",eventLabel:"Eliminar",event:"eventClick"}),this._super.apply(this,arguments)}});return h}),define("hbs!widgets/accounts/templates/accounts-content",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-accounts-content sf-widget-content">\n	<div class="sf-accounts-placeholder">\n\n	</div>\n	',u={hash:{"class":"sf-add-account",type:"button",text:"accounts.addAccountButton"}},s+=f((o=n.button,o?o.call(t,u):a.call(t,"button",u)))+"\n</div>\n",s});return t.registerPartial("widgets_accounts_templates_accounts-content",n),n}),define("widgets/accounts/views/accounts-content-view",["classes/layout","services/accounts-service","data/accounts/account-model","modules/accounts-accordion/accounts-accordion-module","modules/account-import/account-import-module","modules/transactions-edit/transactions-edit-module","ui/modules/popup/popup-module","utils/util","hbs!widgets/accounts/templates/accounts-content","jQuery"],function(e,t,n,r,i,s,o,u,a,f){var l=e.extend({template:a,events:{"click .sf-add-account":"_addAccount","click .sf-add-transaction":"_addTransaction"},regions:{accountsRegion:".sf-accounts-placeholder"},hubEvents:{"account.import-file":"_importNewFile"},initialize:function(){this._super.apply(this,arguments),this.accounts=null,this.accountsService=t.getInstance(),this.addAccountPopup=null},render:function(e){var t=this;if(e)return this._super();u.when(this.accountsService.get()).done(u.bind(t._dataReceived,t)).fail(function(e){console.error("Error while loading accounts ",e),t.publish("error",e)})},_dataReceived:function(e){this.accounts=e,this.render(!0)},onRender:function(){this._super();var e=new r(u.extend({collection:this.accounts},this.contextConfig));this.accountsRegion.show(e)},_addAccount:function(e){var t=new i(this.contextConfig),n=this.$el.closest(".sf-platform");this.addAccountPopup=new o({title:u.i18n.get("accounts.addAccountPopupTitle"),contentView:t,$container:n.length?n:this.$el,$opener:this.$(e.currentTarget),"class":"sf-accounts-popup"}),this.addAccountPopup.open(),this.listenTo(t,"account-import.close",this._closeAccountPopup),this.hub.on("entity:refreshed",this.addAccountPopup.updatePosition,this.addAccountPopup)},_addTransaction:function(e){var t=f(e.target.closest(".sf-entity")).data("id"),n=parseInt(f(e.target).closest("li").find("input[name='accId']").val()),r=parseInt(f(e.target).closest("li").find("input[name='accType']").val()),i=f(e.target).closest("li").find("input[name='currency']").val(),a=new s(u.extend({},this.contextConfig,{isIncome:!1,accId:n,uscId:t,accType:r,accCurrency:i})),l=this.$el.closest(".sf-platform");this.addTransactionPopup=new o({title:u.i18n.get("accounts.addTransactionPopupTitle"),contentView:a,$container:l.length?l:this.$el,$opener:this.$(e.currentTarget),"class":"sf-accounts-popup"}),this.addTransactionPopup.open(),a.on("done",this._onTransactionAdded,this)},_closeAccountPopup:function(){this.addAccountPopup.remove()},_onTransactionAdded:function(){this.addTransactionPopup.remove()},_importNewFile:function(e,t){var n=new i(u.extend({uscId:e},this.contextConfig)),r=this.$el.closest(".sf-platform");this.addAccountPopup=new o({title:u.i18n.get("accounts.updateAccountPopupTitle"),contentView:n,$container:r.length?r:this.$el,$opener:this.$(t.currentTarget),"class":"sf-accounts-popup"}),this.addAccountPopup.open(),this.listenTo(n,"account-import.close",this._closeAccountPopup),this.hub.on("entity:refreshed",this.addAccountPopup.updatePosition,this.addAccountPopup)}});return l}),define("hbs!modules/alerts-config/templates/alerts-config-cell",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i,s,o;r+="\n					",o={hash:{id:"sf-alertSettings-{{i}}-value","class":"sf-alert-config-value {{#if notMax}}notMax{{/if}}",disabled:"{{#unless active}}true{{/unless}}",name:"alertSettings-{{i}}-value",affix:"currency",value:"{{value}}",validateField:"alert.config.amount"}},r+=l((i=n.textfield,i?i.call(e,o):f.call(e,"textfield",o)))+'\n					<input id="sf-alertSettings-',(s=n.i)?s=s.call(e,{hash:{}}):(s=e.i,s=typeof s===c?s.apply(e):s),r+=l(s)+'-min" value="',(s=n.minValue)?s=s.call(e,{hash:{}}):(s=e.minValue,s=typeof s===c?s.apply(e):s),r+=l(s)+'" type="hidden" />\n                    <input id="sf-alertSettings-',(s=n.i)?s=s.call(e,{hash:{}}):(s=e.i,s=typeof s===c?s.apply(e):s),r+=l(s)+'-max" value="',(s=n.maxValue)?s=s.call(e,{hash:{}}):(s=e.maxValue,s=typeof s===c?s.apply(e):s),r+=l(s)+'" type="hidden" />\n					',s=n["if"].call(e,e.maxValue,{hash:{},inverse:h.program(4,v,t),fn:h.program(2,d,t)});if(s||s===0)r+=s;return r+="\n				",r}function d(e,t){var r="",i,s,o;r+='\n						<span class="sf-type-min-max">(',o={hash:{}},r+=l((i=n.t,i?i.call(e,"alerts-config.web.min",o):f.call(e,"t","alerts-config.web.min",o)))+" ",o={hash:{}},s=(i=n.formatAmount,i?i.call(e,e.minValue,o):f.call(e,"formatAmount",e.minValue,o));if(s||s===0)r+=s;r+=", ",o={hash:{}},r+=l((i=n.t,i?i.call(e,"alerts-config.web.max",o):f.call(e,"t","alerts-config.web.max",o)))+" ",o={hash:{}},s=(i=n.formatAmount,i?i.call(e,e.maxValue,o):f.call(e,"formatAmount",e.maxValue,o));if(s||s===0)r+=s;return r+=")</span>\n					",r}function v(e,t){var r="",i,s,o;r+='\n						<span class="sf-type-min-max">(',o={hash:{}},r+=l((i=n.t,i?i.call(e,"alerts-config.web.min",o):f.call(e,"t","alerts-config.web.min",o)))+" ",o={hash:{}},s=(i=n.formatAmount,i?i.call(e,e.minValue,o):f.call(e,"formatAmount",e.minValue,o));if(s||s===0)r+=s;return r+=")</span>\n					",r}function m(e,t){var r="",i,s,o;r+="\n					",o={hash:{id:"sf-alertSettings-{{i}}-value","class":"sf-alert-config-value {{#if notMax}}notMax{{/if}}",disabled:"{{#unless active}}true{{/unless}}",name:"alertSettings-{{i}}-value",suffix:"%",value:"{{value}}",validateField:"alert.config.number"}},r+=l((i=n.textfield,i?i.call(e,o):f.call(e,"textfield",o)))+'\n					<input id="sf-alertSettings-',(s=n.i)?s=s.call(e,{hash:{}}):(s=e.i,s=typeof s===c?s.apply(e):s),r+=l(s)+'-min" value="',(s=n.minValue)?s=s.call(e,{hash:{}}):(s=e.minValue,s=typeof s===c?s.apply(e):s),r+=l(s)+'" type="hidden" />\n					<input id="sf-alertSettings-',(s=n.i)?s=s.call(e,{hash:{}}):(s=e.i,s=typeof s===c?s.apply(e):s),r+=l(s)+'-max" value="',(s=n.maxValue)?s=s.call(e,{hash:{}}):(s=e.maxValue,s=typeof s===c?s.apply(e):s),r+=l(s)+'" type="hidden" />\n					',s=n["if"].call(e,e.maxValue,{hash:{},inverse:h.program(9,y,t),fn:h.program(7,g,t)});if(s||s===0)r+=s;return r+="\n				",r}function g(e,t){var r="",i,s,o;r+='\n						<span class="sf-type-min-max">(',o={hash:{}},r+=l((i=n.t,i?i.call(e,"alerts-config.web.min",o):f.call(e,"t","alerts-config.web.min",o)))+": ",o={hash:{}},s=(i=n.formatNumber,i?i.call(e,e.minValue,o):f.call(e,"formatNumber",e.minValue,o));if(s||s===0)r+=s;r+="%, ",o={hash:{}},r+=l((i=n.t,i?i.call(e,"alerts-config.web.max",o):f.call(e,"t","alerts-config.web.max",o)))+": ",o={hash:{}},s=(i=n.formatNumber,i?i.call(e,e.maxValue,o):f.call(e,"formatNumber",e.maxValue,o));if(s||s===0)r+=s;return r+="%)</span>\n					",r}function y(e,t){var r="",i,s,o;r+='\n						<span class="sf-type-min-max">(',o={hash:{}},r+=l((i=n.t,i?i.call(e,"alerts-config.web.min",o):f.call(e,"t","alerts-config.web.min",o)))+": ",o={hash:{}},s=(i=n.formatNumber,i?i.call(e,e.minValue,o):f.call(e,"formatNumber",e.minValue,o));if(s||s===0)r+=s;return r+="%)</span>\n					",r}function b(e,t){var r="",i,s,o;r+="\n        ",o={hash:{},inverse:h.noop,fn:h.program(12,w,t)},s=(i=n.ifequal,i?i.call(e,(i=e.self,i==null||i===!1?i:i.type),4,o):f.call(e,"ifequal",(i=e.self,i==null||i===!1?i:i.type),4,o));if(s||s===0)r+=s;return r+="\n    ",r}function w(e,t){var r="",i,s;return r+='\n            <span class="sf-alert-config-channel-cell sf-col-channel">\n                ',s={hash:{id:"sf-channels-{{i}}-type",type:"checkbox","class":"sf-alert-config-channel",name:"alertSettings-{{number}}-channels-{{i}}-type",checked:"{{#if active}}true{{/if}}"}},r+=l((i=n.checkbox,i?i.call(e,s):f.call(e,"checkbox",s)))+"\n            </span>\n        ",r}function E(e,t){var r="",i,s,o;r+="\n        ",o={hash:{},inverse:h.noop,fn:h.program(12,w,t)},s=(i=n.ifequal,i?i.call(e,(i=e.self,i==null||i===!1?i:i.type),2,o):f.call(e,"ifequal",(i=e.self,i==null||i===!1?i:i.type),2,o));if(s||s===0)r+=s;return r+="\n    ",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function",h=this;s+='<li class="sf-alert-config-row">\n	<span class="sf-alert-config-description sf-col-name">\n			<div class="sf-type-name">',a={hash:{context:"alerts-config.title"}},s+=l((o=n.t,o?o.call(t,t.typeName,a):f.call(t,"t",t.typeName,a)))+'</div>\n			<div class="sf-type-description">',a={hash:{context:"alerts-config.web.description"}},s+=l((o=n.t,o?o.call(t,t.typeName,a):f.call(t,"t",t.typeName,a)))+':</div>\n			<div class="sf-type-value-info sf-form-row">\n				',u=n.unless.call(t,t.notAmount,{hash:{},inverse:h.program(6,m,i),fn:h.program(1,p,i)});if(u||u===0)s+=u;s+='\n			</div>\n	</span>\n    <span class="sf-col-checkbox hidden">\n        <input type="hidden" name="alertSettings-',(u=n.i)?u=u.call(t,{hash:{}}):(u=t.i,u=typeof u===c?u.apply(t):u),s+=l(u)+'-id" value=',(u=n.id)?u=u.call(t,{hash:{}}):(u=t.id,u=typeof u===c?u.apply(t):u),s+=l(u)+" />\n    </span>\n    ",a={hash:{},inverse:h.noop,fn:h.program(11,b,i)},u=(o=n.iter,o?o.call(t,t.channels,a):f.call(t,"iter",t.channels,a));if(u||u===0)s+=u;s+="\n    ",a={hash:{},inverse:h.noop,fn:h.program(14,E,i)},u=(o=n.iter,o?o.call(t,t.channels,a):f.call(t,"iter",t.channels,a));if(u||u===0)s+=u;return s+="\n</li>",s});return t.registerPartial("modules_alerts-config_templates_alerts-config-cell",n),n}),define("hbs!modules/alerts-config/templates/alerts-config",["hbs","Handlebars","hbs!modules/alerts-config/templates/alerts-config-cell"],function(e,t){var n=t.template(function(e,t,n,r,i){function h(e,t){var r="",i,s,o;r+='\n		<form method="post" name="config-form" class="sf-config-form sf-form-horizontal" data-validate="parsley">\n			<fieldset>\n				<div class="sf-config-table-form">\n					<li class="sf-titles-row">\n						<span class="sf-titles-row-block">\n							<span class="sf-col-name"></span>\n							<span class="sf-col-checkbox">\n								<span class="sf-span-title">',o={hash:{}},r+=l((i=n.t,i?i.call(e,"alerts-config.app",o):f.call(e,"t","alerts-config.app",o)))+"</span>\n							</span>\n							",o={hash:{},inverse:c.noop,fn:c.program(2,p,t)},s=(i=n.iter,i?i.call(e,e.channels,o):f.call(e,"iter",e.channels,o));if(s||s===0)r+=s;r+='\n						</span>\n						<span class="sf-titles-row-block">\n							<span class="sf-col-name"></span>\n							<span class="sf-col-checkbox">\n								<span class="sf-span-title">',o={hash:{}},r+=l((i=n.t,i?i.call(e,"alerts-config.app",o):f.call(e,"t","alerts-config.app",o)))+"</span>\n							</span>\n							",o={hash:{},inverse:c.noop,fn:c.program(2,p,t)},s=(i=n.iter,i?i.call(e,e.channels,o):f.call(e,"iter",e.channels,o));if(s||s===0)r+=s;r+="\n						</span>\n					</li>\n					",o={hash:{},inverse:c.noop,fn:c.program(5,v,t)},s=(i=n.iter,i?i.call(e,e.alertsConfig,o):f.call(e,"iter",e.alertsConfig,o));if(s||s===0)r+=s;return r+='\n				</div>\n				<div class="sf-clearfix sf-alert-config-buttons">\n					',o={hash:{text:"common.button.save","class":"sf-button-save-alert sf-button-save",tabindex:"-1",type:"button"}},r+=l((i=n.button,i?i.call(e,o):f.call(e,"button",o)))+"\n					",o={hash:{text:"common.button.cancel","class":"sf-button-cancel sf-button-close-alert-config",title:"common.button.cancel",tabindex:"-1",type:"button"}},r+=l((i=n.button,i?i.call(e,o):f.call(e,"button",o)))+"\n				</div>\n			</fieldset>\n		</form>\n\n	",r}function p(e,t){var r="",i,s,o;r+="\n								",o={hash:{},inverse:c.noop,fn:c.program(3,d,t)},s=(i=n.ifequal,i?i.call(e,e.self,"email",o):f.call(e,"ifequal",e.self,"email",o));if(s||s===0)r+=s;return r+="\n							",r}function d(e,t){var r="",i,s;return r+='\n									<span class="sf-col-channel"><span class="sf-span-title">',s={hash:{context:"alerts-config"}},r+=l((i=n.t,i?i.call(e,e.self,s):f.call(e,"t",e.self,s)))+"</span></span>\n								",r}function v(e,t){var i="",s;i+="\n						",s=c.invokePartial(r["modules_alerts-config_templates_alerts-config-cell"],"modules_alerts-config_templates_alerts-config-cell",e,n,r);if(s||s===0)i+=s;return i+="\n					",i}function m(e,t){var r="",i,s;return r+="\n	",s={hash:{}},r+=l((i=n.t,i?i.call(e,"alerts-config.noAlerts",s):f.call(e,"t","alerts-config.noAlerts",s)))+"\n	",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,r=r||e.partials;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c=this;s+='<div class="sf-alerts-config sf-configuration-box">\n    <a href="javascript:void(0);" class="sf-popup-close"><span class="sf-popup-close-text">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"popup.label.back",a):f.call(t,"t","popup.label.back",a)))+'</span></a>\n    <div class="sf-title"><h2>',a={hash:{}},u=(o=n.t,o?o.call(t,"alerts-config.mainTitle",a):f.call(t,"t","alerts-config.mainTitle",a));if(u||u===0)s+=u;s+="</h2></div>\n	",u=n["if"].call(t,t.alertsConfig,{hash:{},inverse:c.program(7,m,i),fn:c.program(1,h,i)});if(u||u===0)s+=u;return s+="\n</div>",s});return t.registerPartial("modules_alerts-config_templates_alerts-config",n),n}),define("data/alerts/alert-model",["classes/model","utils/util","utils/config"],function(e,t){var n=e.extend({destroy:function(e){var n=t.extend({url:t.config.getGlobals().environment.contextPath+"/alerts/delete.action",data:t.param({id:this.id}),type:"POST",wait:!0},e);return this._super(t.extend({},n))},destroyAll:function(e){var n=t.extend({url:t.config.getGlobals().environment.contextPath+"/alerts/delete/all.action",type:"POST",wait:!0},e);return t.ajax(n)}});return n}),define("data/alerts/alert-collection",["classes/collection","data/alerts/alert-model","utils/util","utils/config"],function(e,t,n){var r=e.extend({model:t,url:"/alerts/get.action",parse:function(e){return e.alerts},destroy:function(e){var t=n.extend({url:n.config.getGlobals().environment.contextPath+"/alerts/delete/all.action",type:"POST",wait:!0},e);return this._super(n.extend({},t))}});return r}),define("data/alerts/alerts-data-manager",["classes/data-manager","data/alerts/alert-model","data/alerts/alert-collection","classes/remote-error","utils/util"],function(e,t,n,r,i){var s=e.extend({initialize:function(){this._super.apply(this,arguments),this.registerCollection("alerts",{type:n,modelRemoved:this._alertRemoved,subscriptions:["rule:add","rule:remove","rule:change","transaction:change","budget:add","budget:remove","budget:change","savings:goal:add","savings:goal:change","savings:account:change","savings:goal:remove"],loader:{method:this.getAlerts,context:this}}),this.options=i.extend({},s.defaults)},getAlerts:function(e){return e=e||{},this.getCollection("alerts",{force:!!e.force,firstPosition:e.firstPosition||this.options.firstPosition,numberOfItems:e.numberOfItems||this.options.numberOfItems})},deleteAlert:function(e){var t=this,n=this._collections.alerts,s=n.find(e),o=i.Deferred();return i.when(s.destroy(e)).done(function(e){o.resolve(e),t.publish("alerts:delete",e)}).fail(function(e){o.reject(new r(e))}),o},deleteAllAlerts:function(){var e=new t,n=this,s=i.Deferred();return i.when(e.destroyAll()).done(function(e){n._collections.alerts.reset(),n._collections.alerts.trigger("change"),s.resolve(e),n.publish("alerts:delete",e)}).fail(function(e){s.reject(new r(e))}),s}},{defaults:{firstPosition:0,numberOfItems:2e3}});return s}),define("data/alerts-config/alert-config-model",["classes/model","utils/util","utils/config"],function(e,t){var n=e.extend({updateAll:function(e){var n=t.extend({url:t.config.getGlobals().environment.contextPath+"/alerts/settings/update.action",data:t.param(e),type:"POST",wait:!0});return t.ajax(t.extend({},n))}});return n}),define("data/alerts-config/alert-config-collection",["classes/collection","data/alerts-config/alert-config-model"],function(e,t){var n=e.extend({model:t,url:"/alerts/settings/get.action",parse:function(e){return e.alertSettings}});return n}),define("data/alerts-config/alerts-config-data-manager",["classes/data-manager","data/alerts-config/alert-config-model","data/alerts-config/alert-config-collection","utils/util","classes/remote-error"],function(e,t,n,r,i){var s=e.extend({initialize:function(){this._super.apply(this,arguments),this.collectionDefs={alertsConfig:{type:n,modelUpdated:this._alertUpdated}}},getAlertsConfig:function(e){return this.getCollection("alertsConfig",{force:e})},updateAlertsConfig:function(e){var n=this._collections.alertsConfig,s=new t,o=new r.Deferred;return r.when(s.updateAll(e)).done(function(){n.set(e.data.alertSettings,{merge:!0}),n.trigger("change",n),o.resolve(n)}).fail(function(e){o.fail(n),o.reject(new i(e))}),o},_alertUpdated:function(e){this.publish("alert:update",e)}});return s}),define("services/alerts-service",["classes/service","utils/util","data/alerts/alerts-data-manager","data/alerts/alert-collection","data/alerts-config/alerts-config-data-manager","data/alerts-config/alert-config-collection","classes/resource-loader"],function(e,t,n,r,i,s,o){var u=e.extend({initialize:function(){this._super.apply(this,arguments),this.alertsDM=n.getInstance(),this.alertsConfigDM=i.getInstance(),this.resources={alerts:new o(this.alertsDM,this.alertsDM.getAlerts,{}),alertsConfig:new o(this.alertsConfigDM,this.alertsConfigDM.getAlertsConfig,{})}},getAlerts:function(e){return e=e||{},this.alertsDM.getAlerts(e)},getAlertsConfig:function(e){return this.alertsConfigDM.getAlertsConfig(e)},updateAlertsConfig:function(e){return this.alertsConfigDM.updateAlertsConfig(e)},deleteAlert:function(e){return this.alertsDM.deleteAlert(e)},deleteAllAlerts:function(e){return this.alertsDM.deleteAllAlerts(e)},getTypeName:function(e){return u.ALERT_TYPES[e]},getChannelName:function(e){return u.CHANNELS[e]}},{ID:"alerts-service",ALERT_TYPES:{2:"budget",3:"largePurchase",4:"largeDeposit",5:"creditAvailable",6:"lowBalance",8:"highBalance",9:"savingsGoal"},CHANNELS:{2:"email",3:"sms",4:"mobile"},defaults:{validator:{rules:{alert:{config:{amount:{required:!0,type:"number"},number:{required:!0,type:"number"}}}}}}});return u}),define("libs/require/css/css!ui/modules/reform/checkbox/css/checkbox",[],function(){}),define("ui/modules/reform/checkbox/checkbox-module",["classes/reform-plugin","classes/reform","jQuery","utils/util","utils/constants","css!ui/modules/reform/checkbox/css/checkbox"],function(e,t,n,r){return t.Checkbox=e.extend({events:{blur:"_onBlur",focus:"_onFocus",click:"_onClick",mousedown:"_onMousedown",mouseup:"_onMouseup",keyup:"_onKeyup",keydown:"_onKeydown",keypress:"_onKeypress","change .sf-original":"_onOriginalChange"},initialize:function(){this._super.apply(this,arguments),this.checked=!1,this.disabled=!1,this.update()},_onOriginalChange:function(){this.update(),this.trigger("change"),this.$el.trigger("focus")},_onClick:function(e){if(e.target==this.$original[0])return;if(e.target==this.$originallabel[0])return;e.stopPropagation(),e.preventDefault();if(this.disabled)return;this.$original.triggerHandler("click"),this.trigger("click"),this.toggle()},_onMousedown:function(e){e.target!=this.$original[0]&&this.$original.trigger("mousedown")},_onMouseup:function(e){e.target!=this.$original[0]&&this.$original.trigger("mouseup")},_onKeydown:function(e){if(e.target==this.$el[0]){switch(e.keyCode){case r.constants.ENTER:case r.constants.SPACE:e.preventDefault(),e.stopPropagation(),this.toggle()}this.$original.trigger("keydown",e)}},_onKeyup:function(e){e.target==this.$el[0]&&this.$original.trigger("keyup",e)},_onKeypress:function(e){e.target==this.$el[0]&&this.$original.trigger("keypress")},_onFocus:function(e){e.target==this.$el[0]&&(this.$original.trigger("focus"),this.trigger("focus"))},_onBlur:function(e){e.target==this.$el[0]&&(this.$original.trigger("blur"),this.trigger("blur"))},reinit:function(){this.update()},update:function(){this.$original.prop("checked")?(this.checked=!0,this.$el.removeClass(this.config.classNames.unchecked),this.$el.addClass(this.config.classNames.checked),this.$el.attr("aria-checked","true")):(this.checked=!1,this.$el.removeClass(this.config.classNames.checked),this.$el.addClass(this.config.classNames.unchecked),this.$el.attr("aria-checked","false")),this.$original.prop("disabled")?(this.disabled=!0,this.$el.addClass(this.config.classNames.disabled),this.$el.attr("aria-disabled","true")):(this.disabled=!1,this.$el.removeClass(this.config.classNames.disabled),this.$el.removeAttr("aria-disabled"))},toggle:function(){if(this.disabled)return;this.checked?this.$original.prop("checked",!1):this.$original.prop("checked",!0),this.$original.trigger("change"),this.trigger("toggle")}},{ID:"sf-reform-checkbox",REFORM_ID:"ReForm.Checkbox",SELECTOR:"div.sf-reform-checkbox",ORIGINAL_SELECTOR:"input[type=checkbox]",defaults:{classNames:{checked:"sf-checked",unchecked:""}}}),t}),define("libs/require/css/css!modules/alerts-config/css/alerts-config",[],function(){}),define("modules/alerts-config/alerts-config-module",["classes/item-view","hbs!modules/alerts-config/templates/alerts-config","services/alerts-service","ui/modules/reform/checkbox/checkbox-module","utils/util","jQuery","utils/i18n","utils/number","utils/mask","utils/validator","css!modules/alerts-config/css/alerts-config"],function(e,t,n,r,i,s){var o=e.extend({template:t,events:{"change input.sf-alert-config-active":"_toggleVisibility","submit form":"_saveAlertConfig"},ui:{$form:"form"},initialize:function(){this._super.apply(this,arguments),this.alertsConfig=null,this.alertsService=n.getInstance()},render:function(e){if(e)return this._super();var t=this;i.when(this.alertsService.getAlertsConfig()).done(function(e){t.alertsConfig=e,t.render(!0)}).fail(function(e){console.error("[AlertsConfig] Loading Alerts error ",e),t.publish("error",e)})},onRender:function(){this._super(),this._addCustomFields(),i.validator.validate(this.ui.$form),r.init(this.$el)},resetForm:function(){var e=this.ui.$form.find(":checkbox"),t;this.ui.$form[0].reset(),i.validator.reset(this.ui.$form),e.each(function(){s(this).data("ReForm.Checkbox").reinit(),s(this).hasClass("sf-alert-config-channel")||(t=s(this).closest(".sf-alert-config-row"),s(this).attr("checked")?t.removeClass("item-disabled"):t.addClass("item-disabled"))})},_addCustomFields:function(){var e=this.$(".sf-alert-config-value"),t,n;i.each(e,function(e,r){t="input#sf-alertSettings-"+r+"-min",n="input#sf-alertSettings-"+r+"-max",s(e).data("range",[t,n])})},_refreshData:function(){this.render(!0)},serializeData:function(){return this._getChannels(),{alertsConfig:this.alertsConfig.map(function(e,t){e=e.attributes,e.typeName=this.alertsService.getTypeName(e.id);if(e.id===2||e.id===9)e.notAmount=!0;return e.channels&&i.each(e.channels,function(e){e.number=t}),e},this),channels:this._getChannels()}},_getChannels:function(){var e;if(this.alertsConfig.length)return e=i.pluck(this.alertsConfig.first().get("channels"),"type"),i.map(e,this.alertsService.getChannelName).reverse()},_toggleVisibility:function(e){var t=this.$(e.currentTarget),n=t.closest(".sf-alert-config-row"),r=n.find(".sf-alert-config-value"),s=n.find(".sf-form-row"),o=n.find("input.sf-alert-config-channel");n.hasClass("item-disabled")?(n.removeClass("item-disabled"),r.removeAttr("disabled"),o.removeAttr("disabled"),i.validator.addItem(this.ui.$form,s)):(i.validator.removeItem(this.ui.$form,s),n.addClass("item-disabled"),r.attr("disabled","disabled"),o.attr("disabled","disabled"))},_serializeAlertsForm:function(){var e=i.serializeForm(this.ui.$form),t;return i.each(e.alertSettings,function(e,n){t=this.alertsConfig.at(n).get("channels"),e.channels=[],i.each(t,function(t,r){e.channels.push({active:!!this.$('[name="alertSettings-'+n+"-channels-"+r+'-type"]').is(":checked"),type:t.type})},this),typeof e.active!="undefined"?e.active=!0:e.active=!1,e.id=parseInt(e.id,10),e.value=i.number.parse(e.value),e.value===null&&(e.value=i.number.parse(this.$('[name="alertSettings-'+n+'-value"]').val()))},this),{data:e}},_saveAlertConfig:function(e){e.preventDefault(),e.stopPropagation();var t=this._serializeAlertsForm(),n=this;i.mask(n.$el,i.MASK_LOADING),i.when(this.alertsService.updateAlertsConfig(t)).done(function(e){n.alertsConfig=e,n._refreshData(),n.publish("alerts:config:done")}).fail(function(e){console.error("[AlertsConfig] Error while updating Alerts Config",e),n.publish("error",e)})}},{ID:"alerts-config",services:[n],defaults:{}});return o}),define("modules/alerts-config/alerts-config-module-extension",["modules/alerts-config/alerts-config-module","utils/util","jQuery","utils/i18n","utils/number","utils/mask","utils/validator"],function(e,t,n){var r=e.extend({events:{"click .sf-button-save-alert":"_saveAlertConfig"},_addCustomFields:function(){var e=this.$(".sf-alert-config-value"),r,i;t.each(e,function(e,t){r="input#sf-alertSettings-"+t+"-min",i="input#sf-alertSettings-"+t+"-max",n(e).hasClass("notMax")?n(e).data("min",r):n(e).data("range",[r,i])})},serializeData:function(){return this._getChannels(),{alertsConfig:this.alertsConfig.map(function(e,n){e=e.attributes,e.typeName=this.alertsService.getTypeName(e.id);if(e.id===2||e.id===9)e.notAmount=!0;if(e.id===3||e.id===4||e.id===6||e.id===8)e.notMax=!0;return e.channels&&t.each(e.channels,function(e){e.number=n}),e},this),channels:this._getChannels()}},_saveAlertConfig:function(e){e.preventDefault(),e.stopPropagation();if(!this.ui.$form.parsley().validate()||!t.validator.isValid(this.ui.$form))return;var n=this._serializeAlertsForm(),r=this;t.mask(r.$el,t.MASK_LOADING),t.when(this.alertsService.updateAlertsConfig(n)).done(function(e){r.alertsConfig=e,r._refreshData(),r.publish("alerts:config:done"),t.unmask(r.$el)}).fail(function(e){console.error("[AlertsConfig] Error while updating Alerts Config",e),r.publish("error",e)})},_serializeAlertsForm:function(){var e=t.serializeForm(this.ui.$form),n;return t.each(e.alertSettings,function(e,r){n=this.alertsConfig.at(r).get("channels"),e.channels=[],t.each(n,function(t,n){e.channels.push({active:!!this.$('[name="alertSettings-'+r+"-channels-"+n+'-type"]').is(":checked"),type:t.type})},this),e.active=!0,e.id=parseInt(e.id,10),e.value=t.number.parse(e.value),e.value===null&&(e.value=t.number.parse(this.$('[name="alertSettings-'+r+'-value"]').val()))},this),{data:e}}},{});return r}),define("hbs!modules/settings/templates/settings",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i,s;return r+='\n					<li data-item="language" class="sf-settings-item-language"><a href="javascript:void(0)">',s={hash:{}},r+=a((i=n.t,i?i.call(e,"settings.language",s):u.call(e,"t","settings.language",s)))+"</a></li>\n				",r}function c(e,t){var r="",i,s;return r+='\n					<li data-item="accounts" class="sf-settings-item-accounts"><a href="javascript:void(0)">',s={hash:{}},r+=a((i=n.t,i?i.call(e,"settings.bankAccounts",s):u.call(e,"t","settings.bankAccounts",s)))+"</a></li>\n				",r}function h(e,t){var r="",i,s;return r+='\n					<li data-item="alerts" class="sf-settings-item-alerts"><a href="javascript:void(0)">',s={hash:{}},r+=a((i=n.t,i?i.call(e,"settings.alertSettings",s):u.call(e,"t","settings.alertSettings",s)))+"</a></li>\n				",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u=n.helperMissing,a=this.escapeExpression,f=this;s+='<div class="sf-settings-module">\n	<div class="sf-settings-menu">\n		<div class="sf-settings-options">\n			<ul class="sf-settings-menu-item">\n				',o=n["if"].call(t,t.showLanguage,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;s+="\n				",o=n["if"].call(t,t.showAccounts,{hash:{},inverse:f.noop,fn:f.program(3,c,i)});if(o||o===0)s+=o;s+="\n				",o=n["if"].call(t,t.showAlerts,{hash:{},inverse:f.noop,fn:f.program(5,h,i)});if(o||o===0)s+=o;return s+='\n			</ul>\n		</div>\n		<div class="sf-settings-item-placeholder">\n		</div>\n	</div>\n</div>',s});return t.registerPartial("modules_settings_templates_settings",n),n}),define("classes/widget-plugin",["classes/class"],function(e){var t=e.extend({pluginName:"",constructor:function(e){this.widget=e,this._configure()},_configure:function(){},register:function(){console.log("[WidgetPlugin] Registering plugin %s",this.pluginName)},unregister:function(){console.log("[WidgetPlugin] Unregistering plugin %s",this.pluginName)}});return t}),define("widget-plugins/popup-error-handler-plugin",["classes/widget-plugin","utils/util","ui/modules/popup/popup-module","utils/i18n"],function(e,t,n){var r=e.extend({pluginName:"PopupErrorHandler",_configure:function(){this.processedErrors=[]},register:function(){this._super(),this.widget.hub.on("error",this._errorHandler,this)},unregister:function(){this.widget.hub.off("error",this._errorHandler,this)},_errorHandler:function(e){console.log("[PopupErrorHandler] Error received"),this.processedErrors.indexOf(e.id)<0&&this._processError(e)},_processError:function(e){this.processedErrors.push(e.id);var r={title:t.isFunction(e.getErrorTitle)?e.getErrorTitle():t.i18n.get("common.errors.title"),$container:this.widget.contextConfig.$popupContainer,type:n.ERROR,content:t.isFunction(e.getErrorMessage)?e.getErrorMessage():t.i18n.get("common.errors.e0"),$opener:this.widget.contextConfig.$popupContainer},i=new n(r);i.open()}});return r}),define("libs/require/css/css!modules/settings/css/settings",[],function(){}),define("modules/settings/settings-module",["classes/layout","modules/settings/views/language-view","widgets/accounts/views/accounts-content-view","modules/account-import/account-import-module","modules/alerts-config/alerts-config-module","hbs!modules/settings/templates/settings","widget-plugins/popup-error-handler-plugin","css!modules/settings/css/settings"],function(e,t,n,r,i,s,o){var u=e.extend({template:s,ui:{$userDropdown:".sf-dropdown"},regions:{settingsItemRegion:".sf-settings-item-placeholder"},events:{"click .sf-settings-menu-item li":"_settingsItemClicked","click .sf-settings-add-account":"_addAccountClicked"},serializeData:function(){return{showLanguage:this.config.showLanguage,showAccounts:this.config.showAccounts,showAlerts:this.config.showAlerts}},onShow:function(){this.$(".sf-settings-item-language").addClass("sf-settings-item-selected"),this._changeView("language"),this._errorPlugin=new o(this),this._errorPlugin.register()},_settingsItemClicked:function(e){var t=this.$(e.currentTarget),n=t.data("item");t.closest(".sf-settings-menu-item").find("li").removeClass("sf-settings-item-selected"),t.addClass("sf-settings-item-selected"),this._changeView(n)},_addAccountClicked:function(){return this._changeView("add_account"),!1},_changeView:function(e){if(e==="language"){var s=new t(this.contextConfig);this.settingsItemRegion.show(s)}else if(e==="accounts"){var o=new n(this.contextConfig);this.settingsItemRegion.show(o)}else if(e==="add_account"){var u=new r(this.contextConfig);this.settingsItemRegion.show(u)}else if(e==="alerts"){var a=new i(this.contextConfig);this.settingsItemRegion.show(a)}},close:function(){this._errorPlugin.unregister(),this._super()}},{ID:"settings",submodules:[r,i],defaults:{showLanguage:!0,showAccounts:!0,showAlerts:!0}});return u}),define("ui/modules/navbar/navbar-module-pfm",["ui/modules/navbar/navbar-module","ui/modules/popup/popup-module","modules/settings/settings-module","utils/util"],function(e,t,n,r){var i=e.extend({_openSettings:function(){this._settingsView=new n(this.contextConfig),this.popup=new t({$container:this.$el,contentView:this._settingsView,$opener:this.$(".sf-navbar-user-panel-trigger .sf-button-opener"),title:r.i18n.get("navbar.settingsTitle"),closeCallback:r.bind(this._closeSettingsPopup,this),"class":"sf-navbar-settings-popup"}),this.popup.open()},_closeSettingsPopup:function(){this.popup.remove(),this._settingsView.close()}},{submodules:[t,n]});return i}),define("ui/modules/navbar/navbar-module-pfm-extension",["ui/modules/navbar/navbar-module-pfm","ui/modules/popup/popup-module","modules/settings/settings-module","utils/util"],function(e,t,n,r){var i=e.extend({setCurrent:function(e){if(e==="balance"||e==="ok-to-spend")return;this._currentOption!==e&&(this.$el.find("li.sf-selected").removeClass("sf-selected"),this.$el.find("li.sf-navbar-option-"+e).addClass("sf-selected"),this._currentOption=e)}});return i}),define("libs/require/css/css!ui/modules/platform/css/platform",[],function(){}),define("ui/modules/platform/platform-module",["classes/layout","hbs!ui/modules/platform/templates/platform","ui/modules/navbar/navbar-module","utils/util","utils/locale","css!ui/modules/platform/css/platform"],function(e,t,n,r){var i=e.extend({template:t,regions:{header:".sf-platform-header"},serializeData:function(){var e=r.reduce(this.options.tabs,function(e,t,n){return e[n]=r.clone(t),e[n].items=r.reduce(t.items,function(e,t){return e[t]=t,e},{}),e},{}),t=r.clone(this.options);return t.tabs=e,t.currentYear=(new Date).getFullYear(),t},onRender:function(){this._super(),this.$el.addClass("sf-locale-"+r.locale.id),this.$el.addClass("sf-"+this.config.textDirection)},onShow:function(){var e=r.extend({},this.contextConfig,{entries:this.options.tabs,selected:this.options.currentTab,title:this.options.title,user:this.options.user,$popupContainer:this.$el});this._navBar=new n(e),this.header.show(this._navBar)},setCurrent:function(e){this._navBar.setCurrent(e),this.$(".sf-tab:visible").hide(),this.$("#sf-"+e+"-tab").show()}},{ID:"platform",submodules:[n]});return i}),define("hbs!ui/modules/reports/templates/reports",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var n="",r;return n+='<div id="sf-'+a((r=t.key,typeof r===u?r.apply(e):r))+'-placeholder"></div>',n}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="sf-reports sf-base sf-',(o=n.projectId)?o=o.call(t,{hash:{},data:i}):(o=t.projectId,o=typeof o===u?o.apply(t):o),s+=a(o)+'">\n	<div class="sf-reports-header">\n	</div>\n	<div class="sf-reports-content">\n		',o=n.each.call(t,t.items,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+="\n	</div>\n</div>",s});return t.registerPartial("ui_modules_reports_templates_reports",n),n}),define("libs/require/css/css!ui/modules/reports/css/reports",[],function(){}),define("ui/modules/reports/reports-module",["classes/layout","hbs!ui/modules/reports/templates/reports","utils/util","utils/locale","css!ui/modules/reports/css/reports"],function(e,t,n){var r=e.extend({template:t,regions:{header:".sf-reports-header"},serializeData:function(){var e=n.reduce(this.options.report.items,function(e,t){return e[t]=t,e},{}),t=n.clone(this.options);return t.items=e,t.currentYear=(new Date).getFullYear(),t},onRender:function(){this._super(),this.$el.addClass("sf-locale-"+n.locale.id),this.$el.addClass("sf-"+this.config.textDirection)}},{ID:"Reports",submodules:[]});return r}),define("classes/platform-application",["is!touch?touch-application:desktop-application","classes/platform-router","ui/modules/platform/platform-module","ui/modules/reports/reports-module","classes/event-aggregator","utils/util","backbone","jQuery"],function(e,t,n,r,i,s,o,u){var a=e.extend({start:function(){this._tabs=this.options.tabs,this._reports=this.options.reports,this._platformStarted=!1,this._currentTab=null,this.showTab=s.bind(this.showTab,this),this._showTab=s.bind(this._showTab,this),this._showPlatform=s.bind(this._showPlatform,this),this._addResourcesIds([n]),this.subscribeAll("show:widget",s.bind(this._showWidgetCallback,this)),this._super()},_showWidgetCallback:function(e){var t=this._findTabWithWidget(e.widget),n=this;if(t){var r=this._items[e.widget],i=function(){if(n._currentTab===t){s.scroll(r.instance.$el);return}n.once("tab:showed",function(){s.scroll(r.instance.$el)}),n.showTab(t)};e.filters?r._rendered?(i(),s.each(e.filters,function(t,n){this.publish(e.widget,"filters:change",{filter:n,data:t})},this)):(r.config={filters:e.filters},i()):i()}},_findTabWithWidget:function(e){var t;return s.find(this._tabs,function(n,r){return s.indexOf(n.items,e)<0?!1:(t=r,!0)}),t},showPlatform:function(e){if(!this._started){this.once("start",function(){this.showPlatform(e)}),this._starting||this.start();return}this._resourcesReady?this._showPlatform(e):this.on("resources:ready",this._showPlatform(e)),this._platformStarted=!0,this.trigger("platform:start")},showReport:function(e,t,n){if(!this._started){this.once("start",function(){this.showReport(e,t,n)}),this._starting||this.start();return}this._resourcesReady?this._showReport(e,t,n):this.on("resources:ready",this._showReport(e,t,n)),this._platformStarted=!0},showTab:function(e){if(!this._platformStarted){this.once("platform:start",function(){this.showTab(e)});return}this._router.navigate(e,{trigger:!0})},_initRouter:function(){this._router=new t,this._router.on("show:tab",this._showTab),o.history&&o.history.start()},_showPlatform:function(e){e=e?e.indexOf("#")===0?e:"#"+e:"body",this._regionManager.addRegion("platform",e);var t=s.extend({},this.contextConfig,{hub:new i,projectId:this.config.projectId,tabs:this._tabs,currentTab:this.options._currentTab,title:this.options.title,user:this.config.user,$popupContainer:u(e)});this._platformApp=new n(t),this._regionManager._regions.platform.show(this._platformApp),this._initRouter(),this._setupEventForTabs()},_showReport:function(e,t,n){t=t?t.indexOf("#")===0?t:"#"+t:"body",this._regionManager.addRegion(e+"-report",t);var o=s.extend({},this.contextConfig,{hub:new i,projectId:this.config.projectId,report:this._reports[e],title:this.options.title,user:this.config.user,$popupContainer:u(t)});this._platformApp=new r(o),this._regionManager._regions[e+"-report"].show(this._platformApp),this._showReportItems(e,n)},_showReportItems:function(e,t){var n=function(e){setTimeout(function(){u(".sf-mask:visible").length===0?typeof window.callPhantom=="function"&&window.callPhantom({ready:"true"}):e&&(e-=1,n(e))},100)};s.each(this._reports[e].items,function(e){t&&t.widgetsConfig?this.show(e,this._items[e].placeholder,t.widgetsConfig[e]):this.show(e,this._items[e].placeholder)},this),n(2e3)},_showTab:function(e){if(!this._platformStarted){this.once("platform:start",function(){this._showTab(e)});return}e=e==="home"&&this.options.defaultTab?this.options.defaultTab:e,console.log("[PlatformApplication] _showTab( %s )",e);if(this._currentTab!==e){if(this._tabs[e]===undefined){console.error("[Application] tab %s doesn't exist",e);return}this._platformApp.setCurrent(e),this._currentTab=e,this._showItems(e)}},_showItems:function(e){var t=this._tabs[e].items.length,n=this,r=function(t){setTimeout(function(){u(".sf-mask:visible").length===0?n.triggerMethod("tab:showed",e):t&&(t-=1,r(t))},100)},i=function(){t-=1,t||r(200)};s.each(this._tabs[e].items,function(e){this._items[e]._rendered?i():this.once("initialize:"+e,function(e){this._items[e].instance.on("show",i,this)}),this.show(e,this._items[e].placeholder,this._items[e].config)},this)},_setupEventForTabs:function(){var e;s.each(this._tabs,function(t){t.hub||(e={id:t,_widgets:s.omit(s.pick(this._items,t.items),function(e){return e.type==="module"})},t.hub=new i,t.hub.on("all",s.bind(this._publishEventTab,e)))},this)},_publishEventTab:function(e,t){s.each(this._widgets,function(n){n.instance&&n.instance.publish(e,t)})},_getModuleOptions:function(e){var t=s.find(this._tabs,function(t){return s.contains(t.items,e)}),n=s.extend(this._super(e),{hub:t?t.hub:new i});return this._platformApp&&(n=s.extend(n,{$popupContainer:this._platformApp.$el,$tooltipContainer:this._platformApp.$el})),n},_getWidgetOptions:function(e){return this._platformApp?s.extend(this._super(e),{$popupContainer:this._platformApp.$el,$tooltipContainer:this._platformApp.$el}):this._super(e)},onDestroy:function(){s.each(this._tabs,function(e){e.hub&&e.hub.off()}),this._platformApp&&this._regionManager._regions.platform.close(),this._platformStarted=!1,delete this._currentTab}});return a}),define("classes/platform-application-extension",["classes/platform-application","classes/platform-router","ui/modules/platform/platform-module","ui/modules/reports/reports-module","classes/event-aggregator","utils/util","backbone","jQuery"],function(e,t,n,r,i,s,o,u){var a=e.extend({start:function(){this._tabs=this.options.tabs,this._reports=this.options.reports,this._platformStarted=!1,this._currentTab=null,this.showTab=s.bind(this.showTab,this),this._showTab=s.bind(this._showTab,this),this._showPlatform=s.bind(this._showPlatform,this),this._addResourcesIds([n]),this.subscribeAll("show:widget",s.bind(this._showWidgetCallback,this)),this.subscribeAll("hideTab",s.bind(this._hideTab,this)),this.subscribeAll("showBackTab",s.bind(this._showBackTab,this));var e=this.__proto__,t=e.__proto__,r=t.__proto__;r.start.call(this)},findTabInDom:function(e){var t=u(".sf-platform-content");return t.find("#"+e)},_hideTab:function(e){var t=this.findTabInDom(e.tab);t.hide()},_showBackTab:function(e){var t=this.findTabInDom(e.tab);t.show()},_showWidgetCallback:function(e){var t=this._findTabWithWidget(e.widget),n=this;if(t){var r=this._items[e.widget],i=function(){if(n._currentTab===t){s.scroll(r.instance.$el);return}n.once("tab:showed",function(){s.scroll(r.instance.$el)}),n.showTab(t)};e.filters?r._rendered?e.extraData&&(r.instance.config.extraData=e.extraData,e.filters&&(r.instance.config.filters=e.filters),e.extraData.render&&r.instance.render()):(r.config={filters:e.filters},e.extraData&&(r.config.extraData=e.extraData),i()):i()}},close:function(e){var t=this._items[e];t.instance&&(e==="analysis"&&(t.instance.deleteAccountsInstance!==undefined&&t.instance.deleteAccountsInstance(),t.instance.deleteAnalysisInstance!==undefined&&t.instance.deleteAnalysisInstance()),this.triggerMethod("before:close:"+e),this.triggerMethod("before:close:"+t.type,e),t.type!=="widget"&&t.instance.hub.off(),t.instance.close(),this._regionManager.removeRegion(e),delete t.instance,console.log("[app] "+t.type+" %s closed",e),t._rendered=!1,this.triggerMethod("close:"+e),this.triggerMethod("close:"+t.type,e))},_initRouter:function(){this._router=new t,this._router.on("show:tab",this._showTab),this._showTab("analysis"),o.history&&(o.history.stop(),o.history.start())},_showItems:function(e){var t=this._tabs[e].items.length,n=this,r=function(t){setTimeout(function(){u(".sf-mask:visible").length===0?n.triggerMethod("tab:showed",e):t&&(t-=1,r(t))},100)},i=function(){t-=1,t||r(200)};s.each(this._tabs[e].items,function(e){this._items[e]._rendered?i():this.once("initialize:"+e,function(e){this._items[e].instance.on("show",i,this)});var t=this._items[e].config||{isPlatform:!0};t.isPlatform=!0,this.show(e,this._items[e].placeholder,t)},this)},_getWidgetOptions:function(e){return this._platformApp?s.extend(this._super(e),{$popupContainer:this._platformApp.$el,$tooltipContainer:this._platformApp.$el,isPlatform:!0}):this._super(e)},_showReportItems:function(e,t){var n=function(e){setTimeout(function(){u(".sf-mask:visible").length===0?typeof window.callPhantom=="function"&&window.callPhantom({ready:"true"}):e&&(e-=1,n(e))},100)};s.each(this._reports[e].items,function(e){t&&t.widgetsConfig?this.show(e,this._items[e].placeholder,t.widgetsConfig[e]):this.show(e,this._items[e].placeholder)},this),n(2e3)},showPlatform:function(e,t){if(!this._started){this.once("start",function(){t&&function(e,t,n,r,i){e[r]=e[r]||[],e[r].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var s=t.getElementsByTagName(n)[0],o=t.createElement(n),u=r!="dataLayer"?"&l="+r:"";o.async=!0,o.src="https://www.googletagmanager.com/gtm.js?id="+i+u,s.parentNode.insertBefore(o,s)}(window,document,"script","pfmDataLayer",t),this.showPlatform(e)}),this._starting||this.start();return}this._resourcesReady?this._showPlatform(e):this.on("resources:ready",this._showPlatform(e)),this._platformStarted=!0,this.trigger("platform:start")}});return a}),define("integration/integration",["classes/singleton","classes/platform-application","backbone","widget-plugins/popup-error-handler-plugin","require","utils/util","utils/config"],function(e,t,n,r,i,s){var o=e.extend({_initialized:!1,_httpHeaders:{},_items:{widgets:[],modules:[],uiModules:[],reports:[]},application:null,initialize:function(){if(this._initialized)return;console.log("Version: %s",this.constructor.version),this._items.widgets=s.map(this.constructor.config.widgets),this._items.modules=s.map(this.constructor.config.modules),this._items.uiModules=s.map(this.constructor.config.uiModules),this._items.reports=s.map(this.constructor.config.reports);var e=this._getRequireConfig(),t=this;this._setConfig(),this._initializeHttpHeaders(),i(e,function(){t._initializeApplication(arguments)})},_setConfig:function(){s.config.setGlobals(this.constructor.config)},_getRequireConfig:function(){var e=[];return s.each(s.omit(this._items,"reports"),function(t){s.each(t,function(t){e.push(t.itemPath)})}),e},_initializeApplication:function(e){if(s.size(e)===0)return;this.application=new t(this._getApplicationOptions(e)),this.trigger("initialize"),this._initialized=!0},_getApplicationOptions:function(e){var t=this._getItemsList("widgets",e,0),n=this._getItemsList("modules",e,s.size(this._items.widgets)),i=this._getItemsList("uiModules",e,s.size(this._items.widgets)+s.size(this._items.modules)),o=this._getItemsList("reports",e,s.size(this._items.widgets)+s.size(this._items.modules)+s.size(this._items.uiModules));return{widgets:t,modules:n,uiModules:i,reports:o,tabs:this.constructor.config.tabs,defaultTab:this.constructor.config.defaultTab,config:this.constructor.config,widgetPlugins:[r]}},_getItemsList:function(e,t,n){var r={};return s.each(this._items[e],function(e,i){r[e.id]=s.extend(e,{constructor:t[n+i]})}),r},_initializeHttpHeaders:function(){this._httpHeaders=this.constructor.config.httpHeaders,s.ajaxSetup({headers:this._httpHeaders})},_execute:function(e){var t=this,n=Array.prototype.slice.call(arguments);Array.prototype.shift.apply(n),this._initialized?this.application[e].apply(this.application,n):this.once("initialize",function(){t.application[e].apply(t.application,n)})},getHttpHeader:function(e){return this._httpHeaders[e]},setHttpHeader:function(e,t){var n={headers:{}};this._httpHeaders[e]=t,n.headers[e]=t,s.ajaxSetup(n)},unsetHttpHeader:function(){}},{config:{user:{},environment:{},httpHeaders:{},widgets:{},modules:{},uiModules:{},reports:{},tabs:{}}}),u=["showPlatform","showReport","show","showCustom","showTab","destroy","close","closeCustom","subscribe","subscribeAll","subscribeAllEvents","unsubscribe","unsubscribeAll","publish","publishAll"];s.each(u,function(e){o.prototype[e]=function(){var t=Array.prototype.slice.call(arguments);return t=[e].concat(t),this._execute.apply(this,t)}});var a=u.concat(["getHttpHeader","setHttpHeader","unsetHttpHeader"]);return s.each(a,function(e){o[e]=function(){var t=o.getInstance();return t[e].apply(t,arguments)}}),s.extend(o.prototype,n.Events),o}),define("hbs!classes/ui/widget/templates/widget",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i;return r+=" sf-",(i=n.widgetId)?i=i.call(e,{hash:{}}):(i=e.widgetId,i=typeof i===f?i.apply(e):i),r+=l(i)+"-widget",r}function d(e,t){return" sf-widget-mobile"}function v(e,t){return" sf-widget-phone"}function m(e,t){return" sf-widget-tablet"}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<div id="sf-',(o=n.id)?o=o.call(t,{hash:{}}):(o=t.id,o=typeof o===f?o.apply(t):o),s+=l(o)+'-widget" class="sf-',(o=n.id)?o=o.call(t,{hash:{}}):(o=t.id,o=typeof o===f?o.apply(t):o),s+=l(o)+"-widget",a={hash:{},inverse:c.noop,fn:c.program(1,p,i)},u=(o=n.ifnequal,o?o.call(t,t.id,t.widgetId,a):h.call(t,"ifnequal",t.id,t.widgetId,a));if(u||u===0)s+=u;s+=" sf-widget",u=n["if"].call(t,t.isMobile,{hash:{},inverse:c.noop,fn:c.program(3,d,i)});if(u||u===0)s+=u;u=n["if"].call(t,t.isPhone,{hash:{},inverse:c.noop,fn:c.program(5,v,i)});if(u||u===0)s+=u;u=n["if"].call(t,t.isTablet,{hash:{},inverse:c.noop,fn:c.program(7,m,i)});if(u||u===0)s+=u;return s+='">\n	<div class="sf-widget-header-placeholder"></div>\n	<div class="sf-widget-content-placeholder"></div>\n	<div class="sf-widget-footer-placeholder"></div>\n</div>',s});return t.registerPartial("classes_ui_widget_templates_widget",n),n}),define("libs/require/css/css!classes/ui/widget/css/widget",[],function(){}),define("classes/ui/widget/widget",["classes/layout","classes/event-aggregator","utils/util","jQuery","hbs!classes/ui/widget/templates/widget","css!classes/ui/widget/css/widget"],function(e,t,n,r,i){var s=e.extend({template:i,regions:{headerRegion:".sf-widget-header-placeholder",contentRegion:".sf-widget-content-placeholder",footerRegion:".sf-widget-footer-placeholder"},constructor:function(n){console.log("[%s] constructor()... options: ",n.id,n),this.id=n.id,this.hub=new t,e.prototype.constructor.call(this,n),this._registerPlugins()},serializeData:function(){return{id:n.hyphenate(this.id),widgetId:n.hyphenate(this.constructor.ID),isMobile:n.isMobileBrowser(),isPhone:n.isPhone(),isTablet:n.isTablet()}},onRender:function(){this._super(),this._setupContextConfig()},_setupContextConfig:function(){this.contextConfig={$widget:this.$el,hub:this.hub,parent:this,$popupContainer:this.options.$popupContainer||this.$el,$tooltipContainer:this.options.$tooltipContainer||this.$el,widget:this,globalHubEvents:n.union(this.options.globalHubEvents?this.options.globalHubEvents:[],this.constructor.globalHubEvents?this.constructor.globalHubEvents:[])},this.tooltipOptions={position:{container:this.contextConfig.$tooltipContainer}}},_registerPlugins:function(){n.each(this.options.plugins,function(e){var t=new e(this);t.register()},this)},close:function(){if(this.isClosed)return;this.hub.off(),this._super()}});return s}),define("data/cam-recommendations/cam-session-model",["classes/model"],function(e){var t=e.extend({url:"/cam/goto.action",fetch:function(e){return e.data["do"]="login",this._super(e)},destroy:function(){return this._super({data:{"do":"logout",sessionToken:this.get("sessionToken")}})}});return t}),define("data/cam-recommendations/cam-recommendation-model",["classes/model","utils/util"],function(e,t){var n=e.extend({track:function(e){var n={sessionToken:this.collection.sessionToken,recoToken:this.id,eventName:e},r=t.apiURL("/cam/goto.action?do=track");return t.ajax(r,{data:n,method:"POST"})},parse:function(e){var n=t.pick(e,["picture","pictureDesc","explanation","title"]);return n.id=e.recoToken,n.description=e.description||null,n.url=e.globalUrl||e.url,n.contextElements=e.contextElements,n}});return n}),define("data/cam-recommendations/cam-recommendation-collection",["classes/collection","data/cam-recommendations/cam-recommendation-model","utils/util"],function(e,t,n){var r=e.extend({model:t,url:"/cam/goto.action?do=recommendations",fetch:function(e){var t=null;e=e?n.clone(e):{data:{}};var r=this.constructor.fixNames;return e.data.sessionToken&&(this.sessionToken=e.data.sessionToken),e.data.widgetName&&!e.data.getAll&&(t=["pfm_widgets-"+r(e.data.widgetName)],e.data.category!=null&&t.push("pfm_categories-"+r(e.data.category)),t=t.join(",")),e.data.count&&(this.totalItems=e.data.count),e.data={sessionToken:this.sessionToken,totalItems:this.totalItems},t&&(e.data.contextElementNames=t),this._super(e)}},{fixNames:function(e){return e.replace(/-/g,"_").replace(/ /g,"_").replace(/,/g,"").toLowerCase()}});return r}),define("data/cam-recommendations/cam-recommendations-data-manager",["classes/data-manager","data/cam-recommendations/cam-session-model","data/cam-recommendations/cam-recommendation-collection","classes/collection","utils/util"],function(e,t,n,r,i){var s=e.extend({initialize:function(){this._super.apply(this,arguments),this.registerCollection("cam-session",{type:t})},get:function(e){var t=this._collectionName(e);return!this._isDefined(t)||this.collectionDefs["cam-session"].loading?this._addCollection(t,e):this.getCollection(t,e)},getAll:function(e){var t="allRecommendations";return e.getAll=!0,this._addCollection(t,e)},reset:function(){this._collections["cam-session"]&&this._collections["cam-session"].destroy(),this._super()},_collectionName:function(e){return["recommendations",e.widgetName,e.category].join("-")},_isDefined:function(e){return!!this.collectionDefs[e]},_addCollection:function(e,t){var s=this,o=i.Deferred(),u=function(n){var r=i.merge(n.pick("sessionToken"),t);s.getCollection(e,r).done(f).fail(l)},a=function(e){console.error("[CamRecommendationsDataManager] Error while retrieving CAM session",e),o.reject(e)},f=function(n){if(e==="allRecommendations"){var i=new r(s._findRecommendation(n,t));o.resolve(i)}else o.resolve(n)},l=function(e){console.error("[CamRecommendationsDataManager] Error while recommendations, params=",t," error=",e),o.reject(e)};return this._isDefined(e)||s.registerCollection(e,{type:n}),s.getCollection("cam-session").done(u).fail(a),o.promise()},_findRecommendation:function(e,t){var r=t.widgetName,s=t.category||null;return i.find(e.models,function(e){var t=i.find(e.get("contextElements"),function(e){return"pfm_widgets-"+n.prototype.constructor.fixNames(r)===e});if(s){var o=i.find(e.get("contextElements"),function(e){return"pfm_categories-"+n.prototype.constructor.fixNames(s)===e});return t&&o}return t})}});return s}),define("services/cam-display-service",["classes/service","data/cam-recommendations/cam-recommendations-data-manager","data/categories/categories-data-manager","data/cam-recommendations/cam-recommendation-collection","utils/util"],function(e,t,n,r,i){var s=e.extend({initialize:function(){this._super.apply(this,arguments),this._camRecommendationsDataManager=t.getInstance(),this._categoriesDataManager=n.getInstance()},get:function(e){return e.category!=null?this._getWithCategory(e):this._camRecommendationsDataManager.get(e)},getAll:function(e){return this._getWithCategory(e,!0)},_getWithCategory:function(e,t){var n=i.Deferred(),s=this,o=function(n){var r=i.clone(e);s.categories=n;if(e.category){var o=n.hash[e.category];while(o.get("parent"))o=o.get("parent");r.category=o.get("catKey")}t?i.when(s._camRecommendationsDataManager.getAll(r)).done(u).fail(a):i.when(s._camRecommendationsDataManager.get(r)).done(u).fail(a)},u=function(e){e.length&&i.each(e.models,function(e){i.each(e.get("contextElements"),function(t){if(t.indexOf("pfm_categories-")>-1){var n=t.replace("pfm_categories-",""),o=i.find(s.categories.hash,function(e){return r.prototype.constructor.fixNames(e.get("catKey"))===n});o&&e.set("catColor",o.get("catHexrgbcolor"))}})}),n.resolve(e)},a=function(e){n.reject(e)};return i.when(this._categoriesDataManager.get()).done(o).fail(a),n.promise()}},{ID:"cam-display-service"});return s}),define("hbs!modules/cam-display/templates/cam-banner-view",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i;return r+='title="',(i=n.explanation)?i=i.call(e,{hash:{}}):(i=e.explanation,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function c(e,t){var r="",i;return r+='<h4 class="sf-cam-banner-title">',(i=n.title)?i=i.call(e,{hash:{}}):(i=e.title,i=typeof i===u?i.apply(e):i),r+=a(i)+"</h4>",r}function h(e,t){var r="",i;return r+='<p class="sf-cam-banner-description">',(i=n.description)?i=i.call(e,{hash:{}}):(i=e.description,i=typeof i===u?i.apply(e):i),r+=a(i)+"</p>",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="sf-cam-banner-view" ',o=n["if"].call(t,t.explanation,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;s+='>\n	<a class="sf-cam-banner" href="',(o=n.url)?o=o.call(t,{hash:{}}):(o=t.url,o=typeof o===u?o.apply(t):o),s+=a(o)+'" target="_blank">\n		',o=n["if"].call(t,t.title,{hash:{},inverse:f.noop,fn:f.program(3,c,i)});if(o||o===0)s+=o;s+='\n		<img class="sf-cam-banner-image" src="',(o=n.picture)?o=o.call(t,{hash:{}}):(o=t.picture,o=typeof o===u?o.apply(t):o),s+=a(o)+'" alt="',(o=n.pictureDesc)?o=o.call(t,{hash:{}}):(o=t.pictureDesc,o=typeof o===u?o.apply(t):o),s+=a(o)+'"/>\n	</a>\n	',o=n["if"].call(t,t.description,{hash:{},inverse:f.noop,fn:f.program(5,h,i)});if(o||o===0)s+=o;return s+="\n</div>",s});return t.registerPartial("modules_cam-display_templates_cam-banner-view",n),n}),define("modules/cam-display/views/cam-banner-view",["classes/item-view","utils/tooltip","hbs!modules/cam-display/templates/cam-banner-view"],function(e,t,n){var r=e.extend({template:n,events:{"click .sf-cam-banner":"onClick"},serializeData:function(){var e=this._super();return e.picture=this.config.bannerImageBaseUrl+e.picture,e},onRender:function(){this._super(),t.tooltip.add(this.$el,this.tooltipOptions)},onShow:function(){this.model.track("IMPRESSION")},onClick:function(){this.model.track("CLICK"),this.trigger("recommendation:click",this.model)},onClose:function(){t.tooltip.destroy(this.$el)}});return r}),define("hbs!modules/cam-display/templates/cam-tooltip-view",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i;return r+='style="color:#',(i=n.catColor)?i=i.call(e,{hash:{}}):(i=e.catColor,i=typeof i===u?i.apply(e):i),r+=a(i),r}function c(e,t){var r="",i;return r+='<h2 class="sf-cam-banner-title">',(i=n.title)?i=i.call(e,{hash:{}}):(i=e.title,i=typeof i===u?i.apply(e):i),r+=a(i)+"</h2>",r}function h(e,t){var r="",i;return r+="<h4>",(i=n.explanation)?i=i.call(e,{hash:{}}):(i=e.explanation,i=typeof i===u?i.apply(e):i),r+=a(i)+"</h4>",r}function p(e,t){var r="",i;return r+='<p class="sf-cam-banner-description">',(i=n.description)?i=i.call(e,{hash:{}}):(i=e.description,i=typeof i===u?i.apply(e):i),r+=a(i)+"</p>",r}function d(e,t){var r="",i;return r+='<p class="sf-cam-banner-title-inline">',(i=n.title)?i=i.call(e,{hash:{}}):(i=e.title,i=typeof i===u?i.apply(e):i),r+=a(i)+"</p>",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="sf-cam-tooltip-view" ',o=n["if"].call(t,t.catColor,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;s+='">\n    <div class="sf-cam-tooltip-container">\n        <a class="sf-cam-banner" href="',(o=n.url)?o=o.call(t,{hash:{}}):(o=t.url,o=typeof o===u?o.apply(t):o),s+=a(o)+'" target="_blank">\n            <img class="sf-cam-banner-image" src="',(o=n.picture)?o=o.call(t,{hash:{}}):(o=t.picture,o=typeof o===u?o.apply(t):o),s+=a(o)+'" alt="',(o=n.pictureDesc)?o=o.call(t,{hash:{}}):(o=t.pictureDesc,o=typeof o===u?o.apply(t):o),s+=a(o)+'" width="200" height="230"/>\n	        ',o=n["if"].call(t,t.title,{hash:{},inverse:f.noop,fn:f.program(3,c,i)});if(o||o===0)s+=o;s+="\n            ",o=n["if"].call(t,t.explanation,{hash:{},inverse:f.noop,fn:f.program(5,h,i)});if(o||o===0)s+=o;s+="\n            ",o=n["if"].call(t,t.description,{hash:{},inverse:f.noop,fn:f.program(7,p,i)});if(o||o===0)s+=o;s+="\n        </a>\n    </div>\n	",o=n["if"].call(t,t.title,{hash:{},inverse:f.noop,fn:f.program(9,d,i)});if(o||o===0)s+=o;return s+="\n</div>",s});return t.registerPartial("modules_cam-display_templates_cam-tooltip-view",n),n}),define("modules/cam-display/views/cam-tooltip-view",["classes/item-view","utils/tooltip","hbs!modules/cam-display/templates/cam-tooltip-view"],function(e,t,n){var r=e.extend({template:n,events:{"click .sf-cam-banner":"onClick"},serializeData:function(){var e=this._super();return e},onRender:function(){this._super(),t.tooltip.add(this.$el,t.extend({},this.tooltipOptions,{content:{text:this.$(".sf-cam-tooltip-container")},position:{container:this.$el,viewport:this.options.widget.$el},hide:{delay:300}}))},onShow:function(){this.model.track("IMPRESSION")},onClick:function(){this.model.track("CLICK"),this.trigger("recommendation:click",this.model)},onClose:function(){t.tooltip.destroy(this.$el)}});return r}),define("hbs!modules/cam-display/templates/cam-display",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-cam-display">\n	<div class="sf-cam-recommendation-placeholder"></div>\n</div>'});return t.registerPartial("modules_cam-display_templates_cam-display",n),n}),define("libs/require/css/css!modules/cam-display/css/cam-display",[],function(){}),define("modules/cam-display/cam-display-module",["classes/layout","services/cam-display-service","modules/cam-display/views/cam-banner-view","modules/cam-display/views/cam-tooltip-view","hbs!modules/cam-display/templates/cam-display","utils/util","css!modules/cam-display/css/cam-display"],function(e,t,n,r,i,s){var o=e.extend({filtersList:["category"],template:i,regions:{banner:".sf-cam-recommendation-placeholder"},events:{elementResize:"onElementResize"},initialize:function(e){this._super.apply(this,arguments),this._service=t.getInstance(),this.refresh=s.bind(this.refresh,this),this.next=s.bind(this.next,this),this.onSuccess=s.bind(this.onSuccess,this),this.onFail=s.bind(this.onFail,this),this.widgetName=e.widgetName||e.widget.constructor.ID},getCategory:function(){return this.options.bannerType==="tooltip"?this.$el.closest(".cam-recommendation-placeholder").data("cat")||null:this.options.category!=null?this.options.category:(this.filters&&this.filters.category)!=null?this.filters.category:this.config.bannerDefaultCategory},onShow:function(){this.refresh()},onClose:function(){this._super(),this.dispose()},dispose:function(){this.recommendations&&(this.recommendations=null),this._next&&(clearTimeout(this._next),this._next=null),this._discard&&(clearTimeout(this._discard),this._discard=null)},onFail:function(e){console.error("[CamDisplayModule] Failed to retrieve banner",e),this.banner.close(),this.dispose()},onSuccess:function(e){this.dispose(),this.recommendations=e;if(e.length){var t=this.$el.closest(".sf-widget").find(".cam-recommendation-placeholder");t.hide(),t.removeClass("cam-recommendation-visible"),this.$el.closest(".cam-recommendation-placeholder").addClass("cam-recommendation-visible"),this.$el.closest(".cam-recommendation-placeholder").fadeIn("slow")}return this.start(),this.config.bannerDiscardTime&&(this._discard=setTimeout(s.bind(this.refresh,this,{force:!0}),this.config.bannerDiscardTime)),e},start:function(){this.index=-1,this.next()},next:function(){this._next&&(clearTimeout(this._next),this._next=null),this.index=(this.index+1)%this.recommendations.length;var e=s.extend({model:this.recommendations.at(this.index)},this.contextConfig);if(!e.model){this.banner.close();return}this.options.bannerType==="tooltip"?this.banner.show(new r(e)):this.banner.show(new n(e)),this.config.bannerDisplayTime&&(this._next=setTimeout(this.next,this.config.bannerDisplayTime))},refresh:function(e){this.dispose();var t={widgetName:this.widgetName,category:this.getCategory(),count:this.config.bannerCount,force:!!e&&!!e.force};if(!this.config.bannerRequireCategory||t.category!=null)return s.when(this._service.getAll(t)).then(this.onSuccess).fail(this.onFail);this.banner.close()},_filtersChanged:function(){setTimeout(this.refresh,1)}},{ID:"cam-display",services:[t],defaults:{bannerDiscardTime:15e5,bannerDisplayTime:6e4,bannerCount:15,bannerDefaultCategory:null,bannerRequireCategory:!1,bannerImageBaseUrl:""}});return o}),define("classes/ui/widget/widget-extension",["classes/ui/widget/widget","modules/cam-display/cam-display-module","utils/util"],function(e,t,n){var r=e.extend({onRender:function(){this._super();if(this.config.enableRecommendations){var e=this;this.contentRegion.on("show",function(){var r=e.$(".cam-recommendation-placeholder"),i=n.extend({bannerType:"tooltip",widgetName:e.contextConfig.widget.id},e.contextConfig);n.each(r,function(n,r){e.$(n).append("<div class='cam-region-placeholder-"+r+"'></div>");var s=e.addRegion("cam-region-"+r,".cam-region-placeholder-"+r);s.show(new t(i))})}),this.headerRegion.on("show",function(){var r=e.$(".cam-recommendation-placeholder"),i=n.extend({bannerType:"tooltip",widgetName:e.contextConfig.widget.id},e.contextConfig);n.each(r,function(n,r){e.$(n).append("<div class='cam-region-placeholder-"+r+"'></div>");var s=e.addRegion("cam-region-"+r,".cam-region-placeholder-"+r);s.show(new t(i))})})}}},{defaults:{enableRecommendations:!1}});return r}),define("hbs!widgets/alerts/templates/alerts-header",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s,o,u=n.helperMissing,a=this.escapeExpression;return o={hash:{id:"alerts",title:'{{t "alerts.title" total=totalAlerts}}'}},a((s=n.header,s?s.call(t,o):u.call(t,"header",o)))});return t.registerPartial("widgets_alerts_templates_alerts-header",n),n}),define("widgets/alerts/views/alerts-header-view",["classes/layout","services/alerts-service","utils/util","hbs!widgets/alerts/templates/alerts-header"],function(e,t,n,r){var i=e.extend({template:r,hubEvents:{"alerts:list:change":"_reloadData"},initialize:function(){this._super.apply(this,arguments),this.alerts=null,this.alertsService=t.getInstance()},render:function(e){var t=this;if(e)return this._super();n.when(this.alertsService.getAlerts()).done(n.bind(t._dataReceived,t)).fail(function(e){console.error("Error while loading alerts ",e),t.publish("error",e)})},_reloadData:function(){this.render(!0)},_dataReceived:function(e){this.alerts=e,this.alerts.on("change",this._reloadData,this),this.alerts.on("remove",this._reloadData,this),this.render(!0)},serializeData:function(){return{totalAlerts:this.alerts.length}}});return i}),define("hbs!modules/alerts-list/templates/alerts",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-alerts-list-module">\n	<div class="sf-alerts-list-placeholder"></div>\n	<div class="sf-pagination-placeholder"></div>\n</div>'});return t.registerPartial("modules_alerts-list_templates_alerts",n),n}),define("hbs!modules/alerts-list/templates/alerts-list",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t,r){var i="",s;i+='\n		<ul class="sf-select-alert-options">\n		',s=n.each.call(e,r.alerts,{hash:{},inverse:l.noop,fn:l.program(2,h,t)});if(s||s===0)i+=s;return i+="\n		</ul>\n	",i}function h(e,t){var r="",i,s,o;r+='\n			<li id="sf-alert-selected-',(i=n.id)?i=i.call(e,{hash:{}}):(i=e.id,i=typeof i===u?i.apply(e):i),r+=a(i)+'" class="sf-alert-element">\n				<table>\n					<tr>\n						<td class="sf-alert-icon-cell">\n							<span class="sf-alert-icon ',(i=n.icon)?i=i.call(e,{hash:{}}):(i=e.icon,i=typeof i===u?i.apply(e):i),r+=a(i)+'-icon"></span>\n						</td>\n						<td class="sf-alert-cell">\n							<span class="sf-alert-desc">\n								',o={hash:{context:"alerts-list.description",percentage:'<span class="sf-alert-field-percentatge">{{thresholdValue}}%</span>',entity:'<span class="sf-alert-field-entity">{{entityName}}</span>',number:'<span class="sf-alert-field-account-number">{{accountNumber}}</span>',amount:'<span class="sf-alert-field-amount">{{{formatAmount entityValue}}}</span>',account:'<span class="sf-alert-field-account">{{accountName}}</span>',date:'<span class="sf-alert-field-date">{{formatDate date dateFormat}}</span>',budgetAmount:'<span class="sf-alert-field-budget-amount">{{{formatAmount entityValue}}}</span>'}},s=(i=n.t,i?i.call(e,e.type,o):f.call(e,"t",e.type,o));if(s||s===0)r+=s;return r+='\n							</span>\n							<div class="sf-alert-date"><span>',o={hash:{}},r+=a((i=n.formatNiceDate,i?i.call(e,e.dayDate,o):f.call(e,"formatNiceDate",e.dayDate,o)))+'</span></div>\n						</td>\n						<td class="sf-alert-options-cell">\n							<span class="sf-alert-options">\n								<span class="sf-icon-button sf-button-delete sf-delete-alert"></span>\n							</span>\n						</td>\n					</tr>\n				</table>\n			</li>\n		',r}function p(e,t){var r="",i,s;return r+='\n        <div class="sf-empty-view">\n            <div class="sf-empty-icon-wrapper">\n					<img src="resources/pfm/ui/css/icons/app-icons/admiration.svg" alt="Signo de admiración">\n            </div>\n            ',s={hash:{text:'{{{t "alerts-list.noAlerts"}}}',"class":"sf-noalerts-list"}},r+=a((i=n.empty,i?i.call(e,s):f.call(e,"empty",s)))+'\n            <div class="sf-config-button-wrapper">\n                ',s={hash:{"class":"sf-button-edit-config sf-highlighted-button",text:"alerts-list.configAlerts",type:"button"}},r+=a((i=n.button,i?i.call(e,s):f.call(e,"button",s)))+"\n            </div>\n        </div>\n	",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=n.helperMissing,l=this;s+='<div class="sf-list-box">\n	',o=n["if"].call(t,t.alerts,{hash:{},inverse:l.program(4,p,i),fn:l.programWithDepth(c,i,t)});if(o||o===0)s+=o;return s+="\n</div>",s});return t.registerPartial("modules_alerts-list_templates_alerts-list",n),n}),define("modules/alerts-list/views/alerts-list-view",["classes/item-view","hbs!modules/alerts-list/templates/alerts-list","services/alerts-service","utils/util","ui/modules/popup/popup-module","jQuery","utils/date","utils/mask","utils/i18n"],function(e,t,n,r,i,s){var o=e.extend({template:t,events:{"click .sf-delete-alert":"_openDeletePopup"},initialize:function(){this._super.apply(this,arguments),this.alerts=null,this.currentPage=1,this.alertsService=n.getInstance()},_openDeletePopup:function(e){var t=s(e.currentTarget),n=this,o={$container:this.$el,$opener:t,title:r.i18n.get("alerts-list.deletePopup.title"),content:r.i18n.get("alerts-list.deletePopup.content"),type:i.CONFIRM,closeCallback:r.bind(this._closeDeletePopup,this),confirmCallback:r.bind(this._deleteAlert,n,e)};this.deletePopup=new i(o),this.deletePopup.open()},_closeDeletePopup:function(){this.deletePopup.remove()},_deleteAlert:function(e){var t=s(e.currentTarget).closest(".sf-alert-element"),n=r.last(t.attr("id").split("-")),i=this;r.mask(this.$el.parent(),r.MASK_LOADING),r.when(this.alertsService.deleteAlert({id:parseInt(n,10)})).done(function(){r.unmask(i.$el.parent())}).fail(function(e){console.error("[AlertsModule] Removing Alerts error",e),r.unmask(i.$el.parent()),i.publish("error",e)})},render:function(e){if(e){var t=this._super();return t}var n=this;r.when(this.alertsService.getAlerts()).done(function(e){n.alerts=e,r.unmask(n.$el),n.render(!0)}).fail(function(e){r.unmask(n.$el),console.error("[AlertsModule] Loading Alerts error",e),n.publish("error",e)})},reloadData:function(e){console.log("Reload data with elements of page %d",e),this.currentPage=e,this.render(!0)},serializeData:function(){return{alerts:this._getPaginatedAlerts(this.currentPage,this.config.alertsPerPage)}},_getPaginatedAlerts:function(e,t){var n=e-1,i=this.alerts.map(function(e){return e=e.attributes,e.type=this.alertsService.getTypeName(e.atyId),e.date=new Date(e.date),e.dateFormat=r.date.constructor.SHORT_DATE,e},this),s=t*n,o=s+t;return i.length>s&&(i=i.slice(s,o)),i}});return o}),define("modules/alerts-list/views/alerts-list-view-extension",["modules/alerts-list/views/alerts-list-view","utils/util","ui/modules/popup/popup-module","jQuery","utils/i18n"],function(e,t,n,r){var i=e.extend({events:{"click .sf-delete-alert":"_openDeletePopup","click .sf-button-edit-config":"_openConfigPopup"},_openDeletePopup:function(e){var i=r(e.currentTarget),s=this,o={$container:this.$el,$opener:i,title:t.i18n.get("alerts-list.deletePopup.title"),content:t.i18n.get("alerts-list.deletePopup.content"),type:n.CONFIRM,closeCallback:t.bind(this._closeDeletePopup,this),confirmCallback:t.bind(this._deleteAlert,s,e),labelConfirm:t.i18n.get("common.button.accept"),titleIcon:"dav-white-trash-can",standAlone:!this.config.isPlatform};this.deletePopup=new n(o),this.deletePopup.open()},serializeData:function(){var e=this._getPaginatedAlerts(this.currentPage,this.config.alertsPerPage);return t.each(e,function(e){e.icon=e.type,e.type&&(e.type=="largePurchase"||e.type=="largeDeposit"||e.type=="highBalance"||e.type=="lowBalance")&&e.accountType!=null&&(e.accountType===0||e.accountType===1||e.accountType===4)&&(e.type+="-"+e.accountType)}),{alerts:e}},_openConfigPopup:function(){this.publish("alerts:showConfig")}},{defaults:{alertsPerPage:3e3}});return i}),define("hbs!ui/modules/pagination/templates/pagination",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<span class="sf-pagination">\n',u={hash:{page:t.currentPage,maxPage:t.maxPage,limit:t.limit,prevText:t.prevText,nextText:t.nextText}},s+=f((o=n.pagination,o?o.call(t,u):a.call(t,"pagination",u)))+"\n</span>",s});return t.registerPartial("ui_modules_pagination_templates_pagination",n),n}),define("libs/require/css/css!ui/modules/pagination/css/pagination",[],function(){}),define("ui/modules/pagination/pagination-module",["classes/item-view","jQuery","utils/util","hbs!ui/modules/pagination/templates/pagination","utils/i18n","css!ui/modules/pagination/css/pagination"],function(e,t,n,r){var i=e.extend({template:r,events:{"click .sf-pagination-element":"moveToElement","click .sf-pagination-next":"moveNext","click .sf-pagination-prev":"movePrev"},initialize:function(){this._super.apply(this,arguments),this.currentPage=this.config.page,this.maxPage=this.config.maxPage,this.limit=this.config.limit},serializeData:function(){return{prevText:n.i18n.get("pagination.prev"),nextText:n.i18n.get("pagination.next"),limit:this.limit,currentPage:this.currentPage,maxPage:this.maxPage}},moveToElement:function(e){var n=t(e.currentTarget),r=n.data("current");this.currentPage=r,this.trigger("moveTo",this.currentPage),this.render()},movePrev:function(){this.currentPage>1&&(this.currentPage=this.currentPage-1,this.trigger("moveTo",this.currentPage),this.render())},moveNext:function(){this.currentPage<this.maxPage&&(this.currentPage=this.currentPage+1,this.trigger("moveTo",this.currentPage),this.render())}},{ID:"pagination",defaults:{page:1,limit:2,maxPage:10}});return i}),define("libs/require/css/css!modules/alerts-list/css/alerts-list",[],function(){}),define("modules/alerts-list/alerts-list-module",["classes/layout","hbs!modules/alerts-list/templates/alerts","modules/alerts-list/views/alerts-list-view","ui/modules/pagination/pagination-module","services/alerts-service","utils/util","css!modules/alerts-list/css/alerts-list"],function(e,t,n,r,i,s){var o=e.extend({template:t,hubEvents:{"alerts:list:change":"_refreshData"},regions:{listRegion:".sf-alerts-list-placeholder",paginationRegion:".sf-pagination-placeholder"},initialize:function(){this._super.apply(this,arguments),this.alertsService=i.getInstance()},render:function(e){var t=this;if(e)return this._super();s.when(this.alertsService.getAlerts()).done(function(e){t.alerts=e,t.render(!0)}).fail(function(e){console.error("[AlertsModule] Loading Alerts error",e),t.publish("error",e)})},_refreshData:function(e){this.alerts=e,this.render(!0)},onRender:function(){this._super();var e=Math.ceil(this.alerts.length/this.config.alertsPerPage);e>1&&(this.pagination=new r(s.extend({},{config:{maxPage:e}},this.contextConfig)),this.pagination.on("moveTo",this._paginateData,this),this.paginationRegion.show(this.pagination)),this.alertsList=new n(s.extend({},this.contextConfig)),s.mask(this.$(".sf-alerts-list-placeholder"),s.MASK_LOADING),this.listRegion.show(this.alertsList)},_paginateData:function(e){this.alertsList.reloadData(e)}},{ID:"alerts-list",services:[i],submodules:[r],defaults:{alertsPerPage:5}});return o}),define("hbs!widgets/alerts/templates/alerts-content",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function h(e,t){var r="",i,s;return r+='\n			<div class="sf-button-controls">\n				',s={hash:{text:'{{t "alerts.button.removeAll"}}',type:"button","class":"sf-button-delete sf-delete-all-alerts-button",disabled:"{{#unless totalAlerts}}true{{/unless}}"}},r+=l((i=n.button,i?i.call(e,s):f.call(e,"button",s)))+"\n			</div>\n		",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c=this;s+='<div class="sf-list-view sf-alerts-body">\n	<div class="sf-alerts-heading">\n		<div class="sf-config-panel">\n			',a={hash:{"class":"sf-button-edit sf-button-toggle-alert-config",type:"button"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+'\n		</div>\n		<div class="sf-alerts-title">\n			<h4>',a={hash:{}},s+=l((o=n.t,o?o.call(t,"alerts.web.title",a):f.call(t,"t","alerts.web.title",a)))+"</h4>\n		</div>\n		",u=n["if"].call(t,t.totalAlerts,{hash:{},inverse:c.noop,fn:c.program(1,h,i)});if(u||u===0)s+=u;return s+='\n	</div>\n	<div class="sf-alerts-list-placeholder"></div>\n</div>',s});return t.registerPartial("widgets_alerts_templates_alerts-content",n),n}),define("widgets/alerts/views/alerts-content-view",["classes/layout","modules/alerts-list/alerts-list-module","modules/alerts-config/alerts-config-module","services/alerts-service","ui/modules/popup/popup-module","utils/util","jQuery","hbs!widgets/alerts/templates/alerts-content"],function(e,t,n,r,i,s,o,u){var a=e.extend({template:u,events:{"click button.sf-delete-all-alerts-button":"_openDeletePopup","click button.sf-button-toggle-alert-config":"_showConfig","click button.sf-button-close-alert-config":"_closeConfig"},regions:{alertsListRegion:".sf-alerts-list-placeholder",alertsConfigRegion:".sf-alerts-config-placeholder"},hubEvents:{"alerts:list:change":"_reloadData","alerts:config:done":"_closeConfig"},ui:{$buttons:".sf-button-controls",$alertsListContainer:".sf-alerts-list-placeholder",$alertsConfigContainer:".sf-alerts-config-placeholder"},initialize:function(){this._super.apply(this,arguments),this.alerts=null,this.alertsService=r.getInstance()},render:function(e){var t=this;if(e)return this._super();s.when(this.alertsService.getAlerts()).done(s.bind(t._dataReceived,t)).fail(function(e){console.error("Error while loading alerts ",e),t.publish("error",e)})},_dataReceived:function(e){this.alerts=e,this.alerts.on("change",this._reloadData,this),this.alerts.on("remove",this._reloadData,this),this.render(!0)},_reloadData:function(){this.render(!0)},onRender:function(){this._super(),this.alertsList=new t(this.contextConfig),this.alertsConfig=new n(this.contextConfig),this.ui.$alertsListContainer.show(),this.ui.$alertsConfigContainer.hide(),this.alertsListRegion.show(this.alertsList),this.alertsConfigRegion.show(this.alertsConfig)},serializeData:function(){return{totalAlerts:this.alerts.length}},_openDeletePopup:function(e){var t=o(e.currentTarget),n={$container:this.$el,$opener:t,title:s.i18n.get("alerts.deleteAllPopup.title"),content:s.i18n.get("alerts.deleteAllPopup.content"),type:i.CONFIRM,closeCallback:s.bind(this._closeDeletePopup,this),confirmCallback:s.bind(this._deleteAllAlerts,this,e)};this.deletePopup=new i(n),this.deletePopup.open()},_closeDeletePopup:function(){this.deletePopup.remove()},_deleteAllAlerts:function(){var e=this;s.when(this.alertsService.deleteAllAlerts()).fail(function(t){console.log("Error while removing alerts".error),e.publish("error",t)})},_showConfig:function(){this.ui.$alertsConfigContainer.show(),this.ui.$alertsListContainer.hide(),this.ui.$buttons.hide()},_closeConfig:function(){this.alertsConfig.resetForm(),this.ui.$alertsConfigContainer.hide(),this.ui.$alertsListContainer.show(),this.ui.$buttons.show()}});return a}),define("widgets/alerts/views/alerts-content-view-extension",["widgets/alerts/views/alerts-content-view","modules/alerts-list/alerts-list-module","modules/alerts-config/alerts-config-module","ui/modules/popup/popup-module","utils/util","jQuery"],function(e,t,n,r,i,s){var o=e.extend({events:{"click button.sf-delete-all-alerts-button":"_openDeletePopup","click button.sf-button-toggle-alert-config":"_openConfig","click button.sf-button-close-alert-config":"_closeConfig","click a.sf-popup-close":"_closeConfig"},regions:{alertsListRegion:".sf-alerts-list-placeholder"},hubEvents:{"alerts:showConfig":"_openConfig","alerts:config:done":"_closeConfig"},onRender:function(){this.alertsList=new t(this.contextConfig),this.ui.$alertsListContainer.show(),this.alertsListRegion.show(this.alertsList),i.pushToDataLayer({eventCategory:"PFM Notificaciones",eventAction:"Pagina",eventLabel:"Notificaciones",event:"eventClick"}),this._showConfig()},_openDeletePopup:function(e){var t=s(e.currentTarget),n={$container:this.$el,$opener:t,title:i.i18n.get("alerts.deleteAllPopup.title"),content:i.i18n.get("alerts.deleteAllPopup.content"),type:r.CONFIRM,closeCallback:i.bind(this._closeDeletePopup,this),confirmCallback:i.bind(this._deleteAllAlerts,this,e),labelConfirm:i.i18n.get("common.button.accept"),titleIcon:"dav-white-trash-can",standAlone:!this.config.isPlatform};this.deletePopup=new r(n),this.deletePopup.open()},_showConfig:function(){this.ui.$alertsConfigContainer.show(),this.alertsConfig=new n(this.contextConfig);var e={$container:this.$el,$opener:this.$el,title:i.i18n.get("alerts-config.web.title"),subtitle:i.i18n.get("alerts-config.web.subtitle"),labelConfirm:i.i18n.get("common.button.accept"),"class":"sf-edit-alerts-popup",titleIcon:"dav-white-edit",iconExt:"svg",standAlone:!this.config.isPlatform};this.editConfigPopup=new r(e),this.alertsConfig.on("cancel",this.editConfigPopup.remove,this.editConfigPopup),this.alertsConfig.on("alerts:config:done",this.editConfigPopup.remove,this.editConfigPopup),this.editConfigPopup.contentRegion.show(this.alertsConfig)},_openConfig:function(){this.alertsConfig||this._showConfig(),this.editConfigPopup.open()},_closeEditConfigPopup:function(){this.editConfigPopup.remove(),this.alertsConfig=null},_closeConfig:function(){this._closeEditConfigPopup()}});return o}),define("libs/require/css/css!widgets/alerts/css/alerts",[],function(){}),define("widgets/alerts/alerts-widget",["classes/ui/widget/widget","widgets/alerts/views/alerts-header-view","widgets/alerts/views/alerts-content-view","modules/alerts-list/alerts-list-module","modules/alerts-config/alerts-config-module","services/alerts-service","utils/util","utils/mask","css!widgets/alerts/css/alerts"],function(e,t,n,r,i,s,o){var u=e.extend({onRender:function(){var e=this;this._super(),o.mask(this.$el,o.MASK_LOADING),this.headerRegion.show(new t(this.contextConfig)),this.contentRegion.on("show",function(){o.unmask(e.$el)}),this.contentRegion.show(new n(this.contextConfig))}},{ID:"alerts",submodules:[r,i],services:[s]});return u}),define("hbs!widgets/details/templates/details-summary",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=n.helperMissing;s+='<div class="sf-details-summary">\n	',a={hash:{"class":"sf-summary-income",title:'{{{t "common.summary.income" datesRange=dateRangeText}}}',value:"{{{income}}}"}},u=(o=n.summaryBox,o?o.call(t,a):f.call(t,"summaryBox",a));if(u||u===0)s+=u;s+="\n	",a={hash:{"class":"sf-summary-expenses",title:'{{{t "common.summary.expenses" datesRange=dateRangeText}}}',value:"{{{expenses}}}"}},u=(o=n.summaryBox,o?o.call(t,a):f.call(t,"summaryBox",a));if(u||u===0)s+=u;s+="\n	",a={hash:{"class":"sf-summary-cashflow",title:'{{{t "common.summary.cashflow" datesRange=dateRangeText}}}',value:"{{{balance}}}"}},u=(o=n.summaryBox,o?o.call(t,a):f.call(t,"summaryBox",a));if(u||u===0)s+=u;return s+="\n</div>\n",s});return t.registerPartial("widgets_details_templates_details-summary",n),n}),define("widgets/details/views/details-summary-view",["classes/item-view","classes/model","utils/util","hbs!widgets/details/templates/details-summary","utils/date"],function(e,t,n,r){var i=e.extend({hubEvents:{"transactions:datagrid:change":"update"},initialize:function(){this._super.apply(this,arguments),this.model=new t({income:"",expenses:"",balance:"",dateRangeText:""}),this.model.on("change",this.render)},template:r,update:function(e){var t=e.collection.reduce(function(e,t){var n=t.get("cuxAmnt");return n>0?e.income+=n:e.expenses+=n,e},{income:0,expenses:0});t.expenses=Math.abs(t.expenses),t.balance=t.income-t.expenses,t.dateRangeText="<span class='sf-period'>"+this._calculateDate(e.appliedFilters.datesRange)+"</span>",n.each(t,function(e,t,r){typeof e=="number"&&(r[t]=n.amount.format(e,!1))}),this.model.set(t)},_calculateDate:function(e){var t=e.fromDate,r=e.toDate;return n.date.formatSemanticRange(t,r)}});return i}),define("hbs!modules/accounts-filter/templates/account-view",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){return'class="sf-account-with-logo"'}function d(e,t){var r="",i,s;return r+="\n            ",s={hash:{id:"sf-account-{{accountPK}}-{{cid}}",type:"checkbox",dataAccountpk:e.accountPK,dataAccountProviderid:e.providerId,"class":"sf-account-selector",checked:!0,name:"sf-account-{{accountPK}}-{{cid}}"}},r+=l((i=n.checkbox,i?i.call(e,s):f.call(e,"checkbox",s)))+"\n        ",r}function v(e,t){var r="",i,s;return r+="\n            ",s={hash:{id:"sf-account-{{accountPK}}-{{cid}}",type:"checkbox",dataAccountpk:e.accountPK,dataAccountProviderid:e.providerId,"class":"sf-account-selector",name:"sf-account-{{accountPK}}-{{cid}}"}},r+=l((i=n.checkbox,i?i.call(e,s):f.call(e,"checkbox",s)))+"\n        ",r}function m(e,t){var r="",i,s,o;r+=' title="',o={hash:{noTag:!0}},s=(i=n.formatAmount,i?i.call(e,e.balanceSysCur,o):f.call(e,"formatAmount",e.balanceSysCur,o));if(s||s===0)r+=s;return r+='"',r}function g(e,t){var r="",i,s,o;r+='\n        <div class="sf-account-logo">\n            ',o={hash:{},inverse:c.noop,fn:c.program(10,y,t)},s=(i=n.ifequal,i?i.call(e,e.creditcardBrand,"MASTER CARD",o):f.call(e,"ifequal",e.creditcardBrand,"MASTER CARD",o));if(s||s===0)r+=s;r+="\n            ",o={hash:{},inverse:c.noop,fn:c.program(12,b,t)},s=(i=n.ifequal,i?i.call(e,e.creditcardBrand,"VISA",o):f.call(e,"ifequal",e.creditcardBrand,"VISA",o));if(s||s===0)r+=s;r+="\n            ",o={hash:{},inverse:c.noop,fn:c.program(14,w,t)},s=(i=n.ifequal,i?i.call(e,e.creditcardBrand,"DINERS DAVIVIENDA",o):f.call(e,"ifequal",e.creditcardBrand,"DINERS DAVIVIENDA",o));if(s||s===0)r+=s;r+="\n            ",o={hash:{},inverse:c.noop,fn:c.program(16,E,t)},s=(i=n.ifequal,i?i.call(e,e.creditcardBrand,"CLUBES",o):f.call(e,"ifequal",e.creditcardBrand,"CLUBES",o));if(s||s===0)r+=s;r+="\n            ",o={hash:{},inverse:c.noop,fn:c.program(16,E,t)},s=(i=n.ifequal,i?i.call(e,e.creditcardBrand,"MARCAS PRIVADAS",o):f.call(e,"ifequal",e.creditcardBrand,"MARCAS PRIVADAS",o));if(s||s===0)r+=s;r+="\n            ",o={hash:{},inverse:c.noop,fn:c.program(16,E,t)},s=(i=n.ifequal,i?i.call(e,e.creditcardBrand,"CAFETERA",o):f.call(e,"ifequal",e.creditcardBrand,"CAFETERA",o));if(s||s===0)r+=s;r+="\n            ",o={hash:{},inverse:c.noop,fn:c.program(16,E,t)},s=(i=n.ifequal,i?i.call(e,e.creditcardBrand,"AGROPECUARIA",o):f.call(e,"ifequal",e.creditcardBrand,"AGROPECUARIA",o));if(s||s===0)r+=s;return r+="\n        </div>\n    ",r}function y(e,t){return'\n					<img src="resources/pfm/ui/css/icons/logos/mastercard.svg" alt="Master Card Logo">\n            '}function b(e,t){return'\n					<img src="resources/pfm/ui/css/icons/logos/visa.svg" alt="Visa Logo">\n            '}function w(e,t){return'\n					<img src="resources/pfm/ui/css/icons/logos/diners.svg" alt="Diners Logo">\n            '}function E(e,t){return'\n					<img src="resources/pfm/ui/css/icons/logos/davivienda.svg" alt="Davivienda Logo">\n            '}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c=this,h="function";s+="<li ",o=n["if"].call(t,t.creditcardBrand,{hash:{},inverse:c.noop,fn:c.program(1,p,i)});if(o||o===0)s+=o;s+='>\n    <div class="sf-account-data">\n        ',o=n["if"].call(t,t.viewFilter,{hash:{},inverse:c.program(5,v,i),fn:c.program(3,d,i)});if(o||o===0)s+=o;s+='\n        <label for="sf-account-',(o=n.accountPK)?o=o.call(t,{hash:{}}):(o=t.accountPK,o=typeof o===h?o.apply(t):o),s+=l(o)+"-",(o=n.cid)?o=o.call(t,{hash:{}}):(o=t.cid,o=typeof o===h?o.apply(t):o),s+=l(o)+'">\n			<span class="sf-acc-alias">\n				',(o=n.alias)?o=o.call(t,{hash:{}}):(o=t.alias,o=typeof o===h?o.apply(t):o),s+=l(o)+'\n			</span>\n			<div class="sf-account-info">\n				<span class="sf-account-balance"',a={hash:{},inverse:c.noop,fn:c.program(7,m,i)},u=(o=n.ifnequal,o?o.call(t,t.balance,t.balanceSysCur,a):f.call(t,"ifnequal",t.balance,t.balanceSysCur,a));if(u||u===0)s+=u;s+=">",a={hash:{curr:"{{currency}}"}},u=(o=n.formatAmount,o?o.call(t,t.balance,a):f.call(t,"formatAmount",t.balance,a));if(u||u===0)s+=u;s+="</span>\n			</div>\n		</label>\n    </div>\n    ",u=n["if"].call(t,t.creditcardBrand,{hash:{},inverse:c.noop,fn:c.program(9,g,i)});if(u||u===0)s+=u;return s+="\n</li>\n",s});return t.registerPartial("modules_accounts-filter_templates_account-view",n),n}),define("hbs!modules/accounts-filter/templates/entity-group-view",["hbs","Handlebars","hbs!modules/accounts-filter/templates/account-view"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t,r){var i="",s,o;i+='\n	<li class="sf-account-group">\n		',s=n["if"].call(e,e.selected,{hash:{},inverse:a.program(4,h,t),fn:a.program(2,c,t)});if(s||s===0)i+=s;i+='\n		<label for="sf-account-group-',(s=n.key)?s=s.call(e,{hash:{}}):(s=e.key,s=typeof s===f?s.apply(e):s),i+=u(s)+"-"+u((s=r.cid,typeof s===f?s.apply(e):s))+'" class="sf-account-group-label">',(o=n.groupName)?o=o.call(e,{hash:{}}):(o=e.groupName,o=typeof o===f?o.apply(e):o),i+=u(o)+'</label>\n		<ul class="sf-accounts-list">\n			',o=n.each.call(e,e.elements,{hash:{},inverse:a.noop,fn:a.programWithDepth(p,t,r)});if(o||o===0)i+=o;return i+="\n		</ul>\n	</li>\n",i}function c(e,t){var r="",i,s;return r+="\n			",s={hash:{id:"sf-account-group-{{key}}-{{cid}}","class":"sf-account-group-selector",checked:!0,name:"sf-account-group-{{key}}-{{cid}}"}},r+=u((i=n.checkbox,i?i.call(e,s):o.call(e,"checkbox",s)))+"\n		",r}function h(e,t){var r="",i,s;return r+="\n			",s={hash:{id:"sf-account-group-{{key}}-{{cid}}","class":"sf-account-group-selector",name:"sf-account-group-{{key}}-{{cid}}"}},r+=u((i=n.checkbox,i?i.call(e,s):o.call(e,"checkbox",s)))+"\n		",r}function p(e,t,r){var i="",s,u,f;i+="\n				",f={hash:{cid:r.cid},inverse:a.noop,fn:a.program(7,d,t)},u=(s=n.partial,s?s.call(e,f):o.call(e,"partial",f));if(u||u===0)i+=u;return i+="\n			",i}function d(e,t){var i="",s;i+="\n					",s=a.invokePartial(r["modules_accounts-filter_templates_account-view"],"modules_accounts-filter_templates_account-view",e,n,r);if(s||s===0)i+=s;return i+="\n				",i}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,r=r||e.partials;var s,o=n.helperMissing,u=this.escapeExpression,a=this,f="function";return s=n.each.call(t,t.group,{hash:{},inverse:a.noop,fn:a.programWithDepth(l,i,t)}),s||s===0?s:""});return t.registerPartial("modules_accounts-filter_templates_entity-group-view",n),n}),define("hbs!modules/accounts-filter/templates/product-type-group-view",["hbs","Handlebars","hbs!modules/accounts-filter/templates/account-view"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t,r){var i="",s,o,c;i+='\n	<li class="sf-account-group sf-account-group-',(s=n.key)?s=s.call(e,{hash:{}}):(s=e.key,s=typeof s===l?s.apply(e):s),i+=a(s)+'">\n        <div class="sf-account-groups-list-container">\n\n        ',c={hash:{cid:r.cid},inverse:f.noop,fn:f.program(2,h,t)},o=(s=n.partial,s?s.call(e,c):u.call(e,"partial",c));if(o||o===0)i+=o;i+='\n		<label for="sf-account-group-',(o=n.key)?o=o.call(e,{hash:{}}):(o=e.key,o=typeof o===l?o.apply(e):o),i+=a(o)+"-"+a((s=r.cid,typeof s===l?s.apply(e):s))+'" class="sf-account-group-label">',c={hash:{context:"accounts-filter.products"}},i+=a((s=n.t,s?s.call(e,e.groupName,c):u.call(e,"t",e.groupName,c)))+'</label>\n        </div>\n		<ul class="sf-accounts-list">\n			',o=n.each.call(e,e.elements,{hash:{},inverse:f.noop,fn:f.programWithDepth(v,t,r)});if(o||o===0)i+=o;return i+="\n		</ul>\n	</li>\n",i}function h(e,t){var r="",i;r+="\n			",i=n["if"].call(e,e.selected,{hash:{},inverse:f.program(5,d,t),fn:f.program(3,p,t)});if(i||i===0)r+=i;return r+="\n		",r}function p(e,t){var r="",i,s;return r+="\n				",s={hash:{id:"sf-account-group-{{key}}-{{cid}}",type:"checkbox","class":"sf-account-group-selector",checked:!0,name:"sf-account-group-{{key}}-{{cid}}"}},r+=a((i=n.checkbox,i?i.call(e,s):u.call(e,"checkbox",s)))+"\n			",r}function d(e,t){var r="",i,s;return r+="\n				",s={hash:{id:"sf-account-group-{{key}}-{{cid}}",type:"checkbox","class":"sf-account-group-selector",name:"sf-account-group-{{key}}-{{cid}}"}},r+=a((i=n.checkbox,i?i.call(e,s):u.call(e,"checkbox",s)))+"\n			",r}function v(e,t,r){var i="",s,o,a;i+="\n				",a={hash:{cid:r.cid},inverse:f.noop,fn:f.program(8,m,t)},o=(s=n.partial,s?s.call(e,a):u.call(e,"partial",a));if(o||o===0)i+=o;return i+="\n			",i}function m(e,t){var i="",s;i+="\n					",s=f.invokePartial(r["modules_accounts-filter_templates_account-view"],"modules_accounts-filter_templates_account-view",e,n,r);if(s||s===0)i+=s;return i+="\n				",i}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,r=r||e.partials;var s="",o,u=n.helperMissing,a=this.escapeExpression,f=this,l="function";o=n.each.call(t,t.group,{hash:{},inverse:f.noop,fn:f.programWithDepth(c,i,t)});if(o||o===0)s+=o;return s+="\n",s});return t.registerPartial("modules_accounts-filter_templates_product-type-group-view",n),n}),define("hbs!modules/accounts-filter/templates/accounts-filter",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){return"sf-checked"}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c=this,h="function";s+='<div class="sf-accounts-filter sf-accounts-filter-inline">\n	<div class="sf-button-group sf-account-grouping-buttons">\n		',a={hash:{text:"accounts-filter.groupBy.product",dataGroupingOption:"0","class":"sf-account-group-option sf-account-group-option-0{{#ifequal grouping '0'}} sf-active{{/ifequal}}",type:"button"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+"\n		",a={hash:{text:"accounts-filter.groupBy.entity",dataGroupingOption:"1","class":"sf-account-group-option sf-account-group-option-1{{#ifequal grouping '1'}} sf-active{{/ifequal}}",type:"button"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+'\n	</div>\n	<div class="sf-all-accounts ',u=n["if"].call(t,t.allChecked,{hash:{},inverse:c.noop,fn:c.program(1,p,i)});if(u||u===0)s+=u;return s+='">\n		',a={hash:{id:"sf-all-accounts",type:"checkbox","class":"sf-all-accounts",checked:"{{allChecked}}",name:"sf-all-accounts"}},s+=l((o=n.checkbox,o?o.call(t,a):f.call(t,"checkbox",a)))+'\n		<label for="sf-all-accounts">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"accounts-filter.allAccounts",a):f.call(t,"t","accounts-filter.allAccounts",a)))+" ",(u=n.tumama)?u=u.call(t,{hash:{}}):(u=t.tumama,u=typeof u===h?u.apply(t):u),s+=l(u)+'</label>\n	</div>\n	<ul class="sf-account-groups-list"></ul>\n	<a class="sf-account-config-save" href="javascript:void(0);">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"accounts-filter.useSelection",a):f.call(t,"t","accounts-filter.useSelection",a)))+"</a>\n</div>",s});return t.registerPartial("modules_accounts-filter_templates_accounts-filter",n),n}),define("libs/require/css/css!modules/accounts-filter/css/accounts-filter",[],function(){}),define("modules/accounts-filter/accounts-filter-module",["classes/item-view","utils/util","ui/modules/reform/checkbox/checkbox-module","services/accounts-service","jQuery","hbs!modules/accounts-filter/templates/entity-group-view","hbs!modules/accounts-filter/templates/product-type-group-view","hbs!modules/accounts-filter/templates/accounts-filter","utils/tooltip","css!modules/accounts-filter/css/accounts-filter"],function(e,t,n,r,i,s,o,u){var a=e.extend({template:u,events:{"change input.sf-account-selector":"_accountsSelectionChanged","change input.sf-account-group-selector":"_accountGroupSelectionChanged","click .sf-account-group-option":"_groupByChange","click .sf-account-config-save":"saveAccountSelection"},ui:{accountsContainer:".sf-account-groups-list"},initialize:function(){this._super.apply(this,arguments),this.accountsService=r.getInstance(),this._dataReceived=t.bind(this._dataReceived,this),this._dataChanged=t.bind(this._dataChanged,this),this.getData()},onRender:function(){this._super(),this.updateView()},updateView:function(){if(this.isClosed!==!1)return this.render();var e;this._currentGrouping===r.PRODUCT_GROUPING?e=o:e=s,this.ui.accountsContainer.html(e({group:this.accounts,cid:this.cid})),this.$(".sf-account-group-option").removeClass("sf-active"),this.$(".sf-account-group-option-"+this._currentGrouping).addClass("sf-active"),this._updateSaveButtonStatus(),t.tooltip.add(this.$el.find(".sf-account-balance"),this.tooltipOptions),n.init(this.$el)},_updateSaveButtonStatus:function(){this.$(".sf-account-config-save")[this.hasChanged()?"removeClass":"addClass"]("sf-disabled")},hasChanged:function(){if(this._currentGrouping!=this._grouping)return!0;if(!this._accounts)return;for(var e=0,t,n,r,i,s;e<this._accounts.length;e++){n=this._accounts[e],s=n.cid==null?"":n.cid,i=this.$("#sf-account-group-"+n.key+"-"+s).prop("checked");if(n.selected!=i)return!0;for(t=0;t<n.elements.length;t++){r=n.elements[t],s=r.cid==null?"":r.cid,i=this.$("#sf-account-"+r.accountPK+"-"+s).prop("checked");if(r.viewFilter!=i)return!0}}return!1},serializeData:function(){return{grouping:this._currentGrouping,cid:this.cid}},onClose:function(){this._undelegateServiceResults()},saveAccountSelection:function(){if(!this.hasChanged())return!1;var e=this,n={selection:this._getCurrentSelection(),grouping:this._currentGrouping};return this._currentSelection=n.selection,t.when(this.accountsService.saveAccountSelection(n)).done(function(){console.log("[AccountFilterModule] accounts configuration saved"),e._grouping=e._currentGrouping,e._accounts=e.accounts=e._applyCurrentSelection(e._accounts),e.$(".sf-account-config-save").addClass("sf-disabled")}).fail(function(t){console.error("[AccountFilterModule] accounts savings configuration",t),e.publish("error",t)}),!0},_groupByChange:function(e){var t=i(e.currentTarget).data("grouping-option");this._currentGrouping!==t&&this.getData(t)},_undelegateServiceResults:function(){this.accountsResultObject&&this.accountsResultObject.dispose()},getData:function(e){var n=this,r=!arguments.length;t.when(this.accountsService.getAccountList(e)).done(function(e){r&&(n._grouping=e.data.grouping),n._dataReceived(e)}).fail(function(e){console.error("[AccountFilterModule] accounts retrieval error",e),n.publish("error",e)})},_applyCurrentSelection:function(e){if(!this._currentSelection){var n=this.config.providerAccId;return n?t.map(e,function(e){var r=!0;return t.map(e.elements,function(e){return e.viewFilter=n.toString()===e.providerId,e.viewFilter===!1&&(r=!1),e},this),e.selected=r,e},this):e}return t.map(e,function(e){var n=!0;return t.map(e.elements,function(e){return e.viewFilter=t.contains(this._currentSelection.selected,e.accountPK),e.viewFilter===!1&&(n=!1),e},this),e.selected=n,e},this)},_accountGroupSelectionChanged:function(e){var n=i(e.currentTarget),r=n.closest(".sf-account-group").find("input.sf-account-selector");t.each(r.prop("checked",n.prop("checked")),function(e){i(e).data("ReForm.Checkbox").update()}),this._accountsSelectionChanged()},_accountsSelectionChanged:function(){this._currentSelection=this._getCurrentSelection(),this.publish("filters:change",{filter:"accounts",data:this._currentSelection}),this._updateAccountGroupSelection()},_updateAccountGroupSelection:function(){t.each(this.$(".sf-account-group"),function(e){var t=i(e),n=t.find("input.sf-account-selector"),r=!0,s=t.find("input.sf-account-group-selector");for(var o=0;o<n.length;o++)if(!i(n[o]).prop("checked")){r=!1;break}s.prop("checked",r),s.data("ReForm.Checkbox").update()}),this._updateSaveButtonStatus()},_getCurrentSelection:function(){return{selected:t.map(this.$el.find("input.sf-account-selector:checked"),function(e){return i(e).data("accountpk")}),unselected:t.map(this.$el.find("input.sf-account-selector:not(:checked)"),function(e){return i(e).data("accountpk")})}},_dataReceived:function(e){console.log("[Accounts filter module] Accounts data received"),this._undelegateServiceResults(),this.accountsResultObject=e,this.accountsResultObject.on("change",this._dataChanged),this._currentGrouping=e.data.grouping,this._accounts=e.data.accounts,this.accounts=this._applyCurrentSelection(e.data.accounts),this.updateView(),this._currentSelection=this._getCurrentSelection()},_dataChanged:function(e){console.log("[Accounts filter module] Accounts data changed"),this._currentGrouping=e.data.grouping,this._accounts=e.data.accounts,this._currentSelection=null,this.accounts=this._applyCurrentSelection(e.data.accounts),this.updateView(),this._accountsSelectionChanged()}},{ID:"accounts-filter",defaults:{grouping:r.ENTITY_GROUPING}});return a}),define("hbs!modules/accounts-filter/extensions/accounts-filter-dropdown/templates/accounts-filter-dropdown",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i;r+="\n		",(i=n.content)?i=i.call(e,{hash:{}}):(i=e.content,i=typeof i===f?i.apply(e):i);if(i||i===0)r+=i;return r+="\n	",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f="function",l=n.helperMissing,c=this.escapeExpression,h=this;s+='<span class="sf-accounts-filter sf-accounts-filter-dropdown">\n	<div class="sf-accounts-filter-label">',a={hash:{}},s+=c((o=n.t,o?o.call(t,"accounts-filter.label",a):l.call(t,"t","accounts-filter.label",a)))+"</div>\n	",a={hash:{title:"{{title}}"},inverse:h.noop,fn:h.program(1,p,i)},u=(o=n.dropdown,o?o.call(t,a):l.call(t,"dropdown",a));if(u||u===0)s+=u;return s+="\n</span>",s});return t.registerPartial("modules_accounts-filter_extensions_accounts-filter-dropdown_templates_accounts-filter-dropdown",n),n}),define("libs/require/css/css!modules/accounts-filter/extensions/accounts-filter-dropdown/css/accounts-filter-dropdown",[],function(){}),define("modules/accounts-filter/extensions/accounts-filter-dropdown/accounts-filter-dropdown-module",["modules/accounts-filter/accounts-filter-module","hbs!modules/accounts-filter/templates/accounts-filter","hbs!modules/accounts-filter/extensions/accounts-filter-dropdown/templates/accounts-filter-dropdown","ui/modules/dropdown/dropdown-module","utils/util","utils/i18n","css!modules/accounts-filter/extensions/accounts-filter-dropdown/css/accounts-filter-dropdown"],function(e,t,n,r,i){var s=e.extend({dropdown:null,template:n,initialize:function(){this._super.apply(this,arguments),this.events["click .sf-account-config-save"]="_closeDropDown"},onRender:function(){this._super(),this._renderDropdown(),this._updateTitle()},_renderDropdown:function(){this.dropdown=new r({$el:this.$el,$container:this.options.$popupContainer})},updateView:function(){this._super(),this._updateTitle()},serializeData:function(){return{content:t({grouping:this._currentGrouping})}},_accountsSelectionChanged:function(){this._super(),this._updateTitle()},_updateTitle:function(){var e;this.dropdown&&(e=this.accountsService.getAccountsSelectionTotals(this.accounts,this._currentSelection),e.total===e.selected?this._currentTitle=i.i18n.get("accounts-filter.allAccounts"):this._currentTitle=i.i18n.get("accounts-filter.title",e),this.dropdown.updateLabel(this._currentTitle))},_closeDropDown:function(){this.saveAccountSelection()&&this.dropdown&&this.dropdown.close()}},{submodules:[r]});return s}),define("hbs!ui/modules/timerange-filter/templates/timerange-filter",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function h(e,t){var r="",i;return r+='\n		<a href="javascript:void(0);" class="sf-predefined-selection" data-from="',(i=n.from)?i=i.call(e,{hash:{},data:t}):(i=e.from,i=typeof i===a?i.apply(e):i),r+=f(i)+'" data-to="',(i=n.to)?i=i.call(e,{hash:{},data:t}):(i=e.to,i=typeof i===a?i.apply(e):i),r+=f(i)+'">',(i=n.label)?i=i.call(e,{hash:{},data:t}):(i=e.label,i=typeof i===a?i.apply(e):i),r+=f(i)+"</a>\n	",r}function p(e,t,r){var i="",s,o,u;i+='\n			<option value="'+f((s=t.index,typeof s===a?s.apply(e):s))+'"',u={hash:{},inverse:l.noop,fn:l.program(4,d,t),data:t},o=(s=n.ifequal,s?s.call(e,e.date,r.from,u):c.call(e,"ifequal",e.date,r.from,u));if(o||o===0)i+=o;return i+=' data-date="',(o=n.backendFormattedDate)?o=o.call(e,{hash:{},data:t}):(o=e.backendFormattedDate,o=typeof o===a?o.apply(e):o),i+=f(o)+'">',(o=n.formattedDate)?o=o.call(e,{hash:{},data:t}):(o=e.formattedDate,o=typeof o===a?o.apply(e):o),i+=f(o)+"</option>\n		",i}function d(e,t){return' selected="selected"'}function v(e,t,r){var i="",s,o,u;i+='\n			<option value="'+f((s=t.index,typeof s===a?s.apply(e):s))+'"',u={hash:{},inverse:l.noop,fn:l.program(4,d,t),data:t},o=(s=n.ifequal,s?s.call(e,e.date,r.to,u):c.call(e,"ifequal",e.date,r.to,u));if(o||o===0)i+=o;return i+=' data-date="',(o=n.backendFormattedDate)?o=o.call(e,{hash:{},data:t}):(o=e.backendFormattedDate,o=typeof o===a?o.apply(e):o),i+=f(o)+'">',(o=n.formattedDate)?o=o.call(e,{hash:{},data:t}):(o=e.formattedDate,o=typeof o===a?o.apply(e):o),i+=f(o)+"</option>\n		",i}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=this,c=n.helperMissing;s+='<div class="sf-timerange-filter">\n	<div class="sf-predefined-selections">\n	',o=n.each.call(t,t.predefinedSelections,{hash:{},inverse:l.noop,fn:l.program(1,h,i),data:i});if(o||o===0)s+=o;s+='\n	</div>\n	<div class="sf-reform-timerange-slider sf-reform-timerange-slider-',(o=n.stepScale)?o=o.call(t,{hash:{},data:i}):(o=t.stepScale,o=typeof o===a?o.apply(t):o),s+=f(o)+'" data-maxsteps="',(o=n.maxRangeSteps)?o=o.call(t,{hash:{},data:i}):(o=t.maxRangeSteps,o=typeof o===a?o.apply(t):o),s+=f(o)+'" data-scale="',(o=n.stepScale)?o=o.call(t,{hash:{},data:i}):(o=t.stepScale,o=typeof o===a?o.apply(t):o),s+=f(o)+'" data-day="'+f((o=(o=t.reform,o==null||o===!1?o:o.dayLabelsFormat),typeof o===a?o.apply(t):o))+'" data-month="'+f((o=(o=t.reform,o==null||o===!1?o:o.monthLabelsFormat),typeof o===a?o.apply(t):o))+'" data-year="'+f((o=(o=t.reform,o==null||o===!1?o:o.yearLabelsFormat),typeof o===a?o.apply(t):o))+'">\n		<select class="sf-timerange-from">\n		',u=n.each.call(t,t.fromDates,{hash:{},inverse:l.noop,fn:l.programWithDepth(p,i,t),data:i});if(u||u===0)s+=u;s+='\n		</select>\n		<select class="sf-timerange-to">\n		',u=n.each.call(t,t.toDates,{hash:{},inverse:l.noop,fn:l.programWithDepth(v,i,t),data:i});if(u||u===0)s+=u;return s+='\n		</select>\n		<div class="sf-reform-timerange-slider-placeholder"></div>\n		<div class="sf-reform-timerange-labels-placeholder"></div>\n	</div>\n</div>',s});return t.registerPartial("ui_modules_timerange-filter_templates_timerange-filter",n),n}),define("hbs!ui/modules/timerange-filter/templates/timerange-filter-inline",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression;s+='<div class="sf-timerange-filter sf-timerange-filter-inline">\n	<div class="sf-timerange-title">',(o=n.title)?o=o.call(t,{hash:{}}):(o=t.title,o=typeof o===u?o.apply(t):o),s+=a(o)+"</div>\n	",(o=n.content)?o=o.call(t,{hash:{}}):(o=t.content,o=typeof o===u?o.apply(t):o);if(o||o===0)s+=o;return s+="\n</div>",s});return t.registerPartial("ui_modules_timerange-filter_templates_timerange-filter-inline",n),n}),define("hbs!ui/modules/reform/timerange-slider/templates/timerange-slider-label",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){return"sf-disabled"}function d(e,t){return" sf-label-month-new"}function v(e,t){return" sf-label-year-new"}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=this,l="function",c=this.escapeExpression,h=n.helperMissing;s+='<div class="sf-label ',o=n["if"].call(t,t.disabled,{hash:{},inverse:f.noop,fn:f.program(1,p,i)});if(o||o===0)s+=o;s+='" style="',(o=n.postionDir)?o=o.call(t,{hash:{}}):(o=t.postionDir,o=typeof o===l?o.apply(t):o),s+=c(o)+": ",(o=n.postionPct)?o=o.call(t,{hash:{}}):(o=t.postionPct,o=typeof o===l?o.apply(t):o),s+=c(o)+"%; width: ",(o=n.width)?o=o.call(t,{hash:{}}):(o=t.width,o=typeof o===l?o.apply(t):o),s+=c(o)+'%;">\n	<div class="sf-label-day">',a={hash:{}},s+=c((o=n.formatDate,o?o.call(t,t.date,t.dayLabelsFormat,a):h.call(t,"formatDate",t.date,t.dayLabelsFormat,a)))+'</div>\n	<div class="sf-label-month',u=n["if"].call(t,t.newMonth,{hash:{},inverse:f.noop,fn:f.program(3,d,i)});if(u||u===0)s+=u;s+='">',a={hash:{}},s+=c((o=n.formatDate,o?o.call(t,t.date,t.monthLabelsFormat,a):h.call(t,"formatDate",t.date,t.monthLabelsFormat,a)))+'</div>\n	<div class="sf-label-year',u=n["if"].call(t,t.newYear,{hash:{},inverse:f.noop,fn:f.program(5,v,i)});if(u||u===0)s+=u;return s+='">',a={hash:{}},s+=c((o=n.formatDate,o?o.call(t,t.date,t.yearLabelsFormat,a):h.call(t,"formatDate",t.date,t.yearLabelsFormat,a)))+"</div>\n</div>",s});return t.registerPartial("ui_modules_reform_timerange-slider_templates_timerange-slider-label",n),n}),define("libs/nouislider/nouislider",["jQuery"],function(e){function n(e){return t.grep(e,function(n,r){return r===t.inArray(n,e)})}function r(e,t){return Math.round(e/t)*t}function i(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)}function s(e){var t=Math.pow(10,7);return Number((Math.round(e*t)/t).toFixed(7))}function o(e,t,n){e.addClass(t),setTimeout(function(){e.removeClass(t)},n)}function u(e){return Math.max(Math.min(e,100),0)}function a(e){return t.isArray(e)?e:[e]}function f(e){var t=e.split(".");return t.length>1?t[1].length:0}function v(e,t){return 100/(t-e)}function m(e,t){return t*100/(e[1]-e[0])}function g(e,t){return m(e,e[0]<0?t+Math.abs(e[0]):t-e[0])}function y(e,t){return t*(e[1]-e[0])/100+e[0]}function b(e,t){var n=1;while(e>=t[n])n+=1;return n}function w(e,t,n){if(n>=e.slice(-1)[0])return 100;var r=b(n,e),i,s,o,u;return i=e[r-1],s=e[r],o=t[r-1],u=t[r],o+g([i,s],n)/v(o,u)}function E(e,t,n){if(n>=100)return e.slice(-1)[0];var r=b(n,t),i,s,o,u;return i=e[r-1],s=e[r],o=t[r-1],u=t[r],y([i,s],(n-o)*v(o,u))}function S(e,t,n,i){if(i===100)return i;var s=b(i,e),o,u;return n?(o=e[s-1],u=e[s],i-o>(u-o)/2?u:o):t[s-1]?e[s-1]+r(i-e[s-1],t[s-1]):i}function x(e,t,n){var r;typeof t=="number"&&(t=[t]);if(Object.prototype.toString.call(t)!=="[object Array]")throw new Error("noUiSlider: 'range' contains invalid value.");e==="min"?r=0:e==="max"?r=100:r=parseFloat(e);if(!i(r)||!i(t[0]))throw new Error("noUiSlider: 'range' value isn't numeric.");n.xPct.push(r),n.xVal.push(t[0]),r?n.xSteps.push(isNaN(t[1])?!1:t[1]):isNaN(t[1])||(n.xSteps[0]=t[1])}function T(e,t,n){if(!t)return!0;n.xSteps[e]=m([n.xVal[e],n.xVal[e+1]],t)/v(n.xPct[e],n.xPct[e+1])}function N(e,t,n,r){this.xPct=[],this.xVal=[],this.xSteps=[r||!1],this.xNumSteps=[!1],this.snap=t,this.direction=n;var i,s=[];for(i in e)e.hasOwnProperty(i)&&s.push([e[i],i]);s.sort(function(e,t){return e[0]-t[0]});for(i=0;i<s.length;i++)x(s[i][1],s[i][0],this);this.xNumSteps=this.xSteps.slice(0);for(i=0;i<this.xNumSteps.length;i++)T(i,this.xNumSteps[i],this)}function k(e,t){if(!i(t))throw new Error("noUiSlider: 'step' is not numeric.");e.singleStep=t}function L(e,n){if(typeof n!="object"||t.isArray(n))throw new Error("noUiSlider: 'range' is not an object.");if(n.min===undefined||n.max===undefined)throw new Error("noUiSlider: Missing 'min' or 'max' in 'range'.");e.spectrum=new N(n,e.snap,e.dir,e.singleStep)}function A(e,n){n=a(n);if(!t.isArray(n)||!n.length||n.length>2)throw new Error("noUiSlider: 'start' option is incorrect.");e.handles=n.length,e.start=n}function O(e,t){e.snap=t;if(typeof t!="boolean")throw new Error("noUiSlider: 'snap' option must be a boolean.")}function M(e,t){e.animate=t;if(typeof t!="boolean")throw new Error("noUiSlider: 'animate' option must be a boolean.")}function _(e,t){if(t==="lower"&&e.handles===1)e.connect=1;else if(t==="upper"&&e.handles===1)e.connect=2;else if(t===!0&&e.handles===2)e.connect=3;else{if(t!==!1)throw new Error("noUiSlider: 'connect' option doesn't match handle count.");e.connect=0}}function D(e,t){switch(t){case"horizontal":e.ort=0;break;case"vertical":e.ort=1;break;default:throw new Error("noUiSlider: 'orientation' option is invalid.")}}function P(e,t){if(!i(t))throw new Error("noUiSlider: 'margin' option must be numeric.");e.margin=e.spectrum.getMargin(t);if(!e.margin)throw new Error("noUiSlider: 'margin' option is only supported on linear sliders.")}function H(e,t){if(!i(t))throw new Error("noUiSlider: 'limit' option must be numeric.");e.limit=e.spectrum.getMargin(t);if(!e.limit)throw new Error("noUiSlider: 'limit' option is only supported on linear sliders.")}function B(e,t){switch(t){case"ltr":e.dir=0;break;case"rtl":e.dir=1,e.connect=[0,2,1,3][e.connect];break;default:throw new Error("noUiSlider: 'direction' option was not recognized.")}}function j(e,t){if(typeof t!="string")throw new Error("noUiSlider: 'behaviour' must be a string containing options.");var n=t.indexOf("tap")>=0,r=t.indexOf("drag")>=0,i=t.indexOf("fixed")>=0,s=t.indexOf("snap")>=0;e.events={tap:n||s,drag:r,fixed:i,snap:s}}function F(e,t){e.format=t;if(typeof t.to=="function"&&typeof t.from=="function")return!0;throw new Error("noUiSlider: 'format' requires 'to' and 'from' methods.")}function I(e){var n={margin:0,limit:0,animate:!0,format:C},r;return r={step:{r:!1,t:k},start:{r:!0,t:A},connect:{r:!0,t:_},direction:{r:!0,t:B},snap:{r:!1,t:O},animate:{r:!1,t:M},range:{r:!0,t:L},orientation:{r:!1,t:D},margin:{r:!1,t:P},limit:{r:!1,t:H},behaviour:{r:!0,t:j},format:{r:!1,t:F}},e=t.extend({connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal"},e),t.each(r,function(t,r){if(e[t]===undefined){if(r.r)throw new Error("noUiSlider: '"+t+"' is required.");return!0}r.t(n,e[t])}),n.style=n.ort?"top":"left",n}function q(e,t,n){var r=e+t[0],i=e+t[1];return n?(r<0&&(i+=Math.abs(r)),i>100&&(r-=i-100),[u(r),u(i)]):[r,i]}function R(e){e.preventDefault();var t=e.type.indexOf("touch")===0,n=e.type.indexOf("mouse")===0,r=e.type.indexOf("pointer")===0,i,s,o=e;e.type.indexOf("MSPointer")===0&&(r=!0),e.originalEvent&&(e=e.originalEvent),t&&(i=e.changedTouches[0].pageX,s=e.changedTouches[0].pageY);if(n||r)!r&&window.pageXOffset===undefined&&(window.pageXOffset=document.documentElement.scrollLeft,window.pageYOffset=document.documentElement.scrollTop),i=e.clientX+window.pageXOffset,s=e.clientY+window.pageYOffset;return o.points=[i,s],o.cursor=n,o}function U(e,n){var r=t("<div><div/></div>").addClass(d[2]),i=["-lower","-upper"];return e&&i.reverse(),r.children().addClass(d[3]+" "+d[3]+i[n]),r}function z(e,t,n){switch(e){case 1:t.addClass(d[7]),n[0].addClass(d[6]);break;case 3:n[1].addClass(d[6]);case 2:n[0].addClass(d[7]);case 0:t.addClass(d[6])}}function W(e,t,n){var r,i=[];for(r=0;r<e;r+=1)i.push(U(t,r).appendTo(n));return i}function X(e,n,r){return r.addClass([d[0],d[8+e],d[4+n]].join(" ")),t("<div/>").appendTo(r).addClass(d[1])}function V(e,n,r){function b(){return c[["width","height"][n.ort]]()}function w(e){var t,n=[i.val()];for(t=0;t<e.length;t+=1)i.trigger(e[t],n)}function E(e){return e.length===1?e[0]:n.dir?e.reverse():e}function S(e){return function(t,n){i.val([e?null:n,e?n:null],!0)}}function x(e){var n=t.inArray(e,y);i[0].linkAPI&&i[0].linkAPI[e]&&i[0].linkAPI[e].change(g[n],v[n].children(),i)}function T(e,r){var i=t.inArray(e,y);return r&&r.appendTo(v[i].children()),n.dir&&n.handles>1&&(i=i===1?0:1),S(i)}function N(){var e,t;for(e=0;e<y.length;e+=1)this.linkAPI&&this.linkAPI[t=y[e]]&&this.linkAPI[t].reconfirm(t)}function C(e,t,r,s){return e=e.replace(/\s/g,h+" ")+h,t.on(e,function(e){if(!!i.attr("disabled"))return!1;if(i.hasClass(d[14]))return!1;e=R(e),e.calcPoint=e.points[n.ort],r(e,s)})}function k(e,t){var n=t.handles||v,r,i=!1,s=(e.calcPoint-t.start)*100/b(),o=n[0][0]!==v[0][0]?1:0;r=q(s,t.positions,n.length>1),i=_(n[0],r[o],n.length===1),n.length>1&&(i=_(n[1],r[o?0:1],!1)||i),i&&w(["slide"])}function L(e){t("."+d[15]).removeClass(d[15]),e.cursor&&t("body").css("cursor","").off(h),l.off(h),i.removeClass(d[12]),w(["set","change"])}function A(e,n){n.handles.length===1&&n.handles[0].children().addClass(d[15]),e.stopPropagation(),C(p.move,l,k,{start:e.calcPoint,handles:n.handles,positions:[s[0],s[v.length-1]]}),C(p.end,l,L,null),e.cursor&&(t("body").css("cursor",t(e.target).css("cursor")),v.length>1&&i.addClass(d[12]),t("body").on("selectstart"+h,!1))}function O(e){var r=e.calcPoint,s=0,u;e.stopPropagation(),t.each(v,function(){s+=this.offset()[n.style]}),s=r<s/2||v.length===1?0:1,r-=c.offset()[n.style],u=r*100/b(),n.events.snap||o(i,d[14],300),_(v[s],u),w(["slide","set","change"]),n.events.snap&&A(e,{handles:[v[s]]})}function M(e){var t,n;if(!e.fixed)for(t=0;t<v.length;t+=1)C(p.start,v[t].children(),A,{handles:[v[t]]});e.tap&&C(p.start,c,O,{handles:v}),e.drag&&(n=c.find("."+d[7]).addClass(d[10]),e.fixed&&(n=n.add(c.children().not(n).children())),C(p.start,n,A,{handles:v}))}function _(e,t,r){var i=e[0]!==v[0][0]?1:0,o=s[0]+n.margin,a=s[1]-n.margin,f=s[0]+n.limit,l=s[1]-n.limit;return v.length>1&&(t=i?Math.max(t,o):Math.min(t,a)),r!==!1&&n.limit&&v.length>1&&(t=i?Math.min(t,f):Math.max(t,l)),t=m.getStep(t),t=u(parseFloat(t.toFixed(7))),t===s[i]?!1:(e.css(n.style,t+"%"),e.is(":first-child")&&e.toggleClass(d[17],t>50),s[i]=t,g[i]=m.fromStepping(t),x(y[i]),!0)}function D(e,t){var r,i,s;n.limit&&(e+=1);for(r=0;r<e;r+=1)i=r%2,s=t[i],s!==null&&s!==!1&&(typeof s=="number"&&(s=String(s)),s=n.format.from(s),(s===!1||isNaN(s)||_(v[i],m.toStepping(s),r===3-n.dir)===!1)&&x(y[i]))}function P(e){if(i[0].LinkIsEmitting)return this;var t,r=a(e);return n.dir&&n.handles>1&&r.reverse(),n.animate&&s[0]!==-1&&o(i,d[14],300),t=v.length>1?3:1,r.length===1&&(t=1),D(t,r),w(["set"]),this}function H(){var e,t=[];for(e=0;e<n.handles;e+=1)t[e]=n.format.to(g[e]);return E(t)}function B(){return t(this).off(h).removeClass(d.join(" ")).empty(),delete this.LinkUpdate,delete this.LinkConfirm,delete this.LinkDefaultFormatter,delete this.LinkDefaultFlag,delete this.reappend,delete this.vGet,delete this.vSet,delete this.getCurrentStep,delete this.getInfo,delete this.destroy,r}function j(){var e=t.map(s,function(e,t){var n=m.getApplicableStep(e),r=f(String(n[2])),i=g[t],s=e===100?null:n[2],o=Number((i-n[2]).toFixed(r)),u=e===0?null:o>=n[1]?n[2]:n[0]||!1;return[[u,s]]});return E(e)}function F(){return r}var i=t(e),s=[-1,-1],c,v,m=n.spectrum,g=[],y=["lower","upper"].slice(0,n.handles);n.dir&&y.reverse(),e.LinkUpdate=x,e.LinkConfirm=T,e.LinkDefaultFormatter=n.format,e.LinkDefaultFlag="lower",e.reappend=N;if(i.hasClass(d[0]))throw new Error("Slider was already initialized.");c=X(n.dir,n.ort,i),v=W(n.handles,n.dir,c),z(n.connect,i,v),M(n.events),e.vSet=P,e.vGet=H,e.destroy=B,e.getCurrentStep=j,e.getOriginalOptions=F,e.getInfo=function(){return[m,n.style,n.ort]},i.val(n.start)}function $(e){var t=I(e,this);return this.each(function(){V(this,t,e)})}function J(e){return this.each(function(){if(!this.destroy){t(this).noUiSlider(e);return}var n=t(this).val(),r=this.destroy(),i=t.extend({},r,e);t(this).noUiSlider(i),this.reappend(),r.start===i.start&&t(this).val(n)})}function K(){return this[0][arguments.length?"vSet":"vGet"].apply(this[0],arguments)}var t=e;"use strict";var l=t(document),c=t.fn.val,h=".nui",p=window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"},d=["noUi-target","noUi-base","noUi-origin","noUi-handle","noUi-horizontal","noUi-vertical","noUi-background","noUi-connect","noUi-ltr","noUi-rtl","noUi-dragable","","noUi-state-drag","","noUi-state-tap","noUi-active","","noUi-stacking"];N.prototype.getMargin=function(e){return this.xPct.length===2?m(this.xVal,e):!1},N.prototype.toStepping=function(e){return e=w(this.xVal,this.xPct,e),this.direction&&(e=100-e),e},N.prototype.fromStepping=function(e){return this.direction&&(e=100-e),s(E(this.xVal,this.xPct,e))},N.prototype.getStep=function(e){return this.direction&&(e=100-e),e=S(this.xPct,this.xSteps,this.snap,e),this.direction&&(e=100-e),e},N.prototype.getApplicableStep=function(e){var t=b(e,this.xPct),n=e===100?2:1;return[this.xNumSteps[t-2],this.xVal[t-n],this.xNumSteps[t-n]]},N.prototype.convert=function(e){return this.getStep(this.toStepping(e))};var C={to:function(e){return e.toFixed(2)},from:Number};t.fn.val=function(e){function n(e){return e.hasClass(d[0])?K:c}if(!arguments.length){var r=t(this[0]);return n(r).call(r)}var i=t.isFunction(e);return this.each(function(r){var s=e,o=t(this);i&&(s=e.call(this,r,o.val())),n(o).call(o,s)})},t.fn.noUiSlider=function(e,t){switch(e){case"step":return this[0].getCurrentStep();case"options":return this[0].getOriginalOptions()}return(t?J:$).call(this,e)}}),define("libs/require/css/css!ui/modules/reform/timerange-slider/css/timerange-slider",[],function(){}),define("ui/modules/reform/timerange-slider/timerange-slider-module",["classes/reform-plugin","classes/reform","jQuery","utils/util","hbs!ui/modules/reform/timerange-slider/templates/timerange-slider-label","utils/constants","libs/nouislider/nouislider","css!ui/modules/reform/timerange-slider/css/timerange-slider","utils/date"],function(e,t,n,r,i){return t.TimerangeSlider=e.extend({events:{"change .sf-reform-timerange-slider-placeholder":"_onChange","keyup .sf-reform-timerange-slider-placeholder .noUi-handle":"_onKeyup","change .sf-original":"_onOriginalChange"},initialize:function(){var e=this;e._super.apply(e,arguments),e.$slider=e.$(".sf-reform-timerange-slider-placeholder"),e._scale=e.$slider.data("scale")||e.config.scale,e._maxSteps=e.$el.data("maxsteps")||e.config.maxSteps,e._dayLabelsFormat=e.$el.data("day")||e.config.dayLabelsFormat,e._monthLabelsFormat=e.$el.data("month")||e.config.monthLabelsFormat,e._yearLabelsFormat=e.$el.data("year")||e.config.yearLabelsFormat;var t=parseInt(e.$originalFrom.find("option:first").val(),10),n=parseInt(e.$originalFrom.find("option:last").val(),10)+1,r=e._getFromValue(),i=e._getToValue(),s=this.config.textDirection,o=this.config.axisDirection;o=="auto"&&(o=s),e.axisRTL=o=="rtl",e.$el.addClass("sf-axis-"+o),e.from=r,e.to=i,e.$slider.noUiSlider({range:{min:[t],max:[n]},start:[r,i],connect:!0,step:1,direction:o,slide:function(){e._updateSelectedLabels()}}),e.$slider.find(".noUi-handle").attr("tabindex",0),e._drawLabels(),e._updateSelectedLabels()},_ensureElement:function(){this.$el=this.options.$el,this.$originalFrom=this.$el.find(this.constructor.ORIGINAL_SELECTOR_FROM),this.$originalTo=this.$el.find(this.constructor.ORIGINAL_SELECTOR_TO),this.cid=r.uniqueId(this.constructor.ID+"-"),this.$el.attr("id",this.cid),this.$originalFrom.addClass("sf-original"),this.$originalTo.addClass("sf-original"),this.$originalFrom.data(this.constructor.REFORM_ID,this),this.$originalTo.data(this.constructor.REFORM_ID,this),this.$el.data("ReForm",!0)},_onOriginalChange:function(e,t){if(t==="slider")return;var n=this;clearTimeout(this._triggerChangeTimeout),this._triggerChangeTimeout=setTimeout(function(){n.update(),n.trigger("change")},10)},_onChange:function(){var e=this.$slider.val(),t=parseInt(e[0],10),n=parseInt(e[1],10);t===n&&(this.from===t?n+=1:t-=1,this.$slider.val([t,n])),n-=1,this.from=t,this.to=n,this._updateSelectedLabels(),this.$originalTo.find("option:eq("+n+")").prop("selected","selected"),this.$originalTo.trigger("change","slider"),this.$originalFrom.find("option:eq("+t+")").prop("selected","selected"),this.$originalFrom.trigger("change","slider")},_onKeyup:function(e){if(e.keyCode!==undefined)switch(e.keyCode){case r.constants.KEYLEFT:e.preventDefault(),e.stopPropagation(),this._subtractSteps(n(e.currentTarget).parent().index(),1);break;case r.constants.KEYRIGHT:e.preventDefault(),e.stopPropagation(),this._addSteps(n(e.currentTarget).parent().index(),1)}},_addSteps:function(e,t,n){var r=this,i=this.$slider.val(),s=parseInt(i[e],10),o=[null,null];o[e]=s+t,r.$slider.val(o),clearTimeout(this._stepsChangedTimeout),this._stepsChangedTimeout=setTimeout(function(){r.$slider.trigger("change")},n||1e3)},_subtractSteps:function(e,t){this._addSteps(e,-t)},_getFromValue:function(){return parseInt(this.$originalFrom.find("option:selected").val(),10)},_getToValue:function(){return parseInt(this.$originalTo.find("option:selected").val(),10)+1},_getRangeDates:function(){var e=[],t=this.$originalFrom.find("option"),i;return r.each(t,function(t){i=n(t),e.push({date:r.date.parseBackendDate(i.data("date")),disabled:i.is(":disabled")})}),e},_drawLabels:function(){this._rangeDates=this._getRangeDates();var e=this,t=null,n=null,s=null,o=null,u=r.size(this._rangeDates),a=100/u,f=e.axisRTL,l;l=r.map(this._rangeDates,function(l,c){var h=l.date;t=r.date.format(h,e._monthLabelsFormat),s=r.date.format(h,e._yearLabelsFormat);var p={postionPct:c/u*100,postionDir:f?"right":"left",width:a,month:r.date.format(h,e._monthLabelsFormat),date:h,dayLabelsFormat:e._dayLabelsFormat,disabled:l.disabled,monthLabelsFormat:e._monthLabelsFormat,yearLabelsFormat:e._yearLabelsFormat,newMonth:t!==n,newYear:s!==o};return n=t,o=s,i(p)}),this.$(".sf-reform-timerange-labels-placeholder").html(l.join(""))},_updateSelectedLabels:function(){var e=this.$slider.val(),t=parseInt(e[0],10),n=parseInt(e[1],10),r=this.$(".sf-reform-timerange-labels-placeholder .sf-label");r.removeClass(this.config.classNames.selected);for(;t<n;t++)r.eq(t)&&r.eq(t).addClass(this.config.classNames.selected)},reinit:function(){this.update()},update:function(){var e=this._getFromValue(),t=this._getToValue();this.$slider.val([e,t]),this._updateSelectedLabels()}},{ID:"sf-reform-timerange-slider",REFORM_ID:"ReForm.TimerangeSlider",SELECTOR:"div.sf-reform-timerange-slider",ORIGINAL_SELECTOR_FROM:"select.sf-timerange-from",ORIGINAL_SELECTOR_TO:"select.sf-timerange-to",SCALE:{DAY:"day",MONTH:"month"},defaults:{classNames:{selected:"sf-selected"},scale:"month",maxSteps:24,dayLabelsFormat:"d",monthLabelsFormat:"MMM",yearLabelsFormat:"yyyy",axisDirection:"auto"}}),t}),define("libs/require/css/css!ui/modules/timerange-filter/css/timerange-filter",[],function(){}),define("ui/modules/timerange-filter/timerange-filter-module",["classes/item-view","utils/util","ui/modules/reform/select/select-module","hbs!ui/modules/timerange-filter/templates/timerange-filter","hbs!ui/modules/timerange-filter/templates/timerange-filter-inline","ui/modules/reform/timerange-slider/timerange-slider-module","utils/date","utils/i18n","css!ui/modules/timerange-filter/css/timerange-filter"],function(e,t,n,r,i){var s=e.extend({template:i,events:{"click a.sf-predefined-selection":"_predefinedSelectionChanged","change select.sf-timerange-from":"_selectionChanged","change select.sf-timerange-to":"_selectionChanged"},filtersList:["datesRange"],innerContent:null,initialize:function(){this._super.apply(this,arguments),this._setup()},onRender:function(){this._super(),n.init(this.$el)},update:function(){this.render()},setConfig:function(e,n){var r=this._fromDate,i=this._toDate;t.merge(this.config,e),this._setup();if(n!==!1){this.update();var s=r&&r.getTime()!==this._fromDate.getTime()||i&&i.getTime()!==this._toDate.getTime();s&&this._publishChange()}},_setup:function(){t.merge(this.config,this.config[this.config.stepScale]),this._stepScale=this.config.stepScale===s.SCALE.MONTH?t.date.constructor.MONTH:t.date.constructor.DAY,this._rangeScale=this.config.rangeScale===s.SCALE.MONTH?t.date.constructor.MONTH:t.date.constructor.DAY,this._dateFormat=this.config.dateFormat,this._reformConfig=this.config.reForm;var e=this._getDate(this.config.maxDate)||t.date.parseBackendDate(this.config.environment.serverDate);this._maxDate=t.date.ceiling(this._stepScale,e);var n=this._getDate(this.config.minDate)||t.date.subtract(this._rangeScale,this._maxDate,this.config.range);this._minDate=t.date.truncate(this._stepScale,n);var r=this._getDate(this.config.toDate)||t.date.parseBackendDate(this.config.environment.serverDate);this._toDate=t.date.ceiling(this._stepScale,r),this._toDate>this._maxDate&&(this._toDate=new Date(this._maxDate.getTime()));var i=this._getDate(this.config.fromDate)||t.date.subtract(this._rangeScale,this._toDate,this.config.rangeSelected-1);this._fromDate=t.date.truncate(this._stepScale,i),this._fromDate<this._minDate&&(this._fromDate=new Date(this._minDate.getTime())),this._steps=t.date.datesInPeriod(this._stepScale,this._minDate,this._maxDate),this._totalSteps=this._steps.length,this._maxRangeSteps=this.config.maxRangeSteps||this._totalSteps,this._predefinedSelections=this._getPredefinedSelections()},serializeData:function(){var e=this;return e.innerContent=r({stepScale:e._stepScale,rangeScale:e._rangeScale,maxRangeSteps:e._maxRangeSteps,from:e._fromDate,to:e._toDate,fromDates:t.map(e._steps,function(n){var r=t.date.truncate(this._stepScale,n);return{date:r,formattedDate:t.date.format(r,e._dateFormat),disabled:r<e._minDate||r>e._maxDate,backendFormattedDate:t.date.format(r,t.date.constructor.BACKEND_FORMAT)}},this),toDates:t.map(e._steps,function(n){var r=t.date.ceiling(this._stepScale,n);return{date:r,formattedDate:t.date.format(r,e._dateFormat),disabled:r<e._minDate||r>e._maxDate,backendFormattedDate:t.date.format(r,t.date.constructor.BACKEND_FORMAT)}},this),predefinedSelections:e._predefinedSelections,reform:e._reformConfig}),{title:t.date.formatSemanticRange(e._fromDate,e._toDate),content:e.innerContent}},_getDate:function(e){return e?t.isDate(e)?e:t.parseBackendDate(e):null},_getPredefinedSelections:function(){var e=this;return t.map(this.config.predefinedSelections,function(n){return{label:t.i18n.get("common.date.semanticRange.predefined-"+n),from:n===0?0:e._totalSteps-n,to:e._totalSteps-1}})},_predefinedSelectionChanged:function(e){var t=this.$(e.currentTarget),n=t.data("from"),r=t.data("to"),i=this.$("select.sf-timerange-from"),s=this.$("select.sf-timerange-to");s.val(r),s.trigger("change"),i.val(n),i.trigger("change")},updateSelectedPredefinedSelection:function(){var e=this.$("a.sf-predefined-selection"),t=parseInt(this.$("select.sf-timerange-from").val(),10),n=parseInt(this.$("select.sf-timerange-to").val(),10),r=0,i=e.length,s;e.removeClass("sf-selected");for(;r<i;r++)s=e.eq(r),parseInt(s.data("from"),10)===t&&parseInt(s.data("to"),10)===n&&s.addClass("sf-selected")},_updateTitle:function(){this.$(".sf-timerange-title").html(t.date.formatSemanticRange(this._fromDate,this._toDate))},_selectionChanged:function(){var e=this;if(!this.config.liveEvents)return;clearTimeout(this._triggerChangeTimeout),this._triggerChangeTimeout=setTimeout(function(){e._publishChange()},10)},_publishChange:function(){var e=t.date.truncate(this._stepScale,this._steps[this.$("select.sf-timerange-from").val()]),n=t.date.ceiling(this._stepScale,this._steps[this.$("select.sf-timerange-to").val()]);if(t.isEqual(this._fromDate,e)&&t.isEqual(this._toDate,n))return;this._fromDate=e,this._toDate=n,this.updateSelectedPredefinedSelection(),this.publish("filters:change",{filter:"datesRange",data:{fromDate:e,toDate:n,skipRefresh:!0}}),this._updateTitle()},_filtersChanged:function(e,t){if(t&&t.skipRefresh)return!1;e==="datesRange"&&this.setConfig(t,!0)}},{ID:"timerange-filter",SCALE:{DAY:"day",MONTH:"month"},defaults:{liveEvents:!0,stepScale:"month",rangeScale:"month",maxRangeSteps:undefined,range:24,rangeSelected:3,minDate:undefined,maxDate:undefined,fromDate:undefined,toDate:undefined,dateFormat:t.date.constructor.MEDIUM_MONTH_YEAR,predefinedSelections:[0,12,6,3,1],day:{rangeType:undefined,range:undefined,dateFormat:t.date.constructor.MEDIUM_DATE},month:{rangeType:undefined,range:undefined,dateFormat:t.date.constructor.MEDIUM_MONTH_YEAR}}});return s}),define("hbs!ui/modules/timerange-filter/extensions/timerange-filter-simple-dropdown/templates/timerange-filter-simple-dropdown",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i;r+="\n				",(i=n.content)?i=i.call(e,{hash:{}}):(i=e.content,i=typeof i===f?i.apply(e):i);if(i||i===0)r+=i;return r+="\n			",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f="function",l=n.helperMissing,c=this.escapeExpression,h=this;s+='<span class="sf-timerange-filter-simple-dropdown">\n	<!--<div class="sf-timerange-filter-label">',a={hash:{}},s+=c((o=n.t,o?o.call(t,"timerange-filter.label",a):l.call(t,"t","timerange-filter.label",a)))+'</div>-->\n	<span class="sf-timerange-filter-simple-selector">\n		',a={hash:{"class":"sf-timerange-filter-period-selector",options:(o=t.selector,o==null||o===!1?o:o.options),currentOption:(o=t.selector,o==null||o===!1?o:o.current)}},s+=c((o=n.select,o?o.call(t,a):l.call(t,"select",a)))+'\n	</span>\n	<span class="sf-timerange-filter sf-timerange-filter-dropdown">\n		<span class="sf-timerange-filter-panel-container">\n			',a={hash:{title:"{{title}}"},inverse:h.noop,fn:h.program(1,p,i)},u=(o=n.dropdown,o?o.call(t,a):l.call(t,"dropdown",a));if(u||u===0)s+=u;return s+="\n		</span>\n	</span>\n</span>",s});return t.registerPartial("ui_modules_timerange-filter_extensions_timerange-filter-simple-dropdown_templates_timerange-filter-simple-dropdown",n),n}),define("libs/require/css/css!ui/modules/timerange-filter/extensions/timerange-filter-simple-dropdown/css/timerange-filter-simple-dropdown",[],function(){}),define("ui/modules/timerange-filter/extensions/timerange-filter-simple-dropdown/timerange-filter-simple-dropdown-module",["ui/modules/timerange-filter/timerange-filter-module","hbs!ui/modules/timerange-filter/extensions/timerange-filter-simple-dropdown/templates/timerange-filter-simple-dropdown","ui/modules/dropdown/dropdown-module","utils/util","utils/i18n","utils/date","css!ui/modules/timerange-filter/extensions/timerange-filter-simple-dropdown/css/timerange-filter-simple-dropdown"],function(e,t,n,r){var i=e.extend({template:t,events:r.extend({},e.prototype.events,{"open .sf-dropdown":"_dropdownOpened","change .sf-timerange-filter-period-selector":"_periodChanged"}),ui:{$selector:"select.sf-timerange-filter-period-selector"},initialize:function(){this._super.apply(this,arguments),this.simpleSelectorOptions=this._getSimpleSelectorOptions(),this.currentOption=this.config.rangeSelected},onRender:function(){var e=this;this._super(),this.dropdown=new n({$el:this.$(".sf-timerange-filter-dropdown"),$container:this.options.$popupContainer}),this.dropdown.on("open",function(){e.$el.find(".noUi-handle-lower").trigger("focus")}).on("close",function(){e.$el.find(".sf-timerange-filter-period-selector").trigger("focus")}),this.updateSelectedPredefinedSelection()},serializeData:function(){return this._super(),{title:r.date.formatSemanticRange(this._fromDate,this._toDate),content:this.innerContent,selector:{options:this.simpleSelectorOptions,current:this.currentOption}}},_periodChanged:function(){var e=this,t=this.ui.$selector.val(),n=t===0?0:this._totalSteps-t,r=this._totalSteps-1,i=this.$("select.sf-timerange-from"),s=this.$("select.sf-timerange-to");return t==="custom"?(setTimeout(function(){e.dropdown.open()},0),this.ui.$selector.val(this.currentOption),this.ui.$selector.data("ReForm.Select").update()):(s.val(r),s.trigger("change"),i.val(n),i.trigger("change")),!1},_getSimpleSelectorOptions:function(){if(r.isMobileBrowser()){var e=this.options.config.itemsToRemove||2;this.config.predefinedSelections.splice(this.config.predefinedSelections.length-e,e)}return r.map(this.config.predefinedSelections,function(e){return e==="custom"?{value:e,name:r.i18n.get("timerange-filter.customRange")}:{value:e,name:r.i18n.get("common.date.semanticRange.predefined-"+e)}})},updateSelectedPredefinedSelection:function(){var e=this.$("a.sf-predefined-selection"),t=parseInt(this.$("select.sf-timerange-from").val(),10),n=parseInt(this.$("select.sf-timerange-to").val(),10),i=r.date.difference("month",this._fromDate,this._toDate)+1,s=r.date.formatSemanticRange(this._fromDate,this._toDate),o=this.ui.$selector.find("option"),u=0,a=e.length,f=!1,l;e.removeClass("sf-selected"),o.length>this.config.predefinedSelections.length&&(o.eq(o.length-2).remove(),this.ui.$selector.data("ReForm.Select").reinit());for(;u<a;u++)l=e.eq(u),parseInt(l.data("from"),10)===t&&parseInt(l.data("to"),10)===n&&(l.addClass("sf-selected"),this.ui.$selector.val(i),this.ui.$selector.data("ReForm.Select").update(),f=!0);f||(o.eq(o.length-1).before("<option value='new'>"+s+"</option>"),this.ui.$selector.data("ReForm.Select").reinit(),this.ui.$selector.val("new"),this.ui.$selector.data("ReForm.Select").update()),this.currentOption=i}},{submodules:[n],defaults:{predefinedSelections:[1,3,6,12,"custom"]}});return i}),define("hbs!widgets/details/templates/details-header",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div>\n	<div class="cam-recommendation-placeholder"></div>\n	',u={hash:{id:"details",title:'{{t "details.title"}}',filtersPlaceholders:t.filtersPlaceholders,summaryPlaceholder:"true"}},s+=f((o=n.header,o?o.call(t,u):a.call(t,"header",u)))+"\n</div>",s});return t.registerPartial("widgets_details_templates_details-header",n),n}),define("widgets/details/views/details-header-view",["classes/layout","utils/util","widgets/details/views/details-summary-view","modules/accounts-filter/accounts-filter-module","ui/modules/timerange-filter/timerange-filter-module","modules/category-selector/category-selector-module","services/transactions-service","hbs!widgets/details/templates/details-header"],function(e,t,n,r,i,s,o,u){var a=e.extend({template:u,filtersList:["category","accounts","datesRange"],regions:{summaryRegion:".sf-summary-placeholder",accountsFilterRegion:".sf-accounts-filter-placeholder",timerangeFilterRegion:".sf-timerange-filter-placeholder"},initialize:function(){this._super.apply(this,arguments),this.transactionsService=o.getInstance()},serializeData:function(){return{filtersPlaceholders:["sf-accounts-filter-placeholder","sf-timerange-filter-placeholder","sf-category-selector-placeholder"]}},_getRangeMonths:function(){return this.config.initialRangeMonths},onRender:function(){this._super(),this.summaryRegion.show(new n(this.contextConfig)),this.accountsFilterRegion.show(new r(this.contextConfig)),this.timerangeFilterRegion.show(new i(t.extend({},this.contextConfig,{config:{rangeSelected:this._getRangeMonths()}}))),this._initCategorySelectorFilter()},_initCategorySelectorFilter:function(){var e={el:this.$(".sf-category-selector-placeholder"),parentCanBeSelected:!0,allOptionsEnabled:!0,disableCustomEdition:!0,classes:"sf-category-select-filter",categories:this.categories,removeUncategorized:!1},n=new s(t.extend(e,this.contextConfig));n.on("categorySelector:selected",function(e){this.publish("filters:change",{filter:"category",data:parseInt(e.id,10)})},this),n.render()}});return a}),define("hbs!modules/rules/templates/rules",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){return'<div class="sf-box sf-rules-list-box"></div>'}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=this,f=n.helperMissing,l=this.escapeExpression;s+='<div class="sf-rules-module">\n		<div class="sf-rules-list">\n            ',o=n["if"].call(t,t.createdRules,{hash:{},inverse:a.noop,fn:a.program(1,c,i)});if(o||o===0)s+=o;return s+='\n			<div class="sf-button-controls">\n				',u={hash:{text:'{{t "rules.button.addRule"}}',type:"button","class":"sf-button-add sf-add-rule-button"}},s+=l((o=n.button,o?o.call(t,u):f.call(t,"button",u)))+'\n			</div>\n		</div>\n		<div class="sf-rules-form"></div>\n</div>',s});return t.registerPartial("modules_rules_templates_rules",n),n}),define("services/rules-service",["classes/service","data/rules/rules-data-manager"],function(e,t){var n=e.extend({initialize:function(){this._super.apply(this,arguments),this.rulesDM=t.getInstance()},getRules:function(e){return e=e||{},this.rulesDM.getRules(e)},createRule:function(e){return this.rulesDM.createRule(e)},previewRule:function(e){return e=e||{},this.rulesDM.previewRule(e)},quickCreateRule:function(e){return e=e||{},this.rulesDM.quickCreateRule(e)},removeRule:function(e){return this.rulesDM.removeRule(e)}},{ID:"rules-service",defaults:{validator:{rules:{rule:{name:{required:!0,rangelength:[4,128],notinlist:"names",type:"alias"},operationFilters:{name:{required:!0,rangelength:[4,128],notinlist:"filters",type:"description"}},autoActions:{name:{required:!0,rangelength:[4,128],type:"description"}}}}}}});return n}),define("hbs!modules/rules/templates/rules-first-filter",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i;return r+='\n		<input type="hidden" name="operationFilters-',(i=n.i)?i=i.call(e,{hash:{}}):(i=e.i,i=typeof i===f?i.apply(e):i),r+=l(i)+'-id" id="operationFilters-',(i=n.i)?i=i.call(e,{hash:{}}):(i=e.i,i=typeof i===f?i.apply(e):i),r+=l(i)+'-id" value="',(i=n.id)?i=i.call(e,{hash:{}}):(i=e.id,i=typeof i===f?i.apply(e):i),r+=l(i)+'" />\n	',r}function d(e,t){return" sf-button-hidden"}function v(e,t){var r,i,s;return s={hash:{},inverse:c.noop,fn:c.program(3,d,t)},i=(r=n.ifequal,r?r.call(e,(r=(r=(r=e.parent,r==null||r===!1?r:r.rule),r==null||r===!1?r:r.operationFilters),r==null||r===!1?r:r.length),1,s):h.call(e,"ifequal",(r=(r=(r=e.parent,r==null||r===!1?r:r.rule),r==null||r===!1?r:r.operationFilters),r==null||r===!1?r:r.length),1,s)),i||i===0?i:""}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<div id="sf-filter-rule-',(o=n.i)?o=o.call(t,{hash:{}}):(o=t.i,o=typeof o===f?o.apply(t):o),s+=l(o)+'" class="sf-filter-rule sf-form-row">\n	',o=n["if"].call(t,t.id,{hash:{},inverse:c.noop,fn:c.program(1,p,i)});if(o||o===0)s+=o;s+='\n	<input type="hidden" name="operationFilters-',(o=n.i)?o=o.call(t,{hash:{}}):(o=t.i,o=typeof o===f?o.apply(t):o),s+=l(o)+'-operator" id="operationFilters-',(o=n.i)?o=o.call(t,{hash:{}}):(o=t.i,o=typeof o===f?o.apply(t):o),s+=l(o)+'-operator" value="CONTAINS" />\n	<input type="hidden" name="operationFilters-',(o=n.i)?o=o.call(t,{hash:{}}):(o=t.i,o=typeof o===f?o.apply(t):o),s+=l(o)+'-type" id="operationFilters-',(o=n.i)?o=o.call(t,{hash:{}}):(o=t.i,o=typeof o===f?o.apply(t):o),s+=l(o)+'-type" value="NAME" />\n	<span class="sf-filter-panel">\n		<span class="sf-filter-connector">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"rules.filter.connector.webWhen",a):h.call(t,"t","rules.filter.connector.webWhen",a)))+"</span>\n		",a={hash:{id:"operationFilters-{{i}}-name",dataFilters:t.filters,name:"operationFilters-{{i}}-name",value:"{{{name}}}",validateField:"rule.operationFilters.name"}},s+=l((o=n.textfield,o?o.call(t,a):h.call(t,"textfield",a)))+'\n	</span>\n	<button class="sf-button sf-button-delete sf-button-delete-filter',u=n["if"].call(t,t.isDefault,{hash:{},inverse:c.program(5,v,i),fn:c.program(3,d,i)});if(u||u===0)s+=u;return s+=' sf-button-reset-style" type="button">\n		<span class="sf-button-icon">\n			<img src="resources/pfm/ui/css/icons/app-icons/dav-budget-trash-can.svg" width="20" height="20" alt="',a={hash:{}},s+=l((o=n.t,o?o.call(t,"rules.filter.common.button.delete",a):h.call(t,"t","rules.filter.common.button.delete",a)))+'">\n		</span>\n		<span class="sf-button-text">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"rules.filter.common.button.delete",a):h.call(t,"t","rules.filter.common.button.delete",a)))+"</span>\n	</button>\n</div>\n",s});return t.registerPartial("modules_rules_templates_rules-first-filter",n),n}),define("hbs!modules/rules/templates/rules-action",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i,s;return r+='<div class="sf-form-row sf-then">',s={hash:{}},r+=l((i=n.t,i?i.call(e,"rules.then",s):f.call(e,"t","rules.then",s)))+"</div>",r}function d(e,t){return" sf-active"}function v(e,t){var r="",i;return r+='\n			<input type="hidden" name="autoActions-',(i=n.i)?i=i.call(e,{hash:{}}):(i=e.i,i=typeof i===c?i.apply(e):i),r+=l(i)+'-id" id="sf-action-id-',(i=n.i)?i=i.call(e,{hash:{}}):(i=e.i,i=typeof i===c?i.apply(e):i),r+=l(i)+'" value="',(i=n.id)?i=i.call(e,{hash:{}}):(i=e.id,i=typeof i===c?i.apply(e):i),r+=l(i)+'" />\n		',r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function",h=this;s+='<div id="sf-auto-action-rule-',(o=n.i)?o=o.call(t,{hash:{}}):(o=t.i,o=typeof o===c?o.apply(t):o),s+=l(o)+'" class="sf-auto-action-rule sf-form-row">\n	<span class="sf-auto-action-panel">\n        ',a={hash:{},inverse:h.noop,fn:h.program(1,p,i)},u=(o=n.ifnequal,o?o.call(t,t.i,1,a):f.call(t,"ifnequal",t.i,1,a));if(u||u===0)s+=u;s+="\n		",a={hash:{id:"autoActions-{{i}}-type",name:"autoActions-{{i}}-type","class":"sf-action-type-select",options:"{{parent.autoActionsOptions}}",currentOption:"{{type}}"}},s+=l((o=n.select,o?o.call(t,a):f.call(t,"select",a)))+'\n		<span id="sf-action-type-option-',(u=n.i)?u=u.call(t,{hash:{}}):(u=t.i,u=typeof u===c?u.apply(t):u),s+=l(u)+'-CAT" class="sf-action-type-option ',a={hash:{},inverse:h.noop,fn:h.program(3,d,i)},u=(o=n.ifequal,o?o.call(t,t.type,"CAT",a):f.call(t,"ifequal",t.type,"CAT",a));if(u||u===0)s+=u;s+=" ",u=n.unless.call(t,t.type,{hash:{},inverse:h.noop,fn:h.program(3,d,i)});if(u||u===0)s+=u;s+='">\n			<span class="sf-categorize-action">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"rules.action.type.webCategorize",a):f.call(t,"t","rules.action.type.webCategorize",a)))+'</span>\n			<span class="sf-auto-action-category-placeholder"></span>\n		</span>\n		<span id="sf-action-type-option-',(u=n.i)?u=u.call(t,{hash:{}}):(u=t.i,u=typeof u===c?u.apply(t):u),s+=l(u)+'-COMP" class="sf-action-type-option ',a={hash:{},inverse:h.noop,fn:h.program(3,d,i)},u=(o=n.ifequal,o?o.call(t,t.type,"COMP",a):f.call(t,"ifequal",t.type,"COMP",a));if(u||u===0)s+=u;s+='">\n			',a={hash:{name:"autoActions-{{i}}-computable",id:"autoActions-{{i}}-computable","class":"sf-action-mark-select",options:"{{parent.computableOptions}}",currentOption:"{{computable}}"}},s+=l((o=n.select,o?o.call(t,a):f.call(t,"select",a)))+'\n			<span class="sf-action-connector sf-mark-computable-connector">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"rules.action.type.webMark",a):f.call(t,"t","rules.action.type.webMark",a)))+'</span>\n		</span>\n		<span id="sf-action-type-option-',(u=n.i)?u=u.call(t,{hash:{}}):(u=t.i,u=typeof u===c?u.apply(t):u),s+=l(u)+'-NAME" class="sf-action-type-option ',a={hash:{},inverse:h.noop,fn:h.program(3,d,i)},u=(o=n.ifequal,o?o.call(t,t.type,"NAME",a):f.call(t,"ifequal",t.type,"NAME",a));if(u||u===0)s+=u;s+='">\n			<span class="sf-action-connector">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"rules.action.connector.rename",a):f.call(t,"t","rules.action.connector.rename",a)))+"</span>\n			",a={hash:{name:"autoActions-{{i}}-name",id:"autoActions-{{i}}-name",value:"{{{name}}}",validateField:"rule.autoActions.name"}},s+=l((o=n.textfield,o?o.call(t,a):f.call(t,"textfield",a)))+"\n		</span>\n		",u=n["if"].call(t,t.id,{hash:{},inverse:h.noop,fn:h.program(5,v,i)});if(u||u===0)s+=u;return s+="\n	</span>\n	",a={hash:{text:'{{t "rules.action.common.button.delete"}}',type:"button","class":"sf-button-delete sf-button-delete-action {{#if isDefault}} sf-button-hidden{{else}}{{#ifequal parent.rule.autoActions.length  1}} sf-button-hidden{{/ifequal}}{{/if}}"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+"\n</div>",s});return t.registerPartial("modules_rules_templates_rules-action",n),n}),define("hbs!modules/rules/templates/rules-form",["hbs","Handlebars","hbs!modules/rules/templates/rules-first-filter","hbs!modules/rules/templates/rules-action"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var i="",s;i+="\n					",s=f.invokePartial(r["modules_rules_templates_rules-first-filter"],"modules_rules_templates_rules-first-filter",e,n,r);if(s||s===0)i+=s;return i+="\n				",i}function d(e,t){var r="",i,s;return r+='\n				<input type="hidden" name="id" id="sf-rule-id" value="'+c((i=(i=e.rule,i==null||i===!1?i:i.id),typeof i===l?i.apply(e):i))+'" />\n				',s={hash:{text:'{{t "rules.button.deleteRule"}}',type:"button","class":"sf-button-delete sf-delete-rule-button",id:"sf-delete-button-{{rule.id}}"}},r+=c((i=n.button,i?i.call(e,s):h.call(e,"button",s)))+"\n			",r}function v(e,t){var i="",s;i+="\n				",s=f.invokePartial(r["modules_rules_templates_rules-action"],"modules_rules_templates_rules-action",e,n,r);if(s||s===0)i+=s;return i+="\n			",i}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,r=r||e.partials;var s="",o,u,a,f=this,l="function",c=this.escapeExpression,h=n.helperMissing;s+='<div class="sf-rule-form-placeholder">\n	<div class="sf-rule-form sf-form-inline" data-validate="parsley">\n		<div class="sf-form-row">\n			<div class="sf-rule-name-wrapper">\n				<label class="spf-label-rule-name" for="name">',a={hash:{}},s+=c((o=n.t,o?o.call(t,"rules.name",a):h.call(t,"t","rules.name",a)))+"</label>\n				",a={hash:{id:"sf-rule-name",name:"name",value:"{{{rule.name}}}",dataNames:"{{{ruleNames}}}",validateField:"rule.name"}},s+=c((o=n.textfield,o?o.call(t,a):h.call(t,"textfield",a)))+'\n			</div>\n			<div class="sf-help-wrapper">\n				<div class="sf-icon-help sf-rules-name-help"></div>\n			</div>\n			<div class="sf-rules-filters-wrapper">\n				',a={hash:{},inverse:f.noop,fn:f.program(1,p,i)},u=(o=n.atLeast,o?o.call(t,(o=t.rule,o==null||o===!1?o:o.operationFilters),a):h.call(t,"atLeast",(o=t.rule,o==null||o===!1?o:o.operationFilters),a));if(u||u===0)s+=u;s+='\n			</div>\n			<div class="sf-help-wrapper">\n				<div class="sf-icon-help sf-rules-description-help"></div>\n			</div>\n			<div class="sf-button-controls sf-button-add-filter-controls">\n				<button class="sf-button sf-button-add sf-button-add-filter" type="button">\n					<span class="sf-button-icon">\n						<img src="resources/pfm/ui/css/icons/app-icons/dav-plus-white.svg" width="12" height="12" alt="',a={hash:{}},s+=c((o=n.t,o?o.call(t,"rules.button.addFilter",a):h.call(t,"t","rules.button.addFilter",a)))+'">\n					</span>\n					<span class="sf-button-text">',a={hash:{}},s+=c((o=n.t,o?o.call(t,"rules.button.addFilter",a):h.call(t,"t","rules.button.addFilter",a)))+'</span>\n				</button>\n			</div>\n			<span class="sf-rules-applies-to">',a={hash:{}},s+=c((o=n.t,o?o.call(t,"rules.appliesTo",a):h.call(t,"t","rules.appliesTo",a)))+"</span>\n			",a={hash:{id:"sf-rule-entId","class":"sf-rules-applies-to-select",options:"{{accounts}}",name:"entId",currentOption:"{{rule.entId}}"}},s+=c((o=n.select,o?o.call(t,a):h.call(t,"select",a)))+"\n			",u=n["if"].call(t,t.rule,{hash:{},inverse:f.noop,fn:f.program(3,d,i)});if(u||u===0)s+=u;s+='\n		</div>\n\n		<div class="sf-rules-actions-box sf-box sf-form-row">\n			',a={hash:{},inverse:f.noop,fn:f.program(5,v,i)},u=(o=n.atLeast,o?o.call(t,(o=t.rule,o==null||o===!1?o:o.autoActions),a):h.call(t,"atLeast",(o=t.rule,o==null||o===!1?o:o.autoActions),a));if(u||u===0)s+=u;return s+='\n			<div  class="sf-button-controls sf-add-action-controls">\n				',a={hash:{text:'{{t "rules.button.addAction"}}',type:"button","class":"sf-button-add sf-button-add-action"}},s+=c((o=n.button,o?o.call(t,a):h.call(t,"button",a)))+'\n			</div>\n\n		</div>\n		<div class="sf-form-row sf-rules-when-wrapper">\n			<div class="sf-rules-when-combo">\n				<span class="sf-rules-when">',a={hash:{}},s+=c((o=n.t,o?o.call(t,"rules.when",a):h.call(t,"t","rules.when",a)))+"</span>\n				",a={hash:{id:"sf-rules-rule-operator","class":"sf-rules-when-select",name:"operator",options:"{{operators}}",currentOption:"{{rule.operator}}"}},s+=c((o=n.select,o?o.call(t,a):h.call(t,"select",a)))+'\n				<span class="sf-rules-conditions-fulfilled">',a={hash:{}},s+=c((o=n.t,o?o.call(t,"rules.conditionsFulfilled",a):h.call(t,"t","rules.conditionsFulfilled",a)))+'</span>\n			</div>\n			<div class="sf-icon-help sf-rules-conditions-help"></div>\n		</div>\n		<div class="sf-button-controls">\n			',a={hash:{text:'{{t "common.button.save"}}',type:"button","class":"sf-button-save sf-button-save-rule"}},s+=c((o=n.button,o?o.call(t,a):h.call(t,"button",a)))+"\n			",a={hash:{text:'{{t "rules.button.back"}}',type:"button","class":"sf-button-back"}},s+=c((o=n.button,o?o.call(t,a):h.call(t,"button",a)))+"\n		</div>\n	</div>\n</div>\n",s});return t.registerPartial("modules_rules_templates_rules-form",n),n}),define("hbs!modules/rules/templates/rules-filter",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i;return r+='\n		<input type="hidden" name="operationFilters-',(i=n.i)?i=i.call(e,{hash:{}}):(i=e.i,i=typeof i===f?i.apply(e):i),r+=l(i)+'-id" id="operationFilters-',(i=n.i)?i=i.call(e,{hash:{}}):(i=e.i,i=typeof i===f?i.apply(e):i),r+=l(i)+'-id" value="',(i=n.id)?i=i.call(e,{hash:{}}):(i=e.id,i=typeof i===f?i.apply(e):i),r+=l(i)+'" />\n	',r}function d(e,t){return" sf-button-hidden"}function v(e,t){var r,i,s;return s={hash:{},inverse:c.noop,fn:c.program(3,d,t)},i=(r=n.ifequal,r?r.call(e,(r=(r=(r=e.parent,r==null||r===!1?r:r.rule),r==null||r===!1?r:r.operationFilters),r==null||r===!1?r:r.length),1,s):h.call(e,"ifequal",(r=(r=(r=e.parent,r==null||r===!1?r:r.rule),r==null||r===!1?r:r.operationFilters),r==null||r===!1?r:r.length),1,s)),i||i===0?i:""}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<div id="sf-filter-rule-',(o=n.i)?o=o.call(t,{hash:{}}):(o=t.i,o=typeof o===f?o.apply(t):o),s+=l(o)+'" class="sf-filter-rule sf-form-row">\n	',o=n["if"].call(t,t.id,{hash:{},inverse:c.noop,fn:c.program(1,p,i)});if(o||o===0)s+=o;s+='\n	<input type="hidden" name="operationFilters-',(o=n.i)?o=o.call(t,{hash:{}}):(o=t.i,o=typeof o===f?o.apply(t):o),s+=l(o)+'-operator" id="operationFilters-',(o=n.i)?o=o.call(t,{hash:{}}):(o=t.i,o=typeof o===f?o.apply(t):o),s+=l(o)+'-operator" value="CONTAINS" />\n	<input type="hidden" name="operationFilters-',(o=n.i)?o=o.call(t,{hash:{}}):(o=t.i,o=typeof o===f?o.apply(t):o),s+=l(o)+'-type" id="operationFilters-',(o=n.i)?o=o.call(t,{hash:{}}):(o=t.i,o=typeof o===f?o.apply(t):o),s+=l(o)+'-type" value="NAME" />\n	<span class="sf-filter-panel">\n		<span class="sf-filter-connector">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"rules.filter.connector.webWhen",a):h.call(t,"t","rules.filter.connector.webWhen",a)))+"</span>\n		",a={hash:{id:"operationFilters-{{i}}-name",dataFilters:t.filters,name:"operationFilters-{{i}}-name",value:"{{{name}}}",validateField:"rule.operationFilters.name"}},s+=l((o=n.textfield,o?o.call(t,a):h.call(t,"textfield",a)))+'\n	</span>\n	<button class="sf-button sf-button-delete sf-button-delete-filter',u=n["if"].call(t,t.isDefault,{hash:{},inverse:c.program(5,v,i),fn:c.program(3,d,i)});if(u||u===0)s+=u;return s+=' sf-button-reset-style" type="button">\n		<span class="sf-button-icon">\n			<img src="resources/pfm/ui/css/icons/app-icons/dav-budget-trash-can.svg" width="20" height="20" alt="',a={hash:{}},s+=l((o=n.t,o?o.call(t,"rules.filter.common.button.delete",a):h.call(t,"t","rules.filter.common.button.delete",a)))+'">\n		</span>\n		<span class="sf-button-text">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"rules.filter.common.button.delete",a):h.call(t,"t","rules.filter.common.button.delete",a)))+"</span>\n	</button>\n</div>\n",s});return t.registerPartial("modules_rules_templates_rules-filter",n),n}),define("hbs!modules/rules/templates/rules-action-select-option",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression;return s+='<option value="',(o=n.value)?o=o.call(t,{hash:{}}):(o=t.value,o=typeof o===u?o.apply(t):o),s+=a(o)+'">',(o=n.name)?o=o.call(t,{hash:{}}):(o=t.name,o=typeof o===u?o.apply(t):o),s+=a(o)+"</option>",s});return t.registerPartial("modules_rules_templates_rules-action-select-option",n),n}),define("modules/rules/rules-form-view",["classes/item-view","services/rules-service","utils/util","ui/modules/reform/select/select-module","modules/category-selector/category-selector-module","ui/modules/popup/popup-module","jQuery","hbs!modules/rules/templates/rules-form","hbs!modules/rules/templates/rules-filter","hbs!modules/rules/templates/rules-action","hbs!modules/rules/templates/rules-action-select-option","utils/i18n","utils/validator"],function(e,t,n,r,i,s,o,u,a,f,l){var c=e.extend({template:u,events:{"change select.sf-action-type-select":"_modifySelectedTypeOption","click .sf-button-delete-filter":"_deleteFilterCell","click .sf-button-delete-action":"_deleteAutoActionCell","click .sf-button-add-filter":"_addFilterCell","click .sf-button-add-action":"_addAutoActionCell","click .sf-delete-rule-button":"_openDeletePopup","submit .sf-rule-form":"_saveRule","keyup .sf-filter-rule":"_filterTextChanged"},triggers:{"click .sf-button-back":"cancel"},ui:{$form:".sf-rule-form"},initialize:function(){this._super.apply(this,arguments),this.rulesService=t.getInstance(),this.autoActionsOptions=[{name:n.i18n.get("rules.action.type.categorize"),value:"CAT"},{name:n.i18n.get("rules.action.type.mark"),value:"COMP"},{name:n.i18n.get("rules.action.type.rename"),value:"NAME"}],this.operators=[{name:n.i18n.get("rules.operator.all"),value:"ALL"},{name:n.i18n.get("rules.operator.any"),value:"ANY"}],this.accounts=n.map(n.pluck(this.options.accounts.toArray(),"attributes"),function(e){return e.value=e.id,n.pick(e,"name","value")}),this.computableOptions=[{name:n.i18n.get("rules.action.value.computable"),value:"true"},{name:n.i18n.get("rules.action.value.nonComputable"),value:"false"}],this.categoryOptions=n.map(this.options.categories.data.categories,function(e){return n.pick(e,"name","value","color","children")}),this.accounts.lenght>1&&(this.newAccount=new Object({name:n.i18n.get("rules.account.all"),value:"-1"}),this.accounts.unshift(this.newAccount))},onRender:function(){this._super(),this._initAllSelects(),r.init(this.$el),this._rebuildActionSelects(this.$("select.sf-action-type-select")),n.validator.validate(this.ui.$form),n.validator.removeItem(this.ui.$form,this.$(".sf-action-type-option")),n.validator.addItem(this.ui.$form,this.$(".sf-action-type-option.sf-active")),this.reloadRuleNamesForValidation(),this.filtersList=[],this._fillFilterList(this.$(".sf-rules-filters-box"))},updateData:function(e){this.rule=e&&e.attributes,this.render()},_openDeletePopup:function(e){var t=o(e.currentTarget),r={$container:this.$el,$opener:t,title:n.i18n.get("rules.deletePopup.title"),content:n.i18n.get("rules.deletePopup.content"),type:s.CONFIRM,closeCallback:n.bind(this._closeDeletePopup,this),confirmCallback:n.bind(this._deleteRule,this,e)};this.deletePopup=new s(r),this.deletePopup.open()},_closeDeletePopup:function(){this.deletePopup.remove()},_deleteRule:function(e){e.preventDefault();var t=o(e.currentTarget),r=n.last(t.attr("id").split("-")),i=this.rulesService.removeRule({id:parseInt(r,10)}),s=this;s.trigger("loading",this.deletePopup.$el),n.when(i).done(function(){s.trigger("done",s.deletePopup.$el),s._closeDeletePopup()}).fail(function(e){console.error("[RulesFormView] Error deleting rule",e),s.publish("error",e),s.trigger("fail",s.deletePopup.$el),s._closeDeletePopup()})},_saveRule:function(e){e.preventDefault();if(!this.$("input#sf-rule-id").val()&&this.rules.length>=this.config.maxRules){this._openPopupMaxRules(e);return}var t={operationRule:this._serializeRulesForm()},r=this,i=this.rulesService.createRule(t);this.trigger("loading"),n.when(i).done(function(){r.trigger("done",r.$el)}).fail(function(e){console.error("[RulesFormView] Error saving rule",e),r.publish("error",e),r.trigger("done",null)})},_serializeRulesForm:function(){var e=this.$("form"),t=n.serializeForm(e);return t.autoActions=n.map(t.autoActions,function(e){return e.type!=="COMP"&&(e.computable=""),e.type!=="CAT"&&(e.catId=""),e}),t},_deleteFilterCell:function(e){var t=o(e.currentTarget),r=t.closest(".sf-filter-rule"),i=r.parent(),s=i.children(".sf-filter-rule").length<=2,u=this,a=i.children(".sf-filter-rule").find(".sf-textfield").toArray().indexOf(r.find(".sf-textfield")[0]);return n.validator.removeItem(this.ui.$form,r),r.remove(),n.each(i.children(".sf-filter-rule"),function(e,t){u._changeNumberRule(o(e),t)}),s&&i.children(".sf-filter-rule").find(".sf-button-delete-filter").addClass("sf-button-hidden"),this.filtersList.splice(a,1),this._updateFiltersValidation(i),!1},_addFilterCell:function(e){var t=o(e.currentTarget),r=t.closest(".sf-rules-filters-box"),i=r.children(".sf-filter-rule").last(),s=r.children(".sf-filter-rule").length,u=s<=1,f=o(a({i:parseInt(s,10)}));i.after(f),u&&i.find(".sf-button-delete-filter").removeClass("sf-button-hidden"),n.validator.addItem(this.ui.$form,f),this._updateFiltersValidation(r)},_filterTextChanged:function(e){var t=o(e.currentTarget),n=t.closest(".sf-rules-filters-box");this._fillFilterList(n)},_fillFilterList:function(e){var t=[],r=this;n.each(e.children(".sf-filter-rule"),function(e){t.push(o(e).find(".sf-textfield").val())}),n.each(t,function(e,i){if(r.filtersList[i]!==e){var s=n.clone(t);s.splice(i,1),r.filtersList[i]=s.indexOf(e)<0?e:""}}),this._updateFiltersValidation(e)},_updateFiltersValidation:function(e){var t=this;n.each(e.children(".sf-filter-rule"),function(e,r){var i=n.clone(t.filtersList);i.splice(r,1);var s=i.indexOf("");while(s!==-1)i.splice(s,1),s=i.indexOf("");o(e).find(".sf-textfield").data("filters",i.toString()),o(e).find(".sf-textfield").data("parsleyField").constraints.notinlist.replaced=!1,o(e).find(".sf-textfield").data("parsleyField").constraints.notinlist.requirements="filters",o(e).find(".sf-textfield").val()!==""&&(o(e).find(".sf-textfield").data("parsleyField").reset(),o(e).find(".sf-textfield").data("parsleyField").validate())})},_deleteAutoActionCell:function(e){var t=o(e.currentTarget),r=t.closest(".sf-auto-action-rule"),i=r.closest(".sf-rules-actions-box"),s=i.find(".sf-auto-action-rule").length<=2,u=this,a;return n.validator.removeItem(this.ui.$form,r),r.remove(),n.each(i.find(".sf-auto-action-rule"),function(e,t){u._changeNumberRule(o(e),t)}),s&&i.find(".sf-auto-action-rule").find(".sf-button-delete-action").addClass("sf-button-hidden"),a=i.find("select.sf-action-type-select"),this._rebuildActionSelects(a),!1},_addAutoActionCell:function(e){var t=o(e.currentTarget),i=t.closest(".sf-rules-actions-box"),s=i.find("select.sf-action-type-select"),u=n.map(i.find("select.sf-action-type-select"),function(e){return o(e).val()}),a=n.where(this.autoActionsOptions,function(e){return!n.contains(u,e.value)}),l=n.first(a).value,c=i.children(".sf-auto-action-rule").last(),h=i.children(".sf-auto-action-rule").length,p=h<=1,d=f({i:parseInt(h,10),parent:{computableOptions:this.computableOptions,categoryOptions:this.categoryOptions,autoActionsOptions:a},type:l});c.after(d),this._initActionSelect(s.length),r.init(i),p&&c.find(".sf-button-delete-action").removeClass("sf-button-hidden"),this._rebuildActionSelects(s)},_initAllSelects:function(){var e=this.$(".sf-auto-action-rule");n.each(e,function(e,t){this._initActionSelect(t)},this)},_initActionSelect:function(e){var t={el:this.$("#sf-auto-action-rule-"+e+" .sf-auto-action-category-placeholder"),catId:this.rule&&this.rule.autoActions&&this.rule.autoActions[e]?this.rule.autoActions[e].catId:!1,id:"autoActions-"+e+"-catId",name:"autoActions-"+e+"-catId",removeUncategorized:!1},r=new i(n.extend(t,this.contextConfig));r.render()},_modifySelectedTypeOption:function(e){var t=o(e.currentTarget).val(),r,i=this.$el.find("select.sf-action-type-select"),s=o(e.currentTarget).closest(".sf-auto-action-panel").find(".sf-action-type-option"),u=n.find(s,function(e){return r=n.last(o(e).attr("id").split("-")),r===t});s.removeClass("sf-active"),n.validator.removeItem(this.ui.$form,s),u=o(u),u.addClass("sf-active"),n.validator.addItem(this.ui.$form,u),this._rebuildActionSelects(i)},_changeNumberRule:function(e,t){var r=e.find("input,select"),i=e.attr("id").split("-");i[i.length-1]=t,e.attr("id",i.join("-")),r.length&&n.each(r,function(e){o(e).attr("name")&&(i=o(e).attr("name").split("-"),i[i.length-2]=t,o(e).attr("name",i.join("-")),o(e).attr("id",i.join("-")))})},serializeData:function(){return{rule:this.rule,autoActionsOptions:this.autoActionsOptions,operators:this.operators,accounts:this.accounts,computableOptions:this.computableOptions,categoryOptions:this.categoryOptions,ruleNames:this.options.ruleNames}},reloadRuleNamesForValidation:function(){var e,t=this;n.when(this.rulesService.getRules()).done(function(r){t.rules=r,r&&(t.rule?(r=r.reject({id:t.rule.id}),e=n.map(r,function(e){return e.get("name")})):e=r.pluck("name"),t.$("#sf-rule-name").data("names",e))}).fail(function(e){console.error("[RulesFormView] Loading Rules error",e),t.publish("error",e)})},_rebuildActionSelects:function(e){var t=this.$el.find(".sf-auto-action-rule"),r=this.$el.find(".sf-button-add-action"),i=n.map(t.find("select.sf-action-type-select"),function(e){return o(e).val()}),s=n.difference(n.map(this.autoActionsOptions,"value"),i),u,a;n.each(e,function(e){n.each(o(e).children("option"),function(t){n.contains(i,o(t).val())&&o(t).val()!==o(e).val()&&o(t).remove()}),u=n.map(o(e).children("option"),function(e){return o(e).val()}),n.each(n.difference(s,u),function(t){a=l({value:t,name:n.find(this.autoActionsOptions,function(e){return e.value==t},this).name}),o(e).append(a)},this),o(e).data("ReForm.Select").reinit(),i.length>=this.autoActionsOptions.length?r.attr("disabled","disabled"):r.is(":disabled")&&r.removeAttr("disabled")},this)},_openPopupMaxRules:function(e){var t=o(e.currentTarget),r={$container:this.options.$popupContainer,$opener:t,title:n.i18n.get("rules.popup.maxRules.title"),content:n.i18n.get("rules.popup.maxRules.content",{maxRules:this.config.maxRules}),type:s.ALERT,confirmCallback:n.bind(function(){this.errorPopup.remove()},this),"class":"sf-rules-error-popup"};this.errorPopup=new s(r),this.errorPopup.open()}},{defaults:{maxRules:50}});return c}),define("modules/rules/rules-form-view-extension",["modules/rules/rules-form-view","services/rules-service","utils/util","ui/modules/reform/select/select-module","modules/category-selector/category-selector-module","ui/modules/popup/popup-module","jQuery","hbs!modules/rules/templates/rules-form","hbs!modules/rules/templates/rules-filter","hbs!modules/rules/templates/rules-action","hbs!modules/rules/templates/rules-action-select-option","utils/i18n","utils/validator"],function(e,t,n,r,i,s,o,u,a,f,l){var c=e.extend({events:{"change select.sf-action-type-select":"_modifySelectedTypeOption","click .sf-button-delete-filter":"_deleteFilterCell","click .sf-button-delete-action":"_deleteAutoActionCell","click .sf-button-add-filter":"_addFilterCell","click .sf-button-add-action":"_addAutoActionCell","click .sf-delete-rule-button":"_openDeletePopup","click .sf-button-save-rule":"_saveRule","keyup .sf-filter-rule":"_filterTextChanged","click .sf-rules-name-help":"_openHelpNamePopup","click .sf-rules-description-help":"_openHelpFilterPopup","click .sf-rules-conditions-help":"_openHelpWhenPopup"},ui:{$form:".sf-rule-form",$addFilterButton:".sf-button-add-filter"},hubEvents:{catSelectedRulesForm:"_changeSelectedCat"},initialize:function(){this._super.apply(this,arguments),this.autoActionsOptions=[{name:n.i18n.get("rules.action.type.categorize"),value:"CAT"},{name:n.i18n.get("rules.action.type.mark"),value:"COMP"}]},_changeSelectedCat:function(e){this.catId=e.catId},onRender:function(){this._super(),this.rule||this._addAutoActionCell()},_addAutoActionCell:function(e){var t=this.$el.find(".sf-rules-actions-box"),i=t.find("select.sf-action-type-select"),s=n.map(t.find("select.sf-action-type-select"),function(e){return o(e).val()}),u=n.where(this.autoActionsOptions,function(e){return!n.contains(s,e.value)}),a=n.first(u).value,l=t.children(".sf-auto-action-rule").last(),c=t.children(".sf-auto-action-rule").length,h=c<=1,p=f({i:parseInt(c,10),parent:{computableOptions:this.computableOptions,categoryOptions:this.categoryOptions,autoActionsOptions:u},type:a});l.after(p),this._initActionSelect(i.length),r.init(t),h&&l.find(".sf-button-delete-action").removeClass("sf-button-hidden"),this._rebuildActionSelects(i)},_addFilterCell:function(e){n.pushToDataLayer({eventCategory:"PFM Movimientos- Personalizar Movimientos",eventAction:"Boton",eventLabel:"Agregar Condición",event:"eventClick"});var t=this.$el.find(".sf-rules-filters-wrapper"),r=t.children(".sf-filter-rule").last(),i=t.children(".sf-filter-rule").length,s=i<=1,u=o(a({i:parseInt(i,10),isPlatform:this.config.isPlatform}));r.after(u),i+1===3&&this.ui.$addFilterButton.hide(),s&&r.find(".sf-button-delete-filter").removeClass("sf-button-hidden"),n.validator.addItem(this.ui.$form,u),this._updateFiltersValidation(t)},_deleteFilterCell:function(e){n.pushToDataLayer({eventCategory:"PFM Movimientos- Personalizar Movimientos",eventAction:"Boton",eventLabel:"Eliminar ",event:"eventClick"});var t=o(e.currentTarget),r=t.closest(".sf-filter-rule"),i=r.parent(),s=i.children(".sf-filter-rule").length,u=s<=2,a=this,f=i.children(".sf-filter-rule").find(".sf-textfield").toArray().indexOf(r.find(".sf-textfield")[0]);return n.validator.removeItem(this.ui.$form,r),r.remove(),n.each(i.children(".sf-filter-rule"),function(e,t){a._changeNumberRule(o(e),t)}),u&&i.children(".sf-filter-rule").find(".sf-button-delete-filter").addClass("sf-button-hidden"),this.filtersList.splice(f,1),this._updateFiltersValidation(i),this.ui.$addFilterButton.show(),!1},_openHelpNamePopup:function(e){n.pushToDataLayer({eventCategory:"PFM Movimientos- Personalizar Movimientos",eventAction:"Boton",eventLabel:"Tooltip Nombre de la personalización",event:"eventClick"});var t=o(e.currentTarget),r={$container:this.$el,$opener:t,content:n.i18n.get("rules.info.name"),type:s.INFO,closeCallback:n.bind(this._closePopup,this),maskClass:"sf-dark-mask",standAlone:!this.config.isPlatform};this.infoPopup=new s(r),this.infoPopup.open()},_openHelpFilterPopup:function(e){n.pushToDataLayer({eventCategory:"PFM Movimientos- Personalizar Movimientos",eventAction:"Boton",eventLabel:"Tooltip Descripción movimiento",event:"eventClick"});var t=o(e.currentTarget),r={$container:this.$el,$opener:t,content:n.i18n.get("rules.info.filter"),type:s.INFO,closeCallback:n.bind(this._closePopup,this),maskClass:"sf-dark-mask",standAlone:!this.config.isPlatform};this.infoPopup=new s(r),this.infoPopup.open()},_openHelpWhenPopup:function(e){n.pushToDataLayer({eventCategory:"PFM Movimientos- Personalizar Movimientos",eventAction:"Boton",eventLabel:"Tooltip Agregar Cambio",event:"eventClick"});var t=o(e.currentTarget),r={$container:this.$el,$opener:t,content:n.i18n.get("rules.info.when"),type:s.INFO,closeCallback:n.bind(this._closePopup,this),maskClass:"sf-dark-mask",standAlone:!this.config.isPlatform};this.infoPopup=new s(r),this.infoPopup.open()},_closePopup:function(){this.infoPopup.remove()},serializeData:function(){if(this.rule&&this.rule.autoActions&&this.rule.autoActions.length>0&&this.rule.autoActions[0].type!=="CAT"){var e=this.rule.autoActions[1];this.rule.autoActions.splice(-1,1),this.rule.autoActions.unshift(e)}return{rule:this.rule,autoActionsOptions:this.autoActionsOptions,operators:this.operators,accounts:this.accounts,computableOptions:this.computableOptions,categoryOptions:this.categoryOptions,ruleNames:this.options.ruleNames,isPlatform:this.config.isPlatform}},_checkParsleyValidation:function(){var e=this.ui.$form?this.ui.$form:this.$el.find(".sf-rule-form.sf-form-inline"),t=this.ui.$form.parsley();return t?t.validate():!0},_saveRule:function(e){e.preventDefault();if(!this.ui.$form.parsley().validate()||!n.validator.isValid(this.ui.$form))return;if(!this.$("input#sf-rule-id").val()&&this.rules.length>=this.config.maxRules){this._openPopupMaxRules(e);return}var t={operationRule:this.newSerializeRulesForm()},r=this,i=this.rulesService.createRule(t);this.trigger("loading"),n.when(i).done(function(){r.trigger("done",r.$el)}).fail(function(e){console.error("[RulesFormView] Error saving rule",e),r.publish("error",e),r.trigger("done",null)})},newSerializeRulesForm:function(){var e=this,t=this.$(".sf-rule-form"),r=o("<form>",{"class":"sf-rule-form sf-form-inline"});r[0].innerHTML=t[0].innerHTML;var i=r.find("input");t.find("input").each(function(e,t,n){o(i.get(e)).val(o(t).val())});var s=n.serializeForm(r);return t.find(".sf-reform-category-select").children(".sf-current").first().text()===t.find(".sf-reform-category-select.sf-original").children().last().text()&&(e.catId=0),s.autoActions=n.map(s.autoActions,function(t){return t.type!=="COMP"&&(t.computable=""),e.catId!=null&&(t.catId=e.catId),t}),t.find(".sf-option.sf-last").hasClass("sf-selected")?s.operator="ANY":s.operator="ALL",s},_openDeletePopup:function(e){n.pushToDataLayer({eventCategory:"PFM Movimientos- Personalizar Movimientos",eventAction:"Boton",eventLabel:"Eliminar personalización",event:"eventClick"});var t=o(e.currentTarget),r={$container:this.$el,$opener:t,title:n.i18n.get("rules.deletePopup.title"),content:n.i18n.get("rules.deletePopup.content"),type:s.CONFIRM,closeCallback:n.bind(this._closeDeletePopup,this),confirmCallback:n.bind(this._deleteRule,this,e)};this.deletePopup=new s(r),this.deletePopup.open()}},{defaults:{maxRules:50}});return c}),define("hbs!modules/rules/templates/rules-list",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i,s,o;r+="\n<div>\n	<h3>",o={hash:{}},r+=u((i=n.t,i?i.call(e,"rules.listTitle",o):a.call(e,"t","rules.listTitle",o)))+'</h3>\n	<ul class="sf-select-rule-options">\n	',s=n.each.call(e,e.rules,{hash:{},inverse:f.noop,fn:f.program(2,c,t)});if(s||s===0)r+=s;return r+="\n	</ul>\n</div>\n",r}function c(e,t){var r="",i;r+='\n		<li id="sf-rule-selected-',(i=n.id)?i=i.call(e,{hash:{}}):(i=e.id,i=typeof i===o?i.apply(e):i),r+=u(i)+'" class="sf-rule-element"><a href="javascript:void(0);">',(i=n.name)?i=i.call(e,{hash:{}}):(i=e.name,i=typeof i===o?i.apply(e):i);if(i||i===0)r+=i;return r+="</a></li>\n	",r}function h(e,t){var r="",i,s;return r+="\n<div>",s={hash:{}},r+=u((i=n.t,i?i.call(e,"rules.noRules",s):a.call(e,"t","rules.noRules",s)))+"</div>\n",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s,o="function",u=this.escapeExpression,a=n.helperMissing,f=this;return s=n["if"].call(t,t.rules,{hash:{},inverse:f.program(4,h,i),fn:f.program(1,l,i)}),s||s===0?s:""});return t.registerPartial("modules_rules_templates_rules-list",n),n}),define("modules/rules/rules-list-view",["classes/item-view","utils/util","jQuery","hbs!modules/rules/templates/rules-list"],function(e,t,n,r){var i=e.extend({template:r,events:{"click .sf-rule-element":"_ruleSelected"},_rulesSerializer:function(e){var n=[],r;return t.each(e.models,function(e){r=[],t.each(e.attributes,function(e,n){n==="autoActions"?r.autoActions=t.map(e,function(e){return e.computable=e.computable.toString(),e}):r[n]=e}),n.push(r)}),n},_ruleSelected:function(e){var r=n(e.currentTarget),i=t.last(r.attr("id").split("-"));this.publish("rules:current:change",i)},serializeData:function(){return{rules:this._rulesSerializer(this.collection)}}});return i}),define("modules/rules/rules-list-view-extension",["modules/rules/rules-list-view","utils/util"],function(e,t){var n=e.extend({_ruleSelected:function(e){t.pushToDataLayer({eventCategory:"PFM Movimientos- Personalizar Movimientos",eventAction:"Boton",eventLabel:"Personalizaciones existentes",event:"eventClick"}),this._super.apply(this,arguments)}});return n}),define("libs/require/css/css!modules/rules/css/rules",[],function(){}),define("modules/rules/rules-module",["classes/layout","hbs!modules/rules/templates/rules","modules/rules/rules-form-view","modules/rules/rules-list-view","services/rules-service","services/accounts-service","services/categories-service","modules/category-selector/category-selector-module","utils/util","css!modules/rules/css/rules"],function(e,t,n,r,i,s,o,u,a){var f=e.extend({template:t,regions:{rulesFormRegion:".sf-rules-form",rulesListRegion:".sf-rules-list-box"},events:{"click button.sf-add-rule-button":"_createFormToAdd"},hubEvents:{"rules:current:change":"_currentRuleChanged","rules:list:change":"_getRuleListData"},initialize:function(){this._super.apply(this,arguments),this.rulesList=null,this.accountsList=null,this.rulesForm=null,this.rulesService=i.getInstance(),this.accountsService=s.getInstance(),this.categoriesService=o.getInstance(),a.bind(this._reloadRules,this)},_reloadRules:function(e,t){a.unmask(t),this._currentRuleChanged(e),this._getRuleListData()},_createFormToAdd:function(){this.rulesForm.updateData(null)},_currentRuleChanged:function(e){var t=this.rulesList.find({id:parseInt(e,10)});this.rulesForm.updateData(t)},onRender:function(){this._super(),this._getRuleFormData(),this._getRuleListData()},_getRuleListData:function(){var e=this;a.when(this.rulesService.getRules()).done(function(t){e.rulesListRegion.show(new r(a.extend({},e.contextConfig,{parent:e,collection:t}))),e.rulesList=t,e.trigger("view:change"),e.trigger("rulesViewsLoaded")}).fail(function(t){console.error("[RulesModule] Loading Rules Error ",t),e.publish("error",t)})},_getRuleFormData:function(){var e=this;a.when(this.accountsService.get(),this.categoriesService.getPlainCategories(),this.rulesService.getRules()).done(a.bind(this._receiveRuleFormData,this)).fail(function(t){console.error("[RulesModule] Loading Accounts and Categories Error ",t),e.trigger("error",t)})},_receiveRuleFormData:function(e,t,r){var i=this;this.rulesForm=new n(a.extend({accounts:e,categories:t,ruleNames:r.pluck("name")},this.contextConfig)),this.rulesFormRegion.show(this.rulesForm),this.rulesForm.on("loading",function(e){var t=e||i.rulesForm.$el;a.mask(t,1)}),this.rulesForm.on("fail",function(e){var t=e||i.rulesForm.$el;a.unmask(t)}),this.rulesForm.on("done",this._rulesFormDone,this),this.rulesForm.on("cancel",this._cancel,this),this.trigger("view:change")},_rulesFormDone:function(e){var t=e||this.rulesForm.$el;this._reloadRules(null,t)},_cancel:function(){this.trigger("cancel")}},{ID:"rules",submodules:[u],services:[i,s,o]});return f}),define("modules/rules/rules-module-extension",["modules/rules/rules-module","hbs!modules/rules/templates/rules","modules/rules/rules-form-view","modules/rules/rules-list-view","services/rules-service","services/accounts-service","services/categories-service","modules/category-selector/category-selector-module","utils/util","css!modules/rules/css/rules"],function(e,t,n,r,i,s,o,u,a){var f=e.extend({_getRuleListData:function(){var e=this;a.when(this.rulesService.getRules()).done(function(t){e.createdRules=t,e.render(!0)}).fail(function(t){console.error("[RulesModule] Loading Rules Error ",t),e.publish("error",t)})},_ViewRuleListSection:function(){this.rulesListRegion.show(new r(a.extend({},this.contextConfig,{parent:this,collection:this.createdRules}))),this.rulesList=this.createdRules,this.trigger("view:change"),this.trigger("rulesViewsLoaded")},_rulesFormDone:function(e){this._super(e),this.trigger("ruleCreated")},render:function(e){if(e){this._super(),this._ViewRuleListSection(),this._receiveRuleFormData(this.accounts,this.categories,this.createdRules);return}this._getRuleFormData()},serializeData:function(){return{createdRules:this.createdRules.length>0}},_getRuleFormData:function(){var e=this;a.when(this.accountsService.get(),this.categoriesService.getPlainCategories(),this.rulesService.getRules()).done(function(t,n,r){e.accounts=t,e.categories=n,e.createdRules=r,e._getRuleListData()}).fail(function(t){console.error("[RulesModule] Loading Accounts and Categories Error ",t),e.trigger("error",t)})},onRender:function(){}});return f}),define("hbs!modules/transactions-advanced-search/templates/transactions-advanced-search",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function";return s+='<div class="sf-box sf-transactions-advanced-search">\n	<form class="sf-advanced-search-form sf-form-vertical sf-clearfix" data-validate="parsley">\n		<div class="sf-box-title">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"transactions-advanced-search.title",a):f.call(t,"t","transactions-advanced-search.title",a)))+'</div>\n	    <div class="sf-form-row">\n	        <span class="sf-form-cell">\n				<label for="sf-search-from-',(u=n.cid)?u=u.call(t,{hash:{}}):(u=t.cid,u=typeof u===c?u.apply(t):u),s+=l(u)+'">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"transactions-advanced-search.from.label",a):f.call(t,"t","transactions-advanced-search.from.label",a)))+"</label>\n				",a={hash:{id:"sf-search-from-{{cid}}",dataValue:"{{minDate}}",dataFormat:"{{format}}",dataFormatSubmit:"{{formatSubmit}}",placeholder:'{{t "transactions-advanced-search.from.placeholder"}}',"class":"sf-from-date",dataDatepickerName:"fromDate",dataMin:"{{minDate}}",dataMax:"{{maxDate}}",validateField:"transactionSearch.fromDate"}},s+=l((o=n.datepicker,o?o.call(t,a):f.call(t,"datepicker",a)))+'\n			</span>\n			<span class="sf-form-cell">\n				<label for="sf-search-to-',(u=n.cid)?u=u.call(t,{hash:{}}):(u=t.cid,u=typeof u===c?u.apply(t):u),s+=l(u)+'">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"transactions-advanced-search.to.label",a):f.call(t,"t","transactions-advanced-search.to.label",a)))+"</label>\n				",a={hash:{id:"sf-search-to-{{cid}}",dataValue:"{{maxDate}}",dataFormat:"{{format}}",dataFormatSubmit:"{{formatSubmit}}",placeholder:'{{t "transactions-advanced-search.to.placeholder"}}',"class":"sf-to-date",dataDatepickerName:"toDate",dataMin:"{{minDate}}",dataMax:"{{maxDate}}",validateField:"transactionSearch.toDate"}},s+=l((o=n.datepicker,o?o.call(t,a):f.call(t,"datepicker",a)))+'\n			</span>\n	        <span class="sf-form-cell">\n				<label for="sf-search-minAmount-',(u=n.cid)?u=u.call(t,{hash:{}}):(u=t.cid,u=typeof u===c?u.apply(t):u),s+=l(u)+'">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"transactions-advanced-search.minAmount.label",a):f.call(t,"t","transactions-advanced-search.minAmount.label",a)))+"</label>\n				",a={hash:{id:"sf-search-minAmount-{{cid}}",name:"minAbsAmount","class":"sf-amount-filter",placeholder:'{{t "transactions-advanced-search.minAmount.placeholder"}}',validateField:"transactionSearch.minAbsAmount"}},s+=l((o=n.textfield,o?o.call(t,a):f.call(t,"textfield",a)))+'\n			</span>\n			<span class="sf-form-cell">\n				<label for="sf-search-maxAmount-',(u=n.cid)?u=u.call(t,{hash:{}}):(u=t.cid,u=typeof u===c?u.apply(t):u),s+=l(u)+'">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"transactions-advanced-search.maxAmount.label",a):f.call(t,"t","transactions-advanced-search.maxAmount.label",a)))+"</label>\n				",a={hash:{id:"sf-search-maxAmount-{{cid}}",name:"maxAbsAmount","class":"sf-amount-filter",placeholder:'{{t "transactions-advanced-search.maxAmount.placeholder"}}',validateField:"transactionSearch.maxAbsAmount"}},s+=l((o=n.textfield,o?o.call(t,a):f.call(t,"textfield",a)))+'\n			</span>\n		</div>\n	    <div class="sf-form-row">\n			<label for="sf-search-name-',(u=n.cid)?u=u.call(t,{hash:{}}):(u=t.cid,u=typeof u===c?u.apply(t):u),s+=l(u)+'">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"transactions-advanced-search.name.label",a):f.call(t,"t","transactions-advanced-search.name.label",a)))+"</label>\n			",a={hash:{id:"sf-search-name-{{cid}}",name:"name","class":"sf-search-name",placeholder:'{{t "transactions-advanced-search.name.placeholder"}}',validateField:"transactionSearch.name"}},s+=l((o=n.textfield,o?o.call(t,a):f.call(t,"textfield",a)))+'\n		</div>\n		<div class="sf-button-controls">\n			',a={hash:{text:'{{t "common.button.cancel"}}',type:"button","class":"sf-button-cancel sf-advanced-search-form-cancel"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+"\n			",a={hash:{text:'{{t "common.button.search"}}',type:"button","class":"sf-button-search sf-advanced-search-form-save"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+"\n		</div>\n	</form>\n</div>",s});return t.registerPartial("modules_transactions-advanced-search_templates_transactions-advanced-search",n),n}),define("libs/require/css/css!modules/transactions-advanced-search/css/transactions-advanced-search",[],function(){}),define("modules/transactions-advanced-search/transactions-advanced-search-module",["classes/layout","ui/modules/reform/datepicker/datepicker-module","hbs!modules/transactions-advanced-search/templates/transactions-advanced-search","utils/util","utils/validator","utils/date","utils/number","css!modules/transactions-advanced-search/css/transactions-advanced-search"],function(e,t,n,r){var i=e.extend({template:n,events:{"click .sf-advanced-search-form-cancel":"_cancelAdvancedSearch","submit .sf-advanced-search-form":"_search","click .sf-amount-filter":"_recalculateInput","change .sf-from-date":"_fromDateChanged"},hubEvents:{"advancedSearch:show":"_saveShowStatus","advancedSearch:hide":"_saveHideStatus"},ui:{$form:".sf-advanced-search-form",$fromDate:".sf-from-date",$toDate:".sf-to-date"},filtersList:["datesRange"],onRender:function(){this.isDisplayed=!0;var e=this,n,i;t.init(this.$el),r.validator.validate(this.ui.$form),r.validator.onFieldError=function(t,r,s){n=e.$(".sf-form-error-description.maxdate"),i=e.$(".sf-form-error-description.range"),e._manageMaxDateError(n,t,r,s),e._manageAmountsError(i,t,r,s)}},_fromDateChanged:function(){var e=this.ui.$fromDate.pickadate("picker"),t=this.ui.$toDate.pickadate("picker"),n={min:e.get("min").obj,max:e.get("max").obj},r,i;e&&(r=e.get("select").obj,n.min=r,t&&(i=t.get("select").obj,i.getTime()<r.getTime()&&t.set("select",r),t.set(n)))},_manageMaxDateError:function(e,t,n){t.hasClass("sf-from-date")&&t.closest(".sf-advanced-search-form").length&&typeof n.min!="undefined"&&e.length&&e.hide()},_manageAmountsError:function(e,t,n){var i=t.hasClass("sf-amount-filter"),s=r.validator.config.validator,o;if(i&&typeof n.range!="undefined"&&!t.is(":focus")&&e.length>1){e.show(),e.eq(1).hide();if(t.attr("name")!="minAbsAmount"||this.$("[name=maxAbsAmount]").is(":focus"))o=s.errors.classHandler(t),o.removeClass(s.errorClass)}},serializeData:function(){return{format:r.date.getDatepickerFormat(this.config.datePickerFormat),formatSubmit:r.date.getDatepickerFormat(r.date.constructor.BACKEND_FORMAT),cid:this.cid,minDate:r.date.formatBackendDate(this.filters.datesRange.fromDate),maxDate:r.date.formatBackendDate(this.filters.datesRange.toDate)}},_search:function(e){e.preventDefault();var t=r.pick(r.serializeForm(this.ui.$form),function(e){return e!==""},this),n;t.fromDate!==undefined&&(t.fromDate=r.date.parseBackendDate(t.fromDate)),t.toDate!==undefined&&(t.toDate=r.date.parseBackendDate(t.toDate)),t.minAbsAmount!==undefined&&(t.minAbsAmount=r.number.parse(t.minAbsAmount)),t.maxAbsAmount!==undefined&&(t.maxAbsAmount=r.number.parse(t.maxAbsAmount)),n=r.pick(t,["name","minAbsAmount","maxAbsAmount"]),n.datesRange={fromDate:t.fromDate,toDate:t.toDate},this.publish("extraFilters:change",{filter:"advancedSearchFilters",data:n})},_recalculateInput:function(e){var t=this.$(e.currentTarget);t.trigger("keyup")},_filtersChanged:function(e,t,n){if(e==="datesRange"&&this.isDisplayed&&!n){var i=this.ui.$fromDate.pickadate("picker"),s=this.ui.$toDate.pickadate("picker"),o={min:t.fromDate,max:t.toDate};i&&(i.set(o),i.set("select",o.min)),s&&(s.set(o),s.set("select",o.max));var u=r.findIndex(this.config.extraFilters,{filter:"advancedSearchFilters"});if(u!==-1){var a=this.config.extraFilters[u].data;a.datesRange={fromDate:t.fromDate,toDate:t.toDate},this.publish("extraFilters:change",{filter:"advancedSearchFilters"}),this.publish("extraFilters:change",{filter:"advancedSearchFilters",data:a})}}},_cancelAdvancedSearch:function(){this.publish("advancedSearch:hide"),this.publish("extraFilters:change",{filter:"advancedSearchFilters"})},_saveShowStatus:function(){this.isDisplayed=!0},_saveHideStatus:function(){this.isDisplayed=!1}},{ID:"transactions-advanced-search",defaults:{datePickerFormat:r.date.constructor.SHORT_DATE}});return i}),define("modules/transactions-advanced-search/transactions-advanced-search-module-extension",["modules/transactions-advanced-search/transactions-advanced-search-module","ui/modules/reform/datepicker/datepicker-module","hbs!modules/transactions-advanced-search/templates/transactions-advanced-search","utils/util","utils/validator","utils/date","utils/number","css!modules/transactions-advanced-search/css/transactions-advanced-search"],function(e,t,n,r){var i=e.extend({events:{"click .sf-advanced-search-form-cancel":"_cancelAdvancedSearch","click .sf-advanced-search-form-save":"_search","click .sf-amount-filter":"_recalculateInput","change .sf-from-date":"_fromDateChanged"},_search:function(e){e.preventDefault();if(!this.ui.$form.parsley().validate()||!r.validator.isValid(this.ui.$form))return;var t=r.pick(r.serializeForm(this.ui.$form),function(e){return e!==""},this),n;t.fromDate!==undefined&&(t.fromDate=r.date.parseBackendDate(t.fromDate)),t.toDate!==undefined&&(t.toDate=r.date.parseBackendDate(t.toDate)),t.minAbsAmount!==undefined&&(t.minAbsAmount=r.number.parse(t.minAbsAmount)),t.maxAbsAmount!==undefined&&(t.maxAbsAmount=r.number.parse(t.maxAbsAmount)),n=r.pick(t,["name","minAbsAmount","maxAbsAmount"]),n.datesRange={fromDate:t.fromDate,toDate:t.toDate},this.publish("extraFilters:change",{filter:"advancedSearchFilters",data:n})}},{ID:"transactions-advanced-search",defaults:{datePickerFormat:r.date.constructor.SHORT_DATE}});return i}),define("hbs!modules/transactions-filters/templates/transactions-filters",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-transactions-filters">\n	<div class="sf-autocomplete-transactions-filters-placeholder"></div>\n	<a class="sf-advanced-search-link" href="javascript:void(0);">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"transactions-filters.advancedSearch",u):a.call(t,"t","transactions-filters.advancedSearch",u)))+'</a>\n	<div class="sf-advanced-search-placeholder"></div>\n</div>',s});return t.registerPartial("modules_transactions-filters_templates_transactions-filters",n),n}),define("libs/require/css/css!modules/transactions-filters/css/transactions-filters",[],function(){}),define("modules/transactions-filters/transactions-filters-module",["classes/layout","utils/util","ui/modules/reform/datepicker/datepicker-module","ui/modules/autocomplete/autocomplete-module","modules/transactions-advanced-search/transactions-advanced-search-module","services/categories-service","services/transactions-service","hbs!modules/transactions-filters/templates/transactions-filters","css!modules/transactions-filters/css/transactions-filters","utils/number"],function(e,t,n,r,i,s,o,u){var a=e.extend({template:u,regions:{autocompletefilterRegion:".sf-autocomplete-transactions-filters-placeholder",advancedSearchRegion:".sf-advanced-search-placeholder"},events:{"change .sf-autocomplete-transactions-filters":"_searchChanged","keyup .sf-autocomplete-transactions-filters":"_searchChanged","click .sf-advanced-search-link":"_toggleAdvancedSearch"},ui:{$advancedSearchLink:".sf-advanced-search-link"},filtersList:["accounts","category","categories","datesRange"],hubEvents:{"advancedSearch:show":"_showAdvancedSearch","advancedSearch:hide":"_hideAdvancedSearch","transactions:datagrid:change":"_modeChanged"},initialize:function(){this._super.apply(this,arguments),this.categoriesService=s.getInstance(),this.transactionsService=o.getInstance()},render:function(e){var n=this;return e?this._super():(t.when(this.categoriesService.getPlainCategories(),this.transactionsService.get({fromDate:this.filters.datesRange.fromDate,toDate:this.filters.datesRange.toDate},this.filters)).done(function(e,t){n.categories=e,n.transactions=t,n.transactions.data.on("all",n._initAutocomplete,n),n.render(!0)}).fail(function(e){console.error("[TransactionsFilters] Error retrieving transactions",e),n.publish("error",e)}),this)},onRender:function(){this._super(),n.init(this.$el),this._initAutocomplete()},_initAutocomplete:function(){if(!this.autocompletefilterRegion)return;console.log("[TransactionsFilters] Initializing autocomplete");var e=this._calculateAutocompleteOptions(this.transactions),n={config:{placeholder:t.i18n.get("transactions-filters.freeTextSearch.placeholder"),name:"sf-autocomplete-transactions-filters",data:e,value:this.$(".sf-autocomplete-transactions-filters").val(),"class":"sf-autocomplete-transactions-filters"}};this.autocomplete=new r(n),this.autocompletefilterRegion.show(this.autocomplete)},_updateAutocomplete:function(){var e=this;this.transactions&&(this.transactions.data.off("all",this._initAutocomplete),this.transactions.dispose()),t.when(this.categoriesService.getPlainCategories(),this.transactionsService.get({fromDate:this.filters.datesRange.fromDate,toDate:this.filters.datesRange.toDate},this.filters)).done(function(t,n){e.categories=t,e.transactions=n,e.transactions.data.on("all",e._initAutocomplete,e),e._initAutocomplete()}).fail(function(t){console.error("[TransactionsFilters] Error retrieving transactions",t),e.publish("error",t)})},_calculateAutocompleteOptions:function(e){var n=t.uniq(t.flatten(e.data.map(function(e){var n=e.pick("name","date","amount","accName","category");return n.date=t.date.format(n.date,"MMMM d, 'yyyy"),n.amount=t.number.format(n.amount),n.catName=n.category.get("catName"),n.category.get("parent")&&(n.parentcatName=n.category.get("parent").get("catName")),delete n.category,t.reduce(n,function(t,n,r){return t.push({id:[r,e.get(r)].join("-"),text:n}),t},[])},this),!0),"text");return n},_searchChanged:function(){clearTimeout(this.scheduledEvent),this.scheduledEvent=setTimeout(t.bind(this._publishFilterChange,this),this.config.delay)},_publishFilterChange:function(){var e=this.$(".sf-autocomplete-transactions-filters").val();this._freeText!=e&&(this._freeText=e,this.publish("extraFilters:change",{filter:"autocompleteFilter",data:{freeText:e}}))},_toggleAdvancedSearch:function(){return this.ui.$advancedSearchLink.hasClass("sf-opened")?this.publish("advancedSearch:hide"):(this.ui.$advancedSearchLink.addClass("sf-opened"),this.publish("advancedSearch:show")),!1},_showAdvancedSearch:function(){this.$(".sf-autocomplete-transactions-filters").val("").trigger("change").attr("disabled","disabled"),this.ui.$advancedSearchLink.addClass("sf-opened"),this.advancedSearchRegion.currentView===undefined&&this.advancedSearchRegion.show(new i(this.contextConfig))},_hideAdvancedSearch:function(){this.ui.$advancedSearchLink.removeClass("sf-opened"),this.$(".sf-autocomplete-transactions-filters").removeAttr("disabled"),this.advancedSearchRegion.close()},_filtersChanged:function(e){e==="datesRange"&&this._updateAutocomplete()},_modeChanged:function(e){this.filters.mode=e,this.filters.category=null,this.filters.maxAmount=null,this.filters.minAmount=null}},{ID:"transactions-filters",submodules:[r,i],services:[s,o],defaults:{delay:250}});return a}),define("modules/dav-accounts-filter/dav-accounts-filter-module",["modules/accounts-filter/extensions/accounts-filter-dropdown/accounts-filter-dropdown-module","services/accounts-service","ui/modules/reform/checkbox/checkbox-module","hbs!modules/accounts-filter/templates/accounts-filter","hbs!modules/accounts-filter/extensions/accounts-filter-dropdown/templates/accounts-filter-dropdown","hbs!modules/accounts-filter/templates/entity-group-view","hbs!modules/accounts-filter/templates/product-type-group-view","ui/modules/dropdown/dropdown-module","jQuery","utils/util","utils/i18n","css!modules/accounts-filter/extensions/accounts-filter-dropdown/css/accounts-filter-dropdown"],function(e,t,n,r,i,s,o,u,a,f){var l=e.extend({events:{"change input.sf-account-selector":"_accountsSelectionChanged","change input.sf-account-group-selector":"_accountGroupSelectionChanged","click .sf-account-group-option":"_groupByChange","click .sf-account-config-save":"saveAccountSelection","change input.sf-all-accounts":"_toggleAllAccoounts"},_accountsSelectionChanged:function(){this._currentSelection=this._getCurrentSelection(),this._updateAccountGroupSelection(),this._updateTitle(),this._reviewAccountsChecked();var e=this._currentTitle;this.publish("davFilterChanged",{filter:"accounts",data:this._currentSelection,title:e})},_reviewAccountsChecked:function(){var e=this.$el.find("div.sf-all-accounts");this.$el.find("input.sf-account-selector:not(:checked)").length===0?e.addClass("sf-checked"):e.removeClass("sf-checked")},_updateTitle:function(){var e=this,t;this.dropdown&&(t=this.accountsService.getAccountsSelectionTotals(this.accounts,this._currentSelection),t.total===t.selected?this._currentTitle=f.i18n.get("accounts-filter.web.allAccounts"):this._currentTitle=f.i18n.get("accounts-filter.web.title",t),this._currentSelection&&this._currentSelection.selected.length===1&&this._setSingleAccountTitle(),this.dropdown.updateLabel(this._currentTitle))},_setSingleAccountTitle:function(){var e=this,t=this._currentSelection.selected[0];f.each(this.accounts,function(n){f.each(n.elements,function(n){n.accountPK===t&&(e._currentTitle=n.alias)})})},_applyCurrentSelection:function(e){if(!this._currentSelection){var t=this.config.providerAccId,n=this.config.accNameType;if(t)return f.map(e,function(e){var n=!0;return f.map(e.elements,function(e){return e.viewFilter=t.toString()===e.providerId,e.viewFilter===!1&&(n=!1),e},this),e.selected=n,e},this);if(n){var r=n.toString().split(";");return f.map(e,function(e){var t=!0;return f.map(e.elements,function(e){return e.viewFilter=r[0].toString()===e.alias&&r[1]===e.type.toString(),e.viewFilter===!1&&(t=!1),e},this),e.selected=t,e},this)}return e}return f.map(e,function(e){var t=!0;return f.map(e.elements,function(e){return e.viewFilter=f.contains(this._currentSelection.selected,e.accountPK),e.viewFilter===!1&&(t=!1),e},this),e.selected=t,e},this)},_toggleAllAccoounts:function(){var e=this.$el.find("div.sf-all-accounts"),t=e.hasClass("sf-checked");t?e.removeClass("sf-checked"):e.addClass("sf-checked");var n=!t,r=this.$el.find(".sf-account-group").find("input.sf-account-selector");console.log("pasa a estar chequeado?: "+n),f.each(r.prop("checked",n),function(e){a(e).data("ReForm.Checkbox").update()}),this._accountsSelectionChanged()},serializeData:function(){var e=this,t={content:r({grouping:this._currentGrouping,allChecked:e._allAccountsChecked()})};return t},_allAccountsChecked:function(){return this.$el.find("input.sf-account-selector:not(:checked)").length===0},updateView:function(){var e=this;if(this.isClosed!==!1)return this.render();var r;this._currentGrouping===t.PRODUCT_GROUPING?r=o:r=s,f.each(this.accounts,function(t){f.each(t.elements,function(t){t.isPlatform=e.config.isPlatform})}),this.ui.accountsContainer.html(r({group:this.accounts,cid:this.cid})),this.$(".sf-account-group-option").removeClass("sf-active"),this.$(".sf-account-group-option-"+this._currentGrouping).addClass("sf-active"),this._updateSaveButtonStatus(),f.tooltip.add(this.$el.find(".sf-account-balance"),this.tooltipOptions),n.init(this.$el)},_getSimpleSelectorOptions:function(){if(f.isMobileBrowser()){var e=this.options.config.itemsToRemove||2;this.config.predefinedSelections.splice(this.config.predefinedSelections.length-e,e)}return f.map(this.config.predefinedSelections,function(e){return e==="custom"?{value:e,name:f.i18n.get("timerange-filter.customRange")}:{value:e,name:f.i18n.get("common.date.web.semanticRange.predefined-"+e)}})}});return l}),define("modules/dav-timerange-filter/dav-timerange-filter-module",["ui/modules/timerange-filter/extensions/timerange-filter-simple-dropdown/timerange-filter-simple-dropdown-module","hbs!ui/modules/timerange-filter/extensions/timerange-filter-simple-dropdown/templates/timerange-filter-simple-dropdown","ui/modules/dropdown/dropdown-module","utils/util","utils/i18n","utils/date","css!ui/modules/timerange-filter/extensions/timerange-filter-simple-dropdown/css/timerange-filter-simple-dropdown"],function(e,t,n,r){var i=e.extend({_publishChange:function(){var e=r.date.truncate(this._stepScale,this._steps[this.$("select.sf-timerange-from").val()]),t=r.date.ceiling(this._stepScale,this._steps[this.$("select.sf-timerange-to").val()]);if(r.isEqual(this._fromDate,e)&&r.isEqual(this._toDate,t))return;this._fromDate=e,this._toDate=t,this._updateTitle(),this.updateSelectedPredefinedSelection(),this.publish("davFilterChanged",{filter:"datesRange",data:{fromDate:e,toDate:t,skipRefresh:!0},title:this.currentTitle}),this._updateTitle()},_updateTitle:function(){this.currentTitle=r.date.formatSemanticRange(this._fromDate,this._toDate,"MMMyyyy"),this.$(".sf-timerange-title").html(this.currentTitle)},updateSelectedPredefinedSelection:function(){var e=this.$("a.sf-predefined-selection"),t=parseInt(this.$("select.sf-timerange-from").val(),10),n=parseInt(this.$("select.sf-timerange-to").val(),10),i=r.date.difference("month",this._fromDate,this._toDate)+1,s=r.date.formatSemanticRange(this._fromDate,this._toDate,"MMMyyyy"),o=this.ui.$selector.find("option"),u=0,a=e.length,f=!1,l;e.removeClass("sf-selected"),o.length>this.config.predefinedSelections.length&&(o.eq(o.length-2).remove(),this.ui.$selector.data("ReForm.Select").reinit());for(;u<a;u++)l=e.eq(u),parseInt(l.data("from"),10)===t&&parseInt(l.data("to"),10)===n&&(l.addClass("sf-selected"),this.ui.$selector.val(i),this.ui.$selector.data("ReForm.Select").update(),f=!0);f||(o.eq(o.length-1).before("<option value='new'>"+s+"</option>"),this.ui.$selector.data("ReForm.Select").reinit(),this.ui.$selector.val("new"),this.ui.$selector.data("ReForm.Select").update()),this.currentOption=i},_getSimpleSelectorOptions:function(){if(r.isMobileBrowser()){var e=this.options.config.itemsToRemove||2;this.config.predefinedSelections.splice(this.config.predefinedSelections.length-e,e)}return r.map(this.config.predefinedSelections,function(e){return e==="custom"?{value:e,name:r.i18n.get("timerange-filter.customRange")}:{value:e,name:r.i18n.get("common.date.web.semanticRange.predefined-"+e)}})}},{defaults:{range:11,predefinedSelections:[1,3,6,12,"custom"]}});return i}),define("hbs!modules/transactions-details-filters/templates/transactions-details-filters",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){return"sf-white-background "}function d(e,t){return"sf-hide "}function v(e,t){var r="",i,s;return r+='\n		<div class="sf-current-filters">\n			<span class="sf-current-timerange">\n				',(i=n.currentTimerange)?i=i.call(e,{hash:{}}):(i=e.currentTimerange,i=typeof i===f?i.apply(e):i),r+=l(i)+'\n			</span>\n			<span class="sf-current-accounts">\n				',s={hash:{}},r+=l((i=n.t,i?i.call(e,"transactions-details-filters.currentFilters.defaultSelection.accounts",s):c.call(e,"t","transactions-details-filters.currentFilters.defaultSelection.accounts",s)))+'\n			</span>\n			<span class="sf-current-category">\n				',s={hash:{}},r+=l((i=n.t,i?i.call(e,"transactions-details-filters.currentFilters.defaultSelection.categories",s):c.call(e,"t","transactions-details-filters.currentFilters.defaultSelection.categories",s)))+"\n			</span>\n		</div>\n		",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;s+='<div class="sf-transactions-filters sf-transactions-details-filters">\n	<div class="sf-transactions-dropdown-filters ',o=n["if"].call(t,t.hideFilters,{hash:{},inverse:h.noop,fn:h.program(1,p,i)});if(o||o===0)s+=o;s+='">\n		<div class="sf-filters-wrapper ',o=n["if"].call(t,t.hideFilters,{hash:{},inverse:h.noop,fn:h.program(3,d,i)});if(o||o===0)s+=o;s+='">\n			<div class="sf-autocomplete-tx-container">\n				<div class="sf-autocomplete-tx-label">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"transactions-filters.autocompleteLabel",a):c.call(t,"t","transactions-filters.autocompleteLabel",a)))+'</div>\n				<div class="sf-autocomplete-transactions-filters-placeholder"></div>\n			</div>\n\n			<a class="sf-advanced-search-link" href="javascript:void(0);">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"transactions-filters.advancedSearch",a):c.call(t,"t","transactions-filters.advancedSearch",a)))+'</a>\n			<div class="sf-advanced-search-placeholder"></div>\n			<div class="sf-accounts-filter-container">\n				<div class="sf-accounts-filter-placeholder"></div>\n			</div>\n\n			<div class="sf-timerange-filter-container">\n				<div class="sf-timerange-filter-label">',(u=n.timerangeFilterLabel)?u=u.call(t,{hash:{}}):(u=t.timerangeFilterLabel,u=typeof u===f?u.apply(t):u),s+=l(u)+'</div>\n				<div class="sf-timerange-filter-placeholder"></div>\n			</div>\n			',a={hash:{"class":"sf-button-filters-apply {{#if hideFilters}}sf-hide {{/if}}",type:"button",text:"transactions-filters.buttonLabel"}},s+=l((o=n.button,o?o.call(t,a):c.call(t,"button",a)))+'\n		</div>\n	</div>\n\n	<div class="sf-current-filters-wrapper sf-clearfix">\n		',u=n["if"].call(t,t.isPlatform,{hash:{},inverse:h.noop,fn:h.program(5,v,i)});if(u||u===0)s+=u;return s+='\n		<div title="ayuda" class="sf-icon-help sf-rules-manager-help"></div>\n		<button class="sf-button sf-manage-rules-button" type="button">\n			<span class="sf-rules-manager-icon">\n				<img src="resources/pfm/ui/css/icons/app-icons/dav-rules.png" width="29" height="25" alt="',a={hash:{}},s+=l((o=n.t,o?o.call(t,"details.button.manageRules",a):c.call(t,"t","details.button.manageRules",a)))+'">\n			</span>\n			<span class="sf-button-text">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"details.button.manageRules",a):c.call(t,"t","details.button.manageRules",a)))+"</span>\n		</button>\n	</div>\n</div>\n",s});return t.registerPartial("modules_transactions-details-filters_templates_transactions-details-filters",n),n}),define("libs/require/css/css!modules/transactions-details-filters/css/transactions-details-filters",[],function(){}),define("modules/transactions-details-filters/transactions-details-filters-module",["modules/transactions-filters/transactions-filters-module","utils/util","ui/modules/reform/datepicker/datepicker-module","ui/modules/autocomplete/autocomplete-module","modules/transactions-advanced-search/transactions-advanced-search-module","modules/dav-accounts-filter/dav-accounts-filter-module","modules/dav-timerange-filter/dav-timerange-filter-module","services/categories-service","services/transactions-service","hbs!modules/transactions-details-filters/templates/transactions-details-filters","css!modules/transactions-details-filters/css/transactions-details-filters","utils/number"],function(e,t,n,r,i,s,o,u,a,f){var l=e.extend({template:f,events:{"click .sf-button-filters-apply":"_applyFilters","change .sf-autocomplete-transactions-filters":"_searchChanged","keyup .sf-autocomplete-transactions-filters":"_searchChanged","click button.sf-manage-rules-button":"_openRulesManager"},hubEvents:{davFilterChanged:"_davFilterChanged"},regions:{autocompletefilterRegion:".sf-autocomplete-transactions-filters-placeholder",advancedSearchRegion:".sf-advanced-search-placeholder",accountsFilterRegion:".sf-accounts-filter-placeholder",timerangeFilterRegion:".sf-timerange-filter-placeholder"},ui:{$timeRangeTitle:".sf-current-timerange",$accountsTitle:".sf-current-accounts",$categoriesTitle:".sf-current-category",$advancedSearchLink:".sf-advanced-search-link"},initialize:function(){this._super.apply(this,arguments),this.transactionsService=a.getInstance(),this.filtersStack=[],this.hideFilters=this.config.accNameType!==undefined&&this.config.accNameType!==null},_davFilterChanged:function(e){this.filtersStack[e.filter]={data:e.data,extraFilter:e.extraFilter,title:e.title}},_getRangeMonths:function(){return this.config.initialRangeMonths},onRender:function(){this._super(),n.init(this.$el),this._initAutocomplete(),this.accountsFilterRegion.show(new s(this.contextConfig)),this.timerangeFilterRegion.show(new o(t.extend({},this.contextConfig,{config:{rangeSelected:this._getRangeMonths()}})))},_applyFilters:function(){console.log("[Filters popup: applying filters]"),this.contextConfig.widget.id==="analysis"&&(this.config.filters&&this.config.filters.mode==="expenses"?t.pushToDataLayer({eventCategory:"PFM Ingreso y Gastos -Mis Gastos",eventAction:"Boton",eventLabel:"Filtro",event:"eventClick"}):t.pushToDataLayer({eventCategory:"PFM Ingreso y Gastos -Mis Ingresos",eventAction:"Boton",eventLabel:"Filtro",event:"eventClick"})),this.contextConfig.widget.id==="details"&&t.pushToDataLayer({eventCategory:"PFM Movimientos",eventAction:"Boton",eventLabel:"Filtro",event:"eventClick"});var e=[];for(var n in this.filtersStack)if(this.filtersStack.hasOwnProperty(n)){var r="filters:change";this.filtersStack[n].extraFilter&&(r="extraFilters:change"),this.publish(r,{filter:n,data:this.filtersStack[n].data}),this.filtersStack[n].title&&(e[n]=this.filtersStack[n].title)}this.changeFiltersTitles(e)},_initAutocomplete:function(){if(!this.autocompletefilterRegion)return;console.log("[TransactionsFilters] Initializing autocomplete");var e=this._calculateAutocompleteOptions(this.transactions),n={config:{placeholder:t.i18n.get("transactions-filters.web.freeTextSearch.placeholder"),name:"sf-autocomplete-transactions-filters",data:e,value:this.$(".sf-autocomplete-transactions-filters").val(),"class":"sf-autocomplete-transactions-filters",isPlatform:this.config.isPlatform}};this.autocomplete=new r(n),this.autocompletefilterRegion.show(this.autocomplete)},changeFiltersTitles:function(e){for(var t in e)if(e.hasOwnProperty(t))switch(t){case"datesRange":this.ui.$timeRangeTitle.html(e[t]);break;case"accounts":this.ui.$accountsTitle.html(e[t]);break;case"category":this.ui.$categoriesTitle.html(e[t])}},_publishFilterChange:function(){var e=this.$(".sf-autocomplete-transactions-filters").val();this._freeText!=e&&(this._freeText=e,this.filtersStack.autocompleteFilter={data:{freeText:e},extraFilter:!0})},serializeData:function(){var e=t.date.formatSemanticRange(this.filters.datesRange.fromDate,this.filters.datesRange.toDate);return{timerangeFilterLabel:t.i18n.get("transactions-filters.timerangeFilterLabel"),currentTimerange:e,isPlatform:this.config.isPlatform,hideFilters:this.hideFilters}}},{ID:"transactions-details-filters",submodules:[r,i,e],services:[u,a],defaults:{delay:250}});return l}),define("ui/modules/datagrid/editors/base-editor",["utils/util","classes/item-view"],function(e,t){var n=t.extend({events:{keydown:"_processKeyPress"},initialize:function(e){e=e!==undefined?e:!0,this.colDef=this.options.colDef,this.cell=this.options.cell,this.element=this.model,e&&this.render()},onRender:function(){this._super(),this.cell.html(this.$el)},serializeData:function(){return{value:this.model.get(this.options.field)}},_processKeyPress:function(e){switch(e.keyCode){case 13:this._confirm();break;case 27:this._discard()}},_discard:function(){this.trigger("datagrid:editor:discard")},_confirm:function(){this.trigger("datagrid:editor:confirm")}});return n}),define("hbs!ui/modules/datagrid/editors/templates/text-editor",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression;return s+="<input class=\"sf-text-editor\" type='text' value='",(o=n.value)?o=o.call(t,{hash:{}}):(o=t.value,o=typeof o===u?o.apply(t):o),s+=a(o)+"'/>",s});return t.registerPartial("ui_modules_datagrid_editors_templates_text-editor",n),n}),define("ui/modules/datagrid/editors/text-editor",["utils/util","ui/modules/datagrid/editors/base-editor","hbs!ui/modules/datagrid/editors/templates/text-editor"],function(e,t,n){var r=t.extend({template:n,events:{focusout:"_discard"},ui:{editor:"input"},initialize:function(){e.extend(this.events,t.prototype.events),this._super()},onRender:function(){this._super(),this.ui.editor.focus()},_confirm:function(){var e={};e[this.options.field]=this.ui.editor.val(),this.model.save(e),this._super()}});return r}),define("ui/modules/datagrid/datagrid-column",["utils/util"],function(e){var t=function(t){e.extend(this,t),this.editor!==undefined&&(this.editorType=this.editor,this.editor=function(t){return function(n){console.log("[Datagrid] Edit element %s %s",n.model.id,t.field);var r=e.extend({parent:t.parent,model:n.model,field:t.field,cell:n.cell,colDef:t,data:n.data,evt:n.evt},n.contextConfig);return new t.editorType(r)}}(this))};return t.prototype.afterEditorClose=function(e){e.find(".sf-editor-trigger").trigger("focus")},t}),define("hbs!ui/modules/datagrid/templates/datagrid",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-datagrid">\n	<div class="sf-datagrid-body-wrapper">\n		<table class="sf-datagrid-body">\n			<caption></caption>\n			<thead>\n			</thead>\n			<tbody>\n			</tbody>\n		</table>\n	</div>\n	<div class="sf-datagrid-pagination"></div>\n</div>'});return t.registerPartial("ui_modules_datagrid_templates_datagrid",n),n}),define("hbs!ui/modules/datagrid/templates/partials/header-container",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function";s+="<tr>",(o=n.headerContent)?o=o.call(t,{hash:{}}):(o=t.headerContent,o=typeof o===u?o.apply(t):o);if(o||o===0)s+=o;return s+="</tr>",s});return t.registerPartial("ui_modules_datagrid_templates_partials_header-container",n),n}),define("hbs!ui/modules/datagrid/templates/partials/header-column",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){var r="",i,s,o;r+='\n<th class="sf-col-',(i=n.col)?i=i.call(e,{hash:{}}):(i=e.col,i=typeof i===u?i.apply(e):i),r+=a(i)+" ",(i=n.headerClass)?i=i.call(e,{hash:{}}):(i=e.headerClass,i=typeof i===u?i.apply(e):i),r+=a(i)+' sf-datagrid-sortable"\n	data-field="',(i=n.field)?i=i.call(e,{hash:{}}):(i=e.field,i=typeof i===u?i.apply(e):i),r+=a(i)+'" aria-label="',o={hash:{label:e.label}},r+=a((i=n.t,i?i.call(e,"datagrid.arialabel.activateToSortAsc",o):f.call(e,"t","datagrid.arialabel.activateToSortAsc",o)))+'"\n	',s=n["if"].call(e,e.sortDirection,{hash:{},inverse:l.noop,fn:l.program(2,h,t)});if(s||s===0)r+=s;return r+='>\n	<span class="sf-datagrid-sorting-indicator"></span>\n	<a 	title="',o={hash:{label:e.label}},r+=a((i=n.t,i?i.call(e,"datagrid.arialabel.activateToSortAsc",o):f.call(e,"t","datagrid.arialabel.activateToSortAsc",o)))+'"\n		href="javascript:void(0);">',(s=n.label)?s=s.call(e,{hash:{}}):(s=e.label,s=typeof s===u?s.apply(e):s),r+=a(s)+"</a>\n</th>\n",r}function h(e,t){var r="",i;return r+='aria-sort="',(i=n.sortDirection)?i=i.call(e,{hash:{}}):(i=e.sortDirection,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function p(e,t){var r="",i;return r+='\n<th data-field="',(i=n.field)?i=i.call(e,{hash:{}}):(i=e.field,i=typeof i===u?i.apply(e):i),r+=a(i)+'" class="sf-col-',(i=n.col)?i=i.call(e,{hash:{}}):(i=e.col,i=typeof i===u?i.apply(e):i),r+=a(i)+" ",(i=n.headerClass)?i=i.call(e,{hash:{}}):(i=e.headerClass,i=typeof i===u?i.apply(e):i),r+=a(i)+'">\n	',(i=n.label)?i=i.call(e,{hash:{}}):(i=e.label,i=typeof i===u?i.apply(e):i),r+=a(i)+"\n</th>\n",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=n.helperMissing,l=this;o=n["if"].call(t,t.sortable,{hash:{},inverse:l.program(4,p,i),fn:l.program(1,c,i)});if(o||o===0)s+=o;return s+="\n",s});return t.registerPartial("ui_modules_datagrid_templates_partials_header-column",n),n}),define("hbs!ui/modules/datagrid/templates/partials/row-container",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){return'tabIndex="0"'}function c(e,t){var r="",i;return r+='class="',(i=n.classes)?i=i.call(e,{hash:{}}):(i=e.classes,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=this;s+="<tr ",o=n["if"].call(t,t.tabable,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;s+=' data-id="',(o=n.elementId)?o=o.call(t,{hash:{}}):(o=t.elementId,o=typeof o===u?o.apply(t):o),s+=a(o)+'" ',o=n["if"].call(t,t.classes,{hash:{},inverse:f.noop,fn:f.program(3,c,i)});if(o||o===0)s+=o;s+=" >",(o=n.rowContent)?o=o.call(t,{hash:{}}):(o=t.rowContent,o=typeof o===u?o.apply(t):o);if(o||o===0)s+=o;return s+="</tr>",s});return t.registerPartial("ui_modules_datagrid_templates_partials_row-container",n),n}),define("hbs!ui/modules/datagrid/templates/partials/row-column",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){return" sf-editable-col"}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<td data-col="'+l((o=(o=t.colDef,o==null||o===!1?o:o.label),typeof o===f?o.apply(t):o))+'" class="sf-col-',(u=n.col)?u=u.call(t,{hash:{}}):(u=t.col,u=typeof u===f?u.apply(t):u),s+=l(u)+" "+l((o=(o=t.colDef,o==null||o===!1?o:o.columnClass),typeof o===f?o.apply(t):o)),a={hash:{},inverse:c.noop,fn:c.program(1,p,i)},u=(o=n.ifdef,o?o.call(t,(o=t.colDef,o==null||o===!1?o:o.editor),a):h.call(t,"ifdef",(o=t.colDef,o==null||o===!1?o:o.editor),a));if(u||u===0)s+=u;s+='">\n',(u=n.columnContent)?u=u.call(t,{hash:{}}):(u=t.columnContent,u=typeof u===f?u.apply(t):u);if(u||u===0)s+=u;return s+="</td>",s});return t.registerPartial("ui_modules_datagrid_templates_partials_row-column",n),n}),define("hbs!ui/modules/datagrid/templates/partials/empty-grid",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s,o,u=n.helperMissing,a=this.escapeExpression;return o={hash:{text:"{{{message}}}","class":"sf-datagrid-empty-message"}},a((s=n.empty,s?s.call(t,o):u.call(t,"empty",o)))});return t.registerPartial("ui_modules_datagrid_templates_partials_empty-grid",n),n}),define("libs/require/css/css!ui/modules/datagrid/css/datagrid",[],function(){}),define("ui/modules/datagrid/datagrid-module",["utils/util","classes/layout","jQuery","classes/filtered-collection","ui/modules/datagrid/editors/text-editor","ui/modules/pagination/pagination-module","ui/modules/datagrid/datagrid-column","hbs!ui/modules/datagrid/templates/datagrid","hbs!ui/modules/datagrid/templates/partials/header-container","hbs!ui/modules/datagrid/templates/partials/header-column","hbs!ui/modules/datagrid/templates/partials/row-container","hbs!ui/modules/datagrid/templates/partials/row-column","hbs!ui/modules/datagrid/templates/partials/empty-grid","utils/tooltip","css!ui/modules/datagrid/css/datagrid"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){function d(e,t,n,r){var i=e.get(n),s=t.get(n);return m(i,s,e,t,r)}function v(e,t,n,r){var i=e.get(n)||"",s=t.get(n)||"";return m(i.toString().toUpperCase(),s.toString().toUpperCase(),e,t,r)}function m(e,t,n,r,i){var s;return e>t?s=1:e<t?s=-1:n.id>r.id?s=1:n.id<r.id?s=-1:s=0,i==="DESC"?-s:s}var p=t.extend({template:u,partials:{headerContainer:a,headerColumn:f,rowContainer:l,rowColumn:c,emptyGrid:h},regions:{paginationRegion:".sf-datagrid-pagination"},ui:{tableBody:".sf-datagrid-body tbody",tableHeader:".sf-datagrid-body thead",tableCaption:".sf-datagrid-body caption",bodyWrapper:".sf-datagrid-body-wrapper"},events:{"click .sf-datagrid-sortable":"_headerSortClicked","click .sf-editor-trigger":"_editableActivated","keyup .sf-editor-trigger":"_editableKeyPressed","focusin .sf-datagrid-body tbody":"_elementFocused","click tbody tr":"_elementClickSelection","keyup tbody tr":"_elementKeySelection","mouseover .sf-datagrid-body tbody":"_elementUnfocused"},collectionEvents:{add:"_elementAdded",change:"_elementChanged",remove:"_elementRemoved",reset:"_collectionReset"},initialize:function(){this.collection=null,this.filterFunction=this.config.filterFunction,this.sortField=this.config.sortField,this.sortDirection=this.config.sortDirection,this.gridConfig=this.config.gridConfig||{},this._paginatedGrid=this.gridConfig.pagination!==undefined,this._currentPage=this.gridConfig.pagination!==undefined?this.gridConfig.pagination.page!==undefined?this.gridConfig.pagination.page-1:0:0,this._resetCurrentEditor(),this._setupColumnsConfig(),this.options.dataSource&&this._initDataSource(this.options.dataSource),this.options.container&&this.options.container.html(this.$el)},onRender:function(){this._super(),console.log("[Datagrid] Initial render"),this._renderHeader(),this.collection!==null&&this.renderElements()},renderElements:function(e){e&&this._initDataSource(e),this._renderRows(),this._updateSortingHeader()},serializeData:function(){return this.gridConfig},filter:function(e){this.filterFunction=e,this.collection!==null&&this.collection.updateFilter(this.filterFunction)},sort:function(e,t){this._dataSort(e,t),this.renderElements()},focusRowById:function(e){this._findRow({id:e}).addClass("sf-focused")},unfocusRows:function(){this.$("tr.sf-focused").removeClass("sf-focused")},selectRowById:function(e){this._selectElement(this._findRow({id:e}))},selectRowByModel:function(e){this._selectElement(this._findRow(e))},selectRowsByModels:function(e){this._selectElements(this._findRows(e))},selectRowByPos:function(e){var t=this.ui.tableBody.find("tr").eq(e);this._selectElement(t)},getClosestElement:function(e){var t=n(e).closest("tr").data("id");return this.getElementById(t)},getElementById:function(e){return this.collection.find(function(t){return t.id==e})},_initDataSource:function(e){this.undelegateEvents(),this.originalDataSource=e,this.collection=new r,this.collection.setupFilter(this.originalDataSource,this.filterFunction),this.sortField&&this._dataSort(this.sortField,this.sortDirection),this.delegateEvents()},_dataSort:function(e,t){var n,r=this._getColumnConfig(e);this.sortField=e,this.sortDirection=t?t:"ASC",r.comparator!==undefined?r.comparator==="string"?n=function(n,r){return v(n,r,e,t)}:n=function(n,i){return r.comparator(n,i,e,t)}:n=function(n,r){return d(n,r,e,t)},this.collection.comparator=n,this.collection.sort()},_updateSortingHeader:function(){if(this.sortField){var t=this.$el.find("thead th.sf-sorting-ASC, thead th.sf-sorting-DESC"),n=this._getColumnConfig(t.data("field"));if(n!==undefined){var r=e.i18n.get("datagrid.arialabel.activateToSortAsc",{label:n.label});t.removeClass("sf-sorting-ASC sf-sorting-DESC").removeAttr("aria-sort").attr("aria-label",r),e.tooltip.update(t.find("a"),{"content.text":r})}var i,s,o,u=this.$el.find("thead th[data-field="+this.sortField+"]"),a=this._getColumnConfig(this.sortField);this.sortDirection==="ASC"?(i="sf-sorting-ASC",s="ascending",o=e.i18n.get("datagrid.arialabel.activateToSortDesc",{label:a.label})):(i="sf-sorting-DESC",s="descending",o="activate to ASC",o=e.i18n.get("datagrid.arialabel.activateToSortAsc",{label:a.label})),e.tooltip.update(u.find("a"),{"content.text":o}),u.addClass(i).attr("aria-sort",s).attr("aria-label",o)}},_elementChanged:function(e){console.log("[Datagrid] element %s change detected",e.id),this.currentEditorEle===e.id&&this._resetCurrentEditor(),this._removeElementFromGrid(e,"changed"),this.sortField!==undefined&&this._dataSort(this.sortField,this.sortDirection),this._addElementToGrid(e,"changed"),this.dataGridChanged()},_elementRemoved:function(e){console.log("[Datagrid] element removal detected"),this._removeElementFromGrid(e,"removed"),this.dataGridChanged()},_elementAdded:function(e){console.log("[Datagrid] element addition detected"),this._addElementToGrid(e,"added"),this.dataGridChanged()},_collectionReset:function(){console.log("[Datagrid] collection reset detected"),this._paginatedGrid&&(this._currentPage=0),this.renderElements()},_removeElementFromGrid:function(e){this._findRow(e).remove()},_addElementToGrid:function(e){if(this.filterFunction===undefined||this.filterFunction&&this.filterFunction(e)){var t=this.collection.indexOf(e),n=this._createRowMarkup(e,t);this._insertRowAt(n,t),console.log("[Datagrid] element fulfills filtering conditions, add to view in position %d",t)}},_insertRowAt:function(t,n){n-=this.firstRendered;if(n<=0)this.ui.tableBody.prepend(t);else{var r=this.ui.tableBody.find("tr").eq(n);r.size()!==0?r.before(t):this.ui.tableBody.append(t)}e.tooltip.add(this.ui.tableBody.find("[title]"),this.tooltipOptions)},_findRow:function(e){return this.ui.tableBody.find('tr[data-id="'+e.id+'"]')},_findRows:function(e){var t="";for(var n=0;n<e.length;n++)n>0&&(t+=","),t+="tr[data-id="+e[n].id+"]";return this.ui.tableBody.find(t)},_renderHeader:function(){var t=[],n=this.partials.headerColumn,r=this.partials.headerContainer;e.each(this.columnsConfig,function(e){t.push(n(e))},this),this.ui.tableHeader.html(r({headerContent:t.join("")})),e.tooltip.add(this.ui.tableHeader.find("[title]"),this.tooltipOptions)},_getRenderableElements:function(){this.collectionLength=this.collection.length,this._paginatedGrid&&this._configurePagination();var e=this._currentPage*this.collectionLength,t=e+this.collectionLength;return this.collection.slice(e,t)},_showPage:function(e){this._currentPage=e-1,this.render()},_renderRows:function(){var t=this._getRenderableElements();this.firstRendered=0,this.lastRendered=t.length;var n=this._createRowsMarkup(t);this.ui.tableBody.html(n),this.dataGridChanged(),e.tooltip.add(this.ui.tableBody.find("[title]"),this.tooltipOptions)},dataGridChanged:function(){this.totalElements=this.collection.length,this.ui.bodyWrapper.removeClass("sf-datagrid-empty").find(".sf-datagrid-empty-message").remove();if(this.totalElements===0){this.ui.tableBody.empty();var t=this.partials.emptyGrid({message:e.i18n.get(this.config.emptyMessageKey)});this.ui.bodyWrapper.addClass("sf-datagrid-empty").append(t)}this._updatePyjamas(),this.trigger("change",this.collection)},_createRowsMarkup:function(t){var n=[];return e.each(t,function(e){var t=this.collection.indexOf(e);n.push(this._createRowMarkup(e,t))},this),n.join("")},_updatePyjamas:function(){this.ui.tableBody.find("tr:even").removeClass("sf-row-odd").addClass("sf-row-even"),this.ui.tableBody.find("tr:odd").removeClass("sf-row-even").addClass("sf-row-odd")},_createRowMarkup:function(t,n){var r=[],i={};return e.each(this.columnsConfig,function(e,s){r.push(this._renderCell(e,t,n,i,s))},this),i.classes===undefined&&(i.classes=[]),i.classes.push(n%2===0?"sf-row-even":"sf-row-odd"),this.partials.rowContainer({tabable:this.config.focusableRows,rowContent:r.join(""),elementId:t.id,classes:i.classes.join(" ")})},_renderCell:function(t,n,r,i,s){var o;i=i||{};if(t.formatter!==undefined){var u=n;e.isFunction(t.serializeData)&&(u=t.serializeData(n,t)),o=t.formatter(u,this.collection,r,i)}else o=n.get(t.field);return this.partials.rowColumn({columnContent:o,colDef:t,col:s})},_elementKeySelection:function(e){this.config.focusableRows&&(e.keyCode==32||e.keyCode==13)&&this._elementToggleSelection(e)},_elementClickSelection:function(e){this.config.focusableRows&&this._elementToggleSelection(e)},_elementToggleSelection:function(e){var t=n(e.currentTarget);t.hasClass("sf-selected")?this._unselectElement(t):this._selectElement(t)},_unselectElement:function(e){var t=this.getElementById(e.data("id"));console.log("[DataGrid] Element %s unselected",t.id),e.removeClass("sf-selected"),this.trigger("element:unselected",e,t)},_selectElement:function(e){var t=this.getElementById(e.data("id"));t&&(this.ui.tableBody.find("tr.sf-selected").removeClass("sf-selected"),e.addClass("sf-selected"),console.log("[DataGrid] Element %s selected",t.id),this.trigger("element:selected",e,t))},_selectElements:function(t){this.ui.tableBody.find("tr.sf-selected").removeClass("sf-selected"),e.each(t,function(e){var t=n(e),r=this.getElementById(t.data("id"));r&&(t.addClass("sf-selected"),console.log("[DataGrid] Element %s selected",r.id),this.trigger("element:selected",t,r))},this)},_elementUnfocused:function(){this.ui.tableBody.find("tr.sf-focused, td.sf-focused").removeClass("sf-focused")},_elementFocused:function(e){var t=n(e.target);this.ui.tableBody.find("tr.sf-focused, td.sf-focused").removeClass("sf-focused"),t.is("tr")?t.addClass("sf-focused"):t.is("td")?t.addClass("sf-focused").closest("tr").addClass("sf-focused"):t.closest("td").addClass("sf-focused").closest("tr").addClass("sf-focused")},_editableKeyPressed:function(e){(e.keyCode==32||e.keyCode==13)&&this._editableActivated(e)&&e.preventDefault()},_editableActivated:function(t){var r=n(t.target).closest("td"),i=r.index(),s=r.closest("tr").data("id"),o=this.ui.tableHeader.find("th").eq(i).data("field"),u=s,a=o;if(this.currentEditorEle===u&&this.currentEditorField===a)return!1;this.currentEditorEle=u,this.currentEditorField=a;var f=this.getElementById(s),l=this._getColumnConfig(o);return console.log("[Datagrid] clicked on cell %s for element %s",o,s),this.currentEditor!==null&&this._closeCurrentEditor(),e.isFunction(l.editor)&&this._createEditor(l,f,r,t),!0},_createEditor:function(t,r,i,s){var o={model:r,cell:i,data:this._resolveEditorData(t),contextConfig:this.contextConfig,evt:s};e.tooltip.destroy(n(i).find("[data-hasqtip]")),this.currentEditor=t.editor(o),this.currentEditor.on("close",this._closeCurrentEditor,this),this.currentEditor.on("datagrid:editor:discard",this._closeCurrentEditor,this),this.currentEditor.on("datagrid:editor:confirm",this._closeCurrentEditor,this)},_closeCurrentEditor:function(){var t=this.currentEditor;console.log("[Datagrid] _closeCurrentEditor()... %o",t);if(!t)return;var r=n(this._renderCell(t.colDef,t.element,{}));t.cell.replaceWith(r),e.tooltip.add(r.find("[title]"),this.tooltipOptions),t.colDef.afterEditorClose(r,t.element),this._resetCurrentEditor()},_resetCurrentEditor:function(){this.currentEditor=null,this.currentEditorEle=null,this.currentEditorId=null},_headerSortClicked:function(e){var t=n(e.currentTarget),r=t.data("field"),i=t.hasClass("sf-sorting-ASC")?"DESC":"ASC";return this.sort(r,i),this.trigger("sort",{field:r,direction:i}),!1},_getColumnConfig:function(t){return e.find(this.columnsConfig,function(e){return e.field===t})},_setupColumnsConfig:function(){this.columnsConfig=this.config.columns},_resolveEditorData:function(){return{}},_configurePagination:function(){var t=1,n;this.collectionLength=this.gridConfig.pagination.elementsPage||this.collection.length,this.gridConfig.pagination.elementsPage&&(n=t=Math.ceil(this.collection.length/this.gridConfig.pagination.elementsPage),this.gridConfig.pagination.maxPageOptions&&t>this.gridConfig.pagination.maxPageOptions&&(n=this.gridConfig.pagination.maxPageOptions)),this.gridConfig.pagination=e.extend(this.gridConfig.pagination,{limit:n,maxPage:t,page:this._currentPage+1});var r=e.extend({},{config:this.gridConfig.pagination},this.contextConfig);this._pagination=new s(r),this._pagination.on("moveTo",e.bind(this._showPage,this)),this.paginationRegion.show(this._pagination)}},{ID:"datagrid",submodules:[s],defaults:{emptyMessageKey:"datagrid.emptyMsg",focusableRows:!1}});return p.DatagridColumn=o,p.TextEditor=i,p._defaultComparator=d,p._stringsComparator=v,p._basicComparator=m,p}),define("ui/modules/datagrid/datagrid-module-extension",["ui/modules/datagrid/datagrid-module","utils/util","utils/tooltip"],function(e,t){var n=e.extend({_createRowMarkup:function(e,n){var r=[],i={};return t.each(this.columnsConfig,function(t,s){r.push(this._renderCell(t,e,n,i,s))},this),i.classes===undefined&&(i.classes=[]),e.get("rowClass")!==undefined&&i.classes.push(e.get("rowClass")),this.partials.rowContainer({tabable:this.config.focusableRows,rowContent:r.join(""),elementId:e.id,classes:i.classes.join(" ")})}},{});return n}),define("hbs!ui/modules/datagrid/templates/v-datagrid",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-datagrid sf-vdatagrid">\n	<div class="sf-datagrid-vheader-wrapper">\n		<table class="sf-datagrid-vheader">\n			<caption></caption>\n			<thead>\n			</thead>\n		</table>\n	</div>\n	<div class="sf-datagrid-body-wrapper">\n		<div class="sf-datagrid-top-aux"></div>\n		<table class="sf-datagrid-body">\n			<caption></caption>\n			<thead class="sf-accessible-header">\n			</thead>\n			<tbody>\n			</tbody>\n		</table>\n		<div class="sf-datagrid-bottom-aux"></div>\n	</div>\n</div>'});return t.registerPartial("ui_modules_datagrid_templates_v-datagrid",n),n}),define("hbs!ui/modules/datagrid/templates/partials/vheader-column",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i,s,l;r+='\n<th class="sf-col-',(i=n.col)?i=i.call(e,{hash:{}}):(i=e.col,i=typeof i===o?i.apply(e):i),r+=u(i)+" ",(i=n.headerClass)?i=i.call(e,{hash:{}}):(i=e.headerClass,i=typeof i===o?i.apply(e):i),r+=u(i)+' sf-datagrid-sortable"\n	data-field="',(i=n.field)?i=i.call(e,{hash:{}}):(i=e.field,i=typeof i===o?i.apply(e):i),r+=u(i)+'"\n	aria-label="',l={hash:{label:e.label}},r+=u((i=n.t,i?i.call(e,"datagrid.arialabel.activateToSortAsc",l):a.call(e,"t","datagrid.arialabel.activateToSortAsc",l)))+'"\n	',s=n["if"].call(e,e.sortDirection,{hash:{},inverse:f.noop,fn:f.program(2,c,t)});if(s||s===0)r+=s;return r+="></th>\n</th>\n",r}function c(e,t){var r="",i;return r+='aria-sort="',(i=n.sortDirection)?i=i.call(e,{hash:{}}):(i=e.sortDirection,i=typeof i===o?i.apply(e):i),r+=u(i)+'"',r}function h(e,t){var r="",i,s;return r+='\n<th data-field="',(i=n.field)?i=i.call(e,{hash:{}}):(i=e.field,i=typeof i===o?i.apply(e):i),r+=u(i)+'" class="sf-col-',(i=n.col)?i=i.call(e,{hash:{}}):(i=e.col,i=typeof i===o?i.apply(e):i),r+=u(i)+" ",(i=n.headerClass)?i=i.call(e,{hash:{}}):(i=e.headerClass,i=typeof i===o?i.apply(e):i),r+=u(i)+'"\n	aria-label="',s={hash:{label:e.label}},r+=u((i=n.t,i?i.call(e,"datagrid.arialabel.activateToSortAsc",s):a.call(e,"t","datagrid.arialabel.activateToSortAsc",s)))+'"></th>\n',r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s,o="function",u=this.escapeExpression,a=n.helperMissing,f=this;return s=n["if"].call(t,t.sortable,{hash:{},inverse:f.program(4,h,i),fn:f.program(1,l,i)}),s||s===0?s:""});return t.registerPartial("ui_modules_datagrid_templates_partials_vheader-column",n),n}),define("ui/modules/datagrid/v-datagrid-module",["utils/util","ui/modules/datagrid/datagrid-module","hbs!ui/modules/datagrid/templates/v-datagrid","hbs!ui/modules/datagrid/templates/partials/vheader-column"],function(e,t,n,r){var i=t.extend({template:n,partials:{vheaderColumn:r},ui:{tableVHeader:".sf-datagrid-vheader thead",tableVCaption:".sf-datagrid-vheader caption",topAux:".sf-datagrid-top-aux",bottomAux:".sf-datagrid-bottom-aux"},events:{},collectionEvents:{},initialize:function(){e.extend(this.partials,t.prototype.partials),e.extend(this.ui,t.prototype.ui),e.extend(this.constructor.defaults,t.defaults),e.extend(this.events,t.prototype.events),e.extend(this.collectionEvents,t.prototype.collectionEvents),this._super.call(this,arguments),this.totalElements=null,this.gridHeight=null,this.rowHeight=null,this.previousYpos=0,this.intendedVisibleRows=this.config.intendedVisibleRows,this.firstRendered=0,this.lastRendered=this.intendedVisibleRows,this.measurementDone=!1,this._scrollHandler=e.bind(this._scrollHandler,this)},onRender:function(){this._super(),this.ui.bodyWrapper.scroll(this._scrollHandler)},renderElements:function(e){this._resetGrid(),this._super(e),this._measure(),this._updateAuxMocks()},sort:function(e,t){this._resetGrid(),this._super(e,t)},_resetGrid:function(){this.firstRendered=0,this.lastRendered=this.intendedVisibleRows,this.ui.bodyWrapper.scrollTop(0)},_renderHeader:function(){var t=[],n=[],r=this.partials.headerColumn,i=this.partials.vheaderColumn,s=this.partials.headerContainer,o;e.each(this.columnsConfig,function(s,u){o=e.extend({col:u},s),t.push(r(o)),n.push(i(o))},this),this.ui.tableHeader.html(s({headerContent:t.join("")})),this.ui.tableVHeader.html(s({headerContent:t.join("")})),this.ui.tableHeader.html(s({headerContent:n.join("")})),e.tooltip.add(this.ui.tableVHeader.find("[title]"),this.tooltipOptions)},_addElementToGrid:function(e,t){this._super(e),t==="added"&&this.lastRendered++},_removeElementFromGrid:function(e,t){this._super(e),t==="removed"&&this.lastRendered--},dataGridChanged:function(){this._super();var e=this._guessRowsIndexes(this.previousYpos);this._renderElementsBetween(e.from,e.to)},_scrollHandler:function(){var e=this.ui.bodyWrapper.scrollTop();if(this.previousYpos!==e){var t=this._guessRowsIndexes(e);(t.from!==this.firstRendered||t.to!==this.lastRendered)&&(t.to!==this.lastRendered||this.lastRendered!==this.totalElements)&&this._renderElementsBetween(t.from,t.to),this.previousYpos=e}},_renderElementsBetween:function(e,t){console.log("[VDatagrid] Updating elements list to %d-%d",e,t);var n,r;t<this.firstRendered||e>this.lastRendered?(n=this.collection.slice(e,t),r=this._createRowsMarkup(n),this.ui.tableBody.html(r)):(e>this.firstRendered?this.ui.tableBody.find("tr").slice(0,e-this.firstRendered).remove():t<this.lastRendered&&this.ui.tableBody.find("tr").slice(t-this.lastRendered).remove(),e<this.firstRendered?(n=this.collection.slice(e,this.firstRendered),r=this._createRowsMarkup(n),this.ui.tableBody.prepend(r)):t>this.lastRendered&&(n=this.collection.slice(this.lastRendered,t),r=this._createRowsMarkup(n),this.ui.tableBody.append(r))),this.firstRendered=e,this.lastRendered=t,this._updateAuxMocks(),this._scheduleTooltipRendering()},_resetVisibility:function(){this._measure(),this._updateAuxMocks()},_scheduleTooltipRendering:function(){var t=this;this.timeoutTooltips&&clearTimeout(this.timeoutTooltips),this.timeoutTooltips=setTimeout(function(){e.isString(t.ui.tableBody)||e.tooltip.add(t.ui.tableBody.find("[title]"),t.tooltipOptions)},this.config.tooltipRenderingTimeout)},_measure:function(){this.gridHeight=this.ui.bodyWrapper.outerHeight(),this.rowHeight=this.ui.tableBody.find("tr").first().outerHeight(),this.gridHeight!==null&&this.rowHeight!==0&&(this.measurementDone=!0)},_getRenderableElements:function(){return this.collection.slice(this.firstRendered,this.lastRendered)},_guessRowsIndexes:function(e){if(!this.measurementDone)return this._measure(),{from:0,to:Math.min(this.intendedVisibleRows+this.config.rowsBuffer,this.totalElements)};var t=Math.floor(e/this.rowHeight)-this.config.rowsBuffer;t=Math.max(0,t);var n=Math.ceil((e+this.gridHeight)/this.rowHeight)+this.config.rowsBuffer;return n=Math.min(n,this.totalElements),{from:t,to:n}},_updateAuxMocks:function(){var e=this.firstRendered*this.rowHeight,t=this.totalElements*this.rowHeight-this.lastRendered*this.rowHeight;this.ui.topAux.height(e),this.ui.bottomAux.height(t)}},{ID:"vdatagrid",submodules:[t],defaults:{intendedVisibleRows:10,rowsBuffer:50,tooltipRenderingTimeout:1e3}});return i}),define("ui/modules/datagrid/transactions-v-datagrid-module",["utils/util","ui/modules/datagrid/v-datagrid-module","ui/modules/popup/popup-module","hbs!ui/modules/datagrid/templates/v-datagrid","hbs!ui/modules/datagrid/templates/partials/vheader-column"],function(e,t,n){var r=t.extend({initialize:function(){this._super(),e.bind(this._showEmptyGridMessagePopup,this),this.contextConfig.widget.id==="transactions-pdf"&&(this.intendedVisibleRows=9999)},dataGridChanged:function(){var t=this,n;this.totalElements=this.collection.length,this.ui.bodyWrapper.removeClass("sf-datagrid-empty").find(".sf-datagrid-empty-message").remove();if(this.totalElements===0){this.ui.tableBody.empty();var r=this.partials.emptyGrid({message:e.i18n.get(this.config.emptyMessageKey)});this.ui.bodyWrapper.addClass("sf-datagrid-empty").append(r),this.emptyMessagePopup||t.showEmptyPopup||(t.showEmptyPopup=setTimeout(function(){t._showEmptyGridMessagePopup()},100))}else t.showEmptyPopup&&(clearTimeout(t.showEmptyPopup),t.showEmptyPopup=null);this._updatePyjamas(),this.trigger("change",this.collection)},_showEmptyGridMessagePopup:function(){var t=e.i18n.get("transactions-datagrid.emptyPopupMessage");this.contextConfig.widget.id==="budget"&&(t=e.i18n.get("transactions-datagrid.emptyBudgetPopupMessage")),this.emptyMessagePopup=new n({$container:this.options.$popupContainer,$opener:this.$el,content:t,type:n.INFO,closeCallback:e.bind(this._closeEmptyMessagePopup,this),maskClass:"sf-dark-mask",showAdmirationIcon:!0,standAlone:!this.config.isPlatform}),this.emptyMessagePopup.open()},_closeEmptyMessagePopup:function(){this.emptyMessagePopup.remove(),this.emptyMessagePopup=null},_renderCell:function(t,n,r,i,s){var o;i=i||{};if(t.formatter!==undefined){var u=n;e.isFunction(t.serializeData)&&(u=t.serializeData(n,t,this.config,this.contextConfig.widget.id)),o=t.formatter(u,this.collection,r,i,this.config,this.contextConfig.widget.id)}else o=n.get(t.field);return this.partials.rowColumn({columnContent:o,colDef:t,col:s})}});return r}),define("hbs!modules/transactions-datagrid/editors/templates/transaction-category-editor",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-category-editor">\n</div>'});return t.registerPartial("modules_transactions-datagrid_editors_templates_transaction-category-editor",n),n}),define("hbs!modules/rules-inline/templates/rules-inline",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function";return s+='<div class="sf-rules-inline-wrapper">\n    <form class="sf-rules-inline-form-container" data-validate="parsley">\n        <div class="sf-rules-inline-form sf-form-row">\n            ',a={hash:{}},s+=l((o=n.t,o?o.call(t,"rules-inline.categorize",a):f.call(t,"t","rules-inline.categorize",a)))+"\n            ",a={hash:{id:"sf-inline-rule",name:"inline-rule",value:"{{{ inlineRule }}}",validateField:"rule.autoActions.name"}},s+=l((o=n.textfield,o?o.call(t,a):f.call(t,"textfield",a)))+"\n            ",a={hash:{}},s+=l((o=n.t,o?o.call(t,"rules-inline.prefix",a):f.call(t,"t","rules-inline.prefix",a)))+"\n            ",(u=n.category)?u=u.call(t,{hash:{}}):(u=t.category,u=typeof u===c?u.apply(t):u),s+=l(u)+'\n        </div>\n        <div class="sf-rules-inline-buttons">\n            ',a={hash:{"class":"sf-inline-rule-btn-apply-once sf-button-save",type:"button",text:"rules-inline.button.applyOnce"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+"\n            ",a={hash:{"class":"sf-inline-rule-btn-create sf-button-save",type:"button",text:"rules-inline.button.createRule"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+"\n        </div>\n    </form>\n</div>",s});return t.registerPartial("modules_rules-inline_templates_rules-inline",n),n}),define("hbs!modules/rules-inline/templates/rules-inline-apply",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function";return s+='<div class="sf-rules-inline-apply">\n    ',a={hash:{}},s+=l((o=n.t,o?o.call(t,"rules-inline.always",a):f.call(t,"t","rules-inline.always",a)))+"\n    ",(u=n.inlineRule)?u=u.call(t,{hash:{}}):(u=t.inlineRule,u=typeof u===c?u.apply(t):u),s+=l(u)+"\n    ",a={hash:{}},s+=l((o=n.t,o?o.call(t,"rules-inline.prefix",a):f.call(t,"t","rules-inline.prefix",a)))+"\n    ",(u=n.category)?u=u.call(t,{hash:{}}):(u=t.category,u=typeof u===c?u.apply(t):u),s+=l(u)+'\n    <a class="sf-inline-rule-btn-cancel" href="javascript:void(0)">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"common.button.change",a):f.call(t,"t","common.button.change",a)))+'</a>\n</div>\n<div class="sf-rules-inline-actions">\n    <div class="sf-rules-inline-transactions">\n        ',a={hash:{}},s+=l((o=n.t,o?o.call(t,"rules-inline.effect",a):f.call(t,"t","rules-inline.effect",a)))+'\n        <a class="sf-bar-tooltip sf-rules-inline-tooltip" href="javascript:void(0)" title="',(u=n.tooltip)?u=u.call(t,{hash:{}}):(u=t.tooltip,u=typeof u===c?u.apply(t):u),s+=l(u)+'">',(u=n.transactions)?u=u.call(t,{hash:{}}):(u=t.transactions,u=typeof u===c?u.apply(t):u),s+=l(u)+'</a>\n    </div>\n    <div class="sf-rules-inline-buttons">\n        ',a={hash:{"class":"sf-inline-rule-btn-cancel sf-button-cancel",type:"button",text:"common.button.cancel"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+"\n        ",a={hash:{"class":"sf-inline-rule-btn-apply sf-button-confirm sf-button-save",type:"button",text:"rules-inline.button.apply"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+"\n    </div>\n</div>",s});return t.registerPartial("modules_rules-inline_templates_rules-inline-apply",n),n}),define("hbs!modules/rules-inline/templates/rules-inline-confirm",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing;return s+='<div class="sf-rules-inline-confirm">\n    ',(o=n.confirmationText)?o=o.call(t,{hash:{}}):(o=t.confirmationText,o=typeof o===a?o.apply(t):o),s+=f(o)+'\n    <a class="sf-inline-rule-btn-edit" href="javascript:void(0)">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"rules-inline.editRule",u):l.call(t,"t","rules-inline.editRule",u)))+'</a>\n</div>\n<div class="sf-rules-inline-buttons">\n    ',u={hash:{"class":"sf-inline-rule-btn-confirm sf-button-confirm",type:"button",text:"common.button.confirm"}},s+=f((o=n.button,o?o.call(t,u):l.call(t,"button",u)))+"\n</div>",s});return t.registerPartial("modules_rules-inline_templates_rules-inline-confirm",n),n}),define("hbs!modules/rules-inline/templates/rules-inline-tooltip",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i,s,u;r+="\n    <p>",u={hash:{}},r+=a((i=n.t,i?i.call(e,"rules-inline.affected",u):o.call(e,"t","rules-inline.affected",u)))+":</p>\n    <p>&nbsp;</p>\n    <ul>\n        ",s=n.each.call(e,e.transactions,{hash:{},inverse:f.noop,fn:f.program(2,c,t)});if(s||s===0)r+=s;return r+="\n    </ul>\n",r}function c(e,t){var r="",i,s,f;r+="\n            <li>",f={hash:{}},s=(i=n.formatDate,i?i.call(e,e.postedDate,"long",f):o.call(e,"formatDate",e.postedDate,"long",f));if(s||s===0)r+=s;r+=", ",(s=n.realName)?s=s.call(e,{hash:{}}):(s=e.realName,s=typeof s===u?s.apply(e):s),r+=a(s)+", ",f={hash:{}},s=(i=n.formatAmount,i?i.call(e,e.amount,f):o.call(e,"formatAmount",e.amount,f));if(s||s===0)r+=s;return r+="</li>\n        ",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s,o=n.helperMissing,u="function",a=this.escapeExpression,f=this;return s=n["if"].call(t,t.transactions,{hash:{},inverse:f.noop,fn:f.program(1,l,i)}),s||s===0?s:""});return t.registerPartial("modules_rules-inline_templates_rules-inline-tooltip",n),n}),define("libs/require/css/css!modules/rules-inline/css/rules-inline",[],function(){}),define("modules/rules-inline/rules-inline-module",["classes/item-view","modules/rules/rules-module","hbs!modules/rules-inline/templates/rules-inline","hbs!modules/rules-inline/templates/rules-inline-apply","hbs!modules/rules-inline/templates/rules-inline-confirm","hbs!modules/rules-inline/templates/rules-inline-tooltip","services/rules-service","ui/modules/popup/popup-module","utils/util","utils/i18n","utils/tooltip","utils/validator","css!modules/rules-inline/css/rules-inline"],function(e,t,n,r,i,s,o,u,a){var f=e.extend({template:n,events:{"click .sf-inline-rule-btn-apply":"_apply","click .sf-inline-rule-btn-apply-once":"_applyOnce","click .sf-inline-rule-btn-create":"_createRule","click .sf-inline-rule-btn-edit":"_editRule","click .sf-inline-rule-btn-confirm":"_confirm","click .sf-inline-rule-btn-cancel":"_cancel"},ui:{$form:".sf-rules-inline-form-container",inputField:"#sf-inline-rule"},initialize:function(){this._super.apply(this,arguments),this.rulesService=o.getInstance(),this.totalOperations=0},serializeData:function(){return{inlineRule:this.model.attributes.name,category:this.options.category,popup:this.options.popup,parentName:typeof this.options.parentCategory!="undefined"?this.options.parentCategory.name:!1,parentColor:typeof this.options.parentCategory!="undefined"?this.options.parentCategory.color:!1}},onRender:function(){this._super(),a.validator.validate(this.ui.$form),this.on("custom:createRule",this._createRule),this._showNumberOfTransactions()},_showNumberOfTransactions:function(){if(!a.validator.isValid(this.ui.$form)){this.ui.inputField.keyup();return}var e=this,t=e.$("#sf-inline-rule").val();this.ruleParams={operationRule:{id:"",entId:e.options.model.attributes.entId,operator:"ALL",operationFilters:[{type:"NAME",operator:"CONTAINS",name:t,date:"",number:""}],autoActions:[{type:"CAT",catId:e.options.catId,name:e.options.category,computable:e.options.model.get("computable")},{type:"COMP",catId:e.options.catId,name:e.options.category,computable:e.options.model.get("computable")}]}};var n=e.rulesService.previewRule(this.ruleParams);a.mask(e.$el),a.when(n).done(function(t){e.totalOperations=t.totalOperations,e.ui.inputField.html(a.i18n.get("rules-inline.transactions",{count:t.totalOperations})),a.unmask(e.$el)}).fail(function(t){console.error("[RulesInlineModule] Preview Rule error",t),e.publish("error",t)})},_applyOnce:function(){this.options.applyOnce()},_apply:function(){var e=this,t=this.rulesService.quickCreateRule(this.ruleParams),n=this.$el.closest(".sf-popup");a.mask(n,1),a.when(t).done(a.bind(this._applyResponse,this)).fail(function(t){a.unmask(n),t._data.status===409&&(t.errorTitle=a.i18n.get("rules.popup.maxRules.title"),t.errorMessage=a.i18n.get("rules.popup.maxRules.content",{maxRules:e.config.maxRules})),console.error("[RulesInlineModule] QuickCreateRule error",t),e.publish("error",t)})},_applyResponse:function(e){var t=this.$el.closest(".sf-popup");a.unmask(t),this.$el.html(i({confirmationText:a.i18n.get("rules-inline.confirm",{count:this.totalOperations,transaction:e.operationFilters[0].name,category:e.autoActions[0].name,rule:e.name})})),this.publish("rules:list:change"),this.options.closeCallback()},_createRule:function(){if(!a.validator.isValid(this.ui.$form)){this.ui.inputField.keyup();return}var e=this,t=e.$("#sf-inline-rule").val();this.ruleParams={operationRule:{id:"",entId:e.model.attributes.entId,operator:"ALL",operationFilters:[{type:"NAME",operator:"CONTAINS",name:t,date:"",number:""}],autoActions:[{type:"CAT",catId:e.options.catId,name:e.options.category,computable:"true"}]}};var n=e.rulesService.previewRule(this.ruleParams);a.mask(e.$el),a.when(n).done(function(n){a.unmask(e.$el),e.totalOperations=n.totalOperations,e.$el.html(r({inlineRule:t,category:e.options.category,transactions:a.i18n.get("rules-inline.transactions",{count:n.totalOperations}),tooltip:s({transactions:n.sample})})),a.tooltip.add(e.$(".sf-rules-inline-tooltip"),e.tooltipOptions)}).fail(function(t){console.error("[RulesInlineModule] Preview Rule error",t),e.publish("error",t)})},_cancel:function(){this.render()},_editRule:function(e){var n=new t(this.contextConfig),r={$container:this.options.$popupContainer,$opener:this.$(e.currentTarget),title:a.i18n.get("rules-inline.title"),contentView:n,closeCallback:a.bind(this._closeRulesManager,this)};n.on("cancel",this._closeRulesManager,this),r["class"]="sf-rules-manager-popup",this.popup=new u(r),this.popup.open()},_closeRulesManager:function(){this.popup.remove()},_confirm:function(){this.options.closeCallback()}},{ID:"rules-inline",defaults:{maxRules:50}});return f}),define("modules/rules-inline/rules-inline-module-extension",["modules/rules-inline/rules-inline-module","modules/rules/rules-module","hbs!modules/rules-inline/templates/rules-inline","hbs!modules/rules-inline/templates/rules-inline-apply","hbs!modules/rules-inline/templates/rules-inline-confirm","hbs!modules/rules-inline/templates/rules-inline-tooltip","services/rules-service","ui/modules/popup/popup-module","utils/util","utils/i18n","utils/tooltip","utils/validator","css!modules/rules-inline/css/rules-inline"],function(e,t,n,r,i,s,o,u,a){var f=e.extend({_editRule:function(e){var n=new t(this.contextConfig),r={$container:this.options.$popupContainer,$opener:this.$(e.currentTarget),title:a.i18n.get("rules-inline.title"),contentView:n,closeCallback:a.bind(this._closeRulesManager,this),standAlone:!this.config.isPlatform};n.on("cancel",this._closeRulesManager,this),r["class"]="sf-rules-manager-popup",this.popup=new u(r),this.popup.open()},_closeRulesManager:function(){this.popup.remove()},_applyOnce:function(){a.pushToDataLayer({eventCategory:"PFM Movimientos-Editar Movimiento",eventAction:"Boton",eventLabel:"Aplicar una vez-Edicion Categorías",event:"eventClick"}),this._super.apply(this,arguments)},_applyResponse:function(){a.pushToDataLayer({eventCategory:"PFM Movimientos-Editar Movimiento",eventAction:"Boton",eventLabel:"Crear Regla-Edicion Categorías",event:"eventClick"}),this._super.apply(this,arguments)},_cancel:function(){a.pushToDataLayer({eventCategory:"PFM Movimientos-Editar Movimiento",eventAction:"Boton",eventLabel:"Cancelar- Edicion Categorias",event:"eventClick"}),this._super.apply(this,arguments)},_createRule:function(){if(!a.validator.isValid(this.ui.$form)){this.ui.inputField.keyup();return}var e=this,t=e.$("#sf-inline-rule").val();this.ruleParams={operationRule:{id:"",entId:e.model.attributes.entId,operator:"ALL",operationFilters:[{type:"NAME",operator:"CONTAINS",name:t,date:"",number:""}],autoActions:[{type:"CAT",catId:e.options.catId,name:e.options.category,computable:"true"}]}};var n=e.rulesService.previewRule(this.ruleParams);a.mask(e.$el),a.when(n).done(function(n){a.unmask(e.$el),e.totalOperations=n.totalOperations,e.$el.html(r({inlineRule:t,category:e.options.category,transactions:a.i18n.get("rules-inline.transactions",{count:n.totalOperations}),tooltip:s({transactions:n.sample})})),a.tooltip.add(e.$(".sf-rules-inline-tooltip"),e.tooltipOptions)}).fail(function(t){console.error("[RulesInlineModule] Preview Rule error",t),e.publish("error",t)})}});return f}),define("modules/transactions-category-editor/transactions-category-editor-module",["jQuery","utils/util","ui/modules/datagrid/editors/base-editor","modules/category-selector/category-selector-module","services/transactions-service","hbs!modules/transactions-datagrid/editors/templates/transaction-category-editor","modules/rules-inline/rules-inline-module","ui/modules/popup/popup-module"],function(e,t,n,r,i,s,o,u){var a=n.extend({template:s,ui:{container:".sf-category-editor"},initialize:function(){t.extend(this.events,n.prototype.events),this.transactionsService=i.getInstance(),this._super()},onRender:function(){this._super(),this._renderCategorySelector()},_renderCategorySelector:function(){this.$currentOpener=e(this.options.evt.currentTarget);var n={el:this.ui.container,catId:this.model.get("category").get("catId"),isIncome:this.model.get("amount")>0,rulesEdition:!0,removeUncategorized:!1,source:"transactionCategorySelector"},i=t.extend({},this.options,n,this.contextConfig),s=new r(i);s.once("item:rendered",function(){s.open(this.options.evt)}),s.render(),s.on("categorySelector:selected",t.bind(this.addRule,this)),s.on("categorySelector:cancel",t.bind(this._discard,this)),s.on("categoryOption:selected",t.bind(this._runSelectedOption,this)),this._categoryEditor=s},_runSelectedOption:function(e){e==="applyOnce"?this._confirm():e==="createRule"&&this.rulesView.trigger("custom:createRule")},addRule:function(n){var r=this._categoryEditor.constructor;if(r.ID&&r.ID==="category-columns")this._selectedCatId=parseInt(n.id,10),this.rulesView=new o(t.extend({catId:n.id,category:n.name,applyOnce:t.bind(this._confirm,this),closeCallback:t.bind(this._closeRulesPopup,this),model:this.model,parentCategory:n.parentCat,popup:!1},this.contextConfig)),e("#render-rules-view").html(this.rulesView.render().el);else{this._selectedCatId=parseInt(n.id,10);var i=new o(t.extend({catId:n.id,category:n.name,applyOnce:t.bind(this._confirm,this),model:this.model,popup:!0,closeCallback:t.bind(this._closeRulesPopup,this)},this.contextConfig)),s={$container:this.options.$popupContainer,contentView:i,$opener:this.$currentOpener,title:t.i18n.get("rules-inline.title")};i.on("close",this._closeRulesPopup,this),s["class"]="sf-rules-inline",this._rulesPopup=new u(s),this._rulesPopup.open()}},_confirm:function(){var e={},n=this,r=this._executeUpdateAction();e[this.options.field]=this._selectedCatId,t.mask(n._categoryEditor.accessibleSelector!=null?n._categoryEditor.accessibleSelector.$el:n._categoryEditor.$el,t.MASK_LOADING),t.when(r(this.model,e)).done(function(){t.unmask(n._categoryEditor.accessibleSelector!=null?n._categoryEditor.accessibleSelector.$el:n._categoryEditor.$el),n.trigger("datagrid:editor:confirm"),n._categoryEditor.accessibleSelector!=null?n._categoryEditor.accessibleSelector.trigger("cancel"):n._categoryEditor.trigger("cancel"),n._rulesPopup!=null&&n._rulesPopup.close()}).fail(function(e){t.unmask(n.$el),n._discard(),n._categoryEditor.close(),console.error("[TransactionCAtegoryEditor] Transaction category update error",e),n.publish("error",e)})},_executeUpdateAction:function(){var e=this.model.has("transactions");return e?t.bind(this.transactionsService.multipleUpdate,this.transactionsService):t.bind(this.transactionsService.update,this.transactionsService)},_closeRulesPopup:function(){this.options.popup||this._rulesPopup!=null?this._rulesPopup.remove():this._categoryEditor.accessibleSelector.trigger("cancel"),this._discard()}},{ID:"transactions-category-editor"});return a}),define("modules/transactions-category-editor/transactions-category-editor-module-extension",["jQuery","utils/util","modules/transactions-category-editor/transactions-category-editor-module","modules/category-selector/category-selector-module","services/transactions-service","hbs!modules/transactions-datagrid/editors/templates/transaction-category-editor","modules/rules-inline/rules-inline-module","ui/modules/popup/popup-module"],function(e,t,n,r,i,s,o,u){var a=n.extend({addRule:function(n){var r=this._categoryEditor.constructor;if(r.ID&&r.ID==="category-columns")this._selectedCatId=parseInt(n.id,10),this.rulesView=new o(t.extend({catId:n.id,category:n.name,applyOnce:t.bind(this._confirm,this),closeCallback:t.bind(this._closeRulesPopup,this),model:this.model,parentCategory:n.parentCat,popup:!1},this.contextConfig)),e("#render-rules-view").html(this.rulesView.render().el);else{this._selectedCatId=parseInt(n.id,10);var i=new o(t.extend({catId:n.id,category:n.name,applyOnce:t.bind(this._confirm,this),model:this.model,popup:!0,closeCallback:t.bind(this._closeRulesPopup,this)},this.contextConfig)),s={$container:this.options.$popupContainer,contentView:i,$opener:this.$currentOpener,title:t.i18n.get("rules-inline.title")};i.on("close",this._closeRulesPopup,this),s["class"]="sf-rules-inline",s.standAlone=!this.config.isPlatform,this._rulesPopup=new u(s),this._rulesPopup.open()}},_closeRulesPopup:function(){this._super.apply(this,arguments)},_renderCategorySelector:function(){t.pushToDataLayer({eventCategory:"PFM Movimientos-Editar Movimiento",eventAction:"Boton",eventLabel:"Edición Categorias",event:"eventClick"}),this._super.apply(this,arguments)}});return a}),define("hbs!modules/transactions-datagrid/templates/transactions-datagrid",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function a(e,t){return" sf-hide-chan-doc "}function f(e,t){return" sf-show-chan-doc "}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u=this;s+='<div class="sf-transactions-grid ',o=n["if"].call(t,t.hideChannelAndDoc,{hash:{},inverse:u.program(3,f,i),fn:u.program(1,a,i)});if(o||o===0)s+=o;return s+='"></div>',s});return t.registerPartial("modules_transactions-datagrid_templates_transactions-datagrid",n),n}),define("hbs!modules/transactions-datagrid/templates/formatters/description",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){var r="",i,s;return r+='\n	<span class="sf-scissors-icon" title="',s={hash:{}},r+=a((i=n.t,i?i.call(e,"transactions-datagrid.splitTooltip",s):u.call(e,"t","transactions-datagrid.splitTooltip",s)))+'"></span>\n',r}function h(e,t){var r="",i,s;return r+='\n	<a href="javascript:void(0);"  class="sf-not-computable-icon" tabindex="0" title="',s={hash:{}},r+=a((i=n.t,i?i.call(e,"transactions-datagrid.excludeTooltip",s):u.call(e,"t","transactions-datagrid.excludeTooltip",s)))+'"></a>\n',r}function p(e,t){var r="",i;return r+='\n	<a href="javascript:void(0);" class="sf-editor-trigger" title="<b>',(i=n.name)?i=i.call(e,{hash:{}}):(i=e.name,i=typeof i===f?i.apply(e):i),r+=a(i)+"</b><br/>",(i=n.realName)?i=i.call(e,{hash:{}}):(i=e.realName,i=typeof i===f?i.apply(e):i),r+=a(i)+'">',(i=n.name)?i=i.call(e,{hash:{}}):(i=e.name,i=typeof i===f?i.apply(e):i),r+=a(i)+'<span class="sf-editor-trigger-icon">\n		<img src="resources/pfm/ui/css/icons/app-icons/dav-edit.png" width="20" height="20">\n	</span></a>\n',r}function d(e,t){var r="",i;return r+='\n	<span title="<b>',(i=n.name)?i=i.call(e,{hash:{}}):(i=e.name,i=typeof i===f?i.apply(e):i),r+=a(i)+"</b><br/>",(i=n.realName)?i=i.call(e,{hash:{}}):(i=e.realName,i=typeof i===f?i.apply(e):i),r+=a(i)+'">',(i=n.name)?i=i.call(e,{hash:{}}):(i=e.name,i=typeof i===f?i.apply(e):i),r+=a(i)+"</span>\n",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u=n.helperMissing,a=this.escapeExpression,f="function",l=this;s+="<span>\n",o=n["if"].call(t,t.isSplit,{hash:{},inverse:l.noop,fn:l.program(1,c,i)});if(o||o===0)s+=o;s+="\n",o=n.unless.call(t,t.computable,{hash:{},inverse:l.noop,fn:l.program(3,h,i)});if(o||o===0)s+=o;s+="\n",o=n["if"].call(t,t.editable,{hash:{},inverse:l.program(7,d,i),fn:l.program(5,p,i)});if(o||o===0)s+=o;return s+="\n</span>\n",s});return t.registerPartial("modules_transactions-datagrid_templates_formatters_description",n),n}),define("hbs!modules/transactions-datagrid/templates/formatters/category",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i;return(i=n.parentName)?i=i.call(e,{hash:{}}):(i=e.parentName,i=typeof i===u?i.apply(e):i),r+=a(i)+"<br/>",r}function c(e,t){var r="",i;r+='\n		<div class="sf-sub-cat">\n			<span style="background-color: #',(i=n.color)?i=i.call(e,{hash:{}}):(i=e.color,i=typeof i===u?i.apply(e):i),r+=a(i)+';" class="sf-category-color"></span>\n		</div>\n		<div class="sf-main-cat">\n			',i=n["if"].call(e,e.hasParent,{hash:{},inverse:f.program(6,p,t),fn:f.program(4,h,t)});if(i||i===0)r+=i;return r+="\n		</div>\n	",r}function h(e,t){var r;return(r=n.parentName)?r=r.call(e,{hash:{}}):(r=e.parentName,r=typeof r===u?r.apply(e):r),a(r)}function p(e,t){var r;return(r=n.catName)?r=r.call(e,{hash:{}}):(r=e.catName,r=typeof r===u?r.apply(e):r),a(r)}function d(e,t){var r="",i;r+='\n		<div class="sf-sub-cat"><span style="background-color: #',(i=n.color)?i=i.call(e,{hash:{}}):(i=e.color,i=typeof i===u?i.apply(e):i),r+=a(i)+';" class="sf-category-color"></span>\n		<div class="sf-main-cat">',i=n["if"].call(e,e.hasParent,{hash:{},inverse:f.program(6,p,t),fn:f.program(4,h,t)});if(i||i===0)r+=i;r+="</div>\n			",i=n["if"].call(e,e.editable,{hash:{},inverse:f.program(11,m,t),fn:f.program(9,v,t)});if(i||i===0)r+=i;r+="\n		</div>\n\n		",i=n["if"].call(e,e.editable,{hash:{},inverse:f.noop,fn:f.program(13,g,t)});if(i||i===0)r+=i;return r+="\n	",r}function v(e,t){var r="",i;return r+='\n				<a href="javascript:void(0);" class="sf-editor-trigger sf-trigger-cat">',(i=n.catName)?i=i.call(e,{hash:{}}):(i=e.catName,i=typeof i===u?i.apply(e):i),r+=a(i)+"</a>\n			",r}function m(e,t){var r="",i;return r+="\n				",(i=n.catName)?i=i.call(e,{hash:{}}):(i=e.catName,i=typeof i===u?i.apply(e):i),r+=a(i)+"\n			",r}function g(e,t){return'\n			<a href="javascript:void(0);" class="sf-editor-trigger sf-editor-icon">\n			<span class="sf-editor-trigger-icon">\n				<img src="resources/pfm/ui/css/icons/app-icons/dav-edit.png" width="20" height="20">\n			</span>\n			</a>\n		'}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div title="',o=n["if"].call(t,t.hasParent,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;s+="<b>",(o=n.catName)?o=o.call(t,{hash:{}}):(o=t.catName,o=typeof o===u?o.apply(t):o),s+=a(o)+'</b>">\n	',o=n["if"].call(t,t.hideSubcat,{hash:{},inverse:f.program(8,d,i),fn:f.program(3,c,i)});if(o||o===0)s+=o;return s+="\n\n\n</div>\n",s});return t.registerPartial("modules_transactions-datagrid_templates_formatters_category",n),n}),define("hbs!modules/transactions-datagrid/templates/formatters/date",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s,o,u=n.helperMissing,a=this.escapeExpression;return o={hash:{}},a((s=n.formatDate,s?s.call(t,t.date,"short",o):u.call(t,"formatDate",t.date,"short",o)))});return t.registerPartial("modules_transactions-datagrid_templates_formatters_date",n),n}),define("hbs!modules/transactions-datagrid/templates/formatters/amount",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){return"sf-positive-amount"}function d(e,t){return"sf-negative-amount"}function v(e,t){var r="",i,s,o;r+=" ",o={hash:{},inverse:f.noop,fn:f.program(6,m,t)},(i=n.if_istouch)?i=i.call(e,o):(i=e.if_istouch,i=typeof i===l?i.apply(e):i),n.if_istouch||(i=c.call(e,i,o));if(i||i===0)r+=i;r+=' title="',o={hash:{noTag:!0}},s=(i=n.formatAmount,i?i.call(e,e.cuxAmnt,o):h.call(e,"formatAmount",e.cuxAmnt,o));if(s||s===0)r+=s;return r+='"',r}function m(e,t){return'touch-tooltip = "true"'}function g(e,t){var r="",i,s,o;r+="\n		",o={hash:{noTag:!0}},s=(i=n.formatAmount,i?i.call(e,e.cuxAmnt,o):h.call(e,"formatAmount",e.cuxAmnt,o));if(s||s===0)r+=s;return r+="\n	",r}function y(e,t){var r="",i,s,o;r+="\n		",o={hash:{curr:"{{currency}}"}},s=(i=n.formatAmount,i?i.call(e,e.amount,o):h.call(e,"formatAmount",e.amount,o));if(s||s===0)r+=s;return r+="\n	",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=this,l="function",c=n.blockHelperMissing,h=n.helperMissing;s+='<span class="',o=n["if"].call(t,t.isPositive,{hash:{},inverse:f.program(3,d,i),fn:f.program(1,p,i)});if(o||o===0)s+=o;s+='"',a={hash:{},inverse:f.noop,fn:f.program(5,v,i)},u=(o=n.ifnequal,o?o.call(t,t.amount,t.cuxAmnt,a):h.call(t,"ifnequal",t.amount,t.cuxAmnt,a));if(u||u===0)s+=u;s+=">\n	",u=n["if"].call(t,t.isPdf,{hash:{},inverse:f.program(10,y,i),fn:f.program(8,g,i)});if(u||u===0)s+=u;return s+="\n\n</span>",s});return t.registerPartial("modules_transactions-datagrid_templates_formatters_amount",n),n}),define("hbs!modules/transactions-datagrid/templates/formatters/tags",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i;return r+='\n		<a href="javascript:void(0);" class="sf-editor-trigger">',(i=n.tags)?i=i.call(e,{hash:{}}):(i=e.tags,i=typeof i===u?i.apply(e):i),r+=a(i)+'<span class="sf-editor-trigger-icon"></span></a>\n	',r}function c(e,t){var r="",i;return r+="\n		",(i=n.tags)?i=i.call(e,{hash:{}}):(i=e.tags,i=typeof i===u?i.apply(e):i),r+=a(i)+"\n	",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div title="',(o=n.tags)?o=o.call(t,{hash:{}}):(o=t.tags,o=typeof o===u?o.apply(t):o),s+=a(o)+'">\n	',o=n["if"].call(t,t.editable,{hash:{},inverse:f.program(3,c,i),fn:f.program(1,l,i)});if(o||o===0)s+=o;return s+="\n</div>",s});return t.registerPartial("modules_transactions-datagrid_templates_formatters_tags",n),n}),define("hbs!modules/transactions-datagrid/templates/formatters/channel",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression;return s+='<div title="',(o=n.channel)?o=o.call(t,{hash:{}}):(o=t.channel,o=typeof o===u?o.apply(t):o),s+=a(o)+'">\n	<span class="sf-channel-name">',(o=n.channel)?o=o.call(t,{hash:{}}):(o=t.channel,o=typeof o===u?o.apply(t):o),s+=a(o)+"</span>\n</div>",s});return t.registerPartial("modules_transactions-datagrid_templates_formatters_channel",n),n}),define("hbs!modules/transactions-datagrid/templates/formatters/document",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression;return s+='<div title="',(o=n.document)?o=o.call(t,{hash:{}}):(o=t.document,o=typeof o===u?o.apply(t):o),s+=a(o)+'">\n	<span class="sf-document-value">',(o=n.document)?o=o.call(t,{hash:{}}):(o=t.document,o=typeof o===u?o.apply(t):o),s+=a(o)+"</span>\n</div>",s});return t.registerPartial("modules_transactions-datagrid_templates_formatters_document",n),n}),define("hbs!modules/transactions-datagrid/templates/formatters/account",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression;return s+='<div title="',(o=n.account)?o=o.call(t,{hash:{}}):(o=t.account,o=typeof o===u?o.apply(t):o),s+=a(o)+'">\n	<span class="sf-account-value">',(o=n.account)?o=o.call(t,{hash:{}}):(o=t.account,o=typeof o===u?o.apply(t):o),s+=a(o)+"</span>\n</div>",s});return t.registerPartial("modules_transactions-datagrid_templates_formatters_account",n),n}),define("libs/require/css/css!modules/transactions-datagrid/css/transactions-datagrid",[],function(){}),define("modules/transactions-datagrid/transactions-datagrid-details-module",["jQuery","classes/layout","services/transactions-service","services/categories-service","ui/modules/datagrid/transactions-v-datagrid-module","ui/modules/datagrid/datagrid-module","modules/transactions-category-editor/transactions-category-editor-module","modules/category-selector/category-selector-module","modules/rules-inline/rules-inline-module","hbs!modules/transactions-datagrid/templates/transactions-datagrid","hbs!modules/transactions-datagrid/templates/formatters/description","hbs!modules/transactions-datagrid/templates/formatters/category","hbs!modules/transactions-datagrid/templates/formatters/date","hbs!modules/transactions-datagrid/templates/formatters/amount","hbs!modules/transactions-datagrid/templates/formatters/tags","hbs!modules/transactions-datagrid/templates/formatters/channel","hbs!modules/transactions-datagrid/templates/formatters/document","hbs!modules/transactions-datagrid/templates/formatters/account","utils/util","utils/amount","utils/date","utils/mask","css!modules/transactions-datagrid/css/transactions-datagrid"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y){function E(e,t,n,r){var i=e.get("date").getTime(),s;return n>0&&(s=t.at(n-1).get("date").getTime()),s===i&&(r.classes=r.classes||[],r.classes.push("sf-repeated-date")),s=i,h({date:e.get("date")})}function S(e,t,n){return{name:e.get(t.field),realName:e.get("realName")===e.get(t.field)?"":e.get("realName"),isSplit:e.has("parentOpId"),editable:e.get("providerStatusId")=="PENDING"?0:y.isFunction(t.editor),computable:e.get("computable"),isPlatform:n.isPlatform}}function x(e,t,n,r){var i=e.get("category"),s;return i.get("parent")!==undefined?s={hasParent:!0,parentName:i.get("parent").get("catName"),parentCatId:i.get("parent").get("catId"),catName:i.get("catName"),color:i.get("catHexrgbcolor"),editable:e.get("providerStatusId")=="PENDING"?0:y.isFunction(t.editor),isPlatform:n.isPlatform}:s={hasParent:!1,catName:i.get("catName"),catId:i.get("catId"),color:i.get("catHexrgbcolor"),editable:e.get("providerStatusId")=="PENDING"?0:y.isFunction(t.editor),isPlatform:n.isPlatform},s.hideSubcat=r==="transactions-pdf",s}function T(e,t,n,r){var i=e.get("category").get("catName"),o=t.get("category").get("catName");return s._basicComparator(i.toUpperCase(),o.toUpperCase(),e,t,r)}function N(e,t,n,r){var i=e.get("amount"),o=t.get("amount"),u=s._basicComparator(i,o,e,t,r);return u}function C(e,t,n){return{name:e.get(t.field),isSplit:e.has("parentOpId"),editable:y.isFunction(t.editor),computable:e.get("computable"),tags:e.get("tags"),isPlatform:n.isPlatform}}function k(e,t){return{document:e.get("document")||""}}var b=s.DatagridColumn,w=t.extend({template:f,ui:{datagrid:".sf-transactions-grid"},events:{"click .sf-transactions-toggle":"toggleTransactionsGrid","click .sf-not-computable-icon":"_markComputable"},filtersList:["category","categories","accounts","datesRange","mode","minAmount","maxAmount","minAbsAmount","maxAbsAmount","freeText","name"],initialize:function(){this.config.gridConfig.isTagsActive||(this.config.gridConfig.columnDefs=y.without(this.config.gridConfig.columnDefs,y.find(this.config.gridConfig.columnDefs,{field:"tags"}))),this.config.fullColumnGrid!==undefined?this.hideChannelAndDoc=!this.config.fullColumnGrid:this.hideChannelAndDoc=!this.config.isPlatform&&this.contextConfig.widget.id==="details",this.hideChannelAndDoc&&(this.config.gridConfig.columnDefs=y.without(this.config.gridConfig.columnDefs,y.find(this.config.gridConfig.columnDefs,{field:"document"})),this.config.gridConfig.columnDefs=y.without(this.config.gridConfig.columnDefs,y.find(this.config.gridConfig.columnDefs,{field:"channel"}))),this.transactionsService=n.getInstance(),this.categoriesService=r.getInstance(),this.transactionsServiceResult=null,this.categoriesServiceResult=null,this.transactionsList=null,this.categoriesList=null,this._setupColumnsConfig()},onClose:function(){this.datagrid.close(),this.transactionsServiceResult&&this.transactionsServiceResult.dispose(),this.categoriesServiceResult&&this.categoriesServiceResult.dispose()},onShow:function(){this.config.gridConfig.filterFunction=this._getFilterFunction();var t=y.extend({},this.contextConfig,{config:this.config.gridConfig,container:this.ui.datagrid});this.config.vitualRendering===!1?this.datagrid=new s(t):this.datagrid=new i(t),this.datagrid.on("change",this._publishChanges,this),this.datagrid.on("sort",this._publishSort,this),this.datagrid.on("element:selected",this._publishSelect,this);var n=this;this.datagrid._resolveEditorData=function(e){return e.field==="catId"?{categories:n.categoriesList}:{}},this.datagrid._editableActivated=function(t){var n=e(t.target).closest("td"),r=n.index(),i=n.closest("tr").data("id"),s=this.ui.tableHeader.find("th").eq(r).data("field"),o=i,u=s;if(this.currentEditorEle===o&&this.currentEditorField===u)return!1;this.currentEditorEle=o,this.currentEditorField=u;var a=this.getElementById(i),f=this._getColumnConfig(s);return f.columnClass==="sf-desc-col"&&y.pushToDataLayer({eventCategory:"PFM Movimientos-Editar Movimiento",eventAction:"Boton",eventLabel:"Edición Descripción",event:"eventClick"}),console.log("[Datagrid] clicked on cell %s for element %s",s,i),this.currentEditor!==null&&this._closeCurrentEditor(),y.isFunction(f.editor)&&this._createEditor(f,a,n,t),!0},this.datagrid.render(),this._showData()},getClosestTransaction:function(e){return this.datagrid.getClosestElement(e)},_showData:function(){if(!this.datagrid)return;y.mask(this.datagrid.$el,y.MASK_LOADING);var e=this;this.categoriesList===null?y.when(this._getCategories()).done(function(t){e.categoriesList=t.data.categories,e.categoriesServiceResult&&e.categoriesServiceResult.dispose(),e.categoriesServiceResult=t,e.categoriesServiceResult.on("all",e._categoriesChanged,e),e._showData()}).fail(function(t){console.error("[TransactionsDatagrid] categories retrieval error",t),e.publish("error",t)}):y.when(this._getData()).done(function(t){e.transactionsServiceResult&&e.transactionsServiceResult.dispose(),e.contextConfig.widget.id==="analysis"&&e.config.obligacionesFinancierasCatId&&!e.filters.category&&e.filters.mode==="expenses"&&e.excludeSpecialCategoryData(t),e.transactionsServiceResult=t,e.transactionsList=t.data;var n=t.data.models.map(function(e){return{opId:e.get("id"),acTypeId:e.get("accType")}});e.config.isPlatform?e.saveFullTableXls():e.savePartialTableXls(),e.publish("pdfIds",n),e._renderData()}).fail(function(t){console.error("[TransactionsDatagrid] transactions retrieval error",t),e.publish("error",t)})},savePartialTableXls:function(){var t=this.transactionsList.map(function(e,t){var n={isPositive:e.get("amount")>=0,amount:e.get("amount"),cuxAmnt:e.get("cuxAmnt")};return{date:h({date:e.get("date")}).replace(/(\r\n\t|\n|\r\t)/gm,"").replace(/<\/?[^>]+(>|$)/g,"").trim(),amount:p(n).replace(/(\r\n\t|\n|\r\t)/gm,"").replace(/<\/?[^>]+(>|$)/g,"").trim(),desc:e.get("name"),acct:e.get("accName"),maincat:e.get("catName")}}),n="<table>";n+="<tr><th>"+y.i18n.get("transactions-datagrid.header.date")+"</th>"+"<th>"+y.i18n.get("transactions-datagrid.header.amount")+"</th>"+"<th>"+y.i18n.get("transactions-datagrid.header.name")+"</th>"+"<th>"+y.i18n.get("transactions-datagrid.header.accName")+"</th>"+"<th>"+y.i18n.get("transactions-datagrid.header.catId")+"</th>"+"</tr>";for(var r=0;r<t.length;r++)n+="<tr><td>"+t[r].date+"</td>"+"<td>"+t[r].amount+"</td>"+"<td>"+t[r].desc+"</td>"+"<td>"+t[r].acct+"</td>"+"<td>"+t[r].maincat+"</td>"+"</tr>";n+="</table>";var i="sf-xls-invisible-container";e("#"+i).html(n)},saveFullTableXls:function(){var t=this.transactionsList.map(function(e,t){var n={isPositive:e.get("amount")>=0,amount:e.get("amount"),cuxAmnt:e.get("cuxAmnt")},r=e.get("office"),i=r!==null&&r!==undefined?r:"",s=e.get("document"),o=s!==null&&s!==undefined?s:"";return{date:h({date:e.get("date")}).replace(/(\r\n\t|\n|\r\t)/gm,"").replace(/<\/?[^>]+(>|$)/g,"").trim(),amount:p(n).replace(/(\r\n\t|\n|\r\t)/gm,"").replace(/<\/?[^>]+(>|$)/g,"").trim(),desc:e.get("name"),acct:e.get("accName"),maincat:e.get("catName"),canal:i,doc:o}}),n="<table>";n+="<tr><th>"+y.i18n.get("transactions-datagrid.header.date")+"</th>"+"<th>"+y.i18n.get("transactions-datagrid.header.amount")+"</th>"+"<th>"+y.i18n.get("transactions-datagrid.header.name")+"</th>"+"<th>"+y.i18n.get("transactions-datagrid.header.accName")+"</th>"+"<th>"+y.i18n.get("transactions-datagrid.header.catId")+"</th>"+"<th>"+y.i18n.get("transactions-datagrid.header.channel")+"</th>"+"<th>"+y.i18n.get("transactions-datagrid.header.document")+"</th>"+"</tr>";for(var r=0;r<t.length;r++)n+="<tr><td>"+t[r].date+"</td>"+"<td>"+t[r].amount+"</td>"+"<td>"+t[r].desc+"</td>"+"<td>"+t[r].acct+"</td>"+"<td>"+t[r].maincat+"</td>"+"<td>"+t[r].canal+"</td>"+"<td>"+t[r].doc+"</td>"+"</tr>";n+="</table>";var i="sf-xls-invisible-container";e("#"+i).html(n)},excludeSpecialCategoryData:function(e){var t=this;e.data.models=y.filter(e.data.models,function(e){return e.get("category").get("catId")===t.config.obligacionesFinancierasCatId?!1:e.get("category").get("parentCatId")===t.config.obligacionesFinancierasCatId?!1:!0})},_getFilterFunction:function(){return this.transactionsService._getFilterFunction(this._getFilters())},_categoriesChanged:function(e,t){console.log("[TransactionsDatagrid] Categories changed"),this.categoriesList=t.data.categories,e!=="add"&&(console.log("[TransactionsDatagrid] Categories change involves re-rendering transactions"),this._renderData())},_getData:function(){var e={fromDate:this.filters.datesRange.fromDate,toDate:this.filters.datesRange.toDate},t=this._getFilters();return this.transactionsService.get(e,t)},_getFilters:function(){return y.merge({},this.filters,{computable:this.config.showExcluded?null:!0})},_getCategories:function(){var e=new y.Deferred,t=!1,n;return y.when(this.categoriesService.getPlainCategories()).then(function(r){t=!0,n=r,e.resolve(r)}),t?n:e.promise()},_filtersChanged:function(e){console.log("[TransactionsDatagrid] Filters changed"),e==="mode"&&(this.filters.category=this.config.filters.category=null),this._updateGrid(),this._showData()},_renderData:function(){var e=y.date.truncate("day",y.date.today());this.isClosed||(this.transactionsList&&y.map(this.transactionsList.models,function(t){t.set("rowClass","",{silent:!0}),t.get("providerStatusId")=="PENDING"&&t.set("rowClass","sf-transaction-status-pending",{silent:!0}),t.get("date")>e&&t.set("rowClass","sf-transaction-status-future",{silent:!0}),t.get("providerStatusId")!=="PENDING"&&t.get("date")<=e&&(t.get("parentOpId")?t.set("rowClass","sf-transaction-splitted sf-transaction-editable",{silent:!0}):t.set("rowClass","sf-transaction-editable",{silent:!0}))}),this.datagrid.renderElements(this.transactionsList),this.datagrid.filter(this._getFilterFunction()),this.$el.find("table .sf-transaction-status-pending:first").removeClass("sf-last-pending").addClass("sf-first-pending"),this.$el.find("table .sf-transaction-status-pending:last").removeClass("sf-first-pending").addClass("sf-last-pending"),this.datagrid._closeCurrentEditor(),this.trigger("transactions:rendered"))},_updateGrid:function(){this.datagrid&&this.datagrid.filter(this._getFilterFunction())},_setupColumnsConfig:function(){var e=[];for(var t=0;t<this.config.gridConfig.columnDefs.length;t++){var n=this.config.gridConfig.columnDefs[t];n=y.extend({parent:this},n),n.labelKey!==undefined&&(n.label=y.i18n.get(n.labelKey)),e.push(new b(n))}this.config.gridConfig.columns=e},_publishChanges:function(e){this.publish("transactions:datagrid:change",{count:e.length,totalAmount:y.amount.format(e.reduce(function(e,t){return e+parseFloat(t.get("cuxAmnt"))},0)),appliedFilters:y.clone(this.filters,!0),collection:e}),y.unmask(this.datagrid.$el)},_publishSort:function(e){this.publish("transactions:datagrid:sort",e)},_publishSelect:function(e,t){this.publish("transactions:datagrid:select",e,t)},_markComputable:function(t){console.log("[TransactionsDatagrid] Mark transaction as computable");var n=e(t.currentTarget);n.hide();var r=this.datagrid.getClosestElement(t.target),i=this;r&&y.when(this.transactionsService.update(r,{computable:!0})).fail(function(e){console.error("[TransactionsDatagrid] error marking as computable",e),i.publish("error",e),n.show()})},serializeData:function(){return{hideChannelAndDoc:this.hideChannelAndDoc}}},{ID:"transactions-datagrid",submodules:[s,i,u,a],defaults:{vitualRendering:!0,showExcluded:!0,filters:{datesRange:{fromDate:new Date((new Date).getFullYear(),(new Date).getMonth()-2,1)}},gridConfig:{emptyMessageKey:"transactions-datagrid.emptyMessage",visibleRows:15,sortField:"date",sortDirection:"DESC",isTagsActive:!1,columnDefs:[{field:"date",headerClass:"sf-date-header",columnClass:"sf-date-col",labelKey:"transactions-datagrid.header.date",formatter:E,serializeData:function(e){return e},sortable:!0},{field:"amount",headerClass:"sf-amount-header sf-numeric",columnClass:"sf-numeric sf-amount-col",labelKey:"transactions-datagrid.web.header.amount",formatter:function(e,t,n,r,i,s){var o=e;return e.toJSON&&(o=e.toJSON()),s==="transactions-pdf"&&(o.isPdf=!0),o.isPositive=o.amount>=0,p(o)},serializeData:function(e){return e},sortable:!0,comparator:N},{field:"name",headerClass:"sf-desc-header",columnClass:"sf-desc-col",labelKey:"transactions-datagrid.header.name",formatter:l,serializeData:S,sortable:!0,comparator:"string"},{field:"accName",headerClass:"sf-acc-header",columnClass:"sf-acc-col",labelKey:"transactions-datagrid.header.accName",formatter:g,sortable:!0,serializeData:function(e){return{account:e.get("accName")}},comparator:"string"},{field:"catId",headerClass:"sf-cat-header",columnClass:"sf-cat-col",labelKey:"transactions-datagrid.header.catId",formatter:c,editor:o,serializeData:x,sortable:!0,comparator:T},{field:"channel",formatter:v,headerClass:"sf-channel-header",columnClass:"sf-channel-col",labelKey:"transactions-datagrid.header.channel",serializeData:function(e){return{channel:e.get("office")||""}},sortable:!1,comparator:"string"},{field:"tags",formatter:d,headerClass:"sf-tags-header",columnClass:"sf-tags-col",labelKey:"transactions-datagrid.header.channel",serializeData:C,sortable:!0,comparator:"string"},{field:"document",formatter:m,headerClass:"sf-document-header",columnClass:"sf-document-col",labelKey:"transactions-datagrid.header.document",serializeData:k,sortable:!1,comparator:"string"}]}}});return w._dateFormatter=E,w._descSerializer=S,w._categoryDataSerializer=x,w._categoryComparator=T,w._amountComparator=N,w._tagsSerializer=C,w._documentSerializer=k,w}),define("hbs!modules/transactions-datagrid/editors/templates/transaction-name-editor",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<form data-validate="parsley" class="sf-tooltip-errors sf-tr-name-editor">\n	<span class="sf-form-row">\n	',u={hash:{name:"name","class":"sf-text-editor",validateField:"transaction.name",value:"{{{value}}}"}},s+=f((o=n.textfield,o?o.call(t,u):a.call(t,"textfield",u)))+"\n	</span>\n</form>",s});return t.registerPartial("modules_transactions-datagrid_editors_templates_transaction-name-editor",n),n}),define("modules/transactions-datagrid/editors/transaction-name-editor",["utils/util","ui/modules/datagrid/editors/text-editor","hbs!modules/transactions-datagrid/editors/templates/transaction-name-editor","services/transactions-service","utils/validator","utils/mask"],function(e,t,n,r){var i=t.extend({template:n,events:{submit:"_confirm"},initialize:function(){e.extend(this.events,t.prototype.events),this.transactionsService=r.getInstance(),this._super()},_processKeyPress:function(e){switch(e.keyCode){case 27:this._discard()}},onRender:function(){this._super(),e.validator.validate(this.$el)},_confirm:function(t){t.preventDefault();if(!e.validator.isValid(this.$el))return;var n={},r=this._super,i=this;n[this.options.field]=this.ui.editor.val();var s=this.options.$widget;e.mask(s,e.MASK_LOADING),e.when(this.transactionsService.update(this.model,n)).done(function(){r.call(i),console.log("[TransactionNameEditor] Successful transaction name update"),e.unmask(s)}).fail(function(t){e.unmask(s),console.error("[TransactionNameEditor] Transaction name update error",t),i.publish("error",t)})}});return i}),define("hbs!modules/transactions-datagrid/editors/templates/transaction-tags-editor",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<form data-validate="parsley" class="sf-tooltip-errors">\n	<span class="sf-form-row">\n		',u={hash:{name:"tags","class":"sf-text-editor",validateField:"transaction.tags",value:"{{{value}}}"}},s+=f((o=n.textfield,o?o.call(t,u):a.call(t,"textfield",u)))+"\n	</span>\n</form>",s});return t.registerPartial("modules_transactions-datagrid_editors_templates_transaction-tags-editor",n),n}),define("modules/transactions-datagrid/editors/transaction-tags-editor",["utils/util","ui/modules/datagrid/editors/text-editor","hbs!modules/transactions-datagrid/editors/templates/transaction-tags-editor","services/transactions-service","utils/validator","utils/mask"],function(e,t,n,r){var i=t.extend({template:n,events:{submit:"_confirm"},initialize:function(){e.extend(this.events,t.prototype.events),this.transactionsService=r.getInstance(),this._super()},_processKeyPress:function(e){switch(e.keyCode){case 27:this._discard()}},onRender:function(){this._super(),e.validator.validate(this.$el)},_confirm:function(t){t.preventDefault();if(!e.validator.isValid(this.$el))return;var n={},r=this._super,i=this;n[this.options.field]=this.ui.editor.val();var s=this.options.$widget;e.mask(s,e.MASK_LOADING),e.when(this.transactionsService.update(this.model,n)).done(function(){r.call(i),console.log("[TransactionTagsEditor] Successful transaction tags update"),e.unmask(s)}).fail(function(t){e.unmask(s),console.error("[TransactionTagsEditor] Transaction tags update error",t),i.publish("error",t)})}});return i}),define("hbs!widgets/details/templates/details-table",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-details-table-container">\n	<span class="sf-details-table-view-placeholder"></span>\n</div>'});return t.registerPartial("widgets_details_templates_details-table",n),n}),define("hbs!widgets/details/templates/formatters/edit",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<button class="sf-button sf-button-edit sf-edit-trigger" type="button">\n	<img src="resources/pfm/ui/css/icons/app-icons/dav-edit.png" width="20" height="20">\n</button>\n'});return t.registerPartial("widgets_details_templates_formatters_edit",n),n}),define("widgets/details/views/details-grid-view",["jQuery","classes/layout","services/transactions-service","modules/transactions-datagrid/transactions-datagrid-module","modules/transactions-datagrid/editors/transaction-name-editor","modules/transactions-datagrid/editors/transaction-tags-editor","modules/transactions-edit/transactions-edit-module","hbs!widgets/details/templates/details-table","hbs!widgets/details/templates/formatters/edit","ui/modules/popup/popup-module","is!mobile-browser","utils/util"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=t.extend({template:u,regions:{detailsTableContentRegion:".sf-details-table-view-placeholder"},events:{"click .sf-edit-trigger":"_showEditForm","click .sf-transactions-grid .sf-datagrid-body tr":"_showEditForm"},initialize:function(){this._super.apply(this,arguments),this.transactionService=n.getInstance()},onShow:function(){var e={formatter:a,headerClass:"sf-edit-header",columnClass:"sf-edit",sortable:!1},t=c.cloneDeep(r.defaults.gridConfig);t.columnDefs.push(e);if(this.config.descriptionEditable){var n=c.find(t.columnDefs,function(e){return e.field==="name"});n.editor=i}if(this.config.tagsEditable){var o=c.find(t.columnDefs,function(e){return e.field==="tags"});o.editor=s}this.datagrid=new r(c.extend({},this.contextConfig,{config:{gridConfig:t}})),this.detailsTableContentRegion.show(this.datagrid)},_showEditForm:function(t){if(t.currentTarget.className.indexOf("sf-edit-trigger")<0&&!l)return;var n=e(t.currentTarget),r={$container:this.options.$popupContainer,$opener:n,title:c.i18n.get("details.editForm.title"),closeCallback:c.bind(this._onCancel,this)},i=this;r["class"]="sf-edit-transaction-form-popup";var s=this.datagrid.getClosestTransaction(n),u=new o(c.extend({},this.contextConfig,{transaction:s}));this.datagrid.on("transactions:rendered",function(){var e=i.datagrid.getClosestTransaction(n);u.updateSelectors(e)}),u.on("cancel",this._onCancel,this),u.on("done",this._onDone,this),u.on("show",this._openEditForm,this),r.contentView=u,this.popup=new f(r)},_openEditForm:function(){this.popup.open()},_onCancel:function(){this._hideEditForm()},_onDone:function(){this._hideEditForm()},_hideEditForm:function(){this.popup.remove()}},{defaults:{descriptionEditable:!0,tagsEditable:!1}});return h}),define("widgets/details/views/details-grid-view-extension",["jQuery","widgets/details/views/details-grid-view","services/transactions-service","modules/transactions-datagrid/transactions-datagrid-details-module","modules/transactions-datagrid/editors/transaction-name-editor","modules/transactions-datagrid/editors/transaction-tags-editor","modules/transactions-edit/transactions-edit-module","hbs!widgets/details/templates/details-table","hbs!widgets/details/templates/formatters/edit","ui/modules/popup/popup-module","is!mobile-browser","utils/util"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=t.extend({onShow:function(){var e=this,t={formatter:a,headerClass:"sf-edit-header",columnClass:"sf-edit",sortable:!1,serializeData:function(){return{isPlatform:e.config.isPlatform}}},n=c.cloneDeep(r.defaults.gridConfig);n.columnDefs.unshift(t);if(this.config.descriptionEditable){var o=c.find(n.columnDefs,function(e){return e.field==="name"});o.editor=i}if(this.config.tagsEditable){var u=c.find(n.columnDefs,function(e){return e.field==="tags"});u.editor=s}this.datagrid=new r(c.extend({},this.contextConfig,{config:{gridConfig:n}})),this.detailsTableContentRegion.show(this.datagrid)},_showEditForm:function(t){if(t.currentTarget.className.indexOf("sf-edit-trigger")<0&&!l)return;c.pushToDataLayer({eventCategory:"PFM Movimientos",eventAction:"Boton",eventLabel:"Editar Movimiento",event:"eventClick"});var n=e(t.currentTarget),r=this,i,s=n.closest("tr").hasClass("sf-transaction-status-pending");if(s)i={$container:this.$el,$opener:n,content:c.i18n.get("details.pendingTransactionDisclaimer"),type:f.INFO,closeCallback:c.bind(this._closeInfoPopup,this),maskClass:"sf-dark-mask",standAlone:!this.config.isPlatform},this.popup=new f(i),this.popup.open();else{i={$container:this.options.$popupContainer,$opener:n,title:c.i18n.get("details.editForm.webTitle"),disableClosePopup:!0,closeCallback:c.bind(this._onCancel,this)},i["class"]="sf-edit-transaction-form-popup";var u=this.datagrid.getClosestTransaction(n),a=new o(c.extend({},this.contextConfig,{transaction:u}));this.datagrid.on("transactions:rendered",function(){var e=r.datagrid.getClosestTransaction(n);a.updateSelectors(e)}),a.on("cancel",this._onCancel,this),a.on("done",this._onDone,this),a.on("show",this._openEditForm,this),i.contentView=a,this.popup=new f(i)}},_onCancel:function(){c.pushToDataLayer({eventCategory:"PFM Movimientos-Editar Movimiento",eventAction:"Boton",eventLabel:"Cancelar",event:"eventClick"}),this._super.apply(this,arguments)},_onDone:function(){c.pushToDataLayer({eventCategory:"PFM Movimientos-Editar Movimiento",eventAction:"Boton",eventLabel:"Guardar",event:"eventClick"}),this._super.apply(this,arguments)},_closeInfoPopup:function(){this.popup.remove()}});return h}),define("hbs!widgets/details/templates/details-content",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div>\n	<div class="sf-details-filter-wrapper sf-clearfix">\n		<div class="sf-details-filter-placeholder"></div>\n	</div>\n	<div class="sf-details-table-placeholder"></div>\n	<div class="sf-transactions-disclaimer">\n		',u={hash:{}},s+=f((o=n.t,o?o.call(t,"details.disclaimer",u):a.call(t,"t","details.disclaimer",u)))+'\n	</div>\n	<div class="sf-actions-export-wrap"></div>\n	<div class="sf-add-new-tx-wrapper">\n		',u={hash:{"class":"sf-add-transaction",text:"details.addTransactionButton",type:"button"}},s+=f((o=n.button,o?o.call(t,u):a.call(t,"button",u)))+"\n	</div>\n</div>",s});return t.registerPartial("widgets_details_templates_details-content",n),n}),define("data/analysis/analysis-category-model",["classes/model","utils/date"],function(e,t){var n=e.extend({parse:function(e){var n=this._super(e);return n.month!==undefined&&(n.monthDate=t.date.parseBackendDate(n.month)),n.accType!==undefined&&n.accId!==undefined&&(n.accountPK=n.accType+"-"+n.accId),n}});return n}),define("data/analysis/analysis-category-collection",["classes/collection","data/analysis/analysis-category-model"],function(e,t){var n=e.extend({model:t});return n}),define("data/analysis/analysis-income-category-collection",["classes/collection","data/analysis/analysis-category-collection"],function(e,t){var n=t.extend({url:"/analysis/incomes/get.action"});return n}),define("data/analysis/analysis-expenses-category-collection",["classes/collection","data/analysis/analysis-category-collection"],function(e,t){var n=t.extend({url:"/analysis/expenses/get.action"});return n}),define("data/analysis/analysis-data-manager",["classes/data-manager","utils/util","data/categories/categories-data-manager","data/accounts/accounts-data-manager","data/transactions/transactions-data-manager","data/analysis/analysis-category-model","data/analysis/analysis-income-category-collection","data/analysis/analysis-expenses-category-collection"],function(e,t,n,r,i,s,o,u){var a=n.events.CATEGORY_CHANGE,f=n.events.CATEGORY_REMOVE,l=i.events.TRANSACTION_CHANGE,c=i.events.TRANSACTION_REMOVE,h=i.events.TRANSACTION_ADD,p=i.events.TRANSACTION_SPLIT,d=i.events.TRANSACTION_UNSPLIT,v=i.events.TRANSACTION_AMOUNT_CHANGE,m=i.events.TRANSACTION_CATEGORY_CHANGE,g=i.events.TRANSACTION_DATE_CHANGE,y=i.events.TRANSACTION_COMPUTABLE_CHANGE,b=r.events.ACCOUNTS_UPDATE,w=[a,f,h,g,v,c,m,y,l,p,d,"rule:add","rule:change","rule:remove",b],E=e.extend({initialize:function(){this._super.apply(this,arguments),this.collectionDefs={income:{type:o,loader:{method:this.get,context:this,params:{mode:E.INCOME_MODE}},subscriptions:w},expenses:{type:u,loader:{method:this.get,context:this,params:{mode:E.EXPENSES_MODE}},subscriptions:w}},this.categoriesDM=n.getInstance(),this.accountsDM=r.getInstance()},get:function(e){var t=e&&e.mode?e.mode:E.EXPENSES_MODE,n=this.getCollection(t,{force:e?e.force:undefined}),r=this.categoriesDM.get(),i=this.accountsDM.get();return this._wireRelationships(n,r,i)},getByCatId:function(e){var t=e.mode===E.INCOME_MODE,n=t?"income":"expenses",r=t?o:u,i=n+"-"+e.catId;return this.collectionDefs[i]||this.registerCollection(i,{type:r,loader:{method:this.getByCatId,context:this,params:{mode:e.mode,catId:e.catId}},subscriptions:w}),this.getCollection(i,{force:e?e.force:undefined,"params.catId":e.catId})},_wireRelationships:function(e,n,r){var i=new t.Deferred;return t.when(e,n,r).done(function(e,n,r){t.map(e.models,function(e){return e.set({category:n.hash[e.get("catId")],account:r.hash[e.get("accountPK")]},{silent:!0}),e}),i.resolve(e)}).fail(function(e){i.reject(e)}),i.promise()}},{INCOME_MODE:"income",EXPENSES_MODE:"expenses"});return E}),define("services/analysis-service",["classes/service","data/analysis/analysis-data-manager","classes/resource-loader","classes/collection","utils/util","utils/date"],function(e,t,n,r,i){function s(e,t,n,r){this.id=this.catId,this.amount=0,this.transactions=0,this.dateEntries={},this.subCats={},this.catName=t||"",this.catId=e||0,this.parentCatId=r||null,this.catColor="#"+(n||"CCCCCC")}var o=e.extend({initialize:function(){this._super.apply(this,arguments),this.analysisDM=t.getInstance(),this.resources={},this.resources[o.INCOME_MODE]=new n(this.analysisDM,this.analysisDM.get,{mode:o.INCOME_MODE}),this.resources[o.EXPENSES_MODE]=new n(this.analysisDM,this.analysisDM.get,{mode:o.EXPENSES_MODE})},get:function(e){var t=this.resources[e.mode],n=function(){return this.parseAnalysis(t,e)};return this.executeJob(this,n,[t])},getAverage:function(e){var t,r=o.EXPENSES_MODE+"-"+e.catId;this.resources[r]?t=this.resources[r]:t=this.resources[r]=new n(this.analysisDM,this.analysisDM.getByCatId,e);var i=function(){return this._getAverageData(t,e)};return this.executeJob(this,i,[t])},_getAverageData:function(e,t){var n=this._filterAverageData(e.data,t.catId);return{historic:n,average:this._calculateAverage(n)}},_filterAverageData:function(e,t){var n=i.filter(e.models,function(e){return e.get("catId")===t});return n=i.groupBy(n,function(e){return e.get("month")}),n=i.map(n,function(e,t){return{month:t,amount:i.reduce(e,function(e,t){return e+Math.abs(t.get("amount"))},0)}}),new r(n)},_calculateAverage:function(e){var t=0,n=i.reduce(e.models,function(e,n){var r=n.get("amount"),s=i.date.parseBackendDate(n.get("month"));return!r||i.date.difference(i.date.constructor.MONTH,s,i.date.today())===0?r=0:t+=1,e+r},0)/(t===0?1:t);return n},getSubEntry:function(e,t){var n=i.find(e,function(e){return e.subCats[t]});return n?n.subCats[t]:null},getSubEntries:function(e,t){if(t!=null){if(t===0)return[e[0]];if(e[t])return e[t].subCats;var n=this.getSubEntry(e,t);return n?[n]:{}}return e},parseAnalysis:function(e,t){var n=i.filter(e.data.models,function(e){return this._filterAnalysis(e,t)},this),r={amount:0,transactions:0},o=i.reduce(n,function(e,t){var n=t.get("category").id,i=t.get("category").get("catName"),o=t.get("category").get("catHexrgbcolor");r.amount+=t.get("amount"),r.transactions+=t.get("number");if(t.get("category").get("catLevel")===0){var u=e[n]=e[n]||new s(n,i,o);u=this._parseAnalysisEntry(u,t)}else if(t.get("category").get("catLevel")===1){var a=t.get("category").get("parent"),f=a.id,l=a.get("catName"),c=a.get("catHexrgbcolor"),h=e[f]=e[f]||new s(f,l,c);h=this._parseAnalysisEntry(h,t);var p=h.subCats[n]=h.subCats[n]||new s(n,i,o,f);p=this._parseAnalysisEntry(p,t)}return e},{},this);return{collection:o,totals:r}},_parseAnalysisEntry:function(e,t){var n=t.get("month");return e.amount+=t.get("amount"),e.transactions+=t.get("number"),e.dateEntries[n]||(e.dateEntries[n]={amount:0,transactions:0,catColor:t.catColor}),e.dateEntries[n].amount+=t.get("amount"),e.dateEntries[n].transactions+=t.get("number"),e},_filterAnalysis:function(e,t){if(!t)return!0;var n=t.accounts?t.accounts.selected:null;if(n!==undefined&&n!==null&&!i.contains(n,e.get("accountPK")))return!1;if(t.datesRange){var r=t.datesRange.fromDate,s=t.datesRange.toDate;if(r!==undefined&&r.getTime()>e.get("monthDate").getTime())return!1;if(s!==undefined&&s.getTime()<e.get("monthDate").getTime())return!1}return!0}},{ID:"analysis-service",INCOME_MODE:t.INCOME_MODE,EXPENSES_MODE:t.EXPENSES_MODE});return o.AnalysisEntryPO=s,o}),define("services/analysis-service-extension",["services/analysis-service","data/analysis/analysis-data-manager","classes/resource-loader","classes/collection","utils/util","utils/date"],function(e,t,n,r,i){var s=e.extend({_filterAnalysis:function(e,t){if(!t)return!0;var n=t.accounts?t.accounts.selected:null;if(n!==undefined&&n!==null){n=this._encodeAccTypes(n);if(!i.contains(n,e.get("accountPK")))return!1}if(t.datesRange){var r=t.datesRange.fromDate,s=t.datesRange.toDate;if(r!==undefined&&r.getTime()>e.get("monthDate").getTime())return!1;if(s!==undefined&&s.getTime()<e.get("monthDate").getTime())return!1}return!0},_encodeAccTypes:function(e){var t=e.slice();for(var n=0;n<t.length;n++)t[n][0]==="4"&&(t[n]=t[n].replace("4","0"));return t}});return s}),define("services/transactions-export-service",["classes/service","services/analysis-service","utils/util"],function(e,t,n){var r=e.extend({doExport:function(e,t){t=this._prepareFiltersForBackend(t),window.location=n.config.getGlobals().environment.contextPath+"/data/export/"+e.toLowerCase()+".action?"+n.param(t)},_prepareFiltersForBackend:function(e){var r={freeText:"keyword",minDate:"fromDate",fromDate:"fromDateStr",toDate:"toDateStr",minAmount:"minAbsAmount",maxAmount:"maxAbsAmount",name:"keyword",category:"catId",field:"orderByColumn",direction:"orderByDirection"},i={date:"OP_DATE",name:"OP_NAME",catid:"CATEGORY_NAME",amount:"AMOUNT",acname:"ACCOUNT_REAL_ID"},s,o,u,a;return o=n.reduce(e,function(e,o,f){typeof r[f]!="undefined"?(e[r[f]]=o,s=f,f=r[f]):e[f]=o;switch(f){case"datesRange":e.fromDateStr=n.date.formatBackendDate(o.fromDate),e.toDateStr=n.date.formatBackendDate(o.toDate),delete e.datesRange;break;case"keyword":n.trim(e.keyword)?e.filterOnlyColumn=s==="freeText"?"ALL":"name":e=n.omit(e,"keyword");break;case"accounts":a=n.reduce(e[f].selected,function(e,t){return u=t.split("-"),u.length>1&&(e.acTypes.push(u[0]),e.acIdAutoNum.push(u[1])),e},{acIdAutoNum:[],acTypes:[]}),n.extend(e,a),delete e[f];break;case"orderByColumn":u=e[f].toLowerCase(),e[f]=i[u];break;case"mode":e[f]===t.INCOME_MODE?e.minAmount=0:e[f]===t.EXPENSES_MODE&&(e.maxAmount=0),delete e[f]}return e},{}),{params:o}}},{ID:"transactions-export-service"});return r}),define("services/transactions-export-service-extension",["services/transactions-export-service","services/analysis-service","utils/util","jQuery","ui/modules/popup/popup-module"],function(e,t,n,r,i){var s=e.extend({safariFileDownload:function(e,t){var n=document.createElement("a");n.setAttribute("href","data:text/csv;charset=utf-8,"+encodeURI(e)),n.setAttribute("download","Transactions.csv");var r=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1,altKey:!0});n.dispatchEvent(r)},doExport:function(e,t,i){t=this._prepareFiltersForBackend(t,i);var s=new XMLHttpRequest,o=this,u=function(){return Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0},a=n.config.getGlobals().httpHeaders.HTTP_STRANDS_USER,f=n.config.getGlobals().httpHeaders.OLB_SESSION_TRACK_ID?n.config.getGlobals().httpHeaders.OLB_SESSION_TRACK_ID:"testOLBSession",l="Mis movimientos-"+n.date.format(n.date.today(),"dd/MM/yyyy")+".xls";this.$=r,this._httpStrandsUser=a,this._olbSessionTrackId=f,this._fileType=e,this._fromDate=t.params.fromDateStr,this._toDate=t.params.toDateStr,n.mask(r(".sf-details-table-container"),n.MASK_LOADING),s.onreadystatechange=function(){if(s.readyState===4&&s.status===200){var e;if(s.response!=null)e=s.response;else{var t=new Uint8Array(s.responseText.length);for(var r=0;r<s.responseText.length;r++)t[r]=s.responseText.charCodeAt(r)&255;e=new Blob([t],{encoding:"UTF-8",type:"text/csv;charset=UTF-8"})}if(navigator.appVersion.toString().indexOf(".NET")>0)window.navigator.msSaveBlob(e,l);else{var a=window.URL.createObjectURL(e),f=document.createElement("a");f.href=a,s.getResponseHeader("content-disposition")!=null?f.setAttribute("download",l):f.download=l,u()?o.safariFileDownload(s.response,i):f.click()}n.unmask(o.$(".sf-details-table-container"))}},s.open("GET",n.config.getGlobals().environment.contextPath+"/data/export/"+e.toLowerCase()+".action?"+n.param(t)),n.each(n.config.getGlobals().httpHeaders,function(e,t){s.setRequestHeader(t,e)}),s.responseType="blob",s.send(),s.overrideMimeType("text/plain; charset=x-user-defined")},_prepareFiltersForBackend:function(e,r){var i={freeText:"keyword",minDate:"fromDate",fromDate:"fromDateStr",toDate:"toDateStr",minAmount:"minAbsAmount",maxAmount:"maxAbsAmount",name:"keyword",category:"catId",field:"orderByColumn",direction:"orderByDirection"},s={date:"OP_DATE",name:"OP_NAME",catid:"CATEGORY_NAME",amount:"AMOUNT",acname:"ACCOUNT_REAL_ID"},o,u,a,f;return u=n.reduce(e,function(e,r,u){typeof i[u]!="undefined"?(e[i[u]]=r,o=u,u=i[u]):e[u]=r;switch(u){case"datesRange":e.fromDateStr=n.date.formatBackendDate(r.fromDate),e.toDateStr=n.date.formatBackendDate(r.toDate),delete e.datesRange;break;case"keyword":n.trim(e.keyword)?e.filterOnlyColumn=o==="freeText"?"ALL":"name":e=n.omit(e,"keyword");break;case"accounts":f=n.reduce(e[u].selected,function(e,t){return a=t.split("-"),a.length>1&&(e.acTypes.push(a[0]),e.acIdAutoNum.push(a[1])),e},{acIdAutoNum:[],acTypes:[]}),n.extend(e,f),delete e[u];break;case"orderByColumn":a=e[u].toLowerCase(),e[u]=s[a];break;case"mode":e[u]===t.INCOME_MODE?e.minAmount=0:e[u]===t.EXPENSES_MODE&&(e.maxAmount=0),delete e[u]}return e},{}),u.filterColOps=[],u.filterColOps.push(r?"platform":"standalone"),{params:u}}});return s}),define("hbs!modules/transactions-export/templates/transactions-export",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-transactions-export">\n    <span class="sf-download-label">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"transactions-export.label",u):a.call(t,"t","transactions-export.label",u)))+'</span>\n    <button class="sf-button sf-export-button sf-export-pdf" tabindex="0" type="button" data-format="pdf">\n		<span class="sf-icon-container sf-container-pdf">\n			<img src="resources/pfm/ui/css/icons/app-icons/pdf-01.svg" width="29" height="25" alt="pdf">\n		</span>\n        <span class="sf-button-text">PDF</span>\n    </button>\n    <button class="sf-button sf-export-button sf-export-xls" tabindex="0" type="button" data-format="xls">\n		<span class="sf-icon-container sf-container-xls">\n			<img src="resources/pfm/ui/css/icons/app-icons/excel.svg" width="29" height="25" alt="xls">\n		</span>\n        <span class="sf-button-text">XLS</span>\n    </button>\n</div>\n',s});return t.registerPartial("modules_transactions-export_templates_transactions-export",n),n}),define("modules/transactions-export/transactions-export-module",["classes/item-view","services/transactions-export-service","hbs!modules/transactions-export/templates/transactions-export","utils/util","utils/i18n"],function(e,t,n,r){var i=e.extend({template:n,ui:{exportSelector:"select.sf-export-format",exportBtn:".sf-export-button"},events:{"change select.sf-export-format":"_downloadExportedFile","click .sf-export-button":"_downloadExportedFile"},filtersList:["category","accounts","datesRange","mode","minAmount","maxAmount","minAbsAmount","maxAbsAmount","freeText","name"],hubEvents:{"transactions:datagrid:change":"_updateTransactionFilters","transactions:datagrid:sort":"_updateTransactionSort","transactions:export":"_exportHandler"},initialize:function(){this._super.apply(this,arguments),this.formatOptions=[],this.config.formatList.length>1&&(this.formatOptions=[{name:r.i18n.get("transactions-export.formats.select"),value:"-1"}]),r.each(this.config.formatList,function(e){this.formatOptions.push({name:r.i18n.get("transactions-export.formats."+e),value:e})},this),this.serviceInstance=t.getInstance()},serializeData:function(){return this.formatOptions.length===1?{singleFormat:this.formatOptions[0].value,name:r.i18n.get("transactions-export.title")+" "+this.formatOptions[0].name}:{formatOptions:this.formatOptions}},_downloadExportedFile:function(){var e=this.ui.exportSelector,t=this.ui.exportBtn,n=e.val()||t.data("format");n&&n!=="-1"&&(e.length&&(e.val("-1"),e.trigger("change")),this._export(n))},_exportHandler:function(e){this._export(e.format)},_export:function(e){e&&r.contains(this.config.formatList,e)?this.serviceInstance.doExport(e,this.filters):console.error("[TransactionsExport] _export(%s)... Format not recognized",e)},_filtersChanged:function(){},_updateTransactionFilters:function(e){this._filtersChanged(e.appliedFilters)},_updateTransactionSort:function(e){this._filtersChanged(e)}},{ID:"transactions-export",services:[t],defaults:{formatList:["xls","csv"]}});return i}),define("services/reports-service",["classes/service","utils/util"],function(e,t){var n=e.extend({getReport:function(e,n){var r=t.config.getGlobals().environment.contextPath+"/reports/generate/get.action"+(e?"?reportConfig="+JSON.stringify(e):""),i=new XMLHttpRequest,s="financialReport-"+t.date.format(t.date.today(),"dd/MM/yyyy")+".pdf";i.onreadystatechange=function(){if(i.readyState==4&&i.status==200){var e;if(i.response!=null)e=i.response;else{var t=new Uint8Array(i.responseText.length);for(var r=0;r<i.responseText.length;r++)t[r]=i.responseText.charCodeAt(r)&255;e=new Blob([t],{encoding:"UTF-8",type:"text/plain;charset=UTF-8"})}if(navigator.userAgent.indexOf("MSIE")!==-1||navigator.appVersion.indexOf("Trident/")>0){window.navigator.msSaveOrOpenBlob(e,s);return}var o=window.URL.createObjectURL(e),u=document.createElement("a");u.href=o,i.getResponseHeader("content-disposition")!=null?u.setAttribute("download",s):u.download=s;if(navigator.userAgent.search("Firefox")>-1){var a=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});u.dispatchEvent(a)}else u.click();n.publish("reportDownloaded")}},i.open("GET",r),t.each(t.config.getGlobals().httpHeaders,function(e,t){i.setRequestHeader(t,e)}),i.responseType="blob",i.overrideMimeType("text/plain; charset=x-user-defined"),i.send()}},{ID:"reports-service"});return n}),define("services/reports-service-extension",["services/reports-service","utils/util"],function(e,t){var n=e.extend({getNewReport:function(e,n,r){var i=t.config.getGlobals().environment.contextPath;i+="/reports/generate/getNew.action?fullColumnGrid="+e.toString();var s=function(e,t){return e.concat(t)};i+="&idsPdfs="+n.map(function(e){return e.opId+","+e.acTypeId}).reduce(s,[]);var o=new XMLHttpRequest,u="Mis movimientos-"+t.date.format(t.date.today(),"dd/MM/yyyy")+".pdf";o.onreadystatechange=function(){if(o.readyState==4&&o.status==200){var e;if(o.response!=null)e=o.response;else{var t=new Uint8Array(o.responseText.length);for(var n=0;n<o.responseText.length;n++)t[n]=o.responseText.charCodeAt(n)&255;e=new Blob([t],{encoding:"UTF-8",type:"text/plain;charset=UTF-8"})}if(navigator.userAgent.indexOf("MSIE")!==-1||navigator.appVersion.indexOf("Trident/")>0){window.navigator.msSaveOrOpenBlob(e,u);return}var i=window.URL.createObjectURL(e),s=document.createElement("a");s.href=i,o.getResponseHeader("content-disposition")!=null?s.setAttribute("download",u):s.download=u;if(navigator.userAgent.search("Firefox")>-1){var a=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});s.dispatchEvent(a)}else s.click();r.publish("reportDownloaded")}},o.open("GET",i),t.each(t.config.getGlobals().httpHeaders,function(e,t){o.setRequestHeader(t,e)}),o.responseType="blob",o.overrideMimeType("text/plain; charset=x-user-defined"),o.send()},getReport:function(e,n){var r=t.config.getGlobals().environment.contextPath+"/reports/generate/get.action"+(e?"?reportConfig="+JSON.stringify(e):""),i=new XMLHttpRequest,s="Mis movimientos-"+t.date.format(t.date.today(),"dd/MM/yyyy")+".pdf";i.onreadystatechange=function(){if(i.readyState==4&&i.status==200){var e;if(i.response!=null)e=i.response;else{var t=new Uint8Array(i.responseText.length);for(var r=0;r<i.responseText.length;r++)t[r]=i.responseText.charCodeAt(r)&255;e=new Blob([t],{encoding:"UTF-8",type:"text/plain;charset=UTF-8"})}if(navigator.userAgent.indexOf("MSIE")!==-1||navigator.appVersion.indexOf("Trident/")>0){window.navigator.msSaveOrOpenBlob(e,s);return}var o=window.URL.createObjectURL(e),u=document.createElement("a");u.href=o,i.getResponseHeader("content-disposition")!=null?u.setAttribute("download",s):u.download=s;if(navigator.userAgent.search("Firefox")>-1){var a=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});u.dispatchEvent(a)}else u.click();n.publish("reportDownloaded")}},i.open("GET",r),t.each(t.config.getGlobals().httpHeaders,function(e,t){i.setRequestHeader(t,e)}),i.responseType="blob",i.overrideMimeType("text/plain; charset=x-user-defined"),i.send()}});return n}),define("modules/transactions-export/transactions-export-module-extension",["modules/transactions-export/transactions-export-module","services/transactions-export-service","services/reports-service","jQuery","hbs!modules/transactions-export/templates/transactions-export","utils/util","utils/i18n"],function(e,t,n,r,i,s){var o=e.extend({hubEvents:{"transactions:datagrid:change":"_updateTransactionFilters","transactions:datagrid:sort":"_updateTransactionSort","transactions:export":"_exportHandler",pdfIds:"setNewPdfIds"},setNewPdfIds:function(e){this.idsPdfs=e},initialize:function(){this._super.apply(this,arguments),this.reportService=n.getInstance()},_downloadExportedFile:function(e){var t=e.currentTarget.attributes["data-format"].value;t==="pdf"?(s.pushToDataLayer({eventCategory:"PFM Movimientos",eventAction:"Boton",eventLabel:"Descargar PDF",event:"eventClick"}),this.saveNewPDF()):(s.pushToDataLayer({eventCategory:"PFM Movimientos",eventAction:"Boton",eventLabel:"Descargar XLS",event:"eventClick"}),this._export(t))},saveNewPDF:function(){this.publish("reportDownloading");var e=!1;this.config.isPlatform&&(e=!0),this.reportService.getNewReport(e,this.idsPdfs,this)},savePDF:function(){function e(e){return(e<10?"0":"")+e}function t(t){return t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate())}this.publish("reportDownloading");var n=!1;this.config.isPlatform&&(n=!0);var r=t(s.date._subtractDays(this.filters.datesRange.fromDate,1)),i=t(this.filters.datesRange.toDate),o={accounts:this.filters.accounts,datesRange:{fromDate:r,toDate:i},fullColumnGrid:n};this.filters.freeText&&(o.freeText=this.filters.freeText);var u=JSON.stringify(o),a={widgetsConfig:{"transactions-pdf":{pdfConfig:u}}};this.reportService.getNewReport(a,this)},serializeData:function(){return{pdfFormat:"pdf",pdfName:this.formatOptions[1].name,xlsFormat:"xls",xlsName:"Mis movimientos-"+s.date.format(s.date.today(),"dd_MM_yyyy")+".xls",isPlatform:this.config.isPlatform}}},{defaults:{formatList:["pdf","xls"]}});return o}),define("libs/require/css/css!widgets/details/css/details",[],function(){}),define("widgets/details/views/details-content-view",["classes/layout","utils/util","jQuery","ui/modules/popup/popup-module","ui/modules/reform/select/select-module","modules/rules/rules-module","modules/transactions-filters/transactions-filters-module","widgets/details/views/details-grid-view","hbs!widgets/details/templates/details-content","modules/transactions-export/transactions-export-module","css!widgets/details/css/details"],function(e,t,n,r,i,s,o,u,a,f){var l=e.extend({template:a,regions:{detailsFilterRegion:".sf-details-filter-placeholder",detailsTableRegion:".sf-details-table-placeholder",exportRegion:".sf-actions-export-wrap"},events:{"click button.sf-manage-rules-button":"_openRulesManager"},onRender:function(){this._super(),this._onRender()},_onRender:function(){this.detailsTableRegion.show(new u(this.contextConfig)),this.detailsFilterRegion.show(new o(this.contextConfig)),this.exportRegion.show(new f(this.contextConfig)),i.init(this.$el)},_openRulesManager:function(e){console.log("Details Content View] Open Rules Manager!");var i=n(e.currentTarget),o={$container:this.options.$popupContainer,$opener:i,title:t.i18n.get("details.rulesPopup.title"),closeCallback:t.bind(this._closeRulesManager,this)};o["class"]="sf-rules-manager-popup";var u=new s(this.contextConfig);u.on("cancel",this._closeRulesManager,this),u.on("rulesViewsLoaded",this._openRulesManagerForm,this),o.contentView=u,this.popup=new r(o)},_openRulesManagerForm:function(){this.popup.open()},_closeRulesManager:function(){this.popup.remove()}});return l}),define("widgets/details/views/details-content-view-extension",["widgets/details/views/details-content-view","utils/util","jQuery","ui/modules/popup/popup-module","ui/modules/reform/select/select-module","modules/rules/rules-module","modules/transactions-edit/transactions-edit-module","modules/transactions-filters/transactions-filters-module","modules/transactions-details-filters/transactions-details-filters-module","widgets/details/views/details-grid-view","services/accounts-service","hbs!widgets/details/templates/details-content","modules/transactions-export/transactions-export-module","utils/tooltip","css!widgets/details/css/details"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p=e.extend({hubEvents:{reportDownloading:"_reportDownloading",reportDownloaded:"_unmask"},template:c,filtersList:["accounts","timerange"],regions:{detailsFilterRegion:".sf-details-filter-placeholder",detailsTableRegion:".sf-details-table-placeholder",exportRegion:".sf-actions-export-wrap"},events:{"click button.sf-manage-rules-button":"_openRulesManager","click .sf-add-transaction":"_addTransaction","click .sf-rules-manager-help":"_openHelpRulesPopup","click .sf-tx-add-name-help":"_openHelpDescAddPopup"},_addTransaction:function(e){t.pushToDataLayer({eventCategory:"PFM Movimientos",eventAction:"Boton",eventLabel:"Quiero registrar otros movimientos",event:"eventClick"});var n=t.filter(this.accountsList.data.accounts,function(e){return e.groupName==="Cash Account"})[0],i=n.elements[0],s=n.key.split("-")[0],u=i.id,a=i.type,f=new o(t.extend({},this.contextConfig,{isIncome:!1,accId:u,uscId:s,accType:a})),l=this.$el.closest(".sf-platform");this.addTransactionPopup=new r({title:t.i18n.get("details.addTransactionPopupTitle"),subtitle:t.i18n.get("details.addTransactionPopupSubtitle"),contentView:f,$container:this.$el,$opener:this.$(e.currentTarget),disableClosePopup:!0,"class":"sf-add-tx-popup",cancelCallback:function(){t.pushToDataLayer({eventCategory:"PFM Movimientos-Quiero registrar otros movimientos",eventAction:"Boton",eventLabel:"Cancelar",event:"eventClick"}),f.trigger("cancel")}}),this.addTransactionPopup.open(),f.on("done",this._onTransactionAdded,this),f.on("cancel",this._closeTxEditPopup,this)},_closeTxEditPopup:function(){this.addTransactionPopup.remove()},_onTransactionAdded:function(){t.pushToDataLayer({eventCategory:"PFM Movimientos-Quiero registrar otros movimientos",eventAction:"Boton",eventLabel:"Guardar",event:"eventClick"}),this.addTransactionPopup.remove()},initialize:function(){this._super.apply(this,arguments),this.accountsService=l.getInstance()},render:function(e){var n=this;if(e)return this._super(e);t.mask(this.$el),t.when(this.accountsService.getAccountList(1)).done(function(e){n.accountsList=e,t.unmask(n.$el),n.render(!0)}).fail(function(e){console.error("[AlertsConfig] Error while updating Alerts Config",e),n.publish("error",e)})},onRender:function(){this._super();var e=this;this._setupAccountsFilter(this.accountsService,function(){e._onRender()})},_onRender:function(){var e=new a(this.contextConfig);this.detailsTableRegion.show(new f(this.contextConfig)),this.detailsFilterRegion.show(e),this.exportRegion.show(new h(this.contextConfig)),i.init(this.$el)},_openRulesManager:function(e){console.log("Details Content View] Open Rules Manager!"),t.pushToDataLayer({eventCategory:"PFM Movimientos",eventAction:"Boton",eventLabel:"Personalizar Movimientos",event:"eventClick"});var i=n(e.currentTarget),o={$container:this.options.$popupContainer,$opener:i,title:t.i18n.get("details.web.rulesPopup.title"),subtitle:t.i18n.get("details.web.rulesPopup.subtitle"),closeCallback:t.bind(this._closeRulesManager,this),titleIcon:"dav-rules",iconExt:"png",disableClosePopup:!0,standAlone:!this.config.isPlatform};o["class"]="sf-rules-manager-popup";var u=new s(this.contextConfig);u.on("cancel",this._closeRulesManager,this),u.on("rulesViewsLoaded",this._openRulesManagerForm,this),u.on("ruleCreated",this._closeRulesManagerAndSave,this),o.contentView=u,this.popup=new r(o)},_openRulesManagerForm:function(){this.popup.open()},_closeRulesManager:function(){t.pushToDataLayer({eventCategory:"PFM Movimientos- Personalizar Movimientos",eventAction:"Boton",eventLabel:"Cancelar",event:"eventClick"}),this.popup.remove()},_closeRulesManagerAndSave:function(){t.pushToDataLayer({eventCategory:"PFM Movimientos- Personalizar Movimientos",eventAction:"Boton",eventLabel:"Guardar",event:"eventClick"}),this.popup.remove()},_openHelpRulesPopup:function(e){t.pushToDataLayer({eventCategory:"PFM Movimientos",eventAction:"Boton",eventLabel:"Tooltip",event:"eventClick"});var i=n(e.currentTarget),s={$container:this.$el,$opener:i,content:t.i18n.get("details.info.rulesManager"),type:r.INFO,closeCallback:t.bind(this._closePopup,this),maskClass:"sf-dark-mask",standAlone:!this.config.isPlatform};this.infoPopup=new r(s),this.infoPopup.open()},_openHelpDescAddPopup:function(e){t.pushToDataLayer({eventCategory:"PFM Movimientos-Quiero registrar otros movimientos",eventAction:"Boton",eventLabel:"Tooltip",event:"eventClick"});var i=n(e.currentTarget),s={$container:this.$el,$opener:i,content:t.i18n.get("details.info.descAdd"),type:r.INFO,closeCallback:t.bind(this._closePopup,this),maskClass:"sf-dark-mask",standAlone:!this.config.isPlatform};this.infoPopup=new r(s),this.infoPopup.open()},_closePopup:function(){this.infoPopup.remove()},_reportDownloading:function(){t.mask(this.$el,t.MASK_LOADING)},_unmask:function(){t.unmask(this.$el)}});return p}),define("widgets/details/details-widget",["classes/ui/widget/widget","widgets/details/views/details-header-view","widgets/details/views/details-content-view","modules/rules/rules-module","modules/accounts-filter/accounts-filter-module","ui/modules/timerange-filter/timerange-filter-module","modules/transactions-edit/transactions-edit-module","modules/transactions-datagrid/transactions-datagrid-module","modules/transactions-filters/transactions-filters-module","modules/transactions-export/transactions-export-module","modules/category-selector/category-selector-module","services/accounts-service","services/transactions-service","utils/util","utils/date","css!widgets/details/css/details"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d=e.extend({initialize:function(){this._super.apply(this,arguments),this.accountsService=c.getInstance(),this._setupDatesRangeFilter()},onShow:function(){p.mask(this.$el,p.MASK_LOADING);var e=this;this._setupAccountsFilter(this.accountsService,function(){e._renderRegions()})},_renderRegions:function(){var e=this;this.headerRegion.show(new t(this.contextConfig)),this.contentRegion.on("show",function(){p.unmask(e.$el)}),p.extend(this.contextConfig,{minDate:this.headerRegion.currentView.timerangeFilterRegion.currentView._minDate}),this.contentRegion.show(new n(this.contextConfig))}},{ID:"details",submodules:[r,i,s,o,u,a,f,l],services:[c,h],defaults:{initialRangeMonths:3}});return d}),define("widgets/details/details-widget-extension",["widgets/details/details-widget","widgets/details/views/details-header-view","widgets/details/views/details-content-view","modules/rules/rules-module","modules/accounts-filter/accounts-filter-module","ui/modules/timerange-filter/timerange-filter-module","modules/transactions-edit/transactions-edit-module","modules/transactions-datagrid/transactions-datagrid-module","modules/transactions-filters/transactions-filters-module","modules/transactions-details-filters/transactions-details-filters-module","modules/transactions-export/transactions-export-module","modules/category-selector/category-selector-module","services/accounts-service","services/transactions-service","utils/util","utils/date","css!widgets/details/css/details"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){var v=e.extend({},{ID:"details",submodules:[r,i,s,o,u,a,l,c,f],defaults:{initialRangeMonths:1}});return v}),define("hbs!modules/analysis-header/templates/analysis-summary",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=n.helperMissing;s+='<div class="sf-analysis-summary">\n	',a={hash:{"class":"sf-summary-amount",title:'{{{t mode context="common.summary" datesRange=dateRangeText}}}',value:"{{{amount}}}"}},u=(o=n.summaryBox,o?o.call(t,a):f.call(t,"summaryBox",a));if(u||u===0)s+=u;s+="\n	",a={hash:{"class":"sf-summary-transactions",title:'{{{t "common.summary.transactions" datesRange=dateRangeText}}}',value:"{{{transactions}}}"}},u=(o=n.summaryBox,o?o.call(t,a):f.call(t,"summaryBox",a));if(u||u===0)s+=u;return s+="\n</div>",s});return t.registerPartial("modules_analysis-header_templates_analysis-summary",n),n}),define("modules/analysis-header/views/analysis-summary-view",["classes/item-view","utils/util","services/analysis-service","hbs!modules/analysis-header/templates/analysis-summary","utils/amount","utils/date"],function(e,t,n,r){var i=e.extend({filtersList:["accounts","datesRange","mode"],template:r,initialize:function(){this._super.apply(this,arguments),this.analysisService=n.getInstance(),this.transactions=0,this.amount=0,this.dateRangeText=t.date.formatSemanticRange(this.filters.datesRange.fromDate,this.filters.datesRange.toDate)},render:function(e){if(e)return this._super();t.when(this.analysisService.get(this.filters)).done(t.bind(this._dataReceived,this)).fail(t.bind(this._dataError,this))},serializeData:function(){return{transactions:t.number.format(this.transactions,!1),amount:t.amount.format(Math.abs(this.amount),!1),mode:this.filters.mode,dateRangeText:"<span class='sf-period'>"+this.dateRangeText+"</span>"}},_dataError:function(e){console.error("[AnalysisSummaryView] Error retrieving analysis data",e),this.publish("error",e)},_dataReceived:function(e){this.analysisDataResult&&this.analysisDataResult.dispose(),this.analysisDataResult=e,this.transactions=this.analysisDataResult.data.totals.transactions,this.amount=this.analysisDataResult.data.totals.amount,this.analysisDataResult.on("change",this._analysisDataChanged,this),this.render(!0)},_analysisDataChanged:function(){console.log("[AnalysisSummaryView] Analysis data changed, redraw"),this.transactions=this.analysisDataResult.data.totals.transactions,this.amount=this.analysisDataResult.data.totals.amount,this.render(!0)},_filtersChanged:function(e,n){if(e==="mode"||e==="accounts"){this.render();return}e==="datesRange"&&(this.dateRangeText=t.date.formatSemanticRange(n.fromDate,n.toDate),this.render()),this.render(!0)}});return i}),define("hbs!modules/analysis-header/templates/analysis-header",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+="<div>\n	",u={hash:{id:"analysis",title:'{{t "analysis-header.title"}}',filtersPlaceholders:t.filtersPlaceholders,summaryPlaceholder:"true"}},s+=f((o=n.header,o?o.call(t,u):a.call(t,"header",u)))+'\n	<div class="cam-recommendation-placeholder"></div>\n</div>',s});return t.registerPartial("modules_analysis-header_templates_analysis-header",n),n}),define("modules/analysis-header/analysis-header-module",["classes/layout","modules/analysis-header/views/analysis-summary-view","modules/accounts-filter/accounts-filter-module","ui/modules/timerange-filter/timerange-filter-module","services/accounts-service","services/analysis-service","hbs!modules/analysis-header/templates/analysis-header","utils/util","utils/i18n"],function(e,t,n,r,i,s,o,u){var a=e.extend({template:o,regions:{accountsfilterRegion:".sf-accounts-filter-placeholder",timerangefilterRegion:".sf-timerange-filter-placeholder",headersummaryRegion:".sf-summary-placeholder"},initialize:function(){this._super.apply(this,arguments),this.accountsService=i.getInstance(),this._setupDatesRangeFilter()},serializeData:function(){return{filtersPlaceholders:["sf-accounts-filter-placeholder","sf-timerange-filter-placeholder"]}},onShow:function(){u.mask(this.$el,u.MASK_LOADING);var e=this;this._setupAccountsFilter(this.accountsService,function(){e._renderRegions(),u.unmask(e.$el)})},_renderRegions:function(){this.headersummaryRegion.show(new t(this.contextConfig)),this.accountsfilterRegion.show(new n(this.contextConfig)),this.timerangefilterRegion.show(new r(u.extend({},this.contextConfig,{config:{rangeSelected:this.config.initialRangeMonths,fromDate:this.config.filters.datesRange.fromDate,toDate:this.config.filters.datesRange.toDate}})))}},{ID:"analysis-header",submodules:[n,r],services:[i,s],defaults:{initialRangeMonths:3,stepScale:"month"}});return a}),define("hbs!ui/modules/mode-filter/templates/mode-filter",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i,s;return r+="\n        ",s={hash:{text:"mode-filter.button.mode.{{name}}",type:"button","class":"sf-mode-filter-item sf-button-{{name}}{{#if selected}} sf-active{{/if}}","data-value":"{{name}}"}},r+=a((i=n.button,i?i.call(e,s):u.call(e,"button",s)))+"\n        ",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u=n.helperMissing,a=this.escapeExpression,f=this;s+='<div class="sf-mode-filter">\n    <div class="sf-mode-filter-buttons">\n        ',o=n.each.call(t,t.modeSelectorOptions,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;return s+="\n    </div>\n</div>",s});return t.registerPartial("ui_modules_mode-filter_templates_mode-filter",n),n}),define("libs/require/css/css!ui/modules/mode-filter/css/mode-filter",[],function(){}),define("ui/modules/mode-filter/mode-filter-module",["classes/item-view","hbs!ui/modules/mode-filter/templates/mode-filter","utils/util","jQuery","css!ui/modules/mode-filter/css/mode-filter"],function(e,t,n,r){var i=e.extend({template:t,events:{"click .sf-mode-filter-item":"_modeChanged"},filtersList:["mode"],initialize:function(){this._super.apply(this,arguments),this._currentMode=this.filters.mode},serializeData:function(){return{modeSelectorOptions:n.map(this.config.selectorModes,function(e){return{name:e,selected:this.filters.mode===e}},this),mode:this.filters.mode}},_filtersChanged:function(e,t){if(e==="mode"){var n=this.$(".sf-button-"+t);n.addClass("sf-active").siblings().removeClass("sf-active")}},_modeChanged:function(e){var t=r(e.currentTarget).data("value");t!==this._currentMode&&(this.publish("filters:change",{filter:"mode",data:t}),this._currentMode=t)}},{ID:"mode-filter",defaults:{selectorModes:["expenses","income"]}});return i}),define("ui/modules/mode-filter/mode-filter-module-extension",["ui/modules/mode-filter/mode-filter-module","jQuery"],function(e,t){var n=e.extend({_modeChanged:function(e){var n=t(e.currentTarget).data("value");n!==this._currentMode&&(this.trigger("mode:change",n),this.publish("filters:change",{filter:"mode",data:n}),this._currentMode=n)}},{});return n}),define("hbs!modules/payees-datagrid/templates/payees-datagrid",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-payees-grid"></div>'});return t.registerPartial("modules_payees-datagrid_templates_payees-datagrid",n),n}),define("hbs!modules/payees-datagrid/templates/formatters/description",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i;return r+='\n	<a href="javascript:void(0);" class="sf-editor-trigger">',(i=n.name)?i=i.call(e,{hash:{}}):(i=e.name,i=typeof i===u?i.apply(e):i),r+=a(i)+'<span class="sf-editor-trigger-icon"></span></a>\n',r}function c(e,t){var r="",i;return r+="\n	",(i=n.name)?i=i.call(e,{hash:{}}):(i=e.name,i=typeof i===u?i.apply(e):i),r+=a(i)+"\n",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=this;s+='<span title="<b>',(o=n.name)?o=o.call(t,{hash:{}}):(o=t.name,o=typeof o===u?o.apply(t):o),s+=a(o)+"</b><br/>",(o=n.realName)?o=o.call(t,{hash:{}}):(o=t.realName,o=typeof o===u?o.apply(t):o),s+=a(o)+'">\n',o=n["if"].call(t,t.editable,{hash:{},inverse:f.program(3,c,i),fn:f.program(1,l,i)});if(o||o===0)s+=o;return s+="\n</span>",s});return t.registerPartial("modules_payees-datagrid_templates_formatters_description",n),n}),define("hbs!modules/payees-datagrid/templates/formatters/category",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i;return(i=n.parentName)?i=i.call(e,{hash:{}}):(i=e.parentName,i=typeof i===u?i.apply(e):i),r+=a(i)+"<br/>",r}function c(e,t){var r;return(r=n.parentName)?r=r.call(e,{hash:{}}):(r=e.parentName,r=typeof r===u?r.apply(e):r),a(r)}function h(e,t){var r;return(r=n.catName)?r=r.call(e,{hash:{}}):(r=e.catName,r=typeof r===u?r.apply(e):r),a(r)}function p(e,t){var r="",i;return r+='\n			<a href="javascript:void(0);" class="sf-editor-trigger">',(i=n.catName)?i=i.call(e,{hash:{}}):(i=e.catName,i=typeof i===u?i.apply(e):i),r+=a(i)+'<span class="sf-editor-trigger-icon"></span></a>\n		',r}function d(e,t){var r="",i;return r+="\n			",(i=n.catName)?i=i.call(e,{hash:{}}):(i=e.catName,i=typeof i===u?i.apply(e):i),r+=a(i)+"\n		",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div title="',o=n["if"].call(t,t.hasParent,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;s+="<b>",(o=n.catName)?o=o.call(t,{hash:{}}):(o=t.catName,o=typeof o===u?o.apply(t):o),s+=a(o)+'</b>">\n	<div class="sf-main-cat">',o=n["if"].call(t,t.hasParent,{hash:{},inverse:f.program(5,h,i),fn:f.program(3,c,i)});if(o||o===0)s+=o;s+='</div>\n	<div class="sf-sub-cat"><span style="background-color: #',(o=n.color)?o=o.call(t,{hash:{}}):(o=t.color,o=typeof o===u?o.apply(t):o),s+=a(o)+';" class="sf-category-color"></span>\n		',o=n["if"].call(t,t.editable,{hash:{},inverse:f.program(9,d,i),fn:f.program(7,p,i)});if(o||o===0)s+=o;return s+="\n	</div>\n</div>",s});return t.registerPartial("modules_payees-datagrid_templates_formatters_category",n),n}),define("hbs!modules/payees-datagrid/templates/formatters/amount",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){return"sf-positive-amount"}function h(e,t){return"sf-negative-amount"}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=this,l=n.helperMissing;s+='<span class="',o=n["if"].call(t,t.isPositive,{hash:{},inverse:f.program(3,h,i),fn:f.program(1,c,i)});if(o||o===0)s+=o;s+='">\n	',a={hash:{}},u=(o=n.formatAmount,o?o.call(t,t.amount,a):l.call(t,"formatAmount",t.amount,a));if(u||u===0)s+=u;return s+="\n</span>",s});return t.registerPartial("modules_payees-datagrid_templates_formatters_amount",n),n}),define("libs/require/css/css!modules/payees-datagrid/css/payees-datagrid",[],function(){}),define("modules/payees-datagrid/payees-datagrid-module",["modules/transactions-datagrid/transactions-datagrid-module","services/transactions-service","services/categories-service","ui/modules/datagrid/v-datagrid-module","modules/transactions-category-editor/transactions-category-editor-module","hbs!modules/payees-datagrid/templates/payees-datagrid","hbs!modules/payees-datagrid/templates/formatters/description","hbs!modules/payees-datagrid/templates/formatters/category","hbs!modules/payees-datagrid/templates/formatters/amount","hbs!modules/transactions-datagrid/templates/formatters/tags","utils/util","utils/amount","utils/date","css!modules/payees-datagrid/css/payees-datagrid"],function(e,t,n,r,i,s,o,u,a,f,l){var c=e.extend({template:s,ui:{datagrid:".sf-payees-grid"},initialize:function(){this.config.gridConfig.isTagsActive||(this.config.payeesGridConfig.columnDefs=l.without(this.config.payeesGridConfig.columnDefs,l.find(this.config.payeesGridConfig.columnDefs,{field:"tags"}))),this._super.apply(this,arguments)},_getData:function(){var e={groupBy:this.constructor.getPayeeGroupBy(),fromDate:this.filters.datesRange.fromDate,toDate:this.filters.datesRange.toDate},t=l.extend({},this.filters,this.refinedFilters);return this.config.showExcluded||l.extend(t,{computable:!0}),this.transactionsService.getGroupedTransactions(e,t)},_updateGrid:function(){this._showData()},_setupColumnsConfig:function(){this.config.gridConfig=this.config.payeesGridConfig,this._super()}},{ID:"payees-datagrid",submodules:[r],getPayeeGroupBy:function(){return[function(e){return e.get("catId")},function(e){return e.get("name")},function(e){return e.get("accountPk")},function(e){return e.get("amount")>=0?"income":"expense"},function(e){return e.get("tags")}]},defaults:{showExcluded:!1,payeesGridConfig:{visibleRows:15,sortField:"name",sortDirection:"ASC",columnDefs:[{field:"name",formatter:o,headerClass:"sf-desc-header",columnClass:"sf-desc-col",labelKey:"payees-datagrid.header.name",serializeData:e._descSerializer,sortable:!0,comparator:"string"},{columnClass:"sf-cat-col",field:"catId",formatter:u,headerClass:"sf-cat-header",editor:i,labelKey:"payees-datagrid.header.catId",serializeData:e._categoryDataSerializer,sortable:!0,comparator:e._categoryComparator},{field:"accName",headerClass:"sf-acc-header",columnClass:"sf-acc-col",labelKey:"payees-datagrid.header.accName",sortable:!0,comparator:"string"},{columnClass:"sf-numeric sf-transactions-col",field:"count",headerClass:"sf-count-header sf-numeric",labelKey:"payees-datagrid.header.count",sortable:!0},{field:"tags",formatter:f,headerClass:"sf-tags-header",columnClass:"sf-tags-col",labelKey:"transactions-datagrid.header.tags",serializeData:e._tagsSerializer,sortable:!0,comparator:"string"},{field:"amount",headerClass:"sf-amount-header sf-numeric",columnClass:"sf-numeric sf-amount-col",labelKey:"payees-datagrid.header.amount",formatter:function(e){var t=e.toJSON();return t.isPositive=t.amount>=0,a(t)},sortable:!0}]}}});return c}),define("hbs!modules/transactions-details/templates/transactions-details",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-transactions-details">\n	<div class="sf-transactions-details-view"></div>\n</div>\n'});return t.registerPartial("modules_transactions-details_templates_transactions-details",n),n}),define("hbs!modules/transactions-details/templates/transactions-details-selector",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i,s;return r+="\n		",s={hash:{textLiteral:'{{t name context="transactions-details.grids" count=count}}',type:"button","class":"sf-{{name}}-trigger sf-grid-selector"}},r+=a((i=n.button,i?i.call(e,s):u.call(e,"button",s)))+"\n	",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u=n.helperMissing,a=this.escapeExpression,f=this;s+='<div class="sf-transactions-details-selector sf-button-group">\n	',o=n.each.call(t,t.grids,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;return s+="\n</div>\n",s});return t.registerPartial("modules_transactions-details_templates_transactions-details-selector",n),n}),define("libs/require/css/css!modules/transactions-details/css/transactions-details",[],function(){}),define("modules/transactions-details/transactions-details-module",["classes/layout","jQuery","modules/transactions-datagrid/transactions-datagrid-module","modules/payees-datagrid/payees-datagrid-module","services/transactions-service","hbs!modules/transactions-details/templates/transactions-details","hbs!modules/transactions-details/templates/transactions-details-selector","utils/util","css!modules/transactions-details/css/transactions-details"],function(e,t,n,r,i,s,o,u){var a=e.extend({template:s,regions:{detailsRegion:".sf-transactions-details-view"},events:{"click .sf-grid-selector":"_gridSelected"},filtersList:["category","categories","accounts","datesRange","mode","minAmount","maxAmount","minAbsAmount","maxAbsAmount","freeText","name"],initialize:function(){this._super.apply(this,arguments),this.grids={transactions:{name:"transactions",constructor:n,options:{config:{gridConfig:{}}},count:0},payees:{name:"payees",constructor:r,options:{config:{payeesGridConfig:{}}},count:0}},this._onDataChange=u.bind(this._onDataChange,this),this.selectedGrid=this.config.initialGrid,this.currentGrid=null,this.transactionsService=i.getInstance(),this.config.showWithParent!==!1&&this.on("render",this.showSelectedGrid,this),this.hub.on("transactions:datagrid:sort",this._sortHandler,this)},_sortHandler:function(e){var t=this.grids[this.selectedGrid],n=this.selectedGrid=="payees"?"payeesGridConfig":"gridConfig";u.extend(t.options.config[n],{sortField:e.field,sortDirection:e.direction})},showSelectedGrid:function(){this._updateGridChoices();var e=this.grids[this.selectedGrid];this.currentGrid=new e.constructor(u.merge({},this.contextConfig,e.options,{config:{showExcluded:this.config.showExcluded}})),this.detailsRegion.show(this.currentGrid)},hideCurrentGrid:function(){this.detailsRegion.close(),this.currentGrid=null},_gridSelected:function(e){var n=t(e.currentTarget),r=u.keys(this.grids),i;for(var s=0;s<r.length;s++)if(n.hasClass("sf-"+r[s]+"-trigger")){i=r[s];break}return i!==this.selectedGrid&&(this.selectedGrid=i,this.hideCurrentGrid(),this.showSelectedGrid()),!1},_filtersChanged:function(e){console.log("[TransactionsDetails] Filters changed"),e==="mode"&&(this.filters.category=this.config.filters.category=null),this._updateGridChoices()},_updateGridChoices:function(){var e=this,t=u.merge({},this.filters,{computable:this.config.showExcluded?null:!0}),n={fromDate:this.filters.datesRange.fromDate,toDate:this.filters.datesRange.toDate},i=u.extend({},n,{groupBy:r.getPayeeGroupBy()});e.dispose(),u.when(this.transactionsService.get(n,t),this.transactionsService.getGroupedTransactions(i,t)).done(function(t,n){e.transactionsResult=t,e.payeesResult=n,e.transactionsResult.data.on("all",e._onDataChange),e.payeesResult.data.on("all",e._onDataChange),e._drawGridChoices(e.transactionsResult.data.length,e.payeesResult.data.length)}).fail(function(t){console.error("[TransactionsDetails] transactions retrieval error",t),e.publish("error",t)})},_onDataChange:function(e){if(e==="add"||e==="remove"||e==="reset"){var t=this;clearTimeout(t.nextUpdate),t.nextUpdate=setTimeout(function(){t._drawGridChoices(t.transactionsResult.data.length,t.payeesResult.data.length)},300)}},_drawGridChoices:function(e,t){console.log("[TransactionsDetails] Transactions received, computing buttons counts"),this.grids.transactions.count=e,this.grids.payees.count=t,this.$(".sf-transactions-details-choices").html(o({grids:this.grids})),this.$(".sf-transactions-details-choices .sf-grid-selector").removeClass("sf-active"),this.$(".sf-transactions-details-choices .sf-grid-selector.sf-"+this.selectedGrid+"-trigger").addClass("sf-active")},dispose:function(){this.payeesResult&&(this.payeesResult.dispose(),this.payeesResult=null),this.transactionsResult&&(this.transactionsResult.dispose(),this.transactionsResult=null)},onClose:function(){this.transactionsResult.data.off("all",this._onDataChange),this.payeesResult.data.off("all",this._onDataChange),this.hub.off("transactions:datagrid:sort",this._sortHandler),this.dispose()}},{ID:"transactions-details",submodules:[n,r],defaults:{showWithParent:!0,showExcluded:!1,initialGrid:"transactions"}});return a}),define("modules/transactions-details/transactions-details-module-extension",["modules/transactions-details/transactions-details-module","jQuery","modules/transactions-datagrid/transactions-datagrid-module","modules/payees-datagrid/payees-datagrid-module","services/transactions-service","services/categories-service","hbs!modules/transactions-details/templates/transactions-details","hbs!modules/transactions-details/templates/transactions-details-selector","utils/util","css!modules/transactions-details/css/transactions-details"],function(e,t,n,r,i,s,o,u,a){var f=e.extend({initialize:function(){this._super.apply(this,arguments),this.categoriesService=s.getInstance();var e=this;a.when(this._getCategories()).done(function(t){e.categoriesList=t.data.categories})},_getCategories:function(){var e=new a.Deferred,t=!1,n;return a.when(this.categoriesService.getPlainCategories()).then(function(r){t=!0,n=r,e.resolve(r)}),t?n:e.promise()},onClose:function(){try{this.transactionsResult.data.off("all",this._onDataChange),this.payeesResult.data.off("all",this._onDataChange),this.hub.off("transactions:datagrid:sort",this._sortHandler),this.dispose()}catch(e){console.log("Wait for close the budgets")}},_filtersChanged:function(e){console.log("[TransactionsDetails] Filters changed"),e==="mode"&&(this.filters.category=this.config.filters.category=null),e==="category"&&this.pushCategoriesTags(),console.log(this.filters),this._updateGridChoices()},pushCategoriesTags:function(){if(this.contextConfig.widget.id==="analysis"){var e=this,t={};if(e.filters.category!==undefined&&e.categoriesList!==undefined){var n=e.categoriesList.find(function(t){return t.value===e.filters.category});if(n)t.categoryName=n.name,t.categoryType="Categoria";else{var r=e.categoriesList.filter(function(e){return e.children!==undefined}).map(function(e){return e.children}).flat().find(function(t){return t.value===e.filters.category});r&&(t.categoryName=r.name,t.categoryType="Subcategoria")}t.tabName=e.filters.mode=="expenses"?"Mis Gastos":"Mis Ingresos",t.tabName&&t.categoryName&&t.categoryType&&a.pushToDataLayer({eventCategory:"PFM Ingreso y Gastos -"+t.tabName,eventAction:"Boton",eventLabel:t.categoryName+"-"+t.categoryType,event:"eventClick"})}}}},{ID:"transactions-details",submodules:[n,r],defaults:{showWithParent:!0,showExcluded:!1,initialGrid:"transactions"}});return f}),define("hbs!modules/transactions-details/extensions/transactions-details-accordion/templates/transactions-details-accordion",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){return" sf-collapsed"}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=this,l=n.helperMissing,c=this.escapeExpression,h="function";s+='<div class="sf-transactions-details-accordion sf-accordion-item',o=n.unless.call(t,t.expanded,{hash:{},inverse:f.noop,fn:f.program(1,p,i)});if(o||o===0)s+=o;s+='">\n	\n	<div class="sf-accordion-go-back sf-not-show-elm">\n		<button class="sf-button sf-accordion-go-back-button " tabindex="0" type="button">\n			<a href="javascript:void(0);" class="sf-balance-close"><span class="sf-balance-close-text">',a={hash:{}},s+=c((o=n.t,o?o.call(t,"transactions-details.transactionsGrid.goBack",a):l.call(t,"t","transactions-details.transactionsGrid.goBack",a)))+"</span></a>\n			"+'\n		</button>\n	</div>\n	<div class="sf-current-filters-placeholder"></div>\n	<div class="sf-transactions-details-toggle sf-accordion-header">\n		\n		',a={hash:{text:'{{t "transactions-details.web.transactionsDetails.expenses"}}',type:"button","class":"sf-accordion-toggle-link"}},s+=c((o=n.button,o?o.call(t,a):l.call(t,"button",a)))+'\n		<a class="sf-nav-to-balance" href="#balance">',a={hash:{text:'{{t "transactions-details.viewCashFlowButton"}}',type:"button","class":"sf-navigate-to-cashflow"}},s+=c((o=n.button,o?o.call(t,a):l.call(t,"button",a)))+'</a>\n		<span class="sf-no-transactions">',a={hash:{}},s+=c((o=n.t,o?o.call(t,"transactions-details.noTransactions",a):l.call(t,"t","transactions-details.noTransactions",a)))+'</span>\n	</div>\n\n	<div class="sf-transactions-details-container sf-accordion-body">\n		',(u=n.content)?u=u.call(t,{hash:{}}):(u=t.content,u=typeof u===h?u.apply(t):u);if(u||u===0)s+=u;s+='\n	</div>\n    <div class="sf-transactions-details-disclaimer-text">',a={hash:{}},u=(o=n.t,o?o.call(t,"transactions-details.web.disclaimer.transactions",a):l.call(t,"t","transactions-details.web.disclaimer.transactions",a));if(u||u===0)s+=u;return s+="</div>\n</div>\n",s});return t.registerPartial("modules_transactions-details_extensions_transactions-details-accordion_templates_transactions-details-accordion",n),n}),define("libs/require/css/css!modules/transactions-details/extensions/transactions-details-accordion/css/transactions-details-accordion",[],function(){}),define("modules/transactions-details/extensions/transactions-details-accordion/transactions-details-accordion-module",["modules/transactions-details/transactions-details-module","hbs!modules/transactions-details/extensions/transactions-details-accordion/templates/transactions-details-accordion","hbs!modules/transactions-details/templates/transactions-details","utils/util","css!modules/transactions-details/extensions/transactions-details-accordion/css/transactions-details-accordion"],function(e,t,n,r){var i=e.extend({template:t,ui:{datagridToggle:".sf-accordion-item"},events:{"click .sf-accordion-toggle-link":"toggleDetails"},initialize:function(){r.extend(this.ui,e.prototype.ui),r.extend(this.events,e.prototype.events),this.expanded=this.config.showWithParent,this._super.apply(this,arguments)},serializeData:function(){return{content:n(this._super()),expanded:this.expanded}},toggleDetails:function(){this.expanded?(this.ui.datagridToggle.addClass("sf-collapsed"),this.hideCurrentGrid()):(this.ui.datagridToggle.removeClass("sf-collapsed"),this.showSelectedGrid()),this.expanded=!this.expanded,this._updateGridChoices()},_updateGridChoices:function(){if(!this.expanded)return;this._super()}},{defaults:{showWithParent:!1}});return i}),define("modules/transactions-details/extensions/transactions-details-accordion/transactions-details-accordion-module-extension",["modules/transactions-details/extensions/transactions-details-accordion/transactions-details-accordion-module","jQuery","utils/util","utils/i18n"],function(e,t,n){var r=e.extend({ui:{datagridToggle:".sf-accordion-item",chartElments:".sf-analysis-content-chart-elm",seeExpensesButton:".sf-accordion-toggle-link",seeBalanceButton:".sf-navigate-to-cashflow",goBackFromExpenses:".sf-accordion-go-back",$filtersPlaceholder:".sf-current-filters-placeholder"},events:{"click .sf-accordion-toggle-link":"toggleDetails","click .sf-accordion-go-back-button":"toggleDetails","click .sf-navigate-to-cashflow":"_navigateToCashflow"},hubEvents:{"filters:change":"_changeButtonText"},_navigateToCashflow:function(){this.filters.mode==="expenses"&&n.pushToDataLayer({eventCategory:"PFM Ingreso y Gastos -Mis Gastos",eventAction:"Boton",eventLabel:"Comparar mis ingresos y mis gastos.",event:"eventClick"}),this.filters.mode==="income"&&n.pushToDataLayer({eventCategory:"PFM Ingreso y Gastos -Mis Ingresos",eventAction:"Boton",eventLabel:"Comparar mis ingresos y mis gastos.",event:"eventClick"});var e=t(".sf-analysis-widget").find(".sf-current-filters").clone();this.publish("show:widget",{widget:"balance",filters:this.filters,extraData:{appliedFilters:e,render:!0}})},_changeButtonText:function(e){if(e.filter!=="mode")return;var t=e.data;this.ui.seeExpensesButton.text(n.i18n.get("transactions-details.web.transactionsDetails."+t))},toggleDetails:function(){var e=t(".sf-analysis-widget").find(".sf-current-filters").clone();this.expanded?(this.ui.$filtersPlaceholder.html(""),this.ui.datagridToggle.addClass("sf-collapsed"),this.ui.seeExpensesButton.removeClass("sf-not-show-elm"),this.ui.seeBalanceButton.removeClass("sf-not-show-elm"),this.ui.goBackFromExpenses.addClass("sf-not-show-elm"),this.$el.closest(".sf-analysis-content").find(".sf-analysis-content-chart-elm").removeClass("sf-not-show-elm"),this.hideCurrentGrid()):(this.filters&&this.filters.mode==="expenses"?n.pushToDataLayer({eventCategory:"PFM Ingreso y Gastos -Mis Gastos",eventAction:"Boton",eventLabel:"Ver detalle de mis gastos",event:"eventClick"}):n.pushToDataLayer({eventCategory:"PFM Ingreso y Gastos -Mis Ingresos",eventAction:"Boton",eventLabel:"Ver detalle de mis gastos",event:"eventClick"}),this.ui.$filtersPlaceholder.html(""),e.appendTo(this.ui.$filtersPlaceholder),this.ui.datagridToggle.removeClass("sf-collapsed"),this.ui.seeExpensesButton.addClass("sf-not-show-elm"),this.ui.seeBalanceButton.addClass("sf-not-show-elm"),this.ui.goBackFromExpenses.removeClass("sf-not-show-elm"),this.$el.closest(".sf-analysis-content").find(".sf-analysis-content-chart-elm").addClass("sf-not-show-elm"),this.showSelectedGrid()),this.expanded=!this.expanded,this._updateGridChoices()}},{});return r}),define("hbs!ui/modules/breadcrumb/templates/breadcrumb-entry",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function h(e,t){var r="",i,s,o;r+="\n    ",o={hash:{},inverse:c.noop,fn:c.program(2,p,t)},s=(i=n.ifequal,i?i.call(e,e.index,e.lastStep,o):a.call(e,"ifequal",e.index,e.lastStep,o));if(s||s===0)r+=s;return r+="\n",r}function p(e,t){var r="",i,s,o;r+='\n        <li class="sf-breadcrumb-entry sf-breadcrumb-current"  data-idx="',o={hash:{}},r+=f((i=n.less1,i?i.call(e,e.index,o):a.call(e,"less1",e.index,o)))+'">\n            <a href="javascript:void(0)">',(s=n.label)?s=s.call(e,{hash:{}}):(s=e.label,s=typeof s===l?s.apply(e):s);if(s||s===0)r+=s;return r+="</a>\n        </li>\n    ",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s,o,u,a=n.helperMissing,f=this.escapeExpression,l="function",c=this;return u={hash:{},inverse:c.noop,fn:c.program(1,h,i)},o=(s=n.ifnequal,s?s.call(t,t.index,0,u):a.call(t,"ifnequal",t.index,0,u)),o||o===0?o:""});return t.registerPartial("ui_modules_breadcrumb_templates_breadcrumb-entry",n),n}),define("hbs!ui/modules/breadcrumb/templates/breadcrumb",["hbs","Handlebars","hbs!ui/modules/breadcrumb/templates/breadcrumb-entry"],function(e,t){var n=t.template(function(e,t,n,r,i){function f(e,t,r){var i="",s,o,f;i+="\n	",f={hash:{index:t.index,lastStep:r.lastStep},inverse:u.noop,fn:u.program(2,l,t),data:t},o=(s=n.partial,s?s.call(e,f):a.call(e,"partial",f));if(o||o===0)i+=o;return i+="\n",i}function l(e,t){var i="",s;i+="\n	",s=u.invokePartial(r["ui_modules_breadcrumb_templates_breadcrumb-entry"],"ui_modules_breadcrumb_templates_breadcrumb-entry",e,n,r,t);if(s||s===0)i+=s;return i+="\n	",i}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,r=r||e.partials,i=i||{};var s="",o,u=this,a=n.helperMissing;s+='<ul class="sf-breadcrumb sf-clearfix">\n',o=n.each.call(t,t.steps,{hash:{},inverse:u.noop,fn:u.programWithDepth(f,i,t),data:i});if(o||o===0)s+=o;return s+="\n</ul>",s});return t.registerPartial("ui_modules_breadcrumb_templates_breadcrumb",n),n}),define("libs/require/css/css!ui/modules/breadcrumb/css/breadcrumb",[],function(){}),define("ui/modules/breadcrumb/breadcrumb-module",["classes/item-view","utils/util","hbs!ui/modules/breadcrumb/templates/breadcrumb","css!ui/modules/breadcrumb/css/breadcrumb"],function(e,t,n){var r=e.extend({template:n,events:{"click .sf-breadcrumb-entry":"_entrySelected"},initialize:function(){this.steps=this.options.steps||[]},serializeData:function(){return{steps:this.steps,lastStep:this.steps.length-1}},_entrySelected:function(e){var t=this.$(e.currentTarget).data("idx");t!==undefined&&this.triggerMethod("step:change",this.steps[t])}},{ID:"breadcrumb"});return r}),define("hbs!modules/analysis-breadcrumb/templates/step",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f="function",l=n.helperMissing;(o=n.level)?o=o.call(t,{hash:{}}):(o=t.level,o=typeof o===f?o.apply(t):o);if(o||o===0)s+=o;s+=": <strong>",a={hash:{showDecimals:t.decimals}},u=(o=n.formatAmount,o?o.call(t,t.amount,a):l.call(t,"formatAmount",t.amount,a));if(u||u===0)s+=u;return s+="</strong>",s});return t.registerPartial("modules_analysis-breadcrumb_templates_step",n),n}),define("modules/analysis-breadcrumb/analysis-breadcrumb-module",["ui/modules/breadcrumb/breadcrumb-module","services/analysis-service","utils/util","hbs!modules/analysis-breadcrumb/templates/step","utils/amount","utils/i18n"],function(e,t,n,r){var i=e.extend({filtersList:["category","accounts","datesRange","mode"],initialize:function(){this._super.apply(this,arguments),this.analysisService=t.getInstance(),this.analysisData=null,this.wholeAnalysisData={}},render:function(e){return e?this._super():(this._updateData(),this)},_updateData:function(){n.when(this.analysisService.get(this.filters)).done(n.bind(this._dataReceived,this)).fail(n.bind(this._dataError,this))},_dataError:function(e){console.error("[AnalysisBreadcrumb] Error retrieving analysis data",e),this.publish("error",e)},_dataReceived:function(e){this.analysisDataResult&&this.analysisDataResult.dispose(),this.analysisDataResult=e,this.analysisData=this.analysisDataResult.data.collection,this.analysisTotals=this.analysisDataResult.data.totals,this.analysisDataResult.on("change",this._dataChanged,this),this.render(!0)},_dataChanged:function(e){console.log("[AnalysisBreadcrumb] Analysis data changed, redraw"),this.analysisData=e.data.collection,this.analysisTotals=e.data.totals,this.render(!0)},_getAnalysisBreadcrumbConfig:function(){var e=r({level:n.i18n.get("analysis-breadcrumb."+this.filters.mode+".all"),amount:Math.abs(this.analysisTotals.amount),decimals:this.config.showDecimals});this.steps=[{label:e,id:null}];if(this.filters.category!==null&&this.filters.category!==undefined){var t=this.analysisData[this.filters.category]||this.analysisService.getSubEntry(this.analysisData,this.filters.category),i,s,o;if(t)t.parentCatId&&(i=this.analysisData[t.parentCatId],s=r({level:i.catName,amount:Math.abs(i.amount),decimals:this.config.showDecimals}),this.steps.push({label:s,id:i.catId})),o=r({level:t.catName,amount:Math.abs(t.amount),decimals:this.config.showDecimals}),this.steps.push({label:o,id:this.filters.category});else{t=this.wholeAnalysisData[this.filters.category]||this.analysisService.getSubEntry(this.wholeAnalysisData,this.filters.category);if(t){if(t.parentCatId){var u=null;i=this.analysisData[t.parentCatId],i?(u=i.catId,s=r({level:i.catName,amount:Math.abs(i.amount),decimals:this.config.showDecimals})):(i=this.wholeAnalysisData[t.parentCatId],s=r({level:i.catName,amount:0,decimals:this.config.showDecimals})),this.steps.push({label:s,id:u})}o=r({level:t.catName,amount:0,decimals:this.config.showDecimals}),this.steps.push({label:o,id:this.filters.category})}}}this.wholeAnalysisData=n.merge(this.wholeAnalysisData,this.analysisData)},serializeData:function(){return this._getAnalysisBreadcrumbConfig(),this._super()},onStepChange:function(e){this.publish("filters:change",{filter:"category",data:e.id})},_filtersChanged:function(e){e==="mode"&&(this.filters.category=this.config.filters.category=null),this.render()}},{ID:"analysis-breadcrumb",submodules:[e],defaults:{showDecimals:!1}});return i}),define("hbs!modules/analysis-content/templates/analysis-content",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function h(e,t){return'\n        <div class="sf-filters-placeholder">\n\n        </div>\n    '}function p(e,t){var r="",i;r+="\n				",i=n.each.call(e,e,{hash:{},inverse:c.noop,fn:c.program(4,d,t)});if(i||i===0)r+=i;return r+="\n			",r}function d(e,t){var r="",i,s;return r+="\n					",s={hash:{"class":e.iconClass,title:"analysis-content.web.button.{{name}}",dataChart:e.name,type:"button"}},r+=l((i=n.button,i?i.call(e,s):f.call(e,"button",s)))+"\n				",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c=this;s+='<div class="sf-analysis-content">\n	<div class="sf-analysis-content-chart-elm">\n	<div class="sf-mode-filter-placeholder"></div>\n	<div class="sf-analysis-disclaimer">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"analysis-content.web.disclaimer",a):f.call(t,"t","analysis-content.web.disclaimer",a)))+"</div>\n    ",u=n["if"].call(t,t.filtersPlaceholders,{hash:{},inverse:c.noop,fn:c.program(1,h,i)});if(u||u===0)s+=u;s+='\n	<div class="sf-breadcrumb-placeholder"></div>\n	<div class="sf-charts-placeholder sf-clearfix">\n		<div class="sf-analysis-chart-placeholder"></div>\n	</div>\n    <div class="sf-chart-selector sf-button-group-section sf-chart-selector-small">\n		<div class="sf-visualize-options">\n			',a={hash:{}},s+=l((o=n.t,o?o.call(t,"analysis-content.visualizacion",a):f.call(t,"t","analysis-content.visualizacion",a)))+'\n		</div>\n		<div class="sf-button-section-groups">\n			',u=n.each.call(t,t.groups,{hash:{},inverse:c.noop,fn:c.program(3,p,i)});if(u||u===0)s+=u;return s+='\n		</div>\n    </div>\n	</div>\n	<div class="sf-details-placeholder"></div>\n</div>\n',s});return t.registerPartial("modules_analysis-content_templates_analysis-content",n),n}),define("libs/require/css/css!modules/analysis-content/css/analysis-content",[],function(){}),define("modules/analysis-content/analysis-content-module",["classes/layout","classes/model","ui/modules/mode-filter/mode-filter-module","modules/transactions-details/extensions/transactions-details-accordion/transactions-details-accordion-module","modules/analysis-breadcrumb/analysis-breadcrumb-module","services/analysis-service","hbs!modules/analysis-content/templates/analysis-content","utils/util","utils/tooltip","utils/mask","css!modules/analysis-content/css/analysis-content"],function(e,t,n,r,i,s,o,u){var a=e.extend({template:o,regions:{filtersRegion:".sf-mode-filter-placeholder",breadcrumbRegion:".sf-breadcrumb-placeholder",chartRegion:".sf-analysis-chart-placeholder",detailsRegion:".sf-details-placeholder"},events:{"click .sf-chart-selector .sf-button-section button":"_chartSelectHandler"},ui:{emptyMessage:".sf-empty-message",buttons:".sf-chart-selector .sf-button-section button"},filtersList:["accounts","category","datesRange","mode"],hubEvents:{"analysis:chart:change":"_display"},initialize:function(e){this._super.apply(this,arguments),this.model=this.model||new t;if(!e.charts)throw"[AnalysisContent] Chart selection is mandatory";this.analysisService=s.getInstance();var n=this,r={},i={},o=u.merge({},this.contextConfig,{viewType:this.globals.viewType,model:this.model});u.each(e.charts,function(e,t){var s=i[e.type]||(i[e.type]=[]),a=function(r){return new e.constructor(u.merge({name:t,model:n.model,managed:!0},o,e,r))};r[t]={constructor:a,previousOptions:null},s.push({name:t,iconClass:"sf-analysis-chart-"+t+"-icon"})}),this.charts=r,this.groups=i,this.currentChart=this.config.initialChart,this.chartRegion.on("show",function(e){this.ui.buttons.removeClass("sf-active").filter("button[data-chart="+e.options.name+"]").addClass("sf-active"),this.currentChart=e.options.name},this),this._dataReceived=u.bind(this._dataReceived,this),this._dataError=u.bind(this._dataError,this),this._updateData=u.bind(this._updateData,this)},serializeData:function(){return this},onShow:function(){this.filtersRegion.show(new n(this.contextConfig)),this.breadcrumbRegion.show(new i(this.contextConfig)),this.detailsRegion.show(new r(this.contextConfig)),this._updateData(),u.tooltip.add(this.$("button"),this.tooltipOptions)},onClose:function(){this.dispose()},display:function(e){if(this.chartRegion){var t=this.chartRegion&&this.chartRegion.currentView;t&&(this.charts[this.currentChart].previousOptions={config:{viewType:t.currentViewType}}),this._display(e)&&t&&this.publish("analysis:chart:change",e)}},_display:function(e){var t=this.charts[e],n=this.currentChart==e,r=this.chartRegion&&this.chartRegion.currentView;if(t&&(!n||!r)){this.currentChart=e;if(this.chartRegion){var i=t.previousOptions||{};return this.chartRegion.show(t.constructor(i)),!0}}return!1},dispose:function(){this.analysisDataResult&&(this.analysisDataResult.dispose(),this.analysisDataResult=null)},_chartSelectHandler:function(e){var t=this.$(e.currentTarget).data("chart");this.display(t)},_filtersChanged:function(e){e==="mode"&&(this.filters.category=this.config.filters.category=null),setTimeout(this._updateData)},_updateData:function(){u.mask(this.$el,u.MASK_LOADING),u.when(this.analysisService.get(this.filters)).done(this._dataReceived).fail(this._dataError)},_dataError:function(e){console.error("[AnalysisContent] Error retrieving data",e),this.publish("error",e)},_dataReceived:function(e){u.unmask(this.$el),this.dispose(),this.analysisDataResult=e,this.analysisDataResult.on("change",this._dataChanged,this),this._dataChanged(e)},_dataChanged:function(e){this.analysisData=e.data;if(this.filters.category!=null){var t=this.analysisData.collection[this.filters.category]||this.analysisService.getSubEntry(this.analysisData.collection,this.filters.category);this.analysisData.collection=this.analysisService.getSubEntries(this.analysisData.collection,this.filters.category),t?(this.analysisData.totals.amount=t.amount,this.analysisData.totals.name=t.catName):this.analysisData.totals.name=u.i18n.get("analysis-breadcrumb."+this.filters.mode+".all")}else this.analysisData.totals.name=u.i18n.get("analysis-breadcrumb."+this.filters.mode+".all");this.model.clear({silent:!0}),this.filters.category===0&&this.analysisData.collection.length===1&&this.analysisData.collection[0]===undefined&&(this.analysisData.collection=[]),this.model.set(this.analysisData),this.chartRegion&&!this.chartRegion.currentView&&this.display(this.currentChart)}},{ID:"analysis-content",submodules:[n,r,i],services:[s],defaults:{}});return a}),define("modules/analysis-content/analysis-content-module-extension",["modules/analysis-content/analysis-content-module","ui/modules/mode-filter/mode-filter-module","modules/transactions-filters/transactions-filters-module","modules/transactions-details-filters/transactions-details-filters-module","modules/transactions-details/extensions/transactions-details-accordion/transactions-details-accordion-module","modules/analysis-breadcrumb/analysis-breadcrumb-module","services/accounts-service","services/analysis-service","utils/util","utils/tooltip","utils/mask"],function(e,t,n,r,i,s,o,u,a){var f=e.extend({regions:{modeRegion:".sf-mode-filter-placeholder",filtersRegion:".sf-filters-placeholder",breadcrumbRegion:".sf-breadcrumb-placeholder",chartRegion:".sf-analysis-chart-placeholder",detailsRegion:".sf-details-placeholder",accountsfilterRegion:".sf-accounts-filter-placeholder",timerangefilterRegion:".sf-timerange-filter-placeholder"},events:{"click .sf-chart-selector .sf-button-section-groups button":"_chartSelectHandler"},ui:{emptyMessage:".sf-empty-message",buttons:".sf-chart-selector .sf-button-section-groups button",$chartSelector:".sf-chart-selector"},initialize:function(){this._super.apply(this,arguments),this.accountsService=o.getInstance(),this._setupDatesRangeFilter()},serializeData:function(){return a.extend(this._super(),{filtersPlaceholders:["sf-accounts-filter-placeholder","sf-timerange-filter-placeholder"]})},onRender:function(){this._super();var e=new r(this.contextConfig),n=new t(this.contextConfig);n.on("mode:change",this._pushGtags,this),this.modeRegion.show(n),this.filtersRegion.show(e),this.breadcrumbRegion.show(new s(this.contextConfig)),this.detailsRegion.show(new i(this.contextConfig)),this._updateData(),a.tooltip.add(this.$("button"),this.tooltipOptions)},_pushGtags:function(e){e==="income"?a.pushToDataLayer({eventCategory:"PFM Ingresos y gastos",eventAction:"Boton",eventLabel:"Mis ingresos",event:"eventClick"}):a.pushToDataLayer({eventCategory:"PFM Ingresos y gastos",eventAction:"Boton",eventLabel:"Mis gastos",event:"eventClick"})},onShow:function(){},_dataChanged:function(e){this.analysisData=e.data;if(this.filters.category!=null){var t=this.analysisData.collection[this.filters.category]||this.analysisService.getSubEntry(this.analysisData.collection,this.filters.category);this.analysisData.collection=this.analysisService.getSubEntries(this.analysisData.collection,this.filters.category),t?(this.analysisData.totals.amount=t.amount,this.analysisData.totals.name=a.i18n.get("analysis-breadcrumb."+this.filters.mode+".all")):this.analysisData.totals.name=a.i18n.get("analysis-breadcrumb."+this.filters.mode+".all")}else this.analysisData.totals.name=a.i18n.get("analysis-breadcrumb."+this.filters.mode+".all");this.model.clear({silent:!0}),this.filters.category===0&&this.analysisData.collection.length===1&&this.analysisData.collection[0]===undefined&&(this.analysisData.collection=[]),this.model.set(this.analysisData),this.chartRegion&&!this.chartRegion.currentView&&this.display(this.currentChart)},_renderRegions:function(){},_chartSelectHandler:function(e){this.config.filters.mode==="expenses"&&a.pushToDataLayer({eventCategory:"PFM Ingreso y Gastos -Mis Gastos",eventAction:"Boton",eventLabel:"Opciones de visualización",event:"eventClick"}),this.config.filters.mode==="income"&&a.pushToDataLayer({eventCategory:"PFM Ingreso y Gastos -Mis Ingresos",eventAction:"Boton",eventLabel:"Opciones de visualización",event:"eventClick"});var t=this.$(e.currentTarget).data("chart");t=="donutchart"||t=="bubblechart"?this.ui.$chartSelector.addClass("sf-chart-selector-small"):this.ui.$chartSelector.removeClass("sf-chart-selector-small"),this.display(t)}},{ID:"analysis-content",submodules:[t,i,s,n,r],services:[u],defaults:{}});return f}),define("hbs!classes/ui/chart/templates/accessible-chart",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i,s;return r+="\n		",s={hash:{"class":e.accessibleSwitchClass}},r+=a((i=n.accessibleSwitch,i?i.call(e,s):u.call(e,"accessibleSwitch",s)))+"\n	",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u=n.helperMissing,a=this.escapeExpression,f=this;s+='<div class="sf-accessible-chart">\n	<div class="sf-accessible-chart-content"></div>\n	<div class="sf-accessible-chart-controls">\n	',o=n["if"].call(t,t.showAccessibleSwitch,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;return s+="\n	</div>\n</div>",s});return t.registerPartial("classes_ui_chart_templates_accessible-chart",n),n}),define("hbs!classes/ui/chart/templates/accessible-chart-emtpy-view",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s,o,u=n.helperMissing,a=this.escapeExpression;return o={hash:{text:"{{{t emptyMessage}}}","class":"sf-accessible-chart-empty-view"}},a((s=n.empty,s?s.call(t,o):u.call(t,"empty",o)))});return t.registerPartial("classes_ui_chart_templates_accessible-chart-emtpy-view",n),n}),define("libs/require/css/css!classes/ui/chart/css/accessible-chart",[],function(){}),define("classes/ui/chart/views/accessible-chart-empty-view",["classes/item-view","hbs!classes/ui/chart/templates/accessible-chart-emtpy-view","css!classes/ui/chart/css/accessible-chart"],function(e,t){var n=e.extend({template:t,serializeData:function(){return this.config}});return n}),define("classes/ui/chart/accessible-chart",["classes/layout","classes/model","hbs!classes/ui/chart/templates/accessible-chart","classes/ui/chart/views/accessible-chart-empty-view","utils/util","css!classes/ui/chart/css/accessible-chart"],function(e,t,n,r,i){var s=e.extend({template:n,regions:{contentRegion:".sf-accessible-chart-content"},events:{"click .sf-accessible-chart-controls .sf-accessible-switch button":"toggleView"},ui:{accessibleSwitch:".sf-accessible-chart-controls .sf-accessible-switch"},hubEvents:{"viewType:change":"setViewType"},chartConstructor:null,accessibleViewConstructor:null,emptyViewConstructor:r,initialize:function(e){this._super(e);var n=this,r=function(r){return i.merge({},n.contextConfig,{model:new t},n.config[r],e[r])},s=function(e){return function(){var t=Array.prototype.slice.call(arguments);t.unshift(e),this.trigger.apply(this,t)}};this.chartView=e.chartView||new this.chartConstructor(r("chartOptions")),this.accessibleView=e.accessibleView||new this.accessibleViewConstructor(r("tableOptions")),this.emptyView=e.emptyView||new this.emptyViewConstructor(i.merge(r("emptyOptions"),{emptyMessage:this.config.emptyMessage})),this.currentViewType=this.config.viewType,this.chartView.on("draw:before",s("draw:before"),this),this.chartView.on("draw",s("draw"),this)},serializeData:function(){return{showAccessibleSwitch:this.config.showAccessibleSwitch,accessibleSwitchClass:this.currentViewType?"sf-accessible-view":""}},onRender:function(){this._super(),this._onRender()},_onRender:function(){var e=this.model.toJSON(),t=this.parseSeries(e),n=t&&this.parseTabularSeries(e),r={silent:!0};this.constructor.ID&&this.$el.addClass("sf-"+this.constructor.ID),this._updateAccessibleView(n,r),this._updateChartView(t,r),t?this._show():this.showEmptyView()},isEmpty:function(){return this.contentRegion&&this.contentRegion.currentView==this.emptyView},onShow:function(){this.model.on("change",this._modelChange,this),this.chartView.on("point:selected",this._publishPointSelected,this)},onClose:function(){this.model.off("change",this._modelChange),this.chartView.off("point:selected",this._publishPointSelected)},_modelChange:function(){var e=this.model.toJSON(),t=this.parseSeries(e),n=t&&this.parseTabularSeries(e);t?(this._updateAccessibleView(n),this._updateChartView(t),this.isEmpty()&&this._show()):this.showEmptyView()},_show:function(){var e=this.currentViewType?"accessibleView":"chartView",t=this.currentViewType?"addClass":"removeClass";this.contentRegion.show(this[e]),this.ui.accessibleSwitch[t]("sf-accessible-view"),this.ui.accessibleSwitch.children().removeClass("sf-disabled")},toggleView:function(){this.setViewType(this.currentViewType?0:1)},setViewType:function(e){this.currentViewType!=e&&(this.currentViewType=e,this.isEmpty()||this._show(),this.publish("viewType:selected",this))},showChartView:function(){this.setViewType(0)},showAccessibleView:function(){this.setViewType(1)},showEmptyView:function(){this.contentRegion&&(this.emptyView.model.clear({silent:!0}),this.emptyView.model.set(this.model.toJSON()),this.contentRegion.show(this.emptyView),this.ui.accessibleSwitch.children().addClass("sf-disabled"))},parseSeries:function(e){return e},parseTabularSeries:function(e){return e},_updateAccessibleView:function(e,t){this.accessibleView.model.clear({silent:!0}),this.accessibleView.model.set(e,t)},_updateChartView:function(e,t){this.chartView.model.clear({silent:!0}),this.chartView.model.set(e,t)},_publishPointSelected:function(e){this.trigger("point:selected",e)}},{ID:"accessible-chart",defaults:{viewType:0,showAccessibleSwitch:!0,emptyMessage:"accessible-chart.empty"}});return s}),define("hbs!classes/ui/chart/templates/loading-view",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-budget-loading-view">\n	',u={hash:{}},s+=f((o=n.t,o?o.call(t,"budget-content.loadingView",u):a.call(t,"t","budget-content.loadingView",u)))+"\n</div>\n",s});return t.registerPartial("classes_ui_chart_templates_loading-view",n),n}),define("classes/ui/chart/views/loading-view",["classes/item-view","hbs!classes/ui/chart/templates/loading-view"],function(e,t){var n=e.extend({template:t,serializeData:function(){return this.config}});return n}),define("classes/ui/chart/accessible-chart-extension",["jQuery","classes/ui/chart/accessible-chart","classes/model","hbs!classes/ui/chart/templates/accessible-chart","classes/ui/chart/views/accessible-chart-empty-view","classes/ui/chart/views/loading-view","utils/util","css!classes/ui/chart/css/accessible-chart"],function(e,t,n,r,i,s,o){var u=t.extend({_onRender:function(){var e=this.model.toJSON(),t=this.parseSeries(e),n=t&&this.parseTabularSeries(e),r={silent:!0};this.constructor.ID&&this.$el.addClass("sf-"+this.constructor.ID),this._updateAccessibleView(n,r),this._updateChartView(t,r);if(this.contextConfig.widget.id==="budget"){this._budgetLoadingView(t);return}t?this._show():(o.mask(this.$el),this.showEmptyView())},_budgetLoadingView:function(e){var t=this;e?(clearTimeout(this.timeoutShowEmptyView),this._show()):this.loading||(this.loading=!0,o.mask(this.$el),this._showLoadingView(),this.timeoutShowEmptyView=setTimeout(function(){t.showEmptyView()},2500))},_modelChange:function(){if(this.contextConfig.widget.id==="budget"){this._budgetModelChange();return}this._super()},_budgetModelChange:function(){var e=this.model.toJSON(),t=this.parseSeries(e),n=t&&this.parseTabularSeries(e);if(!t)return;this._updateAccessibleView(n),this._updateChartView(t),this.loading&&(clearTimeout(this.timeoutShowEmptyView),this._show())},_showLoadingView:function(){this.contentRegion&&(this.contentRegion.show(new s),this.ui.accessibleSwitch.children().addClass("sf-disabled"))}},{ID:"accessible-chart",defaults:{viewType:0,showAccessibleSwitch:!0,emptyMessage:"accessible-chart.empty"}});return u}),define("hbs!classes/analysis/templates/formatters/category",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression;return s+='<a href="javascript:void(0);" class="sf-category-selector" data-id="',(o=n.catId)?o=o.call(t,{hash:{}}):(o=t.catId,o=typeof o===u?o.apply(t):o),s+=a(o)+'">',(o=n.catName)?o=o.call(t,{hash:{}}):(o=t.catName,o=typeof o===u?o.apply(t):o),s+=a(o)+"</a>",s});return t.registerPartial("classes_analysis_templates_formatters_category",n),n}),define("hbs!classes/analysis/templates/analysis-accessible-view",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-analysis-chart-accessible-view"></div>'});return t.registerPartial("classes_analysis_templates_analysis-accessible-view",n),n}),define("classes/analysis/views/analysis-accessible-view",["classes/item-view","classes/collection","utils/util","ui/modules/datagrid/datagrid-module","hbs!classes/analysis/templates/formatters/category","hbs!classes/analysis/templates/analysis-accessible-view","utils/amount"],function(e,t,n,r,i,s){var o=r.DatagridColumn,u=e.extend({events:{"click .sf-category-selector":"_categorySelected"},template:s,initialize:function(){this._super.apply(this,arguments),this.gridConfig={sortField:"name",sortDirection:"ASC",columns:[new o({parent:this,field:"name",formatter:i,columnClass:"sf-cat-col",serializeData:function(e){return{catName:e.get("name"),catId:e.get("id")}},label:n.i18n.get("analysis-accessible-chart.accessible-view.category"),sortable:!0}),new o({parent:this,columnClass:"sf-numeric sf-amount-col",field:"y",formatter:function(e){return n.amount.format(e.get("y"))},label:n.i18n.get("analysis-accessible-chart.accessible-view.amount"),headerClass:"sf-amount-header sf-numeric",sortable:!0}),new o({columnClass:"sf-numeric sf-transactions-col",field:"transactions",label:n.i18n.get("analysis-accessible-chart.accessible-view.transactions"),headerClass:"sf-transactions-header sf-numeric",parent:this,sortable:!0}),new o({columnClass:"sf-numeric sf-percent-col",field:"percent",label:n.i18n.get("analysis-accessible-chart.accessible-view.percent"),headerClass:"sf-percent-header sf-numeric",parent:this,sortable:!0,formatter:function(e){return e.get("percent")!==undefined?n.percentage.format(n.number.round(e.get("percent"),2),!0):"-"}})]}},onRender:function(){this._super();var e=this.model.get("data");if(e){var i=n.extend({dataSource:new t(e),config:this.gridConfig,container:this.$el},this.contextConfig);this.datagrid=new r(i),this.datagrid.render()}},onShow:function(){this.model.on("change",this.render,this)},onClose:function(){this.model.off("change",this.render)},_categorySelected:function(e){if(!this.config.disableCategoryChange){var t=this.$(e.currentTarget).data("id");this.publish("filters:change",{filter:"category",data:t})}}});return u}),define("classes/analysis/analysis-accessible-chart",["classes/ui/chart/accessible-chart","classes/analysis/views/analysis-accessible-view","services/analysis-service","utils/util"],function(e,t,n,r){var i=e.extend({filtersList:["category","accounts","datesRange","mode"],accessibleViewConstructor:t,initialize:function(){this._super.apply(this,arguments),this.analysisService=n.getInstance(),this._dataError=r.bind(this._dataError,this),this._dataReceived=r.bind(this._dataReceived,this),this.update=r.bind(this.update,this)},onShow:function(){this._super(),this.options.managed||this.update(),this.chartView.on("point:selected",this._triggerCategoryChange,this)},onClose:function(){this._super(),this.chartView.off("point:selected",this._triggerCategoryChange),this.dispose()},dispose:function(){this.analysisDataResult&&(this.analysisDataResult.off("change",this._analysisDataChanged),this.analysisDataResult=null)},update:function(){r.mask(this.$el,r.MASK_LOADING),r.when(this.analysisService.get(this.filters)).done(this._dataReceived).fail(this._dataError)},_dataError:function(e){r.unmask(this.$el),console.error("[AnalysisChart] Error retrieving analysis data",e),this.publish("error",e)},_dataReceived:function(e){r.unmask(this.$el),this.dispose(),this.analysisDataResult=e,this.analysisDataResult.on("change",this._analysisDataChanged,this),this._dataChanged(this.analysisDataResult)},_dataChanged:function(e){this.analysisData=e.data;if(this.filters.category!=null){var t=this.analysisData.collection[this.filters.category];t||(t=this.analysisService.getSubEntry(this.analysisData.collection,this.filters.category)),this.analysisData.collection=this.analysisService.getSubEntries(this.analysisData.collection,this.filters.category),this.analysisData.totals.amount=t.amount,this.analysisData.totals.name=t.catName}else this.analysisData.totals.name=r.i18n.get("analysis-breadcrumb."+this.filters.mode+".all");this.model.clear({silent:!0}),this.model.set(this.analysisData)},_filtersChanged:function(e,t){e==="mode"&&(this.filters.category=this.config.filters.category=null),e==="category"&&(this.filters.category=t),this.options.managed||setTimeout(this.update)},_triggerCategoryChange:function(e){if(this.config.disableCategoryChange)return;this.publish("filters:change",{filter:"category",data:e.catId})},_getDatesRange:function(){return r.date.datesInPeriod(this.config.stepScale,this.filters.datesRange.fromDate,this.filters.datesRange.toDate)},parseSeries:function(e){if(r.isEmpty(e.collection))return null;var t=this,n=r.reduce(r.pluck(e.collection,"amount"),function(e,t){return e+t},0),i=this._getTotalValuesPerIteration(e.collection),s=r.map(e.collection,function(e){var s=r.unicodeHTMLCodes(r.amount.format(Math.abs(e.amount),t.config.showDecimals)),o=r.number.round(e.amount/n*100),u={label:e.catName,sublabel:s,title:e.catName+"<br/>"+s+" ("+r.percentage.format(o)+")",color:e.catColor,"class":"sf-analysis-chart-category-"+e.catId,value:e.amount,points:r.map(this._getDatesRange(),function(n){var s=r.date.format(n,this.config.dataDateFormats[this.config.stepScale]),o=e.dateEntries[s],u=o?o.amount:0,a=r.unicodeHTMLCodes(r.amount.format(Math.abs(u),t.config.showDecimals)),f=i[s]||0,l=r.number.round(u/f*100);return{label:e.catName,sublabel:a,title:e.catName+"<br/>"+a+" ("+r.percentage.format(l)+")",value:u}},this),options:{stack:0},data:e};return u.data.percentage=r.percentage.format(o),u},this).sort(function(e,t){var n=Math.abs(e.value),r=Math.abs(t.value);return n==r?0:n>r?-1:1});return{label:e.totals.name,sublabel:r.unicodeHTMLCodes(r.amount.format(Math.abs(e.totals.amount),t.config.showDecimals)),value:e.totals.amount,series:s,axis:{x:this._getDatesRange()}}},_getTotalValuesPerIteration:function(e){var t=r.pluck(e,"dateEntries"),n=r.map(t,function(e){return r.keys(e)}),i=r.uniq(r.flatten(n)),s=r.map(i,function(e){var n=r.pluck(t,e),i=r.reduce(n,function(e,t){var n=t&&t.amount||0;return e+n},0);return i});return r.zipObject(i,s)},parseTabularSeries:function(e){e=e.collection;var t=0,n=r.map(e,function(e){return t+=e.amount,this._singleElement(e)},this);return t=Math.abs(t),r.each(n,function(e){t>0?e.percent=e.y/t*100:e.percent=0}),{data:n}},_singleElement:function(e){return{name:e.catName,y:Math.abs(e.amount),transactions:e.transactions,id:e.catId,color:e.catColor}},_parseTimeTabularSeries:function(e){e=e.collection;var t=[];return r.each(this._getDatesRange(),function(n){var i=r.date.format(n,this.config.dataDateFormats[this.config.stepScale]),s=r.date.format(n,this.config.tableDataFormats[this.config.stepScale]),o={dataDate:i,date:n,formattedDate:s,amount:0,transactions:0,rows:[]};r.each(e,function(e){if(e.dateEntries[i]!==undefined){var t=e.dateEntries[i];o.amount+=t.amount,o.transactions+=t.transactions,t.transactions>0&&o.rows.push({name:e.catName,amount:t.amount,formattedDate:s,transactions:t.transactions,dataDate:i,date:n,catId:e.catId})}},this),r.each(o.rows,function(e){o.amount=Math.abs(o.amount),o.amount>0?e.percent=e.amount/o.amount*100:e.percent=0},this),o.transactions>0&&(this.config.putAllCategoriesTabularRowBottom?(t.push(o.rows),t.push(o)):(t.push(o),t.push(o.rows)))},this),{data:r.flatten(t)}}},{ID:"analysis-accessible-chart",services:[n],submodules:[e],defaults:{disableCategoryChange:!1,stepScale:"month",emptyMessage:"analysis-accessible-chart.empty",showDecimals:!1,dateAxisFormats:{day:r.date.constructor.SHORT_DAY_MONTH,month:r.date.constructor.LONG_MONTH},dataDateFormats:{day:r.date.constructor.BACKEND_FORMAT,month:r.date.constructor.BACKEND_MONTH_YEAR_FORMAT},tableDataFormats:{day:r.date.constructor.SHORT_DATE,month:r.date.constructor.LONG_MONTH_YEAR},putAllCategoriesTabularRowBottom:!1}});return i}),define("hbs!classes/ui/chart/templates/analysis-chart-special-cat",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r;return(r=n.specialClass)?r=r.call(e,{hash:{}}):(r=e.specialClass,r=typeof r===f?r.apply(e):r),l(r)}function d(e,t){return" sf-use-full-width"}function v(e,t){return" sf-hide-nav"}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<div class="sf-special-category-wrapper ',o=n["if"].call(t,t.specialClass,{hash:{},inverse:c.noop,fn:c.program(1,p,i)});if(o||o===0)s+=o;s+='">\n    <span class="sf-special-cat-message-wrapper ',o=n.unless.call(t,t.showDetailsButton,{hash:{},inverse:c.noop,fn:c.program(3,d,i)});if(o||o===0)s+=o;s+='">\n        <span class="sf-special-cat-message">\n            ',a={hash:{}},s+=l((o=n.t,o?o.call(t,"analysis-content.specialCategory.message",a):h.call(t,"t","analysis-content.specialCategory.message",a)))+'\n        </span>\n    </span>\n	<span class="sf-special-cat-amount">\n		',(u=n.catAmount)?u=u.call(t,{hash:{}}):(u=t.catAmount,u=typeof u===f?u.apply(t):u);if(u||u===0)s+=u;s+='\n	</span>\n    <div class="sf-cat-navigate-wrapper ',u=n.unless.call(t,t.showDetailsButton,{hash:{},inverse:c.noop,fn:c.program(5,v,i)});if(u||u===0)s+=u;return s+='">\n        <span class="sf-special-cat-navigation">\n			<button class="sf-button sf-special-cat-navigate-btn" type="button">\n				<span class="sf-button-text">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"analysis-content.specialCategory.btnNavigation",a):h.call(t,"t","analysis-content.specialCategory.btnNavigation",a)))+'</span>\n				<span class="sf-button-icon">\n                    <img src="resources/pfm/ui/css/icons/app-icons/dav-arrow-right.svg" width="20" height="20" alt="',a={hash:{}},s+=l((o=n.t,o?o.call(t,"analysis-content.specialCategory.btnNavigation",a):h.call(t,"t","analysis-content.specialCategory.btnNavigation",a)))+'">\n				</span>\n			</button>\n        </span>\n    </div>\n</div>\n',s});return t.registerPartial("classes_ui_chart_templates_analysis-chart-special-cat",n),n}),define("classes/analysis/analysis-accessible-chart-extension",["classes/analysis/analysis-accessible-chart","classes/analysis/views/analysis-accessible-view","hbs!classes/ui/chart/templates/analysis-chart-special-cat","services/analysis-service","utils/util","jQuery"],function(e,t,n,r,i,s){var o=e.extend({parseSeries:function(e){if(i.isEmpty(e.collection))return null;var t=null;this.filters.mode==="expenses"&&!this.filters.category?(this.excludeFinancialDebts(e),this.specialCatData!==undefined&&this.specialCatData.amount!==0?this.chartView.on("draw",this.setSpecialCatSection,this):(t=this.$el.find(".sf-special-category-wrapper"),t.length>0&&t.remove(),this.chartView.off("draw",this.setSpecialCatSection,this))):(t=this.$el.find(".sf-special-category-wrapper"),t.length>0&&t.remove(),this.chartView.off("draw",this.setSpecialCatSection,this)),this.filters.category&&this.filters.category>=this.config.obligacionesFinancierasCatId&&this.filters.category<this.config.obligacionesFinancierasCatId+10&&(e.totals=i.clone(e.totals),e.totals.name=i.i18n.get("analysis-content.specialCategory.donutchartLabel"));var n=this,r=i.reduce(i.pluck(e.collection,"amount"),function(e,t){return e+t},0),s=this._getTotalValuesPerIteration(e.collection),o=i.map(e.collection,function(e){var t=i.unicodeHTMLCodes(i.amount.format(Math.abs(e.amount),n.config.showDecimals)),o=i.number.round(e.amount/r*100,0),u=e.amount>=0?i.i18n.get("analysis-accessible-chart.signLabel.incomes"):i.i18n.get("analysis-accessible-chart.signLabel.expenses"),a={label:e.catName,sublabel:t,title:"<div class='sf-chart-point-cat sf-tooltip-label'>"+e.catName+"</div>"+"<div class='sf-tooltip-sublabel'>"+u+": "+t+"</div>",color:e.catColor,"class":"sf-analysis-chart-category-"+e.catId,value:e.amount,points:i.map(this._getDatesRange(),function(t){var r=i.date.format(t,this.config.dataDateFormats[this.config.stepScale]),o=e.dateEntries[r],u=o?o.amount:0,a=i.unicodeHTMLCodes(i.amount.format(Math.abs(u),n.config.showDecimals)),f=s[r]||0,l=i.number.round(u/f*100);return{label:e.catName,sublabel:a,title:e.catName+"<br/>"+a+" ("+i.percentage.format(l)+")",value:u}},this),options:{stack:0},data:e};return a.data.percentage=o>0?i.percentage.format(o,!1):"",a},this).sort(function(e,t){var n=Math.abs(e.value),r=Math.abs(t.value);return n==r?0:n>r?-1:1});return{label:e.totals.name,sublabel:i.unicodeHTMLCodes(i.amount.format(Math.abs(e.totals.amount),n.config.showDecimals)),value:e.totals.amount,series:o,axis:{x:this._getDatesRange()}}},excludeFinancialDebts:function(e){e.collection=i.clone(e.collection),e.totals=i.clone(e.totals),this.specialCatData=e.collection[this.config.obligacionesFinancierasCatId],this.specialCatData&&(delete e.collection[this.config.obligacionesFinancierasCatId],e.totals.amount-=this.specialCatData.amount)},setSpecialCatSection:function(){var e=this,t="";if(e.options.name=="donutchart"||e.options.name=="bubblechart")t="sf-chart-small";var r=this.specialCatData?this.specialCatData.amount:0,o=Math.abs(Math.floor(r)),u=i.amount.format(o,!1),a=n({catAmount:u,showDetailsButton:this.specialCatData!==undefined,makeRoom:o>99999,specialClass:t}),f=s(a),l=f.find(".sf-special-cat-navigate-btn");this.$el.find(".sf-special-category-wrapper").remove(),this.specialCatData&&l.click(function(){e.publish("filters:change",{filter:"category",data:e.config.obligacionesFinancierasCatId})}),e.appended=!1;var c=function(){if(e.appended)return;var t="svg";e.options.name==="barchart"?t=".sf-barchart":e.options.name==="treemap"&&(t=".sf-treemap");var n=e.$el.find(t);n.length===0?setTimeout(c,100):(e.appended=!0,n.after(f))};c()},_filtersChanged:function(e,t){var n=this;this._super(e,t),this.appended=!1,e==="mode"&&(this.filters.category=this.config.filters.category=null,t==="income"&&setTimeout(n.publish("filters:change",{filter:"category",data:110}),100))}});return o}),define("hbs!classes/ui/chart/templates/chart",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression;return s+='<div class="sf-chart" id="',(o=n.id)?o=o.call(t,{hash:{}}):(o=t.id,o=typeof o===u?o.apply(t):o),s+=a(o)+'"></div>',s});return t.registerPartial("classes_ui_chart_templates_chart",n),n}),define("libs/require/css/css!classes/ui/chart/css/chart",[],function(){}),define("classes/ui/chart/chart",["classes/item-view","hbs!classes/ui/chart/templates/chart","utils/util","utils/tooltip","css!classes/ui/chart/css/chart"],function(e,t,n){var r=function(e,t,r){return n.isFunction(e[t])?e[t].call(e,e,r):e[t]},i=e.extend({template:t,tooltipSelector:"[title]",tooltipExtra:null,initialize:function(e){this._super(e),e.model||console.error("[Chart] model is required"),this.id=e.id||n.uniqueId(),this._afterDOMInsertRender=n.bind(this._afterDOMInsertRender,this),this.getValue=n.bind(this.getValue,this),this.getTooltip=n.bind(this.getTooltip,this),this.aggregate=n.bind(this.aggregate,this),this.onClick=n.bind(this.onClick,this);var t=this.config.textDirection;this.enableRTL=t==="rtl",this.axisRTL=this.config.axisDirection==="auto"?this.enableRTL:this.config.axisDirection==="rtl"},onRender:function(){this._super(),this.constructor.ID&&this.$el.addClass("sf-"+this.constructor.ID),this.$el.addClass(this.axisRTL?"sf-axis-rtl":"sf-axis-ltr"),this._removeTooltips(),setTimeout(this._afterDOMInsertRender)},_afterDOMInsertRender:function(){this.$el.is(":visible")&&(this.trigger("draw:before",this),this.draw(this.model.toJSON()),this._attachTooltips(),this.trigger("draw",this))},draw:function(){},onShow:function(){this.model.on("change",this.render,this)},onClose:function(){this.model.off("change",this.render),this._removeTooltips()},serializeData:function(){return{id:"sf-chart-"+this.id}},_removeTooltips:function(){if(this._$tooltips){while(this._$tooltips.length)n.tooltip.destroy(this._$tooltips),this._$tooltips=this._$tooltips.slice(1);this._$tooltips=null}},_attachTooltips:function(){this.config.tooltipEnable&&(this._$tooltips=this.$(this.tooltipSelector),n.tooltip.add(this._$tooltips,n.merge({},this.tooltipOptions,{position:{target:"mouse",adjust:{x:0,y:-20}}},this.tooltipExtra)))},getValue:function(e,t){var n=r(e,"value",t);return n==null&&e.points&&(n=this.aggregate(e.points)),n||0},aggregate:function(e){var t=this;return n.reduce(e,function(e,n,r){return e+t.getValue(n,r)},0)},getTooltip:function(e,t){if(!this.config.tooltipEnable)return"";var n,i=r(e,"title",t);return i==null&&(i=this.getLabel(e,t),n=this.getSublabel(e,t),n&&(i+="<br/>"+n)),i},getColor:function(e,t){return r(e,"color",t)},getClass:function(e,t){var i=r(e,"class",t);return n.isArray(i)?i.join(" "):i},onClick:function(e){this.trigger("point:selected",e.data||e)},getLabel:function(e,t){return r(e,"label",t)},getSublabel:function(e,t){return r(e,"sublabel",t)},normalize:function(e){var t=this;return n.each(e.series,function(e,r){var i=function(n,i,s){var o=n.call(t,i,s);return o!=null?o:n.call(t,e,r)};n.merge(e,{label:t.getLabel(e,r),sublabel:t.getSublabel(e,r),color:t.getColor(e,r),"class":t.getClass(e,r),title:t.getTooltip(e,r),value:t.getValue(e,r)}),n.each(e.points,function(r,s){var o=function(e){return i(e,r,s)};n.merge(r,{label:o(t.getLabel),sublabel:o(t.getSublabel),title:o(t.getTooltip),value:t.getValue(r,s),color:o(t.getColor),"class":t.getClass(r,s),data:r.data||e.data})})}),e},getContrastColor:function(e){var t=this._calcLuma(e),n=this._calcLuma(this.config.contrastColors.primary),r=t>n?(t+.05)/(n+.05):(n+.05)/(t+.05);return r>this.config.contrastRate?this.config.contrastColors.primary:this.config.contrastColors.secondary},_calcLuma:function(e){var t=this._hexToRGB(e);return.2126*t.r+.7152*t.g+.0722*t.b},_hexToRGB:function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,n,r){return t+t+n+n+r+r});var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null}},{defaults:{tooltipEnable:!0,hideLabels:!1,hideTitles:!1,transitionDuration:600,contrastColors:{primary:"#fff",secondary:"#333"},contrastRate:2}});return i}),define("classes/ui/chart/chart-extension",["classes/ui/chart/chart","css!classes/ui/chart/css/chart"],function(e){var t=e.extend({_calcLuma:function(e){e=e.replace(/\s/g,"");var t=this._hexToRGB(e);return.2126*t.r+.7152*t.g+.0722*t.b}});return t}),define("hbs!ui/modules/treemap/templates/treemap",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression;return s+='<div class="sf-chart-point-data ',(o=n["class"])?o=o.call(t,{hash:{}}):(o=t["class"],o=typeof o===u?o.apply(t):o),s+=a(o)+'">\n	 <div class="sf-chart-labels">\n		<div class="sf-chart-label">',(o=n.label)?o=o.call(t,{hash:{}}):(o=t.label,o=typeof o===u?o.apply(t):o),s+=a(o)+'</div>\n		<div class="sf-chart-sublabel">',(o=n.sublabel)?o=o.call(t,{hash:{}}):(o=t.sublabel,o=typeof o===u?o.apply(t):o),s+=a(o)+'</div>\n		<div class="sf-chart-sublabel">',(o=n.percentage)?o=o.call(t,{hash:{}}):(o=t.percentage,o=typeof o===u?o.apply(t):o),s+=a(o)+"</div>\n	</div>\n</div>",s});return t.registerPartial("ui_modules_treemap_templates_treemap",n),n}),define("ui/modules/treemap/views/treemap-view",["classes/view","utils/util","hbs!ui/modules/treemap/templates/treemap","jQuery"],function(e,t,n,r){var i=e.extend({dom:null,data:null,focused:null,onClick:null,onMouseOver:null,onMouseOut:null,initialize:function(){this._super.apply(this,arguments),t.isFunction(this.options.onClick)&&(this.onClick=this.options.onClick),t.isFunction(this.options.onMouseOver)&&(this.onMouseOver=this.options.onMouseOver),t.isFunction(this.options.onMouseOut)&&(this.onMouseOut=this.options.onMouseOut),this.treemapBorder=this.options.treemapBorder||this.config.treemapBorder,this.treemapPadding=this.options.treemapPadding||this.config.treemapPadding,this.parentMargin=this.options.parentMargin||this.config.parentMargin,this.dom=this.options.dom,this.data=this.options.data;var e=r(this.dom).width(),n=r(this.dom).height();this.data.dom||this.makeDom(this.data,0),this.dom.appendChild(this.data.dom),this.position=this.options.axisRTL?this.positionRTL:this.positionLTR,this.position(this.data.dom,0,0,e,n),this.makeLayout(this.data,0,e,n)},focus:function(e){this.focused=e;var t=0,n=e;while(n.parent){n=n.parent,t+=1;var r;for(var i=0;i<n.children.length;++i)r=n.children[i],r.dom&&(r.dom.style.zIndex=0)}var s=n.dom.offsetWidth,o=n.dom.offsetHeight;for(var u=e;u.parent;u=u.parent)this.position(u.dom,0,0,s+this.treemapBorder,o+this.treemapBorder),u.dom.style.zIndex=1;this.makeLayout(e,t,s,o)},makeDom:function(e,i){var s=document.createElement("div");s.style.zIndex=1,s.className=this.config.classNames.node+" "+this.config.classNames.level+"-"+Math.min(i,4),e.data.$symbol&&(s.className+=" "+this.config.classNames.symbol+"-"+e.data.$symbol.replace(" ","_")),e.data.$dominant_symbol&&(s.className+=" "+this.config.classNames.symbol+"-"+e.data.$dominant_symbol.replace(" ","_"),s.className+=" "+this.config.classNames.aggregate),i===1&&(s.className+=" "+this.config.classNames.point);if(i){var o=this;r(s).on("click",function(n){return t.merge(n,e),n.button===0&&(o.focused&&e==o.focused&&o.focused.parent?o.focus(o.focused.parent):o.onClick?o.onClick(n):o.focus(e)),n.stopPropagation(),!0}),r(s).on("mouseover",function(n){return r(this).addClass(o.config.classNames.hover),t.merge(n,e),n.button===0&&o.onMouseOver&&o.onMouseOver(n),n.stopPropagation(),!0}),r(s).on("mouseout",function(n){return r(this).removeClass(o.config.classNames.hover),t.merge(n,e),n.button===0&&o.onMouseOut&&o.onMouseOut(n),n.stopPropagation(),!0}),s.innerHTML=n(e),e.title&&(s.title=e.title)}return e.dom=s,s},positionLTR:function(e,t,n,r,i){r-=this.treemapBorder*2,i-=this.treemapBorder*2,e.style.left=t+"px",e.style.top=n+"px",e.style.width=Math.max(r,0)+"px",e.style.height=Math.max(i,0)+"px"},positionRTL:function(e,t,n,r,i){r-=this.treemapBorder*2,i-=this.treemapBorder*2,e.style.right=t+"px",e.style.top=n+"px",e.style.width=Math.max(r,0)+"px",e.style.height=Math.max(i,0)+"px"},selectSpan:function(e,t,n){var r=e[n],i=r.data.$area,s=i,o=0,u=0;for(var a=n;a<e.length;++a){r=e[a];var f=r.data.$area;f<i&&(i=f),f>s&&(s=f),o+=f;var l=Math.max(5*t*t*s/(o*o),o*o/(t*t*i));if(u&&l>u){o-=f;break}u=l}return[a,o]},makeLayout:function(e,t,n,i){if(!("children"in e))return;var s=e.data.$area,o=3,u=3;t?e.dom.style.background=e.data.color:e.dom.style.background="none";var a=0,f=0,l=n-1,c=i-2;a+=this.treemapPadding,f+=this.treemapPadding,l-=this.treemapPadding,c-=this.treemapPadding,f+=this.parentMargin;var h=Math.sqrt(s/((l-a)*(c-f)));for(var p=0,d;p<e.children.length;++p){d=e.children[p];if(l-a<o||c-f<u){d.dom&&(d.dom.style.zIndex=0,this.position(d.dom,-2,-2,0,0));continue}var v=!0,m;v?m=(c-f)*h:m=(l-a)*h;var g=this.selectSpan(e.children,m,p),y=g[0],b=g[1],w=a,E=f;for(var S=p;S<y;++S){d=e.children[S],d.dom?d.dom.style.zIndex=1:(d.parent=e,d.dom=this.makeDom(d,t+1),e.dom.appendChild(d.dom)),d.dom.style.background=d.data.color;var x=d.data.$area;r(d.dom).find(".sf-chart-label").css("color",d.data.labelColor),r(d.dom).find(".sf-chart-sublabel").css("color",d.data.labelColor),v?(n=b/m,i=x/n):(i=b/m,n=x/i),n/=h,i/=h,n=Math.round(n),i=Math.round(i),this.position(d.dom,w,E,n,i),"children"in d&&this.makeLayout(d,t+1,n,i),v?E+=i:w+=n}v?a+=Math.round(b/m/h):f+=Math.round(b/m/h),p=y-1}}});return i}),define("libs/require/css/css!ui/modules/treemap/css/treemap",[],function(){}),define("ui/modules/treemap/treemap-module",["classes/ui/chart/chart","ui/modules/treemap/views/treemap-view","utils/util","css!ui/modules/treemap/css/treemap"],function(e,t,n){var r=e.extend({initialize:function(e){this._super(e);var t=this,r=function(e,n){t._lastWidth!=n&&(t._lastWidth=n,t.render())};this.resizeHandler=this.config.debounceInterval?n.debounce(r,this.config.debounceInterval):r,this._registerResizeHandler=n.bind(this._registerResizeHandler,this)},_registerResizeHandler:function(){this._lastWidth=this.contextConfig.$widget.width(),this.contextConfig.$widget.on("elementResize",this.resizeHandler)},onRender:function(){this._super(),this.$el.addClass("sf-d3-chart")},onShow:function(){this._super(),this._registerResizeHandler()},onClose:function(){this._super(),this.contextConfig.$widget.off("elementResize",this.resizeHandler)},draw:function(e){this._super(e),new t(n.extend(this.contextConfig,{data:this._parseData(e),dom:this.el,onClick:this.onClick,axisRTL:this.axisRTL}));var r=this;n.each(this.$(".sf-treemap-node"),function(e,t,n){(n.eq(t).height()<r.config.minLabelHeight||n.eq(t).width()<r.config.minLabelWidth)&&n.eq(t).children().hide()})},_parseData:function(e){var t=this,r=this.aggregate(e.series);return{label:this.getLabel(e),sublabel:this.getSublabel(e),title:this.getTooltip(e),data:{$area:r,amount:r,color:"transparent"},children:n.map(e.series,function(e){var n=t.getValue(e),r=t.getColor(e);return{label:t.getLabel(e),sublabel:t.getSublabel(e),"class":t.getClass(e),title:t.getTooltip(e),data:{$area:n,amount:n,color:r,labelColor:t.getContrastColor(r),data:e.data}}})}},getValue:function(e,t){return Math.abs(this._super(e,t))},onClick:function(e){this._super(e.data)}},{ID:"treemap",defaults:{classNames:{node:"sf-treemap-node",point:"sf-chart-point",level:"sf-treemap-level",symbol:"sf-treemap-symbol",aggregate:"sf-treemap-aggregate",hover:"sf-hover"},textColor:"white",textColorContrast:"#333",treemapBorder:1,treemapPadding:4,parentMargin:0,minLabelWidth:100,minLabelHeight:60}});return r}),define("ui/modules/treemap/treemap-module-extension",["ui/modules/treemap/treemap-module","utils/util"],function(e,t){var n=e.extend({_parseData:function(e){var n=this,r=this.aggregate(e.series);return{label:this.getLabel(e),sublabel:this.getSublabel(e),title:this.getTooltip(e),data:{$area:r,amount:r,color:"transparent"},children:t.map(e.series,function(e){var t=n.getValue(e),r=n.getColor(e);return{label:n.getLabel(e),sublabel:n.getSublabel(e),"class":n.getClass(e),title:n.getTooltip(e),percentage:"("+e.data.percentage.trim().replace(" ","")+")",data:{$area:t,amount:t,color:r,labelColor:n.getContrastColor(r),data:e.data}}})}}},{defaults:{classNames:{node:"sf-treemap-node",point:"sf-chart-point",level:"sf-treemap-level",symbol:"sf-treemap-symbol",aggregate:"sf-treemap-aggregate",hover:"sf-hover"},textColor:"white",textColorContrast:"#333",treemapBorder:5,treemapPadding:4,parentMargin:0,minLabelWidth:100,minLabelHeight:60}});return n}),define("libs/require/css/css!modules/analysis-treemap/css/analysis-treemap",[],function(){}),define("modules/analysis-treemap/analysis-treemap-module",["classes/analysis/analysis-accessible-chart","ui/modules/treemap/treemap-module","css!modules/analysis-treemap/css/analysis-treemap"],function(e,t){var n=e.extend({chartConstructor:t},{ID:"analysis-treemap",defaults:{}});return n}),define("hbs!modules/analysis-piechart/templates/analysis-piechart-tooltip",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing;s+=l((o=(o=t.point,o==null||o===!1?o:o.name),typeof o===f?o.apply(t):o))+"<br/>\n",a={hash:{}},u=(o=n.formatAmount,o?o.call(t,(o=t.point,o==null||o===!1?o:o.y),a):c.call(t,"formatAmount",(o=t.point,o==null||o===!1?o:o.y),a));if(u||u===0)s+=u;return s+=" (",a={hash:{}},s+=l((o=n.formatPercentage,o?o.call(t,(o=t.point,o==null||o===!1?o:o.percentage),a):c.call(t,"formatPercentage",(o=t.point,o==null||o===!1?o:o.percentage),a)))+")",s});return t.registerPartial("modules_analysis-piechart_templates_analysis-piechart-tooltip",n),n}),define("hbs!modules/analysis-piechart/templates/analysis-piechart-label",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing;s+=l((o=(o=t.point,o==null||o===!1?o:o.name),typeof o===f?o.apply(t):o))+'<br/>\n<span class="sf-number">',a={hash:{}},u=(o=n.formatAmount,o?o.call(t,(o=t.point,o==null||o===!1?o:o.y),a):c.call(t,"formatAmount",(o=t.point,o==null||o===!1?o:o.y),a));if(u||u===0)s+=u;return s+="</span>",s});return t.registerPartial("modules_analysis-piechart_templates_analysis-piechart-label",n),n}),define("modules/analysis-piechart/analysis-piechart-module",["classes/analysis/analysis-accessible-chart","utils/util","is!ie8?ui/modules/piechart/piechart-hc-module:classes/class","hbs!modules/analysis-piechart/templates/analysis-piechart-tooltip","hbs!modules/analysis-piechart/templates/analysis-piechart-label"],function(e,t,n,r,i){var s=e.extend({chartConstructor:n,initialize:function(){this._super.apply(this,arguments),this.config.chartOpts&&this.config.chartOpts.config&&t.merge(this.config.chartOpts,{plotOptions:{pie:{dataLabels:{enabled:!this.config.hideLabels&&!this.config.chartOpts.config.hideLabels}}}}),this.chartView.setConfig({chartOpts:this.config.chartOpts})},_triggerCategoryChange:function(e){this._super({catId:e.id})},parseSeries:function(e){if(t.isEmpty(e.collection))return null;var n=this.config.subcategorize;return this.innerSizePercent="70%",{series:n===!0?this._parseSubcategorySeries(e.collection):[{data:t.map(e.collection,this._singleElement)}]}},_parseSubcategorySeries:function(e){var n={};return t.each(e,function(e){t.size(e.subCats)?t.merge(n,e.subCats):n[e.catId]=e}),[{data:t.map(e,this._singleElement),size:this.innerSizePercent},{data:t.map(n,this._singleElement),innerSize:this.innerSizePercent}]},_singleElement:function(e){return{name:e.catName,y:Math.abs(e.amount),transactions:e.transactions,id:e.catId,color:e.catColor}}},{ID:"analysis-piechart",submodules:[n,e],defaults:{hideLabels:!1,subcategorize:!1,chartOpts:{tooltip:{formatter:function(){return r(this)}},plotOptions:{pie:{dataLabels:{formatter:function(){return i(this)}}}}}}});return s}),!function(){function p(e){return e!=null&&!isNaN(e)}function v(e){return e.length}function g(e){var t=1;while(e*t%1)t*=10;return t}function y(e,t){try{for(var n in t)Object.defineProperty(e.prototype,n,{value:t[n],enumerable:!1})}catch(r){e.prototype=t}}function b(){}function S(e){return w+e in this}function x(e){return e=w+e,e in this&&delete this[e]}function T(){var e=[];return this.forEach(function(t){e.push(t)}),e}function N(){var e=0;for(var t in this)t.charCodeAt(0)===E&&++e;return e}function C(){for(var e in this)if(e.charCodeAt(0)===E)return!1;return!0}function k(){}function L(e,t,n){return function(){var r=n.apply(t,arguments);return r===t?e:r}}function A(e,t){if(t in e)return t;t=t.charAt(0).toUpperCase()+t.substring(1);for(var n=0,r=O.length;n<r;++n){var i=O[n]+t;if(i in e)return i}}function M(){}function _(){}function D(e){function r(){var n=t,r=-1,i=n.length,s;while(++r<i)(s=n[r].on)&&s.apply(this,arguments);return e}var t=[],n=new b;return r.on=function(r,i){var s=n.get(r),o;return arguments.length<2?s&&s.on:(s&&(s.on=null,t=t.slice(0,o=t.indexOf(s)).concat(t.slice(o+1)),n.remove(r)),i&&t.push(n.set(r,{on:i})),e)},r}function P(){e.event.preventDefault()}function H(){var t=e.event,n;while(n=t.sourceEvent)t=n;return t}function B(t){var n=new _,r=0,i=arguments.length;while(++r<i)n[arguments[r]]=D(n);return n.of=function(r,i){return function(s){try{var o=s.sourceEvent=e.event;s.target=t,e.event=s,n[s.type].apply(r,i)}finally{e.event=o}}},n}function I(e){return F(e,W),e}function X(e){return typeof e=="function"?e:function(){return q(e,this)}}function V(e){return typeof e=="function"?e:function(){return R(e,this)}}function J(t,n){function r(){this.removeAttribute(t)}function i(){this.removeAttributeNS(t.space,t.local)}function s(){this.setAttribute(t,n)}function o(){this.setAttributeNS(t.space,t.local,n)}function u(){var e=n.apply(this,arguments);e==null?this.removeAttribute(t):this.setAttribute(t,e)}function a(){var e=n.apply(this,arguments);e==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,e)}return t=e.ns.qualify(t),n==null?t.local?i:r:typeof n=="function"?t.local?a:u:t.local?o:s}function K(e){return e.trim().replace(/\s+/g," ")}function Q(t){return new RegExp("(?:^|\\s+)"+e.requote(t)+"(?:\\s+|$)","g")}function G(e){return e.trim().split(/^|\s+/)}function Y(e,t){function r(){var r=-1;while(++r<n)e[r](this,t)}function i(){var r=-1,i=t.apply(this,arguments);while(++r<n)e[r](this,i)}e=G(e).map(Z);var n=e.length;return typeof t=="function"?i:r}function Z(e){var t=Q(e);return function(n,r){if(i=n.classList)return r?i.add(e):i.remove(e);var i=n.getAttribute("class")||"";r?(t.lastIndex=0,t.test(i)||n.setAttribute("class",K(i+" "+e))):n.setAttribute("class",K(i.replace(t," ")))}}function et(e,t,n){function r(){this.style.removeProperty(e)}function i(){this.style.setProperty(e,t,n)}function s(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(e):this.style.setProperty(e,r,n)}return t==null?r:typeof t=="function"?s:i}function tt(e,t){function n(){delete this[e]}function r(){this[e]=t}function i(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}return t==null?n:typeof t=="function"?i:r}function nt(t){return typeof t=="function"?t:(t=e.ns.qualify(t)).local?function(){return this.ownerDocument.createElementNS(t.space,t.local)}:function(){return this.ownerDocument.createElementNS(this.namespaceURI,t)}}function rt(e){return{__data__:e}}function it(e){return function(){return z(this,e)}}function st(t){return arguments.length||(t=e.ascending),function(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}}function ot(e,t){for(var n=0,r=e.length;n<r;n++)for(var i=e[n],s=0,o=i.length,u;s<o;s++)(u=i[s])&&t(u,s,n);return e}function ut(e){return F(e,at),e}function ft(e){var t,n;return function(r,i,s){var o=e[s].update,u=o.length,a;s!=n&&(n=s,t=0),i>=t&&(t=i+1);while(!(a=o[t])&&++t<u);return a}}function lt(){var e=this.__transition__;e&&++e.active}function ht(t,r,i){function f(){var e=this[s];e&&(this.removeEventListener(t,e,e.$),delete this[s])}function l(){var e=u(r,n(arguments));f.call(this),this.addEventListener(t,this[s]=e,e.$=i),e._=r}function c(){var n=new RegExp("^__on([^.]+)"+e.requote(t)+"$"),r;for(var i in this)if(r=i.match(n)){var s=this[i];this.removeEventListener(r[1],s,s.$),delete this[i]}}var s="__on"+t,o=t.indexOf("."),u=dt;o>0&&(t=t.substring(0,o));var a=pt.get(t);return a&&(t=a,u=vt),o?r?l:f:r?M:c}function dt(t,n){return function(r){var i=e.event;e.event=r,n[0]=this.__data__;try{t.apply(this,n)}finally{e.event=i}}}function vt(e,t){var n=dt(e,t);return function(e){var t=this,r=e.relatedTarget;(!r||r!==t&&!(r.compareDocumentPosition(t)&8))&&n.call(t,e)}}function yt(){var t=".dragsuppress-"+ ++gt,n="click"+t,r=e.select(s).on("touchmove"+t,P).on("dragstart"+t,P).on("selectstart"+t,P);if(mt){var o=i.style,u=o[mt];o[mt]="none"}return function(e){r.on(t,null),mt&&(o[mt]=u);if(e){function i(){r.on(n,null)}r.on(n,function(){P(),i()},!0),setTimeout(i,0)}}}function wt(t,n){n.changedTouches&&(n=n.changedTouches[0]);var r=t.ownerSVGElement||t;if(r.createSVGPoint){var i=r.createSVGPoint();if(bt<0&&(s.scrollX||s.scrollY)){r=e.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var o=r[0][0].getScreenCTM();bt=!o.f&&!o.e,r.remove()}return bt?(i.x=n.pageX,i.y=n.pageY):(i.x=n.clientX,i.y=n.clientY),i=i.matrixTransform(t.getScreenCTM().inverse()),[i.x,i.y]}var u=t.getBoundingClientRect();return[n.clientX-u.left-t.clientLeft,n.clientY-u.top-t.clientTop]}function Lt(e){return e>0?1:e<0?-1:0}function At(e,t,n){return(t[0]-e[0])*(n[1]-e[1])-(t[1]-e[1])*(n[0]-e[0])}function Ot(e){return e>1?0:e<-1?Et:Math.acos(e)}function Mt(e){return e>1?xt:e<-1?-xt:Math.asin(e)}function _t(e){return((e=Math.exp(e))-1/e)/2}function Dt(e){return((e=Math.exp(e))+1/e)/2}function Pt(e){return((e=Math.exp(2*e))-1)/(e+1)}function Ht(e){return(e=Math.sin(e/2))*e}function Ut(){}function zt(e,t,n){return new Wt(e,t,n)}function Wt(e,t,n){this.h=e,this.s=t,this.l=n}function Vt(e,t,n){function s(e){return e>360?e-=360:e<0&&(e+=360),e<60?r+(i-r)*e/60:e<180?i:e<240?r+(i-r)*(240-e)/60:r}function o(e){return Math.round(s(e)*255)}var r,i;return e=isNaN(e)?0:(e%=360)<0?e+360:e,t=isNaN(t)?0:t<0?0:t>1?1:t,n=n<0?0:n>1?1:n,i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i,hn(o(e+120),o(e),o(e-120))}function $t(e,t,n){return new Jt(e,t,n)}function Jt(e,t,n){this.h=e,this.c=t,this.l=n}function Qt(e,t,n){return isNaN(e)&&(e=0),isNaN(t)&&(t=0),Gt(n,Math.cos(e*=Ct)*t,Math.sin(e)*t)}function Gt(e,t,n){return new Yt(e,t,n)}function Yt(e,t,n){this.l=e,this.a=t,this.b=n}function sn(e,t,n){var r=(e+16)/116,i=r+t/500,s=r-n/200;return i=un(i)*en,r=un(r)*tn,s=un(s)*nn,hn(fn(3.2404542*i-1.5371385*r-.4985314*s),fn(-0.969266*i+1.8760108*r+.041556*s),fn(.0556434*i-.2040259*r+1.0572252*s))}function on(e,t,n){return e>0?$t(Math.atan2(n,t)*kt,Math.sqrt(t*t+n*n),e):$t(NaN,NaN,e)}function un(e){return e>.206893034?e*e*e:(e-4/29)/7.787037}function an(e){return e>.008856?Math.pow(e,1/3):7.787037*e+4/29}function fn(e){return Math.round(255*(e<=.00304?12.92*e:1.055*Math.pow(e,1/2.4)-.055))}function ln(e){return hn(e>>16,e>>8&255,e&255)}function cn(e){return ln(e)+""}function hn(e,t,n){return new pn(e,t,n)}function pn(e,t,n){this.r=e,this.g=t,this.b=n}function vn(e){return e<16?"0"+Math.max(0,e).toString(16):Math.min(255,e).toString(16)}function mn(e,t,n){var r=0,i=0,s=0,o,u,a;o=/([a-z]+)\((.*)\)/i.exec(e);if(o){u=o[2].split(",");switch(o[1]){case"hsl":return n(parseFloat(u[0]),parseFloat(u[1])/100,parseFloat(u[2])/100);case"rgb":return t(wn(u[0]),wn(u[1]),wn(u[2]))}}return(a=En.get(e))?t(a.r,a.g,a.b):(e!=null&&e.charAt(0)==="#"&&(e.length===4?(r=e.charAt(1),r+=r,i=e.charAt(2),i+=i,s=e.charAt(3),s+=s):e.length===7&&(r=e.substring(1,3),i=e.substring(3,5),s=e.substring(5,7)),r=parseInt(r,16),i=parseInt(i,16),s=parseInt(s,16)),t(r,i,s))}function gn(e,t,n){var r=Math.min(e/=255,t/=255,n/=255),i=Math.max(e,t,n),s=i-r,o,u,a=(i+r)/2;return s?(u=a<.5?s/(i+r):s/(2-i-r),e==i?o=(t-n)/s+(t<n?6:0):t==i?o=(n-e)/s+2:o=(e-t)/s+4,o*=60):(o=NaN,u=a>0&&a<1?0:o),zt(o,u,a)}function yn(e,t,n){e=bn(e),t=bn(t),n=bn(n);var r=an((.4124564*e+.3575761*t+.1804375*n)/en),i=an((.2126729*e+.7151522*t+.072175*n)/tn),s=an((.0193339*e+.119192*t+.9503041*n)/nn);return Gt(116*i-16,500*(r-i),200*(i-s))}function bn(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function wn(e){var t=parseFloat(e);return e.charAt(e.length-1)==="%"?Math.round(t*2.55):t}function Sn(e){return typeof e=="function"?e:function(){return e}}function xn(e){return e}function Tn(e){return function(t,n,r){return arguments.length===2&&typeof n=="function"&&(r=n,n=null),Nn(t,n,e,r)}}function Nn(t,r,i,o){function h(){var e=l.status,t;if(!e&&l.responseText||e>=200&&e<300||e===304){try{t=i.call(u,l)}catch(n){a.error.call(u,n);return}a.load.call(u,t)}else a.error.call(u,l)}var u={},a=e.dispatch("beforesend","progress","load","error"),f={},l=new XMLHttpRequest,c=null;return s.XDomainRequest&&!("withCredentials"in l)&&/^(http(s)?:)?\/\//.test(t)&&(l=new XDomainRequest),"onload"in l?l.onload=l.onerror=h:l.onreadystatechange=function(){l.readyState>3&&h()},l.onprogress=function(t){var n=e.event;e.event=t;try{a.progress.call(u,l)}finally{e.event=n}},u.header=function(e,t){return e=(e+"").toLowerCase(),arguments.length<2?f[e]:(t==null?delete f[e]:f[e]=t+"",u)},u.mimeType=function(e){return arguments.length?(r=e==null?null:e+"",u):r},u.responseType=function(e){return arguments.length?(c=e,u):c},u.response=function(e){return i=e,u},["get","post"].forEach(function(e){u[e]=function(){return u.send.apply(u,[e].concat(n(arguments)))}}),u.send=function(e,n,i){arguments.length===2&&typeof n=="function"&&(i=n,n=null),l.open(e,t,!0),r!=null&&!("accept"in f)&&(f.accept=r+",*/*");if(l.setRequestHeader)for(var s in f)l.setRequestHeader(s,f[s]);return r!=null&&l.overrideMimeType&&l.overrideMimeType(r),c!=null&&(l.responseType=c),i!=null&&u.on("error",i).on("load",function(e){i(null,e)}),a.beforesend.call(u,l),l.send(n==null?null:n),u},u.abort=function(){return l.abort(),u},e.rebind(u,a,"on"),o==null?u:u.get(Cn(o))}function Cn(e){return e.length===1?function(t,n){e(t==null?n:null)}:e}function Dn(){var e=Pn(),t=Hn()-e;t>24?(isFinite(t)&&(clearTimeout(On),On=setTimeout(Dn,t)),An=0):(An=1,_n(Dn))}function Pn(){var e=Date.now();Mn=kn;while(Mn)e>=Mn.t&&(Mn.f=Mn.c(e-Mn.t)),Mn=Mn.n;return e}function Hn(){var e,t=kn,n=Infinity;while(t)t.f?t=e?e.n=t.n:kn=t.n:(t.t<n&&(n=t.t),t=(e=t).n);return Ln=e,n}function Bn(e,t){return t-(e?Math.ceil(Math.log(e)/Math.LN10):1)}function Fn(e,t){var n=Math.pow(10,m(8-t)*3);return{scale:t>8?function(e){return e/n}:function(e){return e*n},symbol:e}}function In(t){var n=t.decimal,r=t.thousands,i=t.grouping,s=t.currency,o=i?function(e){var t=e.length,n=[],s=0,o=i[0];while(t>0&&o>0)n.push(e.substring(t-=o,t+o)),o=i[s=(s+1)%i.length];return n.reverse().join(r)}:xn;return function(t){var r=qn.exec(t),i=r[1]||" ",u=r[2]||">",a=r[3]||"",f=r[4]||"",l=r[5],c=+r[6],h=r[7],p=r[8],d=r[9],v=1,m="",g="",y=!1;p&&(p=+p.substring(1));if(l||i==="0"&&u==="=")l=i="0",u="=",h&&(c-=Math.floor((c-1)/4));switch(d){case"n":h=!0,d="g";break;case"%":v=100,g="%",d="f";break;case"p":v=100,g="%",d="r";break;case"b":case"o":case"x":case"X":f==="#"&&(m="0"+d.toLowerCase());case"c":case"d":y=!0,p=0;break;case"s":v=-1,d="r"}f==="$"&&(m=s[0],g=s[1]),d=="r"&&!p&&(d="g");if(p!=null)if(d=="g")p=Math.max(1,Math.min(21,p));else if(d=="e"||d=="f")p=Math.max(0,Math.min(20,p));d=Rn.get(d)||Un;var b=l&&h;return function(t){if(y&&t%1)return"";var r=t<0||t===0&&1/t<0?(t=-t,"-"):a;if(v<0){var s=e.formatPrefix(t,p);t=s.scale(t),g=s.symbol}else t*=v;t=d(t,p);var f=t.lastIndexOf("."),w=f<0?t:t.substring(0,f),E=f<0?"":n+t.substring(f+1);!l&&h&&(w=o(w));var S=m.length+w.length+E.length+(b?0:r.length),x=S<c?(new Array(S=c-S+1)).join(i):"";return b&&(w=o(x+w)),r+=m,t=w+E,(u==="<"?r+t+x:u===">"?x+r+t:u==="^"?x.substring(0,S>>=1)+r+t+x.substring(S):r+(b?t:x+t))+g}}}function Un(e){return e+""}function Xn(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function $n(e,t,n){function r(t){var n=e(t),r=s(n,1);return t-n<r-t?n:r}function i(n){return t(n=e(new Wn(n-1)),1),n}function s(e,n){return t(e=new Wn(+e),n),e}function o(e,r,s){var o=i(e),u=[];if(s>1)while(o<r)n(o)%s||u.push(new Date(+o)),t(o,1);else while(o<r)u.push(new Date(+o)),t(o,1);return u}function u(e,t,n){try{Wn=Xn;var r=new Xn;return r._=e,o(r,t,n)}finally{Wn=Date}}e.floor=e,e.round=r,e.ceil=i,e.offset=s,e.range=o;var a=e.utc=Jn(e);return a.floor=a,a.round=Jn(r),a.ceil=Jn(i),a.offset=Jn(s),a.range=u,e}function Jn(e){return function(t,n){try{Wn=Xn;var r=new Xn;return r._=t,e(r,n)._}finally{Wn=Date}}}function Kn(t){function l(e){function n(n){var r=[],i=-1,s=0,o,u,a;while(++i<t)if(e.charCodeAt(i)===37){r.push(e.substring(s,i)),(u=Qn[o=e.charAt(++i)])!=null&&(o=e.charAt(++i));if(a=E[o])o=a(n,u==null?o==="e"?" ":"0":u);r.push(o),s=i+1}return r.push(e.substring(s,i)),r.join("")}var t=e.length;return n.parse=function(t){var n={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},r=c(n,e,t,0);if(r!=t.length)return null;"p"in n&&(n.H=n.H%12+n.p*12);var i=n.Z!=null&&Wn!==Xn,s=new(i?Xn:Wn);return"j"in n?s.setFullYear(n.y,0,n.j):"w"in n&&("W"in n||"U"in n)?(s.setFullYear(n.y,0,1),s.setFullYear(n.y,0,"W"in n?(n.w+6)%7+n.W*7-(s.getDay()+5)%7:n.w+n.U*7-(s.getDay()+6)%7)):s.setFullYear(n.y,n.m,n.d),s.setHours(n.H+Math.floor(n.Z/100),n.M+n.Z%100,n.S,n.L),i?s._:s},n.toString=function(){return e},n}function c(e,t,n,r){var i,s,o,u=0,a=t.length,f=n.length;while(u<a){if(r>=f)return-1;i=t.charCodeAt(u++);if(i===37){o=t.charAt(u++),s=S[o in Qn?t.charAt(u++):o];if(!s||(r=s(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}function x(e,t,n){v.lastIndex=0;var r=v.exec(t.substring(n));return r?(e.w=m.get(r[0].toLowerCase()),n+r[0].length):-1}function T(e,t,n){p.lastIndex=0;var r=p.exec(t.substring(n));return r?(e.w=d.get(r[0].toLowerCase()),n+r[0].length):-1}function N(e,t,n){b.lastIndex=0;var r=b.exec(t.substring(n));return r?(e.m=w.get(r[0].toLowerCase()),n+r[0].length):-1}function C(e,t,n){g.lastIndex=0;var r=g.exec(t.substring(n));return r?(e.m=y.get(r[0].toLowerCase()),n+r[0].length):-1}function k(e,t,n){return c(e,E.c.toString(),t,n)}function L(e,t,n){return c(e,E.x.toString(),t,n)}function A(e,t,n){return c(e,E.X.toString(),t,n)}function O(e,t,n){var r=h.get(t.substring(n,n+=2).toLowerCase());return r==null?-1:(e.p=r,n)}var n=t.dateTime,r=t.date,i=t.time,s=t.periods,o=t.days,u=t.shortDays,a=t.months,f=t.shortMonths;l.utc=function(e){function n(e){try{Wn=Xn;var n=new Wn;return n._=e,t(n)}finally{Wn=Date}}var t=l(e);return n.parse=function(e){try{Wn=Xn;var n=t.parse(e);return n&&n._}finally{Wn=Date}},n.toString=t.toString,n},l.multi=l.utc.multi=yr;var h=e.map(),p=er(o),d=tr(o),v=er(u),m=tr(u),g=er(a),y=tr(a),b=er(f),w=tr(f);s.forEach(function(e,t){h.set(e.toLowerCase(),t)});var E={a:function(e){return u[e.getDay()]},A:function(e){return o[e.getDay()]},b:function(e){return f[e.getMonth()]},B:function(e){return a[e.getMonth()]},c:l(n),d:function(e,t){return Zn(e.getDate(),t,2)},e:function(e,t){return Zn(e.getDate(),t,2)},H:function(e,t){return Zn(e.getHours(),t,2)},I:function(e,t){return Zn(e.getHours()%12||12,t,2)},j:function(e,t){return Zn(1+zn.dayOfYear(e),t,3)},L:function(e,t){return Zn(e.getMilliseconds(),t,3)},m:function(e,t){return Zn(e.getMonth()+1,t,2)},M:function(e,t){return Zn(e.getMinutes(),t,2)},p:function(e){return s[+(e.getHours()>=12)]},S:function(e,t){return Zn(e.getSeconds(),t,2)},U:function(e,t){return Zn(zn.sundayOfYear(e),t,2)},w:function(e){return e.getDay()},W:function(e,t){return Zn(zn.mondayOfYear(e),t,2)},x:l(r),X:l(i),y:function(e,t){return Zn(e.getFullYear()%100,t,2)},Y:function(e,t){return Zn(e.getFullYear()%1e4,t,4)},Z:mr,"%":function(){return"%"}},S={a:x,A:T,b:N,B:C,c:k,d:lr,e:lr,H:hr,I:hr,j:cr,L:vr,m:fr,M:pr,p:O,S:dr,U:rr,w:nr,W:ir,x:L,X:A,y:or,Y:sr,Z:ur,"%":gr};return l}function Zn(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",s=i.length;return r+(s<n?(new Array(n-s+1)).join(t)+i:i)}function er(t){return new RegExp("^(?:"+t.map(e.requote).join("|")+")","i")}function tr(e){var t=new b,n=-1,r=e.length;while(++n<r)t.set(e[n].toLowerCase(),n);return t}function nr(e,t,n){Gn.lastIndex=0;var r=Gn.exec(t.substring(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function rr(e,t,n){Gn.lastIndex=0;var r=Gn.exec(t.substring(n));return r?(e.U=+r[0],n+r[0].length):-1}function ir(e,t,n){Gn.lastIndex=0;var r=Gn.exec(t.substring(n));return r?(e.W=+r[0],n+r[0].length):-1}function sr(e,t,n){Gn.lastIndex=0;var r=Gn.exec(t.substring(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function or(e,t,n){Gn.lastIndex=0;var r=Gn.exec(t.substring(n,n+2));return r?(e.y=ar(+r[0]),n+r[0].length):-1}function ur(e,t,n){return/^[+-]\d{4}$/.test(t=t.substring(n,n+5))?(e.Z=+t,n+5):-1}function ar(e){return e+(e>68?1900:2e3)}function fr(e,t,n){Gn.lastIndex=0;var r=Gn.exec(t.substring(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function lr(e,t,n){Gn.lastIndex=0;var r=Gn.exec(t.substring(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function cr(e,t,n){Gn.lastIndex=0;var r=Gn.exec(t.substring(n,n+3));return r?(e.j=+r[0],n+r[0].length):-1}function hr(e,t,n){Gn.lastIndex=0;var r=Gn.exec(t.substring(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function pr(e,t,n){Gn.lastIndex=0;var r=Gn.exec(t.substring(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function dr(e,t,n){Gn.lastIndex=0;var r=Gn.exec(t.substring(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function vr(e,t,n){Gn.lastIndex=0;var r=Gn.exec(t.substring(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function mr(e){var t=e.getTimezoneOffset(),n=t>0?"-":"+",r=~~(m(t)/60),i=m(t)%60;return n+Zn(r,"0",2)+Zn(i,"0",2)}function gr(e,t,n){Yn.lastIndex=0;var r=Yn.exec(t.substring(n,n+1));return r?n+r[0].length:-1}function yr(e){var t=e.length,n=-1;while(++n<t)e[n][0]=this(e[n][0]);return function(t){var n=0,r=e[n];while(!r[1](t))r=e[++n];return r[0](t)}}function wr(){}function Sr(e,t,n){var r=n.s=e+t,i=r-e,s=r-i;n.t=e-s+(t-i)}function xr(e,t){e&&Nr.hasOwnProperty(e.type)&&Nr[e.type](e,t)}function Cr(e,t,n){var r=-1,i=e.length-n,s;t.lineStart();while(++r<i)s=e[r],t.point(s[0],s[1],s[2]);t.lineEnd()}function kr(e,t){var n=-1,r=e.length;t.polygonStart();while(++n<r)Cr(e[n],t,1);t.polygonEnd()}function Mr(){function s(e,t){e*=Ct,t=t*Ct/2+Et/4;var s=e-n,o=Math.cos(t),u=Math.sin(t),a=i*u,f=r*o+a*Math.cos(s),l=a*Math.sin(s);Ar.add(Math.atan2(l,f)),n=e,r=o,i=u}var e,t,n,r,i;Or.point=function(o,u){Or.point=s,n=(e=o)*Ct,r=Math.cos(u=(t=u)*Ct/2+Et/4),i=Math.sin(u)},Or.lineEnd=function(){s(e,t)}}function _r(e){var t=e[0],n=e[1],r=Math.cos(n);return[r*Math.cos(t),r*Math.sin(t),Math.sin(n)]}function Dr(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Pr(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Hr(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function Br(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function jr(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function Fr(e){return[Math.atan2(e[1],e[0]),Mt(e[2])]}function Ir(e,t){return m(e[0]-t[0])<Tt&&m(e[1]-t[1])<Tt}function Yr(e,t){e*=Ct;var n=Math.cos(t*=Ct);Zr(n*Math.cos(e),n*Math.sin(e),Math.sin(t))}function Zr(e,t,n){++qr,Ur+=(e-Ur)/qr,zr+=(t-zr)/qr,Wr+=(n-Wr)/qr}function ei(){function r(r,i){r*=Ct;var s=Math.cos(i*=Ct),o=s*Math.cos(r),u=s*Math.sin(r),a=Math.sin(i),f=Math.atan2(Math.sqrt((f=t*a-n*u)*f+(f=n*o-e*a)*f+(f=e*u-t*o)*f),e*o+t*u+n*a);Rr+=f,Xr+=f*(e+(e=o)),Vr+=f*(t+(t=u)),$r+=f*(n+(n=a)),Zr(e,t,n)}var e,t,n;Gr.point=function(i,s){i*=Ct;var o=Math.cos(s*=Ct);e=o*Math.cos(i),t=o*Math.sin(i),n=Math.sin(s),Gr.point=r,Zr(e,t,n)}}function ti(){Gr.point=Yr}function ni(){function s(e,t){e*=Ct;var s=Math.cos(t*=Ct),o=s*Math.cos(e),u=s*Math.sin(e),a=Math.sin(t),f=r*a-i*u,l=i*o-n*a,c=n*u-r*o,h=Math.sqrt(f*f+l*l+c*c),p=n*o+r*u+i*a,d=h&&-Ot(p)/h,v=Math.atan2(h,p);Jr+=d*f,Kr+=d*l,Qr+=d*c,Rr+=v,Xr+=v*(n+(n=o)),Vr+=v*(r+(r=u)),$r+=v*(i+(i=a)),Zr(n,r,i)}var e,t,n,r,i;Gr.point=function(o,u){e=o,t=u,Gr.point=s,o*=Ct;var a=Math.cos(u*=Ct);n=a*Math.cos(o),r=a*Math.sin(o),i=Math.sin(u),Zr(n,r,i)},Gr.lineEnd=function(){s(e,t),Gr.lineEnd=ti,Gr.point=Yr}}function ri(){return!0}function ii(e,t,n,r,i){var s=[],o=[];e.forEach(function(e){if((t=e.length-1)<=0)return;var t,n=e[0],r=e[t];if(Ir(n,r)){i.lineStart();for(var u=0;u<t;++u)i.point((n=e[u])[0],n[1]);i.lineEnd();return}var a=new oi(n,e,null,!0),f=new oi(n,null,a,!1);a.o=f,s.push(a),o.push(f),a=new oi(r,e,null,!1),f=new oi(r,null,a,!0),a.o=f,s.push(a),o.push(f)}),o.sort(t),si(s),si(o);if(!s.length)return;for(var u=0,a=n,f=o.length;u<f;++u)o[u].e=a=!a;var l=s[0],c,h;for(;;){var p=l,d=!0;while(p.v)if((p=p.n)===l)return;c=p.z,i.lineStart();do{p.v=p.o.v=!0;if(p.e){if(d)for(var u=0,f=c.length;u<f;++u)i.point((h=c[u])[0],h[1]);else r(p.x,p.n.x,1,i);p=p.n}else{if(d){c=p.p.z;for(var u=c.length-1;u>=0;--u)i.point((h=c[u])[0],h[1])}else r(p.x,p.p.x,-1,i);p=p.p}p=p.o,c=p.z,d=!d}while(!p.v);i.lineEnd()}}function si(e){if(!(t=e.length))return;var t,n=0,r=e[0],i;while(++n<t)r.n=i=e[n],i.p=r,r=i;r.n=i=e[0],i.p=r}function oi(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function ui(t,n,r,i){return function(s,o){function l(e,n){var r=s(e,n);t(e=r[0],n=r[1])&&o.point(e,n)}function c(e,t){var n=s(e,t);u.point(n[0],n[1])}function h(){f.point=c,u.lineStart()}function p(){f.point=l,u.lineEnd()}function b(e,t){y.push([e,t]);var n=s(e,t);m.point(n[0],n[1])}function w(){m.lineStart(),y=[]}function E(){b(y[0][0],y[0][1]),m.lineEnd();var e=m.clean(),t=v.buffer(),n,r=t.length;y.pop(),g.push(y),y=null;if(!r)return;if(e&1){n=t[0];var r=n.length-1,i=-1,s;o.lineStart();while(++i<r)o.point((s=n[i])[0],s[1]);o.lineEnd();return}r>1&&e&2&&t.push(t.pop().concat(t.shift())),d.push(t.filter(ai))}var u=n(o),a=s.invert(i[0],i[1]),f={point:l,lineStart:h,lineEnd:p,polygonStart:function(){f.point=b,f.lineStart=w,f.lineEnd=E,d=[],g=[],o.polygonStart()},polygonEnd:function(){f.point=l,f.lineStart=h,f.lineEnd=p,d=e.merge(d);var t=ci(a,g);d.length?ii(d,li,t,r,o):t&&(o.lineStart(),r(null,null,1,o),o.lineEnd()),o.polygonEnd(),d=g=null},sphere:function(){o.polygonStart(),o.lineStart(),r(null,null,1,o),o.lineEnd(),o.polygonEnd()}},d,v=fi(),m=n(v),g,y;return f}}function ai(e){return e.length>1}function fi(){var e=[],t;return{lineStart:function(){e.push(t=[])},point:function(e,n){t.push([e,n])},lineEnd:M,buffer:function(){var n=e;return e=[],t=null,n},rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))}}}function li(e,t){return((e=e.x)[0]<0?e[1]-xt-Tt:xt-e[1])-((t=t.x)[0]<0?t[1]-xt-Tt:xt-t[1])}function ci(e,t){var n=e[0],r=e[1],i=[Math.sin(n),-Math.cos(n),0],s=0,o=0;Ar.reset();for(var u=0,a=t.length;u<a;++u){var f=t[u],l=f.length;if(!l)continue;var c=f[0],h=c[0],p=c[1]/2+Et/4,d=Math.sin(p),v=Math.cos(p),g=1;for(;;){g===l&&(g=0),e=f[g];var y=e[0],b=e[1]/2+Et/4,w=Math.sin(b),E=Math.cos(b),S=y-h,x=m(S)>Et,T=d*w;Ar.add(Math.atan2(T*Math.sin(S),v*E+T*Math.cos(S))),s+=x?S+(S>=0?St:-St):S;if(x^h>=n^y>=n){var N=Pr(_r(c),_r(e));jr(N);var C=Pr(i,N);jr(C);var k=(x^S>=0?-1:1)*Mt(C[2]);if(r>k||r===k&&(N[0]||N[1]))o+=x^S>=0?1:-1}if(!(g++))break;h=y,d=w,v=E,c=e}}return(s<-Tt||s<Tt&&Ar<0)^o&1}function pi(e){var t=NaN,n=NaN,r=NaN,i;return{lineStart:function(){e.lineStart(),i=1},point:function(s,o){var u=s>0?Et:-Et,a=m(s-t);m(a-Et)<Tt?(e.point(t,n=(n+o)/2>0?xt:-xt),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(u,n),e.point(s,n),i=0):r!==u&&a>=Et&&(m(t-r)<Tt&&(t-=r*Tt),m(s-u)<Tt&&(s-=u*Tt),n=di(t,n,s,o),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(u,n),i=0),e.point(t=s,n=o),r=u},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-i}}}function di(e,t,n,r){var i,s,o=Math.sin(e-n);return m(o)>Tt?Math.atan((Math.sin(t)*(s=Math.cos(r))*Math.sin(n)-Math.sin(r)*(i=Math.cos(t))*Math.sin(e))/(i*s*o)):(t+r)/2}function vi(e,t,n,r){var i;if(e==null)i=n*xt,r.point(-Et,i),r.point(0,i),r.point(Et,i),r.point(Et,0),r.point(Et,-i),r.point(0,-i),r.point(-Et,-i),r.point(-Et,0),r.point(-Et,i);else if(m(e[0]-t[0])>Tt){var s=e[0]<t[0]?Et:-Et;i=n*s/2,r.point(-s,i),r.point(0,i),r.point(s,i)}else r.point(t[0],t[1])}function mi(e){function s(e,n){return Math.cos(e)*Math.cos(n)>t}function o(e){var t,i,o,f,l;return{lineStart:function(){f=o=!1,l=1},point:function(c,h){var p=[c,h],d,v=s(c,h),m=n?v?0:a(c,h):v?a(c+(c<0?Et:-Et),h):0;!t&&(f=o=v)&&e.lineStart();if(v!==o){d=u(t,p);if(Ir(t,d)||Ir(p,d))p[0]+=Tt,p[1]+=Tt,v=s(p[0],p[1])}if(v!==o)l=0,v?(e.lineStart(),d=u(p,t),e.point(d[0],d[1])):(d=u(t,p),e.point(d[0],d[1]),e.lineEnd()),t=d;else if(r&&t&&n^v){var g;!(m&i)&&(g=u(p,t,!0))&&(l=0,n?(e.lineStart(),e.point(g[0][0],g[0][1]),e.point(g[1][0],g[1][1]),e.lineEnd()):(e.point(g[1][0],g[1][1]),e.lineEnd(),e.lineStart(),e.point(g[0][0],g[0][1])))}v&&(!t||!Ir(t,p))&&e.point(p[0],p[1]),t=p,o=v,i=m},lineEnd:function(){o&&e.lineEnd(),t=null},clean:function(){return l|(f&&o)<<1}}}function u(e,n,r){var i=_r(e),s=_r(n),o=[1,0,0],u=Pr(i,s),a=Dr(u,u),f=u[0],l=a-f*f;if(!l)return!r&&e;var c=t*a/l,h=-t*f/l,p=Pr(o,u),d=Br(o,c),v=Br(u,h);Hr(d,v);var g=p,y=Dr(d,g),b=Dr(g,g),w=y*y-b*(Dr(d,d)-1);if(w<0)return;var E=Math.sqrt(w),S=Br(g,(-y-E)/b);Hr(S,d),S=Fr(S);if(!r)return S;var x=e[0],T=n[0],N=e[1],C=n[1],k;T<x&&(k=x,x=T,T=k);var L=T-x,A=m(L-Et)<Tt,O=A||L<Tt;!A&&C<N&&(k=N,N=C,C=k);if(O?A?N+C>0^S[1]<(m(S[0]-x)<Tt?N:C):N<=S[1]&&S[1]<=C:L>Et^(x<=S[0]&&S[0]<=T)){var M=Br(g,(-y+E)/b);return Hr(M,d),[S,Fr(M)]}}function a(t,r){var i=n?e:Et-e,s=0;return t<-i?s|=1:t>i&&(s|=2),r<-i?s|=4:r>i&&(s|=8),s}var t=Math.cos(e),n=t>0,r=m(t)>Tt,i=es(e,6*Ct);return ui(s,o,i,n?[0,-e]:[-Et,e-Et])}function gi(e,t,n,r){return function(i){var s=i.a,o=i.b,u=s.x,a=s.y,f=o.x,l=o.y,c=0,h=1,p=f-u,d=l-a,v;v=e-u;if(!p&&v>0)return;v/=p;if(p<0){if(v<c)return;v<h&&(h=v)}else if(p>0){if(v>h)return;v>c&&(c=v)}v=n-u;if(!p&&v<0)return;v/=p;if(p<0){if(v>h)return;v>c&&(c=v)}else if(p>0){if(v<c)return;v<h&&(h=v)}v=t-a;if(!d&&v>0)return;v/=d;if(d<0){if(v<c)return;v<h&&(h=v)}else if(d>0){if(v>h)return;v>c&&(c=v)}v=r-a;if(!d&&v<0)return;v/=d;if(d<0){if(v>h)return;v>c&&(c=v)}else if(d>0){if(v<c)return;v<h&&(h=v)}return c>0&&(i.a={x:u+c*p,y:a+c*d}),h<1&&(i.b={x:u+h*p,y:a+h*d}),i}}function bi(t,n,r,i){function s(e,i){return m(e[0]-t)<Tt?i>0?0:3:m(e[0]-r)<Tt?i>0?2:1:m(e[1]-n)<Tt?i>0?1:0:i>0?3:2}function o(e,t){return u(e.x,t.x)}function u(e,t){var n=s(e,1),r=s(t,1);return n!==r?n-r:n===0?t[1]-e[1]:n===1?e[0]-t[0]:n===2?e[1]-t[1]:t[0]-e[0]}return function(a){function m(e){var t=0,n=p.length,r=e[1];for(var i=0;i<n;++i)for(var s=1,o=p[i],u=o.length,a=o[0],f;s<u;++s)f=o[s],a[1]<=r?f[1]>r&&At(a,f,e)>0&&++t:f[1]<=r&&At(a,f,e)<0&&--t,a=f;return t!==0}function g(e,o,a,f){var l=0,c=0;if(e==null||(l=s(e,a))!==(c=s(o,a))||u(e,o)<0^a>0){do f.point(l===0||l===3?t:r,l>1?i:n);while((l=(l+a+4)%4)!==c)}else f.point(o[0],o[1])}function y(e,s){return t<=e&&e<=r&&n<=s&&s<=i}function b(e,t){y(e,t)&&a.point(e,t)}function L(){v.point=O,p&&p.push(d=[]),C=!0,N=!1,x=T=NaN}function A(){h&&(O(w,E),S&&N&&l.rejoin(),h.push(l.buffer())),v.point=b,N&&a.lineEnd()}function O(e,t){e=Math.max(-yi,Math.min(yi,e)),t=Math.max(-yi,Math.min(yi,t));var n=y(e,t);p&&d.push([e,t]);if(C)w=e,E=t,S=n,C=!1,n&&(a.lineStart(),a.point(e,t));else if(n&&N)a.point(e,t);else{var r={a:{x:x,y:T},b:{x:e,y:t}};c(r)?(N||(a.lineStart(),a.point(r.a.x,r.a.y)),a.point(r.b.x,r.b.y),n||a.lineEnd(),k=!1):n&&(a.lineStart(),a.point(e,t),k=!1)}x=e,T=t,N=n}var f=a,l=fi(),c=gi(t,n,r,i),h,p,d,v={point:b,lineStart:L,lineEnd:A,polygonStart:function(){a=l,h=[],p=[],k=!0},polygonEnd:function(){a=f,h=e.merge(h);var n=m([t,i]),r=k&&n,s=h.length;if(r||s)a.polygonStart(),r&&(a.lineStart(),g(null,null,1,a),a.lineEnd()),s&&ii(h,o,n,g,a),a.polygonEnd();h=p=d=null}},w,E,S,x,T,N,C,k;return v}}function wi(e,t){function n(n,r){return n=e(n,r),t(n[0],n[1])}return e.invert&&t.invert&&(n.invert=function(n,r){return n=t.invert(n,r),n&&e.invert(n[0],n[1])}),n}function Ei(e){var t=0,n=Et/3,r=Vi(e),i=r(t,n);return i.parallels=function(e){return arguments.length?r(t=e[0]*Et/180,n=e[1]*Et/180):[t/Et*180,n/Et*180]},i}function Si(e,t){function o(e,t){var n=Math.sqrt(i-2*r*Math.sin(t))/r;return[n*Math.sin(e*=r),s-n*Math.cos(e)]}var n=Math.sin(e),r=(n+Math.sin(t))/2,i=1+n*(2*r-n),s=Math.sqrt(i)/r;return o.invert=function(e,t){var n=s-t;return[Math.atan2(e,n)/r,Mt((i-(e*e+n*n)*r*r)/(2*r))]},o}function Ci(){function i(e,t){Ti+=r*e-n*t,n=e,r=t}var e,t,n,r;Ni.point=function(s,o){Ni.point=i,e=n=s,t=r=o},Ni.lineEnd=function(){i(e,t)}}function _i(e,t){e<ki&&(ki=e),e>Ai&&(Ai=e),t<Li&&(Li=t),t>Oi&&(Oi=t)}function Di(){function r(n,r){t.push("M",n,",",r,e)}function i(e,r){t.push("M",e,",",r),n.point=s}function s(e,n){t.push("L",e,",",n)}function o(){n.point=r}function u(){t.push("Z")}var e=Pi(4.5),t=[],n={point:r,lineStart:function(){n.point=i},lineEnd:o,polygonStart:function(){n.lineEnd=u},polygonEnd:function(){n.lineEnd=o,n.point=r},pointRadius:function(t){return e=Pi(t),n},result:function(){if(t.length){var e=t.join("");return t=[],e}}};return n}function Pi(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+ -2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function Bi(e,t){Ur+=e,zr+=t,++Wr}function ji(){function n(n,r){var i=n-e,s=r-t,o=Math.sqrt(i*i+s*s);Xr+=o*(e+n)/2,Vr+=o*(t+r)/2,$r+=o,Bi(e=n,t=r)}var e,t;Hi.point=function(r,i){Hi.point=n,Bi(e=r,t=i)}}function Fi(){Hi.point=Bi}function Ii(){function i(e,t){var i=e-n,s=t-r,o=Math.sqrt(i*i+s*s);Xr+=o*(n+e)/2,Vr+=o*(r+t)/2,$r+=o,o=r*e-n*t,Jr+=o*(n+e),Kr+=o*(r+t),Qr+=o*3,Bi(n=e,r=t)}var e,t,n,r;Hi.point=function(s,o){Hi.point=i,Bi(e=n=s,t=r=o)},Hi.lineEnd=function(){i(e,t)}}function qi(e){function r(n,r){e.moveTo(n,r),e.arc(n,r,t,0,St)}function i(t,r){e.moveTo(t,r),n.point=s}function s(t,n){e.lineTo(t,n)}function o(){n.point=r}function u(){e.closePath()}var t=4.5,n={point:r,lineStart:function(){n.point=i},lineEnd:o,polygonStart:function(){n.lineEnd=u},polygonEnd:function(){n.lineEnd=o,n.point=r},pointRadius:function(e){return t=e,n},result:M};return n}function Ri(e){function i(e){return(r?o:s)(e)}function s(t){return Wi(t,function(n,r){n=e(n,r),t.point(n[0],n[1])})}function o(t){function y(n,r){n=e(n,r),t.point(n[0],n[1])}function b(){h=NaN,g.point=w,t.lineStart()}function w(n,i){var s=_r([n,i]),o=e(n,i);u(h,p,c,d,v,m,h=o[0],p=o[1],c=n,d=s[0],v=s[1],m=s[2],r,t),t.point(h,p)}function E(){g.point=y,t.lineEnd()}function S(){b(),g.point=x,g.lineEnd=T}function x(e,t){w(n=e,i=t),s=h,o=p,a=d,f=v,l=m,g.point=w}function T(){u(h,p,c,d,v,m,s,o,n,a,f,l,r,t),g.lineEnd=E,E()}var n,i,s,o,a,f,l,c,h,p,d,v,m,g={point:y,lineStart:b,lineEnd:E,polygonStart:function(){t.polygonStart(),g.lineStart=S},polygonEnd:function(){t.polygonEnd(),g.lineStart=b}};return g}function u(r,i,s,o,a,f,l,c,h,p,d,v,g,y){var b=l-r,w=c-i,E=b*b+w*w;if(E>4*t&&g--){var S=o+p,x=a+d,T=f+v,N=Math.sqrt(S*S+x*x+T*T),C=Math.asin(T/=N),k=m(m(T)-1)<Tt||m(s-h)<Tt?(s+h)/2:Math.atan2(x,S),L=e(k,C),A=L[0],O=L[1],M=A-r,_=O-i,D=w*M-b*_;if(D*D/E>t||m((b*M+w*_)/E-.5)>.3||o*p+a*d+f*v<n)u(r,i,s,o,a,f,A,O,k,S/=N,x/=N,T,g,y),y.point(A,O),u(A,O,k,S,x,T,l,c,h,p,d,v,g,y)}}var t=.5,n=Math.cos(30*Ct),r=16;return i.precision=function(e){return arguments.length?(r=(t=e*e)>0&&16,i):Math.sqrt(t)},i}function Ui(e){var t=Ri(function(t,n){return e([t*kt,n*kt])});return function(e){return $i(t(e))}}function zi(e){this.stream=e}function Wi(e,t){return{point:t,sphere:function(){e.sphere()},lineStart:function(){e.lineStart()},lineEnd:function(){e.lineEnd()},polygonStart:function(){e.polygonStart()},polygonEnd:function(){e.polygonEnd()}}}function Xi(e){return Vi(function(){return e})()}function Vi(t){function E(e){return e=i(e[0]*Ct,e[1]*Ct),[e[0]*o+d,v-e[1]*o]}function S(e){return e=i.invert((e[0]-d)/o,(v-e[1])/o),e&&[e[0]*kt,e[1]*kt]}function x(){i=wi(r=Qi(c,h,p),n);var e=n(f,l);return d=u-e[0]*o,v=a+e[1]*o,T()}function T(){return w&&(w.valid=!1,w=null),E}var n,r,i,s=Ri(function(e,t){return e=n(e,t),[e[0]*o+d,v-e[1]*o]}),o=150,u=480,a=250,f=0,l=0,c=0,h=0,p=0,d,v,m=hi,g=xn,y=null,b=null,w;return E.stream=function(e){return w&&(w.valid=!1),w=$i(m(r,s(g(e)))),w.valid=!0,w},E.clipAngle=function(e){return arguments.length?(m=e==null?(y=e,hi):mi((y=+e)*Ct),T()):y},E.clipExtent=function(e){return arguments.length?(b=e,g=e?bi(e[0][0],e[0][1],e[1][0],e[1][1]):xn,T()):b},E.scale=function(e){return arguments.length?(o=+e,x()):o},E.translate=function(e){return arguments.length?(u=+e[0],a=+e[1],x()):[u,a]},E.center=function(e){return arguments.length?(f=e[0]%360*Ct,l=e[1]%360*Ct,x()):[f*kt,l*kt]},E.rotate=function(e){return arguments.length?(c=e[0]%360*Ct,h=e[1]%360*Ct,p=e.length>2?e[2]%360*Ct:0,x()):[c*kt,h*kt,p*kt]},e.rebind(E,s,"precision"),function(){return n=t.apply(this,arguments),E.invert=n.invert&&S,x()}}function $i(e){return Wi(e,function(t,n){e.point(t*Ct,n*Ct)})}function Ji(e,t){return[e,t]}function Ki(e,t){return[e>Et?e-St:e<-Et?e+St:e,t]}function Qi(e,t,n){return e?t||n?wi(Yi(e),Zi(t,n)):Yi(e):t||n?Zi(t,n):Ki}function Gi(e){return function(t,n){return t+=e,[t>Et?t-St:t<-Et?t+St:t,n]}}function Yi(e){var t=Gi(e);return t.invert=Gi(-e),t}function Zi(e,t){function o(e,t){var o=Math.cos(t),u=Math.cos(e)*o,a=Math.sin(e)*o,f=Math.sin(t),l=f*n+u*r;return[Math.atan2(a*i-l*s,u*n-f*r),Mt(l*i+a*s)]}var n=Math.cos(e),r=Math.sin(e),i=Math.cos(t),s=Math.sin(t);return o.invert=function(e,t){var o=Math.cos(t),u=Math.cos(e)*o,a=Math.sin(e)*o,f=Math.sin(t),l=f*i-a*s;return[Math.atan2(a*i+f*s,u*n+l*r),Mt(l*n-u*r)]},o}function es(e,t){var n=Math.cos(e),r=Math.sin(e);return function(i,s,o,u){var a=o*t;if(i!=null){i=ts(n,i),s=ts(n,s);if(o>0?i<s:i>s)i+=o*St}else i=e+o*St,s=e-.5*a;for(var f,l=i;o>0?l>s:l<s;l-=a)u.point((f=Fr([n,-r*Math.cos(l),-r*Math.sin(l)]))[0],f[1])}}function ts(e,t){var n=_r(t);n[0]-=e,jr(n);var r=Ot(-n[1]);return((-n[2]<0?-r:r)+2*Math.PI-Tt)%(2*Math.PI)}function ns(t,n,r){var i=e.range(t,n-Tt,r).concat(n);return function(e){return i.map(function(t){return[e,t]})}}function rs(t,n,r){var i=e.range(t,n-Tt,r).concat(n);return function(e){return i.map(function(t){return[t,e]})}}function is(e){return e.source}function ss(e){return e.target}function os(e,t,n,r){var i=Math.cos(t),s=Math.sin(t),o=Math.cos(r),u=Math.sin(r),a=i*Math.cos(e),f=i*Math.sin(e),l=o*Math.cos(n),c=o*Math.sin(n),h=2*Math.asin(Math.sqrt(Ht(r-t)+i*o*Ht(n-e))),p=1/Math.sin(h),d=h?function(e){var t=Math.sin(e*=h)*p,n=Math.sin(h-e)*p,r=n*a+t*l,i=n*f+t*c,o=n*s+t*u;return[Math.atan2(i,r)*kt,Math.atan2(o,Math.sqrt(r*r+i*i))*kt]}:function(){return[e*kt,t*kt]};return d.distance=h,d}function fs(){function r(r,i){var s=Math.sin(i*=Ct),o=Math.cos(i),u=m((r*=Ct)-e),a=Math.cos(u);us+=Math.atan2(Math.sqrt((u=o*Math.sin(u))*u+(u=n*s-t*o*a)*u),t*s+n*o*a),e=r,t=s,n=o}var e,t,n;as.point=function(i,s){e=i*Ct,t=Math.sin(s*=Ct),n=Math.cos(s),as.point=r},as.lineEnd=function(){as.point=as.lineEnd=M}}function ls(e,t){function n(t,n){var r=Math.cos(t),i=Math.cos(n),s=e(r*i);return[s*i*Math.sin(t),s*Math.sin(n)]}return n.invert=function(e,n){var r=Math.sqrt(e*e+n*n),i=t(r),s=Math.sin(i),o=Math.cos(i);return[Math.atan2(e*s,r*o),Math.asin(r&&n*s/r)]},n}function ps(e,t){function o(e,t){var n=m(m(t)-xt)<Tt?0:s/Math.pow(r(t),i);return[n*Math.sin(i*e),s-n*Math.cos(i*e)]}var n=Math.cos(e),r=function(e){return Math.tan(Et/4+e/2)},i=e===t?Math.sin(e):Math.log(n/Math.cos(t))/Math.log(r(t)/r(e)),s=n*Math.pow(r(e),i)/i;return i?(o.invert=function(e,t){var n=s-t,r=Lt(i)*Math.sqrt(e*e+n*n);return[Math.atan2(e,n)/i,2*Math.atan(Math.pow(s/r,1/i))-xt]},o):ms}function ds(e,t){function s(e,t){var n=i-t;return[n*Math.sin(r*e),i-n*Math.cos(r*e)]}var n=Math.cos(e),r=e===t?Math.sin(e):(n-Math.cos(t))/(t-e),i=n/r+e;return m(r)<Tt?Ji:(s.invert=function(e,t){var n=i-t;return[Math.atan2(e,n)/r,i-Lt(r)*Math.sqrt(e*e+n*n)]},s)}function ms(e,t){return[e,Math.log(Math.tan(Et/4+t/2))]}function gs(e){var t=Xi(e),n=t.scale,r=t.translate,i=t.clipExtent,s;return t.scale=function(){var e=n.apply(t,arguments);return e===t?s?t.clipExtent(null):t:e},t.translate=function(){var e=r.apply(t,arguments);return e===t?s?t.clipExtent(null):t:e},t.clipExtent=function(e){var o=i.apply(t,arguments);if(o===t){if(s=e==null){var u=Et*n(),a=r();i([[a[0]-u,a[1]-u],[a[0]+u,a[1]+u]])}}else s&&(o=null);return o},t.clipExtent(null)}function ws(e,t){return[Math.log(Math.tan(Et/4+t/2)),-e]}function Es(e){return e[0]}function Ss(e){return e[1]}function xs(e){var t=e.length,n=[0,1],r=2;for(var i=2;i<t;i++){while(r>1&&At(e[n[r-2]],e[n[r-1]],e[i])<=0)--r;n[r++]=i}return n.slice(0,r)}function Ts(e,t){return e[0]-t[0]||e[1]-t[1]}function Cs(e,t,n){return(n[0]-t[0])*(e[1]-t[1])<(n[1]-t[1])*(e[0]-t[0])}function ks(e,t,n,r){var i=e[0],s=n[0],o=t[0]-i,u=r[0]-s,a=e[1],f=n[1],l=t[1]-a,c=r[1]-f,h=(u*(a-f)-c*(i-s))/(c*o-u*l);return[i+h*o,a+h*l]}function Ls(e){var t=e[0],n=e[e.length-1];return!(t[0]-n[0]||t[1]-n[1])}function Bs(){ro(this),this.edge=this.site=this.circle=null}function js(e){var t=_s.pop()||new Bs;return t.site=e,t}function Fs(e){Js(e),Ms.remove(e),_s.push(e),ro(e)}function Is(e){var t=e.circle,n=t.x,r=t.cy,i={x:n,y:r},s=e.P,o=e.N,u=[e];Fs(e);var a=s;while(a.circle&&m(n-a.circle.x)<Tt&&m(r-a.circle.cy)<Tt)s=a.P,u.unshift(a),Fs(a),a=s;u.unshift(a),Js(a);var f=o;while(f.circle&&m(n-f.circle.x)<Tt&&m(r-f.circle.cy)<Tt)o=f.N,u.push(f),Fs(f),f=o;u.push(f),Js(f);var l=u.length,c;for(c=1;c<l;++c)f=u[c],a=u[c-1],eo(f.edge,a.site,f.site,i);a=u[0],f=u[l-1],f.edge=Ys(a.site,f.site,null,i),$s(a),$s(f)}function qs(e){var t=e.x,n=e.y,r,i,s,o,u=Ms._;while(u){s=Rs(u,n)-t;if(s>Tt)u=u.L;else{o=t-Us(u,n);if(!(o>Tt)){s>-Tt?(r=u.P,i=u):o>-Tt?(r=u,i=u.N):r=i=u;break}if(!u.R){r=u;break}u=u.R}}var a=js(e);Ms.insert(r,a);if(!r&&!i)return;if(r===i){Js(r),i=js(r.site),Ms.insert(a,i),a.edge=i.edge=Ys(r.site,a.site),$s(r),$s(i);return}if(!i){a.edge=Ys(r.site,a.site);return}Js(r),Js(i);var f=r.site,l=f.x,c=f.y,h=e.x-l,p=e.y-c,d=i.site,v=d.x-l,m=d.y-c,g=2*(h*m-p*v),y=h*h+p*p,b=v*v+m*m,w={x:(m*y-p*b)/g+l,y:(h*b-v*y)/g+c};eo(i.edge,f,d,w),a.edge=Ys(f,e,null,w),i.edge=Ys(e,d,null,w),$s(r),$s(i)}function Rs(e,t){var n=e.site,r=n.x,i=n.y,s=i-t;if(!s)return r;var o=e.P;if(!o)return-Infinity;n=o.site;var u=n.x,a=n.y,f=a-t;if(!f)return u;var l=u-r,c=1/s-1/f,h=l/f;return c?(-h+Math.sqrt(h*h-2*c*(l*l/(-2*f)-a+f/2+i-s/2)))/c+r:(r+u)/2}function Us(e,t){var n=e.N;if(n)return Rs(n,t);var r=e.site;return r.y===t?r.x:Infinity}function zs(e){this.site=e,this.edges=[]}function Ws(e){var t=e[0][0],n=e[1][0],r=e[0][1],i=e[1][1],s,o,u,a,f=Os,l=f.length,c,h,p,d,v,g;while(l--){c=f[l];if(!c||!c.prepare())continue;p=c.edges,d=p.length,h=0;while(h<d){g=p[h].end(),u=g.x,a=g.y,v=p[++h%d].start(),s=v.x,o=v.y;if(m(u-s)>Tt||m(a-o)>Tt)p.splice(h,0,new to(Zs(c.site,g,m(u-t)<Tt&&i-a>Tt?{x:t,y:m(s-t)<Tt?o:i}:m(a-i)<Tt&&n-u>Tt?{x:m(o-i)<Tt?s:n,y:i}:m(u-n)<Tt&&a-r>Tt?{x:n,y:m(s-n)<Tt?o:r}:m(a-r)<Tt&&u-t>Tt?{x:m(o-r)<Tt?s:t,y:r}:null),c.site,null)),++d}}}function Xs(e,t){return t.angle-e.angle}function Vs(){ro(this),this.x=this.y=this.arc=this.site=this.cy=null}function $s(e){var t=e.P,n=e.N;if(!t||!n)return;var r=t.site,i=e.site,s=n.site;if(r===s)return;var o=i.x,u=i.y,a=r.x-o,f=r.y-u,l=s.x-o,c=s.y-u,h=2*(a*c-f*l);if(h>=-Nt)return;var p=a*a+f*f,d=l*l+c*c,v=(c*p-f*d)/h,m=(a*d-l*p)/h,c=m+u,g=Hs.pop()||new Vs;g.arc=e,g.site=i,g.x=v+o,g.y=c+Math.sqrt(v*v+m*m),g.cy=c,e.circle=g;var y=null,b=Ps._;while(b)if(g.y<b.y||g.y===b.y&&g.x<=b.x){if(!b.L){y=b.P;break}b=b.L}else{if(!b.R){y=b;break}b=b.R}Ps.insert(y,g),y||(Ds=g)}function Js(e){var t=e.circle;t&&(t.P||(Ds=t.N),Ps.remove(t),Hs.push(t),ro(t),e.circle=null)}function Ks(e){var t=As,n=gi(e[0][0],e[0][1],e[1][0],e[1][1]),r=t.length,i;while(r--){i=t[r];if(!Qs(i,e)||!n(i)||m(i.a.x-i.b.x)<Tt&&m(i.a.y-i.b.y)<Tt)i.a=i.b=null,t.splice(r,1)}}function Qs(e,t){var n=e.b;if(n)return!0;var r=e.a,i=t[0][0],s=t[1][0],o=t[0][1],u=t[1][1],a=e.l,f=e.r,l=a.x,c=a.y,h=f.x,p=f.y,d=(l+h)/2,v=(c+p)/2,m,g;if(p===c){if(d<i||d>=s)return;if(l>h){if(!r)r={x:d,y:o};else if(r.y>=u)return;n={x:d,y:u}}else{if(!r)r={x:d,y:u};else if(r.y<o)return;n={x:d,y:o}}}else{m=(l-h)/(p-c),g=v-m*d;if(m<-1||m>1)if(l>h){if(!r)r={x:(o-g)/m,y:o};else if(r.y>=u)return;n={x:(u-g)/m,y:u}}else{if(!r)r={x:(u-g)/m,y:u};else if(r.y<o)return;n={x:(o-g)/m,y:o}}else if(c<p){if(!r)r={x:i,y:m*i+g};else if(r.x>=s)return;n={x:s,y:m*s+g}}else{if(!r)r={x:s,y:m*s+g};else if(r.x<i)return;n={x:i,y:m*i+g}}}return e.a=r,e.b=n,!0}function Gs(e,t){this.l=e,this.r=t,this.a=this.b=null}function Ys(e,t,n,r){var i=new Gs(e,t);return As.push(i),n&&eo(i,e,t,n),r&&eo(i,t,e,r),Os[e.i].edges.push(new to(i,e,t)),Os[t.i].edges.push(new to(i,t,e)),i}function Zs(e,t,n){var r=new Gs(e,null);return r.a=t,r.b=n,As.push(r),r}function eo(e,t,n,r){!e.a&&!e.b?(e.a=r,e.l=t,e.r=n):e.l===n?e.b=r:e.a=r}function to(e,t,n){var r=e.a,i=e.b;this.edge=e,this.site=t,this.angle=n?Math.atan2(n.y-t.y,n.x-t.x):e.l===t?Math.atan2(i.x-r.x,r.y-i.y):Math.atan2(r.x-i.x,i.y-r.y)}function no(){this._=null}function ro(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function io(e,t){var n=t,r=t.R,i=n.U;i?i.L===n?i.L=r:i.R=r:e._=r,r.U=i,n.U=r,n.R=r.L,n.R&&(n.R.U=n),r.L=n}function so(e,t){var n=t,r=t.L,i=n.U;i?i.L===n?i.L=r:i.R=r:e._=r,r.U=i,n.U=r,n.L=r.R,n.L&&(n.L.U=n),r.R=n}function oo(e){while(e.L)e=e.L;return e}function uo(e,t){var n=e.sort(ao).pop(),r,i,s;As=[],Os=new Array(e.length),Ms=new no,Ps=new no;for(;;){s=Ds;if(n&&(!s||n.y<s.y||n.y===s.y&&n.x<s.x)){if(n.x!==r||n.y!==i)Os[n.i]=new zs(n),qs(n),r=n.x,i=n.y;n=e.pop()}else{if(!s)break;Is(s.arc)}}t&&(Ks(t),Ws(t));var o={cells:Os,edges:As};return Ms=Ps=As=Os=null,o}function ao(e,t){return t.y-e.y||t.x-e.x}function lo(e,t,n){return(e.x-n.x)*(t.y-e.y)-(e.x-t.x)*(n.y-e.y)}function co(e){return e.x}function ho(e){return e.y}function po(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function vo(e,t,n,r,i,s){if(!e(t,n,r,i,s)){var o=(n+i)*.5,u=(r+s)*.5,a=t.nodes;a[0]&&vo(e,a[0],n,r,o,u),a[1]&&vo(e,a[1],o,r,i,u),a[2]&&vo(e,a[2],n,u,o,s),a[3]&&vo(e,a[3],o,u,i,s)}}function mo(t,n){t=e.rgb(t),n=e.rgb(n);var r=t.r,i=t.g,s=t.b,o=n.r-r,u=n.g-i,a=n.b-s;return function(e){return"#"+vn(Math.round(r+o*e))+vn(Math.round(i+u*e))+vn(Math.round(s+a*e))}}function go(e,t){var n={},r={},i;for(i in e)i in t?n[i]=Eo(e[i],t[i]):r[i]=e[i];for(i in t)i in e||(r[i]=t[i]);return function(e){for(i in n)r[i]=n[i](e);return r}}function yo(e,t){return t-=e=+e,function(n){return e+t*n}}function bo(e,t){var n,r,i,s=0,o=0,u=[],a=[],f,l;e+="",t+="",wo.lastIndex=0;for(r=0;n=wo.exec(t);++r)n.index&&u.push(t.substring(s,o=n.index)),a.push({i:u.length,x:n[0]}),u.push(null),s=wo.lastIndex;s<t.length&&u.push(t.substring(s));for(r=0,f=a.length;(n=wo.exec(e))&&r<f;++r){l=a[r];if(l.x==n[0]){if(l.i)if(u[l.i+1]==null){u[l.i-1]+=l.x,u.splice(l.i,1);for(i=r+1;i<f;++i)a[i].i--}else{u[l.i-1]+=l.x+u[l.i+1],u.splice(l.i,2);for(i=r+1;i<f;++i)a[i].i-=2}else if(u[l.i+1]==null)u[l.i]=l.x;else{u[l.i]=l.x+u[l.i+1],u.splice(l.i+1,1);for(i=r+1;i<f;++i)a[i].i--}a.splice(r,1),f--,r--}else l.x=yo(parseFloat(n[0]),parseFloat(l.x))}while(r<f)l=a.pop(),u[l.i+1]==null?u[l.i]=l.x:(u[l.i]=l.x+u[l.i+1],u.splice(l.i+1,1)),f--;return u.length===1?u[0]==null?(l=a[0].x,function(e){return l(e)+""}):function(){return t}:function(e){for(r=0;r<f;++r)u[(l=a[r]).i]=l.x(e);return u.join("")}}function Eo(t,n){var r=e.interpolators.length,i;while(--r>=0&&!(i=e.interpolators[r](t,n)));return i}function So(e,t){var n=[],r=[],i=e.length,s=t.length,o=Math.min(e.length,t.length),u;for(u=0;u<o;++u)n.push(Eo(e[u],t[u]));for(;u<i;++u)r[u]=e[u];for(;u<s;++u)r[u]=t[u];return function(e){for(u=0;u<o;++u)r[u]=n[u](e);return r}}function Co(e){return function(t){return t<=0?0:t>=1?1:e(t)}}function ko(e){return function(t){return 1-e(1-t)}}function Lo(e){return function(t){return.5*(t<.5?e(2*t):2-e(2-2*t))}}function Ao(e){return e*e}function Oo(e){return e*e*e}function Mo(e){if(e<=0)return 0;if(e>=1)return 1;var t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)}function _o(e){return function(t){return Math.pow(t,e)}}function Do(e){return 1-Math.cos(e*xt)}function Po(e){return Math.pow(2,10*(e-1))}function Ho(e){return 1-Math.sqrt(1-e*e)}function Bo(e,t){var n;return arguments.length<2&&(t=.45),arguments.length?n=t/St*Math.asin(1/e):(e=1,n=t/4),function(r){return 1+e*Math.pow(2,-10*r)*Math.sin((r-n)*St/t)}}function jo(e){return e||(e=1.70158),function(t){return t*t*((e+1)*t-e)}}function Fo(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}function Io(t,n){t=e.hcl(t),n=e.hcl(n);var r=t.h,i=t.c,s=t.l,o=n.h-r,u=n.c-i,a=n.l-s;return isNaN(u)&&(u=0,i=isNaN(i)?n.c:i),isNaN(o)?(o=0,r=isNaN(r)?n.h:r):o>180?o-=360:o<-180&&(o+=360),function(e){return Qt(r+o*e,i+u*e,s+a*e)+""}}function qo(t,n){t=e.hsl(t),n=e.hsl(n);var r=t.h,i=t.s,s=t.l,o=n.h-r,u=n.s-i,a=n.l-s;return isNaN(u)&&(u=0,i=isNaN(i)?n.s:i),isNaN(o)?(o=0,r=isNaN(r)?n.h:r):o>180?o-=360:o<-180&&(o+=360),function(e){return Vt(r+o*e,i+u*e,s+a*e)+""}}function Ro(t,n){t=e.lab(t),n=e.lab(n);var r=t.l,i=t.a,s=t.b,o=n.l-r,u=n.a-i,a=n.b-s;return function(e){return sn(r+o*e,i+u*e,s+a*e)+""}}function Uo(e,t){return t-=e,function(n){return Math.round(e+t*n)}}function zo(e){var t=[e.a,e.b],n=[e.c,e.d],r=Xo(t),i=Wo(t,n),s=Xo(Vo(n,t,-i))||0;t[0]*n[1]<n[0]*t[1]&&(t[0]*=-1,t[1]*=-1,r*=-1,i*=-1),this.rotate=(r?Math.atan2(t[1],t[0]):Math.atan2(-n[0],n[1]))*kt,this.translate=[e.e,e.f],this.scale=[r,s],this.skew=s?Math.atan2(i,s)*kt:0}function Wo(e,t){return e[0]*t[0]+e[1]*t[1]}function Xo(e){var t=Math.sqrt(Wo(e,e));return t&&(e[0]/=t,e[1]/=t),t}function Vo(e,t,n){return e[0]+=n*t[0],e[1]+=n*t[1],e}function Jo(t,n){var r=[],i=[],s,o=e.transform(t),u=e.transform(n),a=o.translate,f=u.translate,l=o.rotate,c=u.rotate,h=o.skew,p=u.skew,d=o.scale,v=u.scale;return a[0]!=f[0]||a[1]!=f[1]?(r.push("translate(",null,",",null,")"),i.push({i:1,x:yo(a[0],f[0])},{i:3,x:yo(a[1],f[1])})):f[0]||f[1]?r.push("translate("+f+")"):r.push(""),l!=c?(l-c>180?c+=360:c-l>180&&(l+=360),i.push({i:r.push(r.pop()+"rotate(",null,")")-2,x:yo(l,c)})):c&&r.push(r.pop()+"rotate("+c+")"),h!=p?i.push({i:r.push(r.pop()+"skewX(",null,")")-2,x:yo(h,p)}):p&&r.push(r.pop()+"skewX("+p+")"),d[0]!=v[0]||d[1]!=v[1]?(s=r.push(r.pop()+"scale(",null,",",null,")"),i.push({i:s-4,x:yo(d[0],v[0])},{i:s-2,x:yo(d[1],v[1])})):(v[0]!=1||v[1]!=1)&&r.push(r.pop()+"scale("+v+")"),s=i.length,function(e){var t=-1,n;while(++t<s)r[(n=i[t]).i]=n.x(e);return r.join("")}}function Ko(e,t){return t=t-(e=+e)?1/(t-e):0,function(n){return(n-e)*t}}function Qo(e,t){return t=t-(e=+e)?1/(t-e):0,function(n){return Math.max(0,Math.min(1,(n-e)*t))}}function Go(e){var t=e.source,n=e.target,r=Zo(t,n),i=[t];while(t!==r)t=t.parent,i.push(t);var s=i.length;while(n!==r)i.splice(s,0,n),n=n.parent;return i}function Yo(e){var t=[],n=e.parent;while(n!=null)t.push(e),e=n,n=n.parent;return t.push(e),t}function Zo(e,t){if(e===t)return e;var n=Yo(e),r=Yo(t),i=n.pop(),s=r.pop(),o=null;while(i===s)o=i,i=n.pop(),s=r.pop();return o}function eu(e){e.fixed|=2}function tu(e){e.fixed&=-7}function nu(e){e.fixed|=4,e.px=e.x,e.py=e.y}function ru(e){e.fixed&=-5}function iu(e,t,n){var r=0,i=0;e.charge=0;if(!e.leaf){var s=e.nodes,o=s.length,u=-1,a;while(++u<o){a=s[u];if(a==null)continue;iu(a,t,n),e.charge+=a.charge,r+=a.charge*a.cx,i+=a.charge*a.cy}}if(e.point){e.leaf||(e.point.x+=Math.random()-.5,e.point.y+=Math.random()-.5);var f=t*n[e.point.index];e.charge+=e.pointCharge=f,r+=f*e.point.x,i+=f*e.point.y}e.cx=r/e.charge,e.cy=i/e.charge}function au(t,n){return e.rebind(t,n,"sort","children","value"),t.nodes=t,t.links=hu,t}function fu(e){return e.children}function lu(e){return e.value}function cu(e,t){return t.value-e.value}function hu(t){return e.merge(t.map(function(e){return(e.children||[]).map(function(t){return{source:e,target:t}})}))}function du(e){return e.x}function vu(e){return e.y}function mu(e,t,n){e.y0=t,e.y=n}function bu(t){return e.range(t.length)}function wu(e){var t=-1,n=e[0].length,r=[];while(++t<n)r[t]=0;return r}function Eu(e){var t=1,n=0,r=e[0][1],i,s=e.length;for(;t<s;++t)(i=e[t][1])>r&&(n=t,r=i);return n}function Su(e){return e.reduce(xu,0)}function xu(e,t){return e+t[1]}function Tu(e,t){return Nu(e,Math.ceil(Math.log(t.length)/Math.LN2+1))}function Nu(e,t){var n=-1,r=+e[0],i=(e[1]-r)/t,s=[];while(++n<=t)s[n]=i*n+r;return s}function Cu(t){return[e.min(t),e.max(t)]}function ku(e,t){return e.parent==t.parent?1:2}function Lu(e){var t=e.children;return t&&t.length?t[0]:e._tree.thread}function Au(e){var t=e.children,n;return t&&(n=t.length)?t[n-1]:e._tree.thread}function Ou(e,t){var n=e.children;if(n&&(i=n.length)){var r,i,s=-1;while(++s<i)t(r=Ou(n[s],t),e)>0&&(e=r)}return e}function Mu(e,t){return e.x-t.x}function _u(e,t){return t.x-e.x}function Du(e,t){return e.depth-t.depth}function Pu(e,t){function n(e,r){var i=e.children;if(i&&(a=i.length)){var s,o=null,u=-1,a;while(++u<a)s=i[u],n(s,o),o=s}t(e,r)}n(e,null)}function Hu(e){var t=0,n=0,r=e.children,i=r.length,s;while(--i>=0)s=r[i]._tree,s.prelim+=t,s.mod+=t,t+=s.shift+(n+=s.change)}function Bu(e,t,n){e=e._tree,t=t._tree;var r=n/(t.number-e.number);e.change+=r,t.change-=r,t.shift+=n,t.prelim+=n,t.mod+=n}function ju(e,t,n){return e._tree.ancestor.parent==t.parent?e._tree.ancestor:n}function Fu(e,t){return e.value-t.value}function Iu(e,t){var n=e._pack_next;e._pack_next=t,t._pack_prev=e,t._pack_next=n,n._pack_prev=t}function qu(e,t){e._pack_next=t,t._pack_prev=e}function Ru(e,t){var n=t.x-e.x,r=t.y-e.y,i=e.r+t.r;return.999*i*i>n*n+r*r}function Uu(e){function p(e){n=Math.min(e.x-e.r,n),r=Math.max(e.x+e.r,r),i=Math.min(e.y-e.r,i),s=Math.max(e.y+e.r,s)}if(!(t=e.children)||!(h=t.length))return;var t,n=Infinity,r=-Infinity,i=Infinity,s=-Infinity,o,u,a,f,l,c,h;t.forEach(zu),o=t[0],o.x=-o.r,o.y=0,p(o);if(h>1){u=t[1],u.x=u.r,u.y=0,p(u);if(h>2){a=t[2],Vu(o,u,a),p(a),Iu(o,a),o._pack_prev=a,Iu(a,u),u=o._pack_next;for(f=3;f<h;f++){Vu(o,u,a=t[f]);var d=0,v=1,m=1;for(l=u._pack_next;l!==u;l=l._pack_next,v++)if(Ru(l,a)){d=1;break}if(d==1)for(c=o._pack_prev;c!==l._pack_prev;c=c._pack_prev,m++)if(Ru(c,a))break;d?(v<m||v==m&&u.r<o.r?qu(o,u=l):qu(o=c,u),f--):(Iu(o,a),u=a,p(a))}}}var g=(n+r)/2,y=(i+s)/2,b=0;for(f=0;f<h;f++)a=t[f],a.x-=g,a.y-=y,b=Math.max(b,a.r+Math.sqrt(a.x*a.x+a.y*a.y));e.r=b,t.forEach(Wu)}function zu(e){e._pack_next=e._pack_prev=e}function Wu(e){delete e._pack_next,delete e._pack_prev}function Xu(e,t,n,r){var i=e.children;e.x=t+=r*e.x,e.y=n+=r*e.y,e.r*=r;if(i){var s=-1,o=i.length;while(++s<o)Xu(i[s],t,n,r)}}function Vu(e,t,n){var r=e.r+n.r,i=t.x-e.x,s=t.y-e.y;if(r&&(i||s)){var o=t.r+n.r,u=i*i+s*s;o*=o,r*=r;var a=.5+(r-o)/(2*u),f=Math.sqrt(Math.max(0,2*o*(r+u)-(r-=u)*r-o*o))/(2*u);n.x=e.x+a*i+f*s,n.y=e.y+a*s-f*i}else n.x=e.x+r,n.y=e.y}function $u(t){return 1+e.max(t,function(e){return e.y})}function Ju(e){return e.reduce(function(e,t){return e+t.x},0)/e.length}function Ku(e){var t=e.children;return t&&t.length?Ku(t[0]):e}function Qu(e){var t=e.children,n;return t&&(n=t.length)?Qu(t[n-1]):e}function Gu(e){return{x:e.x,y:e.y,dx:e.dx,dy:e.dy}}function Yu(e,t){var n=e.x+t[3],r=e.y+t[0],i=e.dx-t[1]-t[3],s=e.dy-t[0]-t[2];return i<0&&(n+=i/2,i=0),s<0&&(r+=s/2,s=0),{x:n,y:r,dx:i,dy:s}}function Zu(e){var t=e[0],n=e[e.length-1];return t<n?[t,n]:[n,t]}function ea(e){return e.rangeExtent?e.rangeExtent():Zu(e.range())}function ta(e,t,n,r){var i=n(e[0],e[1]),s=r(t[0],t[1]);return function(e){return s(i(e))}}function na(e,t){var n=0,r=e.length-1,i=e[n],s=e[r],o;return s<i&&(o=n,n=r,r=o,o=i,i=s,s=o),e[n]=t.floor(i),e[r]=t.ceil(s),e}function ra(e){return e?{floor:function(t){return Math.floor(t/e)*e},ceil:function(t){return Math.ceil(t/e)*e}}:ia}function sa(t,n,r,i){var s=[],o=[],u=0,a=Math.min(t.length,n.length)-1;t[a]<t[0]&&(t=t.slice().reverse(),n=n.slice().reverse());while(++u<=a)s.push(r(t[u-1],t[u])),o.push(i(n[u-1],n[u]));return function(n){var r=e.bisect(t,n,1,a)-1;return o[r](s[r](n))}}function oa(e,t,n,r){function o(){var o=Math.min(e.length,t.length)>2?sa:ta,a=r?Qo:Ko;return i=o(e,t,a,n),s=o(t,e,a,Eo),u}function u(e){return i(e)}var i,s;return u.invert=function(e){return s(e)},u.domain=function(t){return arguments.length?(e=t.map(Number),o()):e},u.range=function(e){return arguments.length?(t=e,o()):t},u.rangeRound=function(e){return u.range(e).interpolate(Uo)},u.clamp=function(e){return arguments.length?(r=e,o()):r},u.interpolate=function(e){return arguments.length?(n=e,o()):n},u.ticks=function(t){return la(e,t)},u.tickFormat=function(t,n){return ca(e,t,n)},u.nice=function(t){return aa(e,t),o()},u.copy=function(){return oa(e,t,n,r)},o()}function ua(t,n){return e.rebind(t,n,"range","rangeRound","interpolate","clamp")}function aa(e,t){return na(e,ra(fa(e,t)[2]))}function fa(e,t){t==null&&(t=10);var n=Zu(e),r=n[1]-n[0],i=Math.pow(10,Math.floor(Math.log(r/t)/Math.LN10)),s=t/r*i;return s<=.15?i*=10:s<=.35?i*=5:s<=.75&&(i*=2),n[0]=Math.ceil(n[0]/i)*i,n[1]=Math.floor(n[1]/i)*i+i*.5,n[2]=i,n}function la(t,n){return e.range.apply(e,fa(t,n))}function ca(t,n,r){var i=fa(t,n);return e.format(r?r.replace(qn,function(e,t,n,r,s,o,u,a,f,l){return[t,n,r,s,o,u,a,f||"."+da(l,i),l].join("")}):",."+pa(i[2])+"f")}function pa(e){return-Math.floor(Math.log(e)/Math.LN10+.01)}function da(e,t){var n=pa(t[2]);return e in ha?Math.abs(n-pa(Math.max(Math.abs(t[0]),Math.abs(t[1]))))+ +(e!=="e"):n-(e==="%")*2}function va(t,n,r,i){function s(e){return(r?Math.log(e<0?0:e):-Math.log(e>0?0:-e))/Math.log(n)}function o(e){return r?Math.pow(n,e):-Math.pow(n,-e)}function u(e){return t(s(e))}return u.invert=function(e){return o(t.invert(e))},u.domain=function(e){return arguments.length?(r=e[0]>=0,t.domain((i=e.map(Number)).map(s)),u):i},u.base=function(e){return arguments.length?(n=+e,t.domain(i.map(s)),u):n},u.nice=function(){var e=na(i.map(s),r?Math:ga);return t.domain(e),i=e.map(o),u},u.ticks=function(){var e=Zu(i),t=[],u=e[0],a=e[1],f=Math.floor(s(u)),l=Math.ceil(s(a)),c=n%1?2:n;if(isFinite(l-f)){if(r){for(;f<l;f++)for(var h=1;h<c;h++)t.push(o(f)*h);t.push(o(f))}else{t.push(o(f));for(;f++<l;)for(var h=c-1;h>0;h--)t.push(o(f)*h)}for(f=0;t[f]<u;f++);for(l=t.length;t[l-1]>a;l--);t=t.slice(f,l)}return t},u.tickFormat=function(t,n){if(!arguments.length)return ma;arguments.length<2?n=ma:typeof n!="function"&&(n=e.format(n));var i=Math.max(.1,t/u.ticks().length),a=r?(f=1e-12,Math.ceil):(f=-1e-12,Math.floor),f;return function(e){return e/o(a(s(e)+f))<=i?n(e):""}},u.copy=function(){return va(t.copy(),n,r,i)},ua(u,t)}function ya(e,t,n){function s(t){return e(r(t))}var r=ba(t),i=ba(1/t);return s.invert=function(t){return i(e.invert(t))},s.domain=function(t){return arguments.length?(e.domain((n=t.map(Number)).map(r)),s):n},s.ticks=function(e){return la(n,e)},s.tickFormat=function(e,t){return ca(n,e,t)},s.nice=function(e){return s.domain(aa(n,e))},s.exponent=function(o){return arguments.length?(r=ba(t=o),i=ba(1/t),e.domain(n.map(r)),s):t},s.copy=function(){return ya(e.copy(),t,n)},ua(s,e)}function ba(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function wa(t,n){function o(e){return i[((r.get(e)||n.t==="range"&&r.set(e,t.push(e)))-1)%i.length]}function u(n,r){return e.range(t.length).map(function(e){return n+r*e})}var r,i,s;return o.domain=function(e){if(!arguments.length)return t;t=[],r=new b;var i=-1,s=e.length,u;while(++i<s)r.has(u=e[i])||r.set(u,t.push(u));return o[n.t].apply(o,n.a)},o.range=function(e){return arguments.length?(i=e,s=0,n={t:"range",a:arguments},o):i},o.rangePoints=function(e,r){arguments.length<2&&(r=0);var a=e[0],f=e[1],l=(f-a)/(Math.max(1,t.length-1)+r);return i=u(t.length<2?(a+f)/2:a+l*r/2,l),s=0,n={t:"rangePoints",a:arguments},o},o.rangeBands=function(e,r,a){arguments.length<2&&(r=0),arguments.length<3&&(a=r);var f=e[1]<e[0],l=e[f-0],c=e[1-f],h=(c-l)/(t.length-r+2*a);return i=u(l+h*a,h),f&&i.reverse(),s=h*(1-r),n={t:"rangeBands",a:arguments},o},o.rangeRoundBands=function(e,r,a){arguments.length<2&&(r=0),arguments.length<3&&(a=r);var f=e[1]<e[0],l=e[f-0],c=e[1-f],h=Math.floor((c-l)/(t.length-r+2*a)),p=c-l-(t.length-r)*h;return i=u(l+Math.round(p/2),h),f&&i.reverse(),s=Math.round(h*(1-r)),n={t:"rangeRoundBands",a:arguments},o},o.rangeBand=function(){return s},o.rangeExtent=function(){return Zu(n.a[0])},o.copy=function(){return wa(t,n)},o.domain(t)}function Na(t,n){function i(){var i=0,o=n.length;r=[];while(++i<o)r[i-1]=e.quantile(t,i/o);return s}function s(t){if(!isNaN(t=+t))return n[e.bisect(r,t)]}var r;return s.domain=function(n){return arguments.length?(t=n.filter(function(e){return!isNaN(e)}).sort(e.ascending),i()):t},s.range=function(e){return arguments.length?(n=e,i()):n},s.quantiles=function(){return r},s.invertExtent=function(e){return e=n.indexOf(e),e<0?[NaN,NaN]:[e>0?r[e-1]:t[0],e<r.length?r[e]:t[t.length-1]]},s.copy=function(){return Na(t,n)},i()}function Ca(e,t,n){function s(t){return n[Math.max(0,Math.min(i,Math.floor(r*(t-e))))]}function o(){return r=n.length/(t-e),i=n.length-1,s}var r,i;return s.domain=function(n){return arguments.length?(e=+n[0],t=+n[n.length-1],o()):[e,t]},s.range=function(e){return arguments.length?(n=e,o()):n},s.invertExtent=function(t){return t=n.indexOf(t),t=t<0?NaN:t/r+e,[t,t+1/r]},s.copy=function(){return Ca(e,t,n)},o()}function ka(t,n){function r(r){if(r<=r)return n[e.bisect(t,r)]}return r.domain=function(e){return arguments.length?(t=e,r):t},r.range=function(e){return arguments.length?(n=e,r):n},r.invertExtent=function(e){return e=n.indexOf(e),[t[e-1],t[e]]},r.copy=function(){return ka(t,n)},r}function La(e){function t(e){return+e}return t.invert=t,t.domain=t.range=function(n){return arguments.length?(e=n.map(t),t):e},t.ticks=function(t){return la(e,t)},t.tickFormat=function(t,n){return ca(e,t,n)},t.copy=function(){return La(e)},t}function Ma(e){return e.innerRadius}function _a(e){return e.outerRadius}function Da(e){return e.startAngle}function Pa(e){return e.endAngle}function Ha(e){function u(s){function d(){u.push("M",i(e(a),o))}var u=[],a=[],f=-1,l=s.length,c,h=Sn(t),p=Sn(n);while(++f<l)r.call(this,c=s[f],f)?a.push([+h.call(this,c,f),+p.call(this,c,f)]):a.length&&(d(),a=[]);return a.length&&d(),u.length?u.join(""):null}var t=Es,n=Ss,r=ri,i=ja,s=i.key,o=.7;return u.x=function(e){return arguments.length?(t=e,u):t},u.y=function(e){return arguments.length?(n=e,u):n},u.defined=function(e){return arguments.length?(r=e,u):r},u.interpolate=function(e){return arguments.length?(typeof e=="function"?s=i=e:s=(i=Ba.get(e)||ja).key,u):s},u.tension=function(e){return arguments.length?(o=e,u):o},u}function ja(e){return e.join("L")}function Fa(e){return ja(e)+"Z"}function Ia(e){var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];while(++t<n)i.push("H",(r[0]+(r=e[t])[0])/2,"V",r[1]);return n>1&&i.push("H",r[0]),i.join("")}function qa(e){var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];while(++t<n)i.push("V",(r=e[t])[1],"H",r[0]);return i.join("")}function Ra(e){var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];while(++t<n)i.push("H",(r=e[t])[0],"V",r[1]);return i.join("")}function Ua(e,t){return e.length<4?ja(e):e[1]+Xa(e.slice(1,e.length-1),Va(e,t))}function za(e,t){return e.length<3?ja(e):e[0]+Xa((e.push(e[0]),e),Va([e[e.length-2]].concat(e,[e[1]]),t))}function Wa(e,t){return e.length<3?ja(e):e[0]+Xa(e,Va(e,t))}function Xa(e,t){if(t.length<1||e.length!=t.length&&e.length!=t.length+2)return ja(e);var n=e.length!=t.length,r="",i=e[0],s=e[1],o=t[0],u=o,a=1;n&&(r+="Q"+(s[0]-o[0]*2/3)+","+(s[1]-o[1]*2/3)+","+s[0]+","+s[1],i=e[1],a=2);if(t.length>1){u=t[1],s=e[a],a++,r+="C"+(i[0]+o[0])+","+(i[1]+o[1])+","+(s[0]-u[0])+","+(s[1]-u[1])+","+s[0]+","+s[1];for(var f=2;f<t.length;f++,a++)s=e[a],u=t[f],r+="S"+(s[0]-u[0])+","+(s[1]-u[1])+","+s[0]+","+s[1]}if(n){var l=e[a];r+="Q"+(s[0]+u[0]*2/3)+","+(s[1]+u[1]*2/3)+","+l[0]+","+l[1]}return r}function Va(e,t){var n=[],r=(1-t)/2,i,s=e[0],o=e[1],u=1,a=e.length;while(++u<a)i=s,s=o,o=e[u],n.push([r*(o[0]-i[0]),r*(o[1]-i[1])]);return n}function $a(e){if(e.length<3)return ja(e);var t=1,n=e.length,r=e[0],i=r[0],s=r[1],o=[i,i,i,(r=e[1])[0]],u=[s,s,s,r[1]],a=[i,",",s,"L",Ga(ef,o),",",Ga(ef,u)];e.push(e[n-1]);while(++t<=n)r=e[t],o.shift(),o.push(r[0]),u.shift(),u.push(r[1]),tf(a,o,u);return e.pop(),a.push("L",r),a.join("")}function Ja(e){if(e.length<4)return ja(e);var t=[],n=-1,r=e.length,i,s=[0],o=[0];while(++n<3)i=e[n],s.push(i[0]),o.push(i[1]);t.push(Ga(ef,s)+","+Ga(ef,o)),--n;while(++n<r)i=e[n],s.shift(),s.push(i[0]),o.shift(),o.push(i[1]),tf(t,s,o);return t.join("")}function Ka(e){var t,n=-1,r=e.length,i=r+4,s,o=[],u=[];while(++n<4)s=e[n%r],o.push(s[0]),u.push(s[1]);t=[Ga(ef,o),",",Ga(ef,u)],--n;while(++n<i)s=e[n%r],o.shift(),o.push(s[0]),u.shift(),u.push(s[1]),tf(t,o,u);return t.join("")}function Qa(e,t){var n=e.length-1;if(n){var r=e[0][0],i=e[0][1],s=e[n][0]-r,o=e[n][1]-i,u=-1,a,f;while(++u<=n)a=e[u],f=u/n,a[0]=t*a[0]+(1-t)*(r+f*s),a[1]=t*a[1]+(1-t)*(i+f*o)}return $a(e)}function Ga(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function tf(e,t,n){e.push("C",Ga(Ya,t),",",Ga(Ya,n),",",Ga(Za,t),",",Ga(Za,n),",",Ga(ef,t),",",Ga(ef,n))}function nf(e,t){return(t[1]-e[1])/(t[0]-e[0])}function rf(e){var t=0,n=e.length-1,r=[],i=e[0],s=e[1],o=r[0]=nf(i,s);while(++t<n)r[t]=(o+(o=nf(i=s,s=e[t+1])))/2;return r[t]=o,r}function sf(e){var t=[],n,r,i,s,o=rf(e),u=-1,a=e.length-1;while(++u<a)n=nf(e[u],e[u+1]),m(n)<Tt?o[u]=o[u+1]=0:(r=o[u]/n,i=o[u+1]/n,s=r*r+i*i,s>9&&(s=n*3/Math.sqrt(s),o[u]=s*r,o[u+1]=s*i));u=-1;while(++u<=a)s=(e[Math.min(a,u+1)][0]-e[Math.max(0,u-1)][0])/(6*(1+o[u]*o[u])),t.push([s||0,o[u]*s||0]);return t}function of(e){return e.length<3?ja(e):e[0]+Xa(e,sf(e))}function uf(e){var t,n=-1,r=e.length,i,s;while(++n<r)t=e[n],i=t[0],s=t[1]+Aa,t[0]=i*Math.cos(s),t[1]=i*Math.sin(s);return e}function af(e){function c(u){function x(){c.push("M",o(e(p),l),f,a(e(h.reverse()),l),"Z")}var c=[],h=[],p=[],d=-1,v=u.length,m,g=Sn(t),y=Sn(r),b=t===n?function(){return E}:Sn(n),w=r===i?function(){return S}:Sn(i),E,S;while(++d<v)s.call(this,m=u[d],d)?(h.push([E=+g.call(this,m,d),S=+y.call(this,m,d)]),p.push([+b.call(this,m,d),+w.call(this,m,d)])):h.length&&(x(),h=[],p=[]);return h.length&&x(),c.length?c.join(""):null}var t=Es,n=Es,r=0,i=Ss,s=ri,o=ja,u=o.key,a=o,f="L",l=.7;return c.x=function(e){return arguments.length?(t=n=e,c):n},c.x0=function(e){return arguments.length?(t=e,c):t},c.x1=function(e){return arguments.length?(n=e,c):n},c.y=function(e){return arguments.length?(r=i=e,c):i},c.y0=function(e){return arguments.length?(r=e,c):r},c.y1=function(e){return arguments.length?(i=e,c):i},c.defined=function(e){return arguments.length?(s=e,c):s},c.interpolate=function(e){return arguments.length?(typeof e=="function"?u=o=e:u=(o=Ba.get(e)||ja).key,a=o.reverse||o,f=o.closed?"M":"L",c):u},c.tension=function(e){return arguments.length?(l=e,c):l},c}function ff(e){return e.radius}function lf(e){return[e.x,e.y]}function cf(e){return function(){var t=e.apply(this,arguments),n=t[0],r=t[1]+Aa;return[n*Math.cos(r),n*Math.sin(r)]}}function hf(){return 64}function pf(){return"circle"}function df(e){var t=Math.sqrt(e/Et);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+ -t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"}function yf(e,t){return F(e,bf),e.id=t,e}function xf(e,t,n,r){var i=e.id;return ot(e,typeof n=="function"?function(e,s,o){e.__transition__[i].tween.set(t,r(n.call(e,e.__data__,s,o)))}:(n=r(n),function(e){e.__transition__[i].tween.set(t,n)}))}function Tf(e){return e==null&&(e=""),function(){this.textContent=e}}function Nf(t,n,r,i){var s=t.__transition__||(t.__transition__={active:0,count:0}),o=s[r];if(!o){var u=i.time;o=s[r]={tween:new b,time:u,ease:i.ease,delay:i.delay,duration:i.duration},++s.count,e.timer(function(i){function d(i){if(s.active>r)return m();s.active=r,o.event&&o.event.start.call(t,a,n),o.tween.forEach(function(e,r){(r=r.call(t,a,n))&&p.push(r)}),e.timer(function(){return h.c=v(i||1)?ri:v,1},0,u)}function v(e){if(s.active!==r)return m();var i=e/c,u=f(i),l=p.length;while(l>0)p[--l].call(t,u);if(i>=1)return o.event&&o.event.end.call(t,a,n),m()}function m(){return--s.count?delete s[r]:delete t.__transition__,1}var a=t.__data__,f=o.ease,l=o.delay,c=o.duration,h=Mn,p=[];h.t=l+u;if(l<=i)return d(i-l);h.c=d},0,u)}}function Lf(e,t){e.attr("transform",function(e){return"translate("+t(e)+",0)"})}function Af(e,t){e.attr("transform",function(e){return"translate(0,"+t(e)+")"})}function Hf(e){return e.toISOString()}function Bf(t,n,r){function i(e){return t(e)}function s(t,r){var i=t[1]-t[0],s=i/r,o=e.bisect(Ff,s);return o==Ff.length?[n.year,fa(t.map(function(e){return e/31536e6}),r)[2]]:o?n[s/Ff[o-1]<Ff[o]/s?o-1:o]:[Rf,fa(t,r)[2]]}return i.invert=function(e){return jf(t.invert(e))},i.domain=function(e){return arguments.length?(t.domain(e),i):t.domain().map(jf)},i.nice=function(e,t){function u(n){return!isNaN(n)&&!e.range(n,jf(+n+1),t).length}var n=i.domain(),r=Zu(n),o=e==null?s(r,10):typeof e=="number"&&s(r,e);return o&&(e=o[0],t=o[1]),i.domain(na(n,t>1?{floor:function(t){while(u(t=e.floor(t)))t=jf(t-1);return t},ceil:function(t){while(u(t=e.ceil(t)))t=jf(+t+1);return t}}:e))},i.ticks=function(e,t){var n=Zu(i.domain()),r=e==null?s(n,10):typeof e=="number"?s(n,e):!e.range&&[{range:e},t];return r&&(e=r[0],t=r[1]),e.range(n[0],jf(+n[1]+1),t<1?1:t)},i.tickFormat=function(){return r},i.copy=function(){return Bf(t.copy(),n,r)},ua(i,t)}function jf(e){return new Date(e)}function Wf(e){return JSON.parse(e.responseText)}var e={version:"3.4.1"};Date.now||(Date.now=function(){return+(new Date)});var t=[].slice,n=function(e){return t.call(e)},r=document,i=r.documentElement,s=window;try{n(i.childNodes)[0].nodeType}catch(o){n=function(e){var t=e.length,n=new Array(t);while(t--)n[t]=e[t];return n}}try{r.createElement("div").style.setProperty("opacity",0,"")}catch(u){var a=s.Element.prototype,f=a.setAttribute,l=a.setAttributeNS,c=s.CSSStyleDeclaration.prototype,h=c.setProperty;a.setAttribute=function(e,t){f.call(this,e,t+"")},a.setAttributeNS=function(e,t,n){l.call(this,e,t,n+"")},c.setProperty=function(e,t,n){h.call(this,e,t+"",n)}}e.ascending=function(e,t){return e<t?-1:e>t?1:e>=t?0:NaN},e.descending=function(e,t){return t<e?-1:t>e?1:t>=e?0:NaN},e.min=function(e,t){var n=-1,r=e.length,i,s;if(arguments.length===1){while(++n<r&&!((i=e[n])!=null&&i<=i))i=undefined;while(++n<r)(s=e[n])!=null&&i>s&&(i=s)}else{while(++n<r&&!((i=t.call(e,e[n],n))!=null&&i<=i))i=undefined;while(++n<r)(s=t.call(e,e[n],n))!=null&&i>s&&(i=s)}return i},e.max=function(e,t){var n=-1,r=e.length,i,s;if(arguments.length===1){while(++n<r&&!((i=e[n])!=null&&i<=i))i=undefined;while(++n<r)(s=e[n])!=null&&s>i&&(i=s)}else{while(++n<r&&!((i=t.call(e,e[n],n))!=null&&i<=i))i=undefined;while(++n<r)(s=t.call(e,e[n],n))!=null&&s>i&&(i=s)}return i},e.extent=function(e,t){var n=-1,r=e.length,i,s,o;if(arguments.length===1){while(++n<r&&!((i=o=e[n])!=null&&i<=i))i=o=undefined;while(++n<r)(s=e[n])!=null&&(i>s&&(i=s),o<s&&(o=s))}else{while(++n<r&&!((i=o=t.call(e,e[n],n))!=null&&i<=i))i=undefined;while(++n<r)(s=t.call(e,e[n],n))!=null&&(i>s&&(i=s),o<s&&(o=s))}return[i,o]},e.sum=function(e,t){var n=0,r=e.length,i,s=-1;if(arguments.length===1)while(++s<r)isNaN(i=+e[s])||(n+=i);else while(++s<r)isNaN(i=+t.call(e,e[s],s))||(n+=i);return n},e.mean=function(e,t){var n=e.length,r,i=0,s=-1,o=0;if(arguments.length===1)while(++s<n)p(r=e[s])&&(i+=(r-i)/++o);else while(++s<n)p(r=t.call(e,e[s],s))&&(i+=(r-i)/++o);return o?i:undefined},e.quantile=function(e,t){var n=(e.length-1)*t+1,r=Math.floor(n),i=+e[r-1],s=n-r;return s?i+s*(e[r]-i):i},e.median=function(t,n){return arguments.length>1&&(t=t.map(n)),t=t.filter(p),t.length?e.quantile(t.sort(e.ascending),.5):undefined},e.bisector=function(e){return{left:function(t,n,r,i){arguments.length<3&&(r=0),arguments.length<4&&(i=t.length);while(r<i){var s=r+i>>>1;e.call(t,t[s],s)<n?r=s+1:i=s}return r},right:function(t,n,r,i){arguments.length<3&&(r=0),arguments.length<4&&(i=t.length);while(r<i){var s=r+i>>>1;n<e.call(t,t[s],s)?i=s:r=s+1}return r}}};var d=e.bisector(function(e){return e});e.bisectLeft=d.left,e.bisect=e.bisectRight=d.right,e.shuffle=function(e){var t=e.length,n,r;while(t)r=Math.random()*t--|0,n=e[t],e[t]=e[r],e[r]=n;return e},e.permute=function(e,t){var n=t.length,r=new Array(n);while(n--)r[n]=e[t[n]];return r},e.pairs=function(e){var t=0,n=e.length-1,r,i=e[0],s=new Array(n<0?0:n);while(t<n)s[t]=[r=i,i=e[++t]];return s},e.zip=function(){if(!(s=arguments.length))return[];for(var t=-1,n=e.min(arguments,v),r=new Array(n);++t<n;)for(var i=-1,s,o=r[t]=new Array(s);++i<s;)o[i]=arguments[i][t];return r},e.transpose=function(t){return e.zip.apply(e,t)},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t},e.values=function(e){var t=[];for(var n in e)t.push(e[n]);return t},e.entries=function(e){var t=[];for(var n in e)t.push({key:n,value:e[n]});return t},e.merge=function(e){var t=e.length,n,r=-1,i=0,s,o;while(++r<t)i+=e[r].length;s=new Array(i);while(--t>=0){o=e[t],n=o.length;while(--n>=0)s[--i]=o[n]}return s};var m=Math.abs;e.range=function(e,t,n){arguments.length<3&&(n=1,arguments.length<2&&(t=e,e=0));if((t-e)/n===Infinity)throw new Error("infinite range");var r=[],i=g(m(n)),s=-1,o;e*=i,t*=i,n*=i;if(n<0)while((o=e+n*++s)>t)r.push(o/i);else while((o=e+n*++s)<t)r.push(o/i);return r},e.map=function(e){var t=new b;if(e instanceof b)e.forEach(function(e,n){t.set(e,n)});else for(var n in e)t.set(n,e[n]);return t},y(b,{has:S,get:function(e){return this[w+e]},set:function(e,t){return this[w+e]=t},remove:x,keys:T,values:function(){var e=[];return this.forEach(function(t,n){e.push(n)}),e},entries:function(){var e=[];return this.forEach(function(t,n){e.push({key:t,value:n})}),e},size:N,empty:C,forEach:function(e){for(var t in this)t.charCodeAt(0)===E&&e.call(this,t.substring(1),this[t])}});var w="\0",E=w.charCodeAt(0);e.nest=function(){function o(e,r,u){if(u>=n.length)return s?s.call(t,r):i?r.sort(i):r;var a=-1,f=r.length,l=n[u++],c,h,p,d=new b,v;while(++a<f)(v=d.get(c=l(h=r[a])))?v.push(h):d.set(c,[h]);return e?(h=e(),p=function(t,n){h.set(t,o(e,n,u))}):(h={},p=function(t,n){h[t]=o(e,n,u)}),d.forEach(p),h}function u(e,t){if(t>=n.length)return e;var i=[],s=r[t++];return e.forEach(function(e,n){i.push({key:e,values:u(n,t)})}),s?i.sort(function(e,t){return s(e.key,t.key)}):i}var t={},n=[],r=[],i,s;return t.map=function(e,t){return o(t,e,0)},t.entries=function(t){return u(o(e.map,t,0),0)},t.key=function(e){return n.push(e),t},t.sortKeys=function(e){return r[n.length-1]=e,t},t.sortValues=function(e){return i=e,t},t.rollup=function(e){return s=e,t},t},e.set=function(e){var t=new k;if(e)for(var n=0,r=e.length;n<r;++n)t.add(e[n]);return t},y(k,{has:S,add:function(e){return this[w+e]=!0,e},remove:function(e){return e=w+e,e in this&&delete this[e]},values:T,size:N,empty:C,forEach:function(e){for(var t in this)t.charCodeAt(0)===E&&e.call(this,t.substring(1))}}),e.behavior={},e.rebind=function(e,t){var n=1,r=arguments.length,i;while(++n<r)e[i=arguments[n]]=L(e,t,t[i]);return e};var O=["webkit","ms","moz","Moz","o","O"];e.dispatch=function(){var e=new _,t=-1,n=arguments.length;while(++t<n)e[arguments[t]]=D(e);return e},_.prototype.on=function(e,t){var n=e.indexOf("."),r="";n>=0&&(r=e.substring(n+1),e=e.substring(0,n));if(e)return arguments.length<2?this[e].on(r):this[e].on(r,t);if(arguments.length===2){if(t==null)for(e in this)this.hasOwnProperty(e)&&this[e].on(r,null);return this}},e.event=null,e.requote=function(e){return e.replace(j,"\\$&")};var j=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,F={}.__proto__?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)e[n]=t[n]},q=function(e,t){return t.querySelector(e)},R=function(e,t){return t.querySelectorAll(e)},U=i[A(i,"matchesSelector")],z=function(e,t){return U.call(e,t)};typeof Sizzle=="function"&&(q=function(e,t){return Sizzle(e,t)[0]||null},R=function(e,t){return Sizzle.uniqueSort(Sizzle(e,t))},z=Sizzle.matchesSelector),e.selection=function(){return ct};var W=e.selection.prototype=[];W.select=function(e){var t=[],n,r,i,s;e=X(e);for(var o=-1,u=this.length;++o<u;){t.push(n=[]),n.parentNode=(i=this[o]).parentNode;for(var a=-1,f=i.length;++a<f;)(s=i[a])?(n.push(r=e.call(s,s.__data__,a,o)),r&&"__data__"in s&&(r.__data__=s.__data__)):n.push(null)}return I(t)},W.selectAll=function(e){var t=[],r,i;e=V(e);for(var s=-1,o=this.length;++s<o;)for(var u=this[s],a=-1,f=u.length;++a<f;)if(i=u[a])t.push(r=n(e.call(i,i.__data__,a,s))),r.parentNode=i;return I(t)};var $={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};e.ns={prefix:$,qualify:function(e){var t=e.indexOf(":"),n=e;return t>=0&&(n=e.substring(0,t),e=e.substring(t+1)),$.hasOwnProperty(n)?{space:$[n],local:e}:e}},W.attr=function(t,n){if(arguments.length<2){if(typeof t=="string"){var r=this.node();return t=e.ns.qualify(t),t.local?r.getAttributeNS(t.space,t.local):r.getAttribute(t)}for(n in t)this.each(J(n,t[n]));return this}return this.each(J(t,n))},W.classed=function(e,t){if(arguments.length<2){if(typeof e=="string"){var n=this.node(),r=(e=G(e)).length,i=-1;if(t=n.classList){while(++i<r)if(!t.contains(e[i]))return!1}else{t=n.getAttribute("class");while(++i<r)if(!Q(e[i]).test(t))return!1}return!0}for(t in e)this.each(Y(t,e[t]));return this}return this.each(Y(e,t))},W.style=function(e,t,n){var r=arguments.length;if(r<3){if(typeof e!="string"){r<2&&(t="");for(n in e)this.each(et(n,e[n],t));return this}if(r<2)return s.getComputedStyle(this.node(),null).getPropertyValue(e);n=""}return this.each(et(e,t,n))},W.property=function(e,t){if(arguments.length<2){if(typeof e=="string")return this.node()[e];for(t in e)this.each(tt(t,e[t]));return this}return this.each(tt(e,t))},W.text=function(e){return arguments.length?this.each(typeof e=="function"?function(){var t=e.apply(this,arguments);this.textContent=t==null?"":t}:e==null?function(){this.textContent=""}:function(){this.textContent=e}):this.node().textContent},W.html=function(e){return arguments.length?this.each(typeof e=="function"?function(){var t=e.apply(this,arguments);this.innerHTML=t==null?"":t}:e==null?function(){this.innerHTML=""}:function(){this.innerHTML=e}):this.node().innerHTML},W.append=function(e){return e=nt(e),this.select(function(){return this.appendChild(e.apply(this,arguments))})},W.insert=function(e,t){return e=nt(e),t=X(t),this.select(function(){return this.insertBefore(e.apply(this,arguments),t.apply(this,arguments)||null)})},W.remove=function(){return this.each(function(){var e=this.parentNode;e&&e.removeChild(this)})},W.data=function(e,t){function o(e,n){var r,i=e.length,s=n.length,o=Math.min(i,s),l=new Array(s),c=new Array(s),h=new Array(i),p,d;if(t){var v=new b,m=new b,g=[],y;for(r=-1;++r<i;)y=t.call(p=e[r],p.__data__,r),v.has(y)?h[r]=p:v.set(y,p),g.push(y);for(r=-1;++r<s;)y=t.call(n,d=n[r],r),(p=v.get(y))?(l[r]=p,p.__data__=d):m.has(y)||(c[r]=rt(d)),m.set(y,d),v.remove(y);for(r=-1;++r<i;)v.has(g[r])&&(h[r]=e[r])}else{for(r=-1;++r<o;)p=e[r],d=n[r],p?(p.__data__=d,l[r]=p):c[r]=rt(d);for(;r<s;++r)c[r]=rt(n[r]);for(;r<i;++r)h[r]=e[r]}c.update=l,c.parentNode=l.parentNode=h.parentNode=e.parentNode,u.push(c),a.push(l),f.push(h)}var n=-1,r=this.length,i,s;if(!arguments.length){e=new Array(r=(i=this[0]).length);while(++n<r)if(s=i[n])e[n]=s.__data__;return e}var u=ut([]),a=I([]),f=I([]);if(typeof e=="function")while(++n<r)o(i=this[n],e.call(i,i.parentNode.__data__,n));else while(++n<r)o(i=this[n],e);return a.enter=function(){return u},a.exit=function(){return f},a},W.datum=function(e){return arguments.length?this.property("__data__",e):this.property("__data__")},W.filter=function(e){var t=[],n,r,i;typeof e!="function"&&(e=it(e));for(var s=0,o=this.length;s<o;s++){t.push(n=[]),n.parentNode=(r=this[s]).parentNode;for(var u=0,a=r.length;u<a;u++)(i=r[u])&&e.call(i,i.__data__,u,s)&&n.push(i)}return I(t)},W.order=function(){for(var e=-1,t=this.length;++e<t;)for(var n=this[e],r=n.length-1,i=n[r],s;--r>=0;)if(s=n[r])i&&i!==s.nextSibling&&i.parentNode.insertBefore(s,i),i=s;return this},W.sort=function(e){e=st.apply(this,arguments);for(var t=-1,n=this.length;++t<n;)this[t].sort(e);return this.order()},W.each=function(e){return ot(this,function(t,n,r){e.call(t,t.__data__,n,r)})},W.call=function(e){var t=n(arguments);return e.apply(t[0]=this,t),this},W.empty=function(){return!this.node()},W.node=function(){for(var e=0,t=this.length;e<t;e++)for(var n=this[e],r=0,i=n.length;r<i;r++){var s=n[r];if(s)return s}return null},W.size=function(){var e=0;return this.each(function(){++e}),e};var at=[];e.selection.enter=ut,e.selection.enter.prototype=at,at.append=W.append,at.empty=W.empty,at.node=W.node,at.call=W.call,at.size=W.size,at.select=function(e){var t=[],n,r,i,s,o;for(var u=-1,a=this.length;++u<a;){i=(s=this[u]).update,t.push(n=[]),n.parentNode=s.parentNode;for(var f=-1,l=s.length;++f<l;)(o=s[f])?(n.push(i[f]=r=e.call(s.parentNode,o.__data__,f,u)),r.__data__=o.__data__):n.push(null)}return I(t)},at.insert=function(e,t){return arguments.length<2&&(t=ft(this)),W.insert.call(this,e,t)},W.transition=function(){var e=Ef||++wf,t=[],n,r,i=Sf||{time:Date.now(),ease:Mo,delay:0,duration:250};for(var s=-1,o=this.length;++s<o;){t.push(n=[]);for(var u=this[s],a=-1,f=u.length;++a<f;)(r=u[a])&&Nf(r,a,e,i),n.push(r)}return yf(t,e)},W.interrupt=function(){return this.each(lt)},e.select=function(e){var t=[typeof e=="string"?q(e,r):e];return t.parentNode=i,I([t])},e.selectAll=function(e){var t=n(typeof e=="string"?R(e,r):e);return t.parentNode=i,I([t])};var ct=e.select(i);W.on=function(e,t,n){var r=arguments.length;if(r<3){if(typeof e!="string"){r<2&&(t=!1);for(n in e)this.each(ht(n,e[n],t));return this}if(r<2)return(r=this.node()["__on"+e])&&r._;n=!1}return this.each(ht(e,t,n))};var pt=e.map({mouseenter:"mouseover",mouseleave:"mouseout"});pt.forEach(function(e){"on"+e in r&&pt.remove(e)});var mt="onselectstart"in r?null:A(i.style,"userSelect"),gt=0;e.mouse=function(e){return wt(e,H())};var bt=/WebKit/.test(s.navigator.userAgent)?-1:0;e.touches=function(e,t){return arguments.length<2&&(t=H().touches),t?n(t).map(function(t){var n=wt(e,t);return n.identifier=t.identifier,n}):[]},e.behavior.drag=function(){function o(){this.on("mousedown.drag",r).on("touchstart.drag",i)}function u(){return e.event.changedTouches[0].identifier}function a(t,n){return e.touches(t).filter(function(e){return e.identifier===n})[0]}function f(r,i,o,u){return function(){function b(){var e=i(f,h),t=e[0]-d[0],n=e[1]-d[1];v|=t|n,d=e,l({type:"drag",x:e[0]+m[0],y:e[1]+m[1],dx:t,dy:n})}function w(){g.on(o+"."+p,null).on(u+"."+p,null),y(v&&e.event.target===c),l({type:"dragend"})}var a=this,f=a.parentNode,l=t.of(a,arguments),c=e.event.target,h=r(),p=h==null?"drag":"drag-"+h,d=i(f,h),v=0,m,g=e.select(s).on(o+"."+p,b).on(u+"."+p,w),y=yt();n?(m=n.apply(a,arguments),m=[m.x-d[0],m.y-d[1]]):m=[0,0],l({type:"dragstart"})}}var t=B(o,"drag","dragstart","dragend"),n=null,r=f(M,e.mouse,"mousemove","mouseup"),i=f(u,a,"touchmove","touchend");return o.origin=function(e){return arguments.length?(n=e,o):n},e.rebind(o,t,"on")};var Et=Math.PI,St=2*Et,xt=Et/2,Tt=1e-6,Nt=Tt*Tt,Ct=Et/180,kt=180/Et,Bt=Math.SQRT2,jt=2,Ft=4;e.interpolateZoom=function(e,t){function y(e){var t=e*g;if(m){var s=Dt(d),o=i/(jt*c)*(s*Pt(Bt*t+d)-_t(d));return[n+o*a,r+o*f,i*s/Dt(Bt*t+d)]}return[n+e*a,r+e*f,i*Math.exp(Bt*t)]}var n=e[0],r=e[1],i=e[2],s=t[0],o=t[1],u=t[2],a=s-n,f=o-r,l=a*a+f*f,c=Math.sqrt(l),h=(u*u-i*i+Ft*l)/(2*i*jt*c),p=(u*u-i*i-Ft*l)/(2*u*jt*c),d=Math.log(Math.sqrt(h*h+1)-h),v=Math.log(Math.sqrt(p*p+1)-p),m=v-d,g=(m||Math.log(u/i))/Bt;return y.duration=g*1e3,y},e.behavior.zoom=function(){function y(e){e.on(u,k).on(Rt+".zoom",A).on(a,O).on("dblclick.zoom",M).on(c,L)}function b(e){return[(e[0]-t.x)/t.k,(e[1]-t.y)/t.k]}function w(e){return[e[0]*t.k+t.x,e[1]*t.k+t.y]}function E(e){t.k=Math.max(o[0],Math.min(o[1],e))}function S(e,n){n=w(n),t.x+=e[0]-n[0],t.y+=e[1]-n[1]}function x(){v&&v.domain(d.range().map(function(e){return(e-t.x)/t.k}).map(d.invert)),g&&g.domain(m.range().map(function(e){return(e-t.y)/t.k}).map(m.invert))}function T(e){e({type:"zoomstart"})}function N(e){x(),e({type:"zoom",scale:t.k,translate:[t.x,t.y]})}function C(e){e({type:"zoomend"})}function k(){function c(){i=1,S(e.mouse(t),u),N(n)}function h(){o.on(a,s===t?O:null).on(f,null),l(i&&e.event.target===r),C(n)}var t=this,n=p.of(t,arguments),r=e.event.target,i=0,o=e.select(s).on(a,c).on(f,h),u=b(e.mouse(t)),l=yt();lt.call(t),T(n)}function L(){function y(){var r=e.touches(n);return a=t.k,r.forEach(function(e){e.identifier in i&&(i[e.identifier]=b(e))}),r}function w(){var n=e.event.changedTouches;for(var s=0,u=n.length;s<u;++s)i[n[s].identifier]=null;var a=y(),f=Date.now();if(a.length===1){if(f-h<500){var l=a[0],c=i[l.identifier];E(t.k*2),S(l,c),P(),N(r)}h=f}else if(a.length>1){var l=a[0],p=a[1],d=l[0]-p[0],v=l[1]-p[1];o=d*d+v*v}}function x(){var t=e.touches(n),s,u,f,l;for(var c=0,p=t.length;c<p;++c,l=null){f=t[c];if(l=i[f.identifier]){if(u)break;s=f,u=l}}if(l){var d=(d=f[0]-s[0])*d+(d=f[1]-s[1])*d,v=o&&Math.sqrt(d/o);s=[(s[0]+f[0])/2,(s[1]+f[1])/2],u=[(u[0]+l[0])/2,(u[1]+l[1])/2],E(v*a)}h=null,S(s,u),N(r)}function A(){if(e.event.touches.length){var t=e.event.changedTouches;for(var n=0,s=t.length;n<s;++n)delete i[t[n].identifier];for(var o in i)return void y()}v.on(l,null).on(d,null),m.on(u,k).on(c,L),g(),C(r)}var n=this,r=p.of(n,arguments),i={},o=0,a,f=e.event.changedTouches[0].identifier,l="touchmove.zoom-"+f,d="touchend.zoom-"+f,v=e.select(s).on(l,x).on(d,A),m=e.select(n).on(u,null).on(c,w),g=yt();lt.call(n),w(),T(r)}function A(){var i=p.of(this,arguments);l?clearTimeout(l):(lt.call(this),T(i)),l=setTimeout(function(){l=null,C(i)},50),P();var s=r||e.mouse(this);n||(n=b(s)),E(Math.pow(2,qt()*.002)*t.k),S(s,n),N(i)}function O(){n=null}function M(){var n=p.of(this,arguments),r=e.mouse(this),i=b(r),s=Math.log(t.k)/Math.LN2;T(n),E(Math.pow(2,e.event.shiftKey?Math.ceil(s)-1:Math.floor(s)+1)),S(r,i),N(n),C(n)}var t={x:0,y:0,k:1},n,r,i=[960,500],o=It,u="mousedown.zoom",a="mousemove.zoom",f="mouseup.zoom",l,c="touchstart.zoom",h,p=B(y,"zoomstart","zoom","zoomend"),d,v,m,g;return y.event=function(n){n.each(function(){var n=p.of(this,arguments),r=t;Ef?e.select(this).transition().each("start.zoom",function(){t=this.__chart__||{x:0,y:0,k:1},T(n)}).tween("zoom:zoom",function(){var s=i[0],o=i[1],u=s/2,a=o/2,f=e.interpolateZoom([(u-t.x)/t.k,(a-t.y)/t.k,s/t.k],[(u-r.x)/r.k,(a-r.y)/r.k,s/r.k]);return function(e){var r=f(e),i=s/r[2];this.__chart__=t={x:u-r[0]*i,y:a-r[1]*i,k:i},N(n)}}).each("end.zoom",function(){C(n)}):(this.__chart__=t,T(n),N(n),C(n))})},y.translate=function(e){return arguments.length?(t={x:+e[0],y:+e[1],k:t.k},x(),y):[t.x,t.y]},y.scale=function(e){return arguments.length?(t={x:t.x,y:t.y,k:+e},x(),y):t.k},y.scaleExtent=function(e){return arguments.length?(o=e==null?It:[+e[0],+e[1]],y):o},y.center=function(e){return arguments.length?(r=e&&[+e[0],+e[1]],y):r},y.size=function(e){return arguments.length?(i=e&&[+e[0],+e[1]],y):i},y.x=function(e){return arguments.length?(v=e,d=e.copy(),t={x:0,y:0,k:1},y):v},y.y=function(e){return arguments.length?(g=e,m=e.copy(),t={x:0,y:0,k:1},y):g},e.rebind(y,p,"on")};var It=[0,Infinity],qt,Rt="onwheel"in r?(qt=function(){return-e.event.deltaY*(e.event.deltaMode?120:1)},"wheel"):"onmousewheel"in r?(qt=function(){return e.event.wheelDelta},"mousewheel"):(qt=function(){return-e.event.detail},"MozMousePixelScroll");Ut.prototype.toString=function(){return this.rgb()+""},e.hsl=function(e,t,n){return arguments.length===1?e instanceof Wt?zt(e.h,e.s,e.l):mn(""+e,gn,zt):zt(+e,+t,+n)};var Xt=Wt.prototype=new Ut;Xt.brighter=function(e){return e=Math.pow(.7,arguments.length?e:1),zt(this.h,this.s,this.l/e)},Xt.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),zt(this.h,this.s,e*this.l)},Xt.rgb=function(){return Vt(this.h,this.s,this.l)},e.hcl=function(t,n,r){return arguments.length===1?t instanceof Jt?$t(t.h,t.c,t.l):t instanceof Yt?on(t.l,t.a,t.b):on((t=yn((t=e.rgb(t)).r,t.g,t.b)).l,t.a,t.b):$t(+t,+n,+r)};var Kt=Jt.prototype=new Ut;Kt.brighter=function(e){return $t(this.h,this.c,Math.min(100,this.l+Zt*(arguments.length?e:1)))},Kt.darker=function(e){return $t(this.h,this.c,Math.max(0,this.l-Zt*(arguments.length?e:1)))},Kt.rgb=function(){return Qt(this.h,this.c,this.l).rgb()},e.lab=function(t,n,r){return arguments.length===1?t instanceof Yt?Gt(t.l,t.a,t.b):t instanceof Jt?Qt(t.l,t.c,t.h):yn((t=e.rgb(t)).r,t.g,t.b):Gt(+t,+n,+r)};var Zt=18,en=.95047,tn=1,nn=1.08883,rn=Yt.prototype=new Ut;rn.brighter=function(e){return Gt(Math.min(100,this.l+Zt*(arguments.length?e:1)),this.a,this.b)},rn.darker=function(e){return Gt(Math.max(0,this.l-Zt*(arguments.length?e:1)),this.a,this.b)},rn.rgb=function(){return sn(this.l,this.a,this.b)},e.rgb=function(e,t,n){return arguments.length===1?e instanceof pn?hn(e.r,e.g,e.b):mn(""+e,hn,Vt):hn(~~e,~~t,~~n)};var dn=pn.prototype=new Ut;dn.brighter=function(e){e=Math.pow(.7,arguments.length?e:1);var t=this.r,n=this.g,r=this.b,i=30;return!t&&!n&&!r?hn(i,i,i):(t&&t<i&&(t=i),n&&n<i&&(n=i),r&&r<i&&(r=i),hn(Math.min(255,~~(t/e)),Math.min(255,~~(n/e)),Math.min(255,~~(r/e))))},dn.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),hn(~~(e*this.r),~~(e*this.g),~~(e*this.b))},dn.hsl=function(){return gn(this.r,this.g,this.b)},dn.toString=function(){return"#"+vn(this.r)+vn(this.g)+vn(this.b)};var En=e.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});En.forEach(function(e,t){En.set(e,ln(t))}),e.functor=Sn,e.xhr=Tn(xn),e.dsv=function(e,t){function i(e,n,r){arguments.length<3&&(r=n,n=null);var i=Nn(e,t,n==null?s:o(n),r);return i.row=function(e){return arguments.length?i.response((n=e)==null?s:o(e)):n},i}function s(e){return i.parse(e.responseText)}function o(e){return function(t){return i.parse(t.responseText,e)}}function u(t){return t.map(a).join(e)}function a(e){return n.test(e)?'"'+e.replace(/\"/g,'""')+'"':e}var n=new RegExp('["'+e+"\n]"),r=e.charCodeAt(0);return i.parse=function(e,t){var n;return i.parseRows(e,function(e,r){if(n)return n(e,r-1);var i=new Function("d","return {"+e.map(function(e,t){return JSON.stringify(e)+": d["+t+"]"}).join(",")+"}");n=t?function(e,n){return t(i(e),n)}:i})},i.parseRows=function(e,t){function c(){if(u>=o)return i;if(l)return l=!1,n;var t=u;if(e.charCodeAt(t)===34){var s=t;while(s++<o)if(e.charCodeAt(s)===34){if(e.charCodeAt(s+1)!==34)break;++s}u=s+2;var a=e.charCodeAt(s+1);return a===13?(l=!0,e.charCodeAt(s+2)===10&&++u):a===10&&(l=!0),e.substring(t+1,s).replace(/""/g,'"')}while(u<o){var a=e.charCodeAt(u++),f=1;if(a===10)l=!0;else if(a===13)l=!0,e.charCodeAt(u)===10&&(++u,++f);else if(a!==r)continue;return e.substring(t,u-f)}return e.substring(t)}var n={},i={},s=[],o=e.length,u=0,a=0,f,l;while((f=c())!==i){var h=[];while(f!==n&&f!==i)h.push(f),f=c();if(t&&!(h=t(h,a++)))continue;s.push(h)}return s},i.format=function(t){if(Array.isArray(t[0]))return i.formatRows(t);var n=new k,r=[];return t.forEach(function(e){for(var t in e)n.has(t)||r.push(n.add(t))}),[r.map(a).join(e)].concat(t.map(function(t){return r.map(function(e){return a(t[e])}).join(e)})).join("\n")},i.formatRows=function(e){return e.map(u).join("\n")},i},e.csv=e.dsv(",","text/csv"),e.tsv=e.dsv("	","text/tab-separated-values");var kn,Ln,An,On,Mn,_n=s[A(s,"requestAnimationFrame")]||function(e){setTimeout(e,17)};e.timer=function(e,t,n){var r=arguments.length;r<2&&(t=0),r<3&&(n=Date.now());var i=n+t,s={c:e,t:i,f:!1,n:null};Ln?Ln.n=s:kn=s,Ln=s,An||(On=clearTimeout(On),An=1,_n(Dn))},e.timer.flush=function(){Pn(),Hn()},e.round=function(e,t){return t?Math.round(e*(t=Math.pow(10,t)))/t:Math.round(e)};var jn=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"].map(Fn);e.formatPrefix=function(t,n){var r=0;return t&&(t<0&&(t*=-1),n&&(t=e.round(t,Bn(t,n))),r=1+Math.floor(1e-12+Math.log(t)/Math.LN10),r=Math.max(-24,Math.min(24,Math.floor((r<=0?r+1:r-1)/3)*3))),jn[8+r/3]};var qn=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,Rn=e.map({b:function(e){return e.toString(2)},c:function(e){return String.fromCharCode(e)},o:function(e){return e.toString(8)},x:function(e){return e.toString(16)},X:function(e){return e.toString(16).toUpperCase()},g:function(e,t){return e.toPrecision(t)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},r:function(t,n){return(t=e.round(t,Bn(t,n))).toFixed(Math.max(0,Math.min(20,Bn(t*(1+1e-15),n))))}}),zn=e.time={},Wn=Date;Xn.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){Vn.setUTCDate.apply(this._,arguments)},setDay:function(){Vn.setUTCDay.apply(this._,arguments)},setFullYear:function(){Vn.setUTCFullYear.apply(this._,arguments)},setHours:function(){Vn.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){Vn.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){Vn.setUTCMinutes.apply(this._,arguments)},setMonth:function(){Vn.setUTCMonth.apply(this._,arguments)},setSeconds:function(){Vn.setUTCSeconds.apply(this._,arguments)},setTime:function(){Vn.setTime.apply(this._,arguments)}};var Vn=Date.prototype;zn.year=$n(function(e){return e=zn.day(e),e.setMonth(0,1),e},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e){return e.getFullYear()}),zn.years=zn.year.range,zn.years.utc=zn.year.utc.range,zn.day=$n(function(e){var t=new Wn(2e3,0);return t.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),t},function(e,t){e.setDate(e.getDate()+t)},function(e){return e.getDate()-1}),zn.days=zn.day.range,zn.days.utc=zn.day.utc.range,zn.dayOfYear=function(e){var t=zn.year(e);return Math.floor((e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*6e4)/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(e,t){t=7-t;var n=zn[e]=$n(function(e){return(e=zn.day(e)).setDate(e.getDate()-(e.getDay()+t)%7),e},function(e,t){e.setDate(e.getDate()+Math.floor(t)*7)},function(e){var n=zn.year(e).getDay();return Math.floor((zn.dayOfYear(e)+(n+t)%7)/7)-(n!==t)});zn[e+"s"]=n.range,zn[e+"s"].utc=n.utc.range,zn[e+"OfYear"]=function(e){var n=zn.year(e).getDay();return Math.floor((zn.dayOfYear(e)+(n+t)%7)/7)}}),zn.week=zn.sunday,zn.weeks=zn.sunday.range,zn.weeks.utc=zn.sunday.utc.range,zn.weekOfYear=zn.sundayOfYear;var Qn={"-":"",_:" ",0:"0"},Gn=/^\s*\d+/,Yn=/^%/;e.locale=function(e){return{numberFormat:In(e),timeFormat:Kn(e)}};var br=e.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});e.format=br.numberFormat,e.geo={},wr.prototype={s:0,t:0,add:function(e){Sr(e,this.t,Er),Sr(Er.s,this.s,this),this.s?this.t+=Er.t:this.s=Er.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var Er=new wr;e.geo.stream=function(e,t){e&&Tr.hasOwnProperty(e.type)?Tr[e.type](e,t):xr(e,t)};var Tr={Feature:function(e,t){xr(e.geometry,t)},FeatureCollection:function(e,t){var n=e.features,r=-1,i=n.length;while(++r<i)xr(n[r].geometry,t)}},Nr={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){var n=e.coordinates,r=-1,i=n.length;while(++r<i)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){Cr(e.coordinates,t,0)},MultiLineString:function(e,t){var n=e.coordinates,r=-1,i=n.length;while(++r<i)Cr(n[r],t,0)},Polygon:function(e,t){kr(e.coordinates,t)},MultiPolygon:function(e,t){var n=e.coordinates,r=-1,i=n.length;while(++r<i)kr(n[r],t)},GeometryCollection:function(e,t){var n=e.geometries,r=-1,i=n.length;while(++r<i)xr(n[r],t)}};e.geo.area=function(t){return Lr=0,e.geo.stream(t,Or),Lr};var Lr,Ar=new wr,Or={sphere:function(){Lr+=4*Et},point:M,lineStart:M,lineEnd:M,polygonStart:function(){Ar.reset(),Or.lineStart=Mr},polygonEnd:function(){var e=2*Ar;Lr+=e<0?4*Et+e:e,Or.lineStart=Or.lineEnd=Or.point=M}};e.geo.bounds=function(){function p(e,s){l.push(c=[t=e,r=e]),s<n&&(n=s),s>i&&(i=s)}function d(e,o){var u=_r([e*Ct,o*Ct]);if(a){var f=Pr(a,u),l=[f[1],-f[0],0],c=Pr(l,f);jr(c),c=Fr(c);var h=e-s,d=h>0?1:-1,v=c[0]*kt*d,g=m(h)>180;if(g^(d*s<v&&v<d*e)){var y=c[1]*kt;y>i&&(i=y)}else if(v=(v+360)%360-180,g^(d*s<v&&v<d*e)){var y=-c[1]*kt;y<n&&(n=y)}else o<n&&(n=o),o>i&&(i=o);g?e<s?E(t,e)>E(t,r)&&(r=e):E(e,r)>E(t,r)&&(t=e):r>=t?(e<t&&(t=e),e>r&&(r=e)):e>s?E(t,e)>E(t,r)&&(r=e):E(e,r)>E(t,r)&&(t=e)}else p(e,o);a=u,s=e}function v(){h.point=d}function g(){c[0]=t,c[1]=r,h.point=p,a=null}function y(e,t){if(a){var n=e-s;f+=m(n)>180?n+(n>0?360:-360):n}else o=e,u=t;Or.point(e,t),d(e,t)}function b(){Or.lineStart()}function w(){y(o,u),Or.lineEnd(),m(f)>Tt&&(t=-(r=180)),c[0]=t,c[1]=r,a=null}function E(e,t){return(t-=e)<0?t+360:t}function S(e,t){return e[0]-t[0]}function x(e,t){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e}var t,n,r,i,s,o,u,a,f,l,c,h={point:p,lineStart:v,lineEnd:g,polygonStart:function(){h.point=y,h.lineStart=b,h.lineEnd=w,f=0,Or.polygonStart()},polygonEnd:function(){Or.polygonEnd(),h.point=p,h.lineStart=v,h.lineEnd=g,Ar<0?(t=-(r=180),n=-(i=90)):f>Tt?i=90:f<-Tt&&(n=-90),c[0]=t,c[1]=r}};return function(s){i=r=-(t=n=Infinity),l=[],e.geo.stream(s,h);var o=l.length;if(o){l.sort(S);for(var u=1,a=l[0],f,p=[a];u<o;++u)f=l[u],x(f[0],a)||x(f[1],a)?(E(a[0],f[1])>E(a[0],a[1])&&(a[1]=f[1]),E(f[0],a[1])>E(a[0],a[1])&&(a[0]=f[0])):p.push(a=f);var d=-Infinity,v;for(var o=p.length-1,u=0,a=p[o],f;u<=o;a=f,++u)f=p[u],(v=E(a[1],f[0]))>d&&(d=v,t=f[0],r=a[1])}return l=c=null,t===Infinity||n===Infinity?[[NaN,NaN],[NaN,NaN]]:[[t,n],[r,i]]}}(),e.geo.centroid=function(t){qr=Rr=Ur=zr=Wr=Xr=Vr=$r=Jr=Kr=Qr=0,e.geo.stream(t,Gr);var n=Jr,r=Kr,i=Qr,s=n*n+r*r+i*i;if(s<Nt){n=Xr,r=Vr,i=$r,Rr<Tt&&(n=Ur,r=zr,i=Wr),s=n*n+r*r+i*i;if(s<Nt)return[NaN,NaN]}return[Math.atan2(r,n)*kt,Mt(i/Math.sqrt(s))*kt]};var qr,Rr,Ur,zr,Wr,Xr,Vr,$r,Jr,Kr,Qr,Gr={sphere:M,point:Yr,lineStart:ei,lineEnd:ti,polygonStart:function(){Gr.lineStart=ni},polygonEnd:function(){Gr.lineStart=ei}},hi=ui(ri,pi,vi,[-Et,-Et/2]),yi=1e9;e.geo.clipExtent=function(){var e,t,n,r,i,s,o={stream:function(e){return i&&(i.valid=!1),i=s(e),i.valid=!0,i},extent:function(u){return arguments.length?(s=bi(e=+u[0][0],t=+u[0][1],n=+u[1][0],r=+u[1][1]),i&&(i.valid=!1,i=null),o):[[e,t],[n,r]]}};return o.extent([[0,0],[960,500]])},(e.geo.conicEqualArea=function(){return Ei(Si)}).raw=Si,e.geo.albers=function(){return e.geo.conicEqualArea().rotate([96,0]).center([-0.6,38.7]).parallels([29.5,45.5]).scale(1070)},e.geo.albersUsa=function(){function f(e){var t=e[0],n=e[1];return i=null,(o(t,n),i)||(u(t,n),i)||a(t,n),i}var t=e.geo.albers(),n=e.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),r=e.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),i,s={point:function(e,t){i=[e,t]}},o,u,a;return f.invert=function(e){var i=t.scale(),s=t.translate(),o=(e[0]-s[0])/i,u=(e[1]-s[1])/i;return(u>=.12&&u<.234&&o>=-0.425&&o<-0.214?n:u>=.166&&u<.234&&o>=-0.214&&o<-0.115?r:t).invert(e)},f.stream=function(e){var i=t.stream(e),s=n.stream(e),o=r.stream(e);return{point:function(e,t){i.point(e,t),s.point(e,t),o.point(e,t)},sphere:function(){i.sphere(),s.sphere(),o.sphere()},lineStart:function(){i.lineStart(),s.lineStart(),o.lineStart()},lineEnd:function(){i.lineEnd(),s.lineEnd(),o.lineEnd()},polygonStart:function(){i.polygonStart(),s.polygonStart(),o.polygonStart()},polygonEnd:function(){i.polygonEnd(),s.polygonEnd(),o.polygonEnd()}}},f.precision=function(e){return arguments.length?(t.precision(e),n.precision(e),r.precision(e),f):t.precision()},f.scale=function(e){return arguments.length?(t.scale(e),n.scale(e*.35),r.scale(e),f.translate(t.translate())):t.scale()},f.translate=function(e){if(!arguments.length)return t.translate();var i=t.scale(),l=+e[0],c=+e[1];return o=t.translate(e).clipExtent([[l-.455*i,c-.238*i],[l+.455*i,c+.238*i]]).stream(s).point,u=n.translate([l-.307*i,c+.201*i]).clipExtent([[l-.425*i+Tt,c+.12*i+Tt],[l-.214*i-Tt,c+.234*i-Tt]]).stream(s).point,a=r.translate([l-.205*i,c+.212*i]).clipExtent([[l-.214*i+Tt,c+.166*i+Tt],[l-.115*i-Tt,c+.234*i-Tt]]).stream(s).point,f},f.scale(1070)};var xi,Ti,Ni={point:M,lineStart:M,lineEnd:M,polygonStart:function(){Ti=0,Ni.lineStart=Ci},polygonEnd:function(){Ni.lineStart=Ni.lineEnd=Ni.point=M,xi+=m(Ti/2)}},ki,Li,Ai,Oi,Mi={point:_i,lineStart:M,lineEnd:M,polygonStart:M,polygonEnd:M},Hi={point:Bi,lineStart:ji,lineEnd:Fi,polygonStart:function(){Hi.lineStart=Ii},polygonEnd:function(){Hi.point=Bi,Hi.lineStart=ji,Hi.lineEnd=Fi}};e.geo.path=function(){function u(n){if(n){typeof t=="function"&&s.pointRadius(+t.apply(this,arguments));if(!o||!o.valid)o=i(s);e.geo.stream(n,o)}return s.result()}function a(){return o=null,u}var t=4.5,n,r,i,s,o;return u.area=function(t){return xi=0,e.geo.stream(t,i(Ni)),xi},u.centroid=function(t){return Ur=zr=Wr=Xr=Vr=$r=Jr=Kr=Qr=0,e.geo.stream(t,i(Hi)),Qr?[Jr/Qr,Kr/Qr]:$r?[Xr/$r,Vr/$r]:Wr?[Ur/Wr,zr/Wr]:[NaN,NaN]},u.bounds=function(t){return Ai=Oi=-(ki=Li=Infinity),e.geo.stream(t,i(Mi)),[[ki,Li],[Ai,Oi]]},u.projection=function(e){return arguments.length?(i=(n=e)?e.stream||Ui(e):xn,a()):n},u.context=function(e){return arguments.length?(s=(r=e)==null?new Di:new qi(e),typeof t!="function"&&s.pointRadius(t),a()):r},u.pointRadius=function(e){return arguments.length?(t=typeof e=="function"?e:(s.pointRadius(+e),+e),u):t},u.projection(e.geo.albersUsa()).context(null)},e.geo.transform=function(e){return{stream:function(t){var n=new zi(t);for(var r in e)n[r]=e[r];return n}}},zi.prototype={point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},e.geo.projection=Xi,e.geo.projectionMutator=Vi,(e.geo.equirectangular=function(){return Xi(Ji)}).raw=Ji.invert=Ji,e.geo.rotation=function(e){function t(t){return t=e(t[0]*Ct,t[1]*Ct),t[0]*=kt,t[1]*=kt,t}return e=Qi(e[0]%360*Ct,e[1]*Ct,e.length>2?e[2]*Ct:0),t.invert=function(t){return t=e.invert(t[0]*Ct,t[1]*Ct),t[0]*=kt,t[1]*=kt,t},t},Ki.invert=Ji,e.geo.circle=function(){function i(){var t=typeof e=="function"?e.apply(this,arguments):e,n=Qi(-t[0]*Ct,-t[1]*Ct,0).invert,i=[];return r(null,null,1,{point:function(e,t){i.push(e=n(e,t)),e[0]*=kt,e[1]*=kt}}),{type:"Polygon",coordinates:[i]}}var e=[0,0],t,n=6,r;return i.origin=function(t){return arguments.length?(e=t,i):e},i.angle=function(e){return arguments.length?(r=es((t=+e)*Ct,n*Ct),i):t},i.precision=function(e){return arguments.length?(r=es(t*Ct,(n=+e)*Ct),i):n},i.angle(90)},e.geo.distance=function(e,t){var n=(t[0]-e[0])*Ct,r=e[1]*Ct,i=t[1]*Ct,s=Math.sin(n),o=Math.cos(n),u=Math.sin(r),a=Math.cos(r),f=Math.sin(i),l=Math.cos(i),c;return Math.atan2(Math.sqrt((c=l*s)*c+(c=a*f-u*l*o)*c),u*f+a*l*o)},e.geo.graticule=function(){function b(){return{type:"MultiLineString",coordinates:w()}}function w(){return e.range(Math.ceil(i/c)*c,r,c).map(v).concat(e.range(Math.ceil(a/h)*h,u,h).map(g)).concat(e.range(Math.ceil(n/f)*f,t,f).filter(function(e){return m(e%c)>Tt}).map(p)).concat(e.range(Math.ceil(o/l)*l,s,l).filter(function(e){return m(e%h)>Tt}).map(d))}var t,n,r,i,s,o,u,a,f=10,l=f,c=90,h=360,p,d,v,g,y=2.5;return b.lines=function(){return w().map(function(e){return{type:"LineString",coordinates:e}})},b.outline=function(){return{type:"Polygon",coordinates:[v(i).concat(g(u).slice(1),v(r).reverse().slice(1),g(a).reverse().slice(1))]}},b.extent=function(e){return arguments.length?b.majorExtent(e).minorExtent(e):b.minorExtent()},b.majorExtent=function(e){return arguments.length?(i=+e[0][0],r=+e[1][0],a=+e[0][1],u=+e[1][1],i>r&&(e=i,i=r,r=e),a>u&&(e=a,a=u,u=e),b.precision(y)):[[i,a],[r,u]]},b.minorExtent=function(e){return arguments.length?(n=+e[0][0],t=+e[1][0],o=+e[0][1],s=+e[1][1],n>t&&(e=n,n=t,t=e),o>s&&(e=o,o=s,s=e),b.precision(y)):[[n,o],[t,s]]},b.step=function(e){return arguments.length?b.majorStep(e).minorStep(e):b.minorStep()},b.majorStep=function(e){return arguments.length?(c=+e[0],h=+e[1],b):[c,h]},b.minorStep=function(e){return arguments.length?(f=+e[0],l=+e[1],b):[f,l]},b.precision=function(e){return arguments.length?(y=+e,p=ns(o,s,90),d=rs(n,t,y),v=ns(a,u,90),g=rs(i,r,y),b):y},b.majorExtent([[-180,-90+Tt],[180,90-Tt]]).minorExtent([[-180,-80-Tt],[180,80+Tt]])},e.geo.greatArc=function(){function s(){return{type:"LineString",coordinates:[n||t.apply(this,arguments),i||r.apply(this,arguments)]}}var t=is,n,r=ss,i;return s.distance=function(){return e.geo.distance(n||t.apply(this,arguments),i||r.apply(this,arguments))},s.source=function(e){return arguments.length?(t=e,n=typeof e=="function"?null:e,s):t},s.target=function(e){return arguments.length?(r=e,i=typeof e=="function"?null:e,s):r},s.precision=function(){return arguments.length?s:0},s},e.geo.interpolate=function(e,t){return os(e[0]*Ct,e[1]*Ct,t[0]*Ct,t[1]*Ct)},e.geo.length=function(t){return us=0,e.geo.stream(t,as),us};var us,as={sphere:M,point:M,lineStart:fs,lineEnd:M,polygonStart:M,polygonEnd:M},cs=ls(function(e){return Math.sqrt(2/(1+e))},function(e){return 2*Math.asin(e/2)});(e.geo.azimuthalEqualArea=function(){return Xi(cs)}).raw=cs;var hs=ls(function(e){var t=Math.acos(e);return t&&t/Math.sin(t)},xn);(e.geo.azimuthalEquidistant=function(){return Xi(hs)}).raw=hs,(e.geo.conicConformal=function(){return Ei(ps)}).raw=ps,(e.geo.conicEquidistant=function(){return Ei(ds)}).raw=ds;var vs=ls(function(e){return 1/e},Math.atan);(e.geo.gnomonic=function(){return Xi(vs)}).raw=vs,ms.invert=function(e,t){return[e,2*Math.atan(Math.exp(t))-xt]},(e.geo.mercator=function(){return gs(ms)}).raw=ms;var ys=ls(function(){return 1},Math.asin);(e.geo.orthographic=function(){return Xi(ys)}).raw=ys;var bs=ls(function(e){return 1/(1+e)},function(e){return 2*Math.atan(e)});(e.geo.stereographic=function(){return Xi(bs)}).raw=bs,ws.invert=function(e,t){return[-t,2*Math.atan(Math.exp(e))-xt]},(e.geo.transverseMercator=function(){var e=gs(ws),t=e.center,n=e.rotate;return e.center=function(e){return e?t([-e[1],e[0]]):(e=t(),[-e[1],e[0]])},e.rotate=function(e){return e?n([e[0],e[1],e.length>2?e[2]+90:90]):(e=n(),[e[0],e[1],e[2]-90])},e.rotate([0,0])}).raw=ws,e.geom={},e.geom.hull=function(e){function r(e){if(e.length<3)return[];var r=Sn(t),i=Sn(n),s,o=e.length,u=[],a=[];for(s=0;s<o;s++)u.push([+r.call(this,e[s],s),+i.call(this,e[s],s),s]);u.sort(Ts);for(s=0;s<o;s++)a.push([u[s][0],-u[s][1]]);var f=xs(u),l=xs(a),c=l[0]===f[0],h=l[l.length-1]===f[f.length-1],p=[];for(s=f.length-1;s>=0;--s)p.push(e[u[f[s]][2]]);for(s=+c;s<l.length-h;++s)p.push(e[u[l[s]][2]]);return p}var t=Es,n=Ss;return arguments.length?r(e):(r.x=function(e){return arguments.length?(t=e,r):t},r.y=function(e){return arguments.length?(n=e,r):n},r)},e.geom.polygon=function(e){return F(e,Ns),e};var Ns=e.geom.polygon.prototype=[];Ns.area=function(){var e=-1,t=this.length,n,r=this[t-1],i=0;while(++e<t)n=r,r=this[e],i+=n[1]*r[0]-n[0]*r[1];return i*.5},Ns.centroid=function(e){var t=-1,n=this.length,r=0,i=0,s,o=this[n-1],u;arguments.length||(e=-1/(6*this.area()));while(++t<n)s=o,o=this[t],u=s[0]*o[1]-o[0]*s[1],r+=(s[0]+o[0])*u,i+=(s[1]+o[1])*u;return[r*e,i*e]},Ns.clip=function(e){var t,n=Ls(e),r=-1,i=this.length-Ls(this),s,o,u=this[i-1],a,f,l;while(++r<i){t=e.slice(),e.length=0,a=this[r],f=t[(o=t.length-n)-1],s=-1;while(++s<o)l=t[s],Cs(l,u,a)?(Cs(f,u,a)||e.push(ks(f,l,u,a)),e.push(l)):Cs(f,u,a)&&e.push(ks(f,l,u,a)),f=l;n&&e.push(e[0]),u=a}return e};var As,Os,Ms,_s=[],Ds,Ps,Hs=[];zs.prototype.prepare=function(){var e=this.edges,t=e.length,n;while(t--)n=e[t].edge,(!n.b||!n.a)&&e.splice(t,1);return e.sort(Xs),e.length},to.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},no.prototype={insert:function(e,t){var n,r,i;if(e){t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t;if(e.R){e=e.R;while(e.L)e=e.L;e.L=t}else e.R=t;n=e}else this._?(e=oo(this._),t.P=null,t.N=e,e.P=e.L=t,n=e):(t.P=t.N=null,this._=t,n=null);t.L=t.R=null,t.U=n,t.C=!0,e=t;while(n&&n.C)r=n.U,n===r.L?(i=r.R,i&&i.C?(n.C=i.C=!1,r.C=!0,e=r):(e===n.R&&(io(this,n),e=n,n=e.U),n.C=!1,r.C=!0,so(this,r))):(i=r.L,i&&i.C?(n.C=i.C=!1,r.C=!0,e=r):(e===n.L&&(so(this,n),e=n,n=e.U),n.C=!1,r.C=!0,io(this,r))),n=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t=e.U,n,r=e.L,i=e.R,s,o;r?i?s=oo(i):s=r:s=i,t?t.L===e?t.L=s:t.R=s:this._=s,r&&i?(o=s.C,s.C=e.C,s.L=r,r.U=s,s!==i?(t=s.U,s.U=e.U,e=s.R,t.L=e,s.R=i,i.U=s):(s.U=t,t=s,e=s.R)):(o=e.C,e=s),e&&(e.U=t);if(o)return;if(e&&e.C){e.C=!1;return}do{if(e===this._)break;if(e===t.L){n=t.R,n.C&&(n.C=!1,t.C=!0,io(this,t),n=t.R);if(n.L&&n.L.C||n.R&&n.R.C){if(!n.R||!n.R.C)n.L.C=!1,n.C=!0,so(this,n),n=t.R;n.C=t.C,t.C=n.R.C=!1,io(this,t),e=this._;break}}else{n=t.L,n.C&&(n.C=!1,t.C=!0,so(this,t),n=t.L);if(n.L&&n.L.C||n.R&&n.R.C){if(!n.L||!n.L.C)n.R.C=!1,n.C=!0,io(this,n),n=t.L;n.C=t.C,t.C=n.L.C=!1,so(this,t),e=this._;break}}n.C=!0,e=t,t=t.U}while(!e.C);e&&(e.C=!1)}},e.geom.voronoi=function(e){function o(e){var t=new Array(e.length),n=s[0][0],r=s[0][1],i=s[1][0],o=s[1][1];return uo(u(e),s).cells.forEach(function(s,u){var a=s.edges,f=s.site,l=t[u]=a.length?a.map(function(e){var t=e.start();return[t.x,t.y]}):f.x>=n&&f.x<=i&&f.y>=r&&f.y<=o?[[n,o],[i,o],[i,r],[n,r]]:[];l.point=e[u]}),t}function u(e){return e.map(function(e,t){return{x:Math.round(r(e,t)/Tt)*Tt,y:Math.round(i(e,t)/Tt)*Tt,i:t}})}var t=Es,n=Ss,r=t,i=n,s=fo;return e?o(e):(o.links=function(e){return uo(u(e)).edges.filter(function(e){return e.l&&e.r}).map(function(t){return{source:e[t.l.i],target:e[t.r.i]}})},o.triangles=function(e){var t=[];return uo(u(e)).cells.forEach(function(n,r){var i=n.site,s=n.edges.sort(Xs),o=-1,u=s.length,a,f,l=s[u-1].edge,c=l.l===i?l.r:l.l;while(++o<u)a=l,f=c,l=s[o].edge,c=l.l===i?l.r:l.l,r<f.i&&r<c.i&&lo(i,f,c)<0&&t.push([e[r],e[f.i],e[c.i]])}),t},o.x=function(e){return arguments.length?(r=Sn(t=e),o):t},o.y=function(e){return arguments.length?(i=Sn(n=e),o):n},o.clipExtent=function(e){return arguments.length?(s=e==null?fo:e,o):s===fo?null:s},o.size=function(e){return arguments.length?o.clipExtent(e&&[[0,0],e]):s===fo?null:s&&s[1]},o)};var fo=[[-1e6,-1e6],[1e6,1e6]];e.geom.delaunay=function(t){return e.geom.voronoi().triangles(t)},e.geom.quadtree=function(e,t,n,r,i){function a(e){function T(e,t,n,r,i,s,o,u){if(isNaN(n)||isNaN(r))return;if(e.leaf){var a=e.x,f=e.y;if(a!=null)if(m(a-n)+m(f-r)<.01)N(e,t,n,r,i,s,o,u);else{var l=e.point;e.x=e.y=e.point=null,N(e,l,a,f,i,s,o,u),N(e,t,n,r,i,s,o,u)}else e.x=n,e.y=r,e.point=t}else N(e,t,n,r,i,s,o,u)}function N(e,t,n,r,i,s,o,u){var a=(i+o)*.5,f=(s+u)*.5,l=n>=a,c=r>=f,h=(c<<1)+l;e.leaf=!1,e=e.nodes[h]||(e.nodes[h]=po()),l?i=a:o=a,c?s=f:u=f,T(e,t,n,r,i,s,o,u)}var a,f=Sn(s),l=Sn(o),c,h,p,d,v,g,y,b;if(t!=null)v=t,g=n,y=r,b=i;else{y=b=-(v=g=Infinity),c=[],h=[],d=e.length;if(u)for(p=0;p<d;++p)a=e[p],a.x<v&&(v=a.x),a.y<g&&(g=a.y),a.x>y&&(y=a.x),a.y>b&&(b=a.y),c.push(a.x),h.push(a.y);else for(p=0;p<d;++p){var w=+f(a=e[p],p),E=+l(a,p);w<v&&(v=w),E<g&&(g=E),w>y&&(y=w),E>b&&(b=E),c.push(w),h.push(E)}}var S=y-v,x=b-g;S>x?b=g+S:y=v+x;var C=po();C.add=function(e){T(C,e,+f(e,++p),+l(e,p),v,g,y,b)},C.visit=function(e){vo(e,C,v,g,y,b)},p=-1;if(t==null){while(++p<d)T(C,e[p],c[p],h[p],v,g,y,b);--p}else e.forEach(C.add);return c=h=e=a=null,C}var s=Es,o=Ss,u;return(u=arguments.length)?(s=co,o=ho,u===3&&(i=n,r=t,n=t=0),a(e)):(a.x=function(e){return arguments.length?(s=e,a):s},a.y=function(e){return arguments.length?(o=e,a):o},a.extent=function(e){return arguments.length?(e==null?t=n=r=i=null:(t=+e[0][0],n=+e[0][1],r=+e[1][0],i=+e[1][1]),a):t==null?null:[[t,n],[r,i]]},a.size=function(e){return arguments.length?(e==null?t=n=r=i=null:(t=n=0,r=+e[0],i=+e[1]),a):t==null?null:[r-t,i-n]},a)},e.interpolateRgb=mo,e.interpolateObject=go,e.interpolateNumber=yo,e.interpolateString=bo;var wo=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g;e.interpolate=Eo,e.interpolators=[function(e,t){var n=typeof t;return(n==="string"?En.has(t)||/^(#|rgb\(|hsl\()/.test(t)?mo:bo:t instanceof Ut?mo:n==="object"?Array.isArray(t)?So:go:yo)(e,t)}],e.interpolateArray=So;var xo=function(){return xn},To=e.map({linear:xo,poly:_o,quad:function(){return Ao},cubic:function(){return Oo},sin:function(){return Do},exp:function(){return Po},circle:function(){return Ho},elastic:Bo,back:jo,bounce:function(){return Fo}}),No=e.map({"in":xn,out:ko,"in-out":Lo,"out-in":function(e){return Lo(ko(e))}});e.ease=function(e){var n=e.indexOf("-"),r=n>=0?e.substring(0,n):e,i=n>=0?e.substring(n+1):"in";return r=To.get(r)||xo,i=No.get(i)||xn,Co(i(r.apply(null,t.call(arguments,1))))},e.interpolateHcl=Io,e.interpolateHsl=qo,e.interpolateLab=Ro,e.interpolateRound=Uo,e.transform=function(t){var n=r.createElementNS(e.ns.prefix.svg,"g");return(e.transform=function(e){if(e!=null){n.setAttribute("transform",e);var t=n.transform.baseVal.consolidate()}return new zo(t?t.matrix:$o)})(t)},zo.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var $o={a:1,b:0,c:0,d:1,e:0,f:0};e.interpolateTransform=Jo,e.layout={},e.layout.bundle=function(){return function(e){var t=[],n=-1,r=e.length;while(++n<r)t.push(Go(e[n]));return t}},e.layout.chord=function(){function l(){var t={},l=[],h=e.range(s),p=[],d,v,m,g,y;n=[],r=[],d=0,g=-1;while(++g<s){v=0,y=-1;while(++y<s)v+=i[g][y];l.push(v),p.push(e.range(s)),d+=v}u&&h.sort(function(e,t){return u(l[e],l[t])}),a&&p.forEach(function(e,t){e.sort(function(e,n){return a(i[t][e],i[t][n])})}),d=(St-o*s)/d,v=0,g=-1;while(++g<s){m=v,y=-1;while(++y<s){var b=h[g],w=p[b][y],E=i[b][w],S=v,x=v+=E*d;t[b+"-"+w]={index:b,subindex:w,startAngle:S,endAngle:x,value:E}}r[b]={index:b,startAngle:m,endAngle:v,value:(v-m)/d},v+=o}g=-1;while(++g<s){y=g-1;while(++y<s){var T=t[g+"-"+y],N=t[y+"-"+g];(T.value||N.value)&&n.push(T.value<N.value?{source:N,target:T}:{source:T,target:N})}}f&&c()}function c(){n.sort(function(e,t){return f((e.source.value+e.target.value)/2,(t.source.value+t.target.value)/2)})}var t={},n,r,i,s,o=0,u,a,f;return t.matrix=function(e){return arguments.length?(s=(i=e)&&i.length,n=r=null,t):i},t.padding=function(e){return arguments.length?(o=e,n=r=null,t):o},t.sortGroups=function(e){return arguments.length?(u=e,n=r=null,t):u},t.sortSubgroups=function(e){return arguments.length?(a=e,n=null,t):a},t.sortChords=function(e){return arguments.length?(f=e,n&&c(),t):f},t.chords=function(){return n||l(),n},t.groups=function(){return r||l(),r},t},e.layout.force=function(){function y(e){return function(t,n,r,i){if(t.point!==e){var s=t.cx-e.x,o=t.cy-e.y,u=i-n,a=s*s+o*o;if(u*u/h<a){if(a<l){var f=t.charge/a;e.px-=s*f,e.py-=o*f}return!0}if(t.point&&a&&a<l){var f=t.pointCharge/a;e.px-=s*f,e.py-=o*f}}return!t.charge}}function b(n){n.px=e.event.x,n.py=e.event.y,t.resume()}var t={},n=e.dispatch("start","tick","end"),r=[1,1],i,s,o=.9,u=su,a=ou,f=-30,l=uu,c=.1,h=.64,p=[],d=[],v,m,g;return t.tick=function(){if((s*=.99)<.005)return n.end({type:"end",alpha:s=0}),!0;var t=p.length,i=d.length,u,a,l,h,b,w,E,S,x;for(a=0;a<i;++a){l=d[a],h=l.source,b=l.target,S=b.x-h.x,x=b.y-h.y;if(w=S*S+x*x)w=s*m[a]*((w=Math.sqrt(w))-v[a])/w,S*=w,x*=w,b.x-=S*(E=h.weight/(b.weight+h.weight)),b.y-=x*E,h.x+=S*(E=1-E),h.y+=x*E}if(E=s*c){S=r[0]/2,x=r[1]/2,a=-1;if(E)while(++a<t)l=p[a],l.x+=(S-l.x)*E,l.y+=(x-l.y)*E}if(f){iu(u=e.geom.quadtree(p),s,g),a=-1;while(++a<t)(l=p[a]).fixed||u.visit(y(l))}a=-1;while(++a<t)l=p[a],l.fixed?(l.x=l.px,l.y=l.py):(l.x-=(l.px-(l.px=l.x))*o,l.y-=(l.py-(l.py=l.y))*o);n.tick({type:"tick",alpha:s})},t.nodes=function(e){return arguments.length?(p=e,t):p},t.links=function(e){return arguments.length?(d=e,t):d},t.size=function(e){return arguments.length?(r=e,t):r},t.linkDistance=function(e){return arguments.length?(u=typeof e=="function"?e:+e,t):u},t.distance=t.linkDistance,t.linkStrength=function(e){return arguments.length?(a=typeof e=="function"?e:+e,t):a},t.friction=function(e){return arguments.length?(o=+e,t):o},t.charge=function(e){return arguments.length?(f=typeof e=="function"?e:+e,t):f},t.chargeDistance=function(e){return arguments.length?(l=e*e,t):Math.sqrt(l)},t.gravity=function(e){return arguments.length?(c=+e,t):c},t.theta=function(e){return arguments.length?(h=e*e,t):Math.sqrt(h)},t.alpha=function(r){return arguments.length?(r=+r,s?r>0?s=r:s=0:r>0&&(n.start({type:"start",alpha:s=r}),e.timer(t.tick)),t):s},t.start=function(){function h(t,r){if(!l){l=new Array(n);for(o=0;o<n;++o)l[o]=[];for(o=0;o<u;++o){var i=d[o];l[i.source.index].push(i.target),l[i.target.index].push(i.source)}}var s=l[e],o=-1,u=s.length,a;while(++o<u)if(!isNaN(a=s[o][t]))return a;return Math.random()*r}var e,n=p.length,i=d.length,s=r[0],o=r[1],l,c;for(e=0;e<n;++e)(c=p[e]).index=e,c.weight=0;for(e=0;e<i;++e)c=d[e],typeof c.source=="number"&&(c.source=p[c.source]),typeof c.target=="number"&&(c.target=p[c.target]),++c.source.weight,++c.target.weight;for(e=0;e<n;++e)c=p[e],isNaN(c.x)&&(c.x=h("x",s)),isNaN(c.y)&&(c.y=h("y",o)),isNaN(c.px)&&(c.px=c.x),isNaN(c.py)&&(c.py=c.y);v=[];if(typeof u=="function")for(e=0;e<i;++e)v[e]=+u.call(this,d[e],e);else for(e=0;e<i;++e)v[e]=u;m=[];if(typeof a=="function")for(e=0;e<i;++e)m[e]=+a.call(this,d[e],e);else for(e=0;e<i;++e)m[e]=a;g=[];if(typeof f=="function")for(e=0;e<n;++e)g[e]=+f.call(this,p[e],e);else for(e=0;e<n;++e)g[e]=f;return t.resume()},t.resume=function(){return t.alpha(.1)},t.stop=function(){return t.alpha(0)},t.drag=function(){i||(i=e.behavior.drag().origin(xn).on("dragstart.force",eu).on("drag.force",b).on("dragend.force",tu));if(!arguments.length)return i;this.on("mouseover.force",nu).on("mouseout.force",ru).call(i)},e.rebind(t,n,"on")};var su=20,ou=1,uu=Infinity;e.layout.hierarchy=function(){function r(i,o,u){var a=t.call(s,i,o);i.depth=o,u.push(i);if(a&&(l=a.length)){var f=-1,l,c=i.children=new Array(l),h=0,p=o+1,d;while(++f<l)d=c[f]=r(a[f],p,u),d.parent=i,h+=d.value;e&&c.sort(e),n&&(i.value=h)}else delete i.children,n&&(i.value=+n.call(s,i,o)||0);return i}function i(e,t){var r=e.children,o=0;if(r&&(a=r.length)){var u=-1,a,f=t+1;while(++u<a)o+=i(r[u],f)}else n&&(o=+n.call(s,e,t)||0);return n&&(e.value=o),o}function s(e){var t=[];return r(e,0,t),t}var e=cu,t=fu,n=lu;return s.sort=function(t){return arguments.length?(e=t,s):e},s.children=function(e){return arguments.length?(t=e,s):t},s.value=function(e){return arguments.length?(n=e,s):n},s.revalue=function(e){return i(e,0),e},s},e.layout.partition=function(){function r(e,t,n,i){var s=e.children;e.x=t,e.y=e.depth*i,e.dx=n,e.dy=i;if(s&&(u=s.length)){var o=-1,u,a,f;n=e.value?n/e.value:0;while(++o<u)r(a=s[o],t,f=a.value*n,i),t+=f}}function i(e){var t=e.children,n=0;if(t&&(s=t.length)){var r=-1,s;while(++r<s)n=Math.max(n,i(t[r]))}return 1+n}function s(e,s){var o=t.call(this,e,s);return r(o[0],0,n[0],n[1]/i(o[0])),o}var t=e.layout.hierarchy(),n=[1,1];return s.size=function(e){return arguments.length?(n=e,s):n},au(s,t)},e.layout.pie=function(){function s(o){var u=o.map(function(e,n){return+t.call(s,e,n)}),a=+(typeof r=="function"?r.apply(this,arguments):r),f=((typeof i=="function"?i.apply(this,arguments):i)-a)/e.sum(u),l=e.range(o.length);n!=null&&l.sort(n===pu?function(e,t){return u[t]-u[e]}:function(e,t){return n(o[e],o[t])});var c=[];return l.forEach(function(e){var t;c[e]={data:o[e],value:t=u[e],startAngle:a,endAngle:a+=t*f}}),c}var t=Number,n=pu,r=0,i=St;return s.value=function(e){return arguments.length?(t=e,s):t},s.sort=function(e){return arguments.length?(n=e,s):n},s.startAngle=function(e){return arguments.length?(r=e,s):r},s.endAngle=function(e){return arguments.length?(i=e,s):i},s};var pu={};e.layout.stack=function(){function u(a,f){var l=a.map(function(e,n){return t.call(u,e,n)}),c=l.map(function(e){return e.map(function(e,t){return[s.call(u,e,t),o.call(u,e,t)]})}),h=n.call(u,c,f);l=e.permute(l,h),c=e.permute(c,h);var p=r.call(u,c,f),d=l.length,v=l[0].length,m,g,y;for(g=0;g<v;++g){i.call(u,l[0][g],y=p[g],c[0][g][1]);for(m=1;m<d;++m)i.call(u,l[m][g],y+=c[m-1][g][1],c[m][g][1])}return a}var t=xn,n=bu,r=wu,i=mu,s=du,o=vu;return u.values=function(e){return arguments.length?(t=e,u):t},u.order=function(e){return arguments.length?(n=typeof e=="function"?e:gu.get(e)||bu,u):n},u.offset=function(e){return arguments.length?(r=typeof e=="function"?e:yu.get(e)||wu,u):r},u.x=function(e){return arguments.length?(s=e,u):s},u.y=function(e){return arguments.length?(o=e,u):o},u.out=function(e){return arguments.length?(i=e,u):i},u};var gu=e.map({"inside-out":function(t){var n=t.length,r,i,s=t.map(Eu),o=t.map(Su),u=e.range(n).sort(function(e,t){return s[e]-s[t]}),a=0,f=0,l=[],c=[];for(r=0;r<n;++r)i=u[r],a<f?(a+=o[i],l.push(i)):(f+=o[i],c.push(i));return c.reverse().concat(l)},reverse:function(t){return e.range(t.length).reverse()},"default":bu}),yu=e.map({silhouette:function(e){var t=e.length,n=e[0].length,r=[],i=0,s,o,u,a=[];for(o=0;o<n;++o){for(s=0,u=0;s<t;s++)u+=e[s][o][1];u>i&&(i=u),r.push(u)}for(o=0;o<n;++o)a[o]=(i-r[o])/2;return a},wiggle:function(e){var t=e.length,n=e[0],r=n.length,i,s,o,u,a,f,l,c,h,p=[];p[0]=c=h=0;for(s=1;s<r;++s){for(i=0,u=0;i<t;++i)u+=e[i][s][1];for(i=0,a=0,l=n[s][0]-n[s-1][0];i<t;++i){for(o=0,f=(e[i][s][1]-e[i][s-1][1])/(2*l);o<i;++o)f+=(e[o][s][1]-e[o][s-1][1])/l;a+=f*e[i][s][1]}p[s]=c-=u?a/u*l:0,c<h&&(h=c)}for(s=0;s<r;++s)p[s]-=h;return p},expand:function(e){var t=e.length,n=e[0].length,r=1/t,i,s,o,u=[];for(s=0;s<n;++s){for(i=0,o=0;i<t;i++)o+=e[i][s][1];if(o)for(i=0;i<t;i++)e[i][s][1]/=o;else for(i=0;i<t;i++)e[i][s][1]=r}for(s=0;s<n;++s)u[s]=0;return u},zero:wu});e.layout.histogram=function(){function s(s,o){var u=[],a=s.map(n,this),f=r.call(this,a,o),l=i.call(this,f,a,o),c,o=-1,h=a.length,p=l.length-1,d=t?1:1/h,v;while(++o<p)c=u[o]=[],c.dx=l[o+1]-(c.x=l[o]),c.y=0;if(p>0){o=-1;while(++o<h)v=a[o],v>=f[0]&&v<=f[1]&&(c=u[e.bisect(l,v,1,p)-1],c.y+=d,c.push(s[o]))}return u}var t=!0,n=Number,r=Cu,i=Tu;return s.value=function(e){return arguments.length?(n=e,s):n},s.range=function(e){return arguments.length?(r=Sn(e),s):r},s.bins=function(e){return arguments.length?(i=typeof e=="number"?function(t){return Nu(t,e)}:Sn(e),s):i},s.frequency=function(e){return arguments.length?(t=!!e,s):t},s},e.layout.tree=function(){function s(e,s){function a(e,t){var r=e.children,i=e._tree;if(r&&(s=r.length)){var s,o=r[0],u,f=o,c,h=-1;while(++h<s)c=r[h],a(c,u),f=l(c,u,f),u=c;Hu(e);var p=.5*(o._tree.prelim+c._tree.prelim);t?(i.prelim=t._tree.prelim+n(e,t),i.mod=i.prelim-p):i.prelim=p}else t&&(i.prelim=t._tree.prelim+n(e,t))}function f(e,t){e.x=e._tree.prelim+t;var n=e.children;if(n&&(i=n.length)){var r=-1,i;t+=e._tree.mod;while(++r<i)f(n[r],t)}}function l(e,t,r){if(t){var i=e,s=e,o=t,u=e.parent.children[0],a=i._tree.mod,f=s._tree.mod,l=o._tree.mod,c=u._tree.mod,h;while(o=Au(o),i=Lu(i),o&&i)u=Lu(u),s=Au(s),s._tree.ancestor=e,h=o._tree.prelim+l-i._tree.prelim-a+n(o,i),h>0&&(Bu(ju(o,e,r),e,h),a+=h,f+=h),l+=o._tree.mod,a+=i._tree.mod,c+=u._tree.mod,f+=s._tree.mod;o&&!Au(s)&&(s._tree.thread=o,s._tree.mod+=l-f),i&&!Lu(u)&&(u._tree.thread=i,u._tree.mod+=a-c,r=e)}return r}var o=t.call(this,e,s),u=o[0];Pu(u,function(e,t){e._tree={ancestor:e,prelim:0,mod:0,change:0,shift:0,number:t?t._tree.number+1:0}}),a(u),f(u,-u._tree.prelim);var c=Ou(u,_u),h=Ou(u,Mu),p=Ou(u,Du),d=c.x-n(c,h)/2,v=h.x+n(h,c)/2,m=p.depth||1;return Pu(u,i?function(e){e.x*=r[0],e.y=e.depth*r[1],delete e._tree}:function(e){e.x=(e.x-d)/(v-d)*r[0],e.y=e.depth/m*r[1],delete e._tree}),o}var t=e.layout.hierarchy().sort(null).value(null),n=ku,r=[1,1],i=!1;return s.separation=function(e){return arguments.length?(n=e,s):n},s.size=function(e){return arguments.length?(i=(r=e)==null,s):i?null:r},s.nodeSize=function(e){return arguments.length?(i=(r=e)!=null,s):i?r:null},au(s,t)},e.layout.pack=function(){function s(e,s){var o=t.call(this,e,s),u=o[0],a=r[0],f=r[1],l=i==null?Math.sqrt:typeof i=="function"?i:function(){return i};u.x=u.y=0,Pu(u,function(e){e.r=+l(e.value)}),Pu(u,Uu);if(n){var c=n*(i?1:Math.max(2*u.r/a,2*u.r/f))/2;Pu(u,function(e){e.r+=c}),Pu(u,Uu),Pu(u,function(e){e.r-=c})}return Xu(u,a/2,f/2,i?1:1/Math.max(2*u.r/a,2*u.r/f)),o}var t=e.layout.hierarchy().sort(Fu),n=0,r=[1,1],i;return s.size=function(e){return arguments.length?(r=e,s):r},s.radius=function(e){return arguments.length?(i=e==null||typeof e=="function"?e:+e,s):i},s.padding=function(e){return arguments.length?(n=+e,s):n},au(s,t)},e.layout.cluster=function(){function s(e,s){var o=t.call(this,e,s),u=o[0],a,f=0;Pu(u,function(e){var t=e.children;t&&t.length?(e.x=Ju(t),e.y=$u(t)):(e.x=a?f+=n(e,a):0,e.y=0,a=e)});var l=Ku(u),c=Qu(u),h=l.x-n(l,c)/2,p=c.x+n(c,l)/2;return Pu(u,i?function(e){e.x=(e.x-u.x)*r[0],e.y=(u.y-e.y)*r[1]}:function(e){e.x=(e.x-h)/(p-h)*r[0],e.y=(1-(u.y?e.y/u.y:1))*r[1]}),o}var t=e.layout.hierarchy().sort(null).value(null),n=ku,r=[1,1],i=!1;return s.separation=function(e){return arguments.length?(n=e,s):n},s.size=function(e){return arguments.length?(i=(r=e)==null,s):i?null:r},s.nodeSize=function(e){return arguments.length?(i=(r=e)!=null,s):i?r:null},au(s,t)},e.layout.treemap=function(){function l(e,t){var n=-1,r=e.length,i,s;while(++n<r)s=(i=e[n]).value*(t<0?0:t),i.area=isNaN(s)||s<=0?0:s}function c(e){var t=e.children;if(t&&t.length){var n=s(e),r=[],i=t.slice(),o,u=Infinity,f,h=a==="slice"?n.dx:a==="dice"?n.dy:a==="slice-dice"?e.depth&1?n.dy:n.dx:Math.min(n.dx,n.dy),v;l(i,n.dx*n.dy/e.value),r.area=0;while((v=i.length)>0)r.push(o=i[v-1]),r.area+=o.area,a!=="squarify"||(f=p(r,h))<=u?(i.pop(),u=f):(r.area-=r.pop().area,d(r,h,n,!1),h=Math.min(n.dx,n.dy),r.length=r.area=0,u=Infinity);r.length&&(d(r,h,n,!0),r.length=r.area=0),t.forEach(c)}}function h(e){var t=e.children;if(t&&t.length){var n=s(e),r=t.slice(),i,o=[];l(r,n.dx*n.dy/e.value),o.area=0;while(i=r.pop())o.push(i),o.area+=i.area,i.z!=null&&(d(o,i.z?n.dx:n.dy,n,!r.length),o.length=o.area=0);t.forEach(h)}}function p(e,t){var n=e.area,r,i=0,s=Infinity,o=-1,u=e.length;while(++o<u){if(!(r=e[o].area))continue;r<s&&(s=r),r>i&&(i=r)}return n*=n,t*=t,n?Math.max(t*i*f/n,n/(t*s*f)):Infinity}function d(e,t,r,i){var s=-1,o=e.length,u=r.x,a=r.y,f=t?n(e.area/t):0,l;if(t==r.dx){if(i||f>r.dy)f=r.dy;while(++s<o)l=e[s],l.x=u,l.y=a,l.dy=f,u+=l.dx=Math.min(r.x+r.dx-u,f?n(l.area/f):0);l.z=!0,l.dx+=r.x+r.dx-u,r.y+=f,r.dy-=f}else{if(i||f>r.dx)f=r.dx;while(++s<o)l=e[s],l.x=u,l.y=a,l.dx=f,a+=l.dy=Math.min(r.y+r.dy-a,f?n(l.area/f):0);l.z=!1,l.dy+=r.y+r.dy-a,r.x+=f,r.dx-=f}}function v(e){var n=u||t(e),i=n[0];return i.x=0,i.y=0,i.dx=r[0],i.dy=r[1],u&&t.revalue(i),l([i],i.dx*i.dy/i.value),(u?h:c)(i),o&&(u=n),n}var t=e.layout.hierarchy(),n=Math.round,r=[1,1],i=null,s=Gu,o=!1,u,a="squarify",f=.5*(1+Math.sqrt(5));return v.size=function(e){return arguments.length?(r=e,v):r},v.padding=function(e){function t(t){var n=e.call(v,t,t.depth);return n==null?Gu(t):Yu(t,typeof n=="number"?[n,n,n,n]:n)}function n(t){return Yu(t,e)}if(!arguments.length)return i;var r;return s=(i=e)==null?Gu:(r=typeof e)==="function"?t:r==="number"?(e=[e,e,e,e],n):n,v},v.round=function(e){return arguments.length?(n=e?Math.round:Number,v):n!=Number},v.sticky=function(e){return arguments.length?(o=e,u=null,v):o},v.ratio=function(e){return arguments.length?(f=e,v):f},v.mode=function(e){return arguments.length?(a=e+"",v):a},au(v,t)},e.random={normal:function(e,t){var n=arguments.length;return n<2&&(t=1),n<1&&(e=0),function(){var n,r,i;do n=Math.random()*2-1,r=Math.random()*2-1,i=n*n+r*r;while(!i||i>1);return e+t*n*Math.sqrt(-2*Math.log(i)/i)}},logNormal:function(){var t=e.random.normal.apply(e,arguments);return function(){return Math.exp(t())}},bates:function(t){var n=e.random.irwinHall(t);return function(){return n()/t}},irwinHall:function(e){return function(){for(var t=0,n=0;n<e;n++)t+=Math.random();return t}}},e.scale={};var ia={floor:xn,ceil:xn};e.scale.linear=function(){return oa([0,1],[0,1],Eo,!1)};var ha={s:1,g:1,p:1,r:1,e:1};e.scale.log=function(){return va(e.scale.linear().domain([0,1]),10,!0,[1,10])};var ma=e.format(".0e"),ga={floor:function(e){return-Math.ceil(-e)},ceil:function(e){return-Math.floor(-e)}};e.scale.pow=function(){return ya(e.scale.linear(),1,[0,1])},e.scale.sqrt=function(){return e.scale.pow().exponent(.5)},e.scale.ordinal=function(){return wa([],{t:"range",a:[[]]})},e.scale.category10=function(){return e.scale.ordinal().range(Ea)},e.scale.category20=function(){return e.scale.ordinal().range(Sa)},e.scale.category20b=function(){return e.scale.ordinal().range(xa)},e.scale.category20c=function(){return e.scale.ordinal().range(Ta)};var Ea=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(cn),Sa=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(cn),xa=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(cn),Ta=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(cn);e.scale.quantile=function(){return Na([],[])},e.scale.quantize=function(){return Ca(0,1,[0,1])},e.scale.threshold=function(){return ka([.5],[0,1])},e.scale.identity=function(){return La([0,1])},e.svg={},e.svg.arc=function(){function i(){var i=e.apply(this,arguments),s=t.apply(this,arguments),o=n.apply(this,arguments)+Aa,u=r.apply(this,arguments)+Aa,a=(u<o&&(a=o,o=u,u=a),u-o),f=a<Et?"0":"1",l=Math.cos(o),c=Math.sin(o),h=Math.cos(u),p=Math.sin(u);return a>=Oa?i?"M0,"+s+"A"+s+","+s+" 0 1,1 0,"+ -s+"A"+s+","+s+" 0 1,1 0,"+s+"M0,"+i+"A"+i+","+i+" 0 1,0 0,"+ -i+"A"+i+","+i+" 0 1,0 0,"+i+"Z":"M0,"+s+"A"+s+","+s+" 0 1,1 0,"+ -s+"A"+s+","+s+" 0 1,1 0,"+s+"Z":i?"M"+s*l+","+s*c+"A"+s+","+s+" 0 "+f+",1 "+s*h+","+s*p+"L"+i*h+","+i*p+"A"+i+","+i+" 0 "+f+",0 "+i*l+","+i*c+"Z":"M"+s*l+","+s*c+"A"+s+","+s+" 0 "+f+",1 "+s*h+","+s*p+"L0,0"+"Z"}var e=Ma,t=_a,n=Da,r=Pa;return i.innerRadius=function(t){return arguments.length?(e=Sn(t),i):e},i.outerRadius=function(e){return arguments.length?(t=Sn(e),i):t},i.startAngle=function(e){return arguments.length?(n=Sn(e),i):n},i.endAngle=function(e){return arguments.length?(r=Sn(e),i):r},i.centroid=function(){var i=(e.apply(this,arguments)+t.apply(this,arguments))/2,s=(n.apply(this,arguments)+r.apply(this,arguments))/2+Aa;return[Math.cos(s)*i,Math.sin(s)*i]},i};var Aa=-xt,Oa=St-Tt;e.svg.line=function(){return Ha(xn)};var Ba=e.map({linear:ja,"linear-closed":Fa,step:Ia,"step-before":qa,"step-after":Ra,basis:$a,"basis-open":Ja,"basis-closed":Ka,bundle:Qa,cardinal:Wa,"cardinal-open":Ua,"cardinal-closed":za,monotone:of});Ba.forEach(function(e,t){t.key=e,t.closed=/-closed$/.test(e)});var Ya=[0,2/3,1/3,0],Za=[0,1/3,2/3,0],ef=[0,1/6,2/3,1/6];e.svg.line.radial=function(){var e=Ha(uf);return e.radius=e.x,delete e.x,e.angle=e.y,delete e.y,e},qa.reverse=Ra,Ra.reverse=qa,e.svg.area=function(){return af(xn)},e.svg.area.radial=function(){var e=af(uf);return e.radius=e.x,delete e.x,e.innerRadius=e.x0,delete e.x0,e.outerRadius=e.x1,delete e.x1,e.angle=e.y,delete e.y,e.startAngle=e.y0,delete e.y0,e.endAngle=e.y1,delete e.y1,e},e.svg.chord=function(){function s(n,r){var i=o(this,e,n,r),s=o(this,t,n,r);return"M"+i.p0+a(i.r,i.p1,i.a1-i.a0)+(u(i,s)?f(i.r,i.p1,i.r,i.p0):f(i.r,i.p1,s.r,s.p0)+a(s.r,s.p1,s.a1-s.a0)+f(s.r,s.p1,i.r,i.p0))+"Z"}function o(e,t,s,o){var u=t.call(e,s,o),a=n.call(e,u,o),f=r.call(e,u,o)+Aa,l=i.call(e,u,o)+Aa;return{r:a,a0:f,a1:l,p0:[a*Math.cos(f),a*Math.sin(f)],p1:[a*Math.cos(l),a*Math.sin(l)]}}function u(e,t){return e.a0==t.a0&&e.a1==t.a1}function a(e,t,n){return"A"+e+","+e+" 0 "+ +(n>Et)+",1 "+t}function f(e,t,n,r){return"Q 0,0 "+r}var e=is,t=ss,n=ff,r=Da,i=Pa;return s.radius=function(e){return arguments.length?(n=Sn(e),s):n},s.source=function(t){return arguments.length?(e=Sn(t),s):e},s.target=function(e){return arguments.length?(t=Sn(e),s):t},s.startAngle=function(e){return arguments.length?(r=Sn(e),s):r},s.endAngle=function(e){return arguments.length?(i=Sn(e),s):i},s},e.svg.diagonal=function(){function r(r,i){var s=e.call(this,r,i),o=t.call(this,r,i),u=(s.y+o.y)/2,a=[s,{x:s.x,y:u},{x:o.x,y:u},o];return a=a.map(n),"M"+a[0]+"C"+a[1]+" "+a[2]+" "+a[3]}var e=is,t=ss,n=lf;return r.source=function(t){return arguments.length?(e=Sn(t),r):e},r.target=function(e){return arguments.length?(t=Sn(e),r):t},r.projection=function(e){return arguments.length?(n=e,r):n},r},e.svg.diagonal.radial=function(){var t=e.svg.diagonal(),n=lf,r=t.projection;return t.projection=function(e){return arguments.length?r(cf(n=e)):n},t},e.svg.symbol=function(){function n(n,r){return(vf.get(e.call(this,n,r))||df)(t.call(this,n,r))}var e=pf,t=hf;return n.type=function(t){return arguments.length?(e=Sn(t),n):e},n.size=function(e){return arguments.length?(t=Sn(e),n):t},n};var vf=e.map({circle:df,cross:function(e){var t=Math.sqrt(e/5)/2;return"M"+ -3*t+","+ -t+"H"+ -t+"V"+ -3*t+"H"+t+"V"+ -t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+ -t+"V"+t+"H"+ -3*t+"Z"},diamond:function(e){var t=Math.sqrt(e/(2*gf)),n=t*gf;return"M0,"+ -t+"L"+n+",0"+" 0,"+t+" "+ -n+",0"+"Z"},square:function(e){var t=Math.sqrt(e)/2;return"M"+ -t+","+ -t+"L"+t+","+ -t+" "+t+","+t+" "+ -t+","+t+"Z"},"triangle-down":function(e){var t=Math.sqrt(e/mf),n=t*mf/2;return"M0,"+n+"L"+t+","+ -n+" "+ -t+","+ -n+"Z"},"triangle-up":function(e){var t=Math.sqrt(e/mf),n=t*mf/2;return"M0,"+ -n+"L"+t+","+n+" "+ -t+","+n+"Z"}});e.svg.symbolTypes=vf.keys();var mf=Math.sqrt(3),gf=Math.tan(30*Ct),bf=[],wf=0,Ef,Sf;bf.call=W.call,bf.empty=W.empty,bf.node=W.node,bf.size=W.size,e.transition=function(e){return arguments.length?Ef?e.transition():e:ct.transition()},e.transition.prototype=bf,bf.select=function(e){var t=this.id,n=[],r,i,s;e=X(e);for(var o=-1,u=this.length;++o<u;){n.push(r=[]);for(var a=this[o],f=-1,l=a.length;++f<l;)(s=a[f])&&(i=e.call(s,s.__data__,f,o))?("__data__"in s&&(i.__data__=s.__data__),Nf(i,f,t,s.__transition__[t]),r.push(i)):r.push(null)}return yf(n,t)},bf.selectAll=function(e){var t=this.id,n=[],r,i,s,o,u;e=V(e);for(var a=-1,f=this.length;++a<f;)for(var l=this[a],c=-1,h=l.length;++c<h;)if(s=l[c]){u=s.__transition__[t],i=e.call(s,s.__data__,c,a),n.push(r=[]);for(var p=-1,d=i.length;++p<d;)(o=i[p])&&Nf(o,p,t,u),r.push(o)}return yf(n,t)},bf.filter=function(e){var t=[],n,r,i;typeof e!="function"&&(e=it(e));for(var s=0,o=this.length;s<o;s++){t.push(n=[]);for(var r=this[s],u=0,a=r.length;u<a;u++)(i=r[u])&&e.call(i,i.__data__,u,s)&&n.push(i)}return yf(t,this.id)},bf.tween=function(e,t){var n=this.id;return arguments.length<2?this.node().__transition__[n].tween.get(e):ot(this,t==null?function(t){t.__transition__[n].tween.remove(e)}:function(r){r.__transition__[n].tween.set(e,t)})},bf.attr=function(t,n){function s(){this.removeAttribute(i)}function o(){this.removeAttributeNS(i.space,i.local)}function u(e){return e==null?s:(e+="",function(){var t=this.getAttribute(i),n;return t!==e&&(n=r(t,e),function(e){this.setAttribute(i,n(e))})})}function a(e){return e==null?o:(e+="",function(){var t=this.getAttributeNS(i.space,i.local),n;return t!==e&&(n=r(t,e),function(e){this.setAttributeNS(i.space,i.local,n(e))})})}if(arguments.length<2){for(n in t)this.attr(n,t[n]);return this}var r=t=="transform"?Jo:Eo,i=e.ns.qualify(t);return xf(this,"attr."+t,n,i.local?a:u)},bf.attrTween=function(t,n){function i(e,t){var i=n.call(this,e,t,this.getAttribute(r));return i&&function(e){this.setAttribute(r,i(e))}}function s(e,t){var i=n.call(this,e,t,this.getAttributeNS(r.space,r.local));return i&&function(e){this.setAttributeNS(r.space,r.local,i(e))}}var r=e.ns.qualify(t);return this.tween("attr."+t,r.local?s:i)},bf.style=function(e,t,n){function i(){this.style.removeProperty(e)}function o(t){return t==null?i:(t+="",function(){var r=s.getComputedStyle(this,null).getPropertyValue(e),i;return r!==t&&(i=Eo(r,t),function(t){this.style.setProperty(e,i(t),n)})})}var r=arguments.length;if(r<3){if(typeof e!="string"){r<2&&(t="");for(n in e)this.style(n,e[n],t);return this}n=""}return xf(this,"style."+e,t,o)},bf.styleTween=function(e,t,n){function r(r,i){var o=t.call(this,r,i,s.getComputedStyle(this,null).getPropertyValue(e));return o&&function(t){this.style.setProperty(e,o(t),n)}}return arguments.length<3&&(n=""),this.tween("style."+e,r)},bf.text=function(e){return xf(this,"text",e,Tf)},bf.remove=function(){return this.each("end.transition",function(){var e;this.__transition__.count<2&&(e=this.parentNode)&&e.removeChild(this)})},bf.ease=function(t){var n=this.id;return arguments.length<1?this.node().__transition__[n].ease:(typeof t!="function"&&(t=e.ease.apply(e,arguments)),ot(this,function(e){e.__transition__[n].ease=t}))},bf.delay=function(e){var t=this.id;return ot(this,typeof e=="function"?function(n,r,i){n.__transition__[t].delay=+e.call(n,n.__data__,r,i)}:(e=+e,function(n){n.__transition__[t].delay=e}))},bf.duration=function(e){var t=this.id;return ot(this,typeof e=="function"?function(n,r,i){n.__transition__[t].duration=Math.max(1,e.call(n,n.__data__,r,i))}:(e=Math.max(1,e),function(n){n.__transition__[t].duration=e}))},bf.each=function(t,n){var r=this.id;if(arguments.length<2){var i=Sf,s=Ef;Ef=r,ot(this,function(e,n,i){Sf=e.__transition__[r],t.call(e,e.__data__,n,i)}),Sf=i,Ef=s}else ot(this,function(i){var s=i.__transition__[r];(s.event||(s.event=e.dispatch("start","end"))).on(t,n)});return this},bf.transition=function(){var e=this.id,t=++wf,n=[],r,i,s,o;for(var u=0,a=this.length;u<a;u++){n.push(r=[]);for(var i=this[u],f=0,l=i.length;f<l;f++){if(s=i[f])o=Object.create(s.__transition__[e]),o.delay+=o.duration,Nf(s,f,t,o);r.push(s)}}return yf(n,t)},e.svg.axis=function(){function f(f){f.each(function(){var f=e.select(this),l=this.__chart__||t,c=this.__chart__=t.copy(),h=u==null?c.ticks?c.ticks.apply(c,o):c.domain():u,p=a==null?c.tickFormat?c.tickFormat.apply(c,o):xn:a,d=f.selectAll(".tick").data(h,c),v=d.enter().insert("g",".domain").attr("class","tick").style("opacity",Tt),m=e.transition(d.exit()).style("opacity",Tt).remove(),g=e.transition(d).style("opacity",1),y,b=ea(c),w=f.selectAll(".domain").data([0]),E=(w.enter().append("path").attr("class","domain"),e.transition(w));v.append("line"),v.append("text");var S=v.select("line"),x=g.select("line"),T=d.select("text").text(p),N=v.select("text"),C=g.select("text");switch(n){case"bottom":y=Lf,S.attr("y2",r),N.attr("y",Math.max(r,0)+s),x.attr("x2",0).attr("y2",r),C.attr("x",0).attr("y",Math.max(r,0)+s),T.attr("dy",".71em").style("text-anchor","middle"),E.attr("d","M"+b[0]+","+i+"V0H"+b[1]+"V"+i);break;case"top":y=Lf,S.attr("y2",-r),N.attr("y",-(Math.max(r,0)+s)),x.attr("x2",0).attr("y2",-r),C.attr("x",0).attr("y",-(Math.max(r,0)+s)),T.attr("dy","0em").style("text-anchor","middle"),E.attr("d","M"+b[0]+","+ -i+"V0H"+b[1]+"V"+ -i);break;case"left":y=Af,S.attr("x2",-r),N.attr("x",-(Math.max(r,0)+s)),x.attr("x2",-r).attr("y2",0),C.attr("x",-(Math.max(r,0)+s)).attr("y",0),T.attr("dy",".32em").style("text-anchor","end"),E.attr("d","M"+ -i+","+b[0]+"H0V"+b[1]+"H"+ -i);break;case"right":y=Af,S.attr("x2",r),N.attr("x",Math.max(r,0)+s),x.attr("x2",r).attr("y2",0),C.attr("x",Math.max(r,0)+s).attr("y",0),T.attr("dy",".32em").style("text-anchor","start"),E.attr("d","M"+i+","+b[0]+"H0V"+b[1]+"H"+i)}if(c.rangeBand){var k=c,L=k.rangeBand()/2;l=c=function(e){return k(e)+L}}else l.rangeBand?l=c:m.call(y,c);v.call(y,l),g.call(y,c)})}var t=e.scale.linear(),n=Cf,r=6,i=6,s=3,o=[10],u=null,a;return f.scale=function(e){return arguments.length?(t=e,f):t},f.orient=function(e){return arguments.length?(n=e in kf?e+"":Cf,f):n},f.ticks=function(){return arguments.length?(o=arguments,f):o},f.tickValues=function(e){return arguments.length?(u=e,f):u},f.tickFormat=function(e){return arguments.length?(a=e,f):a},f.tickSize=function(e){var t=arguments.length;return t?(r=+e,i=+arguments[t-1],f):r},f.innerTickSize=function(e){return arguments.length?(r=+e,f):r},f.outerTickSize=function(e){return arguments.length?(i=+e,f):i},f.tickPadding=function(e){return arguments.length?(s=+e,f):s},f.tickSubdivide=function(){return arguments.length&&f},f};var Cf="bottom",kf={top:1,right:1,bottom:1,left:1};e.svg.brush=function(){function h(t){t.each(function(){var t=e.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",m).on("touchstart.brush",m),i=t.selectAll(".background").data([0]);i.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),t.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var s=t.selectAll(".resize").data(c,xn);s.exit().remove(),s.enter().append("g").attr("class",function(e){return"resize "+e}).style("cursor",function(e){return Of[e]}).append("rect").attr("x",function(e){return/[ew]$/.test(e)?-3:null}).attr("y",function(e){return/^[ns]/.test(e)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),s.style("display",h.empty()?"none":null);var o=e.transition(t),u=e.transition(i),a;n&&(a=ea(n),u.attr("x",a[0]).attr("width",a[1]-a[0]),d(o)),r&&(a=ea(r),u.attr("y",a[0]).attr("height",a[1]-a[0]),v(o)),p(o)})}function p(e){e.selectAll(".resize").attr("transform",function(e){return"translate("+i[+/e$/.test(e)]+","+o[+/^s/.test(e)]+")"})}function d(e){e.select(".extent").attr("x",i[0]),e.selectAll(".extent,.n>rect,.s>rect").attr("width",i[1]-i[0])}function v(e){e.select(".extent").attr("y",o[0]),e.selectAll(".extent,.e>rect,.w>rect").attr("height",o[1]-o[0])}function m(){function O(){e.event.keyCode==32&&(S||(T=null,N[0]-=i[1],N[1]-=o[1],S=2),P())}function M(){e.event.keyCode==32&&S==2&&(N[0]+=i[1],N[1]+=o[1],S=0,P())}function _(){var t=e.mouse(c),s=!1;C&&(t[0]+=C[0],t[1]+=C[1]),S||(e.event.altKey?(T||(T=[(i[0]+i[1])/2,(o[0]+o[1])/2]),N[0]=i[+(t[0]<T[0])],N[1]=o[+(t[1]<T[1])]):T=null),w&&D(t,n,0)&&(d(y),s=!0),E&&D(t,r,1)&&(v(y),s=!0),s&&(p(y),g({type:"brush",mode:S?"move":"resize"}))}function D(e,t,n){var r=ea(t),s=r[0],c=r[1],h=N[n],p=n?o:i,d=p[1]-p[0],v,m;S&&(s-=h,c-=d+h),v=(n?l:f)?Math.max(s,Math.min(c,e[n])):e[n],S?m=(v+=h)+d:(T&&(h=Math.max(s,Math.min(c,2*T[n]-v))),h<v?(m=v,v=h):m=h);if(p[0]!=v||p[1]!=m)return n?a=null:u=null,p[0]=v,p[1]=m,!0}function H(){_(),y.style("pointer-events","all").selectAll(".resize").style("display",h.empty()?"none":null),e.select("body").style("cursor",null),k.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),x(),g({type:"brushend"})}var c=this,m=e.select(e.event.target),g=t.of(c,arguments),y=e.select(c),b=m.datum(),w=!/^(n|s)$/.test(b)&&n,E=!/^(e|w)$/.test(b)&&r,S=m.classed("extent"),x=yt(),T,N=e.mouse(c),C,k=e.select(s).on("keydown.brush",O).on("keyup.brush",M);e.event.changedTouches?k.on("touchmove.brush",_).on("touchend.brush",H):k.on("mousemove.brush",_).on("mouseup.brush",H),y.interrupt().selectAll("*").interrupt();if(S)N[0]=i[0]-N[0],N[1]=o[0]-N[1];else if(b){var L=+/w$/.test(b),A=+/^n/.test(b);C=[i[1-L]-N[0],o[1-A]-N[1]],N[0]=i[L],N[1]=o[A]}else e.event.altKey&&(T=N.slice());y.style("pointer-events","none").selectAll(".resize").style("display",null),e.select("body").style("cursor",m.style("cursor")),g({type:"brushstart"}),_()}var t=B(h,"brushstart","brush","brushend"),n=null,r=null,i=[0,0],o=[0,0],u,a,f=!0,l=!0,c=Mf[0];return h.event=function(n){n.each(function(){var n=t.of(this,arguments),r={x:i,y:o,i:u,j:a},s=this.__chart__||r;this.__chart__=r,Ef?e.select(this).transition().each("start.brush",function(){u=s.i,a=s.j,i=s.x,o=s.y,n({type:"brushstart"})}).tween("brush:brush",function(){var e=So(i,r.x),t=So(o,r.y);return u=a=null,function(s){i=r.x=e(s),o=r.y=t(s),n({type:"brush",mode:"resize"})}}).each("end.brush",function(){u=r.i,a=r.j,n({type:"brush",mode:"resize"}),n({type:"brushend"})}):(n({type:"brushstart"}),n({type:"brush",mode:"resize"}),n({type:"brushend"}))})},h.x=function(e){return arguments.length?(n=e,c=Mf[!n<<1|!r],h):n},h.y=function(e){return arguments.length?(r=e,c=Mf[!n<<1|!r],h):r},h.clamp=function(e){return arguments.length?(n&&r?(f=!!e[0],l=!!e[1]):n?f=!!e:r&&(l=!!e),h):n&&r?[f,l]:n?f:r?l:null},h.extent=function(e){var t,s,f,l,c;if(!arguments.length)return n&&(u?(t=u[0],s=u[1]):(t=i[0],s=i[1],n.invert&&(t=n.invert(t),s=n.invert(s)),s<t&&(c=t,t=s,s=c))),r&&(a?(f=a[0],l=a[1]):(f=o[0],l=o[1],r.invert&&(f=r.invert(f),l=r.invert(l)),l<f&&(c=f,f=l,l=c))),n&&r?[[t,f],[s,l]]:n?[t,s]:r&&[f,l];if(n){t=e[0],s=e[1],r&&(t=t[0],s=s[0]),u=[t,s],n.invert&&(t=n(t),s=n(s)),s<t&&(c=t,t=s,s=c);if(t!=i[0]||s!=i[1])i=[t,s]}if(r){f=e[0],l=e[1],n&&(f=f[1],l=l[1]),a=[f,l],r.invert&&(f=r(f),l=r(l)),l<f&&(c=f,f=l,l=c);if(f!=o[0]||l!=o[1])o=[f,l]}return h},h.clear=function(){return h.empty()||(i=[0,0],o=[0,0],u=a=null),h},h.empty=function(){return!!n&&i[0]==i[1]||!!r&&o[0]==o[1]},e.rebind(h,t,"on")};var Of={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Mf=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],_f=zn.format=br.timeFormat,Df=_f.utc,Pf=Df("%Y-%m-%dT%H:%M:%S.%LZ");_f.iso=Date.prototype.toISOString&&+(new Date("2000-01-01T00:00:00.000Z"))?Hf:Pf,Hf.parse=function(e){var t=new Date(e);return isNaN(t)?null:t},Hf.toString=Pf.toString,zn.second=$n(function(e){return new Wn(Math.floor(e/1e3)*1e3)},function(e,t){e.setTime(e.getTime()+Math.floor(t)*1e3)},function(e){return e.getSeconds()}),zn.seconds=zn.second.range,zn.seconds.utc=zn.second.utc.range,zn.minute=$n(function(e){return new Wn(Math.floor(e/6e4)*6e4)},function(e,t){e.setTime(e.getTime()+Math.floor(t)*6e4)},function(e){return e.getMinutes()}),zn.minutes=zn.minute.range,zn.minutes.utc=zn.minute.utc.range,zn.hour=$n(function(e){var t=e.getTimezoneOffset()/60;return new Wn((Math.floor(e/36e5-t)+t)*36e5)},function(e,t){e.setTime(e.getTime()+Math.floor(t)*36e5)},function(e){return e.getHours()}),zn.hours=zn.hour.range,zn.hours.utc=zn.hour.utc.range,zn.month=$n(function(e){return e=zn.day(e),e.setDate(1),e},function(e,t){e.setMonth(e.getMonth()+t)},function(e){return e.getMonth()}),zn.months=zn.month.range,zn.months.utc=zn.month.utc.range;var Ff=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],If=[[zn.second,1],[zn.second,5],[zn.second,15],[zn.second,30],[zn.minute,1],[zn.minute,5],[zn.minute,15],[zn.minute,30],[zn.hour,1],[zn.hour,3],[zn.hour,6],[zn.hour,12],[zn.day,1],[zn.day,2],[zn.week,1],[zn.month,1],[zn.month,3],[zn.year,1]],qf=_f.multi([[".%L",function(e){return e.getMilliseconds()}],[":%S",function(e){return e.getSeconds()}],["%I:%M",function(e){return e.getMinutes()}],["%I %p",function(e){return e.getHours()}],["%a %d",function(e){return e.getDay()&&e.getDate()!=1}],["%b %d",function(e){return e.getDate()!=1}],["%B",function(e){return e.getMonth()}],["%Y",ri]]),Rf={range:function(t,n,r){return e.range(+t,+n,r).map(jf)},floor:xn,ceil:xn};If.year=zn.year,zn.scale=function(){return Bf(e.scale.linear(),If,qf)};var Uf=If.map(function(e){return[e[0].utc,e[1]]}),zf=Df.multi([[".%L",function(e){return e.getUTCMilliseconds()}],[":%S",function(e){return e.getUTCSeconds()}],["%I:%M",function(e){return e.getUTCMinutes()}],["%I %p",function(e){return e.getUTCHours()}],["%a %d",function(e){return e.getUTCDay()&&e.getUTCDate()!=1}],["%b %d",function(e){return e.getUTCDate()!=1}],["%B",function(e){return e.getUTCMonth()}],["%Y",ri]]);Uf.year=zn.year.utc,zn.scale.utc=function(){return Bf(e.scale.linear(),Uf,zf)},e.text=Tn(function(e){return e.responseText}),e.json=function(e,t){return Nn(e,"application/json",Wf,t)},e.html=function(e,t){return Nn(e,"text/html",d3_html,t)},e.xml=Tn(function(e){return e.responseXML}),typeof define=="function"&&define.amd?define("d3",e):typeof module=="object"&&module.exports?module.exports=e:this.d3=e}(),define("libs/require/css/css!classes/ui/chart/css/d3-chart",[],function(){}),define("classes/ui/chart/d3-chart",["d3","classes/ui/chart/chart","utils/util","libs/jquery-resize/jquery-resize","css!classes/ui/chart/css/d3-chart"],function(e,t,n){var r=t.extend({initialize:function(e){this._super(e);var t=this,r=function(e,n){t._lastWidth!=n&&(t._lastWidth=n,t.render())};this.resizeHandler=this.config.debounceInterval?n.debounce(r,this.config.debounceInterval):r},_registerResizeHandler:function(){this._lastWidth=this.contextConfig.$widget.width(),this.contextConfig.$widget.on("elementResize",this.resizeHandler)},onRender:function(){this._super(),this.$el.addClass("sf-d3-chart")},draw:function(){this._super(),this.$el.html(""),this.$svg=e.select(this.el).append("svg").style({width:"100%",height:"100%"})},_afterDOMInsertRender:function(){this.contextConfig.$widget.off("elementResize",this.resizeHandler),this._super(),this._registerResizeHandler()},onClose:function(){this._super(),this.contextConfig.$widget.off("elementResize",this.resizeHandler)}},{defaults:{debounceInterval:500}});return r}),define("libs/require/css/css!ui/modules/donutchart/css/donutchart",[],function(){}),define("ui/modules/donutchart/donutchart-module",["classes/ui/chart/d3-chart","d3","is!mobile-browser","utils/util","css!ui/modules/donutchart/css/donutchart"],function(e,t,n,r){var i=e.extend({initialize:function(e){this._super(e),this._sortElements=r.bind(this._sortElements,this),this._sortElementsRTL=r.bind(this._sortElementsRTL,this)},draw:function(e){if(r.isEmpty(e))return;this._super();var n=this,i=n.$el.height(),s=n.$el.width(),o=Math.min(s||i,i||s)/2,u=o*n.config.labelRadiusPercentage,a=o*n.config.innerRadiusPercentage,f=o*n.config.outerRadiusPercentage,l=e.series,c=this.enableRTL?this._sortElementsRTL:this._sortElements,h=t.layout.pie().sort(c).value(n.getValue)(l),p=t.svg.arc().innerRadius(a).outerRadius(f);!n.config.hideLabels&&!n.config.hideLegend&&(n.$el.html(""),s=i=o*2,n.$box=t.select(n.el).append("div").attr({"class":"sf-donutchart-box"}),n.$svg=n.$box.append("svg").style({width:s+"px",height:i+"px"}));var d=n._drawCenter(s,i);!n.config.hideTitles&&n.config.innerRadiusPercentage>0&&n._drawTitles(d,e);var v=n._drawSections(d,h,p,u,f);n.config.hideLabels||(n.config.hideLegend?n._drawLabels(v,p,u,f):n._drawLegend(e))},_drawCenter:function(e,t){var n=this.$svg.append("g").attr("transform","translate("+e/2+","+t/2+")");return n},_drawTitles:function(e,t){var n=this,r=e.append("g").attr("class","sf-chart-titles");r.append("text").attr({"text-anchor":"middle","class":"sf-chart-title",dy:"-1em"}).text(function(e,r){return n.getLabel(t,r,this)});var i;return r.append("text").text(function(e,r){var s=n.getSublabel(t,r,this);return i=s.length-8,s}).attr({"text-anchor":"middle","class":"sf-chart-subtitle",dy:"0.5em",style:i>0?"font-size:"+(2.5-n.config.subtitleDiff*i)+"em":""}),r},_drawSections:function(e,n,r){var i=this,s=e.append("g").attr("class","sf-chart-series"),o=s.selectAll("g.sf-chart-serie").data(n).enter().append("g").attr({"class":function(e,t){var n=i.getClass(e,t);return n=n?n+" ":"",n+="sf-chart-group sf-chart-serie sf-chart-serie-"+t,n}}).on("click",function(e,t){i.onClick(e.data,t,this)});return o.append("path").attr({"class":function(e,t){var n=i.getClass(e,t);return n=n?n+" ":"",n+="sf-chart-point sf-chart-point-"+t,n},fill:function(e,t){return i.getColor(e.data,t)},title:function(e,t){return i.getTooltip(e.data,t)}}).transition().duration(this.config.transitionDuration).attrTween("d",function(e){if(e.value){var n=t.interpolate(0,e.startAngle),i=t.interpolate(0,e.endAngle);return function(t){return e.startAngle=n(t),e.endAngle=i(t),r(e)}}return 0}),o},_drawLegend:function(e){var t=this.$box.append("div").attr({"class":"sf-chart-legend"}),i=[],s=this,o=n?1:this.config.rowsInLegendColumn;r.each(e.series,function(e,t){var n=Math.floor(t/o),r=i[n]||(i[n]=[]);r.push({index:t,serie:e})}),this.$el.addClass("sf-chart-legend-enabled");var u=t.selectAll("div.sf-chart-legend-column").data(i).enter().append("div").attr({"class":function(e,t){return"sf-chart-legend-column sf-chart-legend-column-"+t}}),a=u.selectAll("div.sf-chart-legend-serie").data(function(e){return e}).enter().append("div").attr({"class":function(e){return"sf-chart-legend-serie sf-chart-legend-serie-"+e.index}});a.append("div").attr({"class":"sf-chart-legend-serie-color"}).style({"background-color":function(e,t){return s.getColor(e.serie,t)}}),a.append("div").attr({"class":"sf-chart-label"}).text(function(e,t){return s.getLabel(e.serie,t)}),a.append("div").attr({"class":"sf-chart-sublabel"}).text(function(e,t){return s.getSublabel(e.serie,t)}),a.on("mouseenter",function(e){s.$svg.select(".sf-chart-serie-"+e.index).classed("sf-hover",!0)}),a.on("mouseleave",function(e){s.$svg.select(".sf-chart-serie-"+e.index).classed("sf-hover",!1)}),a.on("click",function(e){s.onClick(e.serie,e.index,this)}),this.$svg.selectAll(".sf-chart-serie").on("mouseenter",function(e,t){s.$box.select(".sf-chart-legend-serie-"+t).classed("sf-hover",!0)}).on("mouseleave",function(e,t){s.$box.select(".sf-chart-legend-serie-"+t).classed("sf-hover",!1)})},_sortElements:function(e,t){var n=this.getValue(e),r=this.getValue(t);return n>r?-1:n==r?0:1},_sortElementsRTL:function(e,t){var n=this.getValue(e),r=this.getValue(t);return n>r?1:n==r?0:-1},_drawLabels:function(e,t,n){var r=this,i=-Math.PI/2,s=e.append("g").attr({"class":"sf-chart-labels","text-anchor":this._textAnchorByPosition,transform:function(e){var s=r._calcAlignedPoint(t.centroid(e),n);return e.x=s[0],e.y=s[1],e.polar={angle:(e.startAngle+e.endAngle)/2+i,radius:n},"translate("+e.x+","+e.y+")"}});s.append("text").attr({"text-anchor":this._textAnchorByPosition,dy:function(e){return e.y<0?"-1em":".5em"},"class":"sf-chart-label"}).text(function(e,t){return r.getLabel(e.data,t)}),s.append("text").attr({"text-anchor":this._textAnchorByPosition,dy:function(e){return e.y<0?"0.2em":"1.7em"},"class":"sf-chart-sublabel"}).text(function(e,t){return r.getSublabel(e.data,t)}),this._preventOverlap(s)},_preventOverlap:function(e){var n=this,r=function(e,t){return function(n){return e<n&&n<t}},i=function(e){var t=e.getBoundingClientRect();return function(n){var i=n.getBoundingClientRect(),s=r(i.left,i.right);if(s(t.left)||s(t.right)){s=r(i.top,i.bottom);if(s(t.top)||s(t.bottom))return console.log("[Donutchart] Collision between labels: ",e,n),!0}}},s=function(e,r){t.select(e).attr("transform",function(t){console.log("[Donutchart] Solving collision: ",e);var n=r?.1:-0.2;return o(t,n),"translate("+t.x+","+t.y+")"}).selectAll("text").attr("text-anchor",n._textAnchorByPosition)},o=function(e,t){var n=e.polar.angle+t,r=e.polar.radius*Math.cos(n),i=e.polar.radius*Math.sin(n);console.log("[Donutchart] Updating label angle:",e.polar.angle,n),e.x=r,e.y=i,e.polar.angle=n},u=!0,a=0,f=function(){u=!1,a++,console.log("[Donutchart] Collision loop number ",a),e.each(function(t,n){var r=this,o=i(this);e.each(function(e,t){if(r===this)return;if(o(this)){u=!0;var i=t>n;s(this,i)}})})};while(u&&a<7)f()},_drawLines:function(e,t,n,r){var i=this,s=parseInt(this.config.lineToLabelPadding,10),o=r+s;e.append("line").attr({"class":"sf-chart-label-line",x1:function(e){return i._calcAlignedPoint(t.centroid(e),o)[0]},y1:function(e){return i._calcAlignedPoint(t.centroid(e),o)[1]},x2:function(e){return i._calcAlignedPoint([e.x,e.y],n-s)[0]},y2:function(e){return i._calcAlignedPoint([e.x,e.y],n-s)[1]}})},_calcAlignedPoint:function(e,t){var n=Math.sqrt(e[0]*e[0]+e[1]*e[1]),r=[];return r[0]=e[0]/n*t,r[1]=e[1]/n*t,r},_textAnchorByPosition:function(e){var t;return Math.abs(e.x)<30?t="middle":e.x>0?t="start":t="end",t},getValue:function(e,t){return Math.abs(this._super(e,t))}},{ID:"donutchart",defaults:{lineToLabelPadding:5,linetoLabelAppearMaxAngle:.5,labelRadiusPercentage:.8,outerRadiusPercentage:.8,innerRadiusPercentage:.45,rowsInLegendColumn:8,hideLegend:!1,subtitleDiff:.16}});return i}),define("ui/modules/donutchart/donutchart-module-extension",["ui/modules/donutchart/donutchart-module","d3","is!mobile-browser","utils/util","css!ui/modules/donutchart/css/donutchart"],function(e,t,n,r){var i=e.extend({filtersList:["mode"],_filtersChanged:function(e,t){this._super.apply(this,arguments),e==="mode"&&(this.$el.find(".sf-chart-message").remove(),this.$el.find(".sf-chart-legend").before("<div class='sf-chart-message'>"+r.i18n.get("analysis-treemap.message."+t)+"</div>"))},draw:function(e){if(r.isEmpty(e))return;this._super();var n=this,i=n.$el.height(),s=n.$el.width()*.48,o=Math.min(s||i,i||s)/2,u=o*n.config.labelRadiusPercentage,a=o*n.config.innerRadiusPercentage,f=o*n.config.outerRadiusPercentage,l=e.series,c=this.enableRTL?this._sortElementsRTL:this._sortElements,h=t.layout.pie().sort(c).value(n.getValue)(l),p=t.svg.arc().innerRadius(a).outerRadius(f);!n.config.hideLabels&&!n.config.hideLegend&&(n.$el.html(""),s=i=o*2,n.$box=t.select(n.el).append("div").attr({"class":"sf-donutchart-box"}),s>400&&(s=i=400),n.$svg=n.$box.append("svg").style({width:s+"px",height:i+"px"}));var d=n._drawCenter(s,i);!n.config.hideTitles&&n.config.innerRadiusPercentage>0&&n._drawTitles(d,e);var v=n._drawSections(d,h,p,u,f);n.config.hideLabels||n._drawLabels(v,p,u,f),n.config.hideLegend||n._drawLegend(e)},_drawLegend:function(e){var t=this.$box.append("div").attr({"class":"sf-chart-legend"}),i=[],s=this,o=n?1:this.config.rowsInLegendColumn;r.each(e.series,function(e,t){var n=Math.floor(t/o),r=i[n]||(i[n]=[]);r.push({index:t,serie:e})}),this.$el.addClass("sf-chart-legend-enabled");var u=t.selectAll("div.sf-chart-legend-column").data(i).enter().append("div").attr({"class":function(e,t){return"sf-chart-legend-column sf-chart-legend-column-"+t}}),a=u.selectAll("div.sf-chart-legend-serie").data(function(e){return e}).enter().append("div").attr({"class":function(e){return"sf-chart-legend-serie sf-chart-legend-serie-"+e.index},"data-id":function(e){return e.serie.data.catId?e.serie.data.catId:0}});a.append("div").attr({"class":function(e){return e.serie.data.parentCatId?"sf-chart-legend-serie-color sf-chart-legend-serie-subcategory":"sf-chart-legend-serie-color sf-chart-legend-serie-parentcategory"}}).style({"background-color":function(e,t){return s.getColor(e.serie,t)}}),a.selectAll(".sf-chart-legend-serie-parentcategory").append("img").attr({src:function(e){return"resources/pfm/ui/css/icons/category-icons/"+e.serie.data.catId+".svg"}}),a.append("div").attr({"class":"sf-chart-label"}).text(function(e,t){return s.getLabel(e.serie,t)}),a.append("div").attr({"class":"sf-chart-sublabel"}).text(function(e,t){return s.getSublabel(e.serie,t)}),a.on("mouseenter",function(e){s.$svg.select(".sf-chart-serie-"+e.index).classed("sf-hover",!0)}),a.on("mouseleave",function(e){s.$svg.select(".sf-chart-serie-"+e.index).classed("sf-hover",!1)}),a.on("click",function(e){s.onClick(e.serie,e.index,this)}),this.$svg.selectAll(".sf-chart-serie").on("mouseenter",function(e,t){s.$box.select(".sf-chart-legend-serie-"+t).classed("sf-hover",!0)}).on("mouseleave",function(e,t){s.$box.select(".sf-chart-legend-serie-"+t).classed("sf-hover",!1)});var f=this.$box;f.select(".sf-chart-legend").insert("span",":first-child").attr({"class":"sf-legend-disclaimer"}).text(r.i18n.get("analysis-accessible-chart.legendDisclaimer"))},_drawSections:function(e,n,r){var i=this,s=e.append("g").attr("class","sf-chart-series"),o=s.selectAll("g.sf-chart-serie").data(n).enter().append("g").attr({"class":function(e,t){var n=i.getClass(e,t);return n=n?n+" ":"",n+="sf-chart-group sf-chart-serie sf-chart-serie-"+t,n}}).on("click",function(e,t){i.onClick(e.data,t,this)});return o.append("path").attr({"class":function(e,t){var n=i.getClass(e,t);return n=n?n+" ":"",n+="sf-chart-point sf-chart-point-"+t,n},fill:function(e,t){return i.getColor(e.data,t)},title:function(e,t){return i.getTooltip(e.data,t)},"touch-tooltip":1}).transition().duration(this.config.transitionDuration).attrTween("d",function(e){if(e.value){var n=t.interpolate(0,e.startAngle),i=t.interpolate(0,e.endAngle);return function(t){return e.startAngle=n(t),e.endAngle=i(t),r(e)}}return 0}),o},_drawLabels:function(e,t,n){var r=this,i=-Math.PI/2,s=e.append("g").attr({"class":"sf-chart-labels","text-anchor":this._textAnchorByPosition,transform:function(e){var s=r._calcAlignedPoint(t.centroid(e),n);return e.x=s[0],e.y=s[1],e.polar={angle:(e.startAngle+e.endAngle)/2+i,radius:n},"translate("+e.x+","+e.y+")"}});s.append("text").attr({"text-anchor":"middle","class":"sf-chart-label sf-chart-label-percentage"}).text(function(e,t){var n=r.getPercetangeLabel(e.data,t).split("%")[0];return n&&(n=n.split(","),n=n.join("."),n=parseFloat(n),n=Math.round(n),n+="%"),n})},getPercetangeLabel:function(e,t){return parseInt(e.data.percentage.substring(0,e.data.percentage.length-1),10)<5?"":e.data.percentage}},{defaults:{lineToLabelPadding:5,linetoLabelAppearMaxAngle:.5,labelRadiusPercentage:.57,outerRadiusPercentage:.7,innerRadiusPercentage:.45,rowsInLegendColumn:1,hideLegend:!1,subtitleDiff:.16}});return i}),define("libs/require/css/css!modules/analysis-donutchart/css/analysis-donutchart",[],function(){}),define("modules/analysis-donutchart/analysis-donutchart-module",["classes/analysis/analysis-accessible-chart","is!ie8?classes/class:ui/modules/donutchart/donutchart-module","css!modules/analysis-donutchart/css/analysis-donutchart"],function(e,t){var n=e.extend({chartConstructor:t},{ID:"analysis-donutchart",submodules:[t,e],defaults:{}});return n}),define("ui/modules/planetchart/planetchart-module",["classes/ui/chart/d3-chart","d3","utils/util"],function(e,t,n){var r=e.extend({draw:function(e){if(n.isEmpty(e))return;console.log("[PlanetChartModule] Drawing…"),this._super();var t=this,r=this._setMetrics(e.series),i=this._getScale(e.series,r),s=this.axisRTL?function(t,n){var i=(e.series.length-n)*r.innerCenter;return i-=r.width/2,"translate("+i+",0)"}:function(e,t){var n=(t+1)*r.innerCenter;return n-=r.width/2,"translate("+n+",0)"},o=this.$svg.append("g").attr("class","sf-chart-series").selectAll("g").data(e.series).enter().append("g").attr({"class":function(e,n){return"sf-chart-group sf-chart-serie "+t.getClass(e,n)+" sf-chart-serie-"+n}}).on("click",function(e,n){t.onClick(e,n,this)});this._drawPlanets(o,r,i),this.config.hideLabels||(this._drawLines(o,r,i),this._drawLegend(o,r)),o.transition().duration(this.config.transitionDuration).ease("ease-in-out").attr({transform:s})},_drawPlanets:function(e,t,n){var r=this;e.append("circle").attr({cx:t.width/2,cy:t.centersHeight,r:function(e,t){var i=r._area2radius(r.getValue(e,t));return n(i)},fill:function(e,t){return r.getColor(e,t)},"class":function(e,t){return"sf-chart-point sf-chart-point-"+t},title:r.getTooltip})},_drawLines:function(e,t,n){var r=this;e.append("line").transition().delay(this.config.transitionDuration).attr({"class":"sf-chart-label-line",x1:t.width/2,y1:function(e){var i=r._area2radius(r.getValue(e));return i=n(i)+t.centersHeight,i+=r.config.margin,i},x2:t.width/2,y2:function(e,n){var i=[t.textPos1,t.textPos2],s=i[n%2];return s-=2*r.config.margin,s}})},_drawLegend:function(e,t){var n=e.append("g").attr({transform:function(e,n){var r=[t.textPos1,t.textPos2],i=t.width/2,s=r[n%2];return"translate("+i+", "+s+")"}});n.append("text").attr({"text-anchor":"middle","class":"sf-chart-label",x:0,y:0}).transition().delay(this.config.transitionDuration).text(this.getLabel),n.append("text").attr({"text-anchor":"middle","class":"sf-chart-sublabel",x:0,y:"1em"}).transition().delay(this.config.transitionDuration).text(this.getSublabel)},_setMetrics:function(e){var t={};return t.height=this.$el.height(),t.width=this.$el.width(),t.innerCenter=t.width/(e.length+1),t.drawHeight=t.height*this.config.planetArea,t.centersHeight=t.drawHeight/2,t.textHeight=t.height-t.drawHeight,t.textPos1=t.drawHeight+t.textHeight/4,t.textPos2=t.height-t.textHeight/4,t.maxRadius=Math.min(t.width/2,t.drawHeight/2),t.maxRadius=Math.min(t.innerCenter,t.maxRadius),t},_area2radius:function(e){return Math.sqrt(e/Math.PI)},_getScale:function(e,n){var r=t.max(e,this.getValue),i,s;return r=this._area2radius(r),i=[0,r],s=[0,n.maxRadius],t.scale.linear().domain(i).range(s)},getValue:function(e,t){return Math.abs(this._super(e,t))}},{ID:"planetchart",defaults:{planetArea:.75,margin:10}});return r}),define("ui/modules/planetchart/planetchart-module-extension",["ui/modules/planetchart/planetchart-module","d3","utils/util"],function(e,t,n){var r=e.extend({_drawLegend:function(e,t){var n=e.append("g").attr({transform:function(e,n){var r=[t.textPos1,t.textPos2],i=t.width/2,s=r[n%2];return"translate("+i+", "+s+")"}});n.append("text").attr({"text-anchor":"middle","class":"sf-chart-label",x:0,y:0}).transition().delay(this.config.transitionDuration).text(this.getLabel),n.append("text").attr({"text-anchor":"middle","class":"sf-chart-sublabel",x:0,y:"1em"}).transition().delay(this.config.transitionDuration).text(this.getSublabel),n.append("text").attr({"text-anchor":"middle","class":"sf-chart-percentage",x:0,y:"2em"}).transition().delay(this.config.transitionDuration).text(this.getPercentage)},getPercentage:function(e,t){return e.data.percentage===""?"":"("+e.data.percentage.trim().replace(" ","")+")"}},{ID:"planetchart",defaults:{planetArea:.35,margin:10}});return r}),define("libs/require/css/css!modules/analysis-planetchart/css/analysis-planetchart",[],function(){}),define("modules/analysis-planetchart/analysis-planetchart-module",["classes/analysis/analysis-accessible-chart","is!ie8?classes/class:ui/modules/planetchart/planetchart-module","css!modules/analysis-planetchart/css/analysis-planetchart"],function(e,t){var n=e.extend({chartConstructor:t},{ID:"analysis-planetchart",submodules:[t,e],defaults:{}});return n}),define("hbs!ui/modules/barchart/templates/barchart",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i;r+='\n	<li class="sf-chart-group ',(i=n["class"])?i=i.call(e,{hash:{}}):(i=e["class"],i=typeof i===u?i.apply(e):i),r+=a(i)+'" data-iteration="',(i=n.iteration)?i=i.call(e,{hash:{}}):(i=e.iteration,i=typeof i===u?i.apply(e):i),r+=a(i)+'">\n		<div class="sf-chart-label">',(i=n.label)?i=i.call(e,{hash:{}}):(i=e.label,i=typeof i===u?i.apply(e):i),r+=a(i)+'</div>\n		<div class="sf-chart-sublabel">',(i=n.sublabel)?i=i.call(e,{hash:{}}):(i=e.sublabel,i=typeof i===u?i.apply(e):i),r+=a(i)+'</div>\n		<div class="sf-barchart-bar">\n			<div class="sf-chart-point" title="',(i=n.title)?i=i.call(e,{hash:{}}):(i=e.title,i=typeof i===u?i.apply(e):i),r+=a(i)+'" style="width:0;',i=n["if"].call(e,e.color,{hash:{},inverse:f.noop,fn:f.program(2,c,t)});if(i||i===0)r+=i;return r+='" data-width="',(i=n.width)?i=i.call(e,{hash:{}}):(i=e.width,i=typeof i===u?i.apply(e):i),r+=a(i)+'"></div>\n		</div>\n	</li>\n	',r}function c(e,t){var r="",i;return r+=" background-color:",(i=n.color)?i=i.call(e,{hash:{}}):(i=e.color,i=typeof i===u?i.apply(e):i),r+=a(i),r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=this;s+='<ul class="sf-barchart-wrapper">\n	',o=n.each.call(t,t.rows,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;return s+="\n</ul>",s});return t.registerPartial("ui_modules_barchart_templates_barchart",n),n}),define("libs/require/css/css!ui/modules/barchart/css/barchart",[],function(){}),define("ui/modules/barchart/barchart-module",["classes/ui/chart/chart","utils/util","hbs!ui/modules/barchart/templates/barchart","css!ui/modules/barchart/css/barchart"],function(e,t,n){var r=e.extend({draw:function(e){console.log("[Barchart] Drawing…");var r=this,i=this._prepareData(e);this.$el.html(n(i)),this.$el.find(".sf-chart-point").each(function(){var e=r.$(this),t=e.data("width");e.animate({width:t},r.config.transitionDuration)});var s=function(e){var n=r.$(e.currentTarget),s=n.data("iteration"),o=t.find(i.rows,{iteration:s});console.log("[Barchart] clicked on: ",e.currentTarget," data: ",o),r.onClick(o,s,e.currentTarget)};this.$el.find(".sf-chart-group").on("click",s)},_prepareData:function(e){var n=this,r=this._getMaxValue(t.pluck(e.series,this.getValue)),i;return i=t.map(e.series,function(e,t){var i=Math.round(n.getValue(e,t)/r*1e4)/100,s={width:i+"%",label:n.getLabel(e,t)||"",sublabel:n.getSublabel(e,t)||"",color:n.getColor(e,t),title:n.getTooltip(e,t),"class":n.getClass(e,t),data:e.data,iteration:t};return s}),{rows:i}},_getMaxValue:function(e){var n=0;return t.each(e,function(e){n=Math.max(Math.abs(e),n)}),n},getValue:function(e,t){return Math.abs(this._super(e,t))}},{ID:"barchart",defaults:{}});return r}),define("libs/require/css/css!modules/analysis-barchart/css/analysis-barchart",[],function(){}),define("modules/analysis-barchart/analysis-barchart-module",["classes/analysis/analysis-accessible-chart","ui/modules/barchart/barchart-module","css!modules/analysis-barchart/css/analysis-barchart"],function(e,t){var n=e.extend({chartConstructor:t},{ID:"analysis-barchart",submodules:[t,e],defaults:{}});return n}),define("hbs!ui/modules/barchart/templates/analysis-barchart",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i;r+='\n	<li class="sf-chart-group ',(i=n["class"])?i=i.call(e,{hash:{}}):(i=e["class"],i=typeof i===u?i.apply(e):i),r+=a(i)+'" data-iteration="',(i=n.iteration)?i=i.call(e,{hash:{}}):(i=e.iteration,i=typeof i===u?i.apply(e):i),r+=a(i)+'">\n		<div class="sf-chart-label">\n            <strong>',(i=n.label)?i=i.call(e,{hash:{}}):(i=e.label,i=typeof i===u?i.apply(e):i),r+=a(i)+'</strong>\n            <span class="sf-chart-percent"> (',(i=n.graphPercent)?i=i.call(e,{hash:{}}):(i=e.graphPercent,i=typeof i===u?i.apply(e):i),r+=a(i)+')</span>\n        </div>\n		<div class="sf-barchart-bar">\n			<div class="sf-chart-point" title="',(i=n.title)?i=i.call(e,{hash:{}}):(i=e.title,i=typeof i===u?i.apply(e):i),r+=a(i)+'" style="width:0;',i=n["if"].call(e,e.color,{hash:{},inverse:f.noop,fn:f.program(2,c,t)});if(i||i===0)r+=i;return r+='" data-width="',(i=n.width)?i=i.call(e,{hash:{}}):(i=e.width,i=typeof i===u?i.apply(e):i),r+=a(i)+'"></div>\n		</div>\n	</li>\n	',r}function c(e,t){var r="",i;return r+=" background-color:",(i=n.color)?i=i.call(e,{hash:{}}):(i=e.color,i=typeof i===u?i.apply(e):i),r+=a(i),r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=this;s+='<ul class="sf-barchart-wrapper">\n	',o=n.each.call(t,t.rows,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;return s+="\n</ul>",s});return t.registerPartial("ui_modules_barchart_templates_analysis-barchart",n),n}),define("ui/modules/barchart/dav-analysis-barchart-module",["ui/modules/barchart/barchart-module","d3","is!mobile-browser","utils/util","hbs!ui/modules/barchart/templates/analysis-barchart","jQuery"],function(e,t,n,r,i,s){var o=e.extend({draw:function(e){console.log("[Barchart] Drawing…");var t=this,n=this._prepareData(e);this.$el.html(i(n)),this.$el.find(".sf-chart-point").each(function(){var e=t.$(this),n=e.data("width");e.animate({width:n},t.config.transitionDuration)});var s=function(e){var i=t.$(e.currentTarget),s=i.data("iteration"),o=r.find(n.rows,{iteration:s});console.log("[Barchart] clicked on: ",e.currentTarget," data: ",o),t.onClick(o,s,e.currentTarget)};this.$el.find(".sf-chart-group").on("click",s)},_prepareData:function(e){var t=this,n=this._getMaxValue(r.pluck(e.series,this.getValue)),i,s=0;return i=r.map(e.series,function(e,r){var i=t.getValue(e,r),o=e.data.percentage===""?"":Math.round(parseInt(e.data.percentage.substring(0,e.data.percentage.length-1)));r===0&&(s=o);var u=o===""?i*s/n:o,a={graphPercent:Math.round(u)+"%",width:u+"%",label:t.getLabel(e,r)||"",sublabel:t.getSublabel(e,r)||"",color:t.getColor(e,r),title:t.getTooltip(e,r),"class":t.getClass(e,r),data:e.data,iteration:r};return a}),{rows:i}}});return o}),define("modules/analysis-barchart/analysis-barchart-module-extension",["modules/analysis-barchart/analysis-barchart-module","ui/modules/barchart/dav-analysis-barchart-module","css!modules/analysis-barchart/css/analysis-barchart"],function(e,t){var n=e.extend({chartConstructor:t});return n}),define("ui/modules/bubblechart/bubblechart-module",["classes/ui/chart/d3-chart","d3","utils/util"],function(e,t,n){var r=e.extend({draw:function(e){if(n.isEmpty(e))return;this._super(),console.log("[BubbleChartModule] Drawing…");var r=this,i=this.$el.width(),s=this.$el.height(),o={children:e.series},u=t.layout.pack().sort(function(){return Math.random()>.5}).value(this.getValue).padding(5).size([i,s]),a=u.nodes(o);this.$node=this.$svg.append("g").attr("class","sf-chart-series").selectAll(".node").data(a).enter().append("g").filter(function(e){return!e.children}).attr({"class":function(e,t){return"sf-chart-group "+r.getClass(e,t)+"sf-chart-serie sf-chart-serie"+t},transform:function(e){return"translate("+e.x+","+e.y+")"},title:this.getTooltip}).on("click",function(e,t){r.onClick(e,t,this)}),this._drawShapes(),this.config.hideLabels||this._drawTexts()},_drawShapes:function(){var e=this;this.$node.append("circle").attr({"class":function(e,t){return"sf-chart-point sf-chart-point-"+t},r:0,fill:function(t,n){return e.getColor(t,n)}}).transition().duration(this.config.transitionDuration/2).delay(function(t){return t._delay=Math.floor(Math.random()*(e.config.transitionDuration/2)),t._delay}).attr({r:function(e){return e.r}}),console.log("[BubbleChartModule] Shapes drawed")},_drawTexts:function(){var e=this,t=this.$node.append("text").attr({style:function(t){return t._textColor=e.getContrastColor(e.getColor(t)),"fill:"+t._textColor},"class":"sf-chart-label","text-anchor":"middle",opacity:0}).text(this.getLabel),n=this.$node.append("text").attr({"class":"sf-chart-sublabel",style:function(e){return"fill:"+e._textColor},"text-anchor":"middle",dy:"1em",opacity:0}).text(this.getSublabel);t.each(function(t,n){var r=(t.r*2-e.config.marginInnerBubbles)/this.getBoundingClientRect().width,i=e.getLabel(t,n),s;r<e.config.minPropotionToShowLabel?(this.style.display="none",t.labelHidden=!0):r<1&&(s=Math.floor(r*i.length)-1,this.textContent=i.slice(0,s)+"…")}).transition().delay(function(t){return t._delay+e.config.transitionDuration/2}).attr("opacity",1),n.each(function(t){var n=(t.r*2-e.config.marginInnerBubbles)/this.getBoundingClientRect().width;if(n<1||t.labelHidden)this.style.display="none"}).transition().delay(function(t){return t._delay+e.config.transitionDuration/2}).attr("opacity",1),console.log("[BubbleChartModule] Text drawed")},getValue:function(e,t){return Math.abs(this._super(e,t))}},{ID:"bubblechart",defaults:{marginInnerBubbles:10,textColor:"white",textColorContrast:"#333",minPropotionToShowLabel:.5}});return r}),define("libs/require/css/css!ui/modules/bubblechart/css/bubblechart",[],function(){}),define("ui/modules/bubblechart/bubblechart-module-extension",["ui/modules/bubblechart/bubblechart-module","d3","is!mobile-browser","utils/util","css!ui/modules/bubblechart/css/bubblechart"],function(e,t,n,r){var i=e.extend({draw:function(e){if(r.isEmpty(e))return;this._super(),console.log("[BubbleChartModule] Drawing…");var n=this,i=this.$el.width(),s=this.$el.height(),o={children:e.series};i>400&&(i=s=400);var u=t.layout.pack().sort(function(){return Math.random()>.5}).value(this.getValue).padding(5).size([i,s]),a=u.nodes(o);n.$box=t.select(n.el).append("div").attr({"class":"sf-bubblechart-box"}),n.$svg=n.$box.append("svg").style({width:i+"px",height:s+"px"}),this.$node=this.$svg.append("g").attr("class","sf-chart-series").selectAll(".node").data(a).enter().append("g").filter(function(e){return!e.children}).attr({"class":function(e,t){return"sf-chart-group "+n.getClass(e,t)+"sf-chart-serie sf-chart-serie"+t},transform:function(e){return"translate("+e.x+","+e.y+")"},title:this.getTooltip}).on("click",function(e,t){n.onClick(e,t,this)}),this._drawShapes(),this.config.hideLabels||this._drawTexts(),n.config.hideLegend||n._drawLegend(e)},_drawLegend:function(e){var t=this.$box.append("div").attr({"class":"sf-chart-legend"}),i=[],s=this,o=n?1:this.config.rowsInLegendColumn;r.each(e.series,function(e,t){var n=Math.floor(t/o),r=i[n]||(i[n]=[]);r.push({index:t,serie:e})}),this.$el.addClass("sf-chart-legend-enabled");var u=t.selectAll("div.sf-chart-legend-column").data(i).enter().append("div").attr({"class":function(e,t){return"sf-chart-legend-column sf-chart-legend-column-"+t}}),a=u.selectAll("div.sf-chart-legend-serie").data(function(e){return e}).enter().append("div").attr({"class":function(e){return"sf-chart-legend-serie sf-chart-legend-serie-"+e.index},"data-id":function(e){return e.serie.data.catId?e.serie.data.catId:0}});a.append("div").attr({"class":function(e){return e.serie.data.parentCatId?"sf-chart-legend-serie-color sf-chart-legend-serie-subcategory":"sf-chart-legend-serie-color sf-chart-legend-serie-parentcategory"}}).style({"background-color":function(e,t){return s.getColor(e.serie,t)}}),a.selectAll(".sf-chart-legend-serie-parentcategory").append("img").attr({src:function(e){return"resources/pfm/ui/css/icons/category-icons/"+e.serie.data.catId+".svg"}}),a.append("div").attr({"class":"sf-chart-label"}).text(function(e,t){return s.getLabel(e.serie,t)}),a.append("div").attr({"class":"sf-chart-sublabel"}).text(function(e,t){return s.getSublabel(e.serie,t)}),a.on("mouseenter",function(e){s.$svg.select(".sf-chart-serie-"+e.index).classed("sf-hover",!0)}),a.on("mouseleave",function(e){s.$svg.select(".sf-chart-serie-"+e.index).classed("sf-hover",!1)}),a.on("click",function(e){s.onClick(e.serie,e.index,this)}),this.$svg.selectAll(".sf-chart-serie").on("mouseenter",function(e,t){s.$box.select(".sf-chart-legend-serie-"+t).classed("sf-hover",!0)}).on("mouseleave",function(e,t){s.$box.select(".sf-chart-legend-serie-"+t).classed("sf-hover",!1)});var f=this.$box;f.select(".sf-chart-legend").insert("span",":first-child").attr({"class":"sf-legend-disclaimer"}).text(r.i18n.get("analysis-accessible-chart.legendDisclaimer"))},_drawTexts:function(){var e=this,t=this.$node.append("text").attr({style:function(t){return t._textColor=e.config.textColor,"fill:"+t._textColor},"class":"sf-chart-label","text-anchor":"middle",opacity:0,dy:"5px"}).text(this.getPercentage);t.each(function(t,n){var r=(t.r*2-e.config.marginInnerBubbles)/this.getBoundingClientRect().width,i=e.getLabel(t,n),s;r<e.config.minPropotionToShowLabel&&(this.style.display="none",t.labelHidden=!0)}).transition().delay(function(t){return t._delay+e.config.transitionDuration/2}).attr("opacity",1),console.log("[BubbleChartModule] Text drawed")},getPercentage:function(e,t){return e.data.percentage.trim().replace(" ","")}},{ID:"bubblechart",defaults:{marginInnerBubbles:10,textColor:"white",textColorContrast:"#333",minPropotionToShowLabel:.5,hideLegend:!1,rowsInLegendColumn:1}});return i}),define("libs/require/css/css!modules/analysis-bubblechart/css/analysis-bubblechart",[],function(){}),define("modules/analysis-bubblechart/analysis-bubblechart-module",["classes/analysis/analysis-accessible-chart","is!ie8?classes/class:ui/modules/bubblechart/bubblechart-module","css!modules/analysis-bubblechart/css/analysis-bubblechart"],function(e,t){var n=e.extend({chartConstructor:t},{ID:"analysis-bubblechart",submodules:[t,e],defaults:{}});return n}),define("ui/modules/columnchart/columnchart-module",["classes/ui/chart/d3-chart","d3","utils/util"],function(e,t,n){var r=e.extend({initialize:function(){this._super.apply(this,arguments);var e=this,t=e.config.yAxisPosition,n=e.axisRTL;t==="start"?t=n?"right":"left":t==="end"&&(t=n?"left":"right"),e.yAxisRight=t==="right"},draw:function(e){if(n.isEmpty(e))return;var t=this,r;t._super(),t._preprocessData(e),r=t._initializeCanvas(e.axis),t._y0=t._yScale(0),t._drawStacks(r,t._stacks,e.axis.x),t._drawColumns(t._stacks.length,r,t._columns,e.axis.x),t._drawZeroLine(r),t._drawLines(r,t._lines,e.axis.x)},_initializeCanvas:function(e){this._initializeDimensions(),this._ticks=this._calcTicks(this._valueRange),this._$axisLabels=this._drawAxisTitles(e),this._updatePosition(),this._calcScales(e),this._drawAxis(),this._updatePosition(),this._calcScales(e),this._drawAxis()&&(this._updatePosition(),this._calcScales(e),this._drawAxis()),this._centerAxisTitles();var t={"class":"sf-chart-content",transform:"translate("+this._content.left+","+this._content.top+")"},n=this.$svg.append("g").attr(t);return n},_initializeDimensions:function(){this._content={height:0,width:0},this._axis={x:{height:0,width:0},y:{height:0,width:0}},this._axisTitles={x:{height:0,width:0},y:{height:0,width:0}},this._padding={top:this.config.topMargin||0,left:this.config.leftMargin||0,right:this.config.rightMargin||0,bottom:this.config.bottomMargin||0}},_updatePosition:function(){var e=this,t=this.$el.width(),n=this.$el.height(),r=this._axis,i=this._axisTitles,s=this._content,o=e._padding;s.height=n-r.x.height-i.x.height-o.top-o.bottom,s.width=t-r.y.width-i.y.width-o.left-o.right,s.top=o.top,s.bottom=s.top+s.height,s.left=e.yAxisRight?o.left:o.left+i.y.width+r.y.width,s.right=s.left+s.width,r.x.top=s.bottom+e.config.labelToAxisPadding,r.x.left=s.left,r.x.right=s.right,r.x.bottom=s.bottom+r.x.height,r.y.top=s.top,r.y.left=e.yAxisRight?s.right:s.left,r.y.right=r.y.left+r.y.width,r.y.bottom=r.y.top+r.y.height},_calcTicks:function(e){var n=e[0]<0&&0<e[1],r=n?this.config.numberOfTicks-2:this.config.numberOfTicks-1,i=+((Math.abs(e[0])+Math.abs(e[1]))/r).toPrecision(2),s=this.config.roundTickStep?this.roundAxisValue(i):i,o=e[1],u=e[0],a=Math.ceil(o/s)+1,f=Math.floor(u/s),l=t.range(0,s*a,s);return t.range(s*f,0,s).concat(l)},roundAxisValue:function(e){return e%10===0?e:e+(10-e%10)},_drawAxis:function(){var e=this;return e._$xAxis&&e._$xAxis.remove(),e._$xAxis=e._drawXaxis(),e._axis.x=e._getXaxisSize(),e._$yAxis&&e._$yAxis.remove(),e._$yAxis=e._drawYaxis(),e._axis.y=e._getYaxisSize(),e.config.labelAlign!=null&&e.alignAxisLabels(e.config.labelAlign),e.config.preventXaxisOverlap&&e.checkLabelsColission()?(e.solveLabelsCollision(),e._axis.x=e._getXaxisSize(),!0):!1},_drawXaxis:function(){var e=this,n=t.svg.axis().tickSize(0).scale(e._xScale).tickFormat(function(t,n){return e.getXaxisFormat(t,n,this)}).orient("bottom");return e.$svg.append("g").attr({"class":"sf-chart-axis sf-chart-axis-horizontal",transform:"translate("+e._axis.x.left+","+e._axis.x.top+")"}).call(n)},_drawYaxis:function(){var e=this,n=e._content.width,r=t.svg.axis().tickValues(e._ticks).tickSize(-n,0,-n).scale(e._yScale).tickFormat(function(t,n){return e.getYaxisFormat(t,n,e)}).orient(e.yAxisRight?"right":"left"),i={"class":"sf-chart-axis sf-chart-axis-vertical",transform:"translate("+e._axis.y.left+", "+e._axis.y.top+")"},s=e.$svg.append("g").attr(i).call(r);return e.enableRTL&&s.selectAll(".tick text").style("text-anchor",e.yAxisRight?"end":"start"),s},_getXaxisSize:function(){var e=this,t=e._$xAxis,n=t&&t.node(),r=n&&n.getBoundingClientRect();return{height:r?r.height+e.config.labelToAxisPadding:0,width:r?r.width:0}},_getYaxisSize:function(){var e=this,t=e._$yAxis,n=t&&t.node(),r=n&&n.getBoundingClientRect(),i=0,s=0;return t&&(t.selectAll("text").each(function(){var e=this.getBoundingClientRect(),t=this.getAttribute("x"),n=e.width+Math.abs(t);i<n&&(i=n),s<e.height&&(s=e.height)}),s/=2,this._padding.top<s&&(this._padding.top=s)),{height:r?r.height:0,width:i}},alignAxisLabels:function(e){var t=this,n=0,r="middle",i=t._columns.length+t._stacks.length,s=t.axisRTL?t._columnScale(i-1):t._columnScale(0),o=t._xScale.rangeBand()/2;e==="start"?e=t.enableRTL?"right":"left":e==="end"&&(e=t.enableRTL?"left":"right"),e==="left"?(r=this.enableRTL?"end":"start",n=s-o):e==="right"&&(r=this.enableRTL?"start":"end",n=o-s),this._$xAxis.selectAll("text").style("text-anchor",r).attr("x",n)},_drawAxisTitles:function(e){var t=this,n=t.$svg.append("g").attr("class","sf-chart-axis-labels"),r=n.append("g").attr("class","sf-chart-axis-label-horizontal-group"),i,s=r.node(),o=n.append("g").attr("class","sf-chart-axis-label-vertical-group"),u,a=o.node();return e.yLabel&&(t._drawYaxisTitle(e.yLabel,o),u=a.getBoundingClientRect(),t._axisTitles.y.height=u.height,t._axisTitles.y.width=u.width,t._axisTitles.y.width+=t.config.axisTitlePadding),e.xLabel&&(t._drawXaxisTitle(e.xLabel,r),i=s.getBoundingClientRect(),t._axisTitles.x.width=i.width,t._axisTitles.x.height=i.height,t._axisTitles.x.height+=t.config.axisTitlePadding),t._$yAxisTitle=o,t._$xAxisTitle=r,n},_centerAxisTitles:function(){var e=this,t=e._axisTitles.x.height+e._axis.x.height,n=e._axisTitles.y.width+e._axis.y.width;t/=-2,n/=e.yAxisRight?-2:2,e._$yAxisTitle.attr("transform","translate(0,"+t+")"),e._$xAxisTitle.attr("transform","translate("+n+",0)")},_drawXaxisTitle:function(e,t){var n={"class":"sf-chart-axis-label sf-chart-axis-label-horizontal",x:(this.$el.width()-this._padding.left-this._padding.right)/2,y:this.$el.height()-this._padding.bottom},r=t.append("text").attr(n).text(e),i=r.node(),s=i.getBoundingClientRect().height/2;return this._padding.bottom<s?(this._padding.bottom=s,r.remove(),this._drawXaxisTitle(e,t)):r},_drawYaxisTitle:function(e,t){var n=this,r=(this.$el.height()-this._padding.top-this._padding.bottom)/2+this._padding.top,i=n.yAxisRight?this.$el.width()-n._padding.right:n._padding.left,s={"class":"sf-chart-axis-label sf-chart-axis-label-vertical",x:i,y:r};n.yAxisRight?s.transform=" rotate(90,"+i+","+r+")":s.transform=" rotate(-90,"+i+","+r+")";var o=t.append("text").attr(s).text(e),u=o.node(),a=u.getBoundingClientRect().width;if(n.yAxisRight){if(a>n._padding.right)return n._padding.right=a,o.remove(),n._drawYaxisTitle(e,t)}else if(a>n._padding.left)return n._padding.left=a,o.remove(),n._drawYaxisTitle(e,t);return o},checkLabelsColission:function(){var e=this._xScale.rangeBand()-this.config.xAxisLabelMinPadding,t=!1;return this._$xAxis.selectAll("g.tick").each(function(){this.getBoundingClientRect().width>e&&(t=!0)}),t},solveLabelsCollision:function(){var e=this,t=e._$xAxis.selectAll("text"),n={dy:"0.5em",dx:"0.5em",x:"-0.5em",y:"0.5em",transform:e.yAxisRight?"rotate("+this.config.collisionsRotate+")":"rotate(-"+this.config.collisionsRotate+")"},r=e.yAxisRight==e.enableRTL?"end":"start";t.attr(n).style("text-anchor",r)},_calcScales:function(e){this._yScale=this._calcYscale(this._ticks),this._xScale=this._calcXscale(e.x),this._lineScale=this._calcLineScale(e.x),this._columnScale=this._calcColumnScale(this._xScale,this._columns.length+this._stacks.length)},_calcYscale:function(e){return t.scale.linear().domain([t.min(e),t.max(e)]).range([this._content.height,0])},_calcXscale:function(e){var n=this.axisRTL?[this._content.width,0]:[0,this._content.width],r=t.scale.ordinal().domain(e).rangeBands(n),i=r.rangeBand();if(i>this.config.maxColumnWidth){var s=i/(1-this.config.marginInnerInterval),o=1-this.config.maxColumnWidth/s;r=t.scale.ordinal().domain(e).rangeBands(n,o,o/2)}return r},_calcColumnScale:function(e,n){var r=t.range(0,n||1),i=e.rangeBand(),s=this.config.marginInnerColumns,o=this.config.marginInnerInterval,u=this.axisRTL?[i,0]:[0,i];return t.scale.ordinal().domain(r).rangeBands(u,s,o)},_calcLineScale:function(e){var n=this.axisRTL?[this._content.width,0]:[0,this._content.width];return t.scale.ordinal().domain(t.range(0,e.length)).rangePoints(n,1)},_drawLines:function(e,n){var r=this,i={"class":function(e){var t=["sf-chart-line-serie sf-chart-serie"];return e["class"]&&t.push(e["class"]),t.join(" ")}},s=e.selectAll("g.sf-chart-line-serie").data(n).enter().append("g").attr(i),o=function(e,t){return r._lineScale(t)},u=function(e){return r._yScale(e.value)},a=t.svg.line().x(o).y(u),f=t.svg.line().x(o).y(this._y0),l={"class":"sf-chart-line",d:function(e,t){return f(e.points,t)},stroke:function(e){return e.color}},c={d:function(e,t){return a(e.points,t)}},h={"class":r._pointClass,cx:o,cy:this._y0,r:this.config.pointRadius,stroke:function(e){return e.color},title:function(e){return e.title}},p={cy:u};s.selectAll("path").data(n).enter().append("path").attr(l).transition().duration(this.config.transitionDuration).attr(c),s.selectAll("circle").data(function(e){return e.points}).enter().append("circle").attr(h).on("click",function(e,t){r.onClick(e,t,this)}).transition().duration(this.config.transitionDuration).attr(p),this._$lines=s},_drawColumns:function(e,t,n,r){var i=this,s={"class":function(e,t){var n=["sf-chart-column-serie sf-chart-serie-"+t];return e["class"]&&n.push(e["class"]),n.join(" ")}},o={"class":i._pointClass,x:function(t,n){return i._columnScale(e+t._serieIndx)+i._xScale(r[n])},y:this._y0,fill:function(e){return e.color},title:function(e){return e.title},height:0,width:i._columnScale.rangeBand()},u={y:function(e){return Math.min(i._y0,i._yScale(e.value))},height:function(e){var t=Math.abs(e.value),n=i._yScale(t);return Math.abs(i._y0-n)}},a=t.selectAll("g.sf-chart-column-serie").data(n).enter().append("g").attr(s).selectAll("rect.sf-chart-point").data(function(e){return e.points}).enter().append("rect").attr(o).on("click",function(e,t){i.onClick(e,t,this)}).transition().duration(this.config.transitionDuration).attr(u);this._$columns=a},_drawStacks:function(e,t,n){var r=this,i={"class":function(e,t){return"sf-chart-stack sf-chart-stack-"+t}},s={"class":function(e){var t=["sf-chart-stack-serie sf-chart-serie"];return e["class"]&&t.push(e["class"]),t.join(" ")}},o={"class":r._pointClass,title:function(e){return e.title},width:r._columnScale.rangeBand(),height:0,fill:function(e){return e.color},y:r._y0,x:function(e,t){return r._xScale(n[t])+r._columnScale(e._serieIndx)}},u={height:function(e){var t=Math.abs(e.value),n=r._yScale(t);return Math.abs(r._y0-n)},y:function(e){var t=Math.abs(e._offset),n=Math.abs(r._y0-r._yScale(t)),i=Math.min(r._y0,r._yScale(e.value));return e._offset?e._offset>0?i-n:i+n:i}},a=e.selectAll("g.sf-chart-stack").data(t).enter().append("g").attr(i).selectAll("g.sf-chart-stack-serie").data(function(e){return e.series}).enter().append("g").attr(s).selectAll("rect.sf-chart-point").data(function(e){return e.points}).enter().append("rect").attr(o).on("click",function(e,t){r.onClick(e,t,this)}).transition().duration(this.config.transitionDuration).attr(u);this._$stacks=a},_drawZeroLine:function(e){e.append("line").attr({x1:0,y1:this._y0,x2:this._content.width,y2:this._y0,"class":"sf-chart-zero-line"})},_pointClass:function(e,t){var n=["sf-chart-point","sf-chart-point-"+t];return e["class"]&&n.push(e["class"]),n.join(" ")},getYaxisFormat:function(e){return e},getXaxisFormat:function(e){return e},_preprocessData:function(e){var t=this,r=[0,0],i=function(e){e>0&&e>r[1]?r[1]=e:r[0]>e&&(r[0]=e)},s=function(e,t){var r=e[t.options.stack]||(e[t.options.stack]={series:[],points:[]});return r.series.push(t),n.each(t.points,function(e,n){var s=e.value,o=r.points[n];e._serieIndx=t.options.stack,o||(o=r.points[n]={bottom:0,top:0}),s>0?(e._offset=o.top,o.top+=s,i(o.top)):(e._offset=o.bottom,o.bottom+=s,i(o.bottom))}),e},o=function(e,t){return e.push(t),n.each(t.points,function(t){t._serieIndx=e.length-1,i(t.value)}),t},u=function(e){return e.options&&e.options.stack!=null},a=function(e){return e.options&&e.options.type==="line"},f=function(e,t,n){return u(t)?s(e.stacks,t,n):a(t)?o(e.lines,t,n):o(e.columns,t,n),e},l=t.normalize(e),c=n.reduce(l.series,f,{stacks:[],columns:[],lines:[]});t._valueRange=r,t._lines=c.lines,t._columns=c.columns,t._stacks=c.stacks}},{ID:"columnchart",defaults:{collisionsRotate:45,pointRadius:5,numberOfTicks:7,topMargin:0,leftMargin:0,rightMargin:0,bottomMargin:0,marginInnerInterval:.2,maxColumnWidth:300,marginInnerColumns:0,labelToAxisPadding:10,axisTitlePadding:10,labelAlign:"start",xAxisLabelMinPadding:2,preventXaxisOverlap:!0,roundTickStep:!1,yAxisPosition:"start"}});return r}),define("ui/modules/columnchart/columnchart-module-extension",["ui/modules/columnchart/columnchart-module"],function(e){var t=e.extend({},{defaults:{maxColumnWidth:100,collisionsRotate:45,preventXaxisOverlap:!0}});return t}),define("hbs!modules/analysis-columnchart/templates/formatters/category",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function h(e,t){var r="",i;return r+='\n<a href="javascript:void(0);" class="sf-category-selector" data-id="',(i=n.catId)?i=i.call(e,{hash:{}}):(i=e.catId,i=typeof i===a?i.apply(e):i),r+=f(i)+'">',(i=n.catName)?i=i.call(e,{hash:{}}):(i=e.catName,i=typeof i===a?i.apply(e):i),r+=f(i)+"</a>\n",r}function p(e,t){var r="",i,s;return r+='\n<span class="sf-category-all-group">\n',s={hash:{}},r+=f((i=n.t,i?i.call(e,"analysis-columnchart.accessible.allCategories",s):l.call(e,"t","analysis-columnchart.accessible.allCategories",s)))+"\n</span>\n",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s,o,u,a="function",f=this.escapeExpression,l=n.helperMissing,c=this;return u={hash:{},inverse:c.program(3,p,i),fn:c.program(1,h,i)},o=(s=n.ifdef,s?s.call(t,t.catId,u):l.call(t,"ifdef",t.catId,u)),o||o===0?o:""});return t.registerPartial("modules_analysis-columnchart_templates_formatters_category",n),n}),define("hbs!modules/analysis-columnchart/templates/analysis-columnchart-accessible",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-analysis-columnchart-accessible"></div>'});return t.registerPartial("modules_analysis-columnchart_templates_analysis-columnchart-accessible",n),n}),define("modules/analysis-columnchart/views/analysis-columnchart-accessible-view",["classes/item-view","classes/collection","utils/util","ui/modules/datagrid/datagrid-module","jQuery","hbs!modules/analysis-columnchart/templates/formatters/category","hbs!modules/analysis-columnchart/templates/analysis-columnchart-accessible","utils/amount","utils/number","utils/percentage"],function(e,t,n,r,i,s,o){var u=r.DatagridColumn,a=e.extend({events:{"click .sf-category-selector":"_categorySelected"},template:o,initialize:function(){this._super.apply(this,arguments);var e=this.config.stepScale;this.gridConfig={columns:[new u({parent:this,headerClass:"sf-date-header",columnClass:"sf-date-col",field:"date",formatter:this._dateFormatter,label:n.i18n.get("analysis-columnchart.accessible.header."+e),sortable:!1}),new u({parent:this,field:"catName",formatter:s,columnClass:"sf-cat-col",serializeData:function(e){return{catName:e.get("name"),catId:e.get("catId")}},label:n.i18n.get("analysis-columnchart.accessible.header.category"),sortable:!1}),new u({parent:this,columnClass:"sf-numeric sf-amount-col",field:"amount",formatter:function(e){return n.amount.format(e.get("amount"))},label:n.i18n.get("analysis-columnchart.accessible.header.amount"),headerClass:"sf-amount-header sf-numeric",sortable:!1}),new u({columnClass:"sf-numeric sf-transactions-col",field:"transactions",label:n.i18n.get("analysis-columnchart.accessible.header.transactions"),headerClass:"sf-transactions-header sf-numeric",parent:this,sortable:!1}),new u({columnClass:"sf-numeric sf-percent-col",field:"percent",label:n.i18n.get("analysis-columnchart.accessible.header.percent"),headerClass:"sf-percent-header sf-numeric",parent:this,sortable:!1,formatter:function(e){return e.get("percent")!==undefined?n.percentage.format(n.number.round(e.get("percent"),2),!0):"-"}})]}},onShow:function(){this.model.on("change",this.render,this)},onClose:function(){this.model.off("change",this.render)},onRender:function(){this._super();var e=this.model.get("data");if(e){var i=n.extend({dataSource:new t(e),config:this.gridConfig,container:this.$el},this.contextConfig);this.datagrid=new r(i),this.datagrid.render()}},_categorySelected:function(e){var t=i(e.currentTarget).data("id");this.publish("filters:change",{filter:"category",data:t})},_dateFormatter:function(e,t,n,r){var i=e.get("dataDate"),s;return n>0&&(s=t.at(n-1).get("dataDate")),s===i&&(r.classes=r.classes||[],r.classes.push("sf-repeated-date")),s=i,e.get("formattedDate")}});return a}),define("libs/require/css/css!modules/analysis-columnchart/css/analysis-columnchart",[],function(){}),define("modules/analysis-columnchart/analysis-columnchart-module",["classes/analysis/analysis-accessible-chart","ui/modules/columnchart/columnchart-module","modules/analysis-columnchart/views/analysis-columnchart-accessible-view","utils/util","css!modules/analysis-columnchart/css/analysis-columnchart"],function(e,t,n,r){var i=e.extend({accessibleViewConstructor:n,chartConstructor:t.extend({getYaxisFormat:function(e){return r.unicodeHTMLCodes(r.amount.format(e,!1))},getXaxisFormat:function(e){return r.date.format(e,this.config.dateAxisFormats[this.config.stepScale])},getValue:function(e){var t=this._super(e);return Math.abs(t)}}),parseTabularSeries:function(e){return this._parseTimeTabularSeries(e)}},{ID:"analysis-columnchart",submodules:[t,e]});return i}),define("libs/require/css/css!widgets/analysis/css/analysis",[],function(){}),define("widgets/analysis/analysis-widget",["classes/ui/widget/widget","modules/analysis-header/analysis-header-module","modules/analysis-content/analysis-content-module","modules/analysis-treemap/analysis-treemap-module","modules/analysis-piechart/analysis-piechart-module","is!ie8?classes/class:modules/analysis-donutchart/analysis-donutchart-module","is!ie8?classes/class:modules/analysis-planetchart/analysis-planetchart-module","modules/analysis-barchart/analysis-barchart-module","is!ie8?classes/class:modules/analysis-bubblechart/analysis-bubblechart-module","is!ie8?modules/analysis-columnchart/analysis-columnchart-hc-module:modules/analysis-columnchart/analysis-columnchart-module","services/accounts-service","services/analysis-service","utils/util","utils/date","utils/mask","css!widgets/analysis/css/analysis"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p=e.extend({initialize:function(){this._super.apply(this,arguments),this._setupDatesRangeFilter(),this.accountsService=l.getInstance(),this._charts=this.getCharts();for(var e in this._charts)this._charts[e].constructor==null&&delete this._charts[e]},getCharts:function(){return h.isIE8()?(this.config.initialChart="piechart",{piechart:{constructor:i,type:"area",viewType:0},treemap:{constructor:r,type:"area",viewType:0},barchart:{constructor:u,type:"area",viewType:0},columnchart:{constructor:f,type:"time",viewType:0}}):{donutchart:{constructor:s,type:"area",viewType:0},planetchart:{constructor:o,type:"area",viewType:0},bubblechart:{constructor:a,type:"area",viewType:0},treemap:{constructor:r,type:"area",viewType:0},barchart:{constructor:u,type:"area",viewType:0},columnchart:{constructor:f,type:"time",viewType:0}}},onShow:function(){h.mask(this.$el,h.MASK_LOADING);var e=this;this._setupAccountsFilter(this.accountsService,function(){e._renderRegions(),h.unmask(e.$el)})},_renderRegions:function(){var e=h.extend({charts:this._charts},this.contextConfig);this.headerRegion.show(new t(h.extend({},e,{config:{initialRangeMonths:this.config.initialRangeMonths,fromDate:this.config.filters.datesRange.fromDate,toDate:this.config.filters.datesRange.toDate}}))),this.contentRegion.show(new n(e))}},{ID:"analysis",submodules:[t,n,r,f,s,o,u,a],services:[l,c],defaults:{initialChart:"donutchart",initialRangeMonths:3,stepScale:"month",filters:{mode:c.EXPENSES_MODE}}});return p}),define("widgets/analysis/analysis-widget-extension",["widgets/analysis/analysis-widget","modules/analysis-header/analysis-header-module","modules/analysis-content/analysis-content-module","modules/analysis-treemap/analysis-treemap-module","modules/analysis-piechart/analysis-piechart-module","modules/transactions-filters/transactions-filters-module","modules/transactions-details-filters/transactions-details-filters-module","is!ie8?classes/class:modules/analysis-donutchart/analysis-donutchart-module","is!ie8?classes/class:modules/analysis-planetchart/analysis-planetchart-module","modules/analysis-barchart/analysis-barchart-module","is!ie8?classes/class:modules/analysis-bubblechart/analysis-bubblechart-module","is!ie8?modules/analysis-columnchart/analysis-columnchart-hc-module:modules/analysis-columnchart/analysis-columnchart-module","services/accounts-service","services/analysis-service","utils/util","utils/date","utils/mask","css!widgets/analysis/css/analysis"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){var v=e.extend({deleteAccountsInstance:function(){h.destroyInstance()},deleteAnalysisInstance:function(){p.destroyInstance()},getCharts:function(){return d.isIE8()?(this.config.initialChart="piechart",{piechart:{constructor:i,type:"area",viewType:0},barchart:{constructor:f,type:"area",viewType:0},treemap:{constructor:r,type:"area",viewType:0}}):{donutchart:{constructor:u,type:"area",viewType:0},barchart:{constructor:f,type:"area",viewType:0},treemap:{constructor:r,type:"area",viewType:0},planetchart:{constructor:a,type:"area",viewType:0},bubblechart:{constructor:l,type:"area",viewType:0}}}},{ID:"analysis",submodules:[t,n,r,c,u,a,f,l,o,s],services:[h,p],defaults:{initialChart:"donutchart",initialRangeMonths:1,stepScale:"month",filters:{mode:p.EXPENSES_MODE},obligacionesFinancierasCatId:60}});return v}),define("hbs!widgets/budget/templates/budget-header",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s,o,u=n.helperMissing,a=this.escapeExpression;return o={hash:{id:"budget",title:'{{t "budget.title"}}',summaryPlaceholder:"true"}},a((s=n.header,s?s.call(t,o):u.call(t,"header",o)))});return t.registerPartial("widgets_budget_templates_budget-header",n),n}),define("hbs!widgets/budget/templates/budget-summary",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function f(e,t){var r="",i,s;return r+='\n<div class="sf-budget-summary">\n	',s={hash:{"class":"sf-summary-spent",title:'{{t "budget.summary.spent"}}',value:"{{{spent}}}"}},r+=u((i=n.summaryBox,i?i.call(e,s):o.call(e,"summaryBox",s)))+"\n	",s={hash:{"class":"sf-summary-total",title:'{{t "budget.summary.total"}}',value:"{{{total}}}"}},r+=u((i=n.summaryBox,i?i.call(e,s):o.call(e,"summaryBox",s)))+"\n	",s={hash:{"class":"sf-summary-available",title:'{{t "budget.summary.available"}}',value:"{{{available}}}"}},r+=u((i=n.summaryBox,i?i.call(e,s):o.call(e,"summaryBox",s)))+"\n	",s={hash:{"class":"sf-summary-days-left",title:'{{t "budget.summary.daysLeft"}}',value:"{{{daysLeft}}}"}},r+=u((i=n.summaryBox,i?i.call(e,s):o.call(e,"summaryBox",s)))+"\n</div>\n",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s,o=n.helperMissing,u=this.escapeExpression,a=this;return s=n.unless.call(t,t.empty,{hash:{},inverse:a.noop,fn:a.program(1,f,i)}),s||s===0?s:""});return t.registerPartial("widgets_budget_templates_budget-summary",n),n}),define("data/budget/budget-model",["classes/model","utils/util","utils/config","utils/date"],function(e,t){var n=e.extend({initialize:function(e){this._super.apply(this,arguments);if(!this.get("percentage")){var n=t.date.today(),r=e.startDate||e.date,i=e.value-e.spent,s=e.spent>0?e.spent:0,o=e.children&&e.children.length?e.children.reduce(this.constructor._aggregateValue,0):null,u=this._calcPercentage(r?t.date.parseBackendDate(r):n);this.set({children:e.children,available:i>0?i:0,spent:s,minValue:o,overspent:i>0?0:Math.abs(i),expected:e.value*u/100,percentage:u},{silent:!0})}},_calcPercentage:function(e){var n=t.date.today(),r;return e.getMonth()===n.getMonth()&&e.getFullYear()===n.getFullYear()?n.getDate()===1?0:(r=t.date.daysInMonth(n.getMonth(),n.getFullYear()),n.getDate()/r*100):null},save:function(e,n){e=e||this.attributes;var r=this.isNew()?"/budgetgoals/create.action":"/budgetgoals/update.action",i=t.extend({data:t.param(e),url:t.apiURL(r),type:"POST",wait:!0},n);return this._super(e,i)},destroy:function(e){var n=t.apiURL("/budgetgoals/delete.action"),r=t.extend({data:t.param({id:this.id}),url:n,type:"POST",wait:!0},e);return this._super(r)}},{_aggregateValue:function(e,t){return e+t.get("value")}});return n}),define("data/budget/budget-collection",["classes/collection","data/budget/budget-model"],function(e,t){var n=e.extend({comparator:"catId",model:t});return n}),define("data/budget/budget-month-model",["classes/model","utils/util","utils/date"],function(e,t){var n=e.extend({idAttribute:"date",_calcPercentage:function(e){var n=t.date.today(),r;return e.getMonth()===n.getMonth()&&e.getFullYear()===n.getFullYear()?e.getDate()===1?0:(r=t.date.daysInMonth(n.getMonth(),n.getFullYear()),n.getDate()/r*100):null},parse:function(e){var n=this._super(e);if(!n.date)return null;var r=n.totalValue,i=n.totalSpend,s=r-i,o=t.date.parseBackendDate(n.date),u=this._calcPercentage(o);return{value:r,spent:i>0?i:0,available:s>0?s:0,overspent:s>0?0:Math.abs(s),percentage:u,expected:r*u/100,date:t.date.format(n.date,t.date.constructor.BACKEND_MONTH_YEAR_FORMAT),dateValue:o,budgets:n.budgets}}});return n}),define("data/budget/budget-month-collection",["classes/collection","data/budget/budget-month-model"],function(e,t){var n=e.extend({model:t,url:"/budgetgoals/history/all.action",parse:function(e){return e.monthlyGoals}});return n}),define("data/budget/budget-data-manager",["classes/data-manager","data/budget/budget-month-collection","classes/remote-error","utils/date"],function(e,t,n,r){var i=["budget:add","budget:change","budget:remove","transaction:change","transaction:add","transaction:remove","transaction:amount:change","transaction:category:change","transaction:date:change","category:change","category:remove","rule:add","rule:change","rule:remove","account:update"],s=e.extend({get:function(e){e.activeMonth=this.getMonthDate(e.activeMonth);var s=r.date.format(e.activeMonth,r.date.constructor.BACKEND_MONTH_YEAR_FORMAT),o="budget-"+s,u=this.getDatesRange(e.activeMonth),a=new r.Deferred;return this.collectionDefs[o]||this.registerCollection(o,{type:t,loader:{method:this.get,context:this,params:e},subscriptions:i}),r.when(this.getCollection(o,r.extend(u,{force:e?e.force:undefined}))).done(function(e){console.log("[BudgetDataManager] Budget data resolved."),a.resolve(e)}).fail(function(e){console.error("[BudgetDataManager] Error retrieveing budget data",e),a.reject(new n(e))}),a.promise()},getMonthDate:function(e){return e?r.isString(e)&&(e=r.date.parseBackendDate(e)):e=r.date.today(),e},getDatesRange:function(e){e=this.getMonthDate(e);var t=r.date.today(),n=e.getMonth()===t.getMonth()&&e.getFullYear()===e.getFullYear();return{fromDate:r.date.truncate(r.date.constructor.MONTH,e),toDate:n?e:r.date.ceiling(r.date.constructor.MONTH,e)}},getRequestData:function(e,t){return{fromDate:r.date.formatBackendDate(t.fromDate),toDate:r.date.formatBackendDate(t.toDate)}},create:function(e,t){var i=new r.Deferred,s=this;return r.when(e.save(t)).done(function(e){i.resolve(e),s._budgetAdded(e)}).fail(function(e){i.reject(new n(e))}),i.promise()},update:function(e,t){var i=new r.Deferred,s=this;return r.when(e.save(t)).done(function(e){i.resolve(e),s._budgetUpdated(e)}).fail(function(e){i.reject(new n(e))}),i.promise()},remove:function(e){var t=new r.Deferred,i=this;return r.when(e.destroy()).done(function(){t.resolve(),i._budgetRemoved()}).fail(function(e){t.reject(new n(e))}),t.promise()},_budgetAdded:function(e){this.publish("budget:add",e)},_budgetUpdated:function(e){this.publish("budget:change",e)},_budgetRemoved:function(e){this.publish("budget:remove",e)}});return s}),define("services/budget-service",["classes/service","classes/resource-loader","data/budget/budget-model","data/budget/budget-collection","data/budget/budget-data-manager","data/categories/categories-data-manager","utils/util","utils/date"],function(e,t,n,r,i,s,o){var u=e.extend({initialize:function(){this._super.apply(this,arguments),this.budgetDM=i.getInstance(),this.categoriesDM=s.getInstance(),this.resources={categories:new t(this.categoriesDM,this.categoriesDM.get)}},get:function(e){e=e||{},e.activeMonth=this.budgetDM.getMonthDate(e.activeMonth);var n=this.resources.categories,r,i=o.date.format(e.activeMonth,o.date.constructor.BACKEND_MONTH_YEAR_FORMAT),s="budget-"+i;this.resources[s]?r=this.resources[s]:r=this.resources[s]=new t(this.budgetDM,this.budgetDM.get,e);var u=function(){return this._parseBudgets(r,n,i)};return this.executeJob(this,u,[r,n])},_parseBudgets:function(e,t,i){var s=e.data,u,a,f,l=[],c;return s=s.get(i),s=s?s.toJSON():{},t=t.data.hash,u=o.omit(s,"budgets"),a=o.filter(s.budgets,function(e){return!e.parentCatId}),f=o.filter(s.budgets,function(e){return e.parentCatId}),o.each(f,function(e){var n=o.find(a,function(t){return t.catId===e.parentCatId});if(n){if(!n.children||!o.isArray(n.children))n.children=[];n.children.push(e)}else{var r=o.find(l,function(t){return t.catId===e.parentCatId});if(!r){var i=t[e.parentCatId];r={name:i.get("catName"),color:i.get("catHexrgbcolor"),catId:e.parentCatId,value:0,spent:0,children:[],isFake:!0},l.push(r)}r.value+=e.value,r.spent+=e.spent,r.children.push(e)}}),a=a.concat(l),o.each(a,function(e){e.children&&e.children.length&&(e.children=new r(e.children))}),u.children=new r(a),c=new n(u),c},getDatesRange:function(e){return this.budgetDM.getDatesRange(e)},create:function(e,t){return this.budgetDM.create(e,t)},update:function(e,t){return this.budgetDM.update(e,t)},remove:function(e){return this.budgetDM.remove(e)},getNotAvailableCatId:function(e){e=e||o.date.today();var t=new o.Deferred;return o.when(this.get({activeMonth:e})).then(function(e){var n=e.data.get("children"),r=n.reduce(function(e,t){return t.get("isFake")||e.push(t.get("catId")),t.get("children")&&t.get("children").length&&(e=e.concat(t.get("children").pluck("catId"))),e},[]);t.resolve(r)}),t.promise()}},{ID:"budget-service",defaults:{validator:{rules:{budget:{amount:{required:!0,type:"number",range:[[.01,"input[name=minValue]"],1e6]},category:{required:!0,type:"number",notinlist:"cat",min:0},accounts:{required:!0}}}}}});return u}),define("services/budget-service-extension",["services/budget-service","classes/resource-loader","data/budget/budget-model","data/budget/budget-collection","data/budget/budget-data-manager","data/categories/categories-data-manager","utils/util","utils/date"],function(e){var t=e.extend({},{ID:"budget-service",defaults:{validator:{rules:{budget:{amount:{required:!0,type:"number",range:[[.01,"input[name=minValue]"],1e9]},category:{required:!0,type:"number",notinlist:"cat",min:0},accounts:{required:!0}}}}}});return t}),define("widgets/budget/views/budget-summary-view",["classes/item-view","hbs!widgets/budget/templates/budget-summary","services/budget-service","utils/util","utils/number","utils/amount","utils/date"],function(e,t,n,r){var i=e.extend({template:t,initialize:function(){this._super.apply(this,arguments),this.budgetService=n.getInstance(),this._dataReceived=r.bind(this._dataReceived,this),this._dataError=r.bind(this._dataError,this);var e=r.date.today(),t=r.date.daysInMonth(e.getMonth(),e.getFullYear());this.daysLeft=t-e.getDate()},render:function(e){if(e)return this._super();this._getData()},serializeData:function(){return{spent:r.amount.format(this.model.get("spent")||0,!1),available:r.amount.format(this.model.get("available")||0,!1),total:r.amount.format(this.model.get("value")||0,!1),daysLeft:r.number.format(this.daysLeft,!1)}},_getData:function(){return r.when(this.budgetService.get()).fail(this._dataError).done(this._dataReceived)},_dataReceived:function(e){this.dispose(),this._result=e,this._result.on("change",this._dataChanged,this),this._dataChanged(e)},_dataChanged:function(e){this.model=e.data,this.render(!0)},_dataError:function(e){console.error("[BudgetWidget] Failed to retrieve budget data",e),this.publish("error",e)},dispose:function(){this._result&&(this._result.dispose(),this._result=null,this.model=null)},onClose:function(){this.dispose()}});return i}),define("widgets/budget/views/budget-header-view",["classes/layout","hbs!widgets/budget/templates/budget-header","widgets/budget/views/budget-summary-view"],function(e,t,n){var r=e.extend({template:t,regions:{summaryRegion:".sf-summary-placeholder"},onRender:function(){this._super(),this.summaryRegion.show(new n(this.contextConfig))}});return r}),define("hbs!modules/budget-content/templates/budget-content",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression;s+='<div class="sf-budget-content">\n	<div class="sf-budget-total-placeholder"></div>\n	<div class="sf-budget-calendar-placeholder"></div>\n 	<div class="sf-budget-list-placeholder"></div>\n    <div class="sf-budget-exclude-month sf-budget-calendar-placeholder"></div>\n    <div class="sf-budget-disclaimer-text">',a={hash:{}},u=(o=n.t,o?o.call(t,"budget-content.web.disclaimer.transactions",a):f.call(t,"t","budget-content.web.disclaimer.transactions",a));if(u||u===0)s+=u;return s+='</div>\n 	<div class="sf-budget-button-controls sf-budget-controls sf-add-budget-button-container">\n		<div class="sf-budget-button-controls">\n			<button class="sf-button sf-button-add sf-budget-add-triggerer" type="button">\n				<span class="sf-white-circ"><img src="resources/pfm/ui/css/icons/app-icons/dav-plus-red.svg" alt="',a={hash:{}},s+=l((o=n.t,o?o.call(t,"budget-content.web.button.addBudget",a):f.call(t,"t","budget-content.web.button.addBudget",a)))+'"></span>\n				<span class="sf-button-text">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"budget-content.web.button.addBudget",a):f.call(t,"t","budget-content.web.button.addBudget",a)))+'</span>\n			</button>\n		</div>\n	</div>\n	<div class="sf-empty-message">\n		<div class="sf-empty-icon-wrapper">\n			<img src="resources/pfm/ui/css/icons/app-icons/admiration.svg" alt="Signo de admiración">\n		</div>\n		',a={hash:{text:'{{{t "budget-content.web.noBudgets"}}}',"class":"sf-noalerts-list"}},s+=l((o=n.empty,o?o.call(t,a):f.call(t,"empty",a)))+'\n		<div class="sf-budget-button-controls">\n			<button class="sf-button sf-button-add sf-budget-add-triggerer" type="button">\n				<span class="sf-button-text">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"budget-content.button.addOtherBudget",a):f.call(t,"t","budget-content.button.addOtherBudget",a)))+"</span>\n			</button>\n		</div>\n	</div>\n</div>\n",s});return t.registerPartial("modules_budget-content_templates_budget-content",n),n}),define("hbs!modules/budget-content/templates/budget-content-goal-buttons",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-goal-button-controls sf-button-group">\n	<button class="sf-button sf-button-delete sf-budget-delete-triggerer" type="button">\n		<img src="resources/pfm/ui/css/icons/app-icons/dav-budget-trash-can.svg" alt="',u={hash:{}},s+=f((o=n.t,o?o.call(t,"common.button.delete",u):a.call(t,"t","common.button.delete",u)))+'">\n		<span class="sf-button-text">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"common.button.delete",u):a.call(t,"t","common.button.delete",u)))+'</span>\n	</button>\n	<button class="sf-button sf-button-edit sf-budget-edit-triggerer" type="button">\n		<img src="resources/pfm/ui/css/icons/app-icons/dav-budget-edit.svg" alt="',u={hash:{}},s+=f((o=n.t,o?o.call(t,"common.button.edit",u):a.call(t,"t","common.button.edit",u)))+'">\n		<span class="sf-button-text">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"common.button.edit",u):a.call(t,"t","common.button.edit",u)))+"</span>\n	</button>\n</div>\n",s});return t.registerPartial("modules_budget-content_templates_budget-content-goal-buttons",n),n}),define("hbs!modules/budget-content/templates/budget-content-goal-info",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){var r="",i,s,o;r+='\n<div class="sf-goal-info">\n	<div class="sf-goal-data">\n		<div class="cam-recommendation-placeholder" data-cat="',(i=n.catId)?i=i.call(e,{hash:{}}):(i=e.catId,i=typeof i===u?i.apply(e):i),r+=a(i)+'"></div>\n		<div class="sf-goal-category">\n			<div class="sf-goal-subcategory">\n				',i=n["if"].call(e,e.color,{hash:{},inverse:f.noop,fn:f.programWithDepth(h,t,e)});if(i||i===0)r+=i;r+="\n			    ",o={hash:{},inverse:f.noop,fn:f.programWithDepth(v,t,e)},s=(i=n.ifnequal,i?i.call(e,e.type,"total",o):l.call(e,"ifnequal",e.type,"total",o));if(s||s===0)r+=s;r+='\n				<span class="sf-goal-category-name">',(s=n.name)?s=s.call(e,{hash:{}}):(s=e.name,s=typeof s===u?s.apply(e):s),r+=a(s)+'</span>\n			</div>\n		</div>\n		<div class="sf-goal-available">',o={hash:{available:"{{{formatAmount available}}}"}},s=(i=n.t,i?i.call(e,"budget-content.available",o):l.call(e,"t","budget-content.available",o));if(s||s===0)r+=s;r+='</div>\n		<div class="sf-goal-spent">',o={hash:{spent:"{{{formatAmount spent}}}"}},s=(i=n.t,i?i.call(e,"budget-content.spent",o):l.call(e,"t","budget-content.spent",o));if(s||s===0)r+=s;r+='</div>\n		<div class="sf-goal-amount">',o={hash:{}},s=(i=n.formatAmount,i?i.call(e,e.value,o):l.call(e,"formatAmount",e.value,o));if(s||s===0)r+=s;return r+='</div>\n		<span class="sf-goal-slide"></span>\n	</div>\n</div>\n',r}function h(e,t,r){var i="",s,o;i+='\n					<span class="sf-category-color" style="background-color: #'+a((s=r.color,typeof s===u?s.apply(e):s))+';">\n						<img src="resources/pfm/ui/css/icons/category-icons/',o=n["if"].call(e,e.parentCatId,{hash:{},inverse:f.program(5,d,t),fn:f.program(3,p,t)});if(o||o===0)i+=o;return i+='.svg" width="15" height="15">\n					</span>\n				',i}function p(e,t){var r;return(r=n.parentCatId)?r=r.call(e,{hash:{}}):(r=e.parentCatId,r=typeof r===u?r.apply(e):r),a(r)}function d(e,t){var r;return(r=n.catId)?r=r.call(e,{hash:{}}):(r=e.catId,r=typeof r===u?r.apply(e):r),a(r)}function v(e,t,r){var i="",s,o;i+='\n			    <span class="sf-goal-parent-name">'+a((s=r.parentCatName,typeof s===u?s.apply(e):s))+"</span>\n					",o=n["if"].call(e,r.parentCatName,{hash:{},inverse:f.noop,fn:f.program(8,m,t)});if(o||o===0)i+=o;return i+="\n			    ",i}function m(e,t){return'<span class="sf-goal-categories-separator">|</span>'}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=this,l=n.helperMissing;o=n.unless.call(t,t.isFake,{hash:{},inverse:f.noop,fn:f.program(1,c,i)});if(o||o===0)s+=o;return s+="\n",s});return t.registerPartial("modules_budget-content_templates_budget-content-goal-info",n),n}),define("hbs!modules/budget-content/templates/budget-content-goal-bar",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i,s;return r+="\n            ",s={hash:{value:e.spent,total:e.value,expected:e.expected,legendLeft:"value",legendRight:"left",messages:e.barMessages,showStatus:!0,extraClasses:!0}},r+=a((i=n.progressbarmobile,i?i.call(e,s):u.call(e,"progressbarmobile",s)))+"\n		",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u=n.helperMissing,a=this.escapeExpression,f=this;s+='<div class="sf-goal-bar-placeholder">\n    <div class="sf-goal-bar">\n    	',o=n.unless.call(t,t.isFake,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;return s+="\n	</div>\n</div>",s});return t.registerPartial("modules_budget-content_templates_budget-content-goal-bar",n),n}),define("hbs!modules/budget-content/templates/budget-content-goal",["hbs","Handlebars","hbs!modules/budget-content/templates/budget-content-goal-buttons","hbs!modules/budget-content/templates/budget-content-goal-info","hbs!modules/budget-content/templates/budget-content-goal-bar"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r;return(r=n.type)?r=r.call(e,{hash:{}}):(r=e.type,r=typeof r===f?r.apply(e):r),l(r)}function d(e,t){return"default"}function v(e,t){var r="",i;return r+=' data-id="',(i=n.id)?i=i.call(e,{hash:{}}):(i=e.id,i=typeof i===f?i.apply(e):i),r+=l(i)+'"',r}function m(e,t){return";display:none"}function g(e,t){return" display: none;"}function y(e,t){var i="",s;i+="\n            ",s=c.invokePartial(r["modules_budget-content_templates_budget-content-goal-buttons"],"modules_budget-content_templates_budget-content-goal-buttons",e,n,r);if(s||s===0)i+=s;i+='\n            <div class="sf-budget-details-goal-bar">\n            ',s=c.invokePartial(r["modules_budget-content_templates_budget-content-goal-info"],"modules_budget-content_templates_budget-content-goal-info",e,n,r);if(s||s===0)i+=s;i+="\n            ",s=c.invokePartial(r["modules_budget-content_templates_budget-content-goal-bar"],"modules_budget-content_templates_budget-content-goal-bar",e,n,r);if(s||s===0)i+=s;return i+='\n            </div>\n            <div class="sf-menu-details">\n				<img src="resources/pfm/ui/css/icons/app-icons/dav-arrow-right.svg" alt="Flecha derecha">\n            </div>\n		',i}function b(e,t){var i="",s;i+="\n            ",s=c.invokePartial(r["modules_budget-content_templates_budget-content-goal-info"],"modules_budget-content_templates_budget-content-goal-info",e,n,r);if(s||s===0)i+=s;i+="\n            ",s=c.invokePartial(r["modules_budget-content_templates_budget-content-goal-bar"],"modules_budget-content_templates_budget-content-goal-bar",e,n,r);if(s||s===0)i+=s;return i+="\n        ",i}function w(e,t){var r="",i,s;return r+='\n		<div class="sf-budget-details-button-controls sf-button-group">\n			',s={hash:{text:"budget-content.button.details","class":"sf-button-budget-transactions sf-button-list",type:"button"}},r+=l((i=n.button,i?i.call(e,s):h.call(e,"button",s)))+"\n			",s={hash:{text:"budget-content.button.historicExpenses","class":"sf-button-budget-history",type:"button"}},r+=l((i=n.button,i?i.call(e,s):h.call(e,"button",s)))+'\n		</div>\n		<div class="sf-budget-details-content-placeholder"></div>\n		',r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,r=r||e.partials;var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<div class="sf-budget-goal sf-budget-',o=n["if"].call(t,t.type,{hash:{},inverse:c.program(3,d,i),fn:c.program(1,p,i)});if(o||o===0)s+=o;s+='"',a={hash:{},inverse:c.noop,fn:c.program(5,v,i)},u=(o=n.ifnequal,o?o.call(t,t.type,"total",a):h.call(t,"ifnequal",t.type,"total",a));if(u||u===0)s+=u;s+='>\n	<div class="sf-goal-expected-marker sf-first-day-month-marker" style="left: 0%"></div>\n    <div class="sf-goal-expected-marker sf-middle-day-month-marker" style="left: 50%"></div>\n    <div class="sf-goal-expected-marker-placeholder">\n		<div class="sf-goal-expected-marker sf-goal-current-date" style="',(u=n.reference)?u=u.call(t,{hash:{}}):(u=t.reference,u=typeof u===f?u.apply(t):u),s+=l(u)+": ",(u=n.percentage)?u=u.call(t,{hash:{}}):(u=t.percentage,u=typeof u===f?u.apply(t):u),s+=l(u)+"%",a={hash:{},inverse:c.noop,fn:c.program(7,m,i)},u=(o=n.ifnull,o?o.call(t,t.percentage,a):h.call(t,"ifnull",t.percentage,a));if(u||u===0)s+=u;s+='"></div>\n	</div>\n	<div class="sf-goal-expected-marker sf-last-day-month-marker" style="left: 99%; ',u=n["if"].call(t,t.hideTodayLine,{hash:{},inverse:c.noop,fn:c.program(9,g,i)});if(u||u===0)s+=u;s+='"></div>\n	<div class="sf-budget-goal-wrapper">\n	    ',a={hash:{},inverse:c.noop,fn:c.program(11,y,i)},u=(o=n.ifnequal,o?o.call(t,t.type,"total",a):h.call(t,"ifnequal",t.type,"total",a));if(u||u===0)s+=u;s+="\n		",a={hash:{},inverse:c.noop,fn:c.program(13,b,i)},u=(o=n.ifequal,o?o.call(t,t.type,"total",a):h.call(t,"ifequal",t.type,"total",a));if(u||u===0)s+=u;s+='\n	</div>\n\n	<div class="sf-budget-details-placeholder">\n		',a={hash:{},inverse:c.noop,fn:c.program(15,w,i)},u=(o=n.ifnequal,o?o.call(t,t.type,"total",a):h.call(t,"ifnequal",t.type,"total",a));if(u||u===0)s+=u;return s+="\n	</div>\n</div>\n",s});return t.registerPartial("modules_budget-content_templates_budget-content-goal",n),n}),define("hbs!modules/budget-content/templates/budget-total",["hbs","Handlebars","hbs!modules/budget-content/templates/budget-content-goal"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){var i="",s;i+="\n	",s=f.invokePartial(r["modules_budget-content_templates_budget-content-goal"],"modules_budget-content_templates_budget-content-goal",e,n,r);if(s||s===0)i+=s;return i+="\n	",i}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,r=r||e.partials;var s="",o,u,a,f=this,l=n.helperMissing;s+='<div class="sf-budget-total-view">\n	',a={hash:{type:"total"},inverse:f.noop,fn:f.program(1,c,i)},u=(o=n.partial,o?o.call(t,a):l.call(t,"partial",a));if(u||u===0)s+=u;return s+="\n</div>",s});return t.registerPartial("modules_budget-content_templates_budget-total",n),n}),define("modules/budget-content/views/budget-total-view",["classes/item-view","hbs!modules/budget-content/templates/budget-total","utils/util","utils/i18n","utils/tooltip"],function(e,t,n){var r=e.extend({template:t,filterList:["activeMonth"],onRender:function(){this._super(),n.tooltip.add(this.$(".sf-progressbar-tooltip"),this.tooltipOptions)},serializeData:function(){var e=this,t=e.config.textDirection==="rtl",r=e.config.axisDirection==="auto"?t:e.config.axisDirection==="rtl",i=r?"right":"left";return n.extend(this._super(),{name:n.i18n.get("budget-content.totalBudget"),reference:i,barMessages:"budget-content.bar",showCalendar:!this.config.hideCalendar})}});return r}),define("hbs!modules/budget-editor/templates/budget-editor",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r,i;return i={hash:{}},l((r=n.t,r?r.call(e,"budget-editor.description.add",i):f.call(e,"t","budget-editor.description.add",i)))}function d(e,t){var r,i;return i={hash:{}},l((r=n.t,r?r.call(e,"budget-editor.description.edit",i):f.call(e,"t","budget-editor.description.edit",i)))}function v(e,t){return'\n                        <span class="sf-budget-editor-category-placeholder"></span>\n                    '}function m(e,t){var r="",i;r+='\n                        <span class="sf-budgeting-goal-category">\n							<span class="sf-category-color" style="background-color: #',(i=n.color)?i=i.call(e,{hash:{}}):(i=e.color,i=typeof i===c?i.apply(e):i),r+=l(i)+';">\n								<img src="resources/pfm/ui/css/icons/category-icons/',i=n["if"].call(e,e.parentCatId,{hash:{},inverse:h.program(10,y,t),fn:h.program(8,g,t)});if(i||i===0)r+=i;r+='.svg" width="15" height="15">\n							</span>\n							',i=n["if"].call(e,e.parentCatName,{hash:{},inverse:h.noop,fn:h.program(12,b,t)});if(i||i===0)r+=i;return r+='\n							<span class="sf-category-name">',(i=n.name)?i=i.call(e,{hash:{}}):(i=e.name,i=typeof i===c?i.apply(e):i),r+=l(i)+"</span>\n						</span>\n                    ",r}function g(e,t){var r;return(r=n.parentCatId)?r=r.call(e,{hash:{}}):(r=e.parentCatId,r=typeof r===c?r.apply(e):r),l(r)}function y(e,t){var r;return(r=n.catId)?r=r.call(e,{hash:{}}):(r=e.catId,r=typeof r===c?r.apply(e):r),l(r)}function b(e,t){var r="",i;return r+='<span class="sf-parent-category-name">',(i=n.parentCatName)?i=i.call(e,{hash:{}}):(i=e.parentCatName,i=typeof i===c?i.apply(e):i),r+=l(i)+'</span><span class="sf-goal-categories-separator">|</span>',r}function w(e,t){var r="",i,s;return r+='<input type="hidden" name="minValue" value="',s={hash:{}},r+=l((i=n.formatNumber,i?i.call(e,e.minValue,s):f.call(e,"formatNumber",e.minValue,s)))+'"/>',r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function",h=this;s+='<div class="sf-budget-editor sf-budget-content">\n	<form class="sf-budget-editor-form sf-form-vertical sf-budget-editor-form-mobile" data-validate="parsley">\n		<div class="sf-budget-editor-description">',o=n["if"].call(t,t.isNew,{hash:{},inverse:h.program(3,d,i),fn:h.program(1,p,i)});if(o||o===0)s+=o;s+='</div>\n		<fieldset>\n            <div class="sf-form-row sf-form-row-category">\n                <span class="sf-form-cell">\n                    <label for="sf-budget-editor-category" class="sf-budget-editor-category">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"budget-editor.web.category",a):f.call(t,"t","budget-editor.web.category",a)))+"</label>\n                    ",u=n["if"].call(t,t.isNew,{hash:{},inverse:h.program(7,m,i),fn:h.program(5,v,i)});if(u||u===0)s+=u;s+='\n                </span>\n            </div>\n		</fieldset>\n        <div class="sf-budget-average-chart-placeholder"></div>\n		<fieldset>\n			<div class="sf-form-row sf-form-row-goal">\n				<label for="sf-budget-editor-amount" class="sf-budget-editor-amount-label">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"budget-editor.web.amountLabel",a):f.call(t,"t","budget-editor.web.amountLabel",a)))+'</label>\n				<span class="sf-form-cell">\n					',a={hash:{id:"sf-budget-editor-amount",name:"amount",affix:"currency",value:t.value,validateField:"budget.amount"}},s+=l((o=n.textfield,o?o.call(t,a):f.call(t,"textfield",a)))+"\n					",u=n["if"].call(t,t.minValue,{hash:{},inverse:h.noop,fn:h.program(14,w,i)});if(u||u===0)s+=u;return s+='\n				</span>\n			</div>\n		</fieldset>\n		<div class="sf-button-controls">\n            ',a={hash:{text:"common.button.save",type:"button","class":"sf-button-save sf-budget-editor-save"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+"\n			",a={hash:{text:"common.button.cancel","class":"sf-button-cancel sf-budget-cancel-edition",type:"button"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+"\n		</div>\n	</form>\n</div>\n",s});return t.registerPartial("modules_budget-editor_templates_budget-editor",n),n}),define("hbs!modules/analysis-average-chart/templates/analysis-average-chart-accessible",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-analysis-average-chart-accessible"></div>'});return t.registerPartial("modules_analysis-average-chart_templates_analysis-average-chart-accessible",n),n}),define("modules/analysis-average-chart/views/analysis-average-chart-accessible-view",["classes/item-view","classes/collection","utils/util","ui/modules/datagrid/datagrid-module","hbs!modules/analysis-average-chart/templates/analysis-average-chart-accessible","utils/amount","utils/number","utils/percentage"],function(e,t,n,r,i){var s=r.DatagridColumn,o=e.extend({template:i,initialize:function(){this._super.apply(this,arguments);var e=this.config.filters.mode;this.gridConfig={sortField:"date",sortDirection:"DESC",columns:[new s({parent:this,headerClass:"sf-date-header",columnClass:"sf-date-col",field:"date",formatter:function(e){return e.get("formattedMonth")},label:n.i18n.get("analysis-average-chart.accessible.header.date"),sortable:!0}),new s({parent:this,columnClass:"sf-numeric",field:"amount",formatter:function(e){return n.amount.format(e.get("amount"))},label:n.i18n.get("analysis-average-chart.accessible.header.amount."+e),headerClass:"sf-numeric",sortable:!0}),new s({parent:this,columnClass:"sf-numeric",field:"over",formatter:function(e){return n.amount.format(e.get("over"))},label:n.i18n.get("analysis-average-chart.accessible.header.over."+e),headerClass:"sf-numeric",sortable:!0}),new s({parent:this,columnClass:"sf-numeric",field:"average",formatter:function(e){return n.amount.format(e.get("average"))},label:n.i18n.get("analysis-average-chart.accessible.header.average"),headerClass:"sf-numeric",sortable:!0})]}},onRender:function(){this._super();var e=this.model.get("data");if(e){var i=n.extend({dataSource:new t(e),config:this.gridConfig,container:this.$el},this.contextConfig);this.datagrid=new r(i),this.datagrid.render()}},onShow:function(){this.model.on("change",this.render,this)},onClose:function(){this.model.off("change",this.render)}});return o}),define("classes/analysis-average-accessible-chart",["classes/ui/chart/accessible-chart","classes/model","utils/util","services/analysis-service","modules/analysis-average-chart/views/analysis-average-chart-accessible-view"],function(e,t,n,r,i){var s=e.extend({chartConstructor:null,accessibleViewConstructor:i,initialize:function(){this._super.apply(this,arguments),this.model=this.model||new t,this._catId=parseInt(this.options.catId,10),this._analysisService=r.getInstance(),this._dataReceived=n.bind(this._dataReceived,this),this._dataError=n.bind(this._dataError,this)},onShow:function(){this._super(),this.update()},dispose:function(){this.historicDataResult&&(this.historicDataResult.off("change",this._dataChanged),this.historicDataResult=null)},update:function(){var e=this._catId;if(!e||e===-1)return this._dataChanged();n.when(this._analysisService.getAverage({mode:this.config.filters.mode,catId:e})).done(n.bind(this._dataReceived,this)).fail(n.bind(this._dataError,this))},_dataError:function(e){console.error("[AnalysisAverageAccessibleChart] Error retrieving analysis data",e),this.publish("error",e)},_dataReceived:function(e){n.unmask(this.$el),this.dispose(),this.historicDataResult=e,this.historicDataResult.on("change",this._dataChanged,this),this._dataChanged(e)},_dataChanged:function(e){this.model.set(e?e.data:{})},_getDatesRange:function(){var e=n.date.parseBackendDate(this.globals.environment.serverDate),t=n.date.subtract(n.date.constructor.MONTH,e,this.config.monthsRange);return n.date.datesInPeriod(n.date.constructor.MONTH,t,e)},parseTabularSeries:function(e){if(this._isEmpty(e))return;var t=n.map(this._getDatesRange(),function(t){var r=this._getMonthData(t,e.historic),i=this._getPointData(r,e.average),s=n.date.format(t,this.config.dateFormat[this.config.stepScale]);return n.extend(i,{date:t,amount:i.amount+i.over,formattedMonth:s})},this);return{data:t}},_getMonthData:function(e,t){return e=n.date.truncate(this.config.stepScale,e),e=n.date.format(e,this.config.backendDateFormat[this.config.stepScale]),t.models.find?t.models.find(function(t){return t.get("month")===e},this):n.filter(t.models,function(t){return t.get("month")===e})[0]},_getPointData:function(e,t){if(!e)return{amount:0,over:0,remainder:0,average:t};var n=Math.abs(e.get("amount")),r=n-t,i=t-n;return{amount:r>0?t:n,over:r>0?r:0,remainder:i>0?i:0,average:t}},_isEmpty:function(e){return!(e&&e.historic&&e.historic.length)},onClose:function(){this._super(),this.dispose()}},{defaults:{filters:{mode:"expenses"},monthsRange:12,colors:{amount:"#4D97CF",over:"#CA5841",average:"#444444"},stepScale:"month",dateFormat:{month:n.date.constructor.SHORT_MONTH_YEAR},backendDateFormat:{month:n.date.constructor.BACKEND_MONTH_YEAR_FORMAT}}});return s}),define("modules/analysis-average-chart/analysis-average-chart-module",["classes/analysis-average-accessible-chart","ui/modules/columnchart/columnchart-module","d3","utils/util","utils/date","utils/mask"],function(e,t,n,r){var i=e.extend({chartConstructor:t,initialize:function(){this._super.apply(this,arguments),this._initCharts()},_initCharts:function(){var e=this;r.extend(this.chartView,{getYaxisFormat:function(e){return r.unicodeHTMLCodes(r.amount.format(e,!1))},getXaxisFormat:function(t,i,s){var o;!r.isPhone()&&r.date.difference(r.date.constructor.MONTH,t,r.date.today())===0?o=r.i18n.get("analysis-average-chart.currentMonth"):o=r.date.format(t,e.config.dateFormat[e.config.stepScale]);var u=n.select(s.parentNode);return r.each(o.split(" "),function(e,t){u.append("text").attr({dy:t.toString()+".5em","text-anchor":"middle"}).text(e)}),""},solveLabelsCollision:function(){var e=r.isPhone()?"-0.5em":"0";this._$xAxis.selectAll("text").attr({transform:"rotate(-90)",dx:e,dy:function(){var e=this.getAttribute("dy")||"0";return e=e.replace("em",""),e=parseFloat(e),e-=1,e+"em"},"text-anchor":"end"})}})},parseSeries:function(e){if(this._isEmpty(e))return null;r.isPhone()&&(this.config.monthsRange=6);var t=[],n=[],i=[],s=this._getDatesRange();return r.each(s,function(r){var s=this._getMonthData(r,e.historic),o=this._getPointData(s,e.average),u=this._buildTooltip(o);t.push({value:o.amount,title:u}),n.push({value:o.over,title:u}),i.push({value:o.average,title:u})},this),{series:[{points:t,color:this.config.colors.amount,options:{stack:0}},{points:n,color:this.config.colors.over,options:{stack:0}},{points:i,color:this.config.colors.average,options:{type:"line"}}],axis:{x:s}}},_buildTooltip:function(e){var t=this.config.filters.mode,n="analysis-average-chart.tooltip."+(e.over?"over."+t:"remainder"),i=e.over?e.over:e.remainder,s=r.unicodeHTMLCodes(r.amount.format(e.average)),o=r.unicodeHTMLCodes(r.amount.format(i));return r.i18n.get(n,{value:o,mark:s})}},{ID:"analysis-average-chart",submodules:[t],defaults:{chartOptions:{config:{numberOfTicks:3,labelAlign:"middle"}}}});return i}),define("libs/require/css/css!modules/budget-editor/css/budget-editor",[],function(){}),define("modules/budget-editor/budget-editor-module",["classes/layout","data/budget/budget-model","hbs!modules/budget-editor/templates/budget-editor","services/analysis-service","services/budget-service","modules/category-selector/category-selector-module","is!ie8?modules/analysis-average-chart/analysis-average-chart-hc-module:modules/analysis-average-chart/analysis-average-chart-module","ui/modules/reform/category-select/category-select-module","utils/util","utils/validator","utils/mask","utils/number","css!modules/budget-editor/css/budget-editor"],function(e,t,n,r,i,s,o,u,a){var f=e.extend({template:n,events:{"submit .sf-budget-editor-form":"_saveGoal","change select#sf-budget-editor-category":"_categoryChangedHandler"},triggers:{"click .sf-budget-editor-cancel":"cancel"},ui:{$form:".sf-budget-editor-form"},regions:{averageChartRegion:".sf-budget-average-chart-placeholder",accountsSelectorRegion:".sf-accounts-selector-placeholder"},initialize:function(){this.model=this.options.goal||new t({catId:-1}),this.model.set({isNew:this.model.isNew()},{silent:!0}),this._showAverage=this.model.isNew()&&this.config.createAverageEnabled||!this.model.isNew()&&this.config.editAverageEnabled,this._catsAlreadyCreated=[],this._analysisService=r.getInstance(),this._budgetService=i.getInstance(),this._dataReceived=a.bind(this._dataReceived,this),this._averageResultReceived=a.bind(this._averageResultReceived,this),this._categoryChanged=a.bind(this._categoryChanged,this),this.model.on("change:catId",this._categoryChanged)},_getData:function(){var e=this,t=[this._budgetService.getNotAvailableCatId()],n=this.model.get("catId");this.model.isNew()&&n>-1&&t.push(this._analysisService.getAverage({catId:n,mode:this.config.mode})),a.when.apply(this,t).done(this._dataReceived).fail(function(t){console.error("[BudgetEditor] _getData() Error retrieving data",t),e.publish("error",t)})},_dataReceived:function(e,t){this._catsAlreadyCreated=e,t&&this._averageResultReceived(t,!0),this.render(!0)},_averageResultReceived:function(e,t){this.model.set({value:a.number.format(e.data.average)},{silent:!0}),t||this.$("input[name=amount]").val(this.model.get("value"))},render:function(e){if(e)return this._super();this._getData()},serializeData:function(){return this.config.editMode!=="free"?this._super():a.merge(this._super(),{minValue:null})},onRender:function(){this._super(),this.model.isNew()?this._renderCategorySelector():this._initValidation()},_initValidation:function(){u.init(this.ui.$form),a.validator.validate(this.ui.$form),this._showAverage&&this._showAverageChart()},_renderCategorySelector:function(){var e={el:this.$(".sf-budget-editor-category-placeholder"),parentCanBeSelected:!0,selectOptionEnabled:!0,disableCustomEdition:!0,isIncome:!1,separatedCategories:!0,catId:this.model.get("catId"),id:"sf-budget-editor-category",name:"category",validateField:"budget.category",dataCat:this._catsAlreadyCreated},t=new s(a.extend({},this.contextConfig,e));t.on("render",this._initValidation,this),t.render()},_categoryChangedHandler:function(){this.model.set({catId:parseInt(this.$("#sf-budget-editor-category :selected").val(),10)})},_categoryChanged:function(){var e=this,t=this.model.get("catId");a.when(this._analysisService.getAverage({catId:t,mode:this.config.mode})).done(this._averageResultReceived).fail(function(t){console.error("[BudgetEditor] _categoryChanged() Error retrieving data",t),e.publish("error",t)}),this._showAverage&&this._showAverageChart()},_showAverageChart:function(){var e=new o(a.extend({catId:this.model.get("catId"),average:this.model.get("value")},this.contextConfig));this.averageChartRegion.show(e)},_saveGoal:function(e){e.preventDefault();var t=this,n={value:a.number.parse(this.$("input[name=amount]").val())};n.catId=this.model.get("catId"),this.model.isNew()||(n.id=this.model.get("id")),a.mask(this.$el,a.MASK_LOADING),a.when(this._budgetService[this.model.isNew()?"create":"update"](this.model,n)).done(function(){a.unmask(t.$el),t.trigger("save")}).fail(function(e){a.unmask(t.$el),console.error("[BudgetEditor] _saveGoal()... Error saving this form",e),t.publish("error",e)})}},{ID:"budget-editor",services:[i],submodules:[s,o],defaults:{mode:r.EXPENSES_MODE,createAverageEnabled:!0,editAverageEnabled:!0,editMode:"free"}});return f}),define("modules/budget-editor/budget-editor-module-extension",["modules/budget-editor/budget-editor-module","data/budget/budget-model","hbs!modules/budget-editor/templates/budget-editor","services/analysis-service","services/budget-service","modules/category-selector/category-selector-module","is!ie8?modules/analysis-average-chart/analysis-average-chart-hc-module:modules/analysis-average-chart/analysis-average-chart-module","ui/modules/reform/category-select/category-select-module","jQuery","utils/util","utils/validator","utils/mask","utils/number","css!modules/budget-editor/css/budget-editor"],function(e,t,n,r,i,s,o,u,a,f){var l=e.extend({events:{"click .sf-budget-editor-save":"_saveGoal","change select#sf-budget-editor-category":"_categoryChangedHandler","click .sf-budget-cancel-edition":"_cancelBudgetEditor"},initialize:function(){this.model=this.options.goal||new t({catId:this.options.catId}),this.model.set({isNew:this.model.isNew()},{silent:!0}),this._showAverage=this.model.isNew()&&this.config.createAverageEnabled||!this.model.isNew()&&this.config.editAverageEnabled,this._catsAlreadyCreated=[],this._analysisService=r.getInstance(),this._budgetService=i.getInstance(),this._dataReceived=f.bind(this._dataReceived,this),this._averageResultReceived=f.bind(this._averageResultReceived,this),this._categoryChanged=f.bind(this._categoryChanged,this),this.model.on("change:catId",this._categoryChanged),this._categoryChanged()},_saveGoal:function(e){e.preventDefault();var t=this.$(e.currentTarget);if(!this.ui.$form.parsley().validate()||!f.validator.isValid(this.ui.$form))return;var n=this,r={value:f.number.parse(this.$("input[name=amount]").val())};r.catId=this.model.get("catId"),this.model.isNew()||(r.id=this.model.get("id")),f.mask(this.$el,f.MASK_LOADING),f.when(this._budgetService[this.model.isNew()?"create":"update"](this.model,r)).done(function(){f.unmask(n.$el),t.closest(".sf-dialog").hasClass("sf-budget-add-popup")?f.pushToDataLayer({eventCategory:"PFM Presupuesto",eventAction:"Boton",eventLabel:"Guardar-Añadir presupuesto",event:"eventClick"}):f.pushToDataLayer({eventCategory:"PFM Presupuesto",eventAction:"Boton",eventLabel:"Guardar- Editar",event:"eventClick"}),n.trigger("save")}).fail(function(e){f.unmask(n.$el),console.error("[BudgetEditor] _saveGoal()... Error saving this form",e),n.publish("error",e)})},_cancelBudgetEditor:function(){this.trigger("cancel")},_initValidation:function(){u.init(this.ui.$form);var e=this;if(this.ui.$form[0]){var t=f.filter(this.ui.$form[0],function(e){return e.className.indexOf("sf-reform-category-select")<0});this.ui.$form[0]=t}f.validator.validate(this.ui.$form),this._showAverage&&this._showAverageChart()}});return l}),define("hbs!modules/budget-editor/templates/budget-editor-mobile",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r,i;return i={hash:{}},l((r=n.t,r?r.call(e,"budget-editor.description.add",i):f.call(e,"t","budget-editor.description.add",i)))}function d(e,t){var r,i;return i={hash:{}},l((r=n.t,r?r.call(e,"budget-editor.description.edit",i):f.call(e,"t","budget-editor.description.edit",i)))}function v(e,t){return'\n					<span class="sf-budget-editor-category-placeholder"></span>\n					'}function m(e,t){var r="",i;return r+='\n					<span class="sf-budgeting-goal-category"><span class="sf-category-color" style="background-color: #',(i=n.color)?i=i.call(e,{hash:{}}):(i=e.color,i=typeof i===c?i.apply(e):i),r+=l(i)+';"></span>',(i=n.name)?i=i.call(e,{hash:{}}):(i=e.name,i=typeof i===c?i.apply(e):i),r+=l(i)+"</span>\n					",r}function g(e,t){var r="",i,s;return r+='<input type="hidden" name="minValue" value="',s={hash:{}},r+=l((i=n.formatNumber,i?i.call(e,e.minValue,s):f.call(e,"formatNumber",e.minValue,s)))+'"/>',r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function",h=this;s+='<div class="sf-budget-editor">\n	<form class="sf-budget-editor-form sf-form-vertical sf-budget-editor-form-mobile" data-validate="parsley">\n		<div class="sf-budget-editor-description">',o=n["if"].call(t,t.isNew,{hash:{},inverse:h.program(3,d,i),fn:h.program(1,p,i)});if(o||o===0)s+=o;s+='</div>\n		<fieldset>\n			<div class="sf-form-row sf-form-row-category">\n				<span class="sf-form-cell">\n					<label for="sf-budget-editor-category" class="sf-budget-editor-category">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"budget-editor.category",a):f.call(t,"t","budget-editor.category",a)))+"</label>\n					",u=n["if"].call(t,t.isNew,{hash:{},inverse:h.program(7,m,i),fn:h.program(5,v,i)});if(u||u===0)s+=u;s+='\n				</span>\n			</div>\n			<div class="sf-form-row sf-form-row-goal">\n				<span class="sf-form-cell">\n					',a={hash:{id:"sf-budget-editor-amount",name:"amount",affix:"currency",value:t.value,validateField:"budget.amount"}},s+=l((o=n.textfield,o?o.call(t,a):f.call(t,"textfield",a)))+"\n					",u=n["if"].call(t,t.minValue,{hash:{},inverse:h.noop,fn:h.program(9,g,i)});if(u||u===0)s+=u;return s+='\n				</span>\n			</div>\n		</fieldset>\n		<span class="sf-goal-slide sf-budget-average">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"budget-editor.budget-average-slide-message",a):f.call(t,"t","budget-editor.budget-average-slide-message",a)))+'</span>\n		<div class="sf-budget-average-chart-placeholder"></div>\n		<span class="sf-goal-slide sf-budget-historic-expenses">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"budget-editor.budget-historic-transactions",a):f.call(t,"t","budget-editor.budget-historic-transactions",a)))+'</span>\n		<div class="sf-budget-transactions-placeholder"></div>\n		<div class="sf-button-controls">\n			',a={hash:{text:"common.button.cancel",type:"button","class":"sf-button-cancel sf-budget-editor-cancel"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+"\n			",a={hash:{text:"common.button.delete",type:"button","class":"sf-button-delete sf-budget-editor-delete"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+"\n			",a={hash:{text:"common.button.save",type:"button","class":"sf-button-save sf-budget-editor-save"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+"\n		</div>\n  	</form>\n</div>",s});return t.registerPartial("modules_budget-editor_templates_budget-editor-mobile",n),n}),define("modules/budget-editor/budget-editor-module-mobile",["modules/budget-editor/budget-editor-module","hbs!modules/budget-editor/templates/budget-editor-mobile","modules/transactions-details/transactions-details-module","ui/modules/popup/popup-module","services/budget-service","utils/util"],function(e,t,n,r,i,s){var o=e.extend({filtersList:["activeMonth"],template:t,events:{"submit .sf-budget-editor-form":"_saveGoal","change select#sf-budget-editor-category":"_categoryChangedHandler","click .sf-budget-average":"_showBudgetHistory","click .sf-budget-historic-expenses":"_showTransactions","click .sf-budget-editor-delete":"_showDeleteHandler"},ui:{$form:".sf-budget-editor-form",averageSlide:".sf-budget-average",transactionsSlide:".sf-budget-historic-expenses",transactions:".sf-budget-transactions-placeholder"},regions:{averageChartRegion:".sf-budget-average-chart-placeholder",accountsSelectorRegion:".sf-accounts-selector-placeholder",transactionsRegion:".sf-budget-transactions-placeholder"},initialize:function(e){this._super(e),this._service=i.getInstance(),this.budgetMonthsAverageVisible=!1,this.budgetTransactionsVisible=!1},_showBudgetHistory:function(){this.budgetMonthsAverageVisible=!this.budgetMonthsAverageVisible,this.budgetMonthsAverageVisible?(this.$el.find(".sf-budget-average-chart-placeholder").show(),this._showAverageChart(),this.ui.averageSlide.addClass("sf-goal-slide-up")):(this.averageChartRegion.$el.hide(),this.ui.averageSlide.removeClass("sf-goal-slide-up"))},_showTransactions:function(){this.budgetTransactionsVisible=!this.budgetTransactionsVisible,this.budgetTransactionsVisible?(this.$el.find(".sf-budget-transactions-placeholder").show(),this._showBudgetTransactions(),this.ui.transactionsSlide.addClass("sf-goal-slide-up")):(this.transactionsRegion.$el.hide(),this.ui.transactionsSlide.removeClass("sf-goal-slide-up"))},_showBudgetTransactions:function(){var e=s.extend({},this.contextConfig,{config:{filters:{datesRange:this._service.getDatesRange(s.date.parseBackendDate(this.filters.activeMonth)),category:this.model.get("catId")}}});this.transactionsRegion.show(new n(e))},_showDeleteHandler:function(e){var t=this,n=function(){u.remove()},i={title:s.i18n.get("budget-content.deletePopup.title"),content:s.i18n.get("budget-content.deletePopup.content",{budget:this.model.get("name")}),type:r.CONFIRM,confirmCallback:function(){t._service.remove(t.model).fail(function(e){t.publish("error",e)}).always(function(){u.remove(),t.trigger("closePopup")})},cancelCallback:n},o=s.extend({},this.contextConfig,{$container:this.options.$popupContainer,$opener:this.$(e.currentTarget)},i),u=new r(o);return u.open(),!1}},{});return o}),define("data/budget-history/budget-history-collection",["classes/collection","classes/model"],function(e,t){var n=e.extend({model:t,url:"/budgetgoals/history/get.action"});return n}),define("data/budget-history/budget-history-data-manager",["classes/data-manager","data/budget-history/budget-history-collection"],function(e,t){var n=e.extend({initialize:function(){this._super.apply(this,arguments),this.collectionDefs={historicExpenses:{type:t,subscriptions:["transaction:change","transaction:amount:change","transaction:category:change","transaction:date:change","account:update"]}}},get:function(e,t){return this.getCollection("historicExpenses",{id:e,force:t})}});return n}),define("services/budget-history-service",["classes/service","data/budget-history/budget-history-data-manager"],function(e,t){var n=e.extend({initialize:function(){this._super.apply(this,arguments),this.historicExpensesDM=t.getInstance()},get:function(e){return this.historicExpensesDM.get(e,!0)}},{ID:"budget-history-service"});return n}),define("hbs!modules/budget-history-chart/templates/budget-history-chart-accessible",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-budget-history-chart-accessible"></div>'});return t.registerPartial("modules_budget-history-chart_templates_budget-history-chart-accessible",n),n}),define("modules/budget-history-chart/views/budget-history-chart-accessible-view",["classes/item-view","classes/collection","utils/util","ui/modules/datagrid/datagrid-module","hbs!modules/budget-history-chart/templates/budget-history-chart-accessible","utils/amount","utils/number","utils/percentage"],function(e,t,n,r,i){var s=r.DatagridColumn,o=e.extend({template:i,initialize:function(){this._super.apply(this,arguments),this._getConfig(),this.data=new t(this.options.dataSource),this.render()},_getConfig:function(){this.gridConfig={sortField:"date",sortDirection:"DESC",columns:[new s({parent:this,headerClass:"sf-date-header",columnClass:"sf-date-col",field:"date",formatter:function(e){return e.get("formattedMonth")},label:n.i18n.get("budget-history-chart.accessible.header.date"),sortable:!0}),new s({parent:this,columnClass:"sf-numeric sf-spent-col",field:"spent",formatter:function(e){return n.amount.format(e.get("spent")||0)},label:n.i18n.get("budget-history-chart.accessible.header.spent"),headerClass:"sf-numeric",sortable:!0}),new s({parent:this,columnClass:"sf-numeric sf-overspent-col",field:"overspent",formatter:function(e){return n.amount.format(e.get("overspent")||0)},label:n.i18n.get("budget-history-chart.accessible.header.overspent"),headerClass:"sf-numeric",sortable:!0}),new s({parent:this,columnClass:"sf-numeric sf-budget-col",field:"budget",formatter:function(e){return n.amount.format(e.get("budget")||0)},label:n.i18n.get("budget-history-chart.accessible.header.budget"),headerClass:"sf-numeric",sortable:!0})]}},onRender:function(){this._super();var e=this.model.get("data");if(e){var i=n.extend({dataSource:new t(e),config:this.gridConfig,container:this.$el},this.contextConfig);this.datagrid=new r(i),this.datagrid.render()}},onShow:function(){this.model.on("change",this.render,this)},onClose:function(){this.model.off("change",this.render)}});return o}),define("classes/budget-history-accessible-chart",["classes/ui/chart/accessible-chart","classes/model","services/budget-history-service","modules/budget-history-chart/views/budget-history-chart-accessible-view","utils/util"],function(e,t,n,r,i){var s=e.extend({chartConstructor:null,accessibleViewConstructor:r,initialize:function(){this._super.apply(this,arguments),this.model=this.model||new t,this.historicService=n.getInstance(),this._dataReceived=i.bind(this._dataReceived,this),this._dataError=i.bind(this._dataError,this)},onShow:function(){this._super(),this.update()},dispose:function(){this.historicDataResult&&(this.historicDataResult.off("change",this._dataChanged),this.historicDataResult=null)},update:function(){var e=this.model.get("id");if(!e)return;i.mask(this.$el,i.MASK_LOADING),i.when(this.historicService.get(e)).done(this._dataReceived).fail(this._dataError)},_dataError:function(e){console.error("[BudgetAccessibleChart] Error retrieving analysis data",e),this.publish("error",e)},_dataReceived:function(e){i.unmask(this.$el),this.dispose(),this.historicDataResult=e,this.historicDataResult.on("change",this._historicDataChanged,this),this._dataChanged(e)},_dataChanged:function(e){this.historicData=this.historicData||{},this.historicData.budget=this.model,this.historicData.historic=e.models,this.model.set(this.historicData)},_getDatesRange:function(){var e=i.date.parseBackendDate(this.globals.environment.serverDate),t=i.date.subtract(i.date.constructor.MONTH,e,this.config.monthsRange),n=i.date.subtract(i.date.constructor.MONTH,e,1);return i.date.datesInPeriod(i.date.constructor.MONTH,t,n)},parseTabularSeries:function(e){if(i.isEmpty(e))return;var t=e.budget&&e.budget.get("value"),n=i.map(this._getDatesRange(),function(n){var r=this._getMonthData(n,e),s=this._getPointData(r,t),o=i.date.format(n,this.config.dateFormat[this.config.stepScale]);return i.extend(s,{date:n,spent:s.spent+s.overspent,formattedMonth:o})},this);return{data:n}},_getMonthData:function(e,t){return e=i.date.truncate(this.config.stepScale,e),e=i.date.formatBackendDate(e),i.find(t.historic,function(t){return t.get("startDate")===e})},_getPointData:function(e,t){if(!e)return{spent:0,overspent:0,remainder:0,budget:this.config.useCurrentBudget?t:0};var n=Math.abs(e.get("spent")),r=n-t,i=t-n;return{spent:r>0?t:n,overspent:r>0?r:0,remainder:i>0?i:0,budget:this.config.useCurrentBudget?t:e.get("value")}}},{defaults:{useCurrentBudget:!0,monthsRange:12,colors:{spent:"#4D97CF",overspent:"#CA5841",budget:"#444444"},stepScale:"month",dateFormat:{month:i.date.constructor.SHORT_MONTH_YEAR},backendDateFormat:{month:i.date.constructor.BACKEND_MONTH_YEAR_FORMAT}}});return s}),define("classes/budget-history-accessible-chart-extension",["classes/budget-history-accessible-chart","utils/util"],function(e,t){var n=e.extend({onShow:function(){this._super.apply(this,arguments),t.unmask(this.$el)}});return n}),define("modules/budget-history-chart/budget-history-chart-module",["classes/budget-history-accessible-chart","d3","utils/util","ui/modules/columnchart/columnchart-module","utils/date","utils/mask"],function(e,t,n,r){var i=e.extend({chartConstructor:r,initialize:function(){this._super.apply(this,arguments),this._initCharts()},_initCharts:function(){var e=this;n.extend(this.chartView,{getYaxisFormat:function(e){return n.unicodeHTMLCodes(n.amount.format(e,!1))},getXaxisFormat:function(r,i,s){var o=n.date.format(r,e.config.dateFormat[e.config.stepScale]),u=t.select(s.parentNode);return n.each(o.split(" "),function(e,t){u.append("text").attr({dy:t.toString()+".5em","text-anchor":"middle"}).text(e)}),""},solveLabelsCollision:function(){this._$xAxis.selectAll("text").attr({transform:"rotate(-90)",dy:function(){var e=this.getAttribute("dy")||"0";return e=e.replace("em",""),e=parseFloat(e),e-=1,e+"em"},"text-anchor":"end"})}})},parseSeries:function(e){console.log("[BudgetHistoryChart] Parsing data: ",e);if(n.isEmpty(e)||n.isEmpty(e.historic))return null;var t=e.budget&&e.budget.get("value"),r=[],i=[],s=[],o=this._getDatesRange();return n.each(o,function(n){var o=this._getMonthData(n,e),u=this._getPointData(o,t),a=this._buildTooltip(u);r.push({value:u.spent,title:a}),i.push({value:u.overspent,title:a}),s.push({value:u.budget,title:a})},this),{series:[{points:r,color:this.config.colors.spent,options:{stack:0}},{points:i,color:this.config.colors.overspent,options:{stack:0}},{points:s,color:this.config.colors.budget,options:{type:"line"}}],axis:{x:o}}},_buildTooltip:function(e){var t="budget-history-chart.tooltip."+(e.overspent?"overspent":"remainder"),r=e.overspent?e.overspent:e.remainder,i=n.unicodeHTMLCodes(n.amount.format(e.budget)),s=n.unicodeHTMLCodes(n.amount.format(r));return n.i18n.get(t,{value:s,mark:i})}},{ID:"budget-history-chart",submodules:[r],defaults:{chartOptions:{config:{numberOfTicks:3,labelAlign:"middle"}}}});return i}),define("classes/budget-item-view-mobile",["classes/layout","services/budget-service","modules/budget-editor/budget-editor-module-mobile","modules/transactions-details/transactions-details-module","is!ie8?modules/budget-history-chart/budget-history-chart-hc-module:modules/budget-history-chart/budget-history-chart-module","ui/modules/popup/popup-module","utils/util","utils/date","utils/i18n","utils/tooltip"],function(e,t,n,r,i,s,o){var u=e.extend({filtersList:["activeMonth"],ui:{detailsButton:".sf-button-budget-transactions",details:".sf-budget-details-placeholder",slide:".sf-goal-slide",expectedMarker:".sf-goal-expected-marker",goal:".sf-budget-goal"},regions:{detailsRegion:".sf-budget-details-content-placeholder"},events:{"click .sf-budget-goal-wrapper":"_showDetailsPopupHandler","click .sf-button-budget-history":"_showHistoryHandler","click .sf-button-budget-transactions":"_showTransactionsHandler",elementResize:"_onElementResize"},initialize:function(){this._super.apply(this,arguments),this._service=t.getInstance(),this._previousDetailsView=null},onShow:function(){this.detailsRegion.on("close",this._closeDetails,this),o.tooltip.add(this.$(".sf-progressbar-tooltip"),this.tooltipOptions)},serializeData:function(){var e=this,t=this.config.textDirection==="rtl",n=this.config.axisDirection==="auto"?t:e.config.axisDirection==="rtl";return o.extend(this._super(),{barMessages:"budget-content.bar",reference:n?"right":"left"})},_closeDetails:function(){this.ui.details.hide(),this.ui.slide.removeClass("sf-goal-slide-up"),this._previousDetailsView=null},_ensureDetailsState:function(e){this.ui.details.show(),this.ui.slide.addClass("sf-goal-slide-up"),this.$(".sf-budget-details-button-controls .sf-button").removeClass("sf-active"),e?this.$(e.currentTarget).addClass("sf-active"):this.ui.detailsButton.addClass("sf-active")},_showHistoryHandler:function(e){if(this._previousDetailsView==="history")return!1;var t=o.extend({model:this.model},this.contextConfig);return this.detailsRegion.show(new i(t)),this._ensureDetailsState(e),this._previousDetailsView="history",!1},_showTransactionsHandler:function(e){if(this._previousDetailsView==="transactions")return!1;var t=o.extend({},this.contextConfig,{config:{filters:{datesRange:this._service.getDatesRange(o.date.parseBackendDate(this.filters.activeMonth)),category:this.model.get("catId")}}});return this.detailsRegion.show(new r(t)),this._ensureDetailsState(e),this._previousDetailsView="transactions",!1},_toggleDetailsHandler:function(){return this.detailsRegion.currentView&&!this.detailsRegion.currentView.isClosed?this.detailsRegion.close():this._showTransactionsHandler(),!1},_getPopup:function(e,t){var n=o.extend({},this.contextConfig,{$container:this.options.$popupContainer,$opener:this.$(e.currentTarget)},t);return new s(n)},_showEditHandler:function(e){var t=function(){s.remove()},r={title:o.i18n.get(this.model.isNew()?"budget-content.addBudgetPopup.title":"budget-content.editBudgetPopup.title"),closeCallback:t},i=o.extend({goal:this.model,config:this.config},this.contextConfig),s=this._getPopup(e,r),u=new n(i);return u.on("save",t),u.on("cancel",t),s.contentRegion.once("show",s.open,s),s.contentRegion.show(u),!1},_showDetailsPopupHandler:function(e){var t=function(){s.remove()},r={title:o.i18n.get("budget-content.detailsBudgetPopup.title"),closeCallback:t},i=o.extend({goal:this.model,config:this.config},this.contextConfig),s=this._getPopup(e,r),u=new n(i);return u.on("save",t),u.on("cancel",t),u.on("closePopup",t),s.contentRegion.once("show",s.open,s),s.contentRegion.show(u),!1},_showDeleteHandler:function(e){var t=this,n=function(){i.remove()},r={title:o.i18n.get("budget-content.deletePopup.title"),content:o.i18n.get("budget-content.deletePopup.content",{budget:this.model.get("name")}),type:s.CONFIRM,confirmCallback:function(){t._service.remove(t.model).fail(function(e){t.publish("error",e)}).always(function(){i.remove()})},cancelCallback:n},i=this._getPopup(e,r);return i.open(),!1},_onElementResize:function(){var e=this.ui.goal.height()-this.ui.details.height();this.ui.expectedMarker.css("height",e+"px")}});return u}),define("classes/budget-item-view",["classes/layout","services/budget-service","modules/budget-editor/budget-editor-module","modules/transactions-details/transactions-details-module","is!ie8?modules/budget-history-chart/budget-history-chart-hc-module:modules/budget-history-chart/budget-history-chart-module","ui/modules/popup/popup-module","utils/util","utils/date","utils/i18n","utils/tooltip"],function(e,t,n,r,i,s,o){var u=e.extend({filtersList:["activeMonth"],ui:{detailsButton:".sf-button-budget-transactions",details:".sf-budget-details-placeholder",slide:".sf-goal-slide",expectedMarker:".sf-goal-expected-marker",goal:".sf-budget-goal"},regions:{detailsRegion:".sf-budget-details-content-placeholder"},events:{"click .sf-budget-edit-triggerer":"_showEditHandler","click .sf-budget-delete-triggerer":"_showDeleteHandler","click .sf-budget-goal-wrapper":"_toggleDetailsHandler","click .sf-button-budget-history":"_showHistoryHandler","click .sf-button-budget-transactions":"_showTransactionsHandler",elementResize:"_onElementResize"},initialize:function(){this._super.apply(this,arguments),this._service=t.getInstance(),this._previousDetailsView=null},onShow:function(){this.detailsRegion.on("close",this._closeDetails,this),o.tooltip.add(this.$(".sf-progressbar-tooltip"),this.tooltipOptions)},serializeData:function(){var e=this,t=this.config.textDirection==="rtl",n=this.config.axisDirection==="auto"?t:e.config.axisDirection==="rtl";return o.extend(this._super(),{barMessages:"budget-content.bar",reference:n?"right":"left"})},_closeDetails:function(){this.ui.details.hide(),this.ui.slide.removeClass("sf-goal-slide-up"),this._previousDetailsView=null},_ensureDetailsState:function(e){this.ui.details.show(),this.ui.slide.addClass("sf-goal-slide-up"),this.$(".sf-budget-details-button-controls .sf-button").removeClass("sf-active"),e?this.$(e.currentTarget).addClass("sf-active"):this.ui.detailsButton.addClass("sf-active")},_showHistoryHandler:function(e){if(this._previousDetailsView==="history")return!1;var t=o.extend({model:this.model},this.contextConfig);return this.detailsRegion.show(new i(t)),this._ensureDetailsState(e),this._previousDetailsView="history",!1},_showTransactionsHandler:function(e){if(this._previousDetailsView==="transactions")return!1;var t=o.extend({},this.contextConfig,{config:{filters:{datesRange:this._service.getDatesRange(o.date.parseBackendDate(this.filters.activeMonth)),category:this.model.get("catId")}}});return this.detailsRegion.show(new r(t)),this._ensureDetailsState(e),this._previousDetailsView="transactions",!1},_toggleDetailsHandler:function(){return this.detailsRegion.currentView&&!this.detailsRegion.currentView.isClosed?this.detailsRegion.close():this._showTransactionsHandler(),!1},_getPopup:function(e,t){var n=o.extend({},this.contextConfig,{$container:this.options.$popupContainer,$opener:this.$(e.currentTarget)},t);return new s(n)},_showEditHandler:function(e){var t=function(){s.remove()},r={title:o.i18n.get(this.model.isNew()?"budget-content.addBudgetPopup.title":"budget-content.editBudgetPopup.title"),closeCallback:t},i=o.extend({goal:this.model,config:this.config},this.contextConfig),s=this._getPopup(e,r),u=new n(i);return u.on("save",t),u.on("cancel",t),s.contentRegion.once("show",s.open,s),s.contentRegion.show(u),!1},_showDeleteHandler:function(e){var t=this,n=function(){i.remove()},r={title:o.i18n.get("budget-content.deletePopup.title"),content:o.i18n.get("budget-content.deletePopup.content",{budget:this.model.get("name")}),type:s.CONFIRM,confirmCallback:function(){t._service.remove(t.model).fail(function(e){t.publish("error",e)}).always(function(){i.remove()})},cancelCallback:n},i=this._getPopup(e,r);return i.open(),!1},_onElementResize:function(){var e=this._previousDetailsView===null?this.ui.goal.outerHeight():this.ui.goal.outerHeight()-this.ui.details.outerHeight();this.ui.expectedMarker.css("height",e+"px")}});return u}),define("classes/budget-item-view-extension",["classes/budget-item-view","ui/modules/popup/popup-module","modules/budget-editor/budget-editor-module","utils/util"],function(e,t,n,r){var i=e.extend({_ensureDetailsState:function(e){this.ui.details.slideDown("fast"),this.ui.slide.addClass("sf-goal-slide-up"),this.$(".sf-budget-goal-wrapper").addClass("sf-opened"),this.$(".sf-budget-details-button-controls .sf-button").removeClass("sf-active"),e?this.$(e.currentTarget).addClass("sf-active"):this.ui.detailsButton.addClass("sf-active")},_closeDetails:function(){this.$(".sf-budget-goal-wrapper").removeClass("sf-opened"),this.ui.details.slideUp("fast"),this.ui.slide.removeClass("sf-goal-slide-up"),this._previousDetailsView=null},_showEditHandler:function(e){r.pushToDataLayer({eventCategory:"PFM Presupuesto",eventAction:"Boton",eventLabel:"Editar",event:"eventClick"});var t=function(){r.pushToDataLayer({eventCategory:"PFM Presupuesto",eventAction:"Boton",eventLabel:"Cancelar- Editar",event:"eventClick"}),u.remove()},i=function(){u.remove()},s={title:r.i18n.get(this.model.isNew()?"budget-content.addBudgetPopup.title":"budget-content.editBudgetPopup.title"),titleIcon:"dav-white-edit","class":"sf-edit-budget-popup",disableClosePopup:!0,subtitle:r.i18n.get("budget-content.editBudgetPopup.subtitle"),closeCallback:t},o=r.extend({goal:this.model,config:this.config},this.contextConfig),u=this._getPopup(e,s),a=new n(o);return a.on("save",i),a.on("cancel",t),u.contentRegion.once("show",u.open,u),u.contentRegion.show(a),!1},_showHistoryHandler:function(e){r.pushToDataLayer({eventCategory:"PFM Presupuesto-Detalle Presupuesto",eventAction:"Boton",eventLabel:"Visualizacion Grafico",event:"eventClick"}),this._super.apply(this,arguments)},_showTransactionsHandler:function(e){r.pushToDataLayer({eventCategory:"PFM Presupuesto-Detalle Presupuesto",eventAction:"Boton",eventLabel:"Visualizacion listado",event:"eventClick"}),r.pushToDataLayer({eventCategory:"PFM Presupuesto",eventAction:"Boton",eventLabel:"Detalle Presupuesto",event:"eventClick"}),this._super.apply(this,arguments)},_showDeleteHandler:function(e){r.pushToDataLayer({eventCategory:"PFM Presupuesto",eventAction:"Boton",eventLabel:"Eliminar",event:"eventClick"});var n=this,i=function(){r.pushToDataLayer({eventCategory:"PFM Presupuesto",eventAction:"Boton",eventLabel:"Cancelar -Eliminar",event:"eventClick"}),o.remove()},s={title:r.i18n.get("budget-content.web.deletePopup.title"),titleIcon:"dav-white-trash-can",content:r.i18n.get("budget-content.deletePopup.content",{budget:this.model.get("name")}),type:t.CONFIRM,confirmCallback:function(){n._service.remove(n.model).fail(function(e){n.publish("error",e)}).always(function(){r.pushToDataLayer({eventCategory:"PFM Presupuesto",eventAction:"Boton",eventLabel:"Aceptar-Eliminar",event:"eventClick"}),o.remove()})},cancelCallback:i},o=this._getPopup(e,s);return o.open(),!1}});return i}),define("hbs!modules/budget-content/templates/budget-parent-model",["hbs","Handlebars","hbs!modules/budget-content/templates/budget-content-goal"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){var r="",i;r+="\n			",i=n.unless.call(e,e.isFake,{hash:{},inverse:f.noop,fn:f.program(2,h,t)});if(i||i===0)r+=i;return r+="\n		",r}function h(e,t){var i="",s;i+="\n				",s=f.invokePartial(r["modules_budget-content_templates_budget-content-goal"],"modules_budget-content_templates_budget-content-goal",e,n,r);if(s||s===0)i+=s;return i+="\n			",i}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,r=r||e.partials;var s="",o,u,a,f=this,l=n.helperMissing;s+='<li class="sf-budget-parent-model-view">\n	<div class="sf-budget-parent-view">\n		',a={hash:{type:"parent"},inverse:f.noop,fn:f.program(1,c,i)},u=(o=n.partial,o?o.call(t,a):l.call(t,"partial",a));if(u||u===0)s+=u;return s+='\n	</div>\n	<div class="sf-budget-children-placeholder"></div>\n</li>',s});return t.registerPartial("modules_budget-content_templates_budget-parent-model",n),n}),define("hbs!modules/budget-content/templates/budget-child-model",["hbs","Handlebars","hbs!modules/budget-content/templates/budget-content-goal"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,r=r||e.partials;var s="",o,u=this;s+='<li class="sf-budget-child-model-view">\n	',o=u.invokePartial(r["modules_budget-content_templates_budget-content-goal"],"modules_budget-content_templates_budget-content-goal",t,n,r);if(o||o===0)s+=o;return s+="\n</li>",s});return t.registerPartial("modules_budget-content_templates_budget-child-model",n),n}),define("modules/budget-content/views/budget-child-model-view",["is!phone?classes/budget-item-view-mobile:classes/budget-item-view","hbs!modules/budget-content/templates/budget-child-model"],function(e,t){var n=e.extend({template:t});return n}),define("hbs!modules/budget-content/templates/budget-child-collection",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-budget-child-collection-view">\n	<ul class="sf-child-budget-list"></ul>\n</div>'});return t.registerPartial("modules_budget-content_templates_budget-child-collection",n),n}),define("modules/budget-content/views/budget-child-collection-view",["classes/composite-view","modules/budget-content/views/budget-child-model-view","hbs!modules/budget-content/templates/budget-child-collection","utils/util"],function(e,t,n,r){var i=e.extend({filtersList:["activeMonth"],template:n,itemView:t,itemViewContainer:".sf-child-budget-list",itemViewOptions:function(e){return r.extend({model:e},this.contextConfig)}});return i}),define("modules/budget-content/views/budget-parent-model-view",["is!phone?classes/budget-item-view-mobile:classes/budget-item-view","hbs!modules/budget-content/templates/budget-parent-model","modules/budget-content/views/budget-child-collection-view","utils/util"],function(e,t,n,r){var i=e.extend({template:t,ui:r.extend({},e.prototype.ui,{details:".sf-budget-parent .sf-budget-details-placeholder"}),regions:r.extend({},e.prototype.regions,{childrenRegion:".sf-budget-children-placeholder",detailsRegion:".sf-budget-parent .sf-budget-details-content-placeholder"}),onRender:function(){this._super(),this._showChildren()},_showChildren:function(){var e=r.extend({collection:this.model.get("children")},this.contextConfig);this.childrenRegion.show(new n(e))}});return i}),define("hbs!modules/budget-content/templates/budget-parent-collection",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-budget-parent-collection-view">\n	<ul class="sf-parent-budget-list"></ul>\n</div>'});return t.registerPartial("modules_budget-content_templates_budget-parent-collection",n),n}),define("modules/budget-content/views/budget-parent-collection-view",["classes/composite-view","modules/budget-content/views/budget-parent-model-view","hbs!modules/budget-content/templates/budget-parent-collection","utils/util"],function(e,t,n,r){var i=e.extend({filtersList:["activeMonth"],template:n,itemView:t,itemViewContainer:".sf-parent-budget-list",itemViewOptions:function(e){return r.extend({model:e},this.contextConfig)}});return i}),define("hbs!ui/modules/budget-calendar/templates/budget-calendar",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){return" sf-budget-calendar-show-date"}function h(e,t){return" sf-budget-calendar-show-mondays"}function p(e,t){var r="",i,s,o;return r+='\n		<div class="sf-contenedor-hoy">\n            <div class="sf-contenedor-hoy-wrapper">\n			    <div class="sf-budget-calendar-today" style="',(i=n.reference)?i=i.call(e,{hash:{}}):(i=e.reference,i=typeof i===u?i.apply(e):i),r+=a(i)+": ",(i=n.percentage)?i=i.call(e,{hash:{}}):(i=e.percentage,i=typeof i===u?i.apply(e):i),r+=a(i)+'%">',o={hash:{}},r+=a((i=n.formatDate,i?i.call(e,e.date,e.todayFormat,o):f.call(e,"formatDate",e.date,e.todayFormat,o)))+'\n                </div>\n			</div>\n		</div>\n\n	<div class="sf-budget-calendar-last-day-month">',(s=n.lastDayMonth)?s=s.call(e,{hash:{}}):(s=e.lastDayMonth,s=typeof s===u?s.apply(e):s),r+=a(s)+"\n	</div>\n	",r}function d(e,t){var r="",i;r+='\n	<div class="sf-budget-calendar-mondays">\n	',i=n.each.call(e,e.mondays,{hash:{},inverse:l.noop,fn:l.programWithDepth(v,t,e)});if(i||i===0)r+=i;return r+="\n	</div>\n	",r}function v(e,t,r){var i="",s,o,l;return i+='\n		<div class="sf-budget-calendar-monday" style="'+a((s=r.reference,typeof s===u?s.apply(e):s))+": ",(o=n.percentage)?o=o.call(e,{hash:{}}):(o=e.percentage,o=typeof o===u?o.apply(e):o),i+=a(o)+'%">',l={hash:{}},i+=a((s=n.formatDate,s?s.call(e,e.date,r.mondaysFormat,l):f.call(e,"formatDate",e.date,r.mondaysFormat,l)))+"</div>\n	",i}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=n.helperMissing,l=this;s+='<div class="sf-budget-calendar',o=n["if"].call(t,t.date,{hash:{},inverse:l.noop,fn:l.program(1,c,i)});if(o||o===0)s+=o;o=n["if"].call(t,t.mondays,{hash:{},inverse:l.noop,fn:l.program(3,h,i)});if(o||o===0)s+=o;s+='">\n	<div class="sf-budget-calendar-month">',(o=n.month)?o=o.call(t,{hash:{}}):(o=t.month,o=typeof o===u?o.apply(t):o),s+=a(o)+'\n	</div>\n	<div class="sf-budget-calendar-first-day-month">',(o=n.firstDayMonth)?o=o.call(t,{hash:{}}):(o=t.firstDayMonth,o=typeof o===u?o.apply(t):o),s+=a(o)+'\n	</div>\n    <div class="sf-budget-calendar-middle-day-month">',(o=n.middleDayMonth)?o=o.call(t,{hash:{}}):(o=t.middleDayMonth,o=typeof o===u?o.apply(t):o),s+=a(o)+"\n    </div>\n	",o=n["if"].call(t,t.date,{hash:{},inverse:l.noop,fn:l.program(5,p,i)});if(o||o===0)s+=o;s+="\n	",o=n["if"].call(t,t.mondays,{hash:{},inverse:l.noop,fn:l.program(7,d,i)});if(o||o===0)s+=o;return s+="\n</div>",s});return t.registerPartial("ui_modules_budget-calendar_templates_budget-calendar",n),n}),define("libs/require/css/css!ui/modules/budget-calendar/css/budget-calendar",[],function(){}),define("ui/modules/budget-calendar/budget-calendar-module",["classes/item-view","hbs!ui/modules/budget-calendar/templates/budget-calendar","utils/util","utils/date","css!ui/modules/budget-calendar/css/budget-calendar"],function(e,t,n){var r=e.extend({template:t,ui:{$today:".sf-budget-calendar-today"},initialize:function(e){this._super.apply(this,arguments),this._today=n.date.today();var t=e.month||this._today;this._month=n.date.truncate(n.date.constructor.MONTH,t),this._daysInMonth=n.date.daysInMonth(this._month.getMonth(),this._month.getFullYear()),this._mondays=this._getMonthMondays(this._month),this._showToday=this.config.showToday&&this._sameMonth(),this._adjustOverflow=n.bind(this._adjustOverflow,this)},serializeData:function(){var e=this.config.textDirection==="rtl",t=this.config.axisDirection==="auto"?e:this.config.axisDirection==="rtl";return{date:this._showToday?this._today:null,percentage:this._showToday?this._getPercentage(this._today,this._daysInMonth):null,reference:t?"right":"left",todayFormat:this.config.todayFormat,mondaysFormat:this.config.mondaysFormat,mondays:this.config.showMondays?this._mondays.map(function(e){return{date:e,percentage:this._getPercentage(e,this._daysInMonth)}},this):null}},_sameMonth:function(){return this._month.getMonth()===this._today.getMonth()&&this._month.getFullYear()===this._today.getFullYear()},onRender:function(){this._super(),this._showToday&&setTimeout(this._adjustOverflow,10)},_adjustOverflow:function(){var e=this.$el,t=this.ui.$today,n=e.offset().left,r=e.width(),i=t.offset().left,s=t.outerWidth();i<n&&t.css({left:0,right:"auto",margin:0}),i+s>n+r&&t.css({left:"auto",right:0,margin:0})},_getPercentage:function(e,t){return(e.getDate()-1)*100/(t-1)},_getMonthMondays:function(e){var t=new Date(e.getTime()),n=t.getMonth(),r=[];t.setDate(1);while(t.getDay()!==1)t.setDate(t.getDate()+1);while(t.getMonth()===n)r.push(new Date(t.getTime())),t.setDate(t.getDate()+7);return r}},{ID:"budget-calendar",defaults:{date:null,showToday:!0,showMondays:!0,todayFormat:n.date.constructor.SHORT_DAY_MONTH,mondaysFormat:n.date.constructor.SHORT_DAY_MONTH}});return r}),define("ui/modules/budget-calendar/budget-calendar-module-extension",["ui/modules/budget-calendar/budget-calendar-module","hbs!ui/modules/budget-calendar/templates/budget-calendar","utils/util","utils/date","css!ui/modules/budget-calendar/css/budget-calendar"],function(e,t,n){var r=e.extend({template:t,_getPercentage:function(e,t){var r=n.date.today();return e.getMonth()===r.getMonth()&&e.getFullYear()===r.getFullYear()?e.getDate()===1?0:(t=n.date.daysInMonth(r.getMonth(),r.getFullYear()),r.getDate()===15?100/(t/r.getDate()):r.getDate()/t*100):null},serializeData:function(){var e=this.config.textDirection==="rtl",t=this.config.axisDirection==="auto"?e:this.config.axisDirection==="rtl",r=new Date(this._today.getYear(),this._today.getMonth()+1,0),i=this._showToday?this._getPercentage(this._today,this._daysInMonth):null,s={date:this._showToday?this._today:null,percentage:i,reference:t?"right":"left",todayFormat:this.config.todayFormat,firstDayMonth:"01",middleDayMonth:"15",lastDayMonth:r.getDate(),month:n.date.format(this._today,"MMMM"),mondaysFormat:this.config.mondaysFormat,hideTodayLine:!1,mondays:this.config.showMondays?this._mondays.map(function(e){return{date:e,percentage:this._getPercentage(e,this._daysInMonth)}},this):null};return s.date.getDate()===s.lastDayMonth&&(s.hideTodayLine=!0),s},_adjustOverflow:function(){this.hideToday?this.ui.$today.hide():this._super()}});return r}),define("libs/require/css/css!modules/budget-content/css/budget-content",[],function(){}),define("modules/budget-content/budget-content-module",["classes/layout","hbs!modules/budget-content/templates/budget-content","services/budget-service","modules/budget-content/views/budget-total-view","modules/budget-content/views/budget-parent-collection-view","ui/modules/budget-calendar/budget-calendar-module","modules/budget-editor/budget-editor-module","modules/transactions-details/transactions-details-module","is!ie8?modules/budget-history-chart/budget-history-chart-hc-module:modules/budget-history-chart/budget-history-chart-module","ui/modules/popup/popup-module","utils/util","utils/tooltip","utils/date","css!modules/budget-content/css/budget-content"],function(e,t,n,r,i,s,o,u,a,f,l){var c=e.extend({events:{"click .sf-budget-add-triggerer":"_addBudgetHandler"},filtersList:["activeMonth"],regions:{budgetCalendarRegion:".sf-budget-calendar-placeholder",budgetTotalRegion:".sf-budget-total-placeholder",budgetListRegion:".sf-budget-list-placeholder"},ui:{emptyMessage:".sf-empty-message",controls:".sf-budget-controls"},template:t,initialize:function(){this._super.apply(this,arguments),this._service=n.getInstance(),this._getData=l.bind(this._getData,this),this._dataReceived=l.bind(this._dataReceived,this),this._dataError=l.bind(this._dataError,this)},render:function(e){if(e){var t=this._super();return t}return this._getData(),this},onRender:function(){this.model.get("children").length?(this.ui.emptyMessage.hide(),this.ui.controls.show(),this._showCalendar(),this._showTotalView(),this._showParentBudgetList()):(this.ui.emptyMessage.show(),this.ui.controls.hide(),this.budgetCalendarRegion.close(),this.budgetListRegion.close(),this.budgetTotalRegion.close())},_showCalendar:function(){var e=this.filters.activeMonth?l.date.parseBackendDate(this.filters.activeMonth):l.date.today(),t=l.extend({month:e},this.contextConfig);this.budgetCalendarRegion.show(new s(t))},_showTotalView:function(){var e=l.extend({model:this.model},this.contextConfig);this.budgetTotalRegion.show(new r(e))},_showParentBudgetList:function(){var e=l.extend({collection:this.model.get("children")},this.contextConfig);this.budgetListRegion.show(new i(e))},_getData:function(){var e=l.pick(this.filters,"activeMonth"),t=this._service.get(e);l.mask(this.$el,l.MASK_LOADING),l.when(t).done(this._dataReceived).fail(this._dataError)},_dataReceived:function(e){l.unmask(this.$el),this._result=e,this._result.on("change",this._dataChanged,this),this._dataChanged(e)},_dataError:function(e){l.unmask(this.$el),this.publish("error",e)},_dataChanged:function(e){this.model=e.data,this.render(!0)},_filtersChanged:function(e){e==="activeMonth"&&setTimeout(this._getData,1)},_addBudgetHandler:function(e){var t=l.extend({},this.contextConfig,{$opener:this.$(e.currentTarget),$container:this.options.$popupContainer,title:l.i18n.get("budget-content.addBudgetPopup.title"),closeCallback:function(){n.remove()}}),n=new f(t),r=new o(l.extend(this.contextConfig,{config:this.config}));return r.on("cancel",n.remove,n),r.on("save",n.remove,n),n.contentRegion.once("show",n.open,n),n.contentRegion.show(r),!1}},{ID:"budget-content",services:[n],submodules:[u,a,s,o,f],defaults:{filters:{activeMonth:l.date.formatBackendDate(l.date.today())},maxGoals:10}});return c}),define("hbs!modules/budget-editor/templates/dav-add-budget",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-dav-add-budget sf-accessible-category-selector">\n	<div class="sf-dav-add-budget-placeholder"></div>\n</div>'});return t.registerPartial("modules_budget-editor_templates_dav-add-budget",n),n}),define("modules/budget-editor/dav-add-budget",["classes/layout","classes/collection","classes/model","modules/category-selector/category-selector-module","services/categories-service","modules/budget-editor/budget-editor-module","ui/modules/reform/category-select/category-select-module","modules/category-selector/extensions/category-selector-popup/views/category-selector-view","utils/util","hbs!modules/budget-editor/templates/dav-add-budget"],function(e,t,n,r,i,s,o,u,a,f){var l=e.extend({template:f,regions:{addBudgetRegion:".sf-dav-add-budget-placeholder"},initialize:function(){this._super.apply(this,arguments),this.categoriesService=i.getInstance()},onRender:function(e){this._super(e),a.when(this.categoriesService.getPlainCategories()).done(a.bind(this._dataReceived,this)).fail(a.bind(this._dataError,this))},_dataError:function(e){this.publish("error",e)},_dataReceived:function(e){this._result=a.clone(e),this._categories=this._setupCategories(this._result.data.categories);var t={},n=a.map(this._categories,function(e){var n=a.clone(e);return n.children!==undefined&&(t[n.value]=n.children,delete n.children),n},this);this._mainCategories=n,this._subCategories=t,this._showCategorySelectionView()},_showCategorySelectionView:function(){var e=a.extend({},this.contextConfig,this.options,this.config,{categories:this._categories,mainCategories:this._mainCategories,subCategories:this._subCategories,disableCustomEdition:!0}),t=new u(e);t.on("selected",a.bind(this._showBudgetEditorView,this)),this.addBudgetRegion.show(t)},_showBudgetEditorView:function(e){var t=new s(a.extend(this.contextConfig,{config:this.config,catId:e.id}));this.addBudgetRegion.show(t),this.listenTo(t,"cancel",this._closeAddBudget),this.listenTo(t,"save",this._closeAddBudget)},_closeAddBudget:function(){this.trigger("add-budget.close")},_setupCategories:function(e){var t=a.findIndex(e,{value:0}),n=a.findIndex(e,{isIncome:!0});return e.splice(n,1),e.splice(t,1),e}},{ID:"add-budget"});return l}),define("modules/budget-content/budget-content-module-extension",["modules/budget-content/budget-content-module","hbs!modules/budget-content/templates/budget-content","services/budget-service","modules/budget-content/views/budget-total-view","modules/budget-content/views/budget-parent-collection-view","modules/budget-editor/dav-add-budget","ui/modules/budget-calendar/budget-calendar-module","modules/budget-editor/budget-editor-module-extension","modules/transactions-details/transactions-details-module","is!ie8?modules/budget-history-chart/budget-history-chart-hc-module:modules/budget-history-chart/budget-history-chart-module","ui/modules/popup/popup-module","utils/util","utils/tooltip","utils/date","css!modules/budget-content/css/budget-content"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=e.extend({template:t,events:{"click .sf-budget-add-triggerer":"_addBudgetHandler"},initialize:function(){this._super(),this.addBudgetPopup=null},_addBudgetHandler:function(e){c.pushToDataLayer({eventCategory:"PFM Presupuesto",eventAction:"Boton",eventLabel:"Añadir Presupuesto",event:"eventClick"});var t=new s(this.contextConfig),n=this.$el.closest(".sf-platform");this.addBudgetPopup=new l({title:c.i18n.get("budget-editor.web.add.title"),contentView:t,$container:n.length?n:this.$el,$opener:this.$(e.currentTarget),"class":"sf-budget-add-popup",titleIcon:"dav-plus-red",subtitle:c.i18n.get("budget-content.addBudgetPopup.subtitle"),closeCallback:c.bind(this._closeAddBudgetPopup,this)}),this.addBudgetPopup.open(),this.listenTo(t,"add-budget.close",this._closeAddBudgetPopup)},onRender:function(){this.model.get("children").length?(this.ui.emptyMessage.hide(),this.ui.controls.show(),this.$el.find("sf-budget-disclaimer-text").css("display","block"),this._showCalendar(),this._showTotalView(),this._showParentBudgetList(),this.$el.find(".sf-budget-list-placeholder").removeAttr("style")):(this.ui.emptyMessage.show(),this.ui.controls.hide(),this.$el.find(".sf-budget-disclaimer-text").css("display","none"),this.budgetCalendarRegion.close(),this.budgetListRegion.close(),this.budgetTotalRegion.close(),this.$el.find(".sf-budget-list-placeholder").css("height",0),this.$el.find(".sf-budget-list-placeholder").css("min-height",0),this.$el.find(".sf-budget-list-placeholder").css("padding",0))},_closeAddBudgetPopup:function(){c.pushToDataLayer({eventCategory:"PFM Presupuesto",eventAction:"Boton",eventLabel:"Cancelar-Añadir presupuesto",event:"eventClick"}),this.addBudgetPopup.remove()}},{submodules:[a,f,o,u,l]});return h}),define("libs/require/css/css!widgets/budget/css/budget",[],function(){}),define("widgets/budget/budget-widget",["classes/ui/widget/widget","widgets/budget/views/budget-header-view","modules/budget-content/budget-content-module","services/budget-service","utils/util","css!widgets/budget/css/budget"],function(e,t,n,r,i){var s=e.extend({onRender:function(){var e=this;this._super(),i.mask(this.$el,i.MASK_LOADING),this.headerRegion.show(new t(this.contextConfig)),this.contentView=new n(this.contextConfig),this.contentRegion.on("show",function(){i.unmask(e.$el)}),this.contentRegion.show(this.contentView)}},{ID:"budget",services:[r],submodules:[n],defaults:{filters:{activeMonth:i.date.formatBackendDate(i.date.today())},maxGoals:10}});return s}),define("hbs!widgets/financial-calendar/templates/financial-calendar-header",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s,o,u=n.helperMissing,a=this.escapeExpression;return o={hash:{id:"financial-calendar",title:'{{t "financial-calendar.title"}}'}},a((s=n.header,s?s.call(t,o):u.call(t,"header",o)))});return t.registerPartial("widgets_financial-calendar_templates_financial-calendar-header",n),n}),define("widgets/financial-calendar/views/financial-calendar-header-view",["classes/layout","hbs!widgets/financial-calendar/templates/financial-calendar-header"],function(e,t){var n=e.extend({template:t});return n}),define("hbs!widgets/financial-calendar/templates/financial-calendar-content",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-financial-calendar-content sf-widget-content">\n	<div class="sf-financial-calendar-navigator">\n		<div class="sf-button-group">\n			<button class="sf-button sf-section-navigator-calendar sf-active" type="button">\n				<span class="sf-button-icon"></span>\n				<span class="sf-button-text">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"financial-calendar.button.calendar",u):a.call(t,"t","financial-calendar.button.calendar",u)))+'</span>\n			</button>\n			<button class="sf-button sf-section-navigator-payments" type="button">\n				<span class="sf-button-icon"></span>\n				<span class="sf-button-text">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"financial-calendar.button.payment",u):a.call(t,"t","financial-calendar.button.payment",u)))+'</span>\n			</button>\n		</div>\n	</div>\n	<div class="sf-financial-calendar-content-view">\n        <div class="sf-financial-calendar-chart"></div>\n        <div class="sf-financial-calendar-calendar"></div>\n		<div class="sf-financial-calendar-payments sf-hidden"></div>\n	</div>\n</div>',s});return t.registerPartial("widgets_financial-calendar_templates_financial-calendar-content",n),n}),define("data/patterns/pattern-model",["classes/model","classes/collection","utils/util","utils/config"],function(e,t,n){var r=e.extend({save:function(e,t){var r=n.config.getGlobals().environment.contextPath+"/financialcalendar/periodicpayment/create.action",i;this.isNew()||(r=n.config.getGlobals().environment.contextPath+"/financialcalendar/periodicpayment/update.action"),e=e||this.attributes,i={pattern:e};var s=n.extend({data:n.param(i),url:r,type:"POST",wait:!0},t);return this._super(e,s)},destroy:function(e){var t=n.config.getGlobals().environment.contextPath+"/financialcalendar/periodicpayment/delete.action",r=n.extend({data:n.param({id:this.id}),url:t,type:"POST",wait:!0},e);return this._super(r)},attachCategory:function(e){var t=this.get("catId"),n=e.hash[t];n||(console.error("[PatternModel] Pattern model with invalid category, setting as uncategorized",this),n=e.hash[0]),this.set({category:n},{silent:!0})},getDetails:function(){var e=n.Deferred(),r=this,i={url:n.config.getGlobals().environment.contextPath+"/financialcalendar/periodicpayment/get/details.action",type:"POST",dataType:"json",data:"id="+this.get("id")},s=function(n){n.details=new t(n.details),n.details.each(function(e){e.set("transactions",new t(e.get("transactions")))}),r.set(n,{silent:!0}),e.resolve(r)},o=function(t){console.error("[PatternModel] Unable to retrive pattern details",t),e.resolve(t)},u=this.get("details");return u?setTimeout(function(){e.resolve(r)},1):n.ajax(i).done(s).fail(o),e.promise()}});return r}),define("data/patterns/pattern-collection",["classes/collection","data/patterns/pattern-model"],function(e,t){var n=e.extend({model:t,url:"/financialcalendar/periodicpayment/get/all.action",parse:function(e){var t,n;return!e.incomePatterns&&!e.expensePatterns?undefined:e.incomePatterns&&e.expensePatterns?e.incomePatterns.concat(e.expensePatterns):(t=e.incomePatterns||[],n=e.expensePatterns||[],[].concat(t,n))}});return n}),define("data/patterns/patterns-data-manager",["classes/data-manager","data/patterns/pattern-collection","data/patterns/pattern-model","data/categories/categories-data-manager","classes/remote-error","utils/util","utils/config"],function(e,t,n,r,i,s){var o=e.extend({initialize:function(){this._super.apply(this,arguments),this.collectionDefs={pattern:{type:t,modelUpdated:this._patternUpdated,modelRemoved:this._patternRemoved,modelAdded:this._patternAdded,subscriptions:["transaction:change","transaction:add","transaction:delete","pattern:found","account:update"]}}},get:function(e){return this.getCollection("pattern",e)},create:function(e){var t=new n(e),o=t.save(),u=r.getInstance().get(),a=s.Deferred(),f=this;return s.when(o,u).done(function(e,n){t.set(e[0],{silent:!0}),t.attachCategory(n),f._collections.pattern.push(t),a.resolve(t)}).fail(function(e){console.error("[PatternsDataManager] Error creating pattern",e),a.reject(new i(e))}),a.promise()},update:function(e){var t=this._collections.pattern.get(e.id),n=t.save(e),r=s.Deferred();return s.when(n).done(function(){t.set({details:null},{silent:!0}),t.set(e),r.resolve(t)}).fail(function(e){console.error("[PatternsDataManager] Error creating pattern",e),r.reject(new i(e))}),r.promise()},getPatternDetailsById:function(e){return this._collections.pattern.get(e).getDetails()},findPatterns:function(){var e=this,t={url:s.config.getGlobals().environment.contextPath+"/forecast/create.action",dataType:"json"},n=function(t){console.log("[PatternsDataManager] Patterns found: ",t.patternsCreated),t.patternsCreated>0&&e.publish(e.constructor.events.PATTERN_FOUND)},r=function(e){console.error("[PatternsDataManager] Error finding patterns",e)};return s.ajax(t).done(n).fail(r)},remove:function(e){return this._collections.pattern.get(e.id).destroy(e)},_patternUpdated:function(e){console.log("PatternUpdated",e),this.publish(o.events.PATTERN_CHANGE,e)},_patternRemoved:function(e){console.log("PatternRemoved",e),this.publish(o.events.PATTERN_REMOVE,e)},_patternAdded:function(e){console.log("PatternAdded",e),this.publish(o.events.PATTERN_ADD,e)},evaluateRequestParams:function(e,t,n){t.force||(n.silent=!0)}},{events:{PATTERN_CHANGE:"pattern:change",PATTERN_REMOVE:"pattern:remove",PATTERN_ADD:"pattern:add",PATTERN_FOUND:"pattern:found"}});return o}),define("services/patterns-service",["classes/service","classes/resource-loader","data/patterns/patterns-data-manager","data/categories/categories-data-manager"],function(e,t,n,r){var i=e.extend({initialize:function(){this._super.apply(this,arguments),this.patternsDM=n.getInstance(),this.categoriesDM=r.getInstance(),this.resources.patterns=new t(this.patternsDM,this.patternsDM.get),this.resources.categories=new t(this.categoriesDM,this.categoriesDM.get)},get:function(){return this.executeJob(this.resources,this._getTask,this.resources)},_getTask:function(){var e=this.categories.data,t=this.patterns.data;return t.each(function(t){t.attachCategory(e)}),t},getPatternDetailsById:function(e){return this.patternsDM.getPatternDetailsById(e)},create:function(e){return this.patternsDM.create(e)},update:function(e){return this.patternsDM.update(e)},remove:function(e){return this.patternsDM.remove(e)},findPatterns:function(){return this.patternsDM.findPatterns()}},{ID:"patterns-service",defaults:{validator:{rules:{patterns:{name:{required:!0,rangelength:[4,128],type:"description"},source:{required:!0,rangelength:[4,128],type:"description"},catId:{required:!0,type:"number",min:0},periodId:{required:!0,min:0},amount:{required:!0,type:"number",range:[[1,"input[name=minAmount]"],1e6]},currency:{required:!0},statusId:{required:!0},start:{required:!0}}}}}});return i}),define("services/patterns-service-extension",["services/patterns-service","classes/resource-loader","data/patterns/patterns-data-manager","data/categories/categories-data-manager"],function(e){var t=e.extend({},{ID:"patterns-service",defaults:{validator:{rules:{patterns:{name:{required:!0,rangelength:[4,128],type:"description"},source:{required:!0,rangelength:[4,128],type:"description"},catId:{required:!0,type:"number",min:0},periodId:{required:!0,min:0},amount:{required:!0,type:"number",range:[[1,"input[name=minAmount]"],1e9]},currency:{required:!0},statusId:{required:!0},start:{required:!0}}}}}});return t}),define("hbs!modules/pattern-details/templates/pattern-details-columnchart-tooltip",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i;r+='\n	<div class="sf-pattern-tooltip-message">',(i=n.message)?i=i.call(e,{hash:{}}):(i=e.message,i=typeof i===f?i.apply(e):i);if(i||i===0)r+=i;return r+="</div>\n	",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;s+='<div class="sf-pattern-tooltip">\n	',(o=n.name)?o=o.call(t,{hash:{}}):(o=t.name,o=typeof o===f?o.apply(t):o),s+=l(o)+"\n	<br/>\n	",a={hash:{}},u=(o=n.formatDate,o?o.call(t,t.x,"long",a):c.call(t,"formatDate",t.x,"long",a));if(u||u===0)s+=u;s+="\n	<br/>\n	<strong>",a={hash:{curr:t.currency}},u=(o=n.formatAmount,o?o.call(t,t.y,a):c.call(t,"formatAmount",t.y,a));if(u||u===0)s+=u;s+="</strong>\n	",u=n["if"].call(t,t.message,{hash:{},inverse:h.noop,fn:h.program(1,p,i)});if(u||u===0)s+=u;return s+="\n</div>",s});return t.registerPartial("modules_pattern-details_templates_pattern-details-columnchart-tooltip",n),n}),define("data/patterns/pattern-consolidation-model",["classes/model","utils/util","utils/i18n"],function(e,t){var n=e.extend({parse:function(e){var n=this._super(e),r=this.constructor.ID_TO_PARSER_KEY[n.consType],i=this.constructor.PARSERS[r];return n.type=n.type.toLowerCase(),n=t.merge(n,{key:r,type:n.type},i(n)),n}},{ID_TO_PARSER_KEY:{1:"consolidated",2:"duplicated",3:"amount-deviation",4:"date-deviation",5:"expected",6:"changed"},PARSERS:{consolidated:function(){return{alert:0,message:t.i18n.get("patterns.consolidations.consolidated")}},duplicated:function(){return{alert:5,message:t.i18n.get("patterns.consolidations.duplicated")}},"amount-deviation":function(e){var n=parseInt(e.amountDiff,10),r=t.amount.format(Math.abs(n)),i=e.type=="income"?n>0?"lower":"higher":n>0?"higher":"lower";return{alert:n>0?4:2,amountType:i,message:t.i18n.get("patterns.consolidations.amount-deviation."+i,{amount:r})}},"date-deviation":function(e){var n=parseInt(e.daysDiff,10),r=Math.abs(n)===1?"oneDay":"manyDays",i=n>0?"future":"past",s=t.i18n.get("patterns.consolidations.date-deviation."+r,{days:Math.abs(n)});return{alert:1,message:t.i18n.get("patterns.consolidations.date-deviation."+i,{due:s})}},expected:function(e){return{alert:e.type=="income"?6:3,message:t.i18n.get("patterns.consolidations.expected")}},changed:function(){return{alert:0,message:t.i18n.get("patterns.consolidations.changed")}}}});return n}),define("modules/pattern-details/views/pattern-details-columnchart-view",["ui/modules/columnchart/columnchart-module","d3","utils/util","hbs!modules/pattern-details/templates/pattern-details-columnchart-tooltip","data/patterns/pattern-consolidation-model","utils/date","utils/amount"],function(e,t,n,r,i){var s=e.extend({initialize:function(){this._super.apply(this,arguments);var e=this;this.getXaxisFormat=function(r){var i=[n.date.format(r,e.config.monthDateFormat),n.date.format(r,e.config.yearDateFormat)];return t.select(this.parentNode).selectAll("text").data(i).enter().append("text").text(function(e){return e}).attr({dy:"2em"}),n.date.format(r,e.config.monthDateFormat)}},draw:function(e){var t=this._parseSeries(e);this._super(t)},getYaxisFormat:function(e){return n.unicodeHTMLCodes(n.amount.format(e,!1))},_parseSeries:function(){var e=this,t=[],s={consolidated:"regular","date-deviation":"dateDeviation",duplicated:"duplicated",expected:"missing",changed:"missing","amount-deviation":function(e){var t=e.get("amountDiff");return t>0?"amountDeviantionRed":"amountDeviantionPurple"}},o=[];for(var u in this.config.colors)t.push({color:this.config.colors[u],id:u,options:{stack:0},points:[]});var a=this.model.get("details").models;return n.isPhone()&&(a=a.filter(function(t,n){return n>a.length-e.config.numberOfColumnsMobile-1})),n.each(a,function(e){var u=e.get("day"),a=function(e,t){var o=Math.abs(t.get("amount")),a=t.get("name"),f=t.get("cons"),l,c="regular";return f&&(l=new i(f,{parse:!0}),c=s[l.get("key")],n.isFunction(c)&&(c=c(l)),l=l.get("message")),e[c]={value:o,title:r({y:o,currency:t.get("currency"),x:u,message:l,name:a})},e},f=e.get("transactions").reduce(a,{});o.push(u),n.each(t,function(e){var t=f[e.id]||{value:0};e.points.push(t)})},this),{axis:{x:o},series:t}}},{ID:"patterns-columnchart",submodules:[e],defaults:{monthDateFormat:n.date.constructor.SHORT_MONTH,yearDateFormat:"yy",numberOfColumnsMobile:6,colors:{regular:"#51a7e7",duplicated:"#d56d56",amountDeviantionPurple:"#d6c4d7",amountDeviantionRed:"#d56d56",dateDeviation:"#2e76cf",missing:"#eee"}}});return s}),define("hbs!modules/pattern-details/templates/pattern-details-accessible-table",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-pattern-details-accessible-table"></div>'});return t.registerPartial("modules_pattern-details_templates_pattern-details-accessible-table",n),n}),define("modules/pattern-details/views/pattern-details-accessible-table",["classes/item-view","ui/modules/datagrid/datagrid-module","hbs!modules/pattern-details/templates/pattern-details-accessible-table","classes/collection","utils/util","utils/amount","utils/number","utils/percentage"],function(e,t,n,r,i){var s=t.DatagridColumn,o=e.extend({template:n,initialize:function(){this._super.apply(this,arguments),this.gridConfig={columns:[new s({parent:this,headerClass:"sf-date-header",columnClass:"sf-date-col",formatter:this._dateFormatter,field:"date",label:i.i18n.get("pattern-details.accessible.header.date"),sortable:!1}),new s({parent:this,columnClass:"sf-numeric sf-amount-col",field:"amount",formatter:function(e){return i.amount.format(e.get("amount"))},label:i.i18n.get("pattern-details.accessible.header.amount"),headerClass:"sf-amount-header sf-numeric",sortable:!1}),new s({parent:this,field:"description",columnClass:"sf-description-col",label:i.i18n.get("pattern-details.accessible.header.description"),headerClass:"sf-description-header",sortable:!1}),new s({parent:this,field:"alert",columnClass:"sf-alert-col",label:i.i18n.get("pattern-details.accessible.header.alert"),headerClass:"sf-alert-header",sortable:!1})]}},onShow:function(){this.model.on("change",this.render,this)},onClose:function(){this.model.off("change",this.render)},onRender:function(){var e=this,n=e.model.get("data");e._super();if(n){var s=i.extend({dataSource:new r(n),config:e.gridConfig,container:e.$el},e.contextConfig);e.datagrid=new t(s),e.datagrid.render()}},_dateFormatter:function(e,t,n){var r=e.get("date"),s;return n>0&&(s=t.at(n-1).get("date")),s===r?"":(s=r,i.date.format(e.get("date"),"long"))}});return o}),define("hbs!modules/pattern-details/templates/pattern-details-columnchart-empty",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s,o,u=n.helperMissing,a=this.escapeExpression;return o={hash:{text:'{{{t "pattern-details.columnchart.empty" patternName=name }}}',"class":"sf-pattern-details-columnchart-emtpy"}},a((s=n.empty,s?s.call(t,o):u.call(t,"empty",o)))});return t.registerPartial("modules_pattern-details_templates_pattern-details-columnchart-empty",n),n}),define("modules/pattern-details/views/pattern-details-empty-view",["classes/item-view","hbs!modules/pattern-details/templates/pattern-details-columnchart-empty"],function(e,t){var n=e.extend({template:t});return n}),define("modules/pattern-details/views/pattern-details-accessible-chart",["classes/ui/chart/accessible-chart","is!ie8?modules/pattern-details/views/pattern-details-columnchart-hc-view:modules/pattern-details/views/pattern-details-columnchart-view","modules/pattern-details/views/pattern-details-accessible-table","modules/pattern-details/views/pattern-details-empty-view","utils/util","data/patterns/pattern-consolidation-model"],function(e,t,n,r,i,s){var o=e.extend({chartConstructor:t,accessibleViewConstructor:n,emptyViewConstructor:r,parseSeries:function(e){return e.details.length?e:null},parseTabularSeries:function(e){var t=[];return i.each(e.details.models,function(e){var n=e.attributes.day;i.each(e.attributes.transactions.models,function(e){var r=e.attributes.amount,i=e.attributes.name,o="";e.attributes.cons&&(o=new s(e.attributes.cons,{parse:!0}),o=o.get("message")),t.push({date:n,amount:r,description:i,alert:o})})}),{data:i.flatten(t)}}});return o}),define("hbs!modules/pattern-editor/templates/pattern-editor-form",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing;return s+='<div class="sf-pattern-editor">\n	<form class="sf-pattern-editor-form sf-form-horizontal" data-validate="parsley">\n		<div class="sf-form-row">\n			<label for="name">',(o=n.nameLabel)?o=o.call(t,{hash:{}}):(o=t.nameLabel,o=typeof o===a?o.apply(t):o),s+=f(o)+"</label>\n			",u={hash:{name:"name",validateField:"patterns.name",value:"{{name}}"}},s+=f((o=n.textfield,o?o.call(t,u):l.call(t,"textfield",u)))+'\n		</div>\n		<div class="sf-form-row">\n			<label for="amount">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"pattern-editor.webAmount",u):l.call(t,"t","pattern-editor.webAmount",u)))+"</label>\n			",u={hash:{name:"amount",affix:"currency",forceNegativeAmount:"{{ isNegative }}",validateField:"patterns.amount",value:"{{amount}}"}},s+=f((o=n.textfield,o?o.call(t,u):l.call(t,"textfield",u)))+'\n		</div>\n		<div class="sf-form-row sf-row-period">\n			<label for="periodId">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"pattern-editor.webPeriod",u):l.call(t,"t","pattern-editor.webPeriod",u)))+'</label>\n			<div class="sf-row-container">\n				',u={hash:{name:"periodId",options:"{{periods}}",currentOption:"{{periodId}}",validateField:"patterns.periodId"}},s+=f((o=n.select,o?o.call(t,u):l.call(t,"select",u)))+'\n                <div class="sf-icon-help sf-period-help"></div>\n			</div>\n		</div>\n\n		<div class="sf-form-row">\n			<label>',u={hash:{}},s+=f((o=n.t,o?o.call(t,"pattern-editor.category",u):l.call(t,"t","pattern-editor.category",u)))+'</label>\n			<span class="sf-pattern-editor-category-selector"></span>\n		</div>\n\n\n		<div class="sf-form-row sf-pattern-confirmed">\n			<label for="statusId">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"pattern-editor.status",u):l.call(t,"t","pattern-editor.status",u)))+"</label>\n			",u={hash:{name:"statusId",type:"checkbox",checked:"{{statusId}}"}},s+=f((o=n.checkbox,o?o.call(t,u):l.call(t,"checkbox",u)))+'\n		</div>\n		<div class="sf-form-dates-wrapper">\n			<div class="sf-form-row sf-form-date-start">\n				<label for="start">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"pattern-editor.startDate",u):l.call(t,"t","pattern-editor.startDate",u)))+"</label>\n				",u={hash:{"class":"sf-pattern-editor-start-date",dataDatepickerName:"start",placeholder:'{{t "pattern-editor.startDatePlaceholder"}}',dataFormat:"{{format}}",dataFormatSubmit:"{{formatSubmit}}",dataValue:"{{startDate}}",validateField:"patterns.start"}},s+=f((o=n.datepicker,o?o.call(t,u):l.call(t,"datepicker",u)))+'\n			</div>\n			<div class="sf-form-row sf-form-date-end">\n				<label for="end">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"pattern-editor.endDate",u):l.call(t,"t","pattern-editor.endDate",u)))+"</label>\n				",u={hash:{"class":"sf-pattern-editor-end-date",readonly:!0,dataDatepickerName:"end",placeholder:'{{t "pattern-editor.endDatePlaceholder"}}',dataFormat:"{{format}}",dataFormatSubmit:"{{formatSubmit}}",dataValue:"{{endDate}}",validateField:"patterns.end"}},s+=f((o=n.datepicker,o?o.call(t,u):l.call(t,"datepicker",u)))+'\n			</div>\n			<div class="sf-icon-help sf-dates-help"></div>\n		</div>\n		<div class="sf-form-row sf-start-label">\n			<span>',u={hash:{}},s+=f((o=n.t,o?o.call(t,"pattern-editor.selectedLabel.noLabel",u):l.call(t,"t","pattern-editor.selectedLabel.noLabel",u)))+'</span>\n		</div>\n\n		<div class="sf-button-controls">\n\n			',u={hash:{text:'{{t "common.button.save"}}',type:"button","class":"sf-button-save sf-pattern-editor-save"}},s+=f((o=n.button,o?o.call(t,u):l.call(t,"button",u)))+"\n			",u={hash:{text:'{{t "common.button.cancel"}}',type:"button","class":"sf-button-cancel sf-pattern-editor-cancel"}},s+=f((o=n.button,o?o.call(t,u):l.call(t,"button",u)))+"\n		</div>\n	</form>\n</div>",s});return t.registerPartial("modules_pattern-editor_templates_pattern-editor-form",n),n}),define("libs/require/css/css!modules/pattern-editor/css/pattern-editor",[],function(){}),define("modules/pattern-editor/pattern-editor-module",["classes/item-view","utils/util","services/patterns-service","modules/category-selector/category-selector-module","hbs!modules/pattern-editor/templates/pattern-editor-form","ui/modules/reform/select/select-module","ui/modules/reform/datepicker/datepicker-module","utils/date","utils/i18n","utils/validator/validator","css!modules/pattern-editor/css/pattern-editor"],function(e,t,n,r,i,s){var o=e.extend({template:i,events:{"submit .sf-pattern-editor-form":"_savePattern","change .sf-pattern-editor-start-date":"_startDateChanged","change .sf-pattern-editor-end-date":"_endDateChanged","change select[name=periodId]":"_changePeriod","focus .sf-datepicker":"_setDatepickerPosition"},ui:{$form:".sf-pattern-editor-form",$periodSelector:"select[name=periodId]",$startDate:".sf-pattern-editor-start-date",$endDate:".sf-pattern-editor-end-date",$categorySelector:".sf-pattern-editor-category-selector"},triggers:{"click .sf-pattern-editor-cancel":"cancel"},initialize:function(){this._super.apply(this,arguments),this.patternsService=n.getInstance()},onRender:function(){this._super(),this._onRender()},_onRender:function(){this._initCategorySelectorFilter(),s.init(this.$el),t.validator.validate(this.ui.$form),this._checkDateInputs()},serializeData:function(){var e={periods:t.map(t.i18n.get("pattern-editor.periods"),function(e,t){return{value:t,name:e}}),periodId:0,statusId:1,format:t.date.getDatepickerFormat(this.config.datePickerFormat),formatSubmit:t.date.getDatepickerFormat(this.config.datePickerSubmitFormat)},n=this.model?this._serializeModel():{};return t.merge(e,n)},save:function(){this.ui.$form.submit()},reset:function(){this.render()},_serializeForm:function(){var e=t.serializeForm(this.ui.$form);return e.amount=t.number.parse(e.amount),this.options.isExpense&&(e.amount*=-1),e.catId=t.number.parse(e.catId),e.statusId=e.statusId==="on"?1:0,e.end!=null&&e.periodId==this.constructor.SINGLE_PAYMENT_PERIOD&&delete e.end,this.model&&(e.id=this.model.id),e},_serializeModel:function(){var e=function(e){return e?t.date.format(t.date.parseBackendDate(e),this.config.datePickerSubmitFormat):e};return{name:this.model.get("name"),amount:Math.abs(this.model.get("amount")),isNegative:this.model.get("amount")<0,statusId:this.model.get("statusId"),periodId:this.model.get("periodId").toString(),startDate:e.call(this,this.model.get("start")),endDate:e.call(this,this.model.get("end"))}},_startDateChanged:function(){this._checkDateInputs()},_endDateChanged:function(){this._checkDateInputs()},_changePeriod:function(){this._checkDateInputs()},_checkDateInputs:function(){var e=this.ui.$periodSelector.val(),n=this.ui.$startDate.pickadate("picker"),r=n.get("select"),i=this.$("label[for=start]"),s=this.ui.$endDate.pickadate("picker"),o=s.get("select"),u=this.ui.$endDate.parents(".sf-form-row").eq(0);if(e==this.constructor.SINGLE_PAYMENT_PERIOD)u.hide(),i.text(t.i18n.get("pattern-editor.singleDate")),n.set("max",!1);else{u.show(),i.text(t.i18n.get("pattern-editor.startDate"));if(n.get()&&s.get()&&o.obj<r.obj){s.set("clear");return}s.set("min",n.get()?r.obj:!1),n.set("max",s.get()?o.obj:!1)}},_initCategorySelectorFilter:function(){var e=this.model&&this.model.get("catId"),n=t.extend({},this.contextConfig,{el:this.ui.$categorySelector,allOptionsEnabled:!1,disableCustomEdition:!0,classes:"sf-category-select-filter",name:"catId",validateField:"patterns.catId",catId:e||0}),i=new r(n);i.render()},_savePattern:function(e){e.preventDefault(),e.stopPropagation();var n=this,r=this._serializeForm(),i=this.model?this.patternsService.update(r):this.patternsService.create(r);t.mask(this.$el,t.MASK_LOADING),t.when(i).done(function(e){t.unmask(n.$el),n.model=e,n.trigger("save",e)}).fail(function(e){t.unmask(n.$el),console.error("[PatternEditor] Save pattern error",e);if(e._data.status==400){var r=JSON.parse(e._data.responseText).error;r.fieldErrors&&r.fieldErrors.name&&(e.errorMessage=t.i18n.get("pattern-editor.error."+r.fieldErrors.name[0]))}n.publish("error",e)})},_setDatepickerPosition:function(e){var t=this.$(e.currentTarget);t.siblings(".sf-datepicker-window").css("left",t.position().left);if(navigator.userAgent.match(/iPhone/i)){t.parent().css("position","relative");var n=t.parent().find(".sf-datepicker-window").first().children().first()[0].getBoundingClientRect().height;t.siblings(".sf-datepicker-window").css("top",-n)}}},{ID:"pattern-editor",submodules:[r],services:[n],SINGLE_PAYMENT_PERIOD:6,defaults:{datePickerFormat:t.date.constructor.SHORT_DATE,datePickerSubmitFormat:t.date.constructor.BACKEND_FORMAT}});return o}),define("modules/pattern-editor/pattern-editor-module-extension",["modules/pattern-editor/pattern-editor-module","ui/modules/popup/popup-module","jQuery","utils/util","services/patterns-service","services/categories-service","modules/category-selector/category-selector-module","hbs!modules/pattern-editor/templates/pattern-editor-form","ui/modules/reform/select/select-module","ui/modules/reform/datepicker/datepicker-module","utils/date","utils/i18n","utils/validator/validator","css!modules/pattern-editor/css/pattern-editor"],function(e,t,n,r,i,s,o,u,a){var f=e.extend({events:{"click .sf-pattern-editor-save":"_savePattern","change .sf-pattern-editor-start-date":"_startDateChanged","change .sf-pattern-editor-end-date":"_endDateChanged","change select[name=periodId]":"_changePeriod","focus .sf-datepicker":"_setDatepickerPosition","click .sf-period-help":"_openHelpPeriodPopup","click .sf-category-help":"_openHelpCategoryPopup","click .sf-subcategory-help":"_openHelpSubcategoryPopup","click .sf-dates-help":"_openDaterangePopup"},ui:{$form:".sf-pattern-editor-form",$periodSelector:"select[name=periodId]",$startDate:".sf-pattern-editor-start-date",$endDate:".sf-pattern-editor-end-date",$categorySelector:".sf-pattern-editor-category-selector",$labelSelectedStart:".sf-start-label span"},initialize:function(){this._super.apply(this,arguments),this.categoriesService=s.getInstance(),this.categories=null},serializeData:function(){var e={periods:r.map(r.i18n.get("pattern-editor.periods"),function(e,t){if(t!=="1"&&t!=="3")return{value:t,name:e}}),periodId:0,statusId:1,format:r.date.getDatepickerFormat(this.config.datePickerFormat),formatSubmit:r.date.getDatepickerFormat(this.config.datePickerSubmitFormat)},t=this.model?this._serializeModel():{},n=this.options.isExpense?"expense":"income",i=!this.model,s=i?"title":"editTitle",o=r.i18n.get("pattern-editor.form."+s+"."+n),u=r.i18n.get("pattern-editor.source."+n),a=r.i18n.get("pattern-editor.help."+n);return e.title=o,e.isExpense=n,e.nameLabel=u,e.help=a,e.isNew=i,e=this._cleanTemplateData(e),r.merge(e,t)},_cleanTemplateData:function(e){for(var t=0;t<e.periods.length;t++)e.periods[t]===undefined&&(e.periods.splice(t,1),t--);return e},_openHelpPeriodPopup:function(e){var i=n(e.currentTarget),s=this.options.isExpense?"periodExpense":"periodIncome",o={$container:this.$el,$opener:i,content:r.i18n.get("pattern-editor.info."+s),type:t.INFO,closeCallback:r.bind(this._closePopup,this),maskClass:"sf-dark-mask"};this.infoPopup=new t(o),this.infoPopup.open()},_openHelpCategoryPopup:function(e){var i=n(e.currentTarget),s=this.options.isExpense?"categoryExpense":"categoryIncome",o={$container:this.$el,$opener:i,content:r.i18n.get("pattern-editor.info."+s),type:t.INFO,closeCallback:r.bind(this._closePopup,this),maskClass:"sf-dark-mask"};this.infoPopup=new t(o),this.infoPopup.open()},_openDaterangePopup:function(e){var i=n(e.currentTarget),s=this.options.isExpense?"datesrangeExpense":"datesrangeIncome",o={$container:this.$el,$opener:i,content:r.i18n.get("pattern-editor.info."+s),type:t.INFO,closeCallback:r.bind(this._closePopup,this),maskClass:"sf-dark-mask"};this.infoPopup=new t(o),this.infoPopup.open()},_closePopup:function(){this.infoPopup.remove()},_initCategorySelectorFilter:function(){var e=this.model&&this.model.get("catId"),t=r.extend({},this.contextConfig,{el:this.ui.$categorySelector,allOptionsEnabled:!1,disableCustomEdition:!0,classes:"sf-category-select-filter",name:"catId",validateField:"patterns.catId",catId:this.options.isExpense?e||0:e||118,hideIncomeCats:this.options.isExpense?!0:!1,hideExpensesCats:this.options.isExpense?!1:!0,isIncome:this.options.isExpense?!1:!0}),n=new o(t);n.render()},_startDateChanged:function(e){this._super.apply(this,arguments);var t=n(e.target).val();this.ui.$labelSelectedStart.html(r.i18n.get("pattern-editor.selectedLabel.selectedDate")+t)},_savePattern:function(e){e.preventDefault(),e.stopPropagation();if(!this.ui.$form.parsley().validate()||!r.validator.isValid(this.ui.$form))return;var t=this,n=this._serializeForm(),i=this.model?this.patternsService.update(n):this.patternsService.create(n);r.mask(this.$el,r.MASK_LOADING),r.when(i).done(function(e){r.unmask(t.$el),t.model=e,t.trigger("save",e)}).fail(function(e){r.unmask(t.$el),console.error("[PatternEditor] Save pattern error",e);if(e._data.status==400){var n=JSON.parse(e._data.responseText).error;n.fieldErrors&&n.fieldErrors.name&&(e.errorMessage=r.i18n.get("pattern-editor.error."+n.fieldErrors.name[0]))}t.publish("error",e)})}});return f}),define("hbs!modules/pattern-details/templates/pattern-details",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){var r="",i,s;return r+="\n			",s={hash:{text:"pattern-details.editPattern",type:"button","class":"sf-pattern-details-edit"}},r+=f((i=n.button,i?i.call(e,s):a.call(e,"button",s)))+"\n		",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression,l=this;s+='<div class="sf-pattern-details">\n    <div class="sf-pattern-details-header">\n        <div class="sf-button-close"></div>\n    </div>\n    <div class="sf-pattern-details-chart-region"></div>\n    <div class="sf-pattern-details-controls">\n		',o=n.unless.call(t,t.disableETLData,{hash:{},inverse:l.noop,fn:l.program(1,c,i)});if(o||o===0)s+=o;return s+="\n		",u={hash:{text:"pattern-details.deletePattern",type:"button","class":"sf-pattern-details-delete"}},s+=f((o=n.button,o?o.call(t,u):a.call(t,"button",u)))+"\n    </div>\n</div>",s});return t.registerPartial("modules_pattern-details_templates_pattern-details",n),n}),define("libs/require/css/css!modules/pattern-details/css/pattern-details",[],function(){}),define("modules/pattern-details/pattern-details-module",["classes/layout","modules/pattern-details/views/pattern-details-accessible-chart","modules/pattern-details/views/pattern-details-empty-view","modules/pattern-editor/pattern-editor-module","ui/modules/popup/popup-module","utils/util","hbs!modules/pattern-details/templates/pattern-details","css!modules/pattern-details/css/pattern-details"],function(e,t,n,r,i,s,o){var u=e.extend({template:o,regions:{chartRegion:".sf-pattern-details-chart-region"},events:{"click .sf-button-close":"_closeView","click .sf-pattern-details-delete":"_clickDeletePattern","click .sf-pattern-details-edit":"_clickEditPattern"},initialize:function(){this._super.apply(this,arguments),this._detailsReady=s.bind(this._detailsReady,this),this._errorReceived=s.bind(this._errorReceived,this),this._onModelChange=s.bind(this._onModelChange,this),this._closeView=s.bind(this._closeView,this)},onShow:function(){s.mask(this.$el,s.MASK_LOADING),this.model.on("change",this._onModelChange),this.model.getDetails().done(this._detailsReady).fail(this._errorReceived)},onRender:function(){var e=this.model.get("details"),n=s.merge({},this.contextConfig,{model:this.model});e&&this.chartRegion.show(new t(n))},serializeData:function(){var e=!1;return this.config.disableETLData&&this.model.get("patternType")=="E"&&(e=!0),{disableETLData:e}},_onModelChange:function(){this.render()},onClose:function(){this.model.off("change",this._onModelChange)},_detailsReady:function(){s.unmask(this.$el),this.render()},_errorReceived:function(e){console.error("[PatternDetailsView] Error retrieving pattern details",e,this.model),s.unmask(this.$el),this.publish("error",e)},_clickEditPattern:function(e){var t=this,n=this._createPatternEditor(s.extend({},this.contextConfig,{isExpense:this.model.get("amount")<0,model:this.model})),r=function(){t.options.$popupContainer[0].style.minHeight=n.$el.height()*2+"px"},o=function(){a.remove(),t.options.$popupContainer[0].style.minHeight=null},u={$container:this.options.$popupContainer,$opener:this.$(e.currentTarget),title:s.i18n.get("pattern-details.form.editTitle"),closeCallback:o},a=new i(u);a.dialog.once("open",r),n.once("save",o),n.once("cancel",o),a.contentRegion.once("show",function(){a.open()}),a.contentRegion.show(n)},_createPatternEditor:function(e){return new r(e)},_clickDeletePattern:function(e){var t=this,n={$container:this.options.$popupContainer,$opener:this.$(e.currentTarget),title:s.i18n.get("pattern-details.form.removeTitle"),$content:s.i18n.get("pattern-details.form.removeText"),type:i.CONFIRM,confirmCallback:function(){t._deletePattern(),r.remove()}},r=new i(n);r.open()},_closeView:function(){this.trigger("close",this)},_deletePattern:function(){var e=this,t=this.model.destroy(),n=function(){console.log("[PatternDetailsView] Pattern deleted",e.model),s.unmask(e.$el),e.trigger("patternDeleted",e.model)},r=function(t){console.error("[PatternDetailsView] Error deleting pattern",t,e.model),s.unmask(e.$el),e.publish("error",t)};return s.mask(this.$el,s.MASK_LOADING),s.when(t).done(n).fail(r)}},{ID:"pattern-details",submodules:[r,i],defaults:{}});return u}),define("hbs!modules/patterns-datagrid/templates/category-cell",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){return' class="sf-pattern-cat-container"'}function c(e,t){var r="",i;return r+='\n		<div class="sf-cat-data-container">\n			<div class="sf-main-cat">\n				',(i=n.catName)?i=i.call(e,{hash:{}}):(i=e.catName,i=typeof i===u?i.apply(e):i),r+=a(i)+'\n			</div>\n			<div class="sf-main-cat">\n				',(i=n.subcatName)?i=i.call(e,{hash:{}}):(i=e.subcatName,i=typeof i===u?i.apply(e):i),r+=a(i)+"\n			</div>\n		</div>\n	",r}function h(e,t){var r="",i;return r+='\n		<div class="sf-main-cat">\n			',(i=n.catName)?i=i.call(e,{hash:{}}):(i=e.catName,i=typeof i===u?i.apply(e):i),r+=a(i)+"\n		</div>\n	",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div title="<b>',(o=n.catName)?o=o.call(t,{hash:{}}):(o=t.catName,o=typeof o===u?o.apply(t):o),s+=a(o)+'</b>" ',o=n["if"].call(t,t.hasParent,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;s+='>\n	<div class="sf-category-color-container">\n		<span style="background-color: #',(o=n.color)?o=o.call(t,{hash:{}}):(o=t.color,o=typeof o===u?o.apply(t):o),s+=a(o)+';" class="sf-category-color"></span>\n	</div>\n	',o=n["if"].call(t,t.hasParent,{hash:{},inverse:f.program(5,h,i),fn:f.program(3,c,i)});if(o||o===0)s+=o;return s+="\n</div>",s});return t.registerPartial("modules_patterns-datagrid_templates_category-cell",n),n}),define("hbs!modules/patterns-datagrid/templates/patterns-datagrid",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-patterns-datagrid">\n\n\n</div>'});return t.registerPartial("modules_patterns-datagrid_templates_patterns-datagrid",n),n}),define("hbs!modules/patterns-datagrid/templates/pattern-details-box",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression;return s+='<tr class="sf-patterns-datagrid-details-',(o=n.id)?o=o.call(t,{hash:{}}):(o=t.id,o=typeof o===u?o.apply(t):o),s+=a(o)+' sf-pattern-datagrid-details">\n	<td colspan="5" class="sf-patterns-datagrid-details-',(o=n.id)?o=o.call(t,{hash:{}}):(o=t.id,o=typeof o===u?o.apply(t):o),s+=a(o)+'"></td>\n</tr>',s});return t.registerPartial("modules_patterns-datagrid_templates_pattern-details-box",n),n}),define("hbs!modules/patterns-datagrid/templates/details-button",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s,o,u=n.helperMissing,a=this.escapeExpression;return o={hash:{text:"patterns-datagrid.buttons.details",type:"button","class":"sf-button-details sf-closed"}},a((s=n.button,s?s.call(t,o):u.call(t,"button",o)))});return t.registerPartial("modules_patterns-datagrid_templates_details-button",n),n}),define("libs/require/css/css!modules/patterns-datagrid/css/patterns-datagrid",[],function(){}),define("modules/patterns-datagrid/patterns-datagrid-module",["classes/layout","ui/modules/datagrid/datagrid-module","modules/pattern-details/pattern-details-module","utils/util","hbs!modules/patterns-datagrid/templates/category-cell","hbs!modules/patterns-datagrid/templates/patterns-datagrid","hbs!modules/patterns-datagrid/templates/pattern-details-box","hbs!modules/patterns-datagrid/templates/details-button","utils/amount","css!modules/patterns-datagrid/css/patterns-datagrid"],function(e,t,n,r,i,s,o,u){function f(e){var t=e.get("category"),n={};return t===undefined?n:(t.get("parent")!==undefined?n={hasParent:!0,parentName:t.get("parent").get("catName"),catName:t.get("catName"),color:t.get("catHexrgbcolor")}:n={hasParent:!1,catName:t.get("catName"),color:t.get("catHexrgbcolor")},n)}var a=e.extend({template:s,events:{"click .sf-button-details":"_selectRow"},initialize:function(){this._super.apply(this,arguments),this._setupColumnsConfig()},_setupColumnsConfig:function(){var e=[],n=this.config.gridConfig.ColumnDefs.length;for(var i=0;i<n;i++){var s=this.config.gridConfig.ColumnDefs[i];s=r.extend({parent:this},s),s.labelKey!==undefined&&(s.label=r.i18n.get(s.labelKey)),e.push(new t.DatagridColumn(s))}this.config.gridConfig.columns=e},_selectRow:function(e){var t=this.$(e.currentTarget),n=t.parents("tr"),i=n.data("id"),s=this.datagrid.getElementById(i),o=this._getRegionSelector(s),u=this.$(o);r.isEmpty(u)?this._appendRegion(s,n,o):(this[this._getRegionName(s)].currentView.render(),u.parent().removeClass("sf-hidden"),r.isPhone()&&u.parent().css("display","block !important"))},_appendRegion:function(e,t,n){var i=o({id:e.get("id")}),s=t.after(i).next(),u=this._getRegionName(e),a=r.extend({},this.contextConfig,{model:e});this.addRegion(u,n);var f=this._createPatternDetails(a);return f.on("close",function(e){e&&e.$el&&(e.$el.parents("tr").addClass("sf-hidden"),r.isPhone()&&e.$el.parents("tr").css("display","none !important"))},this),this[u].show(f),s},_createPatternDetails:function(e){return new n(e)},_getRegionName:function(e){return"pattern-"+e.get("id")},_getRegionSelector:function(e){return"td.sf-patterns-datagrid-details-"+e.get("id")},_removeRegion:function(e){this.regionManager.removeRegion(this._getRegionName(e)),this.$(this._getRegionSelector(e)).parent().remove()},onRender:function(){this._super();var e=this,n=r.extend({},this.contextConfig,{config:this.config.gridConfig,container:this.$el});this.collection.on("remove",function(t){console.log("[PatternsDatagrid] Removed pattern from collection, remove attached region"),e._removeRegion(t)}),this.collection.on("add",function(){e.regionManager.removeRegions(),e.$("tr.sf-pattern-datagrid-details").remove()}),this.datagrid=new t(n),this.datagrid.render(),this.datagrid.renderElements(this.collection)},onClose:function(){this.datagrid.off()}},{ID:"patterns-datagrid",submodules:[n,t],defaults:{gridConfig:{ColumnDefs:[{field:"periodId",labelKey:"patterns-datagrid.header.period",headerClass:"sf-patterns-datagrid-header-period",columnClass:"sf-patterns-datagrid-column-period",formatter:function(e){var t="patterns.periodId.";return t+=e.get("periodId"),r.i18n.get(t)},sortable:!1},{field:"name",labelKey:"patterns-datagrid.header.name",headerClass:"sf-patterns-datagrid-header-name",columnClass:"sf-patterns-datagrid-column-name",sortable:!1},{field:"category",labelKey:"patterns-datagrid.header.category",headerClass:"sf-patterns-datagrid-header-category",columnClass:"sf-patterns-datagrid-column-category",serializeData:f,formatter:i,sortable:!1},{field:"amount",labelKey:"patterns-datagrid.header.amount",headerClass:"sf-patterns-datagrid-header-amount sf-numeric",columnClass:"sf-patterns-datagrid-column-amount sf-numeric",formatter:function(e,t,n,i){return i.classes=i.classes||[],i.classes.push("sf-patterns-datagrid-action-details"),i.classes.push("sf-patterns-datagrid-action-details-"+e.get("id")),e.get("statusId")==1?i.classes.push("sf-patterns-datagrid-confirmed"):i.classes.push("sf-patterns-datagrid-unconfirmed"),r.amount.format(e.get("amount"))},sortable:!1},{formatter:u,headerClass:"sf-patterns-datagrid-header-edit",columnClass:"sf-edit",sortable:!1}],emptyMessageKey:"patterns-datagrid.empty"},showDetails:!0}});return a._categoryDataSerializer=f,a}),define("hbs!modules/patterns-datagrid/templates/edit-button",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-pattern-edit-button-wrapper">\n	<button class="sf-button sf-button-edit-dav sf-pattern-edit-triggerer" tabindex="0" type="button">\n		<span class="sf-button-text"></span>\n	</button>\n</div>'});return t.registerPartial("modules_patterns-datagrid_templates_edit-button",n),n}),define("hbs!modules/patterns-datagrid/templates/delete-button",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-pattern-delete-button-wrapper">\n	<button class="sf-button sf-button-delete-dav sf-pattern-delete-triggerer" tabindex="0" type="button">\n		<span class="sf-button-text">\n\n		</span>\n	</button>\n</div>'});return t.registerPartial("modules_patterns-datagrid_templates_delete-button",n),n}),define("modules/patterns-datagrid/patterns-datagrid-module-extension",["modules/patterns-datagrid/patterns-datagrid-module","ui/modules/datagrid/datagrid-module","modules/pattern-details/pattern-details-module","modules/pattern-editor/pattern-editor-module","ui/modules/popup/popup-module","utils/util","hbs!modules/patterns-datagrid/templates/category-cell","hbs!modules/patterns-datagrid/templates/patterns-datagrid","hbs!modules/patterns-datagrid/templates/pattern-details-box","hbs!modules/patterns-datagrid/templates/edit-button","hbs!modules/patterns-datagrid/templates/delete-button","utils/amount","css!modules/patterns-datagrid/css/patterns-datagrid"],function(e,t,n,r,i,s,o,u,a,f,l){function h(e){var t=e.get("category"),n=t.get("parent")!==undefined,r=t.get("parent")!==undefined?t.get("parent"):t,i={hasParent:n,catName:r.get("catName"),color:r.get("catHexrgbcolor")};return n&&(i.subcatName=t.get("catName")),i}var c=e.extend({events:{"click .sf-button-details":"_selectRow","click .sf-pattern-edit-triggerer":"_editPattern","click .sf-pattern-delete-triggerer":"_deletePatternConfirmPopup"},_getPatternSelected:function(e){var t=this.$(e.currentTarget),n=t.parents("tr"),r=n.data("id"),i=this.datagrid.getElementById(r);return i},_createPatternEditor:function(e){return new r(e)},_editPattern:function(e){var t=this._getPatternSelected(e),n=this._createPatternEditor(s.extend({},this.contextConfig,{isExpense:t.get("amount")<0,model:t}));this._openEditor(n,e.currentTarget,{isExpense:t.get("amount")<0})},_openEditor:function(e,t,n){var r=this,o=n.isExpense,u="editTitle",a=function(){r.options.$popupContainer[0].style.minHeight=e.$el.height()*2+"px",this.$el[0].style.top="2em"},f=function(){p.remove(),r.options.$popupContainer[0].style.minHeight=null},l=o?"expense":"income",c=s.i18n.get("pattern-editor.form.editTitle."+l),h={$container:this.options.$popupContainer,$opener:this.$(t),title:c,titleIcon:"dav-white-edit",titleIconBackground:"#ed1c27",iconExt:"svg",labelClose:s.i18n.get("popup.label.back"),closeCallback:f,maskClass:"sf-transparent-mask"};h["class"]="sf-pattern-editor-popup";var p=new i(h);p.dialog.once("open",a),e.once("save",f),e.once("cancel",f),p.contentRegion.once("show",function(){p.open()}),p.contentRegion.show(e)},_deletePatternConfirmPopup:function(e){var t=this._getPatternSelected(e),n=this,r=t.get("amount")<0?"expense":"income",o=t.get("amount")<0?"expenseDeleteTitle":"incomeDeleteTitle",u={$container:this.options.$popupContainer,$opener:this.$(e.currentTarget),title:s.i18n.get("patterns.form.removeText."+o),$content:s.i18n.get("pattern-details.form.removeTextMessage."+r),titleIcon:"dav-white-trash-can",iconExt:"svg",type:i.CONFIRM,maskClass:"sf-dark-mask",confirmCallback:function(){n._deletePattern(t),a.remove()}};u["class"]="sf-pattern-delete-popup";var a=new i(u);a.open()},_deletePattern:function(e){var t=this,n=e.destroy(),r=function(){console.log("[PatternDatagridView] Pattern deleted",t.model),s.unmask(t.$el),t.trigger("patternDeleted",t.model)},i=function(e){console.error("[PatternDatagridView] Error deleting pattern",e,t.model),s.unmask(t.$el),t.publish("error",e)};return s.mask(this.$el,s.MASK_LOADING),s.when(n).done(r).fail(i)},_removeRegion:function(e){var t=this._getRegionName(e);if(!t||!this.regionManager._regions.length)return;this.regionManager.removeRegion(t),this.$(this._getRegionSelector(e)).parent().remove()},_setupColumnsConfig:function(e){this._super(e);var t=this.options.isIncomeGrid?"income":"expenses";this.config.gridConfig.emptyMessageKey="patterns-datagrid.empty."+t},onRender:function(){this._super();var e=this,t=function(){e.trigger("collectionItemsChanged",{numberOfItems:e.collection.models.length})};this.collection.on("remove",t),this.collection.on("add",t)}},{ID:"patterns-datagrid",submodules:[n,t],defaults:{gridConfig:{ColumnDefs:[{formatter:l,labelKey:"",headerClass:"sf-patterns-datagrid-header-delete",columnClass:"sf-delete-button",sortable:!1},{formatter:f,labelKey:"",headerClass:"sf-patterns-datagrid-header-edit",columnClass:"sf-edit-button",sortable:!1},{field:"amount",labelKey:"patterns-datagrid.header.amount",headerClass:"sf-patterns-datagrid-header-amount sf-numeric",columnClass:"sf-patterns-datagrid-column-amount sf-numeric",formatter:function(e,t,n,r){return r.classes=r.classes||[],e=t.models[n],r.classes.push("sf-patterns-datagrid-action-details"),r.classes.push("sf-patterns-datagrid-action-details-"+e.get("id")),e.get("statusId")==1?r.classes.push("sf-patterns-datagrid-confirmed"):r.classes.push("sf-patterns-datagrid-unconfirmed"),s.amount.format(e.get("amount"))},sortable:!0},{field:"name",labelKey:"patterns-datagrid.header.name",headerClass:"sf-patterns-datagrid-header-name",columnClass:"sf-patterns-datagrid-column-name",sortable:!0,formatter:function(e){return e.get("name")}},{field:"category",labelKey:"patterns-datagrid.header.category",headerClass:"sf-patterns-datagrid-header-category",columnClass:"sf-patterns-datagrid-column-category",serializeData:h,formatter:o,sortable:!0},{field:"periodId",labelKey:"patterns-datagrid.header.period",headerClass:"sf-patterns-datagrid-header-period",columnClass:"sf-patterns-datagrid-column-period",formatter:function(e){var t="patterns.periodId.";return t+=e.get("periodId"),s.i18n.get(t)},serializeData:function(e){return e},sortable:!0}],emptyMessageKey:"patterns-datagrid.empty"},showDetails:!1}});return c._categoryDataSerializer=h,c}),define("hbs!modules/patterns/templates/patterns",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-patterns">\n	<div class="sf-patterns-income-wrapper">\n		<div class="sf-patterns-subheader">\n			<h3>',u={hash:{}},s+=f((o=n.t,o?o.call(t,"patterns.title.incomes",u):a.call(t,"t","patterns.title.incomes",u)))+'</h3>\n            <div class="sf-icon-help sf-pattern-income-help"></div>\n			<div class="sf-toggle-patterns-incomes-view-button sf-toggle-grids sf-hide-grid-view">\n\n			</div>\n		</div>\n		<div class="sf-patterns-income-datagrid"></div>\n		<div class="sf-patterns-button-container sf-patterns-add-income-container">\n			<button class="sf-button sf-patterns-add-income" tabindex="0" type="button">\n				<div class="sf-patterns-add-income-plus-icon">\n				</div>\n				<span class="sf-button-text">\n					',u={hash:{}},s+=f((o=n.t,o?o.call(t,"patterns.button.addIncomePattern",u):a.call(t,"t","patterns.button.addIncomePattern",u)))+'\n				</span>\n			</button>\n		</div>\n	</div>\n	<div class="sf-patterns-expenses-wrapper">\n		<div class="sf-patterns-subheader">\n			<h3>',u={hash:{}},s+=f((o=n.t,o?o.call(t,"patterns.title.expenses",u):a.call(t,"t","patterns.title.expenses",u)))+'</h3>\n            <div class="sf-icon-help sf-pattern-expense-help"></div>\n			<div class="sf-toggle-patterns-expenses-view-button sf-toggle-grids sf-hide-grid-view">\n\n			</div>\n		</div>\n		<div class="sf-patterns-expenses-datagrid"></div>\n		<div class="sf-patterns-button-container sf-patterns-add-expense-container">\n			<button class="sf-button sf-patterns-add-expense" tabindex="0" type="button">\n				<div class="sf-patterns-add-income-plus-icon">\n				</div>\n				<span class="sf-button-text">\n					',u={hash:{}},s+=f((o=n.t,o?o.call(t,"patterns.button.addExpensePattern",u):a.call(t,"t","patterns.button.addExpensePattern",u)))+"\n				</span>\n			</button>\n		</div>\n\n	</div>\n</div>",s});return t.registerPartial("modules_patterns_templates_patterns",n),n}),define("libs/require/css/css!modules/patterns/css/patterns",[],function(){}),define("modules/patterns/patterns-module",["classes/layout","classes/collection","services/patterns-service","ui/modules/popup/popup-module","utils/util","modules/patterns-datagrid/patterns-datagrid-module","modules/pattern-editor/pattern-editor-module","hbs!modules/patterns/templates/patterns","css!modules/patterns/css/patterns","utils/mask"],function(e,t,n,r,i,s,o,u){var a=e.extend({template:u,regions:{incomesRegion:".sf-patterns-income-datagrid",expensesRegion:".sf-patterns-expenses-datagrid"},events:{"click .sf-patterns-discover":"_discoverPatterns","click .sf-patterns-add-income":"_addIncomePatternClick","click .sf-patterns-add-expense":"_addExpensePatternClick"},initialize:function(){this._super.apply(this,arguments),this.patternsService=n.getInstance(),this._dataReceived=i.bind(this._dataReceived,this),this._dataUpdated=i.bind(this._dataUpdated,this),this._dataError=i.bind(this._dataError,this)},onRender:function(){this._super(),i.mask(this.$el,i.MASK_LOADING),i.when(this.patternsService.get()).done(this._dataReceived).fail(this._dataError)},_discoverPatterns:function(){var e=this;i.when(this.patternsService.findPatterns()).done(function(t){if(!t.patternsCreated){var n={$container:e.options.$popupContainer,$opener:e.$el,title:i.i18n.get("patterns.discover.notFoundTitle"),content:i.i18n.get("patterns.discover.notFoundText"),type:r.ALERT,closeCallback:function(){s.remove()}},s=new r(n);s.open()}}).fail(this._dataError)},dispose:function(){this._result&&(this._result.dispose(),this._result=null)},_dataReceived:function(e){var t=this;this.dispose(),this._result=e,e.on("change",this._dataUpdated),e.data.on("add",function(e){e.get("amount")>0?t.income.push(e):t.expenses.push(e)}),e.data.on("remove",function(e){e.get("amount")>0?t.income.remove(e):t.expenses.remove(e)}),this._dataUpdated(e),i.unmask(this.$el)},_dataUpdated:function(e){var n=e.data.reduce(function(e,t){return t.get("amount")>0?e.income.push(t):e.expenses.push(t),e},{income:[],expenses:[]});this.income?this.income.reset(n.income):(this.income=new t(n.income),this.incomesRegion.show(this._createPatternDatagrid(i.extend({},this.contextConfig,{collection:this.income})))),this.expenses?this.expenses.reset(n.expenses):(this.expenses=new t(n.expenses),this.expensesRegion.show(this._createPatternDatagrid(i.extend({},this.contextConfig,{collection:this.expenses}))))},_createPatternDatagrid:function(e){return new s(e)},_dataError:function(e){console.error("[PatternsModule] Something went wrong",e),this.publish("error",e)},_addIncomePatternClick:function(e){var t=new o(i.extend({},this.contextConfig,{isExpense:!1}));this._openEditor(t,e.currentTarget)},_addExpensePatternClick:function(e){var t=new o(i.extend({},this.contextConfig,{isExpense:!0}));this._openEditor(t,e.currentTarget)},_openEditor:function(e,t){var n=this,s=function(){n.options.$popupContainer[0].style.minHeight=e.$el.height()*2+"px",this.$el[0].style.top="2em"},o=function(){f.remove(),n.options.$popupContainer[0].style.minHeight=null},u=e.options.isExpense?"expensesTitle":"incomesTitle",a={$container:this.options.$popupContainer,$opener:this.$(t),title:i.i18n.get("patterns.form."+u),closeCallback:o},f=new r(a);f.dialog.once("open",s),e.once("save",o),e.once("cancel",o),f.contentRegion.once("show",function(){f.open()}),f.contentRegion.show(e)}},{ID:"patterns",services:[n],submodules:[r,o,s],defaults:{}});return a}),define("modules/patterns/patterns-module-extension",["modules/patterns/patterns-module","classes/collection","services/patterns-service","ui/modules/popup/popup-module","jQuery","utils/util","modules/patterns-datagrid/patterns-datagrid-module","modules/pattern-editor/pattern-editor-module","hbs!modules/patterns/templates/patterns","css!modules/patterns/css/patterns","utils/mask"],function(e,t,n,r,i,s,o,u,a){var f=e.extend({events:{"click .sf-patterns-discover":"_discoverPatterns","click .sf-patterns-add-income":"_addIncomePatternClick","click .sf-patterns-add-expense":"_addExpensePatternClick","click .sf-toggle-patterns-incomes-view-button":"_toggleIncomesGrid","click .sf-toggle-patterns-expenses-view-button":"_toggleExpensesGrid","click .sf-pattern-income-help":"_openHelpPatternIncomePopup","click .sf-pattern-expense-help":"_openHelpPatternExpensePopup"},ui:{$incomeDatagridToggleButton:".sf-toggle-patterns-incomes-view-button",$expenseDatagridToggleButton:".sf-toggle-patterns-expenses-view-button",$incomeDatagrid:".sf-patterns-income-datagrid",$expenseDatagrid:".sf-patterns-expenses-datagrid",$incomeContainer:".sf-patterns-income-wrapper",$expensesContainer:".sf-patterns-expenses-wrapper"},initialize:function(){this._super.apply(this,arguments),this._fixAddButtonsAlignment=s.bind(this._fixAddButtonsAlignment,this)},_toggleIncomesGrid:function(){this.ui.$incomeDatagridToggleButton.toggleClass("sf-hide-grid-view"),this.ui.$incomeDatagridToggleButton.toggleClass("sf-show-grid-view"),this.ui.$incomeDatagrid.siblings(".sf-patterns-button-container").toggle(),this.ui.$incomeDatagrid.toggle(),this.ui.$incomeContainer.toggleClass("sf-collapsed")},_toggleExpensesGrid:function(){this.ui.$expenseDatagridToggleButton.toggleClass("sf-hide-grid-view"),this.ui.$expenseDatagridToggleButton.toggleClass("sf-show-grid-view"),this.ui.$expenseDatagrid.siblings(".sf-patterns-button-container").toggle(),this.ui.$expenseDatagrid.toggle(),this.ui.$expensesContainer.toggleClass("sf-collapsed")},_addIncomePatternClick:function(e){s.pushToDataLayer({eventCategory:"PFM Calendario-Movimientos Recurrentes",eventAction:"Boton",eventLabel:"Agregar ingresos recurrentes",event:"eventClick"});var t=new u(s.extend({},this.contextConfig,{isExpense:!1}));this._openEditor(t,e.currentTarget,{isExpense:!1,isNew:!0})},_addExpensePatternClick:function(e){s.pushToDataLayer({eventCategory:"PFM Calendario-Movimientos Recurrentes",eventAction:"Boton",eventLabel:"Agregar gastos recurrentes",event:"eventClick"});var t=new u(s.extend({},this.contextConfig,{isExpense:!0}));this._openEditor(t,e.currentTarget,{isExpense:!0,isNew:!0})},_openEditor:function(e,t,n){var i=this,o=n.isExpense,u=n.isNew,a=u?"title":"editTitle",f=function(){i.options.$popupContainer[0].style.minHeight=e.$el.height()*2+"px",this.$el[0].style.top="2em"},l=function(){v.remove(),i.options.$popupContainer[0].style.minHeight=null},c=o?"expense":"income",h=s.i18n.get("pattern-editor.form."+a+"."+c),p={$container:this.options.$popupContainer,$opener:this.$(t),title:h,titleIcon:"dav-plus-red",labelClose:s.i18n.get("popup.label.back"),closeCallback:l,maskClass:"sf-transparent-mask"};if(u){var d=o?"expenseSubtitle":"incomeSubtitle";p.subtitle=s.i18n.get("pattern-editor.form.title."+d),e.once("save",function(){n.isExpense?s.pushToDataLayer({eventCategory:"PFM Calendario-Movimientos Recurrentes",eventAction:"Boton",eventLabel:"Guardar- Agregar gastos recurrentes",event:"eventClick"}):s.pushToDataLayer({eventCategory:"PFM Calendario-Movimientos Recurrentes",eventAction:"Boton",eventLabel:"Guardar- Agregar ingresos recurrentes",event:"eventClick"})}),e.once("cancel",function(){n.isExpense?s.pushToDataLayer({eventCategory:"PFM Calendario-Movimientos Recurrentes",eventAction:"Boton",eventLabel:"Cancelar- Agregar gastos recurrentes",event:"eventClick"}):s.pushToDataLayer({eventCategory:"PFM Calendario-Movimientos Recurrentes",eventAction:"Boton",eventLabel:"Cancelar- Agregar ingresos recurrentes",event:"eventClick"})})}p["class"]="sf-pattern-editor-popup";var v=new r(p);v.dialog.once("open",f),e.once("save",l),e.once("cancel",l),v.contentRegion.once("show",function(){v.open()}),v.contentRegion.show(e)},_dataUpdated:function(e){var n=e.data.reduce(function(e,t){return t.get("amount")>0?e.income.push(t):e.expenses.push(t),e},{income:[],expenses:[]});this.income?this.income.reset(n.income):(this.income=new t(n.income),this.incomesGrid=this._createPatternDatagrid(s.extend({},this.contextConfig,{collection:this.income,isIncomeGrid:!0})),this.incomesGrid.on("collectionItemsChanged",this._fixAddButtonsAlignment),this.incomesRegion.show(this.incomesGrid)),this.expenses?this.expenses.reset(n.expenses):(this.expenses=new t(n.expenses),this.expensesGrid=this._createPatternDatagrid(s.extend({},this.contextConfig,{collection:this.expenses})),this.expensesGrid.on("collectionItemsChanged",this._fixAddButtonsAlignment),this.expensesRegion.show(this.expensesGrid)),this._fixAddButtonsAlignment()},_fixAddButtonsAlignment:function(e){this.income.models.length===0?this.$el.find(".sf-patterns-add-income-container").addClass("sf-no-transactions"):this.$el.find(".sf-patterns-add-income-container").removeClass("sf-no-transactions"),this.expenses.models.length===0?this.$el.find(".sf-patterns-add-expense-container").addClass("sf-no-transactions"):this.$el.find(".sf-patterns-add-expense-container").removeClass("sf-no-transactions")},_openHelpPatternIncomePopup:function(e){s.pushToDataLayer({eventCategory:"PFM Calendario-Movimientos Recurrentes",eventAction:"Boton",eventLabel:"Tooltip Ingresos recurrentes",event:"eventClick"});var t=i(e.currentTarget),n={$container:this.$el,$opener:t,content:s.i18n.get("patterns.info.webIncome"),type:r.INFO,closeCallback:s.bind(this._closePopup,this),maskClass:"sf-dark-mask"};this.infoPopup=new r(n),this.infoPopup.open()},_openHelpPatternExpensePopup:function(e){s.pushToDataLayer({eventCategory:"PFM Calendario-Movimientos Recurrentes",eventAction:"Boton",eventLabel:"Tooltip gastos recurrentes",event:"eventClick"});var t=i(e.currentTarget),n={$container:this.$el,$opener:t,content:s.i18n.get("patterns.info.webExpense"),type:r.INFO,closeCallback:s.bind(this._closePopup,this),maskClass:"sf-dark-mask"};this.infoPopup=new r(n),this.infoPopup.open()},_closePopup:function(){this.infoPopup.remove()}});return f}),define("hbs!modules/financial-calendar-columnchart/templates/financial-calendar-columnchart",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-financial-calendar-columnchart">\n	<div class="sf-columnchart-placeholder"></div>\n</div>'});return t.registerPartial("modules_financial-calendar-columnchart_templates_financial-calendar-columnchart",n),n}),define("libs/require/css/css!modules/financial-calendar-columnchart/css/financial-calendar-columnchart",[],function(){}),define("modules/financial-calendar-columnchart/financial-calendar-columnchart-module",["classes/layout","ui/modules/columnchart/columnchart-module","hbs!modules/financial-calendar-columnchart/templates/financial-calendar-columnchart","d3","classes/model","utils/amount","utils/date","css!modules/financial-calendar-columnchart/css/financial-calendar-columnchart"],function(e,t,n,r,i,s){var o=e.extend({template:n,regions:{chartRegion:".sf-columnchart-placeholder"},initialize:function(e){this._super(e);var n=s.merge({model:new i},this.contextConfig);this.chartView=new t(n),this.chartView.getXaxisFormat=function(e){return s.date.format(e,s.date.constructor.SHORT_MONTH)}},onShow:function(){this.chartRegion.show(this.chartView)},_updateData:function(e){switch(e.mode){case"year":this.config.stepScale="month",e.collection=this._accumulateData(e),this.chartView.getXaxisFormat=function(e){return s.date.format(e,s.date.constructor.SHORT_MONTH)};break;case"month":this.config.stepScale="day",e.collection=this._accumulateData(e),this.chartView.getXaxisFormat=function(e){return s.date.format(e,"d MMM")};break;case"day":return}var t=this._parseSeries(e);this.chartView.model.set(t,{})},_accumulateData:function(e){if(s.isEmpty(e.collection))return e;var t={},n=this;return e.collection.each(function(e){var r=s.date.format(e.get("date"),n.config.dataDateFormats[n.config.stepScale]),i=t[r]?t[r].totalIn:0,o=t[r]?t[r].totalOut:0,u=t[r]?t[r].totalBalance:0;t[r]===undefined&&(t[r]={}),t[r].totalIn=i+e.get("totalIn"),t[r].totalOut=o+e.get("totalOut"),t[r].totalBalance=u+e.get("totalBalance")},this),t},_parseSeries:function(e){if(s.isEmpty(e.collection))return null;var t=this,n="balance-accessible-chart.tooltip.",r=0,i=["income","expenses","balance"],o=function(n){var r=s.date.format(n,t.config.dataDateFormats[t.config.stepScale]);return e.collection[r]},u=function(e,i){var o=0;e&&i==="income"?o=e.totalIn:e&&i==="expenses"?o=e.totalOut:e&&i==="balance"&&(o=e.totalBalance),i==="balance"&&(o+=r,r=o);var u=s.unicodeHTMLCodes(s.amount.format(i==="balance"?o:Math.abs(o),t.config.showDecimals));return{label:s.i18n.get(n+i),sublabel:u,value:o,options:{kind:i}}},a=function(n){return s.map(s.date.datesInPeriod(t.config.stepScale,e.fromDate,e.toDate),function(e){var t=o(e);return u(t,n)})},f=function(e,r){var i=t.config.colors[e],o=a(e),u=s.reduce(s.pluck(o,"value"),function(e,t){return e+t},0);return{label:s.i18n.get(n+e),sublabel:s.unicodeHTMLCodes(s.amount.format(Math.abs(u),t.config.showDecimals)),color:i,options:{type:r<2?"column":"line"},points:o}},l=s.map(i,f);return this.axisData={income:s.pluck(l[0].points,"sublabel"),expenses:s.pluck(l[1].points,"sublabel")},{label:null,sublabel:null,"class":"",series:l,axis:{x:s.date.datesInPeriod(t.config.stepScale,e.fromDate,e.toDate)}}}},{ID:"financial-calendar-columnchart",submodules:[],defaults:{disableCategoryChange:!1,stepScale:"month",titleFormats:{month:s.date.constructor.LONG_MONTH_YEAR},dataDateFormats:{day:s.date.constructor.BACKEND_FORMAT,month:s.date.constructor.BACKEND_MONTH_YEAR_FORMAT},dateFormats:{month:s.date.constructor.LONG_MONTH},colors:{income:"#4d97CF",balance:"#535353",expenses:"#CA5841"},emptyMessage:"balance-accessible-chart.empty",showDecimals:!1}});return o}),define("hbs!ui/modules/calendar/templates/calendar",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i,s;return r+="\n				",s={hash:{"class":e["class"],text:e.text,dataKey:e.key,type:"button"}},r+=l((i=n.button,i?i.call(e,s):f.call(e,"button",s)))+"\n			",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function",h=this;s+='<div class="sf-calendar sf-calendar-',(o=n.current)?o=o.call(t,{hash:{}}):(o=t.current,o=typeof o===c?o.apply(t):o),s+=l(o)+'-mode">\n	<div class="sf-calendar-controls">\n		<div class="sf-calendar-nav">\n			<div class="sf-button-group">\n				',a={hash:{"class":"sf-calendar-control-previous",type:"button",text:"calendar.buttons.left"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+"<!--\n				-->",a={hash:{"class":"sf-calendar-period-title",type:"button"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+"<!--\n				-->",a={hash:{"class":"sf-calendar-control-next",type:"button",text:"calendar.buttons.right"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+'\n			</div>\n		</div>\n		<div class="sf-calendar-layouts">\n			',a={hash:{},inverse:h.noop,fn:h.program(1,p,i)},u=(o=n.iter,o?o.call(t,t.layouts,a):f.call(t,"iter",t.layouts,a));if(u||u===0)s+=u;return s+='\n		</div>\n		<div class="sf-calendar-dates">\n			<div class="sf-button-group">\n				',a={hash:{"class":"sf-calendar-control-today",type:"button",text:"calendar.buttons.today"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+'\n			</div>\n		</div>\n	</div>\n	<div class="sf-calendar-body"></div>\n</div>',s});return t.registerPartial("ui_modules_calendar_templates_calendar",n),n}),define("libs/require/css/css!ui/modules/calendar/css/calendar",[],function(){}),define("ui/modules/calendar/calendar-module",["classes/collection","classes/item-view","hbs!ui/modules/calendar/templates/calendar","utils/util","utils/mask","utils/date","utils/i18n","css!ui/modules/calendar/css/calendar"],function(e,t,n,r){var i=t.extend({template:n,ui:{body:".sf-calendar-body",periodTitle:".sf-calendar-period-title .sf-button-text"},events:{"click .sf-calendar-control-next":"next","click .sf-calendar-control-previous":"previous","click .sf-calendar-control-left":"goLeft","click .sf-calendar-control-right":"goRight","click .sf-calendar-control-today":"today","click .sf-calendar-layouts button":"_buttonLayoutHandler"},initialize:function(e){this._super(e);var t=e.layouts||this.config.layouts;this._today=r.date.parseBackendDate(this.globals.environment.serverDate),this._now=new Date(+this._today);if(!t||!r.size(t))throw"[Calendar] At least one layout should be specified";this.layouts={},this.layoutsOrder=[];var n=r.extend({},this.contextConfig,{calendar:this});r.each(t,function(e){var t=new e.layout(n);this.layouts[e.key]=t,this.layoutsOrder.push(e.key)},this),this._layout=e.defaultLayout||this.config.stepScale;if(!this._layout||!this.layouts[this._layout])throw"[Calendar] Layout not specified or it does not exists";this.exportDateRange.apply(this,this.layouts[this._layout].exportRange(this.now())),this._modelGetFail=r.bind(this._modelGetFail,this),this.updateData=r.bind(this.updateData,this),this._printing=!1;if(this.config.timeDirection==="auto"){var i=this.config.textDirection=="rtl";this.futureDirection=i?"left":"right"}else this.config.timeDirection==="rtl"?this.futureDirection="left":this.futureDirection="right"},serializeData:function(){return{layouts:r.map(this.layoutsOrder,function(e){var t=this.layouts[e];return{key:e,text:t.name(),title:t.title(),"class":"sf-calendar-layout-"+e}},this),current:this._layout}},onRender:function(){this._super(),this._updateView(),this._updatePeriodTitle()},exportDateRange:function(e,t){return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),t.setHours(23),t.setMinutes(59),t.setSeconds(0),t.setMilliseconds(0),this._startDate=e,this._endDate=t,{fromDate:e,toDate:t}},exportPeriodRange:function(){var e=this.layouts[this._layout].periodRange(this._now);return{fromDate:e[0],toDate:e[1]}},now:function(){return new Date(+this._now)},startDate:function(){return new Date(+this._startDate)},endDate:function(){return new Date(+this._endDate)},dateRange:function(){return[this.startDate(),this.endDate()]},next:function(){this._toggleDate(this.layouts[this._layout].next)},previous:function(){this._toggleDate(this.layouts[this._layout].previous)},today:function(){this.display(this._today)},layout:function(e){return!arguments.length||this._layout==e?this._layout:(this.$el.removeClass("sf-calendar-"+this._layout+"-mode").addClass("sf-calendar-"+e+"-mode"),this._layout=e,this._updateView(),this._layout)},display:function(e,t){t&&t!=this._layout?(this._now.setTime(+e),this.layout(t)):this.dateToKey(e)!=this.dateToKey(this._now)&&this._toggleDate(function(t){t.setTime(+e)})},goRight:function(){this.futureDirection=="left"?this.previous():this.next()},goLeft:function(){this.futureDirection=="left"?this.next():this.previous()},dateToClassId:function(e){return"sf-calendar-cell-"+this.dateToKey(e)},dateToKey:function(e){return r.date.format(e,i.KEY_DATE_FORMAT)},dayOfWeek:function(e){return(e.getDay()-this.config.weekStart+7)%7},_toggleDate:function(e){var t=this.now(),n=this.layouts[this._layout];e(this._now);if(n.inSamePeriod(t,this._now))this._notifyChanges();else{var r=t.getTime()>this._now.getTime();this.futureDirection=="left"?this._updateView(r?"right":"left"):this._updateView(r?"left":"right")}},inPeriod:function(e){return this.layouts[this._layout].inSamePeriod(e,this._now)},_updateView:function(e){var t=this,n=this.layouts[this._layout],i=n.exportRange(this.now()),s=this.exportDateRange.apply(this,i);s.layout=this._layout,r.mask(this.$el,r.MASK_LOADING),r.when(this.getDateViews(s)).then(function(n){t._printDateViews(n,e)}).fail(this._modelGetFail)},_modelGetFail:function(e){console.error("[%s] Failed to retrieve date grouped models",this.constructor.ID,e),this.publish("error",e)},getDateViews:function(){var e=r.Deferred();return setTimeout(function(){e.resolve({})},1),e.promise()},updateData:function(e){r.mask(this.$el,r.MASK_LOADING),this._printDateViews(e)},timePosition:function(e){var t="yyyyMMdd",n=r.date.format(this._today,t);return e=r.date.format(e,t),e==n?"today":e>n?"future":"past"},_printDateViews:function(t,n){if(this._printing){(function(e,t,n){setTimeout(function(){e._printDateViews(t,n)},e.config.transitionDelay)})(this,t,n);return}this._printing=!0;var i=r.date.datesInPeriod(r.date.constructor.DAY,this._startDate,this._endDate),s=this,o=this.layouts[this._layout],u=new e(r.map(i,function(e){return{date:e,position:s.timePosition(e),itemView:t[s.dateToKey(e)]}})),a=r.extend({},this.contextConfig,{config:o.config},{collection:u,calendar:this}),f=new o.view(a);this.$el.find(".sf-calendar-layouts .sf-active").removeClass("sf-active"),this.$el.find(".sf-calendar-layout-"+this._layout).addClass("sf-active"),f.render(),r.unmask(this.$el),n?this._doSlide(n,f,function(){s._printing=!1,s._updatePeriodTitle()}):(this.ui.body.html(f.el),this._updatePeriodTitle(),this._printing=!1),this._notifyChanges()},_updatePeriodTitle:function(){var e=this.layouts[this._layout],t=this._now;this.ui.periodTitle.text(e.periodTitle(t))},_doSlide:function(e,t,n){var r=this.ui.body,i=r.children().last(),s=t.$el,o=r.width(),u=r.height(),a={},f={position:"absolute",top:0,width:o+"px"},l=function(){for(var t in f)f[t]="";f[e]="",s.css(f).siblings().remove(),r.css({width:"",height:"",overflow:""}),typeof n=="function"&&n()};r.css({width:o+"px",height:u+"px",overflow:"hidden"}),s.css(f).css(e,"-"+o+"px"),i.css(f).css(e,"0"),a[e]="+="+o+"px",r.append(s).children().animate(a,this.config.transitionDelay,l)},_markRelevantCells:function(){this.$el.find(".sf-calendar-active").removeClass("sf-calendar-active"),this.$el.find("."+this.dateToClassId(this._now)).addClass("sf-calendar-active")},_notifyChanges:function(){var e={mode:this._layout,date:this._now,range:{start:this._startDate,end:this._endDate},calendar:this};this._markRelevantCells(),this.publish("calendar:change",e),this.trigger("calendar:change",e),this.$el.trigger("calendar:change",[e])},_buttonLayoutHandler:function(e){this.layout(this.$(e.currentTarget).data("key"))}},{ID:"calendar",KEY_DATE_FORMAT:"yyyyMMdd",defaults:{transitionDelay:500,weekStart:1,layouts:[],stepScale:""}});return i}),define("hbs!ui/modules/calendar/templates/calendar-mobile",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i,s;return r+="\n					",s={hash:{"class":e["class"],text:e.text,dataKey:e.key,type:"button"}},r+=l((i=n.button,i?i.call(e,s):f.call(e,"button",s)))+"\n				",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function",h=this;s+='<div class="sf-calendar sf-calendar-',(o=n.current)?o=o.call(t,{hash:{}}):(o=t.current,o=typeof o===c?o.apply(t):o),s+=l(o)+'-mode">\n	<div class="sf-calendar-main-view">\n		<div class="sf-calendar-controls">\n			<div class="sf-calendar-layouts">\n				',a={hash:{},inverse:h.noop,fn:h.program(1,p,i)},u=(o=n.iter,o?o.call(t,t.layouts,a):f.call(t,"iter",t.layouts,a));if(u||u===0)s+=u;return s+="\n				",a={hash:{"class":"sf-calendar-control-today",type:"button",text:"calendar.buttons.today"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+'\n			</div>\n			<div class="sf-calendar-nav">\n				<div class="sf-button-group">\n						',a={hash:{"class":"sf-calendar-control-previous",text:"calendar.buttons.left"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+"<!--\n				-->",a={hash:{"class":"sf-calendar-period-title",type:"button"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+"<!--\n				-->",a={hash:{"class":"sf-calendar-control-next",type:"button",text:"calendar.buttons.right"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+'\n				</div>\n			</div>\n		</div>\n		<div class="sf-calendar-body"></div>\n	</div>\n	<div class="sf-calendar-day-view-popup-container"></div>\n</div>',s});return t.registerPartial("ui_modules_calendar_templates_calendar-mobile",n),n}),define("ui/modules/calendar/calendar-module-mobile",["classes/collection","ui/modules/calendar/calendar-module","hbs!ui/modules/calendar/templates/calendar-mobile"],function(e,t,n){var r=t.extend({template:n,_buttonLayoutHandler:function(e){this.$(e.currentTarget).hasClass("sf-calendar-control-today")?this.display(this._today,"day"):this.layout(this.$(e.currentTarget).data("key"))}});return r}),define("data/transactions-calendar/transactions-calendar-consolidation-model",["classes/model","utils/util","utils/i18n"],function(e,t){var n=e.extend({parse:function(e){var n=this._super(e),r=this.constructor.ID_TO_PARSER_KEY[n.consType],i=this.constructor.PARSERS[r],s=this.constructor.COLORS[r];return n.type=n.type.toLowerCase(),n=t.merge(n,{key:r,type:n.type},i(n)),typeof s=="object"&&(s=s[n.type],typeof s=="object"&&(s=s[n.amountType])),n.color=s||"transaparent",n}},{ID_TO_PARSER_KEY:{"-1":"forecasting",0:"non-consolidated",1:"consolidated",2:"duplicated",3:"amount-deviation",4:"date-deviation",5:"expected",6:"changed"},COLORS:{expected:{income:"#d56d56",expense:"#89648a"},duplicated:"#d56d56","amount-deviation":{income:{lower:"#eec5bb",higher:"#c5b3c6"},expense:{lower:"#c5b3c6",higher:"#eec5bb"}},"date-deviation":"#eec5bb"},PARSERS:{forecasting:function(){return{alert:0,message:t.i18n.get("transactions-calendar.consolidations.forecasting")}},"non-consolidated":function(){return{alert:0,message:t.i18n.get("transactions-calendar.consolidations.non-consolidated")}},consolidated:function(){return{alert:0,message:t.i18n.get("transactions-calendar.consolidations.consolidated")}},duplicated:function(){return{alert:5,message:t.i18n.get("transactions-calendar.consolidations.duplicated")}},"amount-deviation":function(e){var n=parseInt(e.amountDiff,10),r=t.amount.format(Math.abs(n)),i=e.type=="income"?n>0?"lower":"higher":n>0?"higher":"lower";return{alert:n>0?4:2,amountType:i,message:t.i18n.get("transactions-calendar.consolidations.amount-deviation."+i,{amount:r})}},"date-deviation":function(e){var n=parseInt(e.daysDiff,10),r=Math.abs(n)===1?"oneDay":"manyDays",i=n>0?"future":"past",s=t.i18n.get("transactions-calendar.consolidations.date-deviation."+r,{days:Math.abs(n)});return{alert:1,message:t.i18n.get("transactions-calendar.consolidations.date-deviation."+i,{due:s})}},expected:function(e){return{alert:e.type=="income"?6:3,message:t.i18n.get("transactions-calendar.consolidations.expected")}},changed:function(){return{alert:0,message:t.i18n.get("transactions-calendar.consolidations.changed")}}}});return n}),define("data/transactions-calendar/transactions-calendar-day-transaction-model",["classes/model","data/transactions-calendar/transactions-calendar-consolidation-model"],function(e,t){var n=e.extend({_isInDayBalance:function(e){return e.forecasting||!e.cons||e.cons.consType!=5},_isExpected:function(e){return e.forecasting||!!e.cons&&!!e.cons.consType&&e.cons.consType!=6},parse:function(e){var n=this._super(e),r=n.cons||{consType:n.forecasting?-1:0};return n.forecasting&&(r=n.cons={consType:-1}),r.type=n.amount>0?"income":"expense",n.consolidation=new t(r,{parse:!0}),n.expected=this._isExpected(n),n.inDayBalance=this._isInDayBalance(n),n}});return n}),define("data/transactions-calendar/transactions-calendar-day-transaction-collection",["classes/collection","data/transactions-calendar/transactions-calendar-day-transaction-model"],function(e,t){var n=e.extend({model:t,categorize:function(e){var t={categorizedHash:{},categorized:[],income:[],expenses:[]};return this.each(function(t){var n=e[t.get("catId")];n||(n=e[0]),t.set({category:n},{silent:!0})}),this.reduce(this._categorizeTransaction,t)},_categorizeTransaction:function(e,t){var n,r,i=t.get("inDayBalance"),s=t.get("category");(t.get("amount")>0?e.income:e.expenses).push(t);while(s.get("catLevel"))s=s.get("parent");return r=s.get("catId")+"-"+i,n=e.categorizedHash[r],n||(e.categorizedHash[r]=n={name:s.get("catName"),color:s.get("catHexrgbcolor"),order:s.get("catOrder"),amount:0,inTotal:i},e.categorized.push(n)),n.amount+=t.get("amount"),e}});return n}),define("data/transactions-calendar/transactions-calendar-day-model",["classes/model","data/transactions-calendar/transactions-calendar-day-transaction-collection","utils/util","utils/config"],function(e,t,n){var r=e.extend({parse:function(e){var r=this._super(e);r.date=new Date(r.date),r.totalIn!==undefined&&r.totalOut!==undefined?r.totalBalance=r.totalIn-r.totalOut:r.totalBalance=0,r.forecasting&&(r.transactions=n.map(r.forecasting,function(e){return e.forecasting=!0,e}));var i=n.date.today(),s=r.date>i;n.each(r.transactions,function(e){e.forecasting=s}),r.transactions=new t(r.transactions,{parse:!0});var o=r.transactions.reduce(this._transactionAlerts,{level:0,color:"transparent"});return r.alert=o,r.notifications||(r.notifications=[]),r},_transactionAlerts:function(e,t){var n=t.get("consolidation"),r=n.get("alert"),i=n.get("color");return e.level>r?e:{level:r,color:i}},attachReferences:function(e){this.set(this.get("transactions").categorize(e),{silent:!0})}});return r}),define("data/transactions-calendar/transactions-calendar-day-collection",["classes/collection","data/transactions-calendar/transactions-calendar-day-model","utils/util","utils/date"],function(e,t,n){var r=e.extend({model:t,url:"/financialcalendar/get.action",parse:function(e){return this.initialBalance=e.initialBalance,this.currBalance=e.currBalance,this.eomBalance=e.eomBalance,this.maxTotalInBelowThreshold=e.maxTotalInBelowThreshold,this.maxTotalOutBelowThreshold=e.maxTotalOutBelowThreshold,this.startFIncome=e.startFIncome,this.startFExpenses=e.startFExpenses,this.confirmedPatterns=e.confirmedPatterns,this.pendingPatterns=e.pendingPatterns,e.days=n.map(e.days,function(e,t){return e.date=n.date.parseBackendDate(t),e.id=t,e}),e.days}});return r}),define("data/transactions-calendar/transactions-calendar-day-data-manager",["classes/data-manager","data/transactions-calendar/transactions-calendar-day-collection","classes/remote-error","utils/util","utils/date"],function(e,t,n,r){var i=e.extend({initialize:function(){this._super.apply(this,arguments),this.collectionDefs={"transactions-calendar-day":{type:t,subscriptions:["transaction:add","transaction:remove","transaction:change","rule:add","rule:change","rule:remove","category:remove","category:change","pattern:change","pattern:remove","pattern:add","pattern:found","account:update"]}}},get:function(e){return this.getCollection("transactions-calendar-day",e)},evaluateRequestParams:function(e,t,n){n.fromDate=t.fromDate?t.fromDate:this.options.defaultMinDate,n.toDate=t.toDate?t.toDate:this.options.defaultMaxDate,n.fromDate=r.date.truncate(r.date.constructor.DAY,n.fromDate),n.toDate=r.date.add(r.date.constructor.DAY,n.toDate,1),n.toDate=r.date.truncate(r.date.constructor.DAY,n.toDate);if(n.force||this.collectionDefs[e]._currentState.fromDate===undefined)console.log("[TransactionsCalendarDayDataManager] First request."),n.load=!0,n.remove=!0;else{var i=n.fromDate<this.collectionDefs[e]._currentState.fromDate,s=n.toDate>this.collectionDefs[e]._currentState.toDate;if(i||s)i&&!s?(n.toDate=new Date(this.collectionDefs[e]._currentState.fromDate.getTime()),n.load=!0,n.remove=!1):s&&!i?(n.fromDate=r.date.truncate(r.date.constructor.DAY,this.collectionDefs[e]._currentState.toDate),n.load=!0,n.remove=!1):s&&i&&(n.load=!0,n.remove=!0)}},onCollectionFetched:function(e,t,n){var r=this.collectionDefs[e]._currentState;if(n.force)r.fromDate=new Date(n.fromDate.getTime()),r.toDate=new Date(n.toDate.getTime());else{if(r.fromDate===undefined||n.fromDate<r.fromDate)r.fromDate=new Date(n.fromDate.getTime());if(r.toDate===undefined||n.toDate>r.toDate)r.toDate=new Date(n.toDate.getTime())}this.collectionDefs[e]._params.fromDate=new Date(r.fromDate.getTime()),this.collectionDefs[e]._params.toDate=new Date(r.toDate.getTime())},getRequestData:function(e,t,n){var i=r.date.formatBackendDate(n.fromDate),s=r.date.formatBackendDate(n.toDate);return{startStr:i,endStr:s}}},{defaults:{defaultMinDate:new Date(2011,0,1),defaultMaxDate:new Date}});return i}),define("services/transactions-calendar-service",["classes/service","classes/resource-loader","classes/filtered-collection","data/transactions-calendar/transactions-calendar-day-data-manager","data/categories/categories-data-manager","utils/util","utils/date"],function(e,t,n,r,i,s){var o=e.extend({initialize:function(){this._super.apply(this,arguments),this.transactionsCalendarDayDM=r.getInstance(),this.categoriesDM=i.getInstance(),this.resources.categories=new t(this.categoriesDM,this.categoriesDM.get)},get:function(e){var n={days:new t(this.transactionsCalendarDayDM,this.transactionsCalendarDayDM.get,e),categories:this.resources.categories};return this.executeJob(n,this._getTask(e),n)},_getFilterFunction:function(e){return function(t){var n=t.get("date");return e.fromDate>n?!1:e.toDate<n?!1:!0}},_getTask:function(e){var t=this._getFilterFunction(e);return function(){var e=this.categories.data.hash,r=this.days.data,i=new n;return i.setupFilter(r,t),i.each(function(t){t.attachReferences(e)}),i}},exportCalendar:function(e){console.log("[TransactionsCalendarService] Exporting calendar...");var t={};e.fromDate&&(t.startStr=s.date.formatBackendDate(e.fromDate)),e.toDate&&(t.endStr=s.date.formatBackendDate(s.date.add(s.date.constructor.DAY,e.toDate,1))),window.location=s.config.getGlobals().environment.contextPath+"/financialcalendar/ics.action?"+s.param(t)}},{ID:"transactions-calendar-service"});return o}),define("hbs!modules/transactions-calendar/templates/transactions-calendar-day-item-view-template",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i,s;return r+='\n		<div class="sf-transactions-calendar-future-alert">\n			',s={hash:{}},r+=l((i=n.t,i?i.call(e,"transactions-calendar.day.webFutureAlert",s):f.call(e,"t","transactions-calendar.day.webFutureAlert",s)))+"\n		</div>\n	",r}function d(e,t){return"sf-expanded sf-toggle"}function v(e,t){return"sf-future-datagrid"}function m(e,t){var r="",i,s,o;r+='\n	<div class="sf-transactions-calendar-section-title">\n		<h3>',o={hash:{}},r+=l((i=n.t,i?i.call(e,"transactions-calendar.day.notifications.title",o):f.call(e,"t","transactions-calendar.day.notifications.title",o)))+'</h3>\n	</div>\n	<ul class="sf-transactions-calendar-notifications">\n		',o={hash:{},inverse:h.noop,fn:h.program(8,g,t)},s=(i=n.iter,i?i.call(e,e.notifications,o):f.call(e,"iter",e.notifications,o));if(s||s===0)r+=s;return r+="\n	</ul>\n	",r}function g(e,t){var r="",i;return r+="\n		<li>\n			",(i=n.name)?i=i.call(e,{hash:{}}):(i=e.name,i=typeof i===c?i.apply(e):i),r+=l(i)+"\n		</li>\n		",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function",h=this;s+='<div class="sf-transactions-calendar-day-cell">\n	',o=n["if"].call(t,t.future,{hash:{},inverse:h.noop,fn:h.program(1,p,i)});if(o||o===0)s+=o;s+='\n\n	<div class="sf-current-date-title">\n		<span> ',(o=n.fullDateLabel)?o=o.call(t,{hash:{}}):(o=t.fullDateLabel,o=typeof o===c?o.apply(t):o),s+=l(o)+'</span>\n	</div>\n	<div class="sf-transactions-calendar-section-title sf-income-section-title ',o=n.unless.call(t,t.hideIncomeToggle,{hash:{},inverse:h.noop,fn:h.program(3,d,i)});if(o||o===0)s+=o;s+='">\n		<h3>',a={hash:{}},s+=l((o=n.t,o?o.call(t,"transactions-calendar.day.income",a):f.call(t,"t","transactions-calendar.day.income",a)))+" <b>",a={hash:{}},u=(o=n.formatAmount,o?o.call(t,t.totalIn,a):f.call(t,"formatAmount",t.totalIn,a));if(u||u===0)s+=u;s+='</b></h3>\n	</div>\n	<div class="sf-income-datagrid-placeholder sf-transactions-calendar-day-income ',u=n["if"].call(t,t.future,{hash:{},inverse:h.noop,fn:h.program(5,v,i)});if(u||u===0)s+=u;s+='"></div>\n	<div class="sf-transactions-calendar-section-title sf-expenses-section-title ',u=n.unless.call(t,t.hideExpensesToggle,{hash:{},inverse:h.noop,fn:h.program(3,d,i)});if(u||u===0)s+=u;s+='">\n		<h3>',a={hash:{}},s+=l((o=n.t,o?o.call(t,"transactions-calendar.day.expenses",a):f.call(t,"t","transactions-calendar.day.expenses",a)))+" <b>",a={hash:{}},u=(o=n.formatAmount,o?o.call(t,t.totalOut,a):f.call(t,"formatAmount",t.totalOut,a));if(u||u===0)s+=u;s+='</b></h3>\n	</div>\n	<div class="sf-expenses-datagrid-placeholder sf-transactions-calendar-day-expenses ',u=n["if"].call(t,t.future,{hash:{},inverse:h.noop,fn:h.program(5,v,i)});if(u||u===0)s+=u;s+='"></div>\n	<div class="sf-transactions-calendar-section-title sf-cashflow-title">\n		<h3>\n			<span class="sf-cashflow-title-wrapper">\n				<span class="sf-cashflow-title">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"transactions-calendar.day.cashFlow.title",a):f.call(t,"t","transactions-calendar.day.cashFlow.title",a)))+'</span>\n				<span class="sf-cashflow-subtitle">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"transactions-calendar.day.cashFlow.subtitle",a):f.call(t,"t","transactions-calendar.day.cashFlow.subtitle",a)))+'</span>\n			</span>\n			<span class="sf-cashflow-totalBalance-wrapper">\n				<b>',a={hash:{}},u=(o=n.formatAmount,o?o.call(t,t.totalBalance,a):f.call(t,"formatAmount",t.totalBalance,a));if(u||u===0)s+=u;s+="</b>\n			</span>\n\n		</h3>\n	</div>\n	",u=n["if"].call(t,(o=t.notifications,o==null||o===!1?o:o.length),{hash:{},inverse:h.noop,fn:h.program(7,m,i)});if(u||u===0)s+=u;return s+="\n</div>\n",s});return t.registerPartial("modules_transactions-calendar_templates_transactions-calendar-day-item-view-template",n),n}),define("modules/transactions-calendar/views/transactions-calendar-day-item-view",["classes/item-view","hbs!modules/transactions-calendar/templates/transactions-calendar-day-item-view-template","utils/util","utils/date","utils/tooltip"],function(e,t,n){var r=e.extend({template:t,serializeData:function(){var e=this,t=function(t){return n.map(e.model.get(t),function(e){var t=e.get("category"),n=t,r={amount:e.get("amount"),currency:e.get("currency"),name:e.get("name"),consolidation:e.get("consolidation").toJSON(),catName:t.get("catName"),catColor:t.get("catHexrgbcolor"),notcomputable:!e.get("computable")&&!e.get("forecasting")&&!e.get("expected"),notInDayBalance:!e.get("inDayBalance")};if(t.id){while(n.get("catLevel"))n=n.get("parent");r.parentCat=n.get("catName")}return r})},r={notifications:this.model.get("notifications"),income:t("income"),expenses:t("expenses"),totalIn:this.model.get("totalIn"),totalOut:-Math.abs(this.model.get("totalOut")),totalBalance:this.model.get("totalBalance")};return r},onRender:function(){this._super(),n.tooltip.add(this.$(".sf-transactions-calendar-alert-mark,.sf-transactions-calendar-not-computable"),this.tooltipOptions)}});return r}),define("modules/transactions-calendar/views/transactions-calendar-day-item-view-extension",["modules/transactions-calendar/views/transactions-calendar-day-item-view","ui/modules/datagrid/v-datagrid-module","classes/collection","services/categories-service","services/accounts-service","hbs!modules/transactions-datagrid/templates/formatters/description","hbs!modules/transactions-datagrid/templates/formatters/category","hbs!modules/transactions-datagrid/templates/formatters/date","hbs!modules/transactions-datagrid/templates/formatters/amount","hbs!modules/transactions-datagrid/templates/formatters/tags","hbs!modules/transactions-datagrid/templates/formatters/channel","hbs!modules/transactions-datagrid/templates/formatters/document","hbs!modules/transactions-datagrid/templates/formatters/account","hbs!modules/transactions-calendar/templates/transactions-calendar-day-item-view-template","utils/util","utils/date","utils/tooltip"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){function g(e,t,n,r){var i=e.get("date").getTime(),s;return n>0&&(s=t.at(n-1).get("date").getTime()),s===i&&(r.classes=r.classes||[],r.classes.push("sf-repeated-date")),s=i,u({date:e.get("date")})}function y(e,t,n){return{name:e.get(t.field),realName:e.get("realName")===e.get(t.field)?"":e.get("realName"),isSplit:e.has("parentOpId"),editable:d.isFunction(t.editor),computable:e.get("computable")}}function b(e,t,n,r){var i=e.get("category"),s;return i.get("parent")!==undefined?s={hasParent:!0,parentName:i.get("parent").get("catName"),parentCatId:i.get("parent").get("catId"),catName:i.get("catName"),color:i.get("catHexrgbcolor"),editable:d.isFunction(t.editor)}:s={hasParent:!1,catName:i.get("catName"),catId:i.get("catId"),color:i.get("catHexrgbcolor"),editable:d.isFunction(t.editor)},s.hideSubcat=r==="transactions-pdf",s}function w(e,n,r,i){var s=e.get("category").get("catName"),o=n.get("category").get("catName");return t._basicComparator(s.toUpperCase(),o.toUpperCase(),e,n,i)}function E(e,t,n){return{name:e.get(t.field),isSplit:e.has("parentOpId"),editable:d.isFunction(t.editor),computable:e.get("computable"),tags:e.get("tags")}}function S(e,t){return{document:e.get("document")||""}}var v=t.DatagridColumn,m=e.extend({template:p,events:{"click .sf-income-section-title.sf-toggle":"_toggleIncomes","click .sf-expenses-section-title.sf-toggle":"_toggleExpenses"},ui:{$incomesToggleButton:".sf-income-section-title",$expensesToggleButton:".sf-expenses-section-title",$incomesSection:".sf-transactions-calendar-day-income",$expensesSection:".sf-transactions-calendar-day-expenses",$incomeDatagrid:".sf-income-datagrid-placeholder",$expensesDatagrid:".sf-expenses-datagrid-placeholder"},initialize:function(e){this._super(e),this._setupColumnsConfig(),this.categoriesService=r.getInstance(),this.accountsService=i.getInstance()},render:function(e){e===!0?this._super():typeof e=="undefined"&&(d.mask(this.$el,d.MASK_LOADING),d.when(this.categoriesService.get(),this.accountsService.get()).done(d.bind(this._dataReceived,this)).fail(d.bind(this._dataError,this)))},_dataReceived:function(e,t){d.unmask(this.$el),this.categories=e;var n=[];d.each(t.models,function(e){d.each(e.get("accounts").models,function(e){n[e.get("accountPK")]=e})}),this.accounts=n,this.categories.on("change",this.render,this),this.render(!0)},_dataError:function(e){d.unmask(this.$el),console.error("[TransactionsCalendarDayView] Error loading categories for TransactionsCalendarDayView ",e),this.publish("error",e)},_setupColumnsConfig:function(){var e=[];for(var t=0;t<this.config.gridConfig.columnDefs.length;t++){var n=this.config.gridConfig.columnDefs[t];n=d.extend({parent:this},n),n.labelKey!==undefined&&(n.label=d.i18n.get(n.labelKey)),e.push(new v(n))}this.config.gridConfig.columns=e},_toggleIncomes:function(){this.ui.$incomesToggleButton.toggleClass("sf-expanded"),this.ui.$incomesToggleButton.toggleClass("sf-closed"),this.ui.$incomesSection.toggle()},_toggleExpenses:function(){this.ui.$expensesToggleButton.toggleClass("sf-expanded"),this.ui.$expensesToggleButton.toggleClass("sf-closed"),this.ui.$expensesSection.toggle()},serializeData:function(){var e=this._super(),t=this,n=this.options.model.get("date"),r=n>d.date.today(),i=d.date.format(n,d.date.constructor.LONG_WEEK_DAY),s=n.getDate(),o=d.date.format(n,d.date.constructor.LONG_MONTH),u=n.getFullYear(),a=d.i18n.get("calendar-day.webFullDate",{dayName:i,date:s,month:o,year:u});return e.future=r,e.fullDateLabel=a,e},onRender:function(){var e=this;this._super(),d.tooltip.add(this.$(".sf-transactions-calendar-alert-mark,.sf-transactions-calendar-not-computable"),this.tooltipOptions);var r=d.extend({},this.contextConfig,{config:this.config.gridConfig,container:this.ui.$incomeDatagrid}),i=d.extend({},this.contextConfig,{config:this.config.gridConfig,container:this.ui.$expensesDatagrid}),s=function(t){t.attributes.date=e.options.model.attributes.date;var n=t.get("accType"),r=t.get("accId");n&&r&&e.accounts[n+"-"+r]&&(t.attributes.account=e.accounts[n+"-"+r]);var i=e.categories,s=d.filter(i.models,function(e){var n=t.catId;return t.parentCatId&&(n=t.parentCatId),e.get("catId")==n});return s[0]?t.catHexrgbcolor=s[0].get("catHexrgbcolor"):t.catHexrgbcolor="c5c5c5",t};this.originalIncomeList=this.model.get("income"),this.originalExpensesList=this.model.get("expenses"),this.incomeDatagrid=new t(r),this.expensesDatagrid=new t(i),this.incomeDatagrid.render(),this.expensesDatagrid.render(),d.map(this.originalIncomeList,s),d.map(this.originalExpensesList,s),this.incomeList=new n(this.originalIncomeList),this.expensesList=new n(this.originalExpensesList),this.incomeDatagrid.renderElements(this.incomeList),this.expensesDatagrid.renderElements(this.expensesList)}},{defaults:{gridConfig:{emptyMessageKey:"transactions-datagrid.emptyMessage",visibleRows:15,sortField:"date",sortDirection:"DESC",isTagsActive:!1,columnDefs:[{field:"date",headerClass:"sf-date-header",columnClass:"sf-date-col",labelKey:"transactions-datagrid.header.date",formatter:g,serializeData:function(e){return e},sortable:!0},{field:"amount",headerClass:"sf-amount-header sf-numeric",columnClass:"sf-numeric sf-amount-col",labelKey:"transactions-datagrid.web.header.amount",formatter:function(e){var t=e;return e.toJSON&&(t=e.toJSON()),t.isPositive=t.amount>=0,a(t)},serializeData:function(e){return e},sortable:!0},{field:"name",headerClass:"sf-desc-header",columnClass:"sf-desc-col",labelKey:"transactions-datagrid.header.name",formatter:s,serializeData:y,sortable:!0,comparator:"string"},{field:"accName",headerClass:"sf-acc-header",columnClass:"sf-acc-col",labelKey:"transactions-datagrid.header.accName",formatter:h,sortable:!0,serializeData:function(e){var t="",n=e.get("account");return n&&(t=n.get("alias")),{account:t}},comparator:"string"},{field:"catId",headerClass:"sf-cat-header",columnClass:"sf-cat-col",labelKey:"transactions-datagrid.header.catId",formatter:o,serializeData:b,sortable:!0,comparator:w},{field:"channel",formatter:l,headerClass:"sf-channel-header",columnClass:"sf-channel-col",labelKey:"transactions-datagrid.header.channel",serializeData:function(e){return{channel:e.get("office")||""}},sortable:!1,comparator:"string"},{field:"document",formatter:c,headerClass:"sf-document-header",columnClass:"sf-document-col",labelKey:"transactions-datagrid.header.document",serializeData:S,sortable:!1,comparator:"string"}]}}});return m}),define("hbs!modules/transactions-calendar/templates/transactions-calendar-alert-marks",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){var n="",r;return n+='<span class="sf-transactions-calendar-alert-mark" style="color:'+f((r=(r=e.alert,r==null||r===!1?r:r.color),typeof r===a?r.apply(e):r))+'"></span>',n}function h(e,t){return'<span class="sf-transactions-calendar-alert-mark sf-transactions-calendar-alert-mark-notification"></span>'}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression,l=this;s+='<div class="sf-transactions-calendar-alerts">',u=n["if"].call(t,(o=t.alert,o==null||o===!1?o:o.level),{hash:{},inverse:l.noop,fn:l.program(1,c,i)});if(u||u===0)s+=u;u=n["if"].call(t,(o=t.notifications,o==null||o===!1?o:o.length),{hash:{},inverse:l.noop,fn:l.program(3,h,i)});if(u||u===0)s+=u;return s+="</div>",s});return t.registerPartial("modules_transactions-calendar_templates_transactions-calendar-alert-marks",n),n}),define("hbs!modules/transactions-calendar/templates/transactions-calendar-small-entries-list",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i,s,o;r+='\n	<li title="',(i=n.name)?i=i.call(e,{hash:{}}):(i=e.name,i=typeof i===f?i.apply(e):i),r+=l(i)+'"',o={hash:{},inverse:c.noop,fn:c.program(2,d,t)},s=(i=n.ifequal,i?i.call(e,e.inTotal,!1,o):h.call(e,"ifequal",e.inTotal,!1,o));if(s||s===0)r+=s;r+='>\n		<div class="sf-transactions-calendar-small-entry-title">\n			<span style="background:#',(s=n.color)?s=s.call(e,{hash:{}}):(s=e.color,s=typeof s===f?s.apply(e):s),r+=l(s)+'" class="sf-category-mark">&nbsp;</span> ',(s=n.name)?s=s.call(e,{hash:{}}):(s=e.name,s=typeof s===f?s.apply(e):s),r+=l(s)+'\n		</div>\n		<div class="sf-transactions-calendar-small-entry-amount">\n			',o={hash:{showDecimals:!1}},s=(i=n.formatAmount,i?i.call(e,e.amount,o):h.call(e,"formatAmount",e.amount,o));if(s||s===0)r+=s;return r+="\n		</div>\n	</li>\n	",r}function d(e,t){return' class="sf-transactions-calendar-small-entry-not-in-total"'}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<ul class="sf-transactions-calendar-small-entries">\n	',a={hash:{},inverse:c.noop,fn:c.program(1,p,i)},u=(o=n.iter,o?o.call(t,t.entries,a):h.call(t,"iter",t.entries,a));if(u||u===0)s+=u;return s+="\n</ul>",s});return t.registerPartial("modules_transactions-calendar_templates_transactions-calendar-small-entries-list",n),n}),define("hbs!modules/transactions-calendar/templates/transactions-calendar-month-item-view-template",["hbs","Handlebars","hbs!modules/transactions-calendar/templates/transactions-calendar-alert-marks","hbs!modules/transactions-calendar/templates/transactions-calendar-small-entries-list"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){var i="",s;i+="\n	",s=f.invokePartial(r["modules_transactions-calendar_templates_transactions-calendar-small-entries-list"],"modules_transactions-calendar_templates_transactions-calendar-small-entries-list",e,n,r);if(s||s===0)i+=s;return i+="\n	",i}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,r=r||e.partials;var s="",o,u,a,f=this,l=n.helperMissing;s+='<div class="sf-transactions-calendar-month-cell">\n	',o=f.invokePartial(r["modules_transactions-calendar_templates_transactions-calendar-alert-marks"],"modules_transactions-calendar_templates_transactions-calendar-alert-marks",t,n,r);if(o||o===0)s+=o;s+="\n	",a={hash:{entries:t.categorized},inverse:f.noop,fn:f.program(1,c,i)},u=(o=n.partial,o?o.call(t,a):l.call(t,"partial",a));if(u||u===0)s+=u;s+='\n	<h6 class="sf-transactions-calendar-balance">',a={hash:{showDecimals:!1}},u=(o=n.formatAmount,o?o.call(t,t.totalBalance,a):l.call(t,"formatAmount",t.totalBalance,a));if(u||u===0)s+=u;return s+="</h6>\n</div>\n",s});return t.registerPartial("modules_transactions-calendar_templates_transactions-calendar-month-item-view-template",n),n}),define("modules/transactions-calendar/views/transactions-calendar-month-item-view",["classes/item-view","hbs!modules/transactions-calendar/templates/transactions-calendar-month-item-view-template","utils/util","utils/date","utils/i18n"],function(e,t,n){var r=e.extend({template:t,onRender:function(){this._super(),this.$el.click(this.options.show),n.tooltip.add(this.$(".sf-transactions-calendar-small-entries > li"),this.tooltipOptions)},serializeData:function(){var e={},t=this.model.get("categorized"),r=n.reduce(t.slice(3),function(e,t){return e.count++,t.inTotal&&(e.amount+=t.amount),e},{count:0,amount:0,color:"transaprent"});return e.totalBalance=this.model.get("totalBalance"),t.length>4?(e.categorized=t.slice(0,3),r.name=n.i18n.get("transactions-calendar.month.more-items",r),e.categorized.push(r)):e.categorized=t,e.notifications=this.model.get("notifications"),e.alert=this.model.get("alert"),e}});return r}),define("modules/transactions-calendar/views/transactions-calendar-month-item-view-extension",["modules/transactions-calendar/views/transactions-calendar-month-item-view","hbs!modules/transactions-calendar/templates/transactions-calendar-month-item-view-template","utils/util","utils/date","utils/i18n"],function(e,t,n){var r=e.extend({onRender:function(){this._super(),this.$el.click(this.options.show),n.tooltip.add(this.$(".sf-transactions-calendar-small-entries > li"),this.tooltipOptions)}});return r}),define("hbs!modules/transactions-calendar/templates/transactions-calendar-month-item-view-template-mobile",["hbs","Handlebars","hbs!modules/transactions-calendar/templates/transactions-calendar-alert-marks"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,r=r||e.partials;var s="",o,u,a,f=this,l=n.helperMissing;s+='<div class="sf-transactions-calendar-month-cell">\n	',o=f.invokePartial(r["modules_transactions-calendar_templates_transactions-calendar-alert-marks"],"modules_transactions-calendar_templates_transactions-calendar-alert-marks",t,n,r);if(o||o===0)s+=o;s+='\n	<h6 class="sf-transactions-calendar-balance">',a={hash:{showDecimals:!1}},u=(o=n.formatAmount,o?o.call(t,t.totalBalance,a):l.call(t,"formatAmount",t.totalBalance,a));if(u||u===0)s+=u;return s+="</h6>\n</div>\n",s});return t.registerPartial("modules_transactions-calendar_templates_transactions-calendar-month-item-view-template-mobile",n),n}),define("modules/transactions-calendar/views/transactions-calendar-month-item-view-mobile",["modules/transactions-calendar/views/transactions-calendar-month-item-view","hbs!modules/transactions-calendar/templates/transactions-calendar-month-item-view-template-mobile"],function(e,t){var n=e.extend({template:t});return n}),define("hbs!modules/transactions-calendar/templates/transactions-calendar-year-item-view-template",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){return" sf-transactions-calendar-year-item-emtpy"}function c(e,t){var r="",i;return r+=' style="background: #',(i=n.color)?i=i.call(e,{hash:{}}):(i=e.color,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="sf-transactions-calendar-year-item-view',o=n.unless.call(t,t.color,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;s+='" title="',(o=n.title)?o=o.call(t,{hash:{}}):(o=t.title,o=typeof o===u?o.apply(t):o);if(o||o===0)s+=o;s+='"',o=n["if"].call(t,t.color,{hash:{},inverse:f.noop,fn:f.program(3,c,i)});if(o||o===0)s+=o;return s+=">\n	",(o=n.day)?o=o.call(t,{hash:{}}):(o=t.day,o=typeof o===u?o.apply(t):o),s+=a(o)+"\n</div>",s});return t.registerPartial("modules_transactions-calendar_templates_transactions-calendar-year-item-view-template",n),n}),define("hbs!modules/transactions-calendar/templates/transactions-calendar-year-tooltip",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression;return(o=n.date)?o=o.call(t,{hash:{}}):(o=t.date,o=typeof o===u?o.apply(t):o),s+=a(o)+"<br/>\n",(o=n.transactions)?o=o.call(t,{hash:{}}):(o=t.transactions,o=typeof o===u?o.apply(t):o),s+=a(o)+"<br/>\n",(o=n.balance)?o=o.call(t,{hash:{}}):(o=t.balance,o=typeof o===u?o.apply(t):o),s+=a(o)+"<br/>",s});return t.registerPartial("modules_transactions-calendar_templates_transactions-calendar-year-tooltip",n),n}),define("hbs!modules/transactions-calendar/templates/transactions-calendar-year-tooltip-emtpy",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s,o="function",u=this.escapeExpression;return(s=n.date)?s=s.call(t,{hash:{}}):(s=t.date,s=typeof s===o?s.apply(t):s),u(s)});return t.registerPartial("modules_transactions-calendar_templates_transactions-calendar-year-tooltip-emtpy",n),n}),define("modules/transactions-calendar/views/transactions-calendar-year-item-view",["classes/item-view","hbs!modules/transactions-calendar/templates/transactions-calendar-year-item-view-template","hbs!modules/transactions-calendar/templates/transactions-calendar-year-tooltip","hbs!modules/transactions-calendar/templates/transactions-calendar-year-tooltip-emtpy","utils/util","utils/date","utils/i18n"],function(e,t,n,r,i){var s=e.extend({template:t,onRender:function(){this._super(),this.$el.click(this.options.show),i.tooltip.add(this.$el,this.tooltipOptions)},serializeData:function(){var e=this.model?this.model.toJSON():{date:this.options.date},t=i.date.format(e.date,this.config.yearTooltipDateFormat),s=function(e,t){return i.i18n.get("transactions-calendar.year.tooltip."+e,t)};e.color=this.options.color;if(e.income){var o=e.income.length+e.expenses.length,u=i.amount.format(e.totalBalance);u=e.totalBalance>0?s("balance.positive",{amount:u}):s("balance.negative",{amount:u}),o==1?o=s("transactions.single"):o=s("transactions.multiple",{count:o}),e.title=i.unicodeHTMLCodes(n({date:t,transactions:o,balance:u}))}else e.title=i.unicodeHTMLCodes(r({date:t}));return e.day=e.date.getDate(),e}});return s}),define("hbs!modules/transactions-calendar/templates/transactions-calendar-empty-cell-template",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s,o,u=n.helperMissing,a=this.escapeExpression;return o={hash:{"class":"sf-transactions-calendar-empty-cell"}},a((s=n.empty,s?s.call(t,o):u.call(t,"empty",o)))});return t.registerPartial("modules_transactions-calendar_templates_transactions-calendar-empty-cell-template",n),n}),define("modules/transactions-calendar/views/transactions-calendar-empty-cell",["classes/item-view","hbs!modules/transactions-calendar/templates/transactions-calendar-empty-cell-template"],function(e,t){var n=e.extend({template:t,onRender:function(){this._super(),this.$el.click(this.options.show)}});return n}),define("ui/modules/calendar/layouts/calendar-layout",["classes/view","utils/util","utils/i18n"],function(e,t){var n=e.extend({initialize:function(e){this._super(e),this.calendar=e.calendar||this.calendar},view:null,calendar:null,next:function(){},previous:function(){},exportRange:function(){},periodRange:function(e){return this.exportRange(e)},inSamePeriod:function(){},periodTitle:function(){},name:function(){return t.i18n.get(this.constructor.ID+".name")},title:function(){return t.i18n.get(this.constructor.ID+".title")}},{defaults:{}});return n}),define("hbs!ui/modules/calendar/layouts/day/templates/calendar-day-view",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing;return s+='<div class="sf-calendar-day-view">\n	<div class="sf-calendar-cells-box">\n		<div class="sf-calendar-day-view-content ',(o=n.classId)?o=o.call(t,{hash:{}}):(o=t.classId,o=typeof o===a?o.apply(t):o),s+=f(o)+" sf-calendar-cell sf-calendar-",(o=n.position)?o=o.call(t,{hash:{}}):(o=t.position,o=typeof o===a?o.apply(t):o),s+=f(o)+'">\n			<div class="sf-calendar-empty-day-view">\n				<div class="sf-empty-icon-wrapper">\n						<img src="resources/pfm/ui/css/icons/app-icons/admiration.svg" alt="Signo de admiración">\n				</div>\n				',u={hash:{text:'{{{t "calendar-day.empty"}}}',"class":"sf-noalerts-list"}},s+=f((o=n.empty,o?o.call(t,u):l.call(t,"empty",u)))+'\n				<div class="sf-exit-empty-day-wrapper">\n					',u={hash:{"class":"sf-exit-empty-day-btn",type:"button",text:"common.button.accept"}},s+=f((o=n.button,o?o.call(t,u):l.call(t,"button",u)))+"\n				</div>\n			</div>\n		</div>\n	</div>\n</div>",s});return t.registerPartial("ui_modules_calendar_layouts_day_templates_calendar-day-view",n),n}),define("libs/require/css/css!ui/modules/calendar/layouts/day/css/calendar-day-view",[],function(){}),define("ui/modules/calendar/layouts/day/views/calendar-day-view",["classes/layout","hbs!ui/modules/calendar/layouts/day/templates/calendar-day-view","utils/util","utils/date","css!ui/modules/calendar/layouts/day/css/calendar-day-view"],function(e,t,n){var r=e.extend({template:t,regions:{content:".sf-calendar-day-view-content"},initialize:function(e){this._super(e),this._model=this.collection.models[0]},serializeData:function(){var e=this._model.get("date"),t={classId:this.options.calendar.dateToClassId(e),position:this._model.get("position"),date:n.date.format(e,this.config.emptyDayDateFormat)};return t},onRender:function(){this._super(),this._model.get("itemView")&&this.content.show(this._model.get("itemView"))}});return r}),define("ui/modules/calendar/layouts/day/views/calendar-day-view-extension",["ui/modules/calendar/layouts/day/views/calendar-day-view","hbs!ui/modules/calendar/layouts/day/templates/calendar-day-view","utils/util","utils/date","css!ui/modules/calendar/layouts/day/css/calendar-day-view"],function(e,t,n){var r=e.extend({events:{"click .sf-exit-empty-day-btn":"_closeEmptyDayPopup"},serializeData:function(){var e=this._model.get("date"),t={classId:this.options.calendar.dateToClassId(e),position:this._model.get("position"),date:n.date.format(e,this.config.emptyDayDateFormat)};return t.isPlatform=this.config.isPlatform,t},_closeEmptyDayPopup:function(e){this.publish("back")}});return r}),define("ui/modules/calendar/layouts/day/calendar-day-layout",["ui/modules/calendar/layouts/calendar-layout","ui/modules/calendar/layouts/day/views/calendar-day-view","utils/util","utils/date","utils/i18n"],function(e,t,n){var r=e.extend({view:t,next:function(e){e.setDate(e.getDate()+1)},previous:function(e){e.setDate(e.getDate()-1)},exportRange:function(e){return[e,new Date(+e)]},inSamePeriod:function(e,t){return!n.date.difference(n.date.constructor.DAY,e,t)},periodTitle:function(e){var t=n.isPhone()?"EEE, MMMM d, yyyy":this.config.periodDateFormat;return n.i18n.get("calendar-day.period",{day:n.date.format(e,t)})}},{ID:"calendar-day",defaults:{periodDateFormat:"EEEE, MMMM d, yyyy",emptyDayDateFormat:"EEEE, MMMM d, yyyy"}});return r}),define("hbs!ui/modules/calendar/layouts/month/templates/calendar-month-view",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i;return r+="\n					<th>\n						<div>",(i=n.dayOfWeek)?i=i.call(e,{hash:{}}):(i=e.dayOfWeek,i=typeof i===f?i.apply(e):i),r+=l(i)+"</div>\n					</th>\n					",r}function d(e,t){var r="",i,s,o;r+="\n				",o={hash:{},inverse:c.noop,fn:c.program(4,v,t)},s=(i=n.ifequal,i?i.call(e,e.dayOfWeek,0,o):h.call(e,"ifequal",e.dayOfWeek,0,o));if(s||s===0)r+=s;r+='\n					<td class="sf-calendar-',(s=n.position)?s=s.call(e,{hash:{}}):(s=e.position,s=typeof s===f?s.apply(e):s),r+=l(s),s=n["if"].call(e,e.outMounth,{hash:{},inverse:c.noop,fn:c.program(6,m,t)});if(s||s===0)r+=s;r+='">\n						<div class="',(s=n.classId)?s=s.call(e,{hash:{}}):(s=e.classId,s=typeof s===f?s.apply(e):s),r+=l(s)+' sf-calendar-cell" >\n							<div class="sf-calendar-cell-mark" title="',(s=n.longDate)?s=s.call(e,{hash:{}}):(s=e.longDate,s=typeof s===f?s.apply(e):s),r+=l(s)+'">\n								<span style="background: #',(s=n.backgroundColor)?s=s.call(e,{hash:{}}):(s=e.backgroundColor,s=typeof s===f?s.apply(e):s),r+=l(s)+'">\n									',(s=n.dayOfMonth)?s=s.call(e,{hash:{}}):(s=e.dayOfMonth,s=typeof s===f?s.apply(e):s),r+=l(s)+'\n								</span>\n							</div>\n							<div class="sf-calendar-cell-content"></div>\n						</div>\n					</td>\n				',o={hash:{},inverse:c.noop,fn:c.program(8,g,t)},s=(i=n.ifequal,i?i.call(e,e.dayOfWeek,6,o):h.call(e,"ifequal",e.dayOfWeek,6,o));if(s||s===0)r+=s;return r+="\n				",r}function v(e,t){return"\n					<tr>\n				"}function m(e,t){return" sf-calendar-cell-noperiod"}function g(e,t){return"\n					</tr>\n				"}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<div class="sf-calendar-month-view">\n	<div class="sf-calendar-cells-box">\n		<table class="sf-calendar-cells">\n			<thead>\n				<tr>\n					',a={hash:{},inverse:c.noop,fn:c.program(1,p,i)},u=(o=n.iter,o?o.call(t,t.daysOfWeek,a):h.call(t,"iter",t.daysOfWeek,a));if(u||u===0)s+=u;s+="\n				</tr>\n			</thead>\n			<tbody>\n				",a={hash:{},inverse:c.noop,fn:c.program(3,d,i)},u=(o=n.iter,o?o.call(t,t.items,a):h.call(t,"iter",t.items,a));if(u||u===0)s+=u;return s+='\n			</tbody>\n		</table>\n	</div>\n	<div class="sf-calendar-month-day-details-region">\n	</div>\n</div>\n',s});return t.registerPartial("ui_modules_calendar_layouts_month_templates_calendar-month-view",n),n}),define("libs/require/css/css!ui/modules/calendar/layouts/month/css/calendar-month-view",[],function(){}),define("ui/modules/calendar/layouts/month/views/calendar-month-view",["classes/layout","hbs!ui/modules/calendar/layouts/month/templates/calendar-month-view","utils/util","utils/date","css!ui/modules/calendar/layouts/month/css/calendar-month-view"],function(e,t,n){var r=e.extend({template:t,serializeData:function(){var e={},t=this,r=t.options.calendar.now();return e.month=n.date.format(r,n.date.constructor.LONG_MONTH_YEAR),e.daysOfWeek=[],e.items=this.collection.map(function(i){var s=i.toJSON();return s.classId=t.options.calendar.dateToClassId(s.date),s.dayOfMonth=s.date.getDate(),s.dayOfWeek=t.options.calendar.dayOfWeek(s.date),s.outMounth=s.date.getMonth()!=r.getMonth(),s.longDate=n.date.format(s.date,n.date.constructor.LONG_DATE),e.daysOfWeek.length<7&&e.daysOfWeek.push({dayOfWeek:n.date.format(s.date,t.config.headerDateFormat)}),s}),e},onRender:function(){this._super();var e=this,t=this.options.calendar;this.collection.each(function(n){var r="."+t.dateToClassId(n.get("date")),i=e.$el.find(r),s=i.length&&n.get("itemView");s&&(e.addRegion(r,r+" .sf-calendar-cell-content"),e[r].show(s))})}});return r}),define("libs/rainbow/rainbowvis",[],function(){function e(){function s(s){if(s.length<2)throw new Error("Rainbow must have two or more colours.");var o=(r-n)/(s.length-1),u=new t;u.setGradient(s[0],s[1]),u.setNumberRange(n,n+o),e=[u];for(var a=1;a<s.length-1;a++){var f=new t;f.setGradient(s[a],s[a+1]),f.setNumberRange(n+o*a,n+o*(a+1)),e[a]=f}return i=s,this}var e=null,n=0,r=100,i=["ff0000","ffff00","00ff00","0000ff"];s(i),this.setSpectrum=function(){return s(arguments),this},this.setSpectrumByArray=function(e){return s(e),this},this.colourAt=function(t){if(isNaN(t))throw new TypeError(t+" is not a number");if(e.length===1)return e[0].colourAt(t);var i=(r-n)/e.length,s=Math.min(Math.floor((Math.max(t,n)-n)/i),e.length-1);return e[s].colourAt(t)},this.colorAt=this.colourAt,this.setNumberRange=function(e,t){if(t>e)return n=e,r=t,s(i),this;throw new RangeError("maxNumber ("+t+") is not greater than minNumber ("+e+")")}}function t(){function i(e,t,i){var o=e;o<n&&(o=n),o>r&&(o=r);var u=r-n,a=parseInt(t,16),f=parseInt(i,16),l=(f-a)/u,c=Math.round(l*(o-n)+a);return s(c.toString(16))}function s(e){return e.length===1?"0"+e:e}function o(e){var t=/^#?[0-9a-fA-F]{6}$/i;return t.test(e)}function u(e){if(o(e))return e.substring(e.length-6,e.length);var t=[["red","ff0000"],["lime","00ff00"],["blue","0000ff"],["yellow","ffff00"],["orange","ff8000"],["aqua","00ffff"],["fuchsia","ff00ff"],["white","ffffff"],["black","000000"],["gray","808080"],["grey","808080"],["silver","c0c0c0"],["maroon","800000"],["olive","808000"],["green","008000"],["teal","008080"],["navy","000080"],["purple","800080"]];for(var n=0;n<t.length;n++)if(e.toLowerCase()===t[n][0])return t[n][1];throw new Error(e+" is not a valid colour.")}var e="ff0000",t="0000ff",n=0,r=100;this.setGradient=function(n,r){e=u(n),t=u(r)},this.setNumberRange=function(e,t){if(!(t>e))throw new RangeError("maxNumber ("+t+") is not greater than minNumber ("+e+")");n=e,r=t},this.colourAt=function(n){return i(n,e.substring(0,2),t.substring(0,2))+i(n,e.substring(2,4),t.substring(2,4))+i(n,e.substring(4,6),t.substring(4,6))}}return e}),define("hbs!ui/modules/calendar/layouts/month/templates/calendar-month-view-mobile",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i;return r+="\n					<th>\n						<div>",(i=n.dayOfWeek)?i=i.call(e,{hash:{}}):(i=e.dayOfWeek,i=typeof i===f?i.apply(e):i),r+=l(i)+"</div>\n					</th>\n					",r}function d(e,t){var r="",i,s,o;r+="\n				",o={hash:{},inverse:c.noop,fn:c.program(4,v,t)},s=(i=n.ifequal,i?i.call(e,e.dayOfWeek,0,o):h.call(e,"ifequal",e.dayOfWeek,0,o));if(s||s===0)r+=s;r+='\n					<td class="sf-calendar-',(s=n.position)?s=s.call(e,{hash:{}}):(s=e.position,s=typeof s===f?s.apply(e):s),r+=l(s),s=n["if"].call(e,e.outMounth,{hash:{},inverse:c.noop,fn:c.program(6,m,t)});if(s||s===0)r+=s;r+='">\n						<div class="',(s=n.classId)?s=s.call(e,{hash:{}}):(s=e.classId,s=typeof s===f?s.apply(e):s),r+=l(s)+' sf-calendar-cell">\n							<div class="sf-calendar-cell-mark" title="',(s=n.longDate)?s=s.call(e,{hash:{}}):(s=e.longDate,s=typeof s===f?s.apply(e):s),r+=l(s)+'">\n								<span style="background: #',(s=n.backgroundColor)?s=s.call(e,{hash:{}}):(s=e.backgroundColor,s=typeof s===f?s.apply(e):s),r+=l(s)+"; color: #",(s=n.textColor)?s=s.call(e,{hash:{}}):(s=e.textColor,s=typeof s===f?s.apply(e):s),r+=l(s)+'">\n									',(s=n.dayOfMonth)?s=s.call(e,{hash:{}}):(s=e.dayOfMonth,s=typeof s===f?s.apply(e):s),r+=l(s)+'\n								</span>\n							</div>\n							<div class="sf-calendar-cell-content"></div>\n						</div>\n					</td>\n				',o={hash:{},inverse:c.noop,fn:c.program(8,g,t)},s=(i=n.ifequal,i?i.call(e,e.dayOfWeek,6,o):h.call(e,"ifequal",e.dayOfWeek,6,o));if(s||s===0)r+=s;return r+="\n				",r}function v(e,t){return"\n					<tr>\n				"}function m(e,t){return" sf-calendar-cell-noperiod"}function g(e,t){return"\n					</tr>\n				"}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<div class="sf-calendar-month-view">\n	<div class="sf-calendar-cells-box">\n		<table class="sf-calendar-cells">\n			<thead>\n				<tr>\n					',a={hash:{},inverse:c.noop,fn:c.program(1,p,i)},u=(o=n.iter,o?o.call(t,t.daysOfWeek,a):h.call(t,"iter",t.daysOfWeek,a));if(u||u===0)s+=u;s+="\n				</tr>\n			</thead>\n			<tbody>\n				",a={hash:{},inverse:c.noop,fn:c.program(3,d,i)},u=(o=n.iter,o?o.call(t,t.items,a):h.call(t,"iter",t.items,a));if(u||u===0)s+=u;return s+='\n			</tbody>\n		</table>\n	</div>\n	<div class="sf-calendar-right-section">\n		<div class="sf-calendar-colors-indication-wrapper">\n			<div class="sf-calendar-colors-indication-header">\n				',a={hash:{}},s+=l((o=n.t,o?o.call(t,"financial-calendar.webMessage.title",a):h.call(t,"t","financial-calendar.webMessage.title",a)))+'\n			</div>\n			<div class="sf-calendar-colors-indication-body">\n				<div class="sf-indication-row-one">\n					<span class="sf-low-expense">\n						<span class="sf-indicator-color">\n\n						</span>\n						',a={hash:{}},s+=l((o=n.t,o?o.call(t,"financial-calendar.webMessage.lowExpense",a):h.call(t,"t","financial-calendar.webMessage.lowExpense",a)))+'\n					</span>\n					<span class="sf-medium-expense">\n						<span class="sf-indicator-color">\n\n						</span>\n						',a={hash:{}},s+=l((o=n.t,o?o.call(t,"financial-calendar.webMessage.mediumExpense",a):h.call(t,"t","financial-calendar.webMessage.mediumExpense",a)))+'\n					</span>\n				</div>\n				<div class="sf-indication-row-two">\n					<span class="sf-high-expense">\n						<span class="sf-indicator-color">\n\n						</span>\n						',a={hash:{}},s+=l((o=n.t,o?o.call(t,"financial-calendar.webMessage.highExpense",a):h.call(t,"t","financial-calendar.webMessage.highExpense",a)))+'\n					</span>\n					<span class="sf-income">\n						<span class="sf-indicator-color">\n\n						</span>\n						',a={hash:{}},s+=l((o=n.t,o?o.call(t,"financial-calendar.webMessage.income",a):h.call(t,"t","financial-calendar.webMessage.income",a)))+'\n					</span>\n				</div>\n			</div>\n		</div>\n		<div class="sf-calendar-button-controls">\n			<div class="sf-calendar-today-button-navigator">\n				<span class="sf-button">\n					',a={hash:{}},s+=l((o=n.t,o?o.call(t,"financial-calendar.webMessage.viewToday",a):h.call(t,"t","financial-calendar.webMessage.viewToday",a)))+'\n				</span>\n			</div>\n			<div class="sf-ok-to-spend-navigator">\n				<span class="sf-button">\n					',a={hash:{}},s+=l((o=n.t,o?o.call(t,"financial-calendar.webMessage.goToFutureTx",a):h.call(t,"t","financial-calendar.webMessage.goToFutureTx",a)))+'\n				</span>\n			</div>\n		</div>\n	</div>\n\n	<div class="sf-calendar-month-day-details-region">\n	</div>\n</div>\n',s});return t.registerPartial("ui_modules_calendar_layouts_month_templates_calendar-month-view-mobile",n),n}),define("ui/modules/calendar/layouts/month/views/calendar-month-view-mobile",["ui/modules/calendar/layouts/month/views/calendar-month-view","libs/rainbow/rainbowvis","hbs!ui/modules/calendar/layouts/month/templates/calendar-month-view-mobile","jQuery","utils/util","utils/date","css!ui/modules/calendar/layouts/month/css/calendar-month-view"],function(e,t,n,r,i){var s=e.extend({template:n,initialize:function(e){this._super(e),this.colorFactory={incomes:new t,expenses:new t};var n=function(e,t){return e-t},r=i.filter(e.collection.models,function(e){return e.get("itemView").model!==undefined},this),s=i.map(r,function(e){return e.get("itemView").model.get("totalBalance")},this),o=s.sort(n),u=o[0],a=o[o.length-1];this.options.collection.pluck("totalBalance").sort(n),this.colorFactory.incomes.setSpectrum("white",this.config.colors.income),this.colorFactory.expenses.setSpectrum("white",this.config.colors.expenses),this.colorFactory.incomes.setNumberRange(0,a>0?a:1),this.colorFactory.expenses.setNumberRange(0,u<0?Math.abs(u):1)},getCellColor:function(e,t){if(e.outMounth||!t.model)return"white";var n=t.model.get("totalBalance");return n>0?this.colorFactory.incomes.colorAt(n):this.colorFactory.expenses.colorAt(Math.abs(n))},serializeData:function(){var e={},t=this,n=t.options.calendar.now();return t.datesArray=[],e.month=i.date.format(n,i.date.constructor.LONG_MONTH_YEAR),e.daysOfWeek=[],e.items=this.collection.map(function(r){var s=r.toJSON();return s.classId=t.options.calendar.dateToClassId(s.date),t.datesArray[s.classId]=s.date,s.dayOfMonth=s.date.getDate(),s.dayOfWeek=t.options.calendar.dayOfWeek(s.date),s.outMounth=s.date.getMonth()!=n.getMonth(),s.longDate=i.date.format(s.date,i.date.constructor.LONG_DATE),s.backgroundColor=t.getCellColor(s,r.get("itemView")),e.daysOfWeek.length<7&&e.daysOfWeek.push({dayOfWeek:i.date.format(s.date,t.config.headerDateFormat).substring(0,3)}),s}),e}},{defaults:{colors:{income:"#60a9d5",expenses:"#d56d56"},yearTooltipDateFormat:i.date.constructor.SHORT_DATE}});return s}),define("ui/modules/calendar/layouts/month/views/calendar-month-view-extension",["ui/modules/calendar/layouts/month/views/calendar-month-view-mobile","libs/rainbow/rainbowvis","hbs!ui/modules/calendar/layouts/month/templates/calendar-month-view-mobile","jQuery","utils/util","utils/date","css!ui/modules/calendar/layouts/month/css/calendar-month-view"],function(e,t,n,r,i){var s=e.extend({events:{"click .sf-calendar-today-button-navigator .sf-button":"_viewToday","click .sf-ok-to-spend-navigator .sf-button":"_navigateToOkToSpend"},_viewToday:function(){i.pushToDataLayer({eventCategory:"PFM Calendario-Calendario",eventAction:"Boton",eventLabel:"Ver detalle de hoy",event:"eventClick"}),this.publish("viewToday")},_navigateToOkToSpend:function(){i.pushToDataLayer({eventCategory:"PFM Calendario-Calendario",eventAction:"Boton",eventLabel:"Ver ingresos y gastos futuros",event:"eventClick"}),this.publish("show:widget",{widget:"ok-to-spend"})},serializeData:function(){var e={},t=this,n=t.options.calendar.now();return t.datesArray=[],e.month=i.date.format(n,i.date.constructor.LONG_MONTH_YEAR),e.daysOfWeek=[],e.isPlatform=t.config.isPlatform,e.items=this.collection.map(function(r){var s=r.toJSON();s.classId=t.options.calendar.dateToClassId(s.date),t.datesArray[s.classId]=s.date,s.dayOfMonth=s.date.getDate(),s.dayOfWeek=t.options.calendar.dayOfWeek(s.date),s.outMounth=s.date.getMonth()!=n.getMonth(),s.longDate=i.date.format(s.date,i.date.constructor.LONG_DATE);var o=t.getCellColor(s,r.get("itemView"));return s.backgroundColor=o.backgroundColor,o.color.length>0&&(s.textColor=o.color),e.daysOfWeek.length<7&&e.daysOfWeek.push({dayOfWeek:i.date.format(s.date,t.config.headerDateFormat).substring(0,1)}),s}),e},initialize:function(e){this._super(e),this.colorFactory={incomes:new t,expenses:new t};var n=function(e,t){return e-t},r=i.filter(e.collection.models,function(e){return e.get("itemView").model!==undefined},this),s=i.map(r,function(e){return e.get("itemView").model.get("totalBalance")},this),o=e.min,u=e.max;this.options.collection.pluck("totalBalance").sort(n),this.colorFactory.incomes.setSpectrum("#974970",this.config.colors.income),this.colorFactory.expenses.setSpectrum("#974970",this.config.colors.expenses),this.colorFactory.incomes.setNumberRange(0,u>0?u:1),this.colorFactory.expenses.setNumberRange(0,o<0?Math.abs(o):1)},getCellColor:function(e,t){if(e.outMounth||!t.model)return{backgroundColor:"",color:"5F5F5F"};var n=t.model.get("totalBalance");if(n>0){var r=this.colorFactory.incomes.colorAt(n);return{backgroundColor:r,color:""}}var i=this.colorFactory.expenses.colorAt(Math.abs(n));return{backgroundColor:i,color:""}},onRender:function(){var e=this,t=this.options.calendar;this.collection.each(function(n){var r="."+t.dateToClassId(n.get("date")),i=e.$el.find(r),s=i.length&&n.get("itemView");s&&i.parent().find("span").click(function(){s.options.show()}),s&&(e.addRegion(r,r+" .sf-calendar-cell-content"),e[r].show(s))})}},{defaults:{colors:{income:"#60a9d5",expenses:"#d56d56"},yearTooltipDateFormat:i.date.constructor.SHORT_DATE}});return s}),define("ui/modules/calendar/layouts/month/calendar-month-layout",["ui/modules/calendar/layouts/calendar-layout","is!phone?ui/modules/calendar/layouts/month/views/calendar-month-view-mobile:ui/modules/calendar/layouts/month/views/calendar-month-view","utils/util","utils/date","utils/i18n"],function(e,t,n){var r=e.extend({view:t,next:function(e){var t=e.getMonth()+1,r=e.getDate(),i=n.date.daysInMonth(t,e.getFullYear());r>i&&(r=i),e.setDate(r),e.setMonth(t)},previous:function(e){var t=e.getMonth()-1,r=e.getDate(),i=n.date.daysInMonth(t,e.getFullYear());r>i&&(r=i),e.setDate(r),e.setMonth(t)},exportRange:function(e){var t=e.getFullYear(),r=e.getMonth(),i=new Date(t,r,1),s=new Date(t,r,n.date.daysInMonth(r,t)),o=this.calendar.dayOfWeek(i),u=this.calendar.dayOfWeek(s);return i.setDate(i.getDate()-o),s.setDate(s.getDate()+(6-u)),[i,s]},periodRange:function(e){var t=n.date.truncate(n.date.constructor.MONTH,e),r=n.date.ceiling(n.date.constructor.MONTH,e);return[t,r]},inSamePeriod:function(e,t){return e.getMonth()==t.getMonth()&&e.getFullYear()==t.getFullYear()},periodTitle:function(e){return n.i18n.get("calendar-month.period",{month:n.date.format(e,this.config.periodDateFormat)})}},{ID:"calendar-month",defaults:{periodDateFormat:n.date.constructor.LONG_MONTH_YEAR,headerDateFormat:n.date.constructor.LONG_WEEK_DAY}});return r}),define("hbs!ui/modules/calendar/layouts/year/templates/calendar-year-view",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t,r){var i="",s,o,u;i+='<div class="sf-calendar-year-month">\n			<h4 class="sf-calendar-year-month-name">',(s=n.name)?s=s.call(e,{hash:{}}):(s=e.name,s=typeof s===f?s.apply(e):s),i+=l(s)+'</h4>\n			<table class="sf-calendar-cells">\n				<thead>\n					<tr>\n						',s=n.each.call(e,r.daysOfWeek,{hash:{},inverse:c.noop,fn:c.program(2,d,t)});if(s||s===0)i+=s;i+="\n					</tr>\n				</thead>\n				<tbody>\n					",u={hash:{},inverse:c.noop,fn:c.program(4,v,t)},o=(s=n.iter,s?s.call(e,e.items,u):h.call(e,"iter",e.items,u));if(o||o===0)i+=o;return i+="\n				</tbody>\n			</table>\n		</div>",i}function d(e,t){var n="";return n+="\n						<th>\n							"+l(typeof e===f?e.apply(e):e)+"\n						</th>\n						",n}function v(e,t){var r="",i,s,o;r+="\n					",o={hash:{},inverse:c.noop,fn:c.program(5,m,t)},s=(i=n.ifequal,i?i.call(e,e.dayOfWeek,0,o):h.call(e,"ifequal",e.dayOfWeek,0,o));if(s||s===0)r+=s;r+='\n						<td class="sf-calendar-',(s=n.position)?s=s.call(e,{hash:{}}):(s=e.position,s=typeof s===f?s.apply(e):s),r+=l(s),s=n["if"].call(e,e.outMounth,{hash:{},inverse:c.noop,fn:c.program(7,g,t)});if(s||s===0)r+=s;r+='">\n							<div class="',s=n.unless.call(e,e.outMounth,{hash:{},inverse:c.noop,fn:c.program(9,y,t)});if(s||s===0)r+=s;r+='sf-calendar-cell">\n								<div class="sf-calendar-cell-mark">\n									<span>\n										',(s=n.dayOfMonth)?s=s.call(e,{hash:{}}):(s=e.dayOfMonth,s=typeof s===f?s.apply(e):s),r+=l(s)+"\n									</span>\n								</div>",s=n.unless.call(e,e.outMounth,{hash:{},inverse:c.noop,fn:c.program(11,b,t)});if(s||s===0)r+=s;r+="\n							</div>\n						</td>\n					",o={hash:{},inverse:c.noop,fn:c.program(13,w,t)},s=(i=n.ifequal,i?i.call(e,e.dayOfWeek,6,o):h.call(e,"ifequal",e.dayOfWeek,6,o));if(s||s===0)r+=s;return r+="\n					",r}function m(e,t){return"\n						<tr>\n					"}function g(e,t){return" sf-calendar-cell-noperiod"}function y(e,t){var r="",i;return(i=n.classId)?i=i.call(e,{hash:{}}):(i=e.classId,i=typeof i===f?i.apply(e):i),r+=l(i)+" ",r}function b(e,t){return'\n								<div class="sf-calendar-cell-content"></div>'}function w(e,t){return"\n						</tr>\n					"}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<div class="sf-calendar-year-view">\n	<div class="sf-calendar-cells-box">\n		',a={hash:{},inverse:c.noop,fn:c.programWithDepth(p,i,t)},u=(o=n.iter,o?o.call(t,t.months,a):h.call(t,"iter",t.months,a));if(u||u===0)s+=u;return s+="\n	</div>\n</div>",s});return t.registerPartial("ui_modules_calendar_layouts_year_templates_calendar-year-view",n),n}),define("libs/require/css/css!ui/modules/calendar/layouts/year/css/calendar-year-view",[],function(){}),define("ui/modules/calendar/layouts/year/views/calendar-year-view",["classes/layout","hbs!ui/modules/calendar/layouts/year/templates/calendar-year-view","utils/util","utils/date","css!ui/modules/calendar/layouts/year/css/calendar-year-view"],function(e,t,n){var r=e.extend({template:t,serializeData:function(){var e={},t=this.options.calendar,r=t.now(),i=r.getFullYear(),s,o,u,a,f,l,c;e.daysOfWeek=[],e.months=[];for(var h=0;h<12;h++)s=new Date(i,h,1),o=n.date.format(s,"MMMM"),u=n.date.daysInMonth(h,i),a=new Date(i,h,u),f=t.dayOfWeek(s),l=t.dayOfWeek(a),s.setDate(s.getDate()-f),a.setDate(a.getDate()+(6-l)),c=n.date.datesInPeriod(n.date.constructor.DAY,s,a),e.months.push({name:o,items:n.map(c,function(r){return e.daysOfWeek.length<7&&e.daysOfWeek.push(n.date.format(r,"E")),{dayOfWeek:t.dayOfWeek(r),outMounth:r.getMonth()!=h,longDate:n.date.format(r,n.date.constructor.LONG_DATE),classId:t.dateToClassId(r),position:t.timePosition(r),dayOfMonth:r.getDate()}})});return e},onRender:function(){this._super();var e=this,t=this.options.calendar;this.collection.each(function(n){var r="."+t.dateToClassId(n.get("date")),i=e.$el.find(r),s=i.length&&n.get("itemView");s&&(e.addRegion(r,r+" .sf-calendar-cell-content"),e[r].show(s))})}});return r}),define("ui/modules/calendar/layouts/year/calendar-year-layout",["ui/modules/calendar/layouts/calendar-layout","ui/modules/calendar/layouts/year/views/calendar-year-view","utils/util","utils/date","utils/i18n"],function(e,t,n){var r=e.extend({view:t,next:function(e){e.setFullYear(e.getFullYear()+1)},previous:function(e){e.setFullYear(e.getFullYear()-1)},exportRange:function(e){var t=new Date(e.getFullYear(),0,1),n=new Date(e.getFullYear(),11,31);return[t,n]},inSamePeriod:function(e,t){return e.getFullYear()==t.getFullYear()},periodTitle:function(e){return n.i18n.get("calendar-year.period",{year:e.getFullYear()})}},{ID:"calendar-year",defaults:{}});return r}),define("libs/require/css/css!modules/transactions-calendar/css/transactions-calendar",[],function(){}),define("modules/transactions-calendar/transactions-calendar-module",["is!phone?ui/modules/calendar/calendar-module-mobile:ui/modules/calendar/calendar-module","services/transactions-calendar-service","modules/transactions-calendar/views/transactions-calendar-day-item-view","is!phone?modules/transactions-calendar/views/transactions-calendar-month-item-view-mobile:modules/transactions-calendar/views/transactions-calendar-month-item-view","modules/transactions-calendar/views/transactions-calendar-year-item-view","modules/transactions-calendar/views/transactions-calendar-empty-cell","ui/modules/calendar/layouts/day/calendar-day-layout","ui/modules/calendar/layouts/month/calendar-month-layout","ui/modules/calendar/layouts/year/calendar-year-layout","libs/rainbow/rainbowvis","utils/util","utils/date","utils/i18n","utils/amount","css!modules/transactions-calendar/css/transactions-calendar"],function(e,t,n,r,i,s,o,u,a,f,l){var c=e.extend({initialize:function(e){l.isPhone()&&(this.config.stepScale="month"),this._super(e),this.transactionsCalendarService=t.getInstance(),this._dataChanged=l.bind(this._dataChanged,this),this._resultMapper=l.bind(this._resultMapper,this);if(this.config.preselectedDate&&this.config.preselectedDate!==""){var n=this.config.preselectedDate.split("-"),r=new Date(n[2],n[0]-1,n[1]);this.display(r,"day")}},onRender:function(){this._super(),this.$el.addClass("sf-transactions-calendar")},onClose:function(){this.dispose()},dispose:function(){this._results&&(this._results.dispose(),this._results=null)},getDateViews:function(e){var t=l.Deferred(),n=this;return n.dispose(),l.when(n.transactionsCalendarService.get(e)).done(function(e){n._results=e,n._resultMapper(e.data,t),e.on("change",n._dataChanged)}).fail(function(e){t.reject(e)}),t.promise()},_resultMapper:function(e,t){var n={},r=this.config.cellViews[this._layout],i=this;if(!e||!e.length)return t.resolve(n);if(this._layout=="year")return this._yearResultMapper(e,t);e.forEach(function(e){var t=l.merge({},i.contextConfig,{model:e,calendar:i,show:function(){i.display(e.get("date"),"day")}});n[i.dateToKey(e.get("date"))]=new r(t)}),this._attachEmptyCells(n),t.resolve(n)},_yearResultMapper:function(e,t){var n={},r=this.config.cellViews[this._layout],i=this,s=e.pluck("totalBalance").sort(function(e,t){return e-t}),o=s[0],u=s[s.length-1],a=new f,c=new f;a.setSpectrum("white",this.config.colors.income),c.setSpectrum("white",this.config.colors.expenses),a.setNumberRange(0,u>0?u:1),c.setNumberRange(0,o<0?Math.abs(o):1);var h=0,p=function(){var s=e.models[h++];if(s){var o=s.get("totalBalance"),u=l.merge({},i.contextConfig,{model:s,calendar:i,show:function(){i.display(s.get("date"),"day")},color:o>0?a.colorAt(o):c.colorAt(Math.abs(o))});n[i.dateToKey(s.get("date"))]=new r(u),h%20===0?setTimeout(p):p()}else i._attachEmptyCells(n),t.resolve(n)};p()},_attachEmptyCells:function(e){var t=this.config.emptyCellsViews[this._layout],n=new Date(+this._startDate),r=this.dateToKey(n),i=this.dateToKey(this._endDate),s=this,o=function(e){return{date:e,calendar:s,show:function(){s.display(e,"day")}}};if(t)while(r<=i)e[r]||(e[r]=new t(l.merge({},s.contextConfig,o(new Date(+n))))),n.setDate(n.getDate()+1),r=this.dateToKey(n)},_dataChanged:function(e){console.log("[TransactionsCalendar] Redrawing, new data received",arguments);var t=l.Deferred(),n=this,r=t.promise();l.when(r).done(function(e){n.updateData(e)}),this._resultMapper(e.data,t)}},{ID:"transactions-calendar",submodules:[e,o,u,a],defaults:{stepScale:"year",cellViews:{day:n,month:r,year:i},emptyCellsViews:{month:s,year:i},layouts:[{key:"day",layout:o},{key:"month",layout:u},{key:"year",layout:a}],colors:{income:"#60a9d5",expenses:"#d56d56",future:"F89F69"},yearTooltipDateFormat:l.date.constructor.SHORT_DATE}});return c}),define("modules/transactions-calendar/transactions-calendar-module-extension",["modules/transactions-calendar/transactions-calendar-module","services/transactions-calendar-service","ui/modules/popup/popup-module","modules/transactions-calendar/views/transactions-calendar-day-item-view","classes/collection","modules/transactions-calendar/views/transactions-calendar-month-item-view-mobile","modules/transactions-calendar/views/transactions-calendar-year-item-view","modules/transactions-calendar/views/transactions-calendar-empty-cell","ui/modules/calendar/layouts/day/calendar-day-layout","ui/modules/calendar/layouts/month/calendar-month-layout","ui/modules/calendar/layouts/year/calendar-year-layout","hbs!ui/modules/calendar/templates/calendar-mobile","libs/rainbow/rainbowvis","utils/util","utils/date","utils/i18n","utils/amount","css!modules/transactions-calendar/css/transactions-calendar"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d=e.extend({template:c,ui:{body:".sf-calendar-body",periodTitle:".sf-calendar-period-title .sf-button-text",periodTitlePrevious:".sf-calendar-control-previous .sf-button-text",periodTitleNext:".sf-calendar-control-next .sf-button-text",$calendarDayContainer:".sf-calendar-day-view-popup-container",$mainRegion:".sf-calendar-main-view"},hubEvents:{viewToday:"_viewToday",back:"closeDayView"},initialize:function(e){this.config.stepScale="month",this.config.cellViews.month=s;var n=this.__proto__,r=n.__proto__,i=r.__proto__;i.initialize.call(this,e),this.transactionsCalendarService=t.getInstance(),this._dataChanged=p.bind(this._dataChanged,this),this._resultMapper=p.bind(this._resultMapper,this),this._printDateViews=p.bind(this._printDateViews,this);if(this.config.preselectedDate&&this.config.preselectedDate!==""){var o=this.config.preselectedDate.split("-"),u=new Date(o[2],o[0]-1,o[1]);this.display(u,"day")}},_viewToday:function(e){this.display(this._today,"day")},_buttonLayoutHandler:function(e){this.$(e.currentTarget).hasClass("sf-calendar-control-today")?this.display(this._today,"day"):this.layout(this.$(e.currentTarget).data("key"))},_updatePeriodTitle:function(e){var t=this.layouts[this._layout],n=this._now,r=e.date.format(e.date._addMonths(this._now,1),"MMMM"),i=e.date.format(e.date._subtractMonths(this._now,1),"MMMM");this.ui.periodTitle.text(t.periodTitle(n)),this.ui.periodTitlePrevious.text(i),this.ui.periodTitleNext.text(r)},_updateView:function(e){var t=this,n=p,r=this.layouts.year,i=r.exportRange(this.now());this.auxParams=this.exportDateRange.apply(this,i),r=this.layouts[this._layout],i=r.exportRange(this.now());var s=this.exportDateRange.apply(this,i);s.layout=this._layout,p.mask(this.$el,p.MASK_LOADING),p.when(t.transactionsCalendarService.get(this.auxParams)).done(function(e){t.yearResults=e}).fail(function(e){console.log("error getting yearViewMap")}),p.when(this.getDateViews(s)).then(function(r){t._printDateViews(r,e,n)}).fail(this._modelGetFail)},_printDateViews:function(e,t,n){n||(n=require("utils/util"));if(this._printing){(function(e,t,n){setTimeout(function(){e._printDateViews(t,n)},e.config.transitionDelay)})(this,e,t);return}this._printing=!0;var r=this.yearResults.data.pluck("totalBalance").sort(function(e,t){return e-t}),s=r[0],o=r[r.length-1],u=n.date.datesInPeriod(n.date.constructor.DAY,this._startDate,this._endDate),a=this,f=this.layouts[this._layout],l=new i(n.map(u,function(t){return{date:t,position:a.timePosition(t),itemView:e[a.dateToKey(t)]}})),c=n.extend({},this.contextConfig,{config:f.config},{collection:l,calendar:this,max:o,min:s}),h=new f.view(c);this.$el.find(".sf-calendar-layouts .sf-active").removeClass("sf-active"),this.$el.find(".sf-calendar-layout-"+this._layout).addClass("sf-active"),h.render(),n.unmask(this.$el),this._layout==="day"?(this._openDayPopup(h),n.pushToDataLayer({eventCategory:"PFM Calendario-Calendario",eventAction:"Boton",eventLabel:"Ver detalle por dia calendario",event:"eventClick"})):t?this._doSlide(t,h,function(){a._printing=!1,a._updatePeriodTitle(n)}):(this.ui.body.html(h.el),this._updatePeriodTitle(n),this._printing=!1),this._notifyChanges()},onRender:function(){this.$el.addClass("sf-transactions-calendar"),this._updateView(),this._updatePeriodTitle(p)},dayOfWeek:function(e){return this.config.weekStart=0,(e.getDay()-this.config.weekStart+7)%7},_openDayPopup:function(e){this.ui.$mainRegion.hide();var t=this,r=p.extend({},this.contextConfig,{$opener:this.$el,$container:this.ui.$calendarDayContainer,labelClose:p.i18n.get("financial-calendar.webMessage.backToMonthView"),title:"",maskClass:"sf-transparent-mask",invisibleMask:!0,closeCallback:p.bind(this.closeDayView,this)});r["class"]="sf-calendar-day-popup sf-transactions-calendar",e._model.get("itemView")===undefined&&(r.maskClass="sf-dark-mask",r["class"]="sf-calendar-day-popup sf-transactions-calendar sf-calendar-day-popup-empty"),this.dayPopup=new n(r),e.on("close",t.closeDayView,this),this.dayPopup.contentRegion.once("show",this.dayPopup.open,this.dayPopup),this.dayPopup.contentRegion.show(e)},closeDayView:function(){this._layout="year",this._printing=!1,this.ui.$mainRegion.show(),this.ui.$calendarDayContainer.html("")},next:function(){p.pushToDataLayer({eventCategory:"PFM Calendario-Calendario",eventAction:"Boton",eventLabel:"Navegador Meses",event:"eventClick"}),this._layout="month",this._toggleDate(this.layouts[this._layout].next)},previous:function(){p.pushToDataLayer({eventCategory:"PFM Calendario-Calendario",eventAction:"Boton",eventLabel:"Navegador Meses",event:"eventClick"}),this._layout="month",this._toggleDate(this.layouts[this._layout].previous)}},{defaults:{colors:{income:"#007FC6",expenses:"#FF181B",future:"00FF00"}}});return d}),define("libs/require/css/css!widgets/financial-calendar/css/financial-calendar",[],function(){}),define("widgets/financial-calendar/views/financial-calendar-content-view",["classes/layout","hbs!widgets/financial-calendar/templates/financial-calendar-content","modules/patterns/patterns-module","modules/financial-calendar-columnchart/financial-calendar-columnchart-module","modules/transactions-calendar/transactions-calendar-module","css!widgets/financial-calendar/css/financial-calendar"],function(e,t,n,r,i){var s=e.extend({submodules:[i,r],template:t,regions:{patternsRegion:".sf-financial-calendar-payments",calendarRegion:".sf-financial-calendar-calendar",chartRegion:".sf-financial-calendar-chart"},events:{"click .sf-section-navigator-calendar":"_showCalendar","click .sf-section-navigator-payments":"_showPatterns","calendar:change":"_updateChart"},initialize:function(){this._super.apply(this,arguments),this.patterns=new n(this.contextConfig),this.transactionsCalendar=new i(this.contextConfig),this.config.showFinancialChart&&(this.financialChart=new r(this.contextConfig))},_updateChart:function(e,t){if(t.mode==="day")return;if(!this.config.showFinancialChart)return;if(!t.calendar._results||!t.calendar._results.data)this.financialChart.$el.hide();else{var n=t.range.start,r=t.range.end;n.getDate()>20&&(n=new Date(n.getFullYear(),n.getMonth()+1,1)),r.getDate()<10&&(r=new Date(r.getFullYear(),r.getMonth(),0,23,59,59));var i={mode:t.mode,collection:t.calendar._results.data,fromDate:n,toDate:r};this.financialChart._updateData(i),this.financialChart.$el.show()}},_showCalendar:function(){this.$el.find(".sf-section-navigator-calendar").addClass("sf-active").siblings().removeClass("sf-active"),this.$el.find(".sf-financial-calendar-calendar, .sf-financial-calendar-chart").removeClass("sf-hidden").siblings(".sf-financial-calendar-payments").addClass("sf-hidden")},_showPatterns:function(){this.$el.find(".sf-section-navigator-payments").addClass("sf-active").siblings().removeClass("sf-active"),this.$el.find(".sf-financial-calendar-payments").removeClass("sf-hidden").siblings().addClass("sf-hidden")},onRender:function(){this.patternsRegion.show(this.patterns),this.calendarRegion.show(this.transactionsCalendar),this.config.showFinancialChart&&this.chartRegion.show(this.financialChart)}});return s}),define("widgets/financial-calendar/views/financial-calendar-content-view-extension",["widgets/financial-calendar/views/financial-calendar-content-view","utils/util","hbs!widgets/financial-calendar/templates/financial-calendar-content","modules/patterns/patterns-module","modules/financial-calendar-columnchart/financial-calendar-columnchart-module","modules/transactions-calendar/transactions-calendar-module","css!widgets/financial-calendar/css/financial-calendar"],function(e,t,n,r,i,s){var o=e.extend({events:{"click .sf-section-navigator-calendar":"_showCalendar","click .sf-section-navigator-payments":"_showPatterns","calendar:change":"_updateChart"},initialize:function(){this._super.apply(this,arguments)},_showCalendar:function(){t.pushToDataLayer({eventCategory:"PFM Calendario",eventAction:"Boton",eventLabel:"Calendario",event:"eventClick"}),this._super.apply(this,arguments)},_showPatterns:function(){t.pushToDataLayer({eventCategory:"PFM Calendario",eventAction:"Boton",eventLabel:"Movimiento Recurrente",event:"eventClick"}),this._super.apply(this,arguments)}});return o}),define("widgets/financial-calendar/financial-calendar-widget",["classes/ui/widget/widget","widgets/financial-calendar/views/financial-calendar-header-view","widgets/financial-calendar/views/financial-calendar-content-view","modules/patterns/patterns-module","services/patterns-service","modules/transactions-calendar/transactions-calendar-module"],function(e,t,n,r,i,s){var o=e.extend({onRender:function(){this._super(),this.headerRegion.show(new t(this.contextConfig)),this.contentRegion.show(new n(this.contextConfig))}},{ID:"financial-calendar",submodules:[r,s],services:[i],defaults:{showFinancialChart:!1}});return o}),define("data/balance/balance-model",["classes/model","utils/date"],function(e,t){var n=e.extend({parse:function(e){var n=this._super(e);return n.month!==undefined&&(n.monthDate=t.date.parseBackendDate(n.month)),n.accType!==undefined&&n.accId!==undefined&&(n.accountPK=n.accType+"-"+n.accId),n}});return n}),define("data/balance/balance-collection",["classes/collection","data/balance/balance-model"],function(e,t){var n=e.extend({url:"/balance/get/all.action",model:t,parse:function(e){return e.balances}});return n}),define("data/balance/balance-data-manager",["classes/data-manager","utils/util","data/accounts/accounts-data-manager","data/balance/balance-model","data/balance/balance-collection"],function(e,t,n,r,i){var s=e.extend({initialize:function(){this._super.apply(this,arguments),this.collectionDefs={balance:{type:i,loader:{method:this.get,context:this,params:{force:!0}},subscriptions:["transaction:change","transaction:amount:change","transaction:category:change","transaction:date:change","rule:add","rule:change","rule:remove","account:update"]}},this.accountsDM=n.getInstance()},get:function(e){var t=this.getCollection("balance",e),n=this.accountsDM.get();return this._wireRelationships(t,n)},_wireRelationships:function(e,n){var r=new t.Deferred;return t.when(e,n).then(function(e,n){t.map(e.models,function(e){return e.set({account:n.hash[e.get("accountPK")]},{silent:!0}),e}),r.resolve(e)}),r.promise()}});return s}),define("services/balance-service",["classes/service","utils/util","data/balance/balance-data-manager","classes/resource-loader"],function(e,t,n,r){var i=e.extend({initialize:function(){this._super.apply(this,arguments),this.balanceDM=n.getInstance(),this.resources={balance:new r(this.balanceDM,this.balanceDM.get)}},get:function(e){var t=this.resources.balance,n=function(){return this._parseBalance(t,e)};return this.executeJob(this,n,[t])},_parseBalance:function(e,n){var r=this,i=t.filter(e.data.models,function(e){return r._filterBalance(e,n)}),s={},o={expenses:{amount:0,transactions:0},income:{amount:0,transactions:0},balance:{amount:0,transactions:0}};return t.reduce(i,function(e,t){var n=t.get("month"),r=t.get("income"),i=t.get("totalIncome"),u=t.get("expense"),a=t.get("totalExpenses"),f=r+u,l=t.get("total");return o.income.amount+=r,o.income.transactions+=i,o.expenses.amount+=u,o.expenses.transactions+=a,o.balance.amount+=f,o.balance.transactions+=l,s[n]?(s[n].income.amount+=r,s[n].income.transactions+=i,s[n].expenses.amount+=u,s[n].expenses.transactions+=a,s[n].balance.amount+=f,s[n].balance.transactions+=l):s[n]={income:{amount:r,transactions:i},expenses:{amount:u,transactions:a},balance:{amount:f,transactions:l}},s},s,this),{collection:s,totals:o}},_filterBalance:function(e,n){if(!n)return!0;var r=n.accounts?n.accounts.selected:null;if(r!==undefined&&r!==null&&!t.contains(r,e.get("accountPK")))return!1;if(n.datesRange){var i=n.datesRange.fromDate,s=n.datesRange.toDate;if(i!==undefined&&i.getTime()>e.get("monthDate").getTime())return!1;if(s!==undefined&&s.getTime()<e.get("monthDate").getTime())return!1}return!0}},{ID:"balance-service"});return i}),define("hbs!modules/balance-header/templates/balance-summary",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=n.helperMissing;s+='<div class="sf-balance-summary">\n	',a={hash:{"class":"sf-summary-income",title:'{{{t "common.summary.income" datesRange=dateRangeText}}}',value:"{{{income}}}"}},u=(o=n.summaryBox,o?o.call(t,a):f.call(t,"summaryBox",a));if(u||u===0)s+=u;s+="\n	",a={hash:{"class":"sf-summary-expenses",title:'{{{t "common.summary.expenses" datesRange=dateRangeText}}}',value:"{{{expenses}}}"}},u=(o=n.summaryBox,o?o.call(t,a):f.call(t,"summaryBox",a));if(u||u===0)s+=u;s+="\n	",a={hash:{"class":"sf-summary-cashflow",title:'{{{t "common.summary.cashflow" datesRange=dateRangeText}}}',value:"{{{balance}}}"}},u=(o=n.summaryBox,o?o.call(t,a):f.call(t,"summaryBox",a));if(u||u===0)s+=u;return s+="\n</div>",s});return t.registerPartial("modules_balance-header_templates_balance-summary",n),n}),define("modules/balance-header/views/balance-summary-view",["classes/item-view","utils/util","services/balance-service","hbs!modules/balance-header/templates/balance-summary","utils/amount","utils/date"],function(e,t,n,r){var i=e.extend({filtersList:["accounts","datesRange"],template:r,initialize:function(){this._super.apply(this,arguments),this.balanceService=n.getInstance(),this.balanceTotals=null,this.dateRangeText=t.date.formatSemanticRange(this.filters.datesRange.fromDate,this.filters.datesRange.toDate)},render:function(e){if(e)return this._super();var n=this,r=this.config.providerAccId;if(r){var i=0;t.each(this.filters.accounts.selected,function(e,t){e.indexOf(r)>0&&(i=n.filters.accounts.selected[t])}),i&&(this.filters.accounts.selected=Array(i))}t.when(this.balanceService.get(this.filters)).done(t.bind(this._dataReceived,this)).fail(t.bind(this._dataError,this))},serializeData:function(){var e,n=t.reduce(this.balanceTotals,function(n,r,i){return e=i==="balance"?r.amount:Math.abs(r.amount),n[i]=t.amount.format(e,!1),n},{});return t.extend({dateRangeText:"<span class='sf-period'>"+this.dateRangeText+"</span>"},n)},_dataError:function(e){console.error("[BalanceSummaryView] Error retrieving analysis data",e),this.publish("error",e)},_dataReceived:function(e){this.balanceDataResult&&this.balanceDataResult.dispose(),this.balanceDataResult=e,this.balanceTotals=this.balanceDataResult.data.totals,this.balanceDataResult.on("change",this._dataChanged,this),this.render(!0)},_dataChanged:function(e){console.log("[BalanceBreadcrumb] Balance data changed, redraw"),this.balanceTotals=e.data.totals,this.render(!0)},_filtersChanged:function(e,n){e==="datesRange"&&(this.dateRangeText=t.date.formatSemanticRange(n.fromDate,n.toDate)),this.render()}});return i}),define("hbs!modules/balance-header/templates/balance-header",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s,o,u=n.helperMissing,a=this.escapeExpression;return o={hash:{id:"balance",title:'{{t "balance-header.title"}}',filtersPlaceholders:t.filtersPlaceholders,summaryPlaceholder:"true"}},a((s=n.header,s?s.call(t,o):u.call(t,"header",o)))});return t.registerPartial("modules_balance-header_templates_balance-header",n),n}),define("modules/balance-header/balance-header-module",["classes/layout","modules/balance-header/views/balance-summary-view","modules/accounts-filter/accounts-filter-module","ui/modules/timerange-filter/timerange-filter-module","services/accounts-service","services/balance-service","hbs!modules/balance-header/templates/balance-header","utils/util","utils/i18n"],function(e,t,n,r,i,s,o,u){var a=e.extend({template:o,regions:{accountsfilterRegion:".sf-accounts-filter-placeholder",timerangefilterRegion:".sf-timerange-filter-placeholder",headersummaryRegion:".sf-summary-placeholder"},initialize:function(){this._super.apply(this,arguments),this.accountsService=i.getInstance(),this._setupDatesRangeFilter()},serializeData:function(){return{filtersPlaceholders:["sf-accounts-filter-placeholder","sf-timerange-filter-placeholder"]}},onShow:function(){u.mask(this.$el,u.MASK_LOADING);var e=this;this._setupAccountsFilter(this.accountsService,function(){e._renderRegions(),u.unmask(e.$el)})},_renderRegions:function(){this.headersummaryRegion.show(new t(this.contextConfig)),this.accountsfilterRegion.show(new n(this.contextConfig)),this.timerangefilterRegion.show(new r(u.extend({},this.contextConfig,{config:{rangeSelected:this.config.initialRangeMonths,fromDate:this.config.filters.datesRange.fromDate,toDate:this.config.filters.datesRange.toDate}})))}},{ID:"balance-header",submodules:[n,r],services:[i,s],defaults:{initialRangeMonths:3,stepScale:"month"}});return a}),define("hbs!modules/balance-content/templates/balance-content",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function h(e,t){var r="",i;r+='\n			<div class="sf-button-section">\n				',i=n.each.call(e,e,{hash:{},inverse:c.noop,fn:c.program(2,p,t)});if(i||i===0)r+=i;return r+="\n			</div>\n		",r}function p(e,t){var r="",i,s;return r+="\n					",s={hash:{"class":e.iconClass,title:"balance-content.button.{{name}}",dataChart:e.name,type:"button"}},r+=l((i=n.button,i?i.call(e,s):f.call(e,"button",s)))+"\n				",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c=this;s+='<div class="sf-balance-content">\n	\n	<div class="sf-balance-header-back">\n		<a href="javascript:void(0);" class="sf-balance-close"><span class="sf-balance-close-text">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"balance-content.backButton",a):f.call(t,"t","balance-content.backButton",a)))+'</span></a>\n	</div>\n	<div class="sf-balance-filters-applied">\n\n	</div>\n	<div class="sf-mode-filter-placeholder"></div>\n	<div class="sf-chart-selector sf-button-group-section">\n		',u=n.each.call(t,t.groups,{hash:{},inverse:c.noop,fn:c.program(1,h,i)});if(u||u===0)s+=u;return s+='\n	</div>\n	<div class="sf-breadcrumb-placeholder"></div>\n	<div class="sf-charts-placeholder sf-clearfix">\n		<div class="sf-balance-chart-placeholder"></div>\n	</div>\n	\n	\n	<div class="sf-balance-colors-indicator">\n		<div class="sf-incomes-colors-indicator">\n			<span class="sf-category-color"></span>\n			<span class="sf-incomes-colors-indicator-label"> \n				',a={hash:{}},s+=l((o=n.t,o?o.call(t,"balance-content.colorsIndicator.incomeLabel",a):f.call(t,"t","balance-content.colorsIndicator.incomeLabel",a)))+'\n			</span>\n		</div>\n		<div class="sf-expenses-colors-indicator">\n			<span class="sf-category-color"></span>\n			<span class="sf-expenses-colors-indicator-label"> \n				',a={hash:{}},s+=l((o=n.t,o?o.call(t,"balance-content.colorsIndicator.expensesLabel",a):f.call(t,"t","balance-content.colorsIndicator.expensesLabel",a)))+"\n			</span>\n		</div>\n	</div>\n\n\n</div>",s});return t.registerPartial("modules_balance-content_templates_balance-content",n),n}),define("libs/require/css/css!modules/balance-content/css/balance-content",[],function(){}),define("modules/balance-content/balance-content-module",["classes/layout","classes/model","ui/modules/mode-filter/mode-filter-module","modules/transactions-details/extensions/transactions-details-accordion/transactions-details-accordion-module","services/balance-service","hbs!modules/balance-content/templates/balance-content","utils/util","utils/tooltip","utils/mask","css!modules/balance-content/css/balance-content"],function(e,t,n,r,i,s,o){var u=e.extend({template:s,regions:{chartRegion:".sf-balance-chart-placeholder",detailsRegion:".sf-details-placeholder"},events:{"click .sf-chart-selector .sf-button-section button":"_chartSelectHandler"},ui:{emptyMessage:".sf-empty-message",buttons:".sf-chart-selector .sf-button-section button"},filtersList:["accounts","datesRange"],hubEvents:{"balance:chart:change":"_display"},initialize:function(e){this._super(e),this.model=this.model||new t;if(!e.charts)throw"[BalanceChart] Chart selection is mandatory";this.balanceService=i.getInstance();var n={},r={},s=o.merge({},this.contextConfig,{viewType:this.globals.viewType,model:this.model});o.each(e.charts,function(e,r){var i=function(){return new e.constructor(o.merge({name:r,model:new t,managed:!0},s,e))};n[r]=i}),this.charts=n,this.groups=r,this.currentChart=this.config.initialChart,this.chartRegion.on("show",function(e){this.ui.buttons.removeClass("sf-active").filter("button[data-chart="+e.options.name+"]").addClass("sf-active"),this.currentChart=e.options.name},this),this._dataReceived=o.bind(this._dataReceived,this),this._dataError=o.bind(this._dataError,this),this._updateData=o.bind(this._updateData,this)},serializeData:function(){return this},onShow:function(){this.detailsRegion.show(new r(this.contextConfig)),this._updateData(),o.tooltip.add(this.$("button"),this.tooltipOptions)},onClose:function(){this.dispose()},display:function(e){if(this.chartRegion){var t=this.chartRegion&&this.chartRegion.currentView;this._display(e)&&t&&this.publish("balance:chart:change",e)}},_display:function(e){var t=this.charts[e],n=this.currentChart==e,r=this.chartRegion&&this.chartRegion.currentView;if(t&&(!n||!r)){this.currentChart=e;if(this.chartRegion)return this.chartRegion.show(t()),e}},dispose:function(){this.balanceDataResult&&(this.balanceDataResult.dispose(),this.balanceDataResult=null)},_chartSelectHandler:function(e){var t=this.$(e.currentTarget).data("chart");this.display(t)},_filtersChanged:function(){setTimeout(this._updateData)},_updateData:function(){var e=this;o.mask(this.$el,o.MASK_LOADING);var t=this.config.providerAccId;if(t){var n=0;o.each(this.filters.accounts.selected,function(r,i){r.indexOf(t)>0&&(n=e.filters.accounts.selected[i])}),n&&(this.filters.accounts.selected=Array(n))}o.when(this.balanceService.get(this.filters)).done(this._dataReceived).fail(this._dataError)},_dataError:function(e){console.error("[BalanceContent] Error retrieving data",e),this.publish("error",e)},_dataReceived:function(e){o.unmask(this.$el),this.dispose(),this.balanceDataResult=e,this.balanceDataResult.on("change",this._dataChanged,this),this._dataChanged(e)},_dataChanged:function(e){this.balanceData=e.data;if(this.filters.category!=null){var t=this.balanceData.collection[this.filters.category];t||(t=this.balanceService.getSubEntry(this.balanceData.collection,this.filters.category)),this.balanceData.collection=this.balanceService.getSubEntries(this.balanceData.collection,this.filters.category),this.balanceData.totals.amount=t.amount,this.balanceData.totals.name=t.catName}else this.balanceData.totals.name=o.i18n.get("balance-breadcrumb."+this.filters.mode+".all");this.model.clear({silent:!0}),this.model.set(this.balanceData),this.chartRegion&&!this.chartRegion.currentView&&this.display(this.currentChart)}},{ID:"balance-content",submodules:[n,r],services:[i],defaults:{}});return u}),define("modules/balance-content/balance-content-module-extension",["modules/balance-content/balance-content-module","classes/model","ui/modules/mode-filter/mode-filter-module","modules/transactions-details/extensions/transactions-details-accordion/transactions-details-accordion-module","services/balance-service","hbs!modules/balance-content/templates/balance-content","utils/util","utils/tooltip","utils/mask","css!modules/balance-content/css/balance-content"],function(e,t,n,r,i,s,o){var u=e.extend({events:{"click .sf-balance-close":"_backToAnalysisHandler"},filtersList:["datesRange"],_backToAnalysisHandler:function(){this.publish("show:widget",{widget:"analysis"})},_filtersChanged:function(){},onShow:function(){this._updateData(),o.tooltip.add(this.$("button"),this.tooltipOptions)},onRender:function(){this._super(),this.$el.find(".sf-balance-filters-applied").append(this.options.appliedFilters)}});return u}),define("classes/balance/balance-accessible-chart",["classes/ui/chart/accessible-chart","services/balance-service","utils/util"],function(e,t,n){var r=e.extend({filtersList:["accounts","datesRange","mode"],accessibleViewConstructor:null,initialize:function(){this._super.apply(this,arguments),this.balanceService=t.getInstance(),this._dataError=n.bind(this._dataError,this),this._dataReceived=n.bind(this._dataReceived,this),this._getDataCollection=n.bind(this._getDataCollection,this),this._defineSerie=n.bind(this._defineSerie,this),this._definePoints=n.bind(this._definePoints,this),this._buildPoint=n.bind(this._buildPoint,this)},onShow:function(){this._super(),this.options.managed||this.update()},onClose:function(){this._super(),this.dispose()},dispose:function(){this.balanceDataResult&&(this.balanceDataResult.off("change",this._balanceDataChanged),this.balanceDataResult=null)},update:function(){n.mask(this.$el,n.MASK_LOADING),n.when(this.balanceService.get(this.filters)).done(this._dataReceived).fail(this._dataError)},_dataError:function(e){n.unmask(this.$el),console.error("[BalanceChart] Error retrieving balance data",e),this.publish("error",e)},_dataReceived:function(e){n.unmask(this.$el),this.dispose(),this.balanceDataResult=e,this.balanceDataResult.on("change",this._balanceDataChanged,this),this._dataChanged(this.balanceDataResult)},_dataChanged:function(e){this.balanceData=e.data,this.model.clear({silent:!0}),this.model.set(this.balanceData)},_filtersChanged:function(){console.log("[BalanceChart] Filters changed"),this.options.managed||this.update()},_getDatesRange:function(){return n.date.datesInPeriod(this.config.stepScale,this.filters.datesRange.fromDate,this.filters.datesRange.toDate)},parseSeries:function(e){if(n.isEmpty(e.collection))return null;this._cumulative=0,this._data=e;var t=this.config.showBalance?["income","expenses","balance"]:["income","expenses"],r=n.map(t,this._defineSerie);return this.axisData={income:n.pluck(r[0].points,"sublabel"),expenses:n.pluck(r[1].points,"sublabel")},e=this._data,{label:null,sublabel:null,"class":"",series:r,axis:{x:this._getDatesRange()}}},parseTabularSeries:function(e){return e},_getDataCollection:function(e){var t=n.date.format(e,this.config.dataDateFormats[this.config.stepScale]);return this._data.collection[t]},_defineSerie:function(e,t){var r=this.config.colors[e],i=this._definePoints(e),s=n.reduce(n.pluck(i,"value"),function(e,t){return e+t},0);return{label:n.i18n.get(this.config.i18nLabel+e),sublabel:n.unicodeHTMLCodes(n.amount.format(Math.abs(s),this.config.showDecimals)),color:r,options:{type:t<2?"column":"line"},points:i}},_definePoints:function(e){return n.map(this._getDatesRange(),function(t){var n=this._getDataCollection(t);return this._buildPoint(n,e)},this)},_buildPoint:function(e,t){var r=e?e[t].amount:0;this.config.cumulativeBalance&&t==="balance"&&(r+=this._cumulative,this._cumulative=r);var i=n.unicodeHTMLCodes(n.amount.format(Math.abs(r),this.config.showDecimals));return{label:n.i18n.get(this.config.i18nLabel+t),sublabel:i,value:r,options:{kind:t}}}},{ID:"balance-accessible-chart",submodules:[e],defaults:{i18nLabel:"balance-accessible-chart.tooltip.",disableCategoryChange:!1,stepScale:"month",titleFormats:{month:n.date.constructor.LONG_MONTH_YEAR},dataDateFormats:{month:n.date.constructor.BACKEND_MONTH_YEAR_FORMAT},dateFormats:{month:n.date.constructor.LONG_MONTH},colors:{income:"#4D97CF",balance:"#535353",expenses:"#CA5841"},cumulativeBalance:!0,showBalance:!0,emptyMessage:"balance-accessible-chart.empty",showDecimals:!1}});return r}),define("classes/balance/balance-accessible-chart-extension",["classes/balance/balance-accessible-chart","services/balance-service","utils/util"],function(e,t,n){var r=e.extend({},{defaults:{i18nLabel:"balance-accessible-chart.tooltip.",disableCategoryChange:!1,stepScale:"month",titleFormats:{month:n.date.constructor.LONG_MONTH_YEAR},dataDateFormats:{month:n.date.constructor.BACKEND_MONTH_YEAR_FORMAT},dateFormats:{month:n.date.constructor.LONG_MONTH},colors:{income:"#0085D4",balance:"#535353",expenses:"#cb383a"},cumulativeBalance:!0,showBalance:!0,emptyMessage:"balance-accessible-chart.empty",showDecimals:!1}});return r}),define("modules/balance-cashflowchart/views/balance-cashflowchart-columnchart",["ui/modules/columnchart/columnchart-module","d3","utils/amount","utils/date"],function(e,t,n){var r=e.extend({getValue:function(e,t){var n=this._super(e,t);return e.options&&e.options.kind==="expenses"&&(n=Math.abs(n)),n},draw:function(e){this._labelTextCollision=!1,this._labelCollision=!1,this._super(e)},getYaxisFormat:function(e){return n.unicodeHTMLCodes(n.amount.format(e,!1))},getXaxisFormat:function(e,r,i){var s=this.options.parent,o=t.select(i.parentNode),u=this._xScale.rangeBand(),a=n.date.format(e,s.config.dateFormats[s.config.stepScale]),f={"class":"sf-chart-axis-label-income",dy:"2.3em"},l=o.append("text").attr(f).text(s.axisData.income[r]),c={"class":"sf-chart-axis-label-expenses",dy:"3.5em"},h=o.append("text").attr(c).text(s.axisData.expenses[r]),p={"class":"sf-chart-axis-label-month"};return t.select(i).text(a).attr(p),i.getBoundingClientRect().width>u-this.config.minLabelMargin&&(this._labelTextCollision=!0),l.node().getBoundingClientRect().width>u-this.config.minLabelMargin&&(this._labelCollision=!0),h.node().getBoundingClientRect().width>u-this.config.minLabelMargin&&(this._labelCollision=!0),a},solveLabelsCollision:function(){var e=this,t="text.sf-chart-axis-label-month",r="text.sf-chart-axis-label-expenses",i="text.sf-chart-axis-label-income",s=e._$xAxis;e._labelTextCollision&&s.selectAll(t).text(function(e){return n.date.format(e,n.date.constructor.SHORT_MONTH)});if(e._labelCollision){var o=e._columnScale.rangeBand(),u=s.selectAll(t),a=u.node(),f=a.getBoundingClientRect().height,l=a.getAttribute("dy"),c=parseInt(a.getAttribute("y"),10),h={dy:-o/2,transform:"rotate(90)",style:"text-anchor: start",x:f+c,dx:l,"dominant-baseline":"middle"};u.attr({x:0,style:"text-anchor: middle"}),e.enableRTL&&(h.transform="rotate(-90)",h.x*=-1,h.dx="-"+h.dx),s.selectAll(r).attr(h),h.dy+=o,s.selectAll(i).attr(h)}}},{defaults:{minLabelMargin:10,labelAlign:"end"}});return r}),define("modules/balance-cashflowchart/views/balance-cashflowchart-columnchart-extension",["modules/balance-cashflowchart/views/balance-cashflowchart-columnchart","d3","utils/amount","utils/date"],function(e,t,n){var r=e.extend({initialize:function(){this._super.apply(this,arguments),this.jq=this.options.$},_drawLines:function(e,t){},_calcTicks:function(e){return e[0]=0,this._super(e)},getXaxisFormat:function(e,r,i){var s=this.options.parent,o=t.select(i.parentNode),u=this._xScale.rangeBand(),a=n.date.format(e,"MMM yy"),f={"class":"sf-chart-axis-label-income",dy:"2.3em"},l=o.append("text").attr(f).text(s.axisData.income[r]),c={"class":"sf-chart-axis-label-expenses",dy:"3.5em"},h=o.append("text").attr(c).text(s.axisData.expenses[r]),p={"class":"sf-chart-axis-label-month"};return t.select(i).text(a).attr(p),i.getBoundingClientRect().width>u-this.config.minLabelMargin&&(this._labelTextCollision=!0),l.node().getBoundingClientRect().width>u-this.config.minLabelMargin&&(this._labelCollision=!0),h.node().getBoundingClientRect().width>u-this.config.minLabelMargin&&(this._labelCollision=!0),a},draw:function(e){this._labelTextCollision=!1,this._labelCollision=!1;if(n.isEmpty(e))return;var r=this,i;this.$el.html(""),this.$svg=t.select(this.el).append("svg").style({width:"100%",height:"100%"}),r._preprocessData(e),i=r._initializeCanvas(e.axis),this.options.navigation=!0,this.options.navigation&&r._drawNavigationArrows(i),r._y0=r._yScale(0),r._drawStacks(i,r._stacks,e.axis.x),r._drawColumns(r._stacks.length,i,r._columns,e.axis.x),r._drawZeroLine(i),r._drawLines(i,r._lines,e.axis.x)},_drawNavigationArrows:function(e){this.$el.css("position","relative");var t=this;if(this.options.navigatePast){var n=this.jq("<div/>").attr("class","sf-navigate-past").css({position:"absolute",left:this.$el.width()*.2+"px",top:this.$el.height()*.36+"px"});n.click(function(){t.trigger("navigatePast")}),n.appendTo(this.$el)}if(this.options.navigateFuture){var r=this.jq("<div/>").attr("class","sf-navigate-future").css({position:"absolute",left:this.$el.width()*.93+"px",top:this.$el.height()*.36+"px"});r.click(function(){t.trigger("navigateFuture")}),r.appendTo(this.$el)}},_drawYaxis:function(){var e=this,t=this._super();return t.selectAll(".tick text").attr("x",-22),t}});return r}),define("hbs!modules/balance-cashflowchart/templates/balance-cashflowchart-accessible",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-cashflow-chart-accessible"></div>'});return t.registerPartial("modules_balance-cashflowchart_templates_balance-cashflowchart-accessible",n),n}),define("modules/balance-cashflowchart/views/balance-cashflowchart-accessible-view",["classes/item-view","classes/collection","utils/util","ui/modules/datagrid/datagrid-module","hbs!modules/balance-cashflowchart/templates/balance-cashflowchart-accessible","utils/amount","utils/number","utils/percentage"],function(e,t,n,r,i){var s=r.DatagridColumn,o=e.extend({template:i,initialize:function(){this._super.apply(this,arguments),this.gridConfig={sortField:"date",sortDirection:"DESC",columns:[new s({parent:this,headerClass:"sf-date-header",columnClass:"sf-date-col",field:"date",formatter:function(e){return e.get("formattedMonth")},label:n.i18n.get("balance-cashflowchart.accessible.header.date"),sortable:!0}),new s({parent:this,headerClass:"sf-income-header sf-numeric",columnClass:"sf-income-col sf-numeric",field:"income",formatter:function(e){return n.amount.format(e.get("income"))},label:n.i18n.get("balance-cashflowchart.accessible.header.income"),sortable:!0}),new s({headerClass:"sf-expenses-header sf-numeric",columnClass:"sf-expenses-col sf-numeric",field:"expenses",formatter:function(e){return n.amount.format(e.get("expenses"))},label:n.i18n.get("balance-cashflowchart.accessible.header.expenses"),parent:this,sortable:!0}),new s({headerClass:"sf-difference-header sf-numeric",columnClass:"sf-difference-col sf-numeric",field:"difference",formatter:function(e){return n.amount.format(e.get("difference"))},label:n.i18n.get("balance-cashflowchart.accessible.header.difference"),parent:this,sortable:!0}),new s({headerClass:"sf-cashflow-header sf-numeric",columnClass:"sf-cashflow-col sf-numeric",field:"cumulativeCashflow",formatter:function(e){return n.amount.format(e.get("cumulativeCashflow"))},label:n.i18n.get("balance-cashflowchart.accessible.header.cumulativeCashflow"),parent:this,sortable:!0}),new s({headerClass:"sf-transactions-header sf-numeric",columnClass:"sf-transactions-col sf-numeric",field:"transactions",formatter:function(e){return n.number.format(e.get("transactions"),!1)},label:n.i18n.get("balance-cashflowchart.accessible.header.transactions"),parent:this,sortable:!0})]},this.config.filters.mode==="income"?this.gridConfig.columns.splice(2,3):this.config.filters.mode==="expenses"&&(this.gridConfig.columns.splice(3,2),this.gridConfig.columns.splice(1,1))},onRender:function(){var e=this.model.get("data");if(e){var i=n.extend({},this.contextConfig,{parent:this,dataSource:new t(e),config:this.gridConfig,container:this.$el});this.datagrid=new r(i),this.datagrid.render()}},onShow:function(){this.model.on("change",this.render,this)},onClose:function(){this.model.off("change",this.render)}});return o}),define("libs/require/css/css!modules/balance-cashflowchart/css/balance-cashflowchart",[],function(){}),define("modules/balance-cashflowchart/balance-cashflowchart-module",["classes/balance/balance-accessible-chart","modules/balance-cashflowchart/views/balance-cashflowchart-columnchart","utils/util","modules/balance-cashflowchart/views/balance-cashflowchart-accessible-view","css!modules/balance-cashflowchart/css/balance-cashflowchart"],function(e,t,n,r){var i=e.extend({accessibleViewConstructor:r,chartConstructor:t,parseTabularSeries:function(e){var t=e.collection,r=0,i=n.map(this._getDatesRange(),function(e){var i=n.date.format(e,this.config.dataDateFormats[this.config.stepScale]),s=n.date.format(e,this.config.dateFormats[this.config.stepScale]),o=t[i],u=o?Math.abs(o.income.amount)-Math.abs(o.expenses.amount):0;return r+=u,o?{formattedMonth:s,date:e,income:o.income.amount,expenses:o.expenses.amount,difference:o.balance.amount,cumulativeCashflow:r,transactions:o.balance.transactions}:{formattedMonth:s,date:e,income:0,expenses:0,difference:0,cumulativeCashflow:r,transactions:0}},this);return{data:i}}},{ID:"balance-cashflowchart",submodules:[t,e],defaults:{}});return i}),define("libs/require/css/css!ui/modules/totalchart/css/totalchart",[],function(){}),define("ui/modules/totalchart/totalchart-module",["classes/ui/chart/d3-chart","d3","utils/util","css!ui/modules/totalchart/css/totalchart"],function(e,t,n){var r=e.extend({draw:function(e){if(n.isEmpty(e))return;this._super();var r=this,i=this._setEdges(),s=n.pluck(e.series,this.getValue),o=t.max(s),u=t.min(s),a=this._initDataSeries(e.series,[u,o]),f=this.$svg.append("defs"),l=f.append("pattern").attr({id:"sf-striped-pattern","class":"sf-chart-pattern",patternUnits:"userSpaceOnUse",width:4,height:4}),c=this.$svg.append("g").attr({"class":function(){var t=r.getClass(e);return t=t?t+" ":"",t+="sf-chart-content",t},transform:"translate("+i.middlePoint+", 0)"}),h=Math.max(o,Math.abs(u)),p=t.scale.linear().domain(this.axisRTL?[h,-h]:[-h,h]).range([-i.width/2,i.width/2]);l.append("path").attr({d:"M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2"}),this._drawAxis(c,i,p),this._drawChart(c,a,p,i),c.append("text").attr({"class":"sf-chart-title",transform:"translate(0,"+i.height/5+")",dy:"-0.5em","text-anchor":"middle","alignment-baseline":"middle"}).text(this.getLabel(e))},_setEdges:function(){var e=this.$el.width(),t=this.$el.height(),n=e-this.config.marginLeft-this.config.marginRight,r=t-this.config.marginTop-this.config.marginBottom;return{width:n,height:r,middlePoint:n/2+this.config.marginLeft}},_initDataSeries:function(e,t){var r=n.contains(t,0),i=e[0],s=e[1];if(r)return[s,i];var o=e[2],u=this.getValue(o),a=u<0?this.getColor(i):this.getColor(s);return o._topValue=u<0?t[0]:t[1],o._color=a,[s,i,o]},_drawAxis:function(e,n,r){var i=n.height*4/5,s=t.svg.axis().ticks(this.config.numberOfTicks).tickSize(-i).scale(r).tickFormat(this.getAxisFormat).orient("bottom"),o=e.insert("g","g.sf-chart-axis").attr({transform:"translate(0,"+i+")","class":"sf-chart-axis sf-chart-axis-horizontal"}).call(s);o.selectAll("text").style("text-anchor",this.enableRTL?"start":"end").attr("transform","translate(0,15), rotate(-45)")},_drawChart:function(e,t,n,r){var i=this,s=this.config.barHeight,o=(r.height-s)/2,u=e.append("g").attr({"class":"sf-chart-series"}),a=u.selectAll("g").data(t).enter().append("g").attr({"class":function(e,t){var n=i.getClass(e,t);return n=n?n+" ":"",n+="sf-chart-serie sf-chart-serie-"+t,n}});a.append("rect").attr({"class":function(e,t){return"sf-chart-point sf-chart-point-"+t},x:n(0),y:function(e,t){var n=o;return t===2&&(n+=i.config.marginDifferenceSerie),e._y=n,n},height:function(e,t){var n=s;return t===2&&(n-=i.config.marginDifferenceSerie*2),e._height=s,n},width:0,opacity:function(e,t){return t===2?.5:1},fill:function(e,t){var n;return t===2?n="url(#sf-striped-pattern)":n=i.getColor(e,t),n},title:this.getTooltip,rx:this.config.rectangleRadius,ry:this.config.rectangleRadius}).transition().duration(this.config.transitionDuration).attr({x:function(e,t){var r,s=i.getValue(e);return t===0?r=i.axisRTL?n(s):i.config.rectangleOffset:t===1?r=i.axisRTL?i.config.rectangleOffset:n(s):s>0?r=i.axisRTL?n(e._topValue)+i.config.marginDifferenceSerie:n(e._topValue-s):r=i.axisRTL?n(e._topValue-s):n(e._topValue)+i.config.marginDifferenceSerie,e._x=r,r},width:function(e,t){var r=i.getValue(e,t),s=Math.abs(n(r));return t===0?s-=i.axisRTL?i.config.rectangleOffset:e._x:t===1?s-=i.axisRTL?e._x:i.config.rectangleOffset:(s=Math.abs(n(r)),i.axisRTL?r<0&&(s-=i.config.marginDifferenceSerie):r>0&&(s-=i.config.marginDifferenceSerie)),e._width=s,s}}),this._drawLabels(a)},_drawLabels:function(e){var t=this,n=t.axisRTL,r=function(e,n){var r=t.getValue(e,n)>0,i=n<2?r?"start":"end":r?"end":"start";return t.axisRTL!=t.enableRTL?i==="start"?"end":"start":i},i=function(e,r){var i=0,s=t.getValue(e,r)>0;return r<2&&(i=n?s?"-0.5em":"0.5em":s?"0.5em":"-0.5em"),i},s=function(e,t){return t<2?0:"-1.5em"},o=function(e,r){var i=e._x,s=e._y,o=t.getValue(e,r)>0;if(r<2){s-=e._height/8;if(o&&n||!o&&!n)i=-t.config.marginDifferenceSerie}else{s+=e._height*1.5;if(n&&!o||!n&&o)i+=e._width}return"translate("+i+","+s+")"},u=function(e){var n="sf-chart-"+e+" sf-chart-"+e+"-";return function(e,r){var i=t.getValue(e,r)>0?"positive":"negative";return n+i}};e.append("text").attr({"class":u("label"),"text-anchor":r,transform:o,"dominant-baseline":"central",dx:i,dy:s}).text(this.getLabel),e.append("text").attr({"class":u("sublabel"),"text-anchor":r,"dominant-baseline":"bottom",dx:i,transform:o}).text(t.getSublabel)}},{ID:"totalchart",defaults:{marginDifferenceSerie:4,marginTop:10,marginRight:10,marginLeft:30,marginBottom:10,numberOfTicks:10,rectangleOffset:3,rectangleRadius:4,barHeight:70}});return r}),define("hbs!modules/balance-totalchart/templates/balance-totalchart-accessible",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-total-chart-accessible"></div>'});return t.registerPartial("modules_balance-totalchart_templates_balance-totalchart-accessible",n),n}),define("modules/balance-totalchart/views/balance-totalchart-accessible-view",["classes/item-view","classes/collection","utils/util","ui/modules/datagrid/datagrid-module","hbs!modules/balance-totalchart/templates/balance-totalchart-accessible","utils/amount"],function(e,t,n,r,i){var s=r.DatagridColumn,o=e.extend({template:i,_setConfig:function(){var e={columns:[new s({parent:this,headerClass:"sf-numeric",columnClass:"sf-numeric",field:"income",formatter:function(e){return n.amount.format(e.get("income"))},label:n.i18n.get("balance-totalchart.accessible.header.income"),sortable:!1}),new s({headerClass:"sf-numeric",columnClass:"sf-numeric",field:"expense",formatter:function(e){return n.amount.format(e.get("expense"))},label:n.i18n.get("balance-totalchart.accessible.header.expense"),parent:this,sortable:!1}),new s({headerClass:"sf-numeric",columnClass:"sf-numeric",field:"balance",formatter:function(e){return n.amount.format(e.get("balance"))},label:this.options.parent.model.get("totals").balance.amount>0?n.i18n.get("balance-totalchart.accessible.header.overincome"):n.i18n.get("balance-totalchart.accessible.header.overexpense"),parent:this,sortable:!1})]};return this.config.filters.mode==="income"?e.columns.splice(1,1):this.config.filters.mode==="expenses"&&e.columns.splice(0,1),e},onRender:function(){this._super();var e=this._setConfig(),i=n.extend({parent:this,dataSource:new t([this.model.toJSON()]),config:e,container:this.$el},this.contextConfig);this.datagrid=new r(i),this.datagrid.render()},onShow:function(){this.model.on("change",this.render,this)},onClose:function(){this.model.off("change",this.render)}});return o}),define("libs/require/css/css!modules/balance-totalchart/css/balance-totalchart",[],function(){}),define("modules/balance-totalchart/balance-totalchart-module",["classes/balance/balance-accessible-chart","ui/modules/totalchart/totalchart-module","utils/util","modules/balance-totalchart/views/balance-totalchart-accessible-view","css!modules/balance-totalchart/css/balance-totalchart"],function(e,t,n,r){var i=e.extend({accessibleViewConstructor:r,chartConstructor:t.extend({getAxisFormat:function(e){return n.unicodeHTMLCodes(n.amount.format(e,!1))}}),parseSeries:function(e){if(n.isEmpty(e.collection))return null;var t=this,r="balance-accessible-chart.tooltip.",i=n.map(e.totals,function(e,t){var i=e.amount||0,s=n.unicodeHTMLCodes(n.amount.format(Math.abs(i),!1)),o=t,u=s;return t==="balance"&&(o=i>0?"overincome":"overexpenses"),{label:n.i18n.get(r+o),sublabel:u,value:i}}),s=function(e){var r=[e[0],n.last(e)];return n.map(r,function(e){return n.date.format(e,this.config.titleFormats[this.config.stepScale])},t)}(this._getDatesRange());return{label:n.i18n.get("balance-accessible-chart.title",{fromDate:s[0],toDate:s[1]}),sublabel:null,series:i}},parseTabularSeries:function(e){var t={},r=n.pluck(e.collection,"income"),i=n.pluck(e.collection,"expenses"),s=n.pluck(e.collection,"balance");if(!this.filters.mode||this.filters.mode==="income")t.income=n.reduce(r,function(e,t){return e+t.amount},0);if(!this.filters.mode||this.filters.mode==="expenses")t.expense=Math.abs(n.reduce(i,function(e,t){return e+t.amount},0));return t.balance=Math.abs(n.reduce(s,function(e,t){return e+t.amount},0)),t}},{ID:"balance-totalchart",submodules:[t,e],defaults:{}});return i}),define("libs/require/css/css!widgets/balance/css/balance",[],function(){}),define("widgets/balance/balance-widget",["classes/ui/widget/widget","modules/balance-header/balance-header-module","modules/balance-content/balance-content-module","is!ie8?modules/balance-cashflowchart/balance-cashflowchart-hc-module:modules/balance-cashflowchart/balance-cashflowchart-module","is!ie8?modules/balance-totalchart/balance-totalchart-hc-module:modules/balance-totalchart/balance-totalchart-module","modules/transactions-details/transactions-details-module","services/accounts-service","services/balance-service","utils/util","utils/date","utils/mask","css!widgets/balance/css/balance"],function(e,t,n,r,i,s,o,u,a){var f=e.extend({initialize:function(){this._super.apply(this,arguments),this._setupDatesRangeFilter(),this.accountsService=o.getInstance(),this._charts={cashflowchart:{constructor:r,type:"balance"},totalchart:{constructor:i,type:"balance"}};for(var e in this._charts)this._charts[e].constructor==null&&delete this._charts[e]},onShow:function(){a.mask(this.$el,a.MASK_LOADING);var e=this;this._setupAccountsFilter(this.accountsService,function(){e._renderRegions(),a.unmask(e.$el)})},_renderRegions:function(){var e=a.extend({charts:this._charts},this.contextConfig);this.headerRegion.show(new t(a.extend({},e,{config:{initialRangeMonths:this.config.initialRangeMonths,fromDate:this.config.filters.datesRange.fromDate,toDate:this.config.filters.datesRange.toDate}}))),this.contentRegion.show(new n(e))}},{ID:"balance",submodules:[t,n,r,i,s],services:[o,u],defaults:{initialChart:"cashflowchart",initialRangeMonths:3}});return f}),define("widgets/balance/balance-widget-extension",["widgets/balance/balance-widget","modules/balance-header/balance-header-module","modules/balance-content/balance-content-module","is!ie8?modules/balance-cashflowchart/balance-cashflowchart-hc-module:modules/balance-cashflowchart/balance-cashflowchart-module","is!ie8?modules/balance-totalchart/balance-totalchart-hc-module:modules/balance-totalchart/balance-totalchart-module","modules/transactions-details/transactions-details-module","services/accounts-service","services/balance-service","utils/util","utils/date","utils/mask","css!widgets/balance/css/balance"],function(e,t,n,r,i,s,o,u,a){var f=e.extend({initialize:function(){this.contextConfig.$widget=this.contextConfig.widget.$el,this._super.apply(this,arguments)},_renderRegions:function(){var e=a.extend({charts:this._charts},this.contextConfig);e.appliedFilters=this.config.extraData.appliedFilters,this.contentRegion.show(new n(e))},onShow:function(){},onRender:function(){a.mask(this.$el,a.MASK_LOADING);var e=this;e._renderRegions(),setTimeout(function(){for(var t in e.config.filters)e.config.filters.hasOwnProperty(t)&&t==="datesRange"&&e.publish("filters:change",{filter:t,data:e.config.filters[t]});a.unmask(e.$el)},500)}});return f}),define("data/networth/networth-category-collection",["classes/collection"],function(e){var t=e.extend({url:"/networth/categories/get/all.action",parse:function(e){return e.categories}});return t}),define("data/networth/networth-category-data-manager",["classes/data-manager","data/networth/networth-category-collection"],function(e,t){var n=e.extend({initialize:function(){this._super.apply(this,arguments),this.collectionDefs={"networth-categories":{type:t}}},get:function(e){return this.getCollection("networth-categories",e)}});return n}),define("data/networth/networth-overtime-model",["classes/model","utils/date"],function(e,t){var n=e.extend({idAttribute:"valueDate",parse:function(e){var n=this._super(e);return n.date=t.date.parseBackendDate(n.valueDate),n}});return n}),define("data/networth/networth-overtime-collection",["classes/collection","classes/model","data/networth/networth-overtime-model"],function(e,t,n){var r=e.extend({initialize:function(){this._super.apply(this,arguments),this.summary=new t},model:n,url:"/networth/overtime/get/all.action",parse:function(e){return this.summary.set(e.summary),e.months}});return r}),define("data/networth/networth-overtime-data-manager",["classes/data-manager","data/networth/networth-overtime-collection","utils/date"],function(e,t,n){var r=e.extend({initialize:function(){this._super.apply(this,arguments),this.collectionDefs={"networth-overtime":{type:t,subscriptions:["transaction:add","transaction:remove","transaction:change","networth-product:change","networth-product:add","networth-product:remove"]}}},get:function(e){return this.getCollection("networth-overtime",e)},getRequestData:function(e,t){var r=function(e){return e instanceof Date?n.date.formatBackendDate(e):e};return{toDate:r(t.toDate),fromDate:r(t.fromDate)}}});return r}),define("data/networth/networth-overtime-projection-collection",["data/networth/networth-overtime-collection"],function(e){var t=e.extend({url:"/networth/overtime/get/projection.action"});return t}),define("data/networth/networth-overtime-projection-data-manager",["classes/data-manager","data/networth/networth-overtime-projection-collection"],function(e,t){var n=e.extend({initialize:function(){this._super.apply(this,arguments),this.collectionDefs={"networth-overtime-projection":{type:t,subscriptions:["transaction:add","transaction:remove","transaction:change","networth-product:change","networth-product:add","networth-product:remove"]}},this._years=0},get:function(e){return this.getCollection("networth-overtime-projection",e)},evaluateRequestParams:function(e,t,n){t.force&&(n.load=!0),t.years>this._years&&(n.load=!0,n.remove=!0)},onCollectionFetched:function(e,t){t.years>this._years&&(this._years=t.years)},getRequestData:function(e,t,n){var r=this._years,i=n.years||t.years||1;return{years:Math.max(r,i)}}});return n}),define("data/networth/products/networth-product-balance-model",["classes/model","utils/date"],function(e,t){var n=e.extend({parse:function(e){return{amount:e.cuxAmount,updateDate:t.date.parseBackendDate(e.valueDate),id:e.id,productId:e.productId}},destroy:function(){var e=t.Deferred(),n="/networth/products/historic/delete.action",r={productId:this.get("productId"),historicId:this.get("id")};return t.ajax({method:"POST",url:t.apiURL(n),data:r,success:function(t){e.resolve(t)},error:function(t){e.reject(t)}}),e.promise()}});return n}),define("data/networth/products/networth-product-balance-collection",["classes/collection","data/networth/products/networth-product-balance-model"],function(e,t){var n=e.extend({model:t,parse:function(e){return e.historic}});return n}),define("data/networth/products/networth-product-model",["classes/model","classes/remote-error","classes/data-manager","data/networth/products/networth-product-balance-collection","utils/util","utils/date","utils/config"],function(e,t,n,r,i){var s=e.extend({initialize:function(e,t){this._super.apply(this,arguments),this.parent=t&&t.parent,this.dataManger=n.getInstance(),this.baseUrl=i.apiURL(this.baseUrl)},defaults:function(){return{updateDate:i.date.today(),amount:0,pctAdjustmentInterval:"y"}},baseUrl:"/networth/products/${action}.action",save:function(e){var n=i.Deferred(),r=this,s=this.get("id")?"update":"add",o=this.baseUrl.replace("${action}",s),u=function(){r.dataManger.publish("networth-product:change",r,r.dataManger),n.resolve(r)},a=function(e){n.reject(new t(e))},f=e.balances,l={};delete e.balances;for(var c in e)e[c]instanceof Date&&(e[c]=i.date.formatBackendDate(e[c])),l["networthItem."+c]=e[c];return i.each(f,function(e,t){l["updateBalances["+t+"].amount"]=e.amount,l["updateBalances["+t+"].updateDate"]=e.updateDate,e.id&&(l["updateBalances["+t+"].id"]=e.id)}),this.id&&(l["networthItem.id"]=this.id),i.ajax({url:o,method:"POST",success:u,error:a,data:l}),n.promise()},enable:function(){var e=i.Deferred(),n=this.baseUrl.replace("${action}","show"),r={id:this.get("id")},s=this;return i.ajax({url:n,data:r,success:function(){s.set("visible",!0),s.dataManger.publish("networth-product:change",s,s.dataManger),e.resolve(s)},error:function(n){e.reject(new t(n))},method:"POST"}),e.promise()},disable:function(){var e=i.Deferred(),n=this.baseUrl.replace("${action}","hide"),r={id:this.get("id")},s=this;return i.ajax({url:n,data:r,success:function(){s.set("visible",!1),s.dataManger.publish("networth-product:change",s,s.dataManger),e.resolve(s)},error:function(n){e.reject(new t(n))},method:"POST"}),e.promise()},remove:function(){var e=i.Deferred(),n=this.baseUrl.replace("${action}","delete"),r={id:this.id},s=this;return i.ajax({method:"POST",data:r,url:n,success:function(){s.dataManger.publish("networth-product:change",s,s.dataManger),e.resolve(s)},error:function(n){e.reject(new t(n))}}),e.promise()},setExtraPayment:function(e){var n=i.Deferred(),r=this.baseUrl.replace("${action}","amortization"),s=i.merge({nwiId:this.get("id")},e),o=this,u=function(){o.dataManger.publish("networth-product:change",o,o.dataManger),n.resolve(o)},a=function(e){n.reject(new t(e))};return s.date=i.date.formatBackendDate(new Date(s.timelyYear,s.timelyMonth)),i.ajax({method:"POST",url:r,data:s,success:u,error:a}),n.promise()},getBalanceUpdates:function(){var e=i.Deferred(),n=this,s="/networth/products/historic.action";return n.id||(n.balances=new r),n.balances?setTimeout(function(){e.resolve(n.balances)}):i.ajax({method:"GET",url:i.apiURL(s),data:{productId:n.id},success:function(t){i.each(t.result.historic,function(e){e.productId=n.id}),n.balances=new r(t.result,{parse:!0}),e.resolve(n.balances)},error:function(n){e.reject(new t(n))}}),e.promise()},parse:function(e){var t=/Date$/;for(var n in e)n.match(t)&&(e[n]=i.date.parseBackendDate(e[n]));return e.amount=Math.round(e.amount*100)/100,e}});return s}),define("data/networth/products/networth-product-collection",["classes/collection","data/networth/products/networth-product-model"],function(e,t){var n=e.extend({model:t});return n}),define("data/networth/products/networth-product-category-model",["classes/model","classes/data-manager","data/networth/products/networth-product-collection","utils/util","utils/config"],function(e,t,n,r){var i=e.extend({initialize:function(e,n){this._super.apply(this,arguments),this.percentageEndpoint=this.url,this.parent=n.parent,this.dataManager=t.getInstance()},setCategory:function(e){var t=this.get("productTypeId"),n=e._byId[t],r={silent:!0};this.set({category:n},r)},setAmortiguation:function(e,t){var n=r.config.getGlobals().environment.contextPath+"/networth/products/percentage.action",i={pctProjection:e,productTypeId:this.get("productTypeId"),years:t},s=this,o=function(){s.dataManager.publish("networth-product:change",s,s.futureDM)};return r.ajax({method:"POST",url:n,data:i,success:o})},parse:function(e,t){return t=r.merge({},t,{parent:this}),e.products=new n(e.products,t),e.amount=Math.round(e.amount*100)/100,e}});return i}),define("data/networth/products/networth-product-category-collection",["classes/collection","data/networth/products/networth-product-category-model"],function(e,t){var n=e.extend({model:t});return n}),define("data/networth/products/networth-product-set-model",["classes/model","data/networth/products/networth-product-category-collection","utils/util"],function(e,t,n){var r=e.extend({parse:function(e,r){r=n.merge({},r,{parent:this});var i=function(e){return e.products.length};return e.sections=new t(n.filter(e.sections,i),r),e.amount=Math.round(e.amount*100)/100,e}});return r}),define("data/networth/networth-product-endpoint-model",["classes/model","data/networth/products/networth-product-set-model"],function(e,t){var n=e.extend({url:"/networth/products/get/all.action",parse:function(e,n){var r=this._super(e);return{own:new t(r.own,n),owe:new t(r.owe,n)}}});return n}),define("data/networth/networth-product-data-manager",["classes/data-manager","data/networth/networth-product-endpoint-model"],function(e,t){var n=e.extend({initialize:function(){this._super.apply(this,arguments),this.collectionDefs={"networth-product":{type:t,subscriptions:["transaction:add","transaction:remove","transaction:change","networth-product:change","networth-product:add","networth-product:remove"]}}},get:function(e){return this.getCollection("networth-product",e)}});return n}),define("data/networth/networth-product-projection-endpoint-model",["data/networth/networth-product-endpoint-model"],function(e){var t=e.extend({url:"/networth/products/get/projection.action"});return t}),define("data/networth/networth-product-projection-data-manager",["classes/data-manager","data/networth/networth-product-projection-endpoint-model"],function(e,t){var n=e.extend({initialize:function(){this._super.apply(this,arguments),this.collectionDefs={"networth-product-projection":{type:t,subscriptions:["transaction:add","transaction:remove","transaction:change","networth-product:change","networth-product:add","networth-product:remove"]}},this._years=0},get:function(e){return this.getCollection("networth-product-projection",e)},evaluateRequestParams:function(e,t,n){t.force&&(n.load=!0),t.years!=this._years&&(n.load=!0,n.remove=!0)},onCollectionFetched:function(e,t){this._years=t.years},getRequestData:function(e,t,n){return{years:n.years||t.years||this._years}}});return n}),define("services/networth-service",["classes/service","classes/filtered-collection","classes/resource-loader","data/networth/networth-category-data-manager","data/networth/networth-overtime-data-manager","data/networth/networth-overtime-projection-data-manager","data/networth/networth-product-data-manager","data/networth/networth-product-projection-data-manager","utils/util","utils/date"],function(e,t,n,r,i,s,o,u,a){var f=e.extend({initialize:function(){this._super.apply(this,arguments),this._categoriesDM=r.getInstance(),this._overtimeDM=i.getInstance(),this._overtimeProjectionDM=s.getInstance(),this._productsDM=o.getInstance(),this._productsProjectionDM=u.getInstance(),this.resources.categories=new n(this._categoriesDM,this._categoriesDM.get)},categories:function(){return this.executeJob(this.resources,function(){return this.categories.data},this.resources)},overtime:function(e){var t={overtime:new n(this._overtimeDM,this._overtimeDM.get,e),categories:this.resources.categories};return this.executeJob(t,this._overtimeTask,t)},overtimeProjection:function(e){var t={overtime:new n(this._overtimeProjectionDM,this._overtimeProjectionDM.get,e),categories:this.resources.categories};return this.executeJob(t,this._overtimeTask,t)},overtimeSummary:function(){var e={overtime:new n(this._overtimeDM,this._overtimeDM.get,{})};return this.executeJob(e,function(){return this.overtime.data.summary},e)},products:function(e){var t={products:new n(this._productsDM,this._productsDM.get,e),categories:this.resources.categories};return this.executeJob(t,this._productsTask,t)},productsProjection:function(e){var t={products:new n(this._productsProjectionDM,this._productsProjectionDM.get,e),categories:this.resources.categories};return this.executeJob(t,this._productsTask,t)},_overtimeTask:function(){var e=this.categories.data,n=this.overtime.data,r=this.overtime.params[0],i=r.fromDate&&r.fromDate.getUTCTime(),s=r.toDate&&r.toDate.getUTCTime(),o=r.years?function(e,t){return t<=r.years}:function(e){var t=e.get("date").getUTCTime();return i<=t&&t<=s},u=function(t){t.category=e._byId[t.id]},f=function(e){var t=e.get("assets"),n=e.get("liabilities");a.each(t,u),a.each(n,u)},l=new t;return n.each(f),l.setupFilter(n,o),l},_productsTask:function(){var e=this.categories.data,t=this.products.data,n=t.get("own"),r=t.get("owe"),i=function(t){t.setCategory(e)};return n.get("sections").each(i),r.get("sections").each(i),t}},{ID:"networth-service",defaults:{validator:{rules:{"networth-product":{accNumber:{rangelength:[4,128],type:"description"},address:{rangelength:[4,128],type:"description"},alias:{required:!0,rangelength:[4,128],type:"alias"},expirationDate:{required:!0},initialValue:{required:!0,type:"number",range:[.01,1e10]},initialValueDate:{required:!0},pctAdjustment:{type:"number",range:[-100,100]},pctAdjustmentInterval:{},postalCode:{rangelength:[4,128],type:"description"},pymtAdjustment:{type:"number",range:[.01,1e10]},pymtAdjustmentInterval:{},updateBalanceAuto:{},monthTerms:{range:[1,600],type:"number"},balanceAmount:{required:!0,type:"number",range:[.01,1e10]}},"networth-product-dynamic":{accNumber:{rangelength:[4,128],type:"description"},address:{rangelength:[4,128],type:"description"},alias:{required:!0,rangelength:[4,128],type:"alias"},expirationDate:{required:!0},initialValue:{required:!0,type:"number",range:[-1e10,1e10]},initialValueDate:{required:!0},pctAdjustment:{type:"number",range:[-100,100]},pctAdjustmentInterval:{},postalCode:{rangelength:[4,128],type:"description"},pymtAdjustment:{type:"number",range:[.01,1e10]},pymtAdjustmentInterval:{},updateBalanceAuto:{},monthTerms:{range:[1,600],type:"number"},balanceAmount:{required:!0,type:"number",range:[-1e10,1e10]}}}}}});return f}),define("services/networth-service-extension",["services/networth-service","classes/filtered-collection","classes/resource-loader","data/networth/networth-category-data-manager","data/networth/networth-overtime-data-manager","data/networth/networth-overtime-projection-data-manager","data/networth/networth-product-data-manager","data/networth/networth-product-projection-data-manager","utils/util","utils/date"],function(e,t,n,r,i,s,o,u,a){var f=e.extend({categories:function(){return this.executeJob(this.resources,function(){return a.each(this.categories.data.models,function(e){switch(e.get("key")){case"property":e.set("order",0);break;case"car":e.set("order",1);break;case"investment_account":e.set("order",5);break;case"savings":e.set("order",2);break;case"checking":e.set("order",3);break;case"luxury_good":e.set("order",4);break;case"loan":e.set("order",1);break;case"credit":e.set("order",0);break;case"debt":e.set("order",2);break;default:e.set("order",10)}}),this.categories.data},this.resources)}});return f}),define("hbs!modules/networth-ytd-header/templates/networth-ytd-header",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){return"sf-networth-big-numbers"}function h(e,t){return"sf-networth-total-negative"}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=this,l=n.helperMissing;s+='<span class="sf-networth-ytd-header ',o=n["if"].call(t,t.bigNumbers,{hash:{},inverse:f.noop,fn:f.program(1,c,i)});if(o||o===0)s+=o;s+='">\n	<h2>',a={hash:{}},u=(o=n.t,o?o.call(t,"networth-ytd-header.title",a):l.call(t,"t","networth-ytd-header.title",a));if(u||u===0)s+=u;s+='</h2>\n	<div class="sf-networth-assets sf-summary-header">',a={hash:{title:'{{{t "networth-ytd-header.assets"}}}',value:"{{#if assets}}{{formatAmount assets showDecimals=false}}{{else}}{{formatAmount 0 showDecimals=false}}{{/if}}"}},u=(o=n.summaryBox,o?o.call(t,a):l.call(t,"summaryBox",a));if(u||u===0)s+=u;s+='</div><!--\n	--><div class="sf-networth-liabilities sf-summary-header">',a={hash:{title:'{{{t "networth-ytd-header.liabilities"}}}',value:"{{#if liabilities}}{{formatAmount liabilities showDecimals=false}}{{else}}{{formatAmount 0 showDecimals=false}}{{/if}}"}},u=(o=n.summaryBox,o?o.call(t,a):l.call(t,"summaryBox",a));if(u||u===0)s+=u;s+='</div><!--\n	--><div class="sf-networth-total sf-summary-header ',u=n["if"].call(t,t.isCurrentNegative,{hash:{},inverse:f.noop,fn:f.program(3,h,i)});if(u||u===0)s+=u;s+='">',a={hash:{title:'{{{t "networth-ytd-header.networth"}}}',value:"{{#if networth}}{{formatAmount networth showDecimals=false}}{{else}}{{formatAmount 0 showDecimals=false}}{{/if}}"}},u=(o=n.summaryBox,o?o.call(t,a):l.call(t,"summaryBox",a));if(u||u===0)s+=u;return s+="</div>\n</span>\n",s});return t.registerPartial("modules_networth-ytd-header_templates_networth-ytd-header",n),n}),define("libs/require/css/css!modules/networth-ytd-header/css/networth-ytd-header",[],function(){}),define("modules/networth-ytd-header/networth-ytd-header-module",["classes/item-view","services/networth-service","hbs!modules/networth-ytd-header/templates/networth-ytd-header","utils/i18n","utils/amount","utils/percentage","css!modules/networth-ytd-header/css/networth-ytd-header"],function(e,t,n,r){var i=e.extend({template:n,initialize:function(e){this._super(e),this._service=t.getInstance(),this._dataReceived=r.bind(this._dataReceived,this),this._dataError=r.bind(this._dataError,this),this.i18nOps=null},onRender:function(){this._super(),r.when(this._service.overtimeSummary()).done(this._dataReceived).fail(this._dataError)},_dataReceived:function(e){this.dispose(),this._result=e,e.on("change",this._dataUpdate,this),this._dataUpdate(e)},_dataError:function(e){console.error("[NetworthYTDheader] Error retrieving data from service",e),this.publish("error",e)},_dataUpdate:function(e){var t=e.data,n=t.get("assets")-Math.abs(t.get("liabilities")),i=t.get("previousAssets")-Math.abs(t.get("previousLiabilities")),s=n<0,o=i<0,u=i&&o==s,a=n-i;this.i18nOps={amount:r.amount.format(n,!1),networth:n,assets:t.get("assets"),liabilities:t.get("liabilities"),diff:r.amount.format(Math.abs(a),!1),pct:u?r.percentage.format(a*100/Math.abs(i)):"",ytd:u?a*100/Math.abs(i):""},this.$el.html(this.template(this.i18nOps))},serializeData:function(){return this.i18nOps},dispose:function(){this._result&&(this._result.dispose(),this._result=null)},onClose:function(){this.dispose()}},{ID:"networth-ytd-header",services:[t],defaults:{}});return i}),define("modules/networth-ytd-header/networth-ytd-header-module-extension",["modules/networth-ytd-header/networth-ytd-header-module","services/networth-service","hbs!modules/networth-ytd-header/templates/networth-ytd-header","utils/i18n","utils/amount","utils/percentage","css!modules/networth-ytd-header/css/networth-ytd-header"],function(e,t,n,r){var i=e.extend({_dataUpdate:function(e){var t=e.data,n=t.get("assets")-Math.abs(t.get("liabilities")),i=t.get("previousAssets")-Math.abs(t.get("previousLiabilities")),s=n<0,o=i<0,u=i&&o==s,a=n-i,f=!1;if(this._bigNumber(n)||this._bigNumber(t.get("assets"))||this._bigNumber(t.get("liabilities")))f=!0;this.i18nOps={amount:r.amount.format(n,!1),networth:Math.round(n),assets:Math.round(t.get("assets")),liabilities:Math.round(t.get("liabilities")),diff:r.amount.format(Math.abs(a),!1),pct:u?r.percentage.format(a*100/Math.abs(i)):"",ytd:u?a*100/Math.abs(i):"",bigNumbers:f,isCurrentNegative:s},this.$el.html(this.template(this.i18nOps))},_bigNumber:function(e){return e.toString().length>11}});return i}),define("hbs!modules/networth-header/templates/networth-header",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s,o,u=n.helperMissing,a=this.escapeExpression;return o={hash:{id:"networth",title:"",summaryPlaceholder:"true"}},a((s=n.header,s?s.call(t,o):u.call(t,"header",o)))});return t.registerPartial("modules_networth-header_templates_networth-header",n),n}),define("libs/require/css/css!modules/networth-header/css/networth-header",[],function(){}),define("modules/networth-header/networth-header-module",["classes/layout","modules/networth-ytd-header/networth-ytd-header-module","hbs!modules/networth-header/templates/networth-header","css!modules/networth-header/css/networth-header"],function(e,t,n){var r=e.extend({template:n,regions:{summaryRegion:".sf-summary-placeholder"},serializeData:function(){var e=this.options.title==null?"networth-header.title":this.options.title;return{title:e}},onRender:function(){this.summaryRegion.show(new t(this.contextConfig))}},{ID:"networth-header",submodules:[t],defaults:{}});return r}),define("hbs!ui/modules/chart-tab/templates/chart-tab",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i;r+='\n		<div class="sf-button-group-section">\n			<div class="sf-button-section">\n					',i=n.each.call(e,e.charts,{hash:{},inverse:f.noop,fn:f.program(2,c,t)});if(i||i===0)r+=i;return r+="\n			</div>\n		</div>\n		",r}function c(e,t){var r="",i,s;return r+="\n						",s={hash:{"class":e.iconClass,title:e.title,dataChart:e.name}},r+=a((i=n.button,i?i.call(e,s):u.call(e,"button",s)))+"\n					",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u=n.helperMissing,a=this.escapeExpression,f=this;s+='<div class="sf-chart-tab">\n	<div class="sf-chart-tab-controls ">\n		',o=n["if"].call(t,t.count,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;return s+='\n	</div>\n	<div class="sf-chart-tab-content">\n	</div>\n</div>',s});return t.registerPartial("ui_modules_chart-tab_templates_chart-tab",n),n}),define("libs/require/css/css!ui/modules/chart-tab/css/chart-tab",[],function(){}),define("ui/modules/chart-tab/chart-tab-module",["classes/layout","utils/util","hbs!ui/modules/chart-tab/templates/chart-tab","css!ui/modules/chart-tab/css/chart-tab"],function(e,t,n){var r=e.extend({template:n,events:{"click .sf-chart-tab-controls button":"_chartSelectHandler"},tooltipSelector:"[title]",regions:{contentRegion:".sf-chart-tab-content"},ui:{buttons:".sf-chart-tab-controls button"},initialize:function(e){if(!e.charts||!t.size(e.charts))throw"["+this.constructor.ID+"] No charts defined!";this._super(e);var n={},r=this;t.each(e.charts,function(e,i){n[i]={name:i,iconClass:e.icon||"sf-"+r.constructor.ID+"-icon-"+i,title:e.title!=null?e.title:r.constructor.ID+".button."+i,get:e.view?function(){return new e.view(t.merge({},r.contextConfig,{name:i},e.options))}:function(){return new e(t.merge({},r.contextConfig,{name:i},e.options))}}}),r.charts=n,r.currentChart=r.config.initialChart,r.contentRegion.on("show",function(e){r.ui.buttons.removeClass("sf-active").filter("button[data-chart="+e.options.name+"]").addClass("sf-active"),r.currentChart=e.options.name})},_removeTooltips:function(){if(this._$tooltips){while(this._$tooltips.length)t.tooltip.destroy(this._$tooltips),this._$tooltips=this._$tooltips.slice(1);this._$tooltips=null}},_attachTooltips:function(){this.config.tooltipEnable&&(this._$tooltips=this.$(this.tooltipSelector),t.tooltip.add(this._$tooltips,t.merge({},this.tooltipOptions,this.tooltipExtra)))},onRender:function(){this._super(),this._removeTooltips(),this._attachTooltips();var e=this.charts[this.currentChart];e&&this.contentRegion.show(e.get())},onClose:function(){this._removeTooltips()},serializeData:function(){return{count:t.size(this.charts)-1,charts:this.charts}},display:function(e){if(this.contentRegion){var t=this.contentRegion&&this.contentRegion.currentView;this._display(e)&&t&&(this.publish(this.constructor.ID+":chart:change",e),this.trigger("chart:change",e))}},_display:function(e){var t=this.charts[e],n=this.currentChart==e,r=this.contentRegion&&this.contentRegion.currentView;if(t&&(!n||!r)){this.currentChart=e;if(this.contentRegion)return this.contentRegion.show(t.get()),!0}return!1},_chartSelectHandler:function(e){var t=this.$(e.currentTarget).data("chart");this.display(t)}},{ID:"chart-tab",defaults:{initialChart:"columnchart",tooltipEnable:!0}});return r}),define("hbs!modules/networth-overtime/templates/networth-overtime",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-chart-tab sf-networth-overtime">\n	<div class="sf-chart-tab-content"></div>\n	<div class="sf-balance-colors-indicator">\n		<div class="sf-incomes-colors-indicator">\n			<span class="sf-category-color"></span>\n			<span class="sf-incomes-colors-indicator-label">\n				',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-overtime.colorsIndicator.incomeLabel",u):a.call(t,"t","networth-overtime.colorsIndicator.incomeLabel",u)))+'\n			</span>\n		</div>\n		<div class="sf-expenses-colors-indicator">\n			<span class="sf-category-color"></span>\n			<span class="sf-expenses-colors-indicator-label">\n				',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-overtime.colorsIndicator.expensesLabel",u):a.call(t,"t","networth-overtime.colorsIndicator.expensesLabel",u)))+"\n			</span>\n		</div>\n	</div>\n</div>\n",s});return t.registerPartial("modules_networth-overtime_templates_networth-overtime",n),n}),define("libs/require/css/css!modules/networth-overtime/css/networth-overtime",[],function(){}),define("modules/networth-overtime/views/networth-overtime-breadcrumb-view",["ui/modules/breadcrumb/breadcrumb-module","services/networth-service","utils/i18n","css!modules/networth-overtime/css/networth-overtime"],function(e,t,n){var r=e.extend({filtersList:["networthCategory"],initialize:function(){this._super.apply(this,arguments),this.steps.push({id:null,label:n.i18n.get("networth-overtime.breadcrumb.root")}),this._service=t.getInstance(),this._dataReceived=n.bind(this._dataReceived,this),this._dataError=n.bind(this._dataError,this)},render:function(){if(this._categories)return this._super();n.when(this._service.categories()).done(this._dataReceived).fail(this._dataError)},serializeData:function(){return this.steps=this.steps.slice(0,1),this.filters.networthCategory!=null&&this.steps.push({id:this.filters.networthCategory,label:this._categories.get(this.filters.networthCategory).get("namePluralI18n")}),this._super()},_dataReceived:function(e){this.dispose(),this._results=e,e.on("change",this._dataUpdate,this),this._dataUpdate(e)},_dataUpdate:function(e){this._categories=e.data,this.render()},_dataError:function(e){console.error("[NetworthOvertimeBreadcrumb] Failed to retrive category data",e),this.publish("error",e)},dispose:function(){this._results&&(this._results.dispose(),this._results=null,this._categories=null)},onClose:function(){this.dispose()},onStepChange:function(e){this.publish("filters:change",{filter:"networthCategory",data:e.id})},_filtersChanged:function(){this.render()}});return r}),define("modules/networth-overtime/networth-overtime-module",["ui/modules/chart-tab/chart-tab-module","hbs!modules/networth-overtime/templates/networth-overtime","modules/networth-overtime/views/networth-overtime-breadcrumb-view","ui/modules/breadcrumb/breadcrumb-module","services/networth-service","css!modules/networth-overtime/css/networth-overtime"],function(e,t,n,r,i){var s=e.extend({filtersList:["datesRange","networthCategory"],template:t,regions:{breadcrumbRegion:".sf-networth-overtime-breadcrumb-placeholder",contentRegion:".sf-chart-tab-content"},onRender:function(){this._super(),this.$el.addClass("sf-"+this.constructor.ID),this.breadcrumbRegion.show(new n(this.contextConfig))}},{ID:"networth-overtime",services:[i],submodules:[r],defaults:{initialChart:"columnchart"}});return s}),define("libs/require/css/css!modules/networth-future-overtime/css/networth-future-overtime",[],function(){}),define("modules/networth-future-overtime/networth-future-overtime-module",["modules/networth-overtime/networth-overtime-module","css!modules/networth-future-overtime/css/networth-future-overtime"],function(e){var t=e.extend({filtersList:["projectionRange","networthCategory"],onRender:function(){this._super()}},{ID:"networth-future-overtime",defaults:{initialChart:"columnchart"}});return t}),define("ui/modules/donutchart/donutchart-module-networth",["ui/modules/donutchart/donutchart-module","d3","utils/util","css!ui/modules/donutchart/css/donutchart"],function(e,t,n){var r=e.extend({filtersList:["mode"],_filtersChanged:function(e,t){this._super.apply(this,arguments),e==="mode"&&(this.$el.find(".sf-chart-message").remove(),this.$el.find(".sf-chart-legend").before("<div class='sf-chart-message'>"+n.i18n.get("analysis-treemap.message."+t)+"</div>"))},draw:function(e){if(n.isEmpty(e))return;this._super();var r=this,i=r.$el.height(),s=r.$el.width(),o=Math.min(s||i,i||s)/2,u=o*r.config.labelRadiusPercentage,a=o*r.config.innerRadiusPercentage,f=o*r.config.outerRadiusPercentage,l=e.series,c=this.enableRTL?this._sortElementsRTL:this._sortElements,h=t.layout.pie().sort(c).value(r.getValue)(l),p=t.svg.arc().innerRadius(a).outerRadius(f);r.$el.html(""),s=i=o*2,r.$box=t.select(r.el).append("div").attr({"class":"sf-donutchart-box"}),r.$svg=r.$box.append("svg").style({width:s+"px",height:i+"px"});var d=r._drawCenter(s,i);!r.config.hideTitles&&r.config.innerRadiusPercentage>0&&r._drawTitles(d,e);var v=r._drawSections(d,h,p,u,f);r._drawLabels(v,p,u,f)},_drawTitles:function(e,t){var n=this,r=e.append("g").attr("class","sf-chart-titles");r.append("text").attr({"text-anchor":"middle","class":"sf-chart-title",dy:"0"}).text(function(e,r){return n.getLabel(t,r,this)});var i;return r.append("text").text(function(e,r){var s=n.getSublabel(t,r,this);return i=s.length-8,s}).attr({"text-anchor":"middle","class":"sf-chart-subtitle",dy:"35px",style:i>0?"font-size:"+(2.5-n.config.subtitleDiff*i)+"em":""}),r},getColor:function(e,t){var r=function(e,t,r){return n.isFunction(e[t])?e[t].call(e,e,r):e[t]},i=e.data.get("category").attributes.positiveColor,s=e.data.get("category").attributes.negativeColor,o=r(e,"color",t);return o.indexOf("undefined")>=0&&(e.data.get("category").attributes.asset&&i!==undefined?o="#"+i:e.data.get("category").attributes.asset===!1&&s!==undefined&&(o="#"+s)),o},_drawSections:function(e,n,r){var i=this,s=e.append("g").attr("class","sf-chart-series"),o=s.selectAll("g.sf-chart-serie").data(n).enter().append("g").attr({"class":function(e,t){var n=i.getClass(e,t);return n=n?n+" ":"",n+="sf-chart-group sf-chart-serie sf-chart-serie-"+t,n}});return o.append("path").attr({"class":function(e,t){var n=i.getClass(e,t);return n=n?n+" ":"",n+="sf-chart-point sf-chart-point-"+t,n},fill:function(e,t){return i.getColor(e.data,t)},title:function(e,t){return i.getTooltip(e.data,t)}}).transition().duration(this.config.transitionDuration).attrTween("d",function(e){if(e.value){var n=t.interpolate(0,e.startAngle),i=t.interpolate(0,e.endAngle);return function(t){return e.startAngle=n(t),e.endAngle=i(t),r(e)}}return 0}),o},_drawMessage:function(){var e=this.filters.mode;this.$el.find(".sf-chart-message").remove(),this.$el.find(".sf-chart-legend").before("<div class='sf-chart-message'>"+n.i18n.get("analysis-treemap.message."+e)+"</div>")},_drawLabels:function(e,t,n){var r=this,i=-Math.PI/2,s=e.append("g").attr({"class":"sf-chart-labels","text-anchor":this._textAnchorByPosition,transform:function(e){var s=r._calcAlignedPoint(t.centroid(e),n);return e.x=s[0],e.y=s[1],e.polar={angle:(e.startAngle+e.endAngle)/2+i,radius:n},"translate("+e.x+","+e.y+")"}});s.append("text").attr({"text-anchor":"middle","class":"sf-chart-label sf-chart-label-percentage"}).text(function(e,t){return r.getPercetangeLabel(e.data,t)})},getPercetangeLabel:function(e,t){return e.percentage<5?"":e.percentage+"%"}},{defaults:{lineToLabelPadding:5,linetoLabelAppearMaxAngle:.5,labelRadiusPercentage:.65,outerRadiusPercentage:.8,innerRadiusPercentage:.5,rowsInLegendColumn:8,hideLegend:!1,subtitleDiff:.16}});return r}),define("hbs!modules/networth-product-manager/templates/networth-product-category-tooltip",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression;return s+="<b>",(o=n.name)?o=o.call(t,{hash:{}}):(o=t.name,o=typeof o===u?o.apply(t):o),s+=a(o)+'</b><br/>\n<span class="sf-number">',(o=n.amount)?o=o.call(t,{hash:{}}):(o=t.amount,o=typeof o===u?o.apply(t):o),s+=a(o)+" (",(o=n.percentage)?o=o.call(t,{hash:{}}):(o=t.percentage,o=typeof o===u?o.apply(t):o),s+=a(o)+"%)</span>",s});return t.registerPartial("modules_networth-product-manager_templates_networth-product-category-tooltip",n),n}),define("hbs!modules/networth-product-manager/templates/networth-product-manager-empty-message",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s,o,u=n.helperMissing,a=this.escapeExpression;return o={hash:{text:t.text,"class":t["class"]}},a((s=n.empty,s?s.call(t,o):u.call(t,"empty",o)))});return t.registerPartial("modules_networth-product-manager_templates_networth-product-manager-empty-message",n),n}),define("modules/networth-product-manager/views/networth-product-set-chart",["ui/modules/donutchart/donutchart-module","hbs!modules/networth-product-manager/templates/networth-product-category-tooltip","hbs!modules/networth-product-manager/templates/networth-product-manager-empty-message","utils/amount"],function(e,t,n,r){var i=e.extend({draw:function(e){e=this.parseSeries(),e?this._super(e):this.$el.html(n({text:r.i18n.get(this.model.get("emptyMessage")),"class":"sf-networth-product-set-empty-chart-message"}))},parseSeries:function(){var e=this.model,n=Math.abs(e.get("amount")),i=e.get("currency");return n?{label:e.get("label"),sublabel:r.unicodeHTMLCodes(r.amount.format(n,!1,i)),series:e.get("sections").map(function(e){var s=e.get("category"),o=e.get("amount"),u=Math.abs(o),a=t({name:s.get("namePluralI18n"),percentage:Math.round(u/n*100),amount:r.unicodeHTMLCodes(r.amount.format(u,!0,i))});return{title:a,value:u,color:"#"+(o>0?s.get("positiveColor"):s.get("negativeColor")),data:e}})}:null}},{defaults:{hideLabels:!0,outerRadiusPercentage:.8}});return i}),define("modules/networth-product-manager/views/networth-product-set-chart-extension",["modules/networth-product-manager/views/networth-product-set-chart","hbs!modules/networth-product-manager/templates/networth-product-category-tooltip","hbs!modules/networth-product-manager/templates/networth-product-manager-empty-message","utils/amount"],function(e,t,n,r){var i=e.extend({parseSeries:function(){var e=this.model,n=Math.abs(e.get("amount")),i=e.get("currency");return n?{label:e.get("label"),sublabel:r.unicodeHTMLCodes(r.amount.format(n,!1,i)),series:e.get("sections").map(function(e){var s=e.get("category"),o=e.get("amount"),u=Math.abs(o),a=Math.round(u/n*100),f=t({name:s.get("namePluralI18n"),percentage:a,amount:r.unicodeHTMLCodes(r.amount.format(u,!0,i))});return{title:f,percentage:a,value:u,color:"#"+(o>0?s.get("positiveColor"):s.get("negativeColor")),data:e}})}:null}});return i}),define("hbs!ui/modules/accordion/templates/accordion",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i,s,o;r+='\n		<li class="sf-accordion-entry-header sf-accordion-cid-'+l((i=(i=e.view,i==null||i===!1?i:i.cid),typeof i===f?i.apply(e):i))+'" data-entry="'+l((i=(i=e.view,i==null||i===!1?i:i.cid),typeof i===f?i.apply(e):i))+'">\n			<div class="sf-accordion-entry-placeholder"></div>\n		</li>\n		<li class="sf-accordion-entry-content sf-accordion-cid-'+l((i=(i=e.view,i==null||i===!1?i:i.cid),typeof i===f?i.apply(e):i))+'">\n			<ul class="sf-accordion-entry-children">\n				',o={hash:{},inverse:c.noop,fn:c.program(2,d,t)},s=(i=n.iter,i?i.call(e,e.children,o):h.call(e,"iter",e.children,o));if(s||s===0)r+=s;return r+="\n			</ul>\n		</li>\n	",r}function d(e,t){var r="",i;return r+='\n				<li class="sf-accordion-entry-child sf-accordion-cid-',(i=n.cid)?i=i.call(e,{hash:{}}):(i=e.cid,i=typeof i===f?i.apply(e):i),r+=l(i)+'"></li>\n				',r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<ul class="sf-accordion">\n	',a={hash:{},inverse:c.noop,fn:c.program(1,p,i)},u=(o=n.iter,o?o.call(t,t,a):h.call(t,"iter",t,a));if(u||u===0)s+=u;return s+="\n</ul>",s});return t.registerPartial("ui_modules_accordion_templates_accordion",n),n}),define("libs/require/css/css!ui/modules/accordion/css/accordion",[],function(){}),define("ui/modules/accordion/accordion-module",["classes/layout","hbs!ui/modules/accordion/templates/accordion","utils/util","css!ui/modules/accordion/css/accordion"],function(e,t,n){var r=e.extend({template:t,events:{"click li.sf-accordion-entry-header":"_clickEntryHeaderHandler"},onRender:function(){this._super();var e=this;this.collection.each(function(t){var r=t.get("view"),i=t.get("children");e.addRegion(r.cid,".sf-accordion-cid-"+r.cid+" .sf-accordion-entry-placeholder"),e[r.cid].show(r),n.each(i,function(t){e.addRegion(t.cid,"li.sf-accordion-cid-"+t.cid),e[t.cid].show(t)})})},serializeData:function(){return this.collection.toJSON()},onShow:function(){this.collection.on("reset",this.render,this)},onClose:function(){this.collection.off("reset",this.render)},_clickEntryHeaderHandler:function(e){var t=this.$(e.currentTarget),n=".sf-accordion-cid-"+t.data("entry");this.$(n).toggleClass("sf-open")}});return r}),define("hbs!modules/networth-product-manager/templates/networth-product-set",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-networth-product-set">\n	<div class="sf-empty sf-networth-product-set-empty-message">\n		',u={hash:{}},s+=f((o=n.t,o?o.call(t,t.emptyMessage,u):a.call(t,"t",t.emptyMessage,u)))+'\n	</div>\n	<div class="sf-product-set-chart"></div>\n	<div class="sf-networth-product-manager-controls">\n		<div class="sf-button-section">\n			<button class="sf-button sf-networth-product-manager-add-product" type="button">\n				<span class="sf-button-icon">\n					<img src="resources/pfm/ui/css/icons/app-icons/dav-plus-red.svg" width="20" height="20" alt="',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-manager.buttons.add",u):a.call(t,"t","networth-product-manager.buttons.add",u)))+'">\n				</span>\n				<span class="sf-button-text">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-manager.buttons.add",u):a.call(t,"t","networth-product-manager.buttons.add",u)))+'</span>\n			</button>\n		</div>\n	</div>\n	<div class="sf-product-set-details"></div>\n</div>',s});return t.registerPartial("modules_networth-product-manager_templates_networth-product-set",n),n}),define("hbs!modules/networth-product-manager/templates/networth-category-extra-payments",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i,s;return r+="\n		",s={hash:{"class":"sf-networth-product-extra-payment-selector",options:e.products,currentOption:e.current}},r+=l((i=n.select,i?i.call(e,s):f.call(e,"select",s)))+"\n		",r}function d(e,t){var r="",i;return r+='\n			<span class="sf-networth-product-extra-payment-selected">\n				',(i=n.currName)?i=i.call(e,{hash:{}}):(i=e.currName,i=typeof i===c?i.apply(e):i),r+=l(i)+"\n			</span>\n		",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function",h=this;s+='<div class="sf-networth-product-extra-payment">\n	<div class="sf-networth-product-extra-payment-selector-box">\n		<span>',a={hash:{}},s+=l((o=n.t,o?o.call(t,"networth-product-manager.extra-payment.before-select",a):f.call(t,"t","networth-product-manager.extra-payment.before-select",a)))+"</span>\n		",u=n["if"].call(t,t.multiple,{hash:{},inverse:h.program(3,d,i),fn:h.program(1,p,i)});if(u||u===0)s+=u;return s+="\n		<span>",a={hash:{}},s+=l((o=n.t,o?o.call(t,"networth-product-manager.extra-payment.after-select",a):f.call(t,"t","networth-product-manager.extra-payment.after-select",a)))+'</span>\n	</div>\n	<form class="sf-networth-product-extra-payment-form sf-form-horizontal">\n		<div class="sf-networth-product-extra-payment-single sf-form-row">\n			',a={hash:{name:"timelyAmount",affix:"currency"}},s+=l((o=n.textfield,o?o.call(t,a):f.call(t,"textfield",a)))+'\n			<span class="">\n				',a={hash:{}},s+=l((o=n.t,o?o.call(t,"networth-product-manager.extra-payment.on-time",a):f.call(t,"t","networth-product-manager.extra-payment.on-time",a)))+"\n			</span>\n			",a={hash:{"class":"",options:t.months,name:"timelyMonth"}},s+=l((o=n.select,o?o.call(t,a):f.call(t,"select",a)))+"\n			",a={hash:{"class":"",options:t.years,name:"timelyYear"}},s+=l((o=n.select,o?o.call(t,a):f.call(t,"select",a)))+'\n		</div>\n		<div class="sf-networth-product-extra-payment-monthly sf-form-row">\n			',a={hash:{name:"monthlyAmount",affix:"currency"}},s+=l((o=n.textfield,o?o.call(t,a):f.call(t,"textfield",a)))+'\n			<span class="">\n				',a={hash:{}},s+=l((o=n.t,o?o.call(t,"networth-product-manager.extra-payment.monthly",a):f.call(t,"t","networth-product-manager.extra-payment.monthly",a)))+'\n			</span>\n		</div>\n		<div class="sf-networth-product-extra-payment-yearly sf-form-row">\n			',a={hash:{name:"yearlyAmount",affix:"currency"}},s+=l((o=n.textfield,o?o.call(t,a):f.call(t,"textfield",a)))+'\n			<span class="">\n				',a={hash:{}},s+=l((o=n.t,o?o.call(t,"networth-product-manager.extra-payment.yearly",a):f.call(t,"t","networth-product-manager.extra-payment.yearly",a)))+"\n			</span>\n			",a={hash:{"class":"",options:t.months,name:"month"}},s+=l((o=n.select,o?o.call(t,a):f.call(t,"select",a)))+'\n		</div>\n\n		<div class="sf-button-controls">\n			',a={hash:{text:'{{t "common.button.cancel"}}',"class":"sf-button-cancel",type:"button"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+"\n			",a={hash:{text:'{{t "common.button.save"}}',type:"button","class":"sf-button-save sf-networth-product-extra-payment-save"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+"\n		</div>\n	<form/>\n</div>",s});return t.registerPartial("modules_networth-product-manager_templates_networth-category-extra-payments",n),n}),define("modules/networth-product-manager/views/networth-category-extra-payments",["classes/item-view","hbs!modules/networth-product-manager/templates/networth-category-extra-payments","ui/modules/reform/select/select-module","utils/i18n","utils/date","utils/mask"],function(e,t,n,r){var i=e.extend({template:t,events:{"submit form.sf-networth-product-extra-payment-form":"_submitHandler","change .sf-networth-product-extra-payment-selector":"_productDisplay"},triggers:{"click .sf-button-cancel":"cancel"},ui:{productSelector:"select.sf-networth-product-extra-payment-selector",repayMonthlyAmount:"[name=monthlyAmount]",repayTimelyAmount:"[name=timelyAmount]",repayYearlyAmount:"[name=yearlyAmount]",repayTimelyDateMonth:"[name=timelyMonth]",repayTimelyDateYear:"[name=timelyYear]",repayYearlyDateMonth:"[name=month]",productForm:"form.sf-networth-product-extra-payment-form"},serializeData:function(){var e=this.model.get("products"),t=[],n=[],i=r.date.parseBackendDate(this.globals.environment.serverDate);for(var s=i.getFullYear();s<this.config.maxFuture;s++)t.push({name:s,value:s});for(s=0;s<12;s++)i.setMonth(s),n.push({value:s,name:r.date.format(i,r.date.constructor.LONG_MONTH)});return{multiple:e.length>1,current:e.first().get("id"),currName:e.first().get("alias"),products:e.map(function(e){return{value:e.get("id"),name:e.get("alias")}}),years:t,months:n}},onRender:function(){this._super(),n.init(this.$el),this._productDisplay()},_productDisplay:function(){var e=this.model.get("products"),t=this.ui.productSelector.val();t!=null?t=e._byId[t]:t=e.first();var n=t.get("repayMonthlyAmount")||0,i=t.get("repayTimelyAmount")||0,s=t.get("repayYearlyAmount")||0,o=t.get("repayTimelyDate"),u=t.get("repayYearlyDate");this.ui.repayMonthlyAmount.val(n),this.ui.repayTimelyAmount.val(i),this.ui.repayYearlyAmount.val(s),o||(o=r.date.parseBackendDate(this.globals.environment.serverDate),o.setMonth(o.getMonth()+1)),this.ui.repayTimelyDateMonth.val(o.getMonth()),this.ui.repayTimelyDateMonth.data("ReForm.Select").update(),this.ui.repayTimelyDateYear.val(o.getFullYear()),this.ui.repayTimelyDateYear.data("ReForm.Select").update(),u||(u=r.date.parseBackendDate(this.globals.environment.serverDate),u.setMonth(u.getMonth()+1)),this.ui.repayYearlyDateMonth.val(u.getMonth()),this.ui.repayYearlyDateMonth.data("ReForm.Select").update()},_submitHandler:function(e){e.stopPropagation(),e.preventDefault();var t=r.serializeForm(this.ui.productForm),n=this,i=this.model.get("products"),s,o=function(e){t[e]||(t[e]=0)};o("timelyAmount"),o("monthlyAmount"),o("yearlyAmount"),i.length>1?s=i._byId[this.ui.productSelector.val()]:s=i.first(),r.mask(this.$el,r.MASK_LOADING),r.when(s.setExtraPayment(t)).done(function(){r.unmask(n.$el),n.trigger("save",s)}).fail(function(e){r.unmask(n.$el),console.error("[NetworthCategoryExtraPayments] Error saving extra payments for product",e,s),n.publish("error",e)})}},{defaults:{maxFuture:2050}});return i}),define("modules/networth-product-manager/views/networth-category-extra-payments-extension",["modules/networth-product-manager/views/networth-category-extra-payments","hbs!modules/networth-product-manager/templates/networth-category-extra-payments","ui/modules/reform/select/select-module","utils/i18n","utils/date","utils/mask"],function(e,t,n,r){var i=e.extend({events:{"click .sf-networth-product-extra-payment-save":"_submitHandler","change .sf-networth-product-extra-payment-selector":"_productDisplay"},_submitHandler:function(e){e.stopPropagation(),e.preventDefault();if(!this.ui.productForm.parsley().validate()||!r.validator.isValid(this.ui.productForm))return;var t=r.serializeForm(this.ui.productForm),n=this,i=this.model.get("products"),s,o=function(e){t[e]||(t[e]=0)};o("timelyAmount"),o("monthlyAmount"),o("yearlyAmount"),i.length>1?s=i._byId[this.ui.productSelector.val()]:s=i.first(),r.mask(this.$el,r.MASK_LOADING),r.when(s.setExtraPayment(t)).done(function(){r.unmask(n.$el),n.trigger("save",s)}).fail(function(e){r.unmask(n.$el),console.error("[NetworthCategoryExtraPayments] Error saving extra payments for product",e,s),n.publish("error",e)})}},{defaults:{maxFuture:2050}});return i}),define("hbs!modules/networth-product-manager/templates/networth-category",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){var r="",i;r+="\n		",i=n["if"].call(e,e.asset,{hash:{},inverse:l.program(4,p,t),fn:l.program(2,h,t)});if(i||i===0)r+=i;return r+="\n	",r}function h(e,t){var r="",i,s,o;return r+='\n			<div class="sf-networth-asset">\n				<div class="sf-networth-asset-view">\n				',o={hash:{"class":"sf-networth-category-change-percentage",type:"button",text:"networth-product-manager.buttons.category-change-percentage"}},r+=a((i=n.button,i?i.call(e,o):u.call(e,"button",o)))+'\n				<span class="sf-networth-category-pct-projection">',(s=n.pctProjection)?s=s.call(e,{hash:{}}):(s=e.pctProjection,s=typeof s===f?s.apply(e):s),r+=a(s)+' %</span>\n				</div>\n				<div class="sf-networth-asset-edit sf-hidden">\n					<div class="sf-textfield-append sf-networth-asset-edit-input">\n						<input type="text" class="sf-networth-category-pct-projection" name="pctProjection" maxlength="3" value="',(s=n.pctProjection)?s=s.call(e,{hash:{}}):(s=e.pctProjection,s=typeof s===f?s.apply(e):s),r+=a(s)+'"/>\n						<span class="sf-add-on">%</span>\n					</div>\n\n				',o={hash:{"class":"sf-networth-category-change-percentage-save",type:"button",text:"networth-product-manager.buttons.category-change-percentage-save"}},r+=a((i=n.button,i?i.call(e,o):u.call(e,"button",o)))+"\n\n				</div>\n			</div>\n		",r}function p(e,t){var r="",i,s;return r+='\n			<div class="sf-networth-liability">\n				',s={hash:{"class":"sf-networth-category-extra-payment",type:"button",text:"networth-product-manager.buttons.category-extra-payment"}},r+=a((i=n.button,i?i.call(e,s):u.call(e,"button",s)))+"\n			</div>\n		",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u=n.helperMissing,a=this.escapeExpression,f="function",l=this;s+='<div class="sf-networth-category">\n	<div class="sf-networth-category-color" style="background-color: ',(o=n.catColor)?o=o.call(t,{hash:{}}):(o=t.catColor,o=typeof o===f?o.apply(t):o),s+=a(o)+'"></div>\n\n	<a class="sf-networth-category-alias">',(o=n.name)?o=o.call(t,{hash:{}}):(o=t.name,o=typeof o===f?o.apply(t):o),s+=a(o)+'</a>\n	<span class="sf-product-opener">\n		<span class="sf-product-opener-icon sf-product-opener-open">\n			<img class="icon-plus" src="resources/pfm/ui/css/icons/app-icons/dav-networth-plus.svg" width="20" height="20">\n			<img class="icon-minus" src="resources/pfm/ui/css/icons/app-icons/dav-networth-minus.svg" width="20" height="20">\n		</span>\n	</span>\n	<div class="sf-netowrth-category-amount sf-number">\n		',(o=n.amount)?o=o.call(t,{hash:{}}):(o=t.amount,o=typeof o===f?o.apply(t):o);if(o||o===0)s+=o;s+="\n	</div>\n	",o=n["if"].call(t,t.projection,{hash:{},inverse:l.noop,fn:l.program(1,c,i)});if(o||o===0)s+=o;return s+="\n\n</div>",s});return t.registerPartial("modules_networth-product-manager_templates_networth-category",n),n}),define("modules/networth-product-manager/views/networth-category",["classes/item-view","ui/modules/popup/popup-module","modules/networth-product-manager/views/networth-category-extra-payments","hbs!modules/networth-product-manager/templates/networth-category","utils/i18n",""],function(e,t,n,r,i){var s=e.extend({filtersList:["networthPeriod","projectionRange"],template:r,events:{"click button.sf-networth-category-change-percentage":"_editClickHandler","click button.sf-networth-category-change-percentage-save":"_saveClickHandler","click button.sf-networth-category-extra-payment":"_extraPaymentClickHandler","click .sf-networth-asset-edit-input":"_clickInputHandler"},ui:{assetView:".sf-networth-asset",liabilityView:".sf-networth-liability",pctProjection:"input.sf-networth-category-pct-projection"},serializeData:function(){var e=this.model.get("category"),t=i.amount.format(Math.abs(this.model.get("amount")),this.config.showDecimals,this.model.get("currency"));return{projection:this.filters.networthPeriod=="future",name:e.get("namePluralI18n"),amount:t,pctProjection:this.model.get("pctProjection"),asset:this.model.get("asset")}},_clickInputHandler:function(e){e.stopPropagation()},_editClickHandler:function(e){e.stopPropagation(),this.ui.assetView.children().toggleClass("sf-hidden")},_saveClickHandler:function(e){e.stopPropagation();var t=this.ui.pctProjection.val(),n=this;t!=this.model.get("pctProjection")?(i.mask(n.$el,i.MASK_LOADING),i.when(n.model.setAmortiguation(t,this.filters.projectionRange)).fail(function(e){console.error("[NetworthCategory] Failed to save amortiguation percentage",e),i.unmask(n.$el),n.publish("error",e)})):n.ui.assetView.children().toggleClass("sf-hidden")},_extraPaymentClickHandler:function(e){e.stopPropagation();var r=new n(i.merge({},this.contextConfig,{model:this.model})),s=function(){u.remove()},o={$container:this.options.$popupContainer,$opener:this.$(e.currentTarget),title:i.i18n.get("networth-product-manager.popup.extra-payment-title"),closeCallback:s},u=new t(o);r.once("save",s),r.once("cancel",s),u.contentRegion.once("show",function(){u.open()}),u.contentRegion.show(r)}},{defaults:{showDecimals:!0}});return s}),define("modules/networth-product-manager/views/networth-category-extension",["modules/networth-product-manager/views/networth-category","ui/modules/popup/popup-module","modules/networth-product-manager/views/networth-category-extra-payments","hbs!modules/networth-product-manager/templates/networth-category","utils/i18n",""],function(e,t,n,r,i){var s=e.extend({serializeData:function(){var e=this.model.get("category"),t=i.amount.format(Math.abs(this.model.get("amount")),this.config.showDecimals,this.model.get("currency")),n=e.get("asset")?e.get("positiveColor"):e.get("negativeColor");return{projection:this.filters.networthPeriod=="future",name:e.get("namePluralI18n"),amount:t,pctProjection:this.model.get("pctProjection"),asset:this.model.get("asset"),catColor:"#"+n}}});return s}),define("hbs!modules/networth-product-manager/templates/networth-product",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){return" sf-fix-amount-left"}function h(e,t){var r="",i;r+="\n    ",i=n.unless.call(e,e.projection,{hash:{},inverse:f.noop,fn:f.program(4,p,t)});if(i||i===0)r+=i;return r+="\n    ",r}function p(e,t){var r="",i,s;return r+='\n    <span class="sf-networth-product-delete" title="',s={hash:{}},r+=a((i=n.t,i?i.call(e,"networth-product-manager.products.delete",s):u.call(e,"t","networth-product-manager.products.delete",s)))+'"><img src="resources/pfm/ui/css/icons/app-icons/dav-networth-trash-can.svg" alt="',s={hash:{}},r+=a((i=n.t,i?i.call(e,"networth-product-manager.products.delete",s):u.call(e,"t","networth-product-manager.products.delete",s)))+'" height="20"></span>\n	<span class="sf-networth-product-update"><img src="resources/pfm/ui/css/icons/app-icons/dav-networth-edit.svg" height="20"></span>\n    ',r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u=n.helperMissing,a=this.escapeExpression,f=this,l="function";s+='<div class="sf-networth-product ',o=n["if"].call(t,t.fixAmountLeft,{hash:{},inverse:f.noop,fn:f.program(1,c,i)});if(o||o===0)s+=o;s+='">\n    ',o=n.unless.call(t,t.linked,{hash:{},inverse:f.noop,fn:f.program(3,h,i)});if(o||o===0)s+=o;s+='\n    <span class="sf-networth-product-alias " title="',(o=n.title)?o=o.call(t,{hash:{}}):(o=t.title,o=typeof o===l?o.apply(t):o),s+=a(o)+'">',(o=n.alias)?o=o.call(t,{hash:{}}):(o=t.alias,o=typeof o===l?o.apply(t):o),s+=a(o)+'</span>\n	<div class="sf-networth-product-amount sf-number">\n		',(o=n.amount)?o=o.call(t,{hash:{}}):(o=t.amount,o=typeof o===l?o.apply(t):o);if(o||o===0)s+=o;return s+="\n	</div>\n\n</div>\n",s});return t.registerPartial("modules_networth-product-manager_templates_networth-product",n),n}),define("hbs!modules/networth-product-editor/templates/networth-product-form",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-networth-product-form-wrapper">\n<form class="sf-networth-product-form sf-form-horizontal" data-validate="parsley">\n	<div class="sf-networth-product-partial"></div>\n	<hr/>\n	<div class="sf-button-controls">\n		',u={hash:{text:'{{t "common.button.save"}}',type:"button","class":"sf-button-save sf-networth-product-submit"}},s+=f((o=n.button,o?o.call(t,u):a.call(t,"button",u)))+"\n		",u={hash:{text:'{{t "common.button.cancel"}}',"class":"sf-button-cancel",type:"button"}},s+=f((o=n.button,o?o.call(t,u):a.call(t,"button",u)))+"\n	</div>\n</form>\n</div>\n",s});return t.registerPartial("modules_networth-product-editor_templates_networth-product-form",n),n}),define("hbs!modules/networth-product-editor/templates/partials/property",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function";return s+='<div class="sf-form-row  sf-row-alias">\n	<label for="alias">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"networth-product-editor.property.alias",a):f.call(t,"t","networth-product-editor.property.alias",a)))+"</label>\n	",a={hash:{name:"alias",value:t.alias,validateField:"{{ ruleSet }}.alias"}},s+=l((o=n.textfield,o?o.call(t,a):f.call(t,"textfield",a)))+'\n</div>\n<div class="sf-form-row sf-initial-value-row">\n	<label for="initialValue">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"networth-product-editor.property.initialValue",a):f.call(t,"t","networth-product-editor.property.initialValue",a)))+"</label>\n	",a={hash:{name:"initialValue",value:t.initialValue,affix:"currency",validateField:"{{ ruleSet }}.initialValue"}},s+=l((o=n.textfield,o?o.call(t,a):f.call(t,"textfield",a)))+'\n</div>\n<div class="sf-form-row sf-initial-value-row sf-initial-datepicker">\n<label for="initialValueDate">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"networth-product-editor.property.initialValueDate",a):f.call(t,"t","networth-product-editor.property.initialValueDate",a)))+"</label>\n	",a={hash:{dataValue:t.initialValueDate,dataFormat:t.dateFormat,dataFormatSubmit:t.dateSubmitFormat,name:"initialValue","class":"sf-networth-product-initial-date"}},s+=l((o=n.datepicker,o?o.call(t,a):f.call(t,"datepicker",a)))+'\n</div>\n<div class="sf-form-row">\n	<label>',a={hash:{}},s+=l((o=n.t,o?o.call(t,"networth-product-editor.property.accountBalance",a):f.call(t,"t","networth-product-editor.property.accountBalance",a)))+'</label>\n	<div class="sf-networth-product-balances-placeholder"></div>\n</div>\n<input type="hidden" name="productTypeId" value="',(u=n.productTypeId)?u=u.call(t,{hash:{}}):(u=t.productTypeId,u=typeof u===c?u.apply(t):u),s+=l(u)+'">',s});return t.registerPartial("modules_networth-product-editor_templates_partials_property",n),n}),define("hbs!modules/networth-product-editor/templates/partials/investment-account",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-form-row  sf-row-alias">\n	<label for="alias">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.investment-account.alias",u):a.call(t,"t","networth-product-editor.investment-account.alias",u)))+"</label>\n	",u={hash:{name:"alias",value:t.alias,validateField:"{{ ruleSet }}.alias"}},s+=f((o=n.textfield,o?o.call(t,u):a.call(t,"textfield",u)))+'\n</div>\n<div class="sf-form-row">\n	<label for="productTypeId">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.investment-account.productTypeId",u):a.call(t,"t","networth-product-editor.investment-account.productTypeId",u)))+"</label>\n	",u={hash:{name:"productTypeId",options:t.productTypes,currentOption:t.productTypeId}},s+=f((o=n.select,o?o.call(t,u):a.call(t,"select",u)))+'\n</div>\n<div class="sf-form-row sf-initial-value-row">\n<label for="expirationDateDate">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.investment-account.expirationDate",u):a.call(t,"t","networth-product-editor.investment-account.expirationDate",u)))+"</label>\n	",u={hash:{dataValue:t.initialValueDate,dataFormat:t.dateFormat,dataFormatSubmit:t.dateSubmitFormat,name:"initialValue","class":"sf-networth-product-initial-date"}},s+=f((o=n.datepicker,o?o.call(t,u):a.call(t,"datepicker",u)))+'\n</div>\n<div class="sf-form-row">\n	<label>',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.investment-account.accountBalance",u):a.call(t,"t","networth-product-editor.investment-account.accountBalance",u)))+'</label>\n	<div class="sf-networth-product-balances-placeholder"></div>\n</div>\n',s});return t.registerPartial("modules_networth-product-editor_templates_partials_investment-account",n),n}),define("hbs!modules/networth-product-editor/templates/partials/savings-account",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function";return s+='<div class="sf-form-row  sf-row-alias" data-validate="parsley">\n	<label for="alias">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"networth-product-editor.savings-account.alias",a):f.call(t,"t","networth-product-editor.savings-account.alias",a)))+"</label>\n	",a={hash:{name:"alias",value:t.alias,validateField:"{{ ruleSet }}.alias"}},s+=l((o=n.textfield,o?o.call(t,a):f.call(t,"textfield",a)))+'\n</div>\n<div class="sf-form-row">\n	<label>',a={hash:{}},s+=l((o=n.t,o?o.call(t,"networth-product-editor.savings-account.accountBalance",a):f.call(t,"t","networth-product-editor.savings-account.accountBalance",a)))+'</label>\n	<div class="sf-networth-product-balances-placeholder"></div>\n</div>\n<input type="hidden" name="productTypeId" value="',(u=n.productTypeId)?u=u.call(t,{hash:{}}):(u=t.productTypeId,u=typeof u===c?u.apply(t):u),s+=l(u)+'"/>',s});return t.registerPartial("modules_networth-product-editor_templates_partials_savings-account",n),n}),define("hbs!modules/networth-product-editor/templates/partials/retirement-account",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-form-row  sf-row-alias">\n	<label for="alias">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.retirement-account.alias",u):a.call(t,"t","networth-product-editor.retirement-account.alias",u)))+"</label>\n	",u={hash:{name:"alias",value:t.alias,validateField:"{{ ruleSet }}.alias"}},s+=f((o=n.textfield,o?o.call(t,u):a.call(t,"textfield",u)))+'\n</div>\n<div class="sf-form-row">\n	<label for="accNumber">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.retirement-account.accNumber",u):a.call(t,"t","networth-product-editor.retirement-account.accNumber",u)))+"</label>\n	",u={hash:{name:"accNumber",value:t.externalId,validateField:"{{ ruleSet }}.accNumber"}},s+=f((o=n.textfield,o?o.call(t,u):a.call(t,"textfield",u)))+'\n</div>\n<div class="sf-form-row">\n	<label for="productTypeId">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.retirement-account.productTypeId",u):a.call(t,"t","networth-product-editor.retirement-account.productTypeId",u)))+"</label>\n	",u={hash:{name:"productTypeId",options:t.productTypes,currentOption:t.productTypeId}},s+=f((o=n.select,o?o.call(t,u):a.call(t,"select",u)))+'\n</div>\n<div class="sf-form-row">\n	<label>',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.retirement-account.accountBalance",u):a.call(t,"t","networth-product-editor.retirement-account.accountBalance",u)))+'</label>\n	<div class="sf-networth-product-balances-placeholder"></div>\n</div>',s});return t.registerPartial("modules_networth-product-editor_templates_partials_retirement-account",n),n}),define("hbs!modules/networth-product-editor/templates/partials/checking-account",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function";return s+='<div class="sf-form-row  sf-row-alias">\n	<label for="alias">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"networth-product-editor.checking-account.alias",a):f.call(t,"t","networth-product-editor.checking-account.alias",a)))+"</label>\n	",a={hash:{name:"alias",value:t.alias,validateField:"{{ ruleSet }}.alias"}},s+=l((o=n.textfield,o?o.call(t,a):f.call(t,"textfield",a)))+'\n</div>\n<div class="sf-form-row">\n	<label>',a={hash:{}},s+=l((o=n.t,o?o.call(t,"networth-product-editor.checking-account.accountBalance",a):f.call(t,"t","networth-product-editor.checking-account.accountBalance",a)))+'</label>\n	<div class="sf-networth-product-balances-placeholder"></div>\n</div>\n<input type="hidden" name="productTypeId" value="',(u=n.productTypeId)?u=u.call(t,{hash:{}}):(u=t.productTypeId,u=typeof u===c?u.apply(t):u),s+=l(u)+'">',s});return t.registerPartial("modules_networth-product-editor_templates_partials_checking-account",n),n}),define("hbs!modules/networth-product-editor/templates/partials/thing-i-own",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='\n\n<div class="sf-form-row  sf-row-alias">\n	<label for="productTypeId">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.luxury-good.productTypeId",u):a.call(t,"t","networth-product-editor.luxury-good.productTypeId",u)))+"</label>\n	",u={hash:{name:"productTypeId",options:t.productTypes,currentOption:t.productTypeId}},s+=f((o=n.select,o?o.call(t,u):a.call(t,"select",u)))+'\n</div>\n\n<div class="sf-form-row">\n	<label for="alias">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.luxury-good.alias",u):a.call(t,"t","networth-product-editor.luxury-good.alias",u)))+"</label>\n	",u={hash:{name:"alias",value:t.alias,validateField:"{{ ruleSet }}.alias"}},s+=f((o=n.textfield,o?o.call(t,u):a.call(t,"textfield",u)))+'\n</div>\n\n<div class="sf-form-row sf-initial-value-row">\n	<label for="initialValue">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.luxury-good.initialValue",u):a.call(t,"t","networth-product-editor.luxury-good.initialValue",u)))+"</label>\n	",u={hash:{name:"initialValue",value:t.initialValue,affix:"currency",validateField:"{{ ruleSet }}.initialValue"}},s+=f((o=n.textfield,o?o.call(t,u):a.call(t,"textfield",u)))+'\n</div>\n\n<div class="sf-form-row sf-initial-value-row sf-initial-datepicker">\n	<label for="initialValueDate">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.luxury-good.initialValueDate",u):a.call(t,"t","networth-product-editor.luxury-good.initialValueDate",u)))+"</label>\n	",u={hash:{dataValue:t.initialValueDate,dataFormat:t.dateFormat,dataFormatSubmit:t.dateSubmitFormat,name:"initialValue","class":"sf-networth-product-initial-date"}},s+=f((o=n.datepicker,o?o.call(t,u):a.call(t,"datepicker",u)))+'\n</div>\n\n<div class="sf-form-row">\n	<label>',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.luxury-good.accountBalance",u):a.call(t,"t","networth-product-editor.luxury-good.accountBalance",u)))+'</label>\n	<div class="sf-networth-product-balances-placeholder"></div>\n</div>',s});return t.registerPartial("modules_networth-product-editor_templates_partials_thing-i-own",n),n}),define("hbs!modules/networth-product-editor/templates/partials/miscellaneous",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-form-row">\n	<label for="alias">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.miscellaneous.alias",u):a.call(t,"t","networth-product-editor.miscellaneous.alias",u)))+"</label>\n	",u={hash:{name:"alias",value:t.alias,validateField:"{{ ruleSet }}.alias"}},s+=f((o=n.textfield,o?o.call(t,u):a.call(t,"textfield",u)))+'\n</div>\n\n<div class="sf-form-row">\n	<label for="productTypeId">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.miscellaneous.productTypeId",u):a.call(t,"t","networth-product-editor.miscellaneous.productTypeId",u)))+"</label>\n	",u={hash:{name:"productTypeId",options:t.productTypes,currentOption:t.productTypeId}},s+=f((o=n.select,o?o.call(t,u):a.call(t,"select",u)))+'\n</div>\n\n<div class="sf-form-row">\n<label for="expirationDateDate">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.miscellaneous.expirationDate",u):a.call(t,"t","networth-product-editor.miscellaneous.expirationDate",u)))+"</label>\n",u={hash:{options:t.months,currentOption:t.expirationDateMonth,name:"expirationDateMonth"}},s+=f((o=n.select,o?o.call(t,u):a.call(t,"select",u)))+"\n",u={hash:{options:t.futureYears,currentOption:t.expirationDateYear,name:"expirationDateYear"}},s+=f((o=n.select,o?o.call(t,u):a.call(t,"select",u)))+'\n</div>\n\n<div class="sf-form-row">\n	<label>',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.miscellaneous.accountBalance",u):a.call(t,"t","networth-product-editor.miscellaneous.accountBalance",u)))+'</label>\n	<div class="sf-networth-product-balances-placeholder"></div>\n</div>',s});return t.registerPartial("modules_networth-product-editor_templates_partials_miscellaneous",n),n}),define("hbs!modules/networth-product-editor/templates/partials/mortgage",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-form-row  sf-row-alias">\n	<label for="alias">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.mortage.alias",u):a.call(t,"t","networth-product-editor.mortage.alias",u)))+"</label>\n	",u={hash:{name:"alias",value:t.alias,validateField:"{{ ruleSet }}.alias"}},s+=f((o=n.textfield,o?o.call(t,u):a.call(t,"textfield",u)))+'\n</div>\n\n<div class="sf-form-row">\n	<label for="productTypeId">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.mortage.productTypeId",u):a.call(t,"t","networth-product-editor.mortage.productTypeId",u)))+"</label>\n	",u={hash:{name:"productTypeId",options:t.productTypes,currentOption:t.productTypeId}},s+=f((o=n.select,o?o.call(t,u):a.call(t,"select",u)))+'\n</div>\n\n<div class="sf-form-row sf-initial-value-row">\n	<label for="initialValue">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.mortage.initialValue",u):a.call(t,"t","networth-product-editor.mortage.initialValue",u)))+"</label>\n	",u={hash:{name:"initialValue",value:t.initialValue,affix:"currency",validateField:"{{ ruleSet }}.initialValue"}},s+=f((o=n.textfield,o?o.call(t,u):a.call(t,"textfield",u)))+'\n</div>\n\n<div class="sf-form-row">\n	<label for="monthTerms">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.mortage.monthTerms",u):a.call(t,"t","networth-product-editor.mortage.monthTerms",u)))+"</label>\n	",u={hash:{name:"monthTerms",value:t.monthTerms,validateField:"{{ ruleSet }}.monthTerms"}},s+=f((o=n.textfield,o?o.call(t,u):a.call(t,"textfield",u)))+"\n	<span>",u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.mortage.monthTermsUnit",u):a.call(t,"t","networth-product-editor.mortage.monthTermsUnit",u)))+'</span>\n</div>\n\n<div class="sf-form-row">\n<label for="pctAdjustment">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.mortage.pctAdjustment",u):a.call(t,"t","networth-product-editor.mortage.pctAdjustment",u)))+"</label>\n",u={hash:{name:"pctAdjustment",value:t.pctAdjustment,suffix:"%",validateField:"{{ ruleSet }}.pctAdjustment"}},s+=f((o=n.textfield,o?o.call(t,u):a.call(t,"textfield",u)))+'\n</div>\n\n<div class="sf-form-row sf-initial-value-row sf-initial-datepicker">\n	<label for="initialValueDate">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.mortage.initialValueDate",u):a.call(t,"t","networth-product-editor.mortage.initialValueDate",u)))+"</label>\n	",u={hash:{dataValue:t.initialValueDate,dataFormat:t.dateFormat,dataFormatSubmit:t.dateSubmitFormat,name:"initialValue","class":"sf-networth-product-initial-date"}},s+=f((o=n.datepicker,o?o.call(t,u):a.call(t,"datepicker",u)))+'\n</div>\n\n<div class="sf-form-row">\n	<label>',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.mortage.accountBalance",u):a.call(t,"t","networth-product-editor.mortage.accountBalance",u)))+'</label>\n	<div class="sf-networth-product-balances-placeholder"></div>\n</div>',s});return t.registerPartial("modules_networth-product-editor_templates_partials_mortgage",n),n}),define("hbs!modules/networth-product-editor/templates/partials/loan",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-form-row  sf-row-alias">\n	<label for="alias">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.loan.alias",u):a.call(t,"t","networth-product-editor.loan.alias",u)))+"</label>\n	",u={hash:{name:"alias",value:t.alias,validateField:"{{ ruleSet }}.alias"}},s+=f((o=n.textfield,o?o.call(t,u):a.call(t,"textfield",u)))+'\n</div>\n\n<div class="sf-form-row">\n	<label for="productTypeId">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.loan.productTypeId",u):a.call(t,"t","networth-product-editor.loan.productTypeId",u)))+"</label>\n	",u={hash:{name:"productTypeId",options:t.productTypes,currentOption:t.productTypeId}},s+=f((o=n.select,o?o.call(t,u):a.call(t,"select",u)))+'\n</div>\n\n<div class="sf-form-row sf-initial-value-row">\n	<label for="initialValue">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.loan.initialValue",u):a.call(t,"t","networth-product-editor.loan.initialValue",u)))+"</label>\n	",u={hash:{name:"initialValue",value:t.initialValue,affix:"currency",validateField:"{{ ruleSet }}.initialValue"}},s+=f((o=n.textfield,o?o.call(t,u):a.call(t,"textfield",u)))+'\n</div>\n\n<div class="sf-form-row sf-initial-value-row sf-initial-datepicker">\n	<label for="initialValueDate">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.loan.initialValueDate",u):a.call(t,"t","networth-product-editor.loan.initialValueDate",u)))+"</label>\n	",u={hash:{dataValue:t.initialValueDate,dataFormat:t.dateFormat,dataFormatSubmit:t.dateSubmitFormat,name:"initialValue","class":"sf-networth-product-initial-date"}},s+=f((o=n.datepicker,o?o.call(t,u):a.call(t,"datepicker",u)))+'\n</div>\n\n<div class="sf-form-row">\n	<label>',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.loan.accountBalance",u):a.call(t,"t","networth-product-editor.loan.accountBalance",u)))+'</label>\n	<div class="sf-networth-product-balances-placeholder"></div>\n</div>',s});return t.registerPartial("modules_networth-product-editor_templates_partials_loan",n),n}),define("hbs!modules/networth-product-editor/templates/partials/credit-card",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-form-row  sf-row-alias">\n	<label for="alias">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.credit-card.alias",u):a.call(t,"t","networth-product-editor.credit-card.alias",u)))+"</label>\n	",u={hash:{name:"alias",value:t.alias,validateField:"{{ ruleSet }}.alias"}},s+=f((o=n.textfield,o?o.call(t,u):a.call(t,"textfield",u)))+'\n</div>\n\n<div class="sf-form-row">\n	<label for="productTypeId">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.credit-card.productTypeId",u):a.call(t,"t","networth-product-editor.credit-card.productTypeId",u)))+"</label>\n	",u={hash:{name:"productTypeId",options:t.productTypes,currentOption:t.productTypeId}},s+=f((o=n.select,o?o.call(t,u):a.call(t,"select",u)))+'\n</div>\n\n<div class="sf-form-row sf-initial-value-row">\n	<label for="initialValue">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.credit-card.initialValue",u):a.call(t,"t","networth-product-editor.credit-card.initialValue",u)))+"</label>\n	",u={hash:{name:"initialValue",value:t.initialValue,affix:"currency",validateField:"{{ ruleSet }}.initialValue"}},s+=f((o=n.textfield,o?o.call(t,u):a.call(t,"textfield",u)))+'\n</div>\n\n\n<div class="sf-form-row sf-initial-value-row sf-initial-datepicker">\n	<label for="initialValueDate">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.credit-card.initialValueDate",u):a.call(t,"t","networth-product-editor.credit-card.initialValueDate",u)))+"</label>\n	",u={hash:{dataValue:t.initialValueDate,dataFormat:t.dateFormat,dataFormatSubmit:t.dateSubmitFormat,name:"initialValue","class":"sf-networth-product-initial-date"}},s+=f((o=n.datepicker,o?o.call(t,u):a.call(t,"datepicker",u)))+'\n</div>\n\n<div class="sf-form-row">\n	<label>',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.credit-card.accountBalance",u):a.call(t,"t","networth-product-editor.credit-card.accountBalance",u)))+'</label>\n	<div class="sf-networth-product-balances-placeholder"></div>\n</div>',s});return t.registerPartial("modules_networth-product-editor_templates_partials_credit-card",n),n}),define("hbs!modules/networth-product-editor/templates/partials/debt",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-form-row  sf-row-alias">\n	<label for="alias">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.debt.alias",u):a.call(t,"t","networth-product-editor.debt.alias",u)))+"</label>\n	",u={hash:{name:"alias",value:t.alias,validateField:"{{ ruleSet }}.alias"}},s+=f((o=n.textfield,o?o.call(t,u):a.call(t,"textfield",u)))+'\n</div>\n\n<div class="sf-form-row" style="display: none;">\n	<label for="productTypeId">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.debt.productTypeId",u):a.call(t,"t","networth-product-editor.debt.productTypeId",u)))+"</label>\n	",u={hash:{name:"productTypeId",options:t.productTypes,currentOption:t.productTypeId}},s+=f((o=n.select,o?o.call(t,u):a.call(t,"select",u)))+'\n</div>\n\n<div class="sf-form-row sf-initial-value-row">\n	<label for="initialValue">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.debt.initialValue",u):a.call(t,"t","networth-product-editor.debt.initialValue",u)))+"</label>\n	",u={hash:{name:"initialValue",value:t.initialValue,affix:"currency",validateField:"{{ ruleSet }}.initialValue"}},s+=f((o=n.textfield,o?o.call(t,u):a.call(t,"textfield",u)))+'\n</div>\n\n<div class="sf-form-row sf-initial-value-row sf-initial-datepicker">\n	<label for="initialValueDate">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.debt.initialValueDate",u):a.call(t,"t","networth-product-editor.debt.initialValueDate",u)))+"</label>\n	",u={hash:{dataValue:t.initialValueDate,dataFormat:t.dateFormat,dataFormatSubmit:t.dateSubmitFormat,name:"initialValue","class":"sf-networth-product-initial-date"}},s+=f((o=n.datepicker,o?o.call(t,u):a.call(t,"datepicker",u)))+'\n</div>\n\n<div class="sf-form-row">\n	<label>',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.debt.accountBalance",u):a.call(t,"t","networth-product-editor.debt.accountBalance",u)))+'</label>\n	<div class="sf-networth-product-balances-placeholder"></div>\n</div>',s});return t.registerPartial("modules_networth-product-editor_templates_partials_debt",n),n}),define("hbs!modules/networth-product-editor/templates/networth-product-balance",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-networth-product-balance">\n<ul class="sf-networth-balances-list"></ul>\n	<button class="sf-button sf-networth-product-balance-add" tabindex="0" type="button">\n		<span class="sf-button-icon">\n			<img src="resources/pfm/ui/css/icons/app-icons/dav-plus-red.svg" width="20" height="20" alt="',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.balance.add",u):a.call(t,"t","networth-product-editor.balance.add",u)))+'">\n		</span>\n		<span class="sf-button-text">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.balance.add",u):a.call(t,"t","networth-product-editor.balance.add",u)))+"</span>\n	</button>\n</div>\n",s});return t.registerPartial("modules_networth-product-editor_templates_networth-product-balance",n),n}),define("hbs!modules/networth-product-editor/templates/networth-product-balance-row",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function h(e,t){return'\n		<button class="sf-button sf-button-delete" type="button">\n			<span class="sf-button-icon">\n				<img src="resources/pfm/ui/css/icons/app-icons/dav-details-trash-can.svg">\n			</span>\n		</button>\n    '}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c=this;s+='<li class="sf-networth-balance-entry sf-form-row">\n	',a={hash:{value:t.amount,"class":"sf-networth-product-balance-amount",affix:"currency",multiSign:!0,name:"balanceAmount-{{cid}}",validateField:"{{ ruleSet }}.balanceAmount"}},s+=l((o=n.textfield,o?o.call(t,a):f.call(t,"textfield",a)))+'\n	<span class="sf-a-separator">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"networth-product-editor.balance.separator",a):f.call(t,"t","networth-product-editor.balance.separator",a)))+"</span>\n	",a={hash:{dataValue:t.updateDate,dataFormat:t.dateFormat,dataFormatSubmit:t.dateSubmitFormat,name:"balanceUpdateDate-{{cid}}","class":"sf-networth-product-balance-updateDate"}},s+=l((o=n.datepicker,o?o.call(t,a):f.call(t,"datepicker",a)))+"\n    ",u=n.unless.call(t,t.required,{hash:{},inverse:c.noop,fn:c.program(1,h,i)});if(u||u===0)s+=u;return s+="\n</li>\n",s});return t.registerPartial("modules_networth-product-editor_templates_networth-product-balance-row",n),n}),define("modules/networth-product-editor/views/networth-product-balance-row",["classes/item-view","hbs!modules/networth-product-editor/templates/networth-product-balance-row","ui/modules/reform/datepicker/datepicker-module","utils/date"],function(e,t,n,r){var i=e.extend({template:t,events:{"click .sf-button-delete":"_removeRow"},ui:{amount:".sf-networth-product-balance-amount",updateDate:".sf-networth-product-balance-updateDate"},serializeData:function(){var e=this.model.get("amount");return this.options.absValue&&(e=Math.abs(e)),{dateFormat:r.date.getDatepickerFormat(this.config.updateDateFormat),amount:e,updateDate:r.date.formatBackendDate(this.model.get("updateDate")),dateSubmitFormat:r.date.getDatepickerFormat(this.config.datepickerBackendFormat),cid:this.model.cid,ruleSet:this.options.ruleSet,required:this.options.required}},onRender:function(){this._super(),n.init(this.$el);var e=this.ui.updateDate.pickadate("picker");e.set("max",r.date.today()),e.set("min",this.options.parent.options.minDate),e.on("open",function(){var t=e.$node.height()+e.$node.position().top;e.$root.css("top",t+"px")})},_removeRow:function(){var e=function(){r.validator.removeItem(this.$el.parents("form").eq(0),this.ui.amount),r.validator.removeItem(this.$el.parents("form").eq(0),this.ui.updateDate),this.model.collection.remove(this.model),this.close()}.bind(this);if(this.model.get("id")){var t=this.$el.closest(".sf-popup");r.mask(t,r.MASK_LOADING),r.when(this.model.destroy()).done(e).fail(function(e){this.publish("error",e)}.bind(this)).always(function(){r.unmask(t)}.bind(this))}else e()}});return i}),define("modules/networth-product-editor/views/networth-product-balance-row-extension",["modules/networth-product-editor/views/networth-product-balance-row","hbs!modules/networth-product-editor/templates/networth-product-balance-row","ui/modules/reform/datepicker/datepicker-module","utils/date"],function(e,t,n,r){var i=e.extend({serializeData:function(){var e=this.model.get("amount");return this.options.absValue&&(e=Math.abs(e)),{dateFormat:r.date.getDatepickerFormat("dd / MM / yyyy"),amount:e,updateDate:r.date.formatBackendDate(this.model.get("updateDate")),dateSubmitFormat:r.date.getDatepickerFormat(this.config.datepickerBackendFormat),cid:this.model.cid,ruleSet:this.options.ruleSet,required:this.options.required}}});return i}),define("modules/networth-product-editor/views/networth-product-balance",["classes/item-view","classes/model","classes/collection","hbs!modules/networth-product-editor/templates/networth-product-balance","modules/networth-product-editor/views/networth-product-balance-row","utils/i18n","utils/date"],function(e,t,n,r,i,s){var o=e.extend({template:r,events:{"click .sf-networth-product-balance-add":"_addRow"},ui:{list:".sf-networth-balances-list"},initialize:function(e){this._super(e),this._today=s.date.today(),this.collection.on("add",this._attachRow,this)},onClose:function(){this.collection.off("add",this._attachRow)},serializeData:function(){return{}},onRender:function(){this._super();var e=this.options.productId===undefined;this.collection.length||this.collection.push({amount:0,updateDate:this._today},{silent:!0}),this.collection.each(function(t,n){var r=new i(s.merge({},this.contextConfig,{model:t,ruleSet:this.options.ruleSet,absValue:this.options.absValue,required:e&&n===0}));r.render(),n===0&&!e&&r.$el.addClass("sf-hidden"),this.ui.list.append(r.el)},this)},updateMinDate:function(e){this.options.minDate=e;var t=this;this.ui.list.find(".sf-datepicker").each(function(){var n=t.$(this).pickadate("picker"),r=n.get("select");n.set("min",e),e>r.obj&&n.set("select",e)})},_addRow:function(){this.collection.push({amount:0,updateDate:this._today})},_attachRow:function(e){var t=new i(s.merge({},this.contextConfig,{model:e}));t.render(),this.ui.list.append(t.el),this.ui.list.animate({scrollTo:this.ui.list.height()},0),s.validator.addItem(this.$el.parents("form").eq(0),t.ui.amount),s.validator.addItem(this.$el.parents("form").eq(0),t.ui.updateDate),t.ui.amount.focus()}});return o}),define("modules/networth-product-editor/views/networth-product-balance-extension",["modules/networth-product-editor/views/networth-product-balance","classes/model","classes/collection","hbs!modules/networth-product-editor/templates/networth-product-balance","modules/networth-product-editor/views/networth-product-balance-row","utils/i18n","utils/date"],function(e,t,n,r,i,s){var o=e.extend({onRender:function(){var e=this.options.productId===undefined;this.collection.length||this.collection.push({amount:0,updateDate:this._today},{silent:!0}),this.collection.each(function(t,n){var r=new i(s.merge({},this.contextConfig,{model:t,ruleSet:this.options.ruleSet,absValue:this.options.absValue,required:e&&n===0}));r.render(),this.ui.list.append(r.el)},this)}});return o}),define("modules/networth-product-editor/views/networth-product-form",["classes/layout","data/networth/products/networth-product-balance-collection","hbs!modules/networth-product-editor/templates/networth-product-form","hbs!modules/networth-product-editor/templates/partials/property","hbs!modules/networth-product-editor/templates/partials/investment-account","hbs!modules/networth-product-editor/templates/partials/savings-account","hbs!modules/networth-product-editor/templates/partials/retirement-account","hbs!modules/networth-product-editor/templates/partials/checking-account","hbs!modules/networth-product-editor/templates/partials/thing-i-own","hbs!modules/networth-product-editor/templates/partials/miscellaneous","hbs!modules/networth-product-editor/templates/partials/mortgage","hbs!modules/networth-product-editor/templates/partials/loan","hbs!modules/networth-product-editor/templates/partials/credit-card","hbs!modules/networth-product-editor/templates/partials/debt","modules/networth-product-editor/views/networth-product-balance","ui/modules/reform/select/select-module","utils/i18n","utils/date","utils/number","ui/modules/reform/datepicker/datepicker-module","ui/modules/reform/checkbox/checkbox-module"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){var g=e.extend({triggers:{"click .sf-button-controls .sf-button-cancel":"cancel"},ui:{partial:".sf-networth-product-partial",form:"form.sf-networth-product-form"},events:{"click .sf-networth-product-form-extra-controls .sf-button-delete":"_deleteClickHandler","submit form.sf-networth-product-form":"_submitHandler","change select[name=expirationDateYear]":"_expiresValueDateLimit","change select[name=initialValueDateYear]":"_initialValueDateLimit","change select[name=initialValueDateMonth]":"_updateBalanceMinDate"},template:n,regions:{balanceRegion:".sf-networth-product-balances-placeholder"},initialize:function(){this._super.apply(this,arguments),this._dataRecevied=m.bind(this._dataRecevied,this),this._dataError=m.bind(this._dataError,this),this.category=this.options.category||this.model.parent.get("category"),this._nonAbsValue=this.category.get("asset")&&this.category.get("liability"),this._ruleSet="networth-product",this._nonAbsValue&&(this._ruleSet+="-dynamic")},serializeData:function(){return{hidden:this.model.get("hidden"),id:this.model.id,ruleSet:this._ruleSet}},onRender:function(){var e=this.model.getBalanceUpdates();this._super(),m.mask(this.$el,m.MASK_LOADING),m.when(e).done(this._dataRecevied).fail(this._dataError)},_dataRecevied:function(e){m.unmask(this.$el),this._balances=new t(e.toJSON()),this._balances.length||this._balances.push({amount:this.model.get("amount"),updateDate:this.model.get("updateDate")}),this._balanceView=new d(m.merge({},this.contextConfig,{collection:this._balances,minDate:!1,ruleSet:this._ruleSet,absValue:!this._nonAbsValue,productId:this.model.get("id")})),this._attachPartial(),this._initialValueDateLimit(),this._expiresValueDateLimit()},_dataError:function(e){m.umask(this.$el),this.publish("error",e)},_attachPartial:function(){var e=this.constructor.PARTIAL_TEMPLATE_MAP[this.options.category.get("key")],t=[],n=[],r=[],i=m.date.parseBackendDate(this.globals.environment.serverDate),s=this.model.toJSON();!this._nonAbsValue&&s.initialValue&&(s.initialValue=Math.abs(s.initialValue));for(var o=0;o<12;o++)t.push({value:o,name:m.date.format(new Date(2e3,o),this.config.monthFormat)});for(o=i.getFullYear();o>this.config.minYearReference;o--)n.push({name:o,value:o});for(o=i.getFullYear();o<this.config.maxYearReference;o++)r.push({name:o,value:o});var u=i.getMonth(),a=i.getFullYear();s.initialValueDate&&(u=s.initialValueDate.getMonth(),a=s.initialValueDate.getFullYear());var f=i.getMonth(),l=i.getFullYear();s.expirationDate&&(f=s.expirationDate.getMonth(),l=s.expirationDate.getFullYear());var c=0;s.expirationDate&&s.initialValueDate&&(c=m.date.difference(m.date.constructor.MONTH,s.initialValueDate,s.expirationDate));var h=m.map(this.options.category.get("subcategories"),function(e){return{value:e.id,name:e.nameI18n}}),p=s.productTypeId||m.first(h).value;m.merge(s,{ruleSet:this._ruleSet,months:t,pastYears:n,futureYears:r,initialValueDateMonth:u,initialValueDateYear:a,expirationDateMonth:f,expirationDateYear:l,productTypeId:p,productTypes:h,monthTerms:c,balanceAdjustments:m.map(["d","m","y"],function(e){return{value:e,name:m.i18n.get("networth-product-editor.balanceAdjustments."+e)}})}),this.ui.partial.html(e(s)),this.balanceRegion.show(this._balanceView),v.init(this.ui.form),m.validator.validate(this.ui.form)},_initialValueDateLimit:function(){var e=this.ui.partial.find("select[name=initialValueDateYear]").val(),t=this.ui.partial.find("select[name=initialValueDateMonth]"),n=t.val(),r=m.date.today(),i=r.getFullYear(),s=r.getMonth(),o=t.data("ReForm.Select"),u=t.siblings(".sf-optionlist").children();i==e?(n>s&&(t.val(s),o.update()),u.length||(o.open(),o.close(),u=t.siblings(".sf-optionlist").children()),u.slice(s+1).hide()):u.show(),this._updateBalanceMinDate()},_updateBalanceMinDate:function(){var e=this.ui.partial.find("select[name=initialValueDateYear]").val(),t=this.ui.partial.find("select[name=initialValueDateMonth]").val();e&&this._balanceView.updateMinDate(new Date(e,t))},_expiresValueDateLimit:function(){var e=this.ui.partial.find("select[name=expirationDateYear]").val(),t=this.ui.partial.find("select[name=expirationDateMonth]"),n=t.val(),r=m.date.today(),i=r.getFullYear(),s=r.getMonth();i==e?(s>n&&(t.val(s),t.data("ReForm.Select").update()),t.siblings(".sf-optionlist").children().slice(0,s).hide()):t.siblings(".sf-optionlist").children().show()},_submitHandler:function(e){e.preventDefault();var t=m.serializeForm(this.ui.form),n=this,r=this.category.get("liability")&&!this.category.get("asset");t.initialValueDateMonth&&(t.initialValueDate=new Date(t.initialValueDateYear,t.initialValueDateMonth),delete t.initialValueDateMonth,delete t.initialValueDateYear),t.expirationDateMonth&&(t.expirationDate=new Date(t.expirationDateYear,t.expirationDateMonth),delete t.expirationDateMonth,delete t.expirationDateYear),t.monthTerms!=null&&(t.expirationDate=new Date(+t.initialValueDate),t.expirationDate.setMonth(t.expirationDate.getMonth()+parseInt(t.monthTerms,10)),delete t.monthTerms),t.balances=this._balances.map(function(e){var n=m.number.parse(t.balanceAmount[e.cid]);return r&&(n*=-1),{amount:n,updateDate:t.balanceUpdateDate[e.cid+"date"],id:e.get("id")}}),delete t.balanceAmount,delete t.balanceUpdateDate,t.hidden&&(t.hidden=!0),t.updateBalanceAuto&&(t.updateBalanceAuto=!0),m.each(["initialValue","pctAdjustment","pymtAdjustment","monthTerms"],function(e){t[e]&&(t[e]=m.number.parse(t[e]))}),r&&(t.initialValue*=-1),m.mask(this.$el,m.MASK_LOADING),m.when(this.model.save(t)).done(function(){m.unmask(n.$el),n.trigger("save",n.model)}).fail(function(e){m.unmask(n.$el),n.publish("error",e)})},_deleteClickHandler:function(e){e.preventDefault(),this.trigger("delete",this.model)}},{PARTIAL_TEMPLATE_MAP:{property:r,investment_account:i,savings:s,retirement_account:o,checking:u,luxury_good:a,miscellaneous:f,mortgage:l,loan:c,credit:h,debt:p}});return g}),define("hbs!modules/networth-product-editor/templates/partials/car",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-form-row sf-row-alias">\n	<label for="alias">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.car.alias",u):a.call(t,"t","networth-product-editor.car.alias",u)))+"</label>\n	",u={hash:{name:"alias",value:t.alias,validateField:"{{ ruleSet }}.alias"}},s+=f((o=n.textfield,o?o.call(t,u):a.call(t,"textfield",u)))+'\n</div>\n\n<div class="sf-form-row sf-initial-value-row">\n	<label for="initialValue">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.car.initialValue",u):a.call(t,"t","networth-product-editor.car.initialValue",u)))+"</label>\n	",u={hash:{name:"initialValue",value:t.initialValue,affix:"currency",validateField:"{{ ruleSet }}.initialValue"}},s+=f((o=n.textfield,o?o.call(t,u):a.call(t,"textfield",u)))+'\n</div>\n\n<div class="sf-form-row sf-initial-value-row sf-initial-datepicker">\n	<label for="initialValueDate">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.car.initialValueDate",u):a.call(t,"t","networth-product-editor.car.initialValueDate",u)))+"</label>\n	",u={hash:{dataValue:t.initialValueDate,dataFormat:t.dateFormat,dataFormatSubmit:t.dateSubmitFormat,name:"initialValue","class":"sf-networth-product-initial-date"}},s+=f((o=n.datepicker,o?o.call(t,u):a.call(t,"datepicker",u)))+'\n</div>\n\n<div class="sf-form-row">\n	<label>',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.car.accountBalance",u):a.call(t,"t","networth-product-editor.car.accountBalance",u)))+'</label>\n	<div class="sf-networth-product-balances-placeholder"></div>\n</div>',s});return t.registerPartial("modules_networth-product-editor_templates_partials_car",n),n}),define("modules/networth-product-editor/views/networth-product-form-extension",["modules/networth-product-editor/views/networth-product-form","classes/collection","hbs!modules/networth-product-editor/templates/networth-product-form","hbs!modules/networth-product-editor/templates/partials/property","hbs!modules/networth-product-editor/templates/partials/investment-account","hbs!modules/networth-product-editor/templates/partials/savings-account","hbs!modules/networth-product-editor/templates/partials/retirement-account","hbs!modules/networth-product-editor/templates/partials/checking-account","hbs!modules/networth-product-editor/templates/partials/thing-i-own","hbs!modules/networth-product-editor/templates/partials/miscellaneous","hbs!modules/networth-product-editor/templates/partials/car","hbs!modules/networth-product-editor/templates/partials/mortgage","hbs!modules/networth-product-editor/templates/partials/loan","hbs!modules/networth-product-editor/templates/partials/credit-card","hbs!modules/networth-product-editor/templates/partials/debt","modules/networth-product-editor/views/networth-product-balance","ui/modules/reform/select/select-module","utils/i18n","utils/date","utils/number","ui/modules/reform/datepicker/datepicker-module","ui/modules/reform/checkbox/checkbox-module"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){var y=e.extend({events:{"click .sf-networth-product-form-extra-controls .sf-button-delete":"_deleteClickHandler","click .sf-networth-product-submit":"_submitHandler","change select[name=expirationDateYear]":"_expiresValueDateLimit","change select[name=initialValueDateYear]":"_initialValueDateLimit","change select[name=initialValueDateMonth]":"_updateBalanceMinDate"},_attachPartial:function(){var e=this,t=this.constructor.PARTIAL_TEMPLATE_MAP[this.options.category.get("key")],n=[],r=[],i=[],s=g.date.parseBackendDate(this.globals.environment.serverDate),o=this.model.toJSON();!this._nonAbsValue&&o.initialValue&&(o.initialValue=Math.abs(o.initialValue));for(var u=0;u<12;u++)n.push({value:u,name:g.date.format(new Date(2e3,u),this.config.monthFormat)});for(u=s.getFullYear();u>this.config.minYearReference;u--)r.push({name:u,value:u});for(u=s.getFullYear();u<this.config.maxYearReference;u++)i.push({name:u,value:u});var a=s.getMonth(),f=s.getFullYear(),l=s;o.initialValueDate&&(a=o.initialValueDate.getMonth(),f=o.initialValueDate.getFullYear(),l=o.initialValueDate);var c=s.getMonth(),h=s.getFullYear();o.expirationDate&&(c=o.expirationDate.getMonth(),h=o.expirationDate.getFullYear());var p=0;o.expirationDate&&o.initialValueDate&&(p=g.date.difference(g.date.constructor.MONTH,o.initialValueDate,o.expirationDate));var d=function(e){for(var t=0;t<e.length;t++){var n=null,r=e[t];switch(r.name){case"Muebles":n=2;break;case"Otros":n=3;break;case"Joyas":n=0;break;default:n=1}r.order=n}e.sort(function(e,t){return e.order-t.order})},v=g.map(this.options.category.get("subcategories"),function(e){return{value:e.id,name:e.nameI18n}}),y=o.productTypeId||g.first(v).value;this.category.attributes.key==="luxury_good"&&d(v),g.merge(o,{ruleSet:this._ruleSet,dateFormat:g.date.getDatepickerFormat("dd / MM / yyyy"),dateSubmitFormat:g.date.getDatepickerFormat(this.config.datepickerBackendFormat),months:n,pastYears:r,futureYears:i,initialValueDateMonth:a,initialValueDateYear:f,initialValueDate:g.date.formatBackendDate(l),expirationDateMonth:c,expirationDateYear:h,productTypeId:y,productTypes:v,monthTerms:p,balanceAdjustments:g.map(["d","m","y"],function(e){return{value:e,name:g.i18n.get("networth-product-editor.balanceAdjustments."+e)}})}),this.ui.partial.html(t(o)),this.balanceRegion.show(this._balanceView),m.init(this.ui.form),g.validator.validate(this.ui.form)},_submitHandler:function(e){e.preventDefault();if(!this.ui.form.parsley().validate()||!g.validator.isValid(this.ui.form))return;var t=g.serializeForm(this.ui.form),n=this,r=this.category.get("liability")&&!this.category.get("asset");t.initialValueDateMonth?(t.initialValueDate=new Date(t.initialValueDateYear,t.initialValueDateMonth),delete t.initialValueDateMonth,delete t.initialValueDateYear):t.initialValueDate&&(t.initialValueDate=g.date._addDays(new Date(t.initialValueDate),1)),t.expirationDateMonth&&(t.expirationDate=new Date(t.expirationDateYear,t.expirationDateMonth),delete t.expirationDateMonth,delete t.expirationDateYear),t.monthTerms!=null&&(t.expirationDate=new Date(+t.initialValueDate),t.expirationDate.setMonth(t.expirationDate.getMonth()+parseInt(t.monthTerms,10)),delete t.monthTerms),t.balances=this._balances.map(function(e){var n=g.number.parse(t.balanceAmount[e.cid]);return r&&(n*=-1),{amount:n,updateDate:t.balanceUpdateDate[e.cid+"date"]}}),delete t.balanceAmount,delete t.balanceUpdateDate,t.hidden&&(t.hidden=!0),t.updateBalanceAuto&&(t.updateBalanceAuto=!0),g.each(["initialValue","pctAdjustment","pymtAdjustment","monthTerms"],function(e){t[e]&&(t[e]=g.number.parse(t[e]))}),r&&(t.initialValue*=-1),g.mask(this.$el,g.MASK_LOADING),this.options.category.get("key")==="car"&&(t.productTypeId=11),g.when(this.model.save(t)).done(function(){g.unmask(n.$el),n.trigger("save",n.model)}).fail(function(e){g.unmask(n.$el),n.publish("error",e)})}},{PARTIAL_TEMPLATE_MAP:{property:r,investment_account:i,savings:s,retirement_account:o,checking:u,luxury_good:a,miscellaneous:f,mortgage:c,loan:h,credit:p,debt:d,car:l}});return y}),define("hbs!modules/networth-product-editor/templates/networth-category-selector",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-networth-category-selector">\n	<div class="sf-form-row">\n		<label for="productType">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-product-editor.labels.webProductType",u):a.call(t,"t","networth-product-editor.labels.webProductType",u)))+" </label>",u={hash:{name:"productType",options:t.categories,currentOption:t.current}},s+=f((o=n.select,o?o.call(t,u):a.call(t,"select",u)))+'\n		<div class="sf-icon-help sf-networth-cat-help"></div>\n	</div>\n</div>',s});return t.registerPartial("modules_networth-product-editor_templates_networth-category-selector",n),n}),define("modules/networth-product-editor/views/networth-category-selector",["classes/item-view","hbs!modules/networth-product-editor/templates/networth-category-selector","ui/modules/reform/select/select-module","utils/i18n"],function(e,t,n,r){var i=e.extend({events:{"change [name=productType]":"_changeSelectionHandler"},ui:{select:"select"},template:t,serializeData:function(){var e=function(e,t){return e.get("order")>t.get("order")?1:e.get("order")<t.get("order")?-1:0},t=this.collection.filter(function(e){return e.get("asset")}),n=this.collection.filter(function(e){return e.get("liability")}),i=function(e){return{name:e.get("nameI18n"),value:e.id}},s;return this.options.isOwnSection===!0?s=r.map(t.sort(e),i):this.options.isOwnSection===!1&&(s=r.map(n.sort(e),i)),this._current=r.first(s).value,{current:this._current,categories:s}},onRender:function(){this._super(),n.init(this.$el),this.trigger("change",this.collection._byId[this._current])},_changeSelectionHandler:function(e){var t=this.$(e.currentTarget).val();t?(this._current=t,this.trigger("change",this.collection._byId[t])):(this.ui.select.val(this._current),this.ui.select.data("ReForm.Select").update())}});return i}),define("hbs!modules/networth-product-editor/templates/networth-product-editor",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-networth-product-editor">\n	<div class="sf-networth-product-editor-category-placeholder"></div>\n	<div class="sf-networth-product-editor-form-placeholder"></div>\n</div>'});return t.registerPartial("modules_networth-product-editor_templates_networth-product-editor",n),n}),define("libs/require/css/css!modules/networth-product-editor/css/networth-product-editor",[],function(){}),define("modules/networth-product-editor/networth-product-editor-module",["classes/layout","ui/modules/popup/popup-module","data/networth/products/networth-product-model","services/networth-service","modules/networth-product-editor/views/networth-product-form","modules/networth-product-editor/views/networth-category-selector","hbs!modules/networth-product-editor/templates/networth-product-editor","utils/util","utils/mask","utils/date","css!modules/networth-product-editor/css/networth-product-editor"],function(e,t,n,r,i,s,o,u){var a=e.extend({template:o,regions:{formRegion:".sf-networth-product-editor-form-placeholder",categorySelectorRegion:".sf-networth-product-editor-category-placeholder"},events:{"click .sf-networth-cat-help":"_openHelpCatPopup"},_openHelpCatPopup:function(e){var n=this.options.isAdd,r=this.options.isOwnSection,i="networth-product-editor.webCatSelectHelp.";n?r?i+="addAsset":i+="addLiab":r?i+="editAsset":i+="editLiab";var s={$container:this.$el,$opener:this.$el,content:u.i18n.get(i),type:t.INFO,closeCallback:u.bind(this._closePopup,this),maskClass:"sf-dark-mask"};this.infoPopup=new t(s),this.infoPopup.open()},_closePopup:function(){this.infoPopup.remove()},initialize:function(){this._super.apply(this,arguments),this._service=r.getInstance(),this._dataRecevied=u.bind(this._dataRecevied,this),this._dataError=u.bind(this._dataError,this),this._dataChanged=u.bind(this._dataChanged,this)},onRender:function(){this._super();var e=this;e.model&&e.model.parent?(e.dispose(),e._attachProductForm(e.model,e.model.parent.get("category"))):(u.mask(e.$el,u.MASK_LOADING),u.when(e._service.categories()).done(e._dataRecevied).fail(e._dataError))},_detachProductForm:function(){this.formRegion&&this.formRegion.currentView&&(this.formRegion.currentView.off("cancel",this._formCancel),this.formRegion.currentView.off("save",this._formSave),this.formRegion.currentView.off("delete",this._formSave))},_attachProductForm:function(e,t){this._detachProductForm();var n=new i(u.merge({},this.contextConfig,{model:e,category:t}));n.on("cancel",this._formCancel,this),n.on("save",this._formSave,this),n.on("delete",this._formDelete,this),this.formRegion.show(n)},_detachCategorySelector:function(){this.categorySelectorRegion&&this.categorySelectorRegion.currentView&&this.categorySelectorRegion.currentView.off("change",this._changeCategoryHandler)},_attachCategorySelector:function(e){var t=new s(u.merge({},this.contextConfig,{collection:e,isOwnSection:this.options.isOwnSection}));t.on("change",this._changeCategoryHandler,this),this.categorySelectorRegion.show(t)},_changeCategoryHandler:function(e){this.model=new n,this._attachProductForm(this.model,e)},onClose:function(){this.dispose()},dispose:function(){this._results&&(this._results.dispose(),this._results=null),this._detachProductForm(),this._detachCategorySelector()},_dataRecevied:function(e){this.dispose(),u.unmask(this.$el),this._results=e,e.on("change",this._dataChanged),this._dataChanged(e)},_dataError:function(e){u.unmask(this.$el),console.log("[NetworthProductEditor] Error retrieving networth categories",e),this.publish("error",e)},_dataChanged:function(e){this._attachCategorySelector(e.data)},_formCancel:function(){this.trigger("cancel",this.model)},_formSave:function(e){this.trigger("save",e)},_formDelete:function(e){var n=this,r={$container:this.$el.closest(".sf-widget"),$opener:this.$el,title:"",$content:u.i18n.get("networth-product-editor.labels.removeText"),labelConfirm:u.i18n.get("popup.label.accept"),type:t.CONFIRM,maskClass:"sf-dark-mask",confirmCallback:function(){u.mask(n.$el,u.MASK_LOADING),u.when(e.remove()).done(function(){u.unmask(n.$el),n.trigger("delete",e)}).fail(function(e){u.unmask(n.$el),console.error("[NetworthProductEditor] Failed to remove product",e),n.publish("error",e)}),i.remove()}};r["class"]="sf-delete-product-confirm";var i=new t(r);i.open()},serializeData:function(){return{title:this.options.title}}},{ID:"networth-product-editor",services:[r],submodules:[t],defaults:{monthFormat:u.date.constructor.SHORT_MONTH,minYearReference:1970,maxYearReference:2050,updateDateFormat:u.date.constructor.SHORT_DATE,datepickerBackendFormat:u.date.constructor.BACKEND_FORMAT}});return a}),define("modules/networth-product-manager/views/networth-product",["classes/item-view","hbs!modules/networth-product-manager/templates/networth-product","ui/modules/popup/popup-module","modules/networth-product-editor/networth-product-editor-module","utils/i18n","utils/date","utils/tooltip","utils/amount","utils/mask"],function(e,t,n,r,i){var s=e.extend({filtersList:["networthPeriod"],template:t,events:{"click .sf-networth-product-delete":"_deleteClickHandler","click .sf-networth-product-update":"_editProduct"},tooltipSelector:"[title]",serializeData:function(){var e=this.model.get("updateDate"),t=i.date.today(),n=i.date.difference(i.date.constructor.MONTH,e,t),r=n===1?i.i18n.get("networth-product-manager.products.tooltip.single"):i.i18n.get("networth-product-manager.products.tooltip.multiple",{months:n}),s=this.model.get("alias"),o=this.model.get("linked"),u=this.filters.networthPeriod==="future",a=o||u;return{linked:o,hidden:this.model.get("hidden"),projection:u,alias:s,amount:i.amount.format(Math.abs(this.model.get("amount")),this.config.showDecimals,this.model.get("currency")),title:r,fixAmountLeft:a}},onRender:function(){this._super(),this._removeTooltips(),this._attachTooltips();var e=this.$el.find(".sf-networth-product-update"),t=this.$el.find(".sf-networth-product-delete");e.length>0&&e[0].addEventListener("click",this._editProduct.bind(this)),t.length>0&&t[0].addEventListener("click",this._deleteClickHandler.bind(this))},onClose:function(){this._removeTooltips()},_removeTooltips:function(){if(this._$tooltips){while(this._$tooltips.length)i.tooltip.destroy(this._$tooltips),this._$tooltips=this._$tooltips.slice(1);this._$tooltips=null}},_deleteClickHandler:function(e){var t=this,r=e.currentTarget.closest(".sf-networth-product-set").parentElement.classList.contains("sf-networth-product-manager-own"),s=r?"product":"liability",o={$container:this.options.$popupContainer,$opener:this.$el,title:i.i18n.get("networth-product-manager.popup.remove-"+s),$content:i.i18n.get("networth-product-manager.popup.remove-text-"+s),type:n.CONFIRM,confirmCallback:function(){i.mask(t.$el,i.MASK_LOADING),i.when(t.model.remove()).done(function(){i.unmask(t.$el),t.trigger("delete",t.model)}).fail(function(e){i.unmask(t.$el),console.error("[NetworthProductEditor] Failed to remove product",e),t.publish("error",e)}),u.remove()}},u=new n(o);u.open()},_uncapitalizeCategoryName:function(e){return i.i18n.toLowerCase(e)},_editProduct:function(e){var t=this.model.parent.get("category"),s=this._uncapitalizeCategoryName(t.get("nameI18n")),o=i.i18n.get("networth-product-manager.popup.edit-product",{category:s}),u=new r(i.merge({},this.contextConfig,{model:this.model,title:o})),a=function(){l.remove()},f={$container:this.$el.closest(".sf-widget"),$opener:this.$(e.currentTarget),title:i.i18n.get("networth-product-manager.popup.edit-product",{category:s}),labelClose:i.i18n.get("popup.label.back"),closeCallback:a,customTop:0,maskClass:"sf-transparent-mask"};f["class"]="sf-networth-add-popup sf-networth-edit-popup";var l=new n(f);u.once("save",a),u.once("cancel",a),u.once("delete",a),l.contentRegion.once("show",function(){l.open()}),l.contentRegion.show(u)},_attachTooltips:function(){this._$tooltips=this.$(this.tooltipSelector),i.tooltip.add(this._$tooltips,i.merge({},this.tooltipOptions,{position:{target:"mouse",adjust:{x:0,y:-20}}},this.tooltipExtra))}},{defaults:{showDecimals:!0}});return s}),define("hbs!modules/networth-product-manager/templates/networth-category-add-product-button-view",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression;return s+='<div class="sf-networth-category-add-product-button-view">\n	<button class="sf-button sf-button-add-product" type="button">\n		<span class="sf-button-icon">\n			<img src="resources/pfm/ui/css/icons/app-icons/dav-plus-white.svg" width="20" height="20" alt="',(o=n.name)?o=o.call(t,{hash:{}}):(o=t.name,o=typeof o===u?o.apply(t):o),s+=a(o)+'">\n		</span>\n		<span class="sf-button-text">',(o=n.name)?o=o.call(t,{hash:{}}):(o=t.name,o=typeof o===u?o.apply(t):o),s+=a(o)+"</span>\n	</button>\n</div>",s});return t.registerPartial("modules_networth-product-manager_templates_networth-category-add-product-button-view",n),n}),define("modules/networth-product-manager/views/networth-category-add-product-button-view",["classes/item-view","hbs!modules/networth-product-manager/templates/networth-category-add-product-button-view","data/networth/products/networth-product-model","ui/modules/popup/popup-module","modules/networth-product-editor/networth-product-editor-module","utils/i18n"],function(e,t,n,r,i,s){var o=e.extend({template:t,events:{"click .sf-button-add-product":"_clickHandler"},initialize:function(e){this._super(e),this._clickHandler=s.bind(this._clickHandler,this)},serializeData:function(){var e=this.model.get("category");return{name:s.i18n.get("networth-product-manager.buttons.add-product",{type:s.i18n.toLowerCase(e.get("nameI18n"))})}},_clickHandler:function(e){var t=e.currentTarget.closest(".sf-networth-product-set").parentElement.classList.contains("sf-networth-product-manager-own"),n=t?"product":"liability",o=s.i18n.get("networth-product-manager.popup.add-"+n),u=s.merge({},this.contextConfig,{title:o,isOwnSection:t,isAdd:!0}),a=new i(u),f=function(){n==="product"&&s.pushToDataLayer({eventCategory:"PFM Patrimonio-Detalle",eventAction:"Boton",eventLabel:"Cancelar- Agregar bien",event:"eventClick"}),n==="liability"&&s.pushToDataLayer({eventCategory:"PFM Patrimonio-Detalle",eventAction:"Boton",eventLabel:"Cancelar- Agregar deuda",event:"eventClick"}),h.remove()},l=function(){n==="product"&&s.pushToDataLayer({eventCategory:"PFM Patrimonio-Detalle",eventAction:"Boton",eventLabel:"Guardar- Agregar bien",event:"eventClick"}),n==="liability"&&s.pushToDataLayer({eventCategory:"PFM Patrimonio-Detalle",eventAction:"Boton",eventLabel:"Guardar- Agregar deuda",event:"eventClick"}),h.remove()},c={$container:this.$el.closest(".sf-widget"),$opener:this.$(e.currentTarget),title:o,labelClose:s.i18n.get("popup.label.back"),closeCallback:f,customTop:0,maskClass:"sf-transparent-mask"};c["class"]="sf-networth-add-popup";var h=new r(c);n==="product"&&s.pushToDataLayer({eventCategory:"PFM Patrimonio-Detalle",eventAction:"Boton",eventLabel:"Agregar bien",event:"eventClick"}),n==="liability"&&s.pushToDataLayer({eventCategory:"PFM Patrimonio-Detalle",eventAction:"Boton",eventLabel:"Agregar deuda",event:"eventClick"}),a.once("save",l),a.once("cancel",f),h.contentRegion.once("show",function(){h.open()}),h.contentRegion.show(a)},onRender:function(){this.$el.find("button")[0].addEventListener("click",this._clickHandler)}});return o}),define("modules/networth-product-manager/views/networth-product-set",["classes/layout","classes/model","classes/collection","is!ie8?modules/networth-product-manager/views/networth-product-set-chart-hc:modules/networth-product-manager/views/networth-product-set-chart","ui/modules/accordion/accordion-module","hbs!modules/networth-product-manager/templates/networth-product-set","modules/networth-product-manager/views/networth-category","modules/networth-product-manager/views/networth-product","modules/networth-product-manager/views/networth-category-add-product-button-view","utils/i18n"],function(e,t,n,r,i,s,o,u,a,f){var l=e.extend({filtersList:["networthPeriod"],template:s,regions:{chartRegion:".sf-product-set-chart",detailsRegion:".sf-product-set-details"},ui:{emptyMessage:".sf-networth-product-set-empty-message"},onRender:function(){this._super(),this.model.get("sections").length?this._fillRegions():this.ui.emptyMessage.show()},_fillRegions:function(){this.ui.emptyMessage.hide(),this.chartRegion.show(new r(f.merge({model:this.model},this.contextConfig)));var e=new n(this.parseAccordion());this.detailsRegion.show(new i(f.merge({},this.contextConfig,{collection:e})))},parseAccordion:function(){var e=this.model,t=this;return e.get("sections").map(function(e){var n=e.get("products").map(function(e){return new u(f.merge({},t.contextConfig,{model:e}))});return t.filters.networthPeriod=="past"&&n.push(new a(f.merge({},t.contextConfig,{model:e}))),{view:new o(f.merge({},t.contextConfig,{model:e})),children:n}})}});return l}),define("hbs!ui/modules/accordion/templates/accordion-networth",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i,s,o;r+='\n		<li class="sf-accordion-entry-header sf-accordion-cid-'+l((i=(i=e.view,i==null||i===!1?i:i.cid),typeof i===f?i.apply(e):i))+" ",o={hash:{},inverse:c.noop,fn:c.program(2,d,t)},s=(i=n.ifequal,i?i.call(e,e.i,0,o):h.call(e,"ifequal",e.i,0,o));if(s||s===0)r+=s;r+='" data-entry="'+l((i=(i=e.view,i==null||i===!1?i:i.cid),typeof i===f?i.apply(e):i))+'">\n			<div class="sf-accordion-entry-placeholder"></div>\n		</li>\n		<li class="sf-accordion-entry-content sf-accordion-cid-'+l((i=(i=e.view,i==null||i===!1?i:i.cid),typeof i===f?i.apply(e):i))+" ",o={hash:{},inverse:c.noop,fn:c.program(2,d,t)},s=(i=n.ifequal,i?i.call(e,e.i,0,o):h.call(e,"ifequal",e.i,0,o));if(s||s===0)r+=s;r+='">\n			<ul class="sf-accordion-entry-children">\n				',o={hash:{},inverse:c.noop,fn:c.program(4,v,t)},s=(i=n.iter,i?i.call(e,e.children,o):h.call(e,"iter",e.children,o));if(s||s===0)r+=s;return r+="\n			</ul>\n		</li>\n	",r}function d(e,t){return"sf-open"}function v(e,t){var r="",i;return r+='\n				<li class="sf-accordion-entry-child sf-accordion-cid-',(i=n.cid)?i=i.call(e,{hash:{}}):(i=e.cid,i=typeof i===f?i.apply(e):i),r+=l(i)+'"></li>\n				',r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<ul class="sf-accordion">\n	',a={hash:{},inverse:c.noop,fn:c.program(1,p,i)},u=(o=n.iter,o?o.call(t,t,a):h.call(t,"iter",t,a));if(u||u===0)s+=u;return s+="\n</ul>",s});return t.registerPartial("ui_modules_accordion_templates_accordion-networth",n),n}),define("ui/modules/accordion/accordion-module-networth",["ui/modules/accordion/accordion-module","hbs!ui/modules/accordion/templates/accordion-networth","utils/util","css!ui/modules/accordion/css/accordion"],function(e,t,n){var r=e.extend({template:t,events:{"click li.sf-accordion-entry-header":"_clickEntryHeaderHandler"},onRender:function(){this._super();var e=this;this.collection.each(function(t){var r=t.get("view"),i=t.get("children");e.addRegion(r.cid,".sf-accordion-cid-"+r.cid+" .sf-accordion-entry-placeholder"),e[r.cid].show(r),n.each(i,function(t){e.addRegion(t.cid,"li.sf-accordion-cid-"+t.cid),e[t.cid].show(t)})})},serializeData:function(){var e=function(e,t){return e.get("view").model.get("category").get("order")>=t.get("view").model.get("category").get("order")?1:-1};return this.collection.comparator=e,this.collection.sort().toJSON()},onShow:function(){this.collection.on("reset",this.render,this)},onClose:function(){this.collection.off("reset",this.render)},_clickEntryHeaderHandler:function(e){var t=this.$(e.currentTarget),n=".sf-accordion-cid-"+t.data("entry");this.$(n).toggleClass("sf-open");var r=t.find(".sf-product-opener-icon");r.toggleClass("sf-product-opener-open"),r.toggleClass("sf-product-opener-close")}});return r}),define("modules/networth-product-manager/views/networth-product-set-extension",["modules/networth-product-manager/views/networth-product-set","classes/model","classes/collection","is!ie8?modules/networth-product-manager/views/networth-product-set-chart-hc:modules/networth-product-manager/views/networth-product-set-chart","ui/modules/accordion/accordion-module-networth","hbs!modules/networth-product-manager/templates/networth-product-set","modules/networth-product-manager/views/networth-category","modules/networth-product-manager/views/networth-product","modules/networth-product-manager/views/networth-category-add-product-button-view","utils/i18n"],function(e,t,n,r,i,s,o,u,a,f){var l=e.extend({_fillRegions:function(){this.ui.emptyMessage.hide(),this.chartRegion.show(new r(f.merge({model:this.model},this.contextConfig)));var e=new n(this.parseAccordion());this.detailsRegion.show(new i(f.merge({},this.contextConfig,{collection:e})))},parseAccordion:function(){var e=this.model,t=this;return e.get("sections").map(function(e){var n=e.get("products").map(function(e){return new u(f.merge({},t.contextConfig,{model:e}))});return t.filters.networthPeriod=="past"&&n.push(new a(f.merge({},t.contextConfig,{model:e}))),{view:new o(f.merge({},t.contextConfig,{model:e})),children:n}})}});return l}),define("hbs!modules/networth-product-manager/templates/networth-product-manager",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-networth-product-manager">\n	<div class="sf-networth-product-manager-sets">\n		<div class="sf-networth-product-manager-own"></div>\n		<div class="sf-networth-product-manager-owe"></div>\n	</div>\n</div>\n'});return t.registerPartial("modules_networth-product-manager_templates_networth-product-manager",n),n}),define("libs/require/css/css!modules/networth-product-manager/css/networth-product-manager",[],function(){}),define("modules/networth-product-manager/networth-product-manager-module",["classes/layout","services/networth-service","modules/networth-product-manager/views/networth-product-set","ui/modules/popup/popup-module","modules/networth-product-editor/networth-product-editor-module","hbs!modules/networth-product-manager/templates/networth-product-manager","utils/date","utils/i18n","css!modules/networth-product-manager/css/networth-product-manager"],function(e,t,n,r,i,s,o){var u=e.extend({filtersList:["networthPeriod","projectionRange"],template:s,regions:{ownRegion:".sf-networth-product-manager-own",oweRegion:".sf-networth-product-manager-owe"},events:{"click .sf-networth-product-manager-add-product":"_addProductClickHandler"},ui:{emptyMessage:".sf-networth-product-manager-empty-message"},initialize:function(e){this._super(e),this._dataReceived=o.bind(this._dataReceived,this),this._dataError=o.bind(this._dataError,this)},serializeData:function(){var e=this.filters.networthPeriod=="future",t=o.date.parseBackendDate(this.globals.environment.serverDate);return e&&t.setFullYear(t.getFullYear()+parseInt(this.filters.projectionRange,10)),{date:o.date.format(t,this.config.networthTitleDateFormat),projection:e}},onRender:function(){this._super();var e=t.getInstance(),n=this.filters.networthPeriod=="future"?e.productsProjection({years:this.filters.projectionRange}):e.products();o.when(n).done(this._dataReceived).fail(this._dataError)},dispose:function(){this._results&&(this._results.dispose(),this._results=null)},onClose:function(){this.dispose()},_dataReceived:function(e){this.dispose(),this._results=e,e.on("change",this._dataChanged,this),this._dataChanged(e)},_dataChanged:function(e){var t=e.data.get("own"),r=e.data.get("owe"),i=t.get("sections"),s=r.get("sections"),u=o.merge({},this.contextConfig,{model:t}),a=o.merge({},this.contextConfig,{model:r}),f={silent:!0},l={label:o.i18n.get("networth-product-manager.labels."+this.filters.networthPeriod+".owe"),emptyMessage:"networth-product-manager.emptyMessage."+this.filters.networthPeriod+".owe"},c={label:o.i18n.get("networth-product-manager.labels."+this.filters.networthPeriod+".own"),emptyMessage:"networth-product-manager.emptyMessage."+this.filters.networthPeriod+".own"};s.length||i.length?(this.ui.emptyMessage.hide(),t.set(c,f),r.set(l,f),this.ownRegion.show(new n(u)),this.oweRegion.show(new n(a))):(this.ownRegion.close(),this.oweRegion.close(),this.ui.emptyMessage.show())},_dataError:function(e){console.error("[NetworthProductManager] Failed to retrieve data",e),this.publish("error",e)},_filtersChanged:function(){if(this.isClosed)return;this.render()},_addProductClickHandler:function(e){var t=new i(this.contextConfig),n=function(){u.remove()},s={$container:this.options.$popupContainer,$opener:this.$(e.currentTarget),title:o.i18n.get("networth-product-manager.popup.add-product"),closeCallback:n},u=new r(s);t.once("save",n),t.once("cancel",n),u.contentRegion.once("show",function(){u.open()}),u.contentRegion.show(t)}},{ID:"networth-product-manager",services:[t],submodules:[i],defaults:{networthTitleDateFormat:o.date.constructor.LONG_MONTH_YEAR}});return u}),define("modules/networth-product-manager/networth-product-manager-module-extension",["modules/networth-product-manager/networth-product-manager-module","services/networth-service","modules/networth-product-manager/views/networth-product-set","ui/modules/popup/popup-module","modules/networth-product-editor/networth-product-editor-module","hbs!modules/networth-product-manager/templates/networth-product-manager","utils/date","utils/i18n","css!modules/networth-product-manager/css/networth-product-manager"],function(e,t,n,r,i,s,o){var u=e.extend({events:{"click .sf-networth-product-manager-add-product":"_addProductClickHandler"},ui:{emptyMessage:".sf-networth-product-manager-empty-message",$assetsToggleButton:".sf-toggle-assets-view-button",$liabsDatagridToggleButton:".sf-toggle-liabs-view-button",$assetsSection:".sf-networth-product-manager-own",$liabsSection:".sf-networth-product-manager-owe"},_dataChanged:function(e){var t=e.data.get("own"),n=e.data.get("owe"),r=t.get("sections"),i=n.get("sections"),s=o.merge({},this.contextConfig,{model:t}),u=o.merge({},this.contextConfig,{model:n}),a={silent:!0},f={label:o.i18n.get("networth-product-manager.labels."+this.filters.networthPeriod+".owe"),emptyMessage:"networth-product-manager.emptyMessage."+this.filters.networthPeriod+".owe"},l={label:o.i18n.get("networth-product-manager.labels."+this.filters.networthPeriod+".own"),emptyMessage:"networth-product-manager.emptyMessage."+this.filters.networthPeriod+".own"};i.length||r.length?(t.set(l,a),n.set(f,a),this.showRegions=!0,this.ownDataModel=t,this.oweDataModel=n,this.ownOptions=s,this.oweOptions=u):this.showRegions=!1,this.render(!0)},render:function(e){if(e)return this._super();var n=t.getInstance(),r=this.filters.networthPeriod=="future"?n.productsProjection({years:this.filters.projectionRange}):n.products();o.when(r).done(this._dataReceived).fail(this._dataError)},onRender:function(){var e=this;this.showRegions?(this.ownRegion.show(new n(this.ownOptions)),this.oweRegion.show(new n(this.oweOptions)),this.$(this.ui.emptyMessage).hide()):(this.ownRegion.close(),this.oweRegion.close(),this.$(this.ui.emptyMessage).show())},serializeData:function(){var e=this._super(),t=o.amount.format(this.ownDataModel.get("amount"),!1),n=o.amount.format(this.oweDataModel.get("amount"),!1),r=o.i18n.get("networth-product-manager.labels.amountTitle.own",{amount:t}),i=o.i18n.get("networth-product-manager.labels.amountTitle.owe",{amount:n});return e.finalOwnTitle=r,e.finalOweTitle=i,e},_addProductClickHandler:function(e){var t=e.currentTarget.closest(".sf-networth-product-set").parentElement.classList.contains("sf-networth-product-manager-own"),n=t?"product":"liability",s=o.i18n.get("networth-product-manager.popup.add-"+n),u=o.merge({},this.contextConfig,{title:s,isOwnSection:t,isAdd:!0}),a=new i(u),f=function(){n==="product"&&o.pushToDataLayer({eventCategory:"PFM Patrimonio-Detalle",eventAction:"Boton",eventLabel:"Cancelar- Agregar bien",event:"eventClick"}),n==="liability"&&o.pushToDataLayer({eventCategory:"PFM Patrimonio-Detalle",eventAction:"Boton",eventLabel:"Cancelar- Agregar deuda",event:"eventClick"}),h.remove()},l=function(){n==="product"&&o.pushToDataLayer({eventCategory:"PFM Patrimonio-Detalle",eventAction:"Boton",eventLabel:"Guardar- Agregar bien",event:"eventClick"}),n==="liability"&&o.pushToDataLayer({eventCategory:"PFM Patrimonio-Detalle",eventAction:"Boton",eventLabel:"Guardar- Agregar deuda",event:"eventClick"}),h.remove()},c={$container:this.$el.closest(".sf-widget"),$opener:this.$(e.currentTarget),title:o.i18n.get("networth-product-manager.popup.add-"+n),labelClose:o.i18n.get("popup.label.back"),titleIcon:"dav-plus-red",customTop:0,closeCallback:f,maskClass:"sf-transparent-mask"};c["class"]="sf-networth-add-popup";var h=new r(c);n==="product"&&o.pushToDataLayer({eventCategory:"PFM Patrimonio-Detalle",eventAction:"Boton",eventLabel:"Agregar bien",event:"eventClick"}),n==="liability"&&o.pushToDataLayer({eventCategory:"PFM Patrimonio-Detalle",eventAction:"Boton",eventLabel:"Agregar deuda",event:"eventClick"}),a.once("save",l,n),a.once("cancel",f,n),h.contentRegion.once("show",function(){h.open()}),h.contentRegion.show(a)}});return u}),define("hbs!modules/networth-filters/templates/networth-filters",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){return" sf-hidden"}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=this,f=n.helperMissing,l=this.escapeExpression;s+='<div class="sf-networth-filters">\n	<div class="sf-networth-filters-section sf-networth-filters-section-past',o=n["if"].call(t,t.future,{hash:{},inverse:a.noop,fn:a.program(1,c,i)});if(o||o===0)s+=o;return s+='">\n		<div class="sf-select-section">\n			<span class="sf-select-label">',u={hash:{}},s+=l((o=n.t,o?o.call(t,"networth-filters.web.labels.past",u):f.call(t,"t","networth-filters.web.labels.past",u)))+'</span>\n			<span class="sf-networth-content-date-range-placeholder"></span>\n		</div>\n	</div>\n</div>\n',s});return t.registerPartial("modules_networth-filters_templates_networth-filters",n),n}),define("libs/require/css/css!modules/networth-filters/css/networth-filters",[],function(){}),define("modules/networth-filters/networth-filters-module",["classes/layout","underscore","ui/modules/timerange-filter/timerange-filter-module","hbs!modules/networth-filters/templates/networth-filters","ui/modules/reform/select/select-module","utils/date","utils/i18n","css!modules/networth-filters/css/networth-filters"],function(e,t,n,r,i,s){var o=e.extend({template:r,filtersList:["networthPeriod","projectionRange","datesRange"],regions:{dateRangesPlaceholder:".sf-networth-content-date-range-placeholder"},ui:{buttons:".sf-button-section button",periods:".sf-networth-filters-section",projection:"select.sf-networth-content-filter-year"},events:{"click .sf-button-section button":"_buttonClickHandler","change select.sf-networth-content-filter-year":"_projectionChangHandler"},serializeData:function(){var e=this.config.minProjection,t=this.config.maxProjection,n=this.filters.projectionRange,r=[];for(var i=e;i<=t;i++)r.push({value:i,name:this._today.getFullYear()+i});return{future:this.filters.networthPeriod=="future",projection:n,years:r,date:s.date.format(this._today,s.date.constructor.MEDIUM_MONTH_YEAR)}},initialize:function(){this._super.apply(this,arguments),this._today=s.date.today()},onRender:function(){this._super(),i.init(this.$el);var e=this.contextConfig;if(this.config.initialRangeMonths){var r=n.defaults.predefinedSelections.slice(0),o=this.config.initialRangeMonths;if(r.indexOf(o)==-1){var u=t.sortedIndex(r,o);r.splice(u,0,o)}e=s.merge({},e,{config:{rangeSelected:o,predefinedSelections:r}}),s.isPhone()&&(e.config.itemsToRemove=2,e.config.rangeSelected=3)}this.dateRangesPlaceholder.show(new n(e))},_filtersChanged:function(e,t){e=="networthPeriod"&&this.ui.periods.removeClass("sf-hidden").not(".sf-networth-filters-section-"+t).addClass("sf-hidden"),e=="projectionRange"&&this.ui.projection.val()!=t&&(this.ui.projection.val(t),this.ui.projection.data("ReForm.Select").update())},_buttonClickHandler:function(e){var t=this.$(e.currentTarget),n=t.data("period");this.publish("filters:change",{filter:"networthPeriod",data:n})},_projectionChangHandler:function(e){var t=this.$(e.currentTarget),n=t.val();this.publish("filters:change",{filter:"projectionRange",data:n})}},{ID:"networth-filters",submodules:[n],defaults:{minProjection:1,maxProjection:5,initialRangeMonths:6,filters:{networthPeriod:"past",projectionRange:3}}});return o}),define("modules/networth-filters/networth-filters-module-extension",["modules/networth-filters/networth-filters-module","underscore","ui/modules/timerange-filter/timerange-filter-module","hbs!modules/networth-filters/templates/networth-filters","ui/modules/reform/select/select-module","utils/date","utils/i18n","css!modules/networth-filters/css/networth-filters"],function(e,t,n,r,i,s){var o=e.extend({onRender:function(){i.init(this.$el);var e=this.contextConfig;if(this.config.initialRangeMonths){var r=n.defaults.predefinedSelections.slice(0),o=this.config.initialRangeMonths;if(r.indexOf(o)==-1){var u=t.sortedIndex(r,o);r.splice(u,0,o)}e=s.merge({},e,{config:{rangeSelected:o,predefinedSelections:r,itemsToRemove:1}})}this.dateRangesPlaceholder.show(new n(e))},_filtersChanged:function(e,t){s.pushToDataLayer({eventCategory:"PFM Patrimonio",eventAction:"Boton",eventLabel:"Filtro tiempo",event:"eventClick"}),this._super.apply(this,arguments)}});return o}),define("hbs!modules/networth-content/templates/networth-content",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-networth-content">\n	<div class="sf-networth-tabs-region"></div>\n</div>'});return t.registerPartial("modules_networth-content_templates_networth-content",n),n}),define("libs/require/css/css!modules/networth-content/css/networth-content",[],function(){}),define("modules/networth-content/networth-content-module",["classes/layout","modules/networth-overtime/networth-overtime-module","modules/networth-future-overtime/networth-future-overtime-module","modules/networth-product-manager/networth-product-manager-module","modules/networth-filters/networth-filters-module","hbs!modules/networth-content/templates/networth-content","utils/util","css!modules/networth-content/css/networth-content"],function(e,t,n,r,i,s,o){var u=e.extend({template:s,filtersList:["networthPeriod","projectionRange","datesRange","networthCategory"],regions:{filtersRegion:".sf-networth-content-filters-region",overtimeRegion:".sf-networth-content-overtime-region",productsRegion:".sf-networth-content-products-region"},initialize:function(e){this._super.apply(this,arguments),this._pastCharts={charts:e.past.charts,config:e.past.config||{}},this._futureCharts={charts:e.future.charts,config:e.future.config||{}}},_getOvertime:function(){var e=o.merge({},this.contextConfig,this._pastCharts);return new t(e)},_getFutureOvertime:function(){var e=o.merge({},this.contextConfig,this._futureCharts);return new n(e)},_getNetworthFilter:function(){var e=o.merge({},this.contextConfig,{config:this.config});return new i(e)},onRender:function(){this._super(),this.filtersRegion.show(this._getNetworthFilter()),this.filters.networthPeriod=="future"?this.overtimeRegion.show(this._getFutureOvertime()):this.overtimeRegion.show(this._getOvertime()),this.productsRegion.show(new r(this.contextConfig))},_filtersChanged:function(e,t){e=="networthPeriod"&&(t=="future"?this.overtimeRegion.show(this._getFutureOvertime()):this.overtimeRegion.show(this._getOvertime()))}},{ID:"networth-content",submodules:[t,n,r,i],defaults:{}});return u}),define("hbs!ui/modules/tabs/templates/tabs-mobile",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i,s;r+='\n			<div class="sf-tab-label ',(i=n.customClass)?i=i.call(e,{hash:{}}):(i=e.customClass,i=typeof i===u?i.apply(e):i),r+=a(i)+'" id="'+a((i=e.moduleId,typeof i===u?i.apply(e):i))+'">\n				<div class="sf-tab-label-value sf-tab-inactive">\n					<h2 class="sf-tab-label-title">'+a((i=e.title,typeof i===u?i.apply(e):i))+'</h2>\n					<p class="sf-tab-label-subtitle">',s=(i=e.subTitle,typeof i===u?i.apply(e):i);if(s||s===0)r+=s;return r+='</p>\n				</div>\n			</div>\n\n			<div class="sf-tab-content ',(s=n.customClass)?s=s.call(e,{hash:{}}):(s=e.customClass,s=typeof s===u?s.apply(e):s),r+=a(s)+'-container">\n			</div>\n		',r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="sf-tabs">\n	<div class="sf-tabs-titles">\n		',o=n.each.call(t,t.tabs,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;return s+="\n	</div>\n</div>",s});return t.registerPartial("ui_modules_tabs_templates_tabs-mobile",n),n}),define("hbs!ui/modules/tabs/templates/tabs",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i,s;r+='\n			<div class="sf-tab-label ',(i=n.customClass)?i=i.call(e,{hash:{}}):(i=e.customClass,i=typeof i===u?i.apply(e):i),r+=a(i)+'" id="'+a((i=e.moduleId,typeof i===u?i.apply(e):i))+'">\n				<div class="sf-tab-label-value sf-tab-inactive">\n					<h2 class="sf-tab-label-title">'+a((i=e.title,typeof i===u?i.apply(e):i))+'</h2>\n					<p class="sf-tab-label-subtitle ',s=n["if"].call(e,e.negative,{hash:{},inverse:f.noop,fn:f.program(2,c,t)});if(s||s===0)r+=s;r+='">',s=(i=e.subTitle,typeof i===u?i.apply(e):i);if(s||s===0)r+=s;return r+="</p>\n				</div>\n			</div>\n\n		",r}function c(e,t){return"sf-tab-disposable-negative"}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="sf-tabs">\n	<div class="sf-tabs-titles">\n		',o=n.each.call(t,t.tabs,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;return s+='\n	</div>\n	<div class="sf-tabs-content">\n	</div>\n</div>',s});return t.registerPartial("ui_modules_tabs_templates_tabs",n),n}),define("libs/require/css/css!ui/modules/tabs/css/tabs",[],function(){}),define("ui/modules/tabs/tabs-module",["classes/layout","jQuery","is!phone?hbs!ui/modules/tabs/templates/tabs-mobile:hbs!ui/modules/tabs/templates/tabs","utils/util","utils/date","css!ui/modules/tabs/css/tabs"],function(e,t,n,r){var i=e.extend({template:n,ui:{$tabsContentRegion:".sf-tabs-content"},events:{"click div.sf-tab-label":"tabClicked"},hubEvents:{setActiveTab:"setActiveTab"},initialize:function(){this._super.apply(this,arguments),this.modules=arguments[0].tabsModules},serializeData:function(){var e=r.map(this.modules,function(e){return{moduleId:"sf-"+e.id,customClass:"sf-"+e.id,title:e.title,subTitle:e.subTitle}});return{tabs:e}},_createRegionsMobile:function(){var e=this;this.regionHTMLElems=[],r.each(this.modules,function(n){var r="sf-"+n.id+"-placeholder",i=t("<div></div>"),s="sf-"+n.id;i.addClass("sf-tab-region "+r),i.prop("id",s),e.$(".sf-tab-content.sf-"+n.id+"-container").append(i),e.regionHTMLElems.push(i),e.addRegion(s,"."+r),e[s].show(n.content),i.hide()}),this.$(".sf-tab-label-value").last().removeClass("sf-tab-inactive"),this.regionHTMLElems[this.regionHTMLElems.length-1].show()},_createregions:function(){var e=this;this.regionHTMLElems=[],r.each(this.modules,function(n){var r="sf-"+n.id+"-placeholder",i=t("<div></div>"),s="sf-"+n.id;i.addClass("sf-tab-region "+r),i.prop("id",s),e.ui.$tabsContentRegion.append(i),e.regionHTMLElems.push(i),e.addRegion(s,"."+r),e[s].show(n.content),i.hide()}),this.$(".sf-tab-label-value").last().removeClass("sf-tab-inactive"),this.regionHTMLElems[this.regionHTMLElems.length-1].show()},onRender:function(){this._super(),r.isPhone()?this._createRegionsMobile():this._createregions()},getActiveTab:function(){var e=this.$(".sf-tab-label-value").not(".sf-tab-inactive");return e.length===0?null:e.closest(".sf-tab-label")[0].id},tabClicked:function(e){if(r.isPhone()&&this.getActiveTab()===e.currentTarget.id){this.deactivateAllTabs();return}this._setActiveTab(e.currentTarget.id)},setActiveTab:function(e){this._setActiveTab("sf-"+e)},_setActiveTab:function(e){this.deactivateAllTabs(),this.$("#"+e).find(".sf-tab-label-value").removeClass("sf-tab-inactive");var t=this.regionHTMLElems.filter(function(t){return t[0].id===e});t[0].show()},deactivateAllTabs:function(){this.$(".sf-tab-label-value").addClass("sf-tab-inactive"),r.each(this.regionHTMLElems,function(e){e.hide()})}},{ID:"tabs",defaults:{}});return i}),define("hbs!modules/ok-to-spend-summary/templates/ok-to-spend-summary",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression;s+='<div class="sf-ok-to-spend-summary">\n	<div class="sf-ok-to-spend-summary-section">\n		<h3>',a={hash:{}},s+=l((o=n.t,o?o.call(t,"ok-to-spend-summary.title.currentCashflow",a):f.call(t,"t","ok-to-spend-summary.title.currentCashflow",a)))+"</h3>\n		",a={hash:{"class":"sf-ok-to-spend-summary-income",title:'{{{t "ok-to-spend-summary.subtitle.income"}}}',value:"{{{formatAmount incomeValue showDecimals=false noTag=true}}}"}},u=(o=n.summaryBox,o?o.call(t,a):f.call(t,"summaryBox",a));if(u||u===0)s+=u;s+="\n		",a={hash:{"class":"sf-ok-to-spend-summary-expenses",title:'{{{t "ok-to-spend-summary.subtitle.expenses"}}}',value:"{{{formatAmount expensesValue showDecimals=false noTag=true}}}"}},u=(o=n.summaryBox,o?o.call(t,a):f.call(t,"summaryBox",a));if(u||u===0)s+=u;s+="\n		",a={hash:{"class":"sf-ok-to-spend-summary-disposable",title:'{{{t "ok-to-spend-summary.subtitle.disposable"}}}',value:"{{{formatAmount disposableValue showDecimals=false noTag=true}}}"}},u=(o=n.summaryBox,o?o.call(t,a):f.call(t,"summaryBox",a));if(u||u===0)s+=u;return s+="\n	</div>\n</div>",s});return t.registerPartial("modules_ok-to-spend-summary_templates_ok-to-spend-summary",n),n}),define("data/ok-to-spend/ok-to-spend-model",["classes/model"],function(e){var t=e.extend({parse:function(e){var t=this._super(e);return t}});return t}),define("data/ok-to-spend/ok-to-spend-collection",["classes/collection","data/ok-to-spend/ok-to-spend-model"],function(e,t){var n=e.extend({model:t,url:"/financialcalendar/operations/spendingtrack/get.action",parse:function(e){var t=e.months,n=[];for(var r in t)t.hasOwnProperty(r)&&(t[r].month=r,n.push(t[r]));return n}});return n}),define("data/ok-to-spend/ok-to-spend-data-manager",["classes/data-manager","data/ok-to-spend/ok-to-spend-collection","data/patterns/patterns-data-manager","data/transactions/transactions-data-manager","data/accounts/accounts-data-manager","classes/remote-error","utils/util"],function(e,t,n,r,i,s,o){var u=e.extend({initialize:function(){this._super.apply(this,arguments),this.collectionDefs={"ok-to-spend":{type:t,subscriptions:[r.events.TRANSACTION_CHANGE,r.events.TRANSACTION_REMOVE,r.events.TRANSACTION_ADD,r.events.TRANSACTION_SPLIT,r.events.TRANSACTION_UNSPLIT,r.events.TRANSACTIONS_IMPORTED,n.events.PATTERN_FOUND,n.events.PATTERN_CHANGE,n.events.PATTERN_REMOVE,n.events.PATTERN_ADD,i.events.ACCOUNTS_UPDATE]}}},get:function(e){return this.getCollection("ok-to-spend",o.pick(e,"fromDate","toDate","showGroupedByMonth","showTransactions","showScheduledTransactions","showRealTransactions","showTotals","showSavingsGoals","showBudget","parentLikeTree","force"))},evaluateRequestParams:function(e,t,n){var r=this._fromDate||t.fromDate,i=this._toDate||t.toDate;n.fromDate=r<t.fromDate?r:t.fromDate||r,n.toDate=i>t.toDate?i:t.toDate||i;if(this._fromDate==null||this._toDate==null||n.fromDate<this._fromDate||n.toDate>this._toDate)n.load=!0;this._fromDate=n.fromDate,this._toDate=n.toDate,this.showGroupedByMonth=t.showGroupedByMonth,this.showTransactions=t.showTransactions,this.showScheduledTransactions=t.showScheduledTransactions,this.showRealTransactions=t.showRealTransactions,this.showTotals=t.showTotals,this.showSavingsGoals=t.showSavingsGoals,this.showBudget=t.showBudget,this.parentLikeTree=t.parentLikeTree},getRequestData:function(){return{fromDateStr:o.date.formatBackendDate(this._fromDate),toDateStr:o.date.formatBackendDate(this._toDate),"params.showGroupedByMonth":this.showGroupedByMonth,"params.showTransactions":this.showTransactions,"params.showScheduledTransactions":this.showScheduledTransactions,"params.showRealTransactions":this.showRealTransactions,"params.showTotals":this.showTotals,"params.showSavingsGoals":this.showSavingsGoals,"params.showBudgets":this.showBudget,"params.parentLikeTree":this.parentLikeTree,"params.recoverAllData":!0}}},{events:{}});return u}),define("services/ok-to-spend-service",["classes/service","data/ok-to-spend/ok-to-spend-data-manager","classes/resource-loader","utils/date"],function(e,t,n,r){var i=e.extend({initialize:function(){this._super.apply(this,arguments),this.okToSpendDM=t.getInstance()},get:function(e){return this.okToSpendDM.get(this.getDefaultDateRange(e))},getFilterFunction:function(e){var t=r.date.formatBackendDate(e.fromDate),n=r.date.formatBackendDate(e.toDate);return function(e){var r=e.month;return t<=r&&r<=n}},getDefaultDateRange:function(e){var t=r.date.constructor.MONTH;return e=typeof e=="string"?r.date.parseBackendDate(e):e,{fromDate:r.date.truncate(t,r.date.add(t,e,-4)),toDate:r.date.ceiling(t,r.date.add(t,e,4))}},getActiveMonth:function(e){var t={showGroupedByMonth:!0,showTransactions:!0,showScheduledTransactions:!0,showRealTransactions:!0,showTotals:!0,showSavingsGoals:!1,showBudget:!1,parentLikeTree:!1},i=r.merge(t,this.getDefaultDateRange(e)),s=new n(this.okToSpendDM,this.okToSpendDM.get,i),o=e.split("-"),u=o[0],a=o[1],f=function(){return s.data.toJSON().filter(function(e){return u+"-"+a===e.month})[0]};return this.executeJob(this,f,[s])},increaseActiveMonth:function(e){return this.changeActiveMonth(e,1)},decreaseActiveMonth:function(e){return this.changeActiveMonth(e,-1)},changeActiveMonth:function(e,t){var n=r.date.constructor.MONTH,i=r.date.parseBackendDate(e);return i=r.date.add(n,i,t),r.date.formatBackendDate(i)}},{ID:"ok-to-spend-service"});return i}),define("data/dashboard/dashboard-model",["classes/model"],function(e){var t=e.extend({url:"/dashboard/get.action"});return t}),define("data/dashboard/dashboard-data-manager",["classes/data-manager","data/dashboard/dashboard-model"],function(e,t){var n=e.extend({initialize:function(){this._super.apply(this,arguments),this.collectionDefs={dashboard:{type:t,subscriptions:["alerts:delete","budget:add","budget:change","budget:remove","savings:goal:add","savings:goal:change","savings:account:change","savings:goal:remove","transaction:add","transaction:change","transaction:remove","transactions:imported","spending-plan:change","account:update"]}},this.params=null},get:function(e){return this.params=e,this.getCollection("dashboard",e)},getRequestData:function(){return this.params}});return n}),define("services/dashboard-service",["classes/service","classes/model","classes/resource-loader","data/dashboard/dashboard-data-manager","utils/util","utils/date"],function(e,t,n,r,i){var s=e.extend({initialize:function(){this._super.apply(this,arguments),this.dashboardDM=r.getInstance()},get:function(e){var t={commitmentUntil:e.commitmentUntil instanceof Date?i.date.formatBackendDate(e.commitmentUntil):e.commitmentUntil,transactionsSince:e.transactionsSince instanceof Date?i.date.formatBackendDate(e.transactionsSince):e.transactionsSince},r=i.merge({},this.resources,{dashboard:new n(this.dashboardDM,this.dashboardDM.get,t)});return this.executeJob(r,this._getTask,r)},_getTask:function(){var e=this.dashboard.data.toJSON(),n={alert:null,count:0},r={alert:null,count:0},i=["danger","warning","succeed"];for(var s=0,o;s<i.length;s++)o=i[s],!n.alert&&e.savings[o]&&(n.alert=o,n.count=e.savings[o]),!r.alert&&e.budget[o]&&(r.alert=o,r.count=e.budget[o]);return new t({messages:{unread:e.alerts},transactions:{unread:e.unreadTransactions},savings:n,budget:r,balance:e.balance,discretionary:e.discretionary,income:e.income,scheduled:e.scheduled,disposable:e.income-e.scheduled-e.discretionary})}},{ID:"dashboard-service"});return s}),define("libs/require/css/css!modules/ok-to-spend-summary/css/ok-to-spend-summary",[],function(){}),define("modules/ok-to-spend-summary/ok-to-spend-summary-module",["classes/item-view","utils/util","services/analysis-service","hbs!modules/ok-to-spend-summary/templates/ok-to-spend-summary","services/ok-to-spend-service","services/dashboard-service","utils/amount","utils/date","css!modules/ok-to-spend-summary/css/ok-to-spend-summary"],function(e,t,n,r,i,s){var o=e.extend({template:r,filtersList:["activeMonth"],initialize:function(){this._super.apply(this,arguments),this.okToSpendService=i.getInstance(),this.dashboardService=s.getInstance()},_getDashboardData:function(){var e=t.date.parseBackendDate(this.globals.environment.serverDate),n=t.date.constructor.DAY,r={transactionsSince:t.date.subtract(n,e,2),commitmentUntil:t.date.add(n,e,this.config.commitmentDays)};return this.dashboardService.get(r)},render:function(e){if(e===!0)this._super();else if(typeof e=="undefined"){var n;this.config.useDashboardEndpoint?n=this._getDashboardData():n=this.okToSpendService.getActiveMonth(this.filters.activeMonth),t.mask(this.$el,t.MASK_LOADING),t.when(n).done(t.bind(this._dataReceived,this)).fail(t.bind(this._dataError,this))}},_dataReceived:function(e){t.unmask(this.$el),this.dataResult=e,this.dataResult.on("change",this.render,this),this.render(!0)},_dataError:function(e){t.unmask(this.$el),console.error("[OkToSpendSummary] Error loading summary ",e),this.publish("error",e)},_formatDashboardData:function(){var e=this.dataResult.data.attributes,t=e.income?e.income:0,n=e.scheduled?e.scheduled:0,r=e.expenses?e.expenses:0,i=e.disposable?e.disposable:0;return e.incomeValue=t,e.expensesValue=n+r,e.disposableValue=i,e},_formatOkToSpendData:function(){var e=this.dataResult.data;return{incomeValue:e.income.total,expensesValue:e.expenses.total,disposableValue:e.disposable.disposableExcludingSavingsGoals}},serializeData:function(){var e=this.config.useDashboardEndpoint?this._formatDashboardData():this._formatOkToSpendData();return e},_filtersChanged:function(){this.render()}},{ID:"ok-to-spend-summary",services:[i,s],defaults:{commitmentDays:30}});return o}),define("ui/modules/tabs/tabs-module-extension",["ui/modules/tabs/tabs-module","modules/ok-to-spend-summary/ok-to-spend-summary-module","jQuery","is!phone?hbs!ui/modules/tabs/templates/tabs-mobile:hbs!ui/modules/tabs/templates/tabs","utils/util","utils/date","css!ui/modules/tabs/css/tabs"],function(e,t,n,r,i){var s=e.extend({template:r,regions:{summaryRegion:".sf-summary-placeholder"},ui:{$tabsContentRegion:".sf-tabs-content"},events:{"click div.sf-tab-label":"tabClicked"},hubEvents:{setActiveTab:"setActiveTab"},initialize:function(){this._super.apply(this,arguments),this.modules=arguments[0].tabsModules},serializeData:function(){var e=i.map(this.modules,function(e){return{moduleId:"sf-"+e.id,customClass:"sf-"+e.id,title:e.title,negative:e.negative,subTitle:e.subTitle}});return{tabs:e}},_createregionsDav:function(){var e=this;this.regionHTMLElems=[],i.each(this.modules,function(t){var r="sf-"+t.id+"-placeholder",i=n("<div></div>"),s="sf-"+t.id;i.addClass("sf-tab-region "+r),i.prop("id",s),e.ui.$tabsContentRegion.append(i),e.regionHTMLElems.push(i),e.addRegion(s,"."+r),e[s].show(t.content),i.hide()}),this.$(".sf-tab-label-value").last().removeClass("sf-tab-inactive"),this.regionHTMLElems[this.regionHTMLElems.length-1].show()},onRender:function(){this.contextConfig.widget.id==="ok-to-spend"&&this.summaryRegion.show(new t(i.merge(this.contextConfig))),this._createregionsDav()},getActiveTab:function(){var e=this.$(".sf-tab-label-value").not(".sf-tab-inactive");return e.length===0?null:e.closest(".sf-tab-label")[0].id},tabClicked:function(e){if(i.isPhone()&&this.getActiveTab()===e.currentTarget.id){this.deactivateAllTabs();return}this._setActiveTab(e.currentTarget.id)},setActiveTab:function(e){this._setActiveTab("sf-"+e)},_setActiveTab:function(e){this.deactivateAllTabs(),this.$("#"+e).find(".sf-tab-label-value").removeClass("sf-tab-inactive");var t=this.regionHTMLElems.filter(function(t){return t[0].id===e});t[0].show()},deactivateAllTabs:function(){this.$(".sf-tab-label-value").addClass("sf-tab-inactive"),i.each(this.regionHTMLElems,function(e){e.hide()})}},{ID:"tabs",defaults:{}});return s}),define("hbs!ui/modules/tabs/templates/tabs-networth",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i,s;r+='\n			<div class="sf-tab-label ',(i=n.customClass)?i=i.call(e,{hash:{}}):(i=e.customClass,i=typeof i===u?i.apply(e):i),r+=a(i)+'" id="'+a((i=e.moduleId,typeof i===u?i.apply(e):i))+'">\n				<div class="sf-tab-label-value sf-tab-inactive">\n					<h2 class="sf-tab-label-title">'+a((i=e.title,typeof i===u?i.apply(e):i))+'</h2>\n					<p class="sf-tab-label-subtitle">',s=(i=e.subTitle,typeof i===u?i.apply(e):i);if(s||s===0)r+=s;return r+="</p>\n				</div>\n			</div>\n		",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="sf-tabs">\n	<div class="sf-tabs-titles">\n		',o=n.each.call(t,t.tabs,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;return s+='\n	</div>\n	<div class="sf-tabs-content">\n	</div>\n</div>',s});return t.registerPartial("ui_modules_tabs_templates_tabs-networth",n),n}),define("ui/modules/tabs/tabs-module-networth",["ui/modules/tabs/tabs-module-extension","jQuery","hbs!ui/modules/tabs/templates/tabs-networth","utils/util","utils/date"],function(e,t,n,r){var i=e.extend({template:n,regions:{summaryRegion:".sf-summary-placeholder"},ui:{$tabsContentRegion:".sf-tabs-content"},events:{"click div.sf-tab-label":"tabClicked"},hubEvents:{setActiveTab:"setActiveTab"},initialize:function(){this._super.apply(this,arguments),this.modules=arguments[0].tabsModules},serializeData:function(){var e=r.map(this.modules,function(e){return{moduleId:"sf-"+e.id,customClass:"sf-"+e.id,title:e.title,subTitle:e.subTitle}});return{tabs:e}},_createregionsDav:function(){var e=this;this.regionHTMLElems=[],r.each(this.modules,function(n){var r="sf-"+n.id+"-placeholder",i=t("<div></div>"),s="sf-"+n.id;i.addClass("sf-tab-region "+r),i.prop("id",s),e.ui.$tabsContentRegion.append(i),e.regionHTMLElems.push(i),e.addRegion(s,"."+r),i.hide()}),e["sf-summary"].show(new this.modules[0].content(this.modules[0].opts)),this.modules[0].visible=!0,this.$(".sf-tab-label-value").first().removeClass("sf-tab-inactive"),this.regionHTMLElems[0].show()},onRender:function(){this._createregionsDav()},getActiveTab:function(){var e=this.$(".sf-tab-label-value").not(".sf-tab-inactive");return e.length===0?null:e.closest(".sf-tab-label")[0].id},tabClicked:function(e){this._setActiveTab(e.currentTarget.id)},setActiveTab:function(e){this._setActiveTab("sf-"+e)},_setActiveTab:function(e){this.deactivateAllTabs(),this.$("#"+e).find(".sf-tab-label-value").removeClass("sf-tab-inactive");var t=this.regionHTMLElems.filter(function(t){return t[0].id===e});e.indexOf("details")>=0&&!this.modules[1].visible&&(this["sf-details"].show(new this.modules[1].content(this.modules[1].opts)),this.modules[1].visible=!0),e==="sf-summary"&&(r.pushToDataLayer({eventCategory:"PFM Patrimonio",eventAction:"Boton",eventLabel:"Resumen",event:"eventClick"}),this.publish("networth:cloumnchart:refresh")),e==="sf-details"&&r.pushToDataLayer({eventCategory:"PFM Patrimonio",eventAction:"Boton",eventLabel:"Detalle",event:"eventClick"}),t[0].show()},deactivateAllTabs:function(){this.$(".sf-tab-label-value").addClass("sf-tab-inactive"),r.each(this.regionHTMLElems,function(e){e.hide()})}},{ID:"tabs",defaults:{}});return i}),define("hbs!modules/networth-summary/templates/networth-summary",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-networth-summary">\n	<div class="sf-networth-summary-region"></div>\n	<div class="sf-networth-content-filters-region"></div>\n	<div class="sf-networth-content-overtime-region"></div>\n</div>'});return t.registerPartial("modules_networth-summary_templates_networth-summary",n),n}),define("modules/networth-summary/networth-summary-module",["classes/layout","modules/networth-ytd-header/networth-ytd-header-module","modules/networth-overtime/networth-overtime-module","modules/networth-future-overtime/networth-future-overtime-module","modules/networth-product-manager/networth-product-manager-module","modules/networth-filters/networth-filters-module","hbs!modules/networth-summary/templates/networth-summary","utils/util"],function(e,t,n,r,i,s,o,u){var a=e.extend({template:o,filtersList:["networthPeriod","projectionRange","datesRange","networthCategory"],hubEvents:{"networth:cloumnchart:refresh":"_refreshChart"},regions:{summaryRegion:".sf-networth-summary-region",filtersRegion:".sf-networth-content-filters-region",overtimeRegion:".sf-networth-content-overtime-region"},initialize:function(e){this._super.apply(this,arguments),this._pastCharts={charts:e.past.charts,config:e.past.config||{}},this._futureCharts={charts:e.future.charts,config:e.future.config||{}}},_getOvertime:function(){var e=u.merge({},this.contextConfig,this._pastCharts);return new n(e)},_getFutureOvertime:function(){var e=u.merge({},this.contextConfig,this._futureCharts);return new r(e)},_getNetworthFilter:function(){var e=u.merge({},this.contextConfig,{config:this.config});return new s(e)},onRender:function(){this._super(),this.summaryRegion.show(new t(this.contextConfig)),this.filtersRegion.show(this._getNetworthFilter()),this.filters.networthPeriod=="future"?this.overtimeRegion.show(this._getFutureOvertime()):this.overtimeRegion.show(this._getOvertime())},_refreshChart:function(){this.overtimeRegion.show(this._getOvertime())},_filtersChanged:function(e,t){e=="networthPeriod"&&(t=="future"?this.overtimeRegion.show(this._getFutureOvertime()):this.overtimeRegion.show(this._getOvertime()))}},{ID:"networth-summary",submodules:[n,r,i,s],defaults:{}});return a}),define("hbs!modules/networth-details/templates/networth-details",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-networth-details">\n	<div class="sf-networth-content-products-region"></div>\n</div>'});return t.registerPartial("modules_networth-details_templates_networth-details",n),n}),define("modules/networth-details/networth-details-module",["classes/layout","modules/networth-overtime/networth-overtime-module","modules/networth-future-overtime/networth-future-overtime-module","modules/networth-product-manager/networth-product-manager-module","modules/networth-filters/networth-filters-module","hbs!modules/networth-details/templates/networth-details","utils/util"],function(e,t,n,r,i,s,o){var u=e.extend({template:s,filtersList:["networthPeriod","projectionRange","datesRange","networthCategory"],regions:{productsRegion:".sf-networth-content-products-region"},initialize:function(e){this._super.apply(this,arguments),this._pastCharts={charts:e.past.charts,config:e.past.config||{}},this._futureCharts={charts:e.future.charts,config:e.future.config||{}}},_getOvertime:function(){var e=o.merge({},this.contextConfig,this._pastCharts);return new t(e)},_getFutureOvertime:function(){var e=o.merge({},this.contextConfig,this._futureCharts);return new n(e)},_getNetworthFilter:function(){var e=o.merge({},this.contextConfig,{config:this.config});return new i(e)},onRender:function(){this._super(),this.productsRegion.show(new r(this.contextConfig))},_filtersChanged:function(e,t){}},{ID:"networth-content",submodules:[t,n,r,i],defaults:{}});return u}),define("hbs!classes/networth/templates/networth-overtime-empty",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-empty sf-networth-chart-emtpty">\n	',u={hash:{}},s+=f((o=n.t,o?o.call(t,t.emptyMessage,u):a.call(t,"t",t.emptyMessage,u)))+"\n</div>",s});return t.registerPartial("classes_networth_templates_networth-overtime-empty",n),n}),define("libs/require/css/css!classes/networth/css/networth-overtime-chart",[],function(){}),define("classes/networth/networth-overtime-chart",["classes/layout","classes/model","services/networth-service","hbs!classes/networth/templates/networth-overtime-empty","ui/modules/reform/checkbox/checkbox-module","utils/mask","css!classes/networth/css/networth-overtime-chart"],function(e,t,n,r,i,s){var o=e.extend({filtersList:["datesRange","networthPeriod","projectionRange","networthCategory"],ui:{controls:".sf-networth-overtime-controls-form",labels:".sf-networth-overtime-controls-form label",chart:".sf-networth-overtime-chart-placeholder"},events:{"change .sf-networth-overtime-controls-form input":"_changeFilter","click .sf-networth-overtime-controls-form label":"_labelClickHandler"},regions:{chartRegion:".sf-networth-overtime-chart-placeholder"},reformSelector:"ReForm.Checkbox",chartView:null,template:null,emptyTemplate:r,serializeData:function(){},parseSeries:function(e,t,n){return{formFilters:e,filters:this.filters,overtime:t,categories:n}},initialize:function(){this._super.apply(this,arguments),this._service=n.getInstance(),this._dataReceived=s.bind(this._dataReceived,this),this._dataChanged=s.bind(this._dataChanged,this),this._dataError=s.bind(this._dataError,this),this._changeFilter=s.debounce(s.bind(this._changeFilter,this),this.config.debounceTime)},onRender:function(){this._super(),this.$el.addClass("sf-networth-overtime-chart"),i.init(this.$el),this._updateView()},_updateView:function(){if(this.isClosed)return;var e=this;s.mask(e.$el,s.MASK_LOADING),console.log("["+this.constructor.ID+"] Updating view",this.cid);var t=this.filters.networthPeriod=="future"?e._service.overtimeProjection({years:this.filters.projectionRange}):e._service.overtime(this.filters.datesRange),n=e._service.categories();this.dispose(),s.when(t,n).done(this._dataReceived).fail(this._dataError)},_changeFilter:function(){if(this._overtime){var e=s.serializeForm(this.ui.controls);s.size(e)==1?this._disableActiveElement():this._enableAllElements(),this._dataChanged(this._overtime)}},_disableActiveElement:function(){var e=this.ui.controls.find(".sf-checked").addClass("sf-disabled").find("input[type=checkbox]").data(this.reformSelector);e&&(e.disabled=!0)},_enableAllElements:function(){var e=this.ui.controls.find(".sf-disabled").removeClass("sf-disabled").find("input[type=checkbox]").data(this.reformSelector);e&&(e.disabled=!1)},_labelClickHandler:function(e){var t=this.$(e.currentTarget),n=t.attr("for"),r=t.parent().find("input[name="+n+"]"),i=r.data(this.reformSelector);i.toggle()},_dataReceived:function(e,t){s.unmask(this.$el),this.dispose(),this._overtime=e,this._categories=t,e.on("change",this._dataChanged),this._dataChanged(e)},_dataChanged:function(e){if(!e.data.length)this.chartRegion.close(),this.ui.chart.html(this.emptyTemplate({emptyMessage:this.config.emptyMessage}));else{var n=s.serializeForm(this.ui.controls),r=this.parseSeries(n,e.data,this._categories.data);if(!r)this.chartRegion.close(),this.ui.chart.html(this.emptyTemplate({emptyMessage:this.config.emptyMessage}));else if(this.chartRegion.currentView)this.chartRegion.currentView.model.clear({silent:!0}),this.chartRegion.currentView.model.set(r);else{var i=s.merge({},this.contextConfig,{model:new t(r)}),o=new this.chartView(i);this.chartRegion.show(o),o.on("point:selected",this._pointSelectedHandler,this)}}},_pointSelectedHandler:function(e){e.id&&this.publish("filters:change",{filter:"networthCategory",data:e.id})},_dataError:function(e){s.unmask(this.$el),console.error("[NetworthOvertimeChart] Failed to retrieve data",e),this.publish("error",e),this.dispose()},dispose:function(){this._overtime&&(this._overtime.dispose(),this._overtime=null),this._categories&&(this._categories.dispose(),this._categories=null),this.chartRegion&&this.chartRegion.currentView&&this.chartRegion.currentView.off("change",this._pointSelectedHandler)},onClose:function(){this.dispose()},_filtersChanged:function(e){if(this.isClosed)return;e=="datesRange"&&this._updateView(),e=="projectionRange"&&this._updateView(),e=="networthCategory"&&this._updateView()}},{ID:"networth-overtime-chart",services:[n],defaults:{debounceTime:10,emptyMessage:"networth-overtime.emptyMessage"}});return o}),define("classes/networth/networth-overtime-chart-extension",["classes/networth/networth-overtime-chart","classes/model","services/networth-service","hbs!classes/networth/templates/networth-overtime-empty","ui/modules/reform/checkbox/checkbox-module","utils/mask","css!classes/networth/css/networth-overtime-chart"],function(e,t,n,r,i,s){var o=e.extend({_updateView:function(){if(this.isClosed)return;var e=this;console.log("["+this.constructor.ID+"] Updating view",this.cid);var t=this.filters.networthPeriod=="future"?e._service.overtimeProjection({years:this.filters.projectionRange}):e._service.overtime(this.filters.datesRange),n=e._service.categories();this.dispose(),s.when(t,n).done(this._dataReceived).fail(this._dataError)},_pointSelectedHandler:function(e){}});return o}),define("modules/networth-overtime-columnchart/views/networth-overtime-columnchart-d3-chart",["ui/modules/columnchart/columnchart-module","d3","utils/amount"],function(e,t,n){var r=e.extend({initialize:function(){this._super.apply(this,arguments),this.jq=this.options.$},_drawYaxis:function(){var e=this,n=e._content.width,r=t.svg.axis().tickValues(e._ticks).tickSize(-n,0,-n).scale(e._yScale).tickFormat(function(t,n){return e.getYaxisFormat(t,n,e)}).orient(e.yAxisRight?"right":"left"),i={"class":"sf-chart-axis sf-chart-axis-vertical",transform:"translate("+e._axis.y.left+", "+e._axis.y.top+")"},s=e.$svg.append("g").attr(i).call(r);return e.enableRTL&&s.selectAll(".tick text").style("text-anchor",e.yAxisRight?"end":"start"),s.selectAll(".tick text").attr("x",-22),s},draw:function(e){this._labelTextCollision=!1,this._labelCollision=!1;if(n.isEmpty(e))return;var r=this,i;this.$el.html(""),this.$svg=t.select(this.el).append("svg").style({width:"100%",height:"100%"}),r._preprocessData(e),i=r._initializeCanvas(e.axis),this.options.navigation=!0,this.options.navigation&&r._drawNavigationArrows(i),r._y0=r._yScale(0),r._drawStacks(i,r._stacks,e.axis.x),r._drawColumns(r._stacks.length,i,r._columns,e.axis.x),r._drawZeroLine(i),r._drawLines(i,r._lines,e.axis.x)},_drawNavigationArrows:function(e){this.$el.css("position","relative");var t=this;if(this.options.navigatePast){var n=this.jq("<div/>").attr("class","sf-navigate-past").css({position:"absolute",left:this.$el.width()*.15+"px",top:this.$el.height()*.36+"px"});n.click(function(){t.trigger("navigatePast")}),n.appendTo(this.$el)}if(this.options.navigateFuture){var r=this.jq("<div/>").attr("class","sf-navigate-future").css({position:"absolute",left:this.$el.width()*.93+"px",top:this.$el.height()*.36+"px"});r.click(function(){t.trigger("navigateFuture")}),r.appendTo(this.$el)}},getYaxisFormat:function(e){return n.unicodeHTMLCodes(n.amount.format(e,!1))},getXaxisFormat:function(e,r,i){var s=t.select(i.parentNode),o=this._xScale.rangeBand(),u=n.date.format(e,"MMM yy"),a={"class":"sf-chart-axis-label-month",dx:"-3em",dy:".21em"};return t.select(i).text(u).attr(a),i.getBoundingClientRect().width>o-this.config.minLabelMargin&&(this._labelTextCollision=!0),u},solveLabelsCollision:function(){var e=this,t=e._labelCollision?"SHORT_MONTH":"SHORT_MONTH_YEAR",r="text.sf-chart-axis-label-month",i="text.sf-chart-axis-label-assets",s="text.sf-chart-axis-label-liabilities",o=e._$xAxis;e._labelTextCollision&&o.selectAll(r).text(function(e){return n.date.format(e,n.date.constructor[t])});if(e._labelCollision){var u=e._columnScale.rangeBand(),a=o.selectAll(r),f=a.node(),l=f.getBoundingClientRect().height,c=f.getAttribute("dy"),h=parseInt(f.getAttribute("y"),10),p={dy:-u/2,transform:"rotate(90)",style:"text-anchor: start",x:l+h,dx:c,"dominant-baseline":"middle"};a.attr({x:0,style:"text-anchor: middle"}),e.enableRTL&&(p.transform="rotate(-90)",p.x*=-1,p.dx="-"+p.dx),o.selectAll(i).attr(p),p.dy+=u,o.selectAll(s).attr(p),o.selectAll("text.sf-chart-axis-label-networth").attr({style:"display:none"})}},_afterDOMInsertRender:function(){this.contextConfig.$widget.off("elementResize",this.resizeHandler),this.trigger("draw:before",this),this.draw(this.model.toJSON()),this._attachTooltips(),this.trigger("draw",this),this._registerResizeHandler(),this.publish("networthColumnchartRendered")},_drawColumns:function(e,t,n,r){var i=this,s={"class":function(e,t){var n=["sf-chart-column-serie sf-chart-serie-"+t];return e["class"]&&n.push(e["class"]),n.join(" ")}},o={"class":i._pointClass,x:function(t,n){return i._columnScale(e+t._serieIndx)+i._xScale(r[n])},y:this._y0,fill:function(e){return e.color},title:function(e){return e.title},"touch-tooltip":1,height:0,width:i._columnScale.rangeBand()},u={y:function(e){return Math.min(i._y0,i._yScale(e.value))},height:function(e){var t=Math.abs(e.value),n=i._yScale(t);return Math.abs(i._y0-n)}},a=t.selectAll("g.sf-chart-column-serie").data(n).enter().append("g").attr(s).selectAll("rect.sf-chart-point").data(function(e){return e.points}).enter().append("rect").attr(o).on("click",function(e,t){i.onClick(e,t,this)}).transition().duration(this.config.transitionDuration).attr(u);this._$columns=a,a.selectAll("rect.sf-chart-point").attr("touch-tooltip",1)},_attachTooltips:function(){this.config.tooltipEnable&&(this._$tooltips=this.$(this.tooltipSelector),this._$tooltips.attr("touch-tooltip",1),n.tooltip.add(this._$tooltips,n.merge({},this.tooltipOptions,{position:{target:"mouse",adjust:{x:0,y:0},container:this.$el.closest(".sf-networth-content")}},this.tooltipExtra)))},_drawXaxis:function(){var e=this,n=t.svg.axis().tickSize(0).scale(e._xScale).tickFormat(function(t,n){return e.getXaxisFormat(t,n,this)}).orient("bottom");return e.$svg.append("g").attr({"class":"sf-chart-axis sf-chart-axis-horizontal",transform:"translate("+e._axis.x.left*1.22+","+e._axis.x.top*1+")"}).call(n)}},{defaults:{minLabelMargin:5,labelAlign:"right",pointRadius:4}});return r}),define("hbs!modules/networth-overtime-columnchart/templates/networth-overtime-columnchart-table",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-networth-overtime-columnchart-table"></div>'});return t.registerPartial("modules_networth-overtime-columnchart_templates_networth-overtime-columnchart-table",n),n}),define("modules/networth-overtime-columnchart/views/networth-overtime-columnchart-table",["classes/item-view","hbs!modules/networth-overtime-columnchart/templates/networth-overtime-columnchart-table","classes/collection","utils/util","ui/modules/datagrid/datagrid-module","utils/amount","utils/number","utils/percentage"],function(e,t,n,r,i){var s=i.DatagridColumn,o=e.extend({template:t,initialize:function(){this._super.apply(this,arguments),this.gridConfig={columns:[new s({parent:this,headerClass:"sf-date-header",columnClass:"sf-date-col",formatter:this._dateFormatter,field:"date",label:r.i18n.get("networth-overtime-columnchart.accessible.header.month"),sortable:!1}),new s({parent:this,field:"category",formatter:this._categoryFormatter,columnClass:"sf-category-col",label:r.i18n.get("networth-overtime-columnchart.accessible.header.category"),sortable:!1}),new s({parent:this,columnClass:"sf-numeric sf-amount-col",field:"amount",formatter:function(e){return r.amount.format(e.get("amount"))},label:r.i18n.get("networth-overtime-columnchart.accessible.header.amount"),headerClass:"sf-amount-header sf-numeric",sortable:!1})]}},onShow:function(){this.model.on("change",this.render,this)},onClose:function(){this.model.off("change",this.render)},onRender:function(){this._super();var e=this.model.get("data"),t=this;if(e){var s=r.extend({dataSource:new n(e),config:t.gridConfig,container:t.$el},this.contextConfig);this.datagrid=new i(s),t.datagrid.render()}},_dateFormatter:function(e,t,n){var r=e.get("dataDate"),i;return n>0&&(i=t.at(n-1).get("dataDate")),i===r?"":(i=r,e.get("formattedDate"))},_categoryFormatter:function(e,t,n,r){return e.get("stressedStyle")&&(r.classes=r.classes||[],r.classes.push("sf-networth-category")),e.get("category")}},{});return o}),define("hbs!modules/networth-overtime-columnchart/templates/networth-point-tooltip",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i;return r+="\n<br/>",(i=n.variaton)?i=i.call(e,{hash:{}}):(i=e.variaton,i=typeof i===f?i.apply(e):i),r+=l(i)+"\n",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;(o=n.date)?o=o.call(t,{hash:{}}):(o=t.date,o=typeof o===f?o.apply(t):o),s+=l(o)+"\n<br/>",(o=n.title)?o=o.call(t,{hash:{}}):(o=t.title,o=typeof o===f?o.apply(t):o),s+=l(o)+" : ",a={hash:{}},u=(o=n.formatAmount,o?o.call(t,t.value,a):c.call(t,"formatAmount",t.value,a));if(u||u===0)s+=u;s+="\n",u=n["if"].call(t,t.variaton,{hash:{},inverse:h.noop,fn:h.program(1,p,i)});if(u||u===0)s+=u;return s});return t.registerPartial("modules_networth-overtime-columnchart_templates_networth-point-tooltip",n),n}),define("modules/networth-overtime-columnchart/views/networth-overtime-columnchart-accessible-chart",["classes/ui/chart/accessible-chart","is!ie8?modules/networth-overtime-columnchart/views/networth-overtime-columnchart-hc-chart:modules/networth-overtime-columnchart/views/networth-overtime-columnchart-d3-chart","modules/networth-overtime-columnchart/views/networth-overtime-columnchart-table","hbs!modules/networth-overtime-columnchart/templates/networth-point-tooltip","utils/util","utils/percentage","utils/amount","utils/date"],function(e,t,n,r,i){var s=e.extend({accessibleViewConstructor:n,chartConstructor:t,parseSeries:function(e){var t=e.formFilters,n=e.filters,s=e.overtime,o=e.categories,u=[],a=function(e,t){if(n.networthCategory==null||t.id==n.networthCategory)t.get("asset")&&(e[t.id+"-asset"]={label:t.get("namePluralI18n"),color:"#"+t.get("positiveColor"),"class":"sf-networth-overtime-category-"+t.id,points:[],data:t,options:{stack:0}}),t.get("liability")&&(e[t.id+"-liability"]={label:t.get("namePluralI18n"),color:"#"+t.get("negativeColor"),"class":"sf-networth-overtime-category-"+t.id,points:[],data:t,options:{stack:n.networthCategory!=null?0:1}});return e},f=o.reduce(a,{}),l={label:i.i18n.get("networth-overtime-columnchart.series.networth.label"),color:this.config.series.networth.color,"class":"sf-networth-overtime-networth",options:{type:"line"},points:[]},c=function(e,t){if(!e)return"";if(e*t<0)return"";e=Math.abs(e),t=Math.abs(t);var n=(e-t)*100/e;return n?n>0?i.i18n.get("networth-overtime-columnchart.variations.less",{qty:i.percentage.format(n)}):(n*=-1,i.i18n.get("networth-overtime-columnchart.variations.more",{qty:i.percentage.format(n)})):i.i18n.get("networth-overtime-columnchart.variations.equal")},h=function(e){if(e.networthPeriod=="past")return i.date.datesInPeriod(i.date.constructor.MONTH,e.datesRange.fromDate,e.datesRange.toDate);var t=i.date.today(),n=[t],r;t.setDate(1);for(var s=1;s<=e.projectionRange;s++)r=i.date.today(),r.setDate(1),r.setFullYear(r.getFullYear()+s),n.push(r);return n}(n),p=[],d=function(e,o,u){var a=i.date.format(o,i.date.constructor.MEDIUM_MONTH_YEAR),h=i.date.formatBackendDate(o),d=s.get(h),v={},m=function(t,i){var s=t.id,u=v[s]=t.amount,l=s+"-"+i,h=f[l],p=e[s],d=c(p,u);i==="liability"&&(u=Math.abs(u));if(n.networthCategory==null||n.networthCategory==s){var m=i==="asset"?"assetsAmount":"liabilitiesAmount";o[m]+=u,o[m+"Enabled"]=!0,h&&h.points.push({value:u,title:r({date:a,title:h.label,value:u,variaton:d})})}},g=function(e){e.points[u]||(e.points[u]={value:0})},y=d?d.get("assetsAmount")+d.get("liabilitiesAmount"):0;o.assetsAmount=0,o.liabilitiesAmount=0,p.push(o);if(!d)i.each(f,function(e){e.points.push({value:0})}),l.points.push({value:0,title:r({date:a,title:l.label,value:0})});else{if(t.products){var b=0;for(b=0;b<d.get("assets").length;b++)m(d.get("assets")[b],"asset");for(b=0;b<d.get("liabilities").length;b++)m(d.get("liabilities")[b],"liability");i.each(f,g)}t.total&&(l.points.push({value:y,title:r({date:a,title:l.label,value:y,variaton:c(e.networth,y)})}),o.networthValue=y,v.networth=y)}return v};return i.reduce(h,d,{}),t.total&&u.push(l),t.products&&i.each(f,function(e){u.push(e)}),{series:u,axis:{x:p}}},parseTabularSeries:function(e){var t=[],n=this;return i.each(e.overtime.models,function(r){var s=r.attributes.date,o=i.date.format(s,n.config.dataDateFormats[n.config.stepScale]),u=i.date.format(s,n.config.dateTableFormats[n.config.stepScale]),a=0,f=0;e.formFilters.products&&t.push({date:s,dataDate:o,formattedDate:u,category:i.i18n.get("networth-overtime-columnchart.accessible.assets"),stressedStyle:!0,amount:0});var l=t.length-1;i.each(r.get("assets"),function(n){a+=n.amount,e.formFilters.products&&(e.filters.networthCategory==null||e.filters.networthCategory==n.id)&&t.push({date:s,dataDate:o,formattedDate:u,category:n.category.attributes.namePluralI18n,amount:n.amount})}),e.formFilters.products&&(t[l].amount=a,t.push({date:s,dataDate:o,formattedDate:u,category:i.i18n.get("networth-overtime-columnchart.accessible.liabilities"),stressedStyle:!0,amount:0}));var c=t.length-1;i.each(r.get("liabilities"),function(n){var r=Math.abs(n.amount);f+=r,e.formFilters.products&&(e.filters.networthCategory==null||e.filters.networthCategory==n.id)&&t.push({date:s,dataDate:o,formattedDate:u,category:n.category.attributes.namePluralI18n,amount:r})}),e.formFilters.products&&(t[c].amount=f),e.formFilters.total&&t.push({date:s,dataDate:o,formattedDate:u,category:i.i18n.get("networth-overtime-columnchart.accessible.networthCategory"),stressedStyle:!0,amount:a-f})}),{data:i.flatten(t)}}},{defaults:{series:{networth:{color:"#535353"}},dateAxisFormat:i.date.constructor.LONG_MONTH,stepScale:"month",dataDateFormats:{day:i.date.constructor.BACKEND_FORMAT,month:i.date.constructor.BACKEND_MONTH_YEAR_FORMAT},dateTableFormats:{day:i.date.constructor.SHORT_DATE,month:i.date.constructor.LONG_MONTH_YEAR},dateFormats:{day:i.date.constructor.SHORT_DATE,month:i.date.constructor.LONG_MONTH},emptyMessage:"analysis-accessible-chart.empty",showDecimals:!1}});return s}),define("hbs!modules/networth-overtime-columnchart/templates/dav-networth-columnchart-template",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing;s+='<div class="sf-networth-overtime-tooltip-container">\n	<span class="sf-net-over-tooltip-title">',(o=n.date)?o=o.call(t,{hash:{}}):(o=t.date,o=typeof o===f?o.apply(t):o),s+=l(o)+'</span>\n	<br/>\n	<span class="sf-net-over-tooltip-amount-title">',(o=n.assetTitle)?o=o.call(t,{hash:{}}):(o=t.assetTitle,o=typeof o===f?o.apply(t):o),s+=l(o)+":</span>\n	",a={hash:{}},u=(o=n.formatAmount,o?o.call(t,t.assetValue,a):c.call(t,"formatAmount",t.assetValue,a));if(u||u===0)s+=u;s+='\n	<br/>\n	<span class="sf-net-over-tooltip-amount-title">',(u=n.liabsTitle)?u=u.call(t,{hash:{}}):(u=t.liabsTitle,u=typeof u===f?u.apply(t):u),s+=l(u)+":</span>\n	  ",a={hash:{}},u=(o=n.formatAmount,o?o.call(t,t.liabsValue,a):c.call(t,"formatAmount",t.liabsValue,a));if(u||u===0)s+=u;s+='\n	<br/>\n	<span class="sf-net-over-tooltip-amount-title">',(u=n.networthTitle)?u=u.call(t,{hash:{}}):(u=t.networthTitle,u=typeof u===f?u.apply(t):u),s+=l(u)+":</span> ",a={hash:{}},u=(o=n.formatAmount,o?o.call(t,t.networthAmount,a):c.call(t,"formatAmount",t.networthAmount,a));if(u||u===0)s+=u;return s+="\n</div>\n",s});return t.registerPartial("modules_networth-overtime-columnchart_templates_dav-networth-columnchart-template",n),n}),define("modules/networth-overtime-columnchart/views/networth-overtime-columnchart-accessible-chart-extension",["modules/networth-overtime-columnchart/views/networth-overtime-columnchart-accessible-chart","is!ie8?modules/networth-overtime-columnchart/views/networth-overtime-columnchart-hc-chart:modules/networth-overtime-columnchart/views/networth-overtime-columnchart-d3-chart","modules/networth-overtime-columnchart/views/networth-overtime-columnchart-table","classes/model","jQuery","hbs!modules/networth-overtime-columnchart/templates/networth-point-tooltip","hbs!modules/networth-overtime-columnchart/templates/dav-networth-columnchart-template","utils/util","utils/percentage","utils/amount","utils/date"],function(e,t,n,r,i,s,o,u){var a=e.extend({accessibleViewConstructor:n,chartConstructor:t,initialize:function(e){var t=this,n=function(n){return u.merge({},t.contextConfig,{model:new r,$:i},t.config[n],e[n])};this.chartView=e.chartView||new this.chartConstructor(n("chartOptions")),this.accessibleView=e.accessibleView||new this.accessibleViewConstructor(n("tableOptions")),this.emptyView=e.emptyView||new this.emptyViewConstructor(u.merge(n("emptyOptions"),{emptyMessage:this.config.emptyMessage})),this.currentViewType=this.config.viewType,this.createMonthTooltips=u.bind(this.createMonthTooltips,this)},parseSeries:function(e){var t=e.formFilters,n=e.filters,r=e.overtime,i=e.categories,o=[],a="#2287d9",f="#cb3816",l=this,c=function(e,t){if(n.networthCategory==null||t.id==n.networthCategory)t.get("asset")&&(e[t.id+"-asset"]={label:t.get("namePluralI18n"),color:a,"class":"sf-networth-overtime-category-"+t.id,points:[],data:t,options:{stack:0}}),t.get("liability")&&(e[t.id+"-liability"]={label:t.get("namePluralI18n"),color:f,"class":"sf-networth-overtime-category-"+t.id,points:[],data:t,options:{stack:n.networthCategory!=null?0:1}});return e},h=i.reduce(c,{}),p={label:u.i18n.get("networth-overtime-columnchart.series.networth.label"),color:this.config.series.networth.color,"class":"sf-networth-overtime-networth",options:{type:"line"},points:[]},d=function(e,t){if(!e)return"";if(e*t<0)return"";e=Math.abs(e),t=Math.abs(t);var n=(e-t)*100/e;return n?n>0?u.i18n.get("networth-overtime-columnchart.variations.less",{qty:u.percentage.format(n)}):(n*=-1,u.i18n.get("networth-overtime-columnchart.variations.more",{qty:u.percentage.format(n)})):u.i18n.get("networth-overtime-columnchart.variations.equal")},v=function(e){if(e.networthPeriod=="past")return u.date.datesInPeriod(u.date.constructor.MONTH,e.datesRange.fromDate,e.datesRange.toDate);var t=u.date.today(),n=[t],r;t.setDate(1);for(var i=1;i<=e.projectionRange;i++)r=u.date.today(),r.setDate(1),r.setFullYear(r.getFullYear()+i),n.push(r);return n}(n),m=[],g=function(e,i,o){var a=u.date.format(i,u.date.constructor.MEDIUM_MONTH_YEAR),f=u.date.formatBackendDate(i),c=r.get(f),v={},g=function(t){var r=t.id,o=v[r]=t.amount,u=r+"-"+(o>0?"asset":"liability"),f=h[u],l=e[r],c=d(l,o);o=Math.abs(o);if(n.networthCategory==null||n.networthCategory==r){var p=t.amount>0?"assetsAmount":"liabilitiesAmount";i[p]+=o,i[p+"Enabled"]=!0,f&&f.points.push({value:o,date:i,title:s({date:a,title:f.label,value:o,variaton:c})})}},y=function(e){e.points[o]||(e.points[o]={value:0})},b=c?c.get("assetsAmount")+c.get("liabilitiesAmount"):0;return i.assetsAmount=0,i.liabilitiesAmount=0,m.push(i),c?(t.products&&(l.createMonthTooltips(c),u.each(c.get("assets"),g),u.each(c.get("liabilities"),g),u.each(h,y)),t.total&&(p.points.push({value:b,title:s({date:a,title:p.label,value:b,variaton:d(e.networth,b)})}),i.networthValue=b,v.networth=b)):(u.each(h,function(e){e.points.push({value:0})}),p.points.push({value:0,title:s({date:a,title:p.label,value:0})})),v};return u.reduce(v,g,{}),t.total&&o.push(p),t.products&&u.each(h,function(e){o.push(e)}),u.each(o,function(e){u.each(e.points,function(e){e.date&&(e.title=l.monthTooltips[u.date.format(e.date,"yyyy-MM")])})}),{series:o,axis:{x:m}}},createMonthTooltips:function(e){this.monthTooltips||(this.monthTooltips=[]);if(!this.monthTooltips[e.id.substring(0,7)]){var t=u.date.format(e.get("date"),"MMMM yyyy");this.monthTooltips[e.id.substring(0,7)]=o({date:t,assetTitle:u.i18n.get("networth-overtime.tooltip.assets"),liabsTitle:u.i18n.get("networth-overtime.tooltip.liabs"),networthTitle:u.i18n.get("networth-overtime.tooltip.networth"),assetValue:Math.floor(e.get("assetsAmount")),liabsValue:Math.abs(Math.floor(e.get("liabilitiesAmount"))),networthAmount:Math.floor(e.get("assetsAmount"))-Math.abs(Math.floor(e.get("liabilitiesAmount")))})}}});return a}),define("hbs!modules/networth-overtime-columnchart/templates/networth-overtime-columnchart-mobile",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-networth-overtime-columnchart">\n	<div class="sf-networth-overtime-controls">\n		<form class="sf-networth-overtime-controls-form">\n			<div class="sf-networth-overtime-controls-products">\n				',u={hash:{checked:t.products,name:"products"}},s+=f((o=n.checkbox,o?o.call(t,u):a.call(t,"checkbox",u)))+'\n				<label for="products">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-overtime-columnchart.controls.products",u):a.call(t,"t","networth-overtime-columnchart.controls.products",u)))+'</label>\n			</div>\n			<div class="sf-networth-overtime-controls-total">\n				',u={hash:{checked:t.total,name:"total"}},s+=f((o=n.checkbox,o?o.call(t,u):a.call(t,"checkbox",u)))+'\n				<label for="total">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-overtime-columnchart.controls.total",u):a.call(t,"t","networth-overtime-columnchart.controls.total",u)))+'</label>\n			</div>\n\n\n		</form>\n	</div>\n	<div class="sf-networth-overtime-chart-placeholder"></div>\n</div>',s});return t.registerPartial("modules_networth-overtime-columnchart_templates_networth-overtime-columnchart-mobile",n),n}),define("hbs!modules/networth-overtime-columnchart/templates/networth-overtime-columnchart",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-networth-overtime-columnchart">\n	<div class="sf-networth-overtime-controls">\n		<form class="sf-networth-overtime-controls-form">\n			<label for="products">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-overtime-columnchart.controls.products",u):a.call(t,"t","networth-overtime-columnchart.controls.products",u)))+"</label>\n			",u={hash:{checked:t.products,name:"products"}},s+=f((o=n.checkbox,o?o.call(t,u):a.call(t,"checkbox",u)))+'\n			\n			<label for="total">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-overtime-columnchart.controls.total",u):a.call(t,"t","networth-overtime-columnchart.controls.total",u)))+"</label>\n			",u={hash:{checked:t.total,name:"total"}},s+=f((o=n.checkbox,o?o.call(t,u):a.call(t,"checkbox",u)))+'\n			\n		</form>\n	</div>\n	<div class="sf-networth-overtime-chart-placeholder"></div>\n</div>',s});return t.registerPartial("modules_networth-overtime-columnchart_templates_networth-overtime-columnchart",n),n}),define("libs/require/css/css!modules/networth-overtime-columnchart/css/networth-overtime-columnchart",[],function(){}),define("modules/networth-overtime-columnchart/networth-overtime-columnchart-module",["classes/networth/networth-overtime-chart","modules/networth-overtime-columnchart/views/networth-overtime-columnchart-accessible-chart","is!phone?hbs!modules/networth-overtime-columnchart/templates/networth-overtime-columnchart-mobile:hbs!modules/networth-overtime-columnchart/templates/networth-overtime-columnchart","css!modules/networth-overtime-columnchart/css/networth-overtime-columnchart"],function(e,t,n){var r=e.extend({chartView:t,template:n,serializeData:function(){return{products:!0,total:!0}}},{ID:"networth-overtime-columnchart"});return r}),define("modules/networth-overtime-columnchart/networth-overtime-columnchart-module-extension",["modules/networth-overtime-columnchart/networth-overtime-columnchart-module","modules/networth-overtime-columnchart/views/networth-overtime-columnchart-accessible-chart","is!phone?hbs!modules/networth-overtime-columnchart/templates/networth-overtime-columnchart-mobile:hbs!modules/networth-overtime-columnchart/templates/networth-overtime-columnchart","css!modules/networth-overtime-columnchart/css/networth-overtime-columnchart"],function(e,t,n){var r=e.extend({chartView:t,template:n,serializeData:function(){return{products:!0,total:!1}}},{ID:"networth-overtime-columnchart"});return r}),define("libs/require/css/css!ui/modules/horizontal-columnchart/css/horizontal-columnchart",[],function(){}),define("ui/modules/horizontal-columnchart/horizontal-columnchart-module",["classes/ui/chart/d3-chart","d3","utils/util","css!ui/modules/horizontal-columnchart/css/horizontal-columnchart"],function(e,t,n){var r=e.extend({initialize:function(){this._super.apply(this,arguments);var e=this,t=e.config.yAxisPosition,n=e.axisRTL;t==="start"?t=n?"right":"left":t==="end"&&(t=n?"left":"right"),e.yAxisRight=t==="right"},draw:function(e){if(n.isEmpty(e))return;var t=this,r;t._super(),t._preprocessData(e),r=t._initializeCanvas(e.axis),t._x0=t._xScale(0),t._drawStacks(r,t._stacks,e.axis.y),t._drawColumns(t._stacks.length,r,t._columns,e.axis.y),t._drawZeroLine(r),t._drawLines(r,t._lines,e.axis.y)},_initializeCanvas:function(e){this._initializeDimensions(),this._ticks=this._calcTicks(this._valueRange),this._$axisLabels=this._drawAxisTitles(e),this._updatePosition(),this._calcScales(e),this._drawAxis(),this._updatePosition(),this._calcScales(e),this._drawAxis()&&(this._updatePosition(),this._calcScales(e),this._drawAxis()),this._centerAxisTitles();var t={"class":"sf-chart-content",transform:"translate("+this._content.left+","+this._content.top+")"},n=this.$svg.append("g").attr(t);return n},_initializeDimensions:function(){this._content={height:0,width:0},this._axis={x:{height:0,width:0},y:{height:0,width:0}},this._axisTitles={x:{height:0,width:0},y:{height:0,width:0}},this._padding={top:this.config.topMargin||0,left:this.config.leftMargin||0,right:this.config.rightMargin||0,bottom:this.config.bottomMargin||0}},_updatePosition:function(){var e=this,t=this.$el.width(),n=this.$el.height(),r=this._axis,i=this._axisTitles,s=this._content,o=e._padding;s.height=n-r.x.height-i.x.height-o.top-o.bottom,s.width=t-r.y.width-i.y.width-o.left-o.right,s.top=o.top,s.bottom=s.top+s.height,s.left=e.yAxisRight?o.left:o.left+i.y.width+r.y.width,s.right=s.left+s.width,r.x.top=s.bottom,r.x.left=s.left,r.x.right=s.right,r.x.bottom=s.bottom+r.x.height,r.y.top=s.top,r.y.left=e.yAxisRight?s.right+e.config.labelToAxisPadding:s.left-e.config.labelToAxisPadding,r.y.right=r.y.left+r.y.width,r.y.bottom=r.y.top+r.y.height},_calcTicks:function(e){var n=e[0]<0&&0<e[1],r=n?this.config.numberOfTicks-2:this.config.numberOfTicks-1,i=+((Math.abs(e[0])+Math.abs(e[1]))/r).toPrecision(2),s=this.config.roundTickStep?this.roundAxisValue(i):i,o=e[1],u=e[0],a=Math.ceil(o/s)+1,f=Math.floor(u/s),l=t.range(0,s*a,s);return t.range(s*f,0,s).concat(l)},roundAxisValue:function(e){return e%10===0?e:e+(10-e%10)},_drawAxis:function(){var e=this;return e._$xAxis&&e._$xAxis.remove(),e._$xAxis=e._drawXaxis(),e._axis.x=e._getXaxisSize(),e._$yAxis&&e._$yAxis.remove(),e._$yAxis=e._drawYaxis(),e._axis.y=e._getYaxisSize(),e.config.labelAlign!=null&&e.alignAxisLabels(e.config.labelAlign),e.config.preventXaxisOverlap&&e.checkLabelsColission()?(e.solveLabelsCollision(),e._axis.x=e._getXaxisSize(),!0):!1},_drawXaxis:function(){var e=this,n=e._content.height,r=this._ticks.length-1,i=t.svg.axis().tickValues(e._ticks).tickSize(-n,0,-n).scale(e._xScale).tickFormat(function(t,n){return e.getXaxisFormat(t,n,this)}).orient("bottom"),s={"class":"sf-chart-axis sf-chart-axis-horizontal",transform:"translate("+e._axis.x.left+","+e._axis.x.top+")"},o=e.$svg.append("g").attr(s).call(i);return o.selectAll("text").style({"text-anchor":function(t,n){var i="middle";return n===0&&(i=e.axisRTL?e.enableRTL?"start":"end":e.enableRTL?"end":"start"),n===r&&(i=e.axisRTL?e.enableRTL?"end":"start":e.enableRTL?"start":"end"),i}}),o},_drawYaxis:function(){var e=this,n=t.svg.axis().tickSize(0).scale(e._yScale).tickFormat(function(t,n){return e.getYaxisFormat(t,n,e)}).orient(e.yAxisRight?"right":"left"),r={"class":"sf-chart-axis sf-chart-axis-vertical",transform:"translate("+e._axis.y.left+", "+e._axis.y.top+")"},i=e.$svg.append("g").attr(r).call(n);return e.enableRTL&&i.selectAll(".tick text").style("text-anchor",e.yAxisRight?"end":"start"),i},_getXaxisSize:function(){var e=this,t=e._$xAxis,n=t&&t.node(),r=n&&n.getBoundingClientRect(),i=0;return t&&t.selectAll("text").each(function(){var e=this.getBoundingClientRect(),t=Math.abs(this.getAttribute("y"))||0,n=e.height+t;i<n&&(i=n)}),{width:r?r.width:0,height:i}},_getYaxisSize:function(){var e=this,t=e._$yAxis,n=t&&t.node(),r=n&&n.getBoundingClientRect();return{height:r?r.height:0,width:r?r.width+e.config.labelToAxisPadding:0}},alignAxisLabels:function(e){var t=this,n=0,r=t._columnScale.rangeBand()/2,i=t._yScale.rangeBand()/2;e==="top"?n=r-i:e==="bottom"&&(n=i-r),n&&this._$yAxis.selectAll(".tick").attr("transform",function(){return this.getAttribute("transform")+" translate(0,"+n+")"})},_drawAxisTitles:function(e){var t=this,n=t.$svg.append("g").attr("class","sf-chart-axis-labels"),r=n.append("g").attr("class","sf-chart-axis-label-horizontal-group"),i,s=r.node(),o=n.append("g").attr("class","sf-chart-axis-label-vertical-group"),u,a=o.node();return e.yLabel&&(t._drawYaxisTitle(e.yLabel,o),u=a.getBoundingClientRect(),t._axisTitles.y.height=u.height,t._axisTitles.y.width=u.width,t._axisTitles.y.width+=t.config.axisTitlePadding),e.xLabel&&(t._drawXaxisTitle(e.xLabel,r),i=s.getBoundingClientRect(),t._axisTitles.x.width=i.width,t._axisTitles.x.height=i.height,t._axisTitles.x.height+=t.config.axisTitlePadding),t._$yAxisTitle=o,t._$xAxisTitle=r,n},_centerAxisTitles:function(){var e=this,t=e._axisTitles.x.height+e._axis.x.height,n=e._axisTitles.y.width+e._axis.y.width;t/=-2,n/=e.yAxisRight?-2:2,e._$yAxisTitle.attr("transform","translate(0,"+t+")"),e._$xAxisTitle.attr("transform","translate("+n+",0)")},_drawXaxisTitle:function(e,t){var n={"class":"sf-chart-axis-label sf-chart-axis-label-horizontal",x:(this.$el.width()-this._padding.left-this._padding.right)/2,y:this.$el.height()-this._padding.bottom},r=t.append("text").attr(n).text(e),i=r.node(),s=i.getBoundingClientRect().height/2;return this._padding.bottom<s?(this._padding.bottom=s,r.remove(),this._drawXaxisTitle(e,t)):r},_drawYaxisTitle:function(e,t){var n=this,r=(this.$el.height()-this._padding.top-this._padding.bottom)/2+this._padding.top,i=n.yAxisRight?this.$el.width()-n._padding.right:n._padding.left,s={"class":"sf-chart-axis-label sf-chart-axis-label-vertical",x:i,y:r};n.yAxisRight?s.transform=" rotate(90,"+i+","+r+")":s.transform=" rotate(-90,"+i+","+r+")";var o=t.append("text").attr(s).text(e),u=o.node(),a=u.getBoundingClientRect().width;if(n.yAxisRight){if(a>n._padding.right)return n._padding.right=a,o.remove(),n._drawYaxisTitle(e,t)}else if(a>n._padding.left)return n._padding.left=a,o.remove(),n._drawYaxisTitle(e,t);return o},checkLabelsColission:function(){var e=this,t,n=e._$xAxis.selectAll("text"),r=!1,i=e.config.xAxisLabelMinPadding,s=function(e,t){return e.left-i<t.right},o=function(e,t){return e.right+i>t.left},u=e.axisRTL?o:s;return n.each(function(){var e=this.getBoundingClientRect();t&&(r=r||u(e,t)),t=e}),r},solveLabelsCollision:function(){var e=this,t={dy:"0.5em",dx:"0.5em",x:"-0.5em",y:"0.5em",transform:e.yAxisRight?"rotate(45)":"rotate(-45)"},n=e.yAxisRight==e.enableRTL?"end":"start",r=e._$xAxis.selectAll("text").attr(t).style("text-anchor",n),i,s,o=Infinity,u=-Infinity,a=e.$svg.node().getBoundingClientRect();r.each(function(){var e=this.getBoundingClientRect();e.left<o&&(o=e.left,i=this),e.right>u&&(u=e.right,s=this)}),a.left>o&&(e._padding.left=a.left-o),a.right<u&&(e._padding.right=u-a.right)},_calcScales:function(e){this._yScale=this._calcYscale(e.y),this._xScale=this._calcXscale(this._ticks),this._lineScale=this._calcLineScale(e.y),this._columnScale=this._calcColumnScale(this._yScale,this._columns.length+this._stacks.length)},_calcYscale:function(e){var n=[0,this._content.height],r=t.scale.ordinal().domain(e).rangeBands(n),i=r.rangeBand();if(i>this.config.maxColumnWidth){var s=i/(1-this.config.marginInnerInterval),o=1-this.config.maxColumnWidth/s;r=t.scale.ordinal().domain(e).rangeBands(n,o,o/2)}return r},_calcXscale:function(e){var n=this.axisRTL?[this._content.width,0]:[0,this._content.width],r=[t.min(e),t.max(e)];return t.scale.linear().domain(r).range(n)},_calcColumnScale:function(e,n){var r=t.range(0,n||1),i=e.rangeBand(),s=this.config.marginInnerColumns,o=this.config.marginInnerInterval,u=[0,i];return t.scale.ordinal().domain(r).rangeBands(u,s,o)},_calcLineScale:function(e){var n=[0,this._content.height];return t.scale.ordinal().domain(t.range(0,e.length)).rangePoints(n,1)},_drawLines:function(e,n){var r=this,i={"class":function(e){var t=["sf-chart-line-serie sf-chart-serie"];return e["class"]&&t.push(e["class"]),t.join(" ")}},s=e.selectAll("g.sf-chart-line-serie").data(n).enter().append("g").attr(i),o=function(e){return r._xScale(e.value)},u=function(e,t){return r._lineScale(t)},a=t.svg.line().x(o).y(u),f=t.svg.line().x(this._x0).y(u),l={"class":"sf-chart-line",d:function(e,t){return f(e.points,t)},stroke:function(e){return e.color}},c={d:function(e,t){return a(e.points,t)}},h={"class":r._pointClass,cy:u,cx:this._x0,r:this.config.pointRadius,stroke:function(e){return e.color},title:function(e){return e.title}},p={cx:o};s.selectAll("path").data(n).enter().append("path").attr(l).transition().duration(this.config.transitionDuration).attr(c),s.selectAll("circle").data(function(e){return e.points}).enter().append("circle").attr(h).on("click",function(e,t){r.onClick(e,t,this)}).transition().duration(this.config.transitionDuration).attr(p),this._$lines=s},_drawColumns:function(e,t,n,r){var i=this,s={"class":function(e,t){var n=["sf-chart-column-serie sf-chart-serie-"+t];return e["class"]&&n.push(e["class"]),n.join(" ")}},o={"class":i._pointClass,x:this._x0,y:function(t,n){return i._columnScale(e+t._serieIndx)+i._yScale(r[n])},fill:function(e){return e.color},title:function(e){return e.title},width:0,height:i._columnScale.rangeBand()},u={x:function(e){return Math.min(i._x0,i._xScale(e.value))},width:function(e){var t=Math.abs(e.value),n=i._xScale(t);return Math.abs(i._x0-n)}},a=t.selectAll("g.sf-chart-column-serie").data(n).enter().append("g").attr(s).selectAll("rect.sf-chart-point").data(function(e){return e.points}).enter().append("rect").attr(o).on("click",function(e,t){i.onClick(e,t,this)}).transition().duration(this.config.transitionDuration).attr(u);this._$columns=a},_drawStacks:function(e,t,n){var r=this,i={"class":function(e,t){return"sf-chart-stack sf-chart-stack-"+t}},s={"class":function(e){var t=["sf-chart-stack-serie sf-chart-serie"];return e["class"]&&t.push(e["class"]),t.join(" ")}},o={"class":r._pointClass,title:function(e){return e.title},height:r._columnScale.rangeBand(),width:0,fill:function(e){return e.color},x:r._x0,y:function(e,t){return r._yScale(n[t])+r._columnScale(e._serieIndx)}},u=function(e){var t=Math.abs(e._offset),n=Math.abs(r._x0-r._xScale(t)),i=Math.min(r._x0,r._xScale(e.value));return e._offset?e._offset>0?i-n:i+n:i},a=function(e){var t=Math.abs(e._offset),n=Math.abs(r._x0-r._xScale(t)),i=Math.min(r._x0,r._xScale(e.value));return e._offset?e._offset>0?i+n:i-n:i},f={width:function(e){var t=Math.abs(e.value),n=r._xScale(t);return Math.abs(r._x0-n)},x:r.axisRTL?u:a},l=e.selectAll("g.sf-chart-stack").data(t).enter().append("g").attr(i).selectAll("g.sf-chart-stack-serie").data(function(e){return e.series}).enter().append("g").attr(s).selectAll("rect.sf-chart-point").data(function(e){return e.points}).enter().append("rect").attr(o).on("click",function(e,t){r.onClick(e,t,this)}).transition().duration(this.config.transitionDuration).attr(f);this._$stacks=l},_drawZeroLine:function(e){e.append("line").attr({x1:this._x0,y1:0,x2:this._x0,y2:this._content.height,"class":"sf-chart-zero-line"})},_pointClass:function(e,t){var n=["sf-chart-point","sf-chart-point-"+t];return e["class"]&&n.push(e["class"]),n.join(" ")},getYaxisFormat:function(e){return e},getXaxisFormat:function(e){return e},_preprocessData:function(e){var t=this,r=[0,0],i=function(e){e>0&&e>r[1]?r[1]=e:r[0]>e&&(r[0]=e)},s=function(e,t){var r=e[t.options.stack]||(e[t.options.stack]={series:[],points:[]});return r.series.push(t),n.each(t.points,function(e,n){var s=e.value,o=r.points[n];e._serieIndx=t.options.stack,o||(o=r.points[n]={bottom:0,top:0}),s>0?(e._offset=o.top,o.top+=s,i(o.top)):(e._offset=o.bottom,o.bottom+=s,i(o.bottom))}),e},o=function(e,t){return e.push(t),n.each(t.points,function(t){t._serieIndx=e.length-1,i(t.value)}),t},u=function(e){return e.options&&e.options.stack!=null},a=function(e){return e.options&&e.options.type==="line"},f=function(e,t,n){return u(t)?s(e.stacks,t,n):a(t)?o(e.lines,t,n):o(e.columns,t,n),e},l=t.normalize(e),c=n.reduce(l.series,f,{stacks:[],columns:[],lines:[]});t._valueRange=r,t._lines=c.lines,t._columns=c.columns,t._stacks=c.stacks}},{ID:"horizontal-columnchart",defaults:{pointRadius:5,numberOfTicks:7,topMargin:0,leftMargin:0,rightMargin:0,bottomMargin:0,marginInnerInterval:.2,maxColumnWidth:300,marginInnerColumns:0,labelToAxisPadding:5,axisTitlePadding:15,labelAlign:"middle",xAxisLabelMinPadding:2,preventXaxisOverlap:!0,roundTickStep:!1,yAxisPosition:"start"}});return r}),define("modules/networth-overtime-barchart/views/networth-overtime-barchart-d3-chart",["ui/modules/horizontal-columnchart/horizontal-columnchart-module"],function(e){var t=e.extend({_drawZeroLine:function(e,t,n){var r=this.$svg.select("rect.sf-networth-overtime-barchart-first-liability"),i=r.node(),s=i&&i.previousSibling;if(s){var o=i.getBBox().y,u=s.getBBox(),a=u.y+u.height,f=(o+a)/2;(u.height||u.y)&&this.$svg.append("line").attr({"class":"sf-networth-barchart-separator",y1:f,y2:f,x1:0,x2:this.$el.width()})}this._super(e,t,n)}},{defaults:{roundTickStep:!0}});return t}),define("hbs!modules/networth-overtime-barchart/templates/networth-overtime-barchart-table",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-networth-overtime-barchart-table"></div>'});return t.registerPartial("modules_networth-overtime-barchart_templates_networth-overtime-barchart-table",n),n}),define("modules/networth-overtime-barchart/views/networth-overtime-barchart-table",["classes/item-view","hbs!modules/networth-overtime-barchart/templates/networth-overtime-barchart-table","classes/collection","utils/util","ui/modules/datagrid/datagrid-module","utils/amount","utils/number","utils/percentage"],function(e,t,n,r,i){var s=i.DatagridColumn,o=e.extend({template:t,_setGridConfig:function(e){this.gridConfig={columns:[new s({parent:this,field:"type",label:r.i18n.get("networth-overtime-barchart.accessible.header.type"),sortable:!0}),new s({parent:this,field:"category",label:r.i18n.get("networth-overtime-barchart.accessible.header.category"),sortable:!0})]},e==="percentage"?this.gridConfig.columns.push(new s({columnClass:"sf-numeric sf-percent-col",field:"value",label:r.i18n.get("networth-overtime-barchart.accessible.header.percent"),headerClass:"sf-percent-header sf-numeric",parent:this,sortable:!0,formatter:function(e){return e.get("value")!==undefined?r.percentage.format(r.number.round(e.get("value"),2),!0):"-"}})):this.gridConfig.columns.push(new s({parent:this,columnClass:"sf-numeric sf-amount-col",field:"value",formatter:function(e){return r.amount.format(e.get("value"))},label:r.i18n.get("networth-overtime-barchart.accessible.header.amount"),headerClass:"sf-amount-header sf-numeric",sortable:!0}))},onShow:function(){this.model.on("change",this.render,this)},onClose:function(){this.model.off("change",this.render)},onRender:function(){this._super();var e=this.model.get("data"),t=this;this._setGridConfig(e.mode);if(e){var s=r.extend({dataSource:new n(e),config:t.gridConfig,container:t.$el},this.contextConfig);this.datagrid=new i(s),t.datagrid.render()}},_dateFormatter:function(e,t,n){var r=e.get("dataDate"),i;return n>0&&(i=t.at(n-1).get("dataDate")),i===r?"":(i=r,e.get("formattedDate"))}});return o}),define("hbs!modules/networth-overtime-barchart/templates/networth-point-tooltip",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression;s+="<b>",(o=n.title)?o=o.call(t,{hash:{}}):(o=t.title,o=typeof o===u?o.apply(t):o),s+=a(o)+"</b>:<br/>",(o=n.variaton)?o=o.call(t,{hash:{}}):(o=t.variaton,o=typeof o===u?o.apply(t):o);if(o||o===0)s+=o;return s});return t.registerPartial("modules_networth-overtime-barchart_templates_networth-point-tooltip",n),n}),define("modules/networth-overtime-barchart/views/networth-overtime-barchart-accessible-chart",["classes/ui/chart/accessible-chart","is!ie8?modules/networth-overtime-barchart/views/networth-overtime-barchart-hc-chart:modules/networth-overtime-barchart/views/networth-overtime-barchart-d3-chart","modules/networth-overtime-barchart/views/networth-overtime-barchart-table","hbs!modules/networth-overtime-barchart/templates/networth-point-tooltip","utils/util"],function(e,t,n,r,i){var s=e.extend({accessibleViewConstructor:n,initialize:function(){var e=this;e._percentage=!0,e.chartConstructor=t.extend({getXaxisFormat:function(t,n,r){var s=e._percentage?t.toFixed(0)+"%":i.amount.format(t,!1);return r.className.baseVal+=e._percentage?"sf-chart-axis-percentage":"sf-chart-axis-amount",i.unicodeHTMLCodes(s)}}),this._super.apply(this,arguments)},_calcDiff:function(e,t,n){return e.get("asset")&&e.get("liability")&&n*t<0?Math.abs(n)+Math.abs(t):Math.abs(n)-Math.abs(t)},parseSeries:function(e){var t=this,n=e.formFilters,s=e.filters,o=e.overtime,u=i.date.datesInPeriod(i.date.constructor.MONTH,s.datesRange.fromDate,s.datesRange.toDate),a=i.date.formatBackendDate(u[0]),f=i.date.formatBackendDate(u[u.length-1]),l=o.get(f),c=o.get(a),h={},p=function(e,t){return h[t.id]=t,e[t.id]=t.amount,e},d=function(e,t){return c?i.reduce(c.get(e),p,t):t},v=function(e,t){return l?i.reduce(l.get(e),p,t):t},m=d("assets",d("liabilities",{})),g=v("assets",v("liabilities",{})),y=[],b=!0,w=function(e){var o=m[e.id]||0,u=g[e.id],a=t._calcDiff(e.category,o,u),f=e.category.get("namePluralI18n"),l=u>0,c=l?a>0?t.config.positiveVariation:t.config.negativeVariation:a>0?t.config.negativeVariation:t.config.positiveVariation,h,p=["sf-networth-overtime-barchart-category-"+e.category.id];if(!a)return;if(n.mode==="percentage"){if(!o)return;if(o*u<0)return}if(s.networthCategory&&s.networthCategory!==e.id)return;return b&&!l&&(b=!1,p.push("sf-networth-overtime-barchart-first-liability")),n.mode==="percentage"?(a=a/Math.abs(o)*100,h={amount:Math.abs(a).toFixed(2)+"%"}):h={amount:i.amount.format(Math.abs(a),!1)},a>0?h=i.i18n.get("networth-overtime-barchart.tooltip.increase",h):h=i.i18n.get("networth-overtime-barchart.tooltip.decrease",h),y.push(f),{label:f,color:c,value:l?a:a*-1,data:e,"class":p,title:r({title:f,variaton:h})}},E=function(e){return e},S=function(e,t){var n=e.amount>0,r=t.amount>0;return n!==r?n?-1:1:e.id>t.id?1:-1},x=i.compact(i.map(h,E).sort(S).map(w));return this._percentage=n.mode==="percentage",x.length?{series:[{points:x}],axis:{y:y}}:null},parseTabularSeries:function(e){var t=this,n=e.formFilters,r=e.filters,s=e.overtime,o=i.date.datesInPeriod(i.date.constructor.MONTH,r.datesRange.fromDate,r.datesRange.toDate),u=i.date.formatBackendDate(o[0]),a=i.date.formatBackendDate(o[o.length-1]),f=s.get(a),l=s.get(u),c={},h=function(e,t){return c[t.id]=t,e[t.id]=t.amount,e},p=function(e,t){return l?i.reduce(l.get(e),h,t):t},d=function(e,t){return f?i.reduce(f.get(e),h,t):t},v=p("assets",p("liabilities",{})),m=d("assets",d("liabilities",{})),g=!0,y=function(e){var s=v[e.id]||0,o=m[e.id],u=t._calcDiff(e.category,s,o),a=e.category.get("namePluralI18n"),f=o>=0;if(!u)return;if(n.mode==="percentage"){if(!s)return;if(s*o<0)return}if(r.networthCategory&&r.networthCategory!==e.id)return;return g&&!f&&(g=!1),n.mode==="percentage"&&(u=u/Math.abs(s)*100),{type:i.i18n.get("networth-overtime-barchart.accessible."+(f?"asset":"liability")),category:a,value:f?u:u*-1}},b=function(e){return e},w=function(e,t){var n=e.category.get("asset"),r=t.category.get("asset");return n!==r?n?-1:1:e.id>t.id?1:-1},E=i.compact(i.map(c,b).sort(w).map(y));return this._percentage=n.mode==="percentage",E.length?(E.mode=e.formFilters.mode,{data:E}):null}},{defaults:{positiveVariation:"#60A9D5",negativeVariation:"#D56D56",emptyMessage:"networth-overtime-barchart.emptyMessage"}});return s}),define("hbs!modules/networth-overtime-barchart/templates/networth-overtime-barchart-mobile",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-networth-overtime-barchart">\n	<div class="sf-networth-overtime-controls">\n		<form class="sf-networth-overtime-controls-form">\n			<label class="sf-percentage-option">',u={hash:{checked:!0,value:"percentage",name:"mode"}},s+=f((o=n.radio,o?o.call(t,u):a.call(t,"radio",u)))+' <label class="sf-label-percentage">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-overtime-barchart.controls.percentage",u):a.call(t,"t","networth-overtime-barchart.controls.percentage",u)))+'</label></label>\n			<label class="sf-amount-option">',u={hash:{value:"amount",name:"mode"}},s+=f((o=n.radio,o?o.call(t,u):a.call(t,"radio",u)))+'<label class="sf-label-amount">',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-overtime-barchart.controls.amount",u):a.call(t,"t","networth-overtime-barchart.controls.amount",u)))+'</label> </label>\n		</form>\n	</div>\n	<div class="sf-networth-overtime-chart-placeholder"></div>\n</div>',s});return t.registerPartial("modules_networth-overtime-barchart_templates_networth-overtime-barchart-mobile",n),n}),define("hbs!modules/networth-overtime-barchart/templates/networth-overtime-barchart",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-networth-overtime-barchart">\n	<div class="sf-networth-overtime-controls">\n		<form class="sf-networth-overtime-controls-form">\n			<label>',u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-overtime-barchart.controls.percentage",u):a.call(t,"t","networth-overtime-barchart.controls.percentage",u)))+" ",u={hash:{checked:!0,value:"percentage",name:"mode"}},s+=f((o=n.radio,o?o.call(t,u):a.call(t,"radio",u)))+"</label>\n			<label>",u={hash:{}},s+=f((o=n.t,o?o.call(t,"networth-overtime-barchart.controls.amount",u):a.call(t,"t","networth-overtime-barchart.controls.amount",u)))+" ",u={hash:{value:"amount",name:"mode"}},s+=f((o=n.radio,o?o.call(t,u):a.call(t,"radio",u)))+'</label>\n		</form>\n	</div>\n	<div class="sf-networth-overtime-chart-placeholder"></div>\n</div>',s});return t.registerPartial("modules_networth-overtime-barchart_templates_networth-overtime-barchart",n),n}),define("libs/require/css/css!modules/networth-overtime-barchart/css/networth-overtime-barchart",[],function(){}),define("modules/networth-overtime-barchart/networth-overtime-barchart-module",["classes/networth/networth-overtime-chart","modules/networth-overtime-barchart/views/networth-overtime-barchart-accessible-chart","is!phone?hbs!modules/networth-overtime-barchart/templates/networth-overtime-barchart-mobile:hbs!modules/networth-overtime-barchart/templates/networth-overtime-barchart","css!modules/networth-overtime-barchart/css/networth-overtime-barchart"],function(e,t,n){var r=e.extend({chartView:t,template:n,reformSelector:"ReForm.Radio",_labelClickHandler:function(){},_disableActiveElement:function(){},_enableAllElements:function(){}},{ID:"networth-overtime-barchart"});return r}),define("modules/networth-content/networth-content-module-extension",["modules/networth-content/networth-content-module","ui/modules/tabs/tabs-module-networth","modules/networth-summary/networth-summary-module","modules/networth-details/networth-details-module","modules/networth-overtime/networth-overtime-module","modules/networth-future-overtime/networth-future-overtime-module","modules/networth-product-manager/networth-product-manager-module","modules/networth-filters/networth-filters-module","modules/networth-overtime-columnchart/networth-overtime-columnchart-module","modules/networth-overtime-barchart/networth-overtime-barchart-module","hbs!modules/networth-content/templates/networth-content","utils/util","css!modules/networth-content/css/networth-content"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=e.extend({regions:{tabsRegion:".sf-networth-tabs-region"},_chartOptions:function(){return{past:{charts:{columnchart:{view:a,icon:"sf-networth-widget-columnchart-icon",title:c.i18n.get("networth.charts.columnchart")},barchart:{view:f,icon:"sf-networth-widget-barchart-icon",title:c.i18n.get("networth.charts.barchart")}},config:{initialChart:this.config.initialChart}},future:{charts:{columnchart:{view:a,icon:"sf-networth-widget-columnchart-icon",title:""}},config:{initialChart:"columnchart"}},config:this.config}},onRender:function(){var e=this;e.contextConfig.$widget=e.contextConfig.widget.$el;var i=[],s=c.merge({title:"networth.title"},this.contextConfig,this._chartOptions()),o=c.merge({},s,{id:"summary"}),u=c.merge({},s,{id:"details"}),a=c.merge({},e.contextConfig,o),f=c.merge({},e.contextConfig,u);i.push({id:"summary",title:c.i18n.get("networth-content.tabs.summary.title"),subTitle:"",content:n,opts:a},{id:"details",title:c.i18n.get("networth-content.tabs.details.title"),subTitle:"",content:r,opts:f});var l=new t(c.merge({},e.contextConfig,{tabsModules:i}));this.tabsRegion.show(l)}},{submodules:[i,t,n,r,s,o,u]});return h}),define("libs/require/css/css!widgets/networth/css/networth",[],function(){}),define("widgets/networth/networth-widget",["classes/ui/widget/widget","modules/networth-header/networth-header-module","modules/networth-content/networth-content-module","modules/networth-overtime-columnchart/networth-overtime-columnchart-module","modules/networth-overtime-barchart/networth-overtime-barchart-module","utils/util","utils/i18n","utils/mask","css!widgets/networth/css/networth"],function(e,t,n,r,i,s){var o=e.extend({initialize:function(){this._super.apply(this,arguments),s.isPhone()&&(this.config.initialRangeMonths=3),this._setupDatesRangeFilter()},_chartOptions:function(){return{past:{charts:{columnchart:{view:r,icon:"sf-networth-widget-columnchart-icon",title:s.i18n.get("networth.charts.columnchart")},barchart:{view:i,icon:"sf-networth-widget-barchart-icon",title:s.i18n.get("networth.charts.barchart")}},config:{initialChart:this.config.initialChart}},future:{charts:{columnchart:{view:r,icon:"sf-networth-widget-columnchart-icon",title:""}},config:{initialChart:"columnchart"}},config:this.config}},onRender:function(){this._super();var e=s.merge({title:"networth.title"},this.contextConfig,this._chartOptions());this.headerRegion.show(new t(e)),this.contentRegion.show(new n(e))}},{ID:"networth",submodules:[t,n,r,i],defaults:{minProjection:1,maxProjection:5,initialChart:"columnchart",initialRangeMonths:6,filters:{networthPeriod:"past",projectionRange:3,networthCategory:null}}});return o}),define("widgets/networth/networth-widget-extension",["widgets/networth/networth-widget","modules/networth-header/networth-header-module","modules/networth-content/networth-content-module","modules/networth-overtime-columnchart/networth-overtime-columnchart-module","modules/networth-overtime-barchart/networth-overtime-barchart-module","utils/util","utils/i18n","utils/mask","css!widgets/networth/css/networth"],function(e,t,n,r,i,s){var o=e.extend({hubEvents:{networthColumnchartRendered:"_unmaskWidget"},initialize:function(){this.config.initialRangeMonths=12,this._setupDatesRangeFilter()},onRender:function(){var e=s.merge({title:"networth.title"},this.contextConfig,this._chartOptions());this.contentRegion.show(new n(e)),s.mask(this.$el)},_unmaskWidget:function(){s.unmask(this.$el)}});return o}),define("hbs!widgets/ok-to-spend/templates/ok-to-spend-header",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+="<div>\n	",u={hash:{id:"ok-to-spend",title:'{{t "ok-to-spend.title"}}'}},s+=f((o=n.header,o?o.call(t,u):a.call(t,"header",u)))+'\n	<div class="sf-ok-to-spend-summary-placeholder"></div>\n</div>',s});return t.registerPartial("widgets_ok-to-spend_templates_ok-to-spend-header",n),n}),define("widgets/ok-to-spend/views/ok-to-spend-header-view",["classes/layout","modules/ok-to-spend-summary/ok-to-spend-summary-module","services/ok-to-spend-service","hbs!widgets/ok-to-spend/templates/ok-to-spend-header"],function(e,t,n,r){var i=e.extend({template:r,regions:{summaryRegion:".sf-ok-to-spend-summary-placeholder"},onRender:function(){this._super()}});return i}),define("hbs!modules/ok-to-spend-month-graph/templates/ok-to-spend-month-graph-bars",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i;r+='\n		<div class="sf-disposable-bar sf-disposable-bar-',(i=n.type)?i=i.call(e,{hash:{}}):(i=e.type,i=typeof i===u?i.apply(e):i);if(i||i===0)r+=i;r+='" style="width: ',(i=n.width)?i=i.call(e,{hash:{}}):(i=e.width,i=typeof i===u?i.apply(e):i);if(i||i===0)r+=i;r+='" data-type="',(i=n.type)?i=i.call(e,{hash:{}}):(i=e.type,i=typeof i===u?i.apply(e):i);if(i||i===0)r+=i;r+='">\n			',i=n["if"].call(e,e.isEditable,{hash:{},inverse:f.noop,fn:f.program(2,c,t)});if(i||i===0)r+=i;r+='\n			<div class="sf-disposable-innerbar',i=n["if"].call(e,e.innerbarClass,{hash:{},inverse:f.noop,fn:f.program(4,h,t)});if(i||i===0)r+=i;r+='" title="',(i=n.tooltip)?i=i.call(e,{hash:{}}):(i=e.tooltip,i=typeof i===u?i.apply(e):i);if(i||i===0)r+=i;return r+='"></div>\n		</div>\n	',r}function c(e,t){var r="",i;r+='\n				<div class="sf-tick" data-type="',(i=n.type)?i=i.call(e,{hash:{}}):(i=e.type,i=typeof i===u?i.apply(e):i);if(i||i===0)r+=i;return r+='">\n					<span class="sf-tick-vline"></span>\n					<span class="sf-tick-vline last"></span>\n				</div>\n			',r}function h(e,t){var r="",i;return r+=" ",(i=n.innerbarClass)?i=i.call(e,{hash:{}}):(i=e.innerbarClass,i=typeof i===u?i.apply(e):i),r+=a(i),r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="sf-disposable-income-bar-wrapper">\n	<div class="sf-disposable-bar sf-disposable-bar-income" style="width: ',(o=n.incomeWidth)?o=o.call(t,{hash:{}}):(o=t.incomeWidth,o=typeof o===u?o.apply(t):o);if(o||o===0)s+=o;s+='" data-type="income">\n		<div class="sf-disposable-innerbar"></div>\n	</div>\n</div>\n<div class="sf-disposable-expenses-bar-wrapper" style="width: ',(o=n.totalExpenseWidth)?o=o.call(t,{hash:{}}):(o=t.totalExpenseWidth,o=typeof o===u?o.apply(t):o);if(o||o===0)s+=o;s+='">\n	',o=n.each.call(t,t.bars,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;return s+="\n</div>",s});return t.registerPartial("modules_ok-to-spend-month-graph_templates_ok-to-spend-month-graph-bars",n),n}),define("hbs!modules/ok-to-spend-month-graph/templates/ok-to-spend-month-graph",["hbs","Handlebars","hbs!modules/ok-to-spend-month-graph/templates/ok-to-spend-month-graph-bars"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var i="",s,o,u;i+='\n		<div class="sf-disposable-content-wrapper">\n			<a class="sf-ok-to-spend-go-prev" title="',u={hash:{}},i+=l((s=n.t,s?s.call(e,"ok-to-spend-month-graph.navigation.prevMonth",u):f.call(e,"t","ok-to-spend-month-graph.navigation.prevMonth",u)))+'" href="javascript://">\n				<span>',u={hash:{}},i+=l((s=n.t,s?s.call(e,"ok-to-spend-month-graph.navigation.prevMonth",u):f.call(e,"t","ok-to-spend-month-graph.navigation.prevMonth",u)))+'</span>\n			</a>\n			<div class="sf-disposable-bar-wrapper">\n				',o=c.invokePartial(r["modules_ok-to-spend-month-graph_templates_ok-to-spend-month-graph-bars"],"modules_ok-to-spend-month-graph_templates_ok-to-spend-month-graph-bars",e,n,r);if(o||o===0)i+=o;return i+='\n			</div>\n			<a class="sf-ok-to-spend-go-next" title="',u={hash:{}},i+=l((s=n.t,s?s.call(e,"ok-to-spend-month-graph.navigation.nextMonth",u):f.call(e,"t","ok-to-spend-month-graph.navigation.nextMonth",u)))+'" href="javascript://">\n				<span>',u={hash:{}},i+=l((s=n.t,s?s.call(e,"ok-to-spend-month-graph.navigation.nextMonth",u):f.call(e,"t","ok-to-spend-month-graph.navigation.nextMonth",u)))+"</span>\n			</a>\n		</div>\n	",i}function d(e,t){var r="",i,s;return r+='\n		<div class="sf-disposable-no-data">',s={hash:{}},r+=l((i=n.t,i?i.call(e,"planning-preview.noData",s):f.call(e,"t","planning-preview.noData",s)))+"</div>\n	",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,r=r||e.partials;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c=this,h="function";s+='<div class="sf-month-graph" data-total="',(o=n.totalIncomeValue)?o=o.call(t,{hash:{}}):(o=t.totalIncomeValue,o=typeof o===h?o.apply(t):o);if(o||o===0)s+=o;s+='">\n\n	<h2 class="sf-disposable-bar-title">\n		<span class="sf-current-month-title">',a={hash:{}},s+=l((o=n.formatDate,o?o.call(t,t.currentDate,"MMMM yyyy",a):f.call(t,"formatDate",t.currentDate,"MMMM yyyy",a)))+"</span>\n	</h2>\n	",u=n["if"].call(t,t.dataAvailable,{hash:{},inverse:c.program(3,d,i),fn:c.program(1,p,i)});if(u||u===0)s+=u;return s+="\n</div>",s});return t.registerPartial("modules_ok-to-spend-month-graph_templates_ok-to-spend-month-graph",n),n}),define("libs/require/css/css!modules/ok-to-spend-month-graph/css/ok-to-spend-month-graph",[],function(){}),define("modules/ok-to-spend-month-graph/ok-to-spend-month-graph-module",["classes/layout","services/ok-to-spend-service","hbs!modules/ok-to-spend-month-graph/templates/ok-to-spend-month-graph","utils/mask","utils/amount","utils/tooltip","css!modules/ok-to-spend-month-graph/css/ok-to-spend-month-graph"],function(e,t,n,r){var i=e.extend({template:n,filtersList:["activeMonth"],events:{"click .sf-ok-to-spend-go-prev":"_gotoPrevMonth","click .sf-ok-to-spend-go-next":"_gotoNextMonth","click .sf-disposable-bar-scheduled-expenses":"_expensesBarClicked","click .sf-disposable-bar-real-expenses":"_expensesBarClicked","click .sf-disposable-bar-disposable":"_disposableBarClicked","click .sf-disposable-bar-income":"_incomeBarClicked"},initialize:function(){this._super.apply(this,arguments),this.okToSpendService=t.getInstance()},render:function(e){e===!0?this._super():typeof e=="undefined"&&(r.mask(this.$el,r.MASK_LOADING),r.when(this.okToSpendService.getActiveMonth(this.filters.activeMonth)).done(r.bind(this._dataReceived,this)).fail(r.bind(this._dataError,this)))},_dataReceived:function(e){r.unmask(this.$el),this.okToSpendMonthData=e,this.okToSpendMonthData.on("change",this.render,this),this.render(!0)},_dataError:function(e){r.unmask(this.$el),console.error("[OkToSpendMonthGraph] Error loading month data ",e),this.publish("error",e)},_filtersChanged:function(){this.render()},onRender:function(){r.tooltip.add(this.$el.find(".sf-disposable-innerbar"),this.tooltipOptions)},serializeData:function(){var e=this.okToSpendMonthData.data,t=[],n=Math.abs(e.expenses.total),i=Math.abs(e.income.total),s=Math.max(n,i),o=e.disposable.disposableExcludingSavingsGoals>0?e.disposable.disposableExcludingSavingsGoals:0,u=n>i?"99%":Math.floor(i/s*96)+"%",a=Math.floor(i/s*100)+"%",f=Math.floor(o/s*100)+"%",l=Math.abs(e.expenses.scheduled.total),c=Math.abs(e.expenses.real.total),h=Math.floor(Math.abs(l/s*100))+"%",p=Math.floor(c/s*100)+"%";return t.push({type:"scheduled-expenses",value:l,name:"Scheduled expenses",tooltip:r.i18n.get("ok-to-spend-month-graph.captions.scheduled-expenses")+":<br />"+r.amount.format(l),innerbarClass:"sf-scheduled-expenses",width:h}),t.push({type:"real-expenses",value:c,name:"Real expenses",tooltip:r.i18n.get("ok-to-spend-month-graph.captions.real-expenses")+":<br />"+r.amount.format(c),innerbarClass:"sf-real-expenses",width:p}),o>0&&t.push({type:"disposable",value:o,name:"Disposable",tooltip:r.i18n.get("ok-to-spend-month-graph.captions.disposable")+":<br />"+r.amount.format(o),innerbarClass:"sf-disposable",width:f}),{totalExpenseValue:n,totalIncomeValue:i,totalExpenseWidth:u,incomeWidth:a,currentDate:r.date.parseBackendDate(this.filters.activeMonth),bars:t,dataAvailable:t.length>0}},_gotoPrevMonth:function(){this._monthChange(-1)},_gotoNextMonth:function(){this._monthChange(1)},_monthChange:function(e){this.publish("filters:change",{filter:"activeMonth",data:this.okToSpendService.changeActiveMonth(this.filters.activeMonth,e)})},_expensesBarClicked:function(){this.publish("setActiveTab","expenses")},_disposableBarClicked:function(){this.publish("setActiveTab","disposable")},_incomeBarClicked:function(){this.publish("setActiveTab","income")}},{ID:"ok-to-spend-month-graph",defaults:{}});return i}),define("hbs!widgets/ok-to-spend/templates/ok-to-spend-content",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function h(e,t){var r="",i,s;return r+='\n		<div class="sf-ok-to-spend-month-bar-placeholder"></div>\n		<div class="sf-ok-to-spend-tabs-title">',s={hash:{}},r+=l((i=n.t,i?i.call(e,"ok-to-spend.tabs.title",s):f.call(e,"t","ok-to-spend.tabs.title",s)))+'</div>\n		<div class="sf-ok-to-spend-tabs-placeholder"></div>\n	',r}function p(e,t){var r="",i,s;return r+='\n		<div class="sf-ok-to-spend-no-data">',s={hash:{}},r+=l((i=n.t,i?i.call(e,"ok-to-spend.emptyMessage",s):f.call(e,"t","ok-to-spend.emptyMessage",s)))+"</div>\n	",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c=this;s+='<div class="sf-ok-to-spend-content sf-widget-content">\n	<div class="sf-back-to-fincal-header">\n		<a href="javascript:void(0);" class="sf-popup-close">\n				<span class="sf-popup-close-icon">\n					<img src="resources/pfm/ui/css/icons/app-icons/dav-plus-red.svg" alt="Cerrar">\n				</span>\n			<span class="sf-popup-close-text">',a={hash:{}},s+=l((o=n.t,o?o.call(t,"financial-calendar.webMessage.backToMonthView",a):f.call(t,"t","financial-calendar.webMessage.backToMonthView",a)))+'</span>\n		</a>\n	</div>\n\n	<div class="sf-mode-filter-placeholder">\n		<div class="sf-mode-filter">\n			<div class="sf-mode-filter-buttons">\n				',a={hash:{text:"ok-to-spend.web.mode.expenses",type:"button","class":"sf-button-expenses sf-mode-filter-item sf-active","data-mode":"expenses"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+"\n				",a={hash:{text:"ok-to-spend.web.mode.incomes",type:"button","class":"sf-button-income sf-mode-filter-item","data-mode":"income"}},s+=l((o=n.button,o?o.call(t,a):f.call(t,"button",a)))+"\n			</div>\n		</div>\n	</div>\n	",u=n["if"].call(t,t.dataAvailable,{hash:{},inverse:c.program(3,p,i),fn:c.program(1,h,i)});if(u||u===0)s+=u;return s+="\n</div>",s});return t.registerPartial("widgets_ok-to-spend_templates_ok-to-spend-content",n),n}),define("hbs!modules/ok-to-spend-details/templates/ok-to-spend-upcoming-tx",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-ok-to-spend-upcoming-tx-content-placeholder"></div>'});return t.registerPartial("modules_ok-to-spend-details_templates_ok-to-spend-upcoming-tx",n),n}),define("modules/ok-to-spend-details/views/ok-to-spend-upcoming-tx-view",["classes/layout","classes/collection","services/categories-service","services/transactions-service","hbs!modules/ok-to-spend-details/templates/ok-to-spend-upcoming-tx","ui/modules/datagrid/v-datagrid-module","hbs!modules/transactions-datagrid/templates/formatters/description","hbs!modules/transactions-datagrid/templates/formatters/category","hbs!modules/transactions-datagrid/templates/formatters/date","hbs!modules/transactions-datagrid/templates/formatters/amount","hbs!modules/transactions-datagrid/templates/formatters/tags","utils/mask","utils/amount","utils/date","utils/tooltip"],function(e,t,n,r,i,s,o,u,a,f,l,c){function d(e,t){return{name:e.get(t.field),isSplit:e.has("parentOpId"),editable:c.isFunction(t.editor),computable:e.get("computable")}}function v(e,t,n){return e.get("parentCatId")!==undefined?{hasParent:!0,parentName:e.get("parentCatName"),parentCatId:e.get("parentCatId"),catName:e.get("catName"),color:e.get("catHexrgbcolor")}:{hasParent:!1,catName:e.get("catName"),catId:e.get("catId"),color:e.get("catHexrgbcolor")}}function m(e,t,n,r){var i=e.get("catName"),o=t.get("catName");return s._basicComparator(i.toUpperCase(),o.toUpperCase(),e,t,r)}function g(e,t){return{name:e.get(t.field),isSplit:e.has("parentOpId"),editable:c.isFunction(t.editor),computable:e.get("computable"),tags:e.get("tags")}}var h=s.DatagridColumn,p=e.extend({template:i,ui:{datagrid:".sf-ok-to-spend-upcoming-tx-content-placeholder"},initialize:function(){this._super.apply(this,arguments),this.categoriesService=n.getInstance(),this.scheduledTransactions=arguments[0].scheduledTransactions,this.transactionsService=r.getInstance(),this._setupColumnsConfig()},render:function(e){e===!0?this._super():typeof e=="undefined"&&(c.mask(this.$el,c.MASK_LOADING),c.when(this.categoriesService.get()).done(c.bind(this._dataReceived,this)).fail(c.bind(this._dataError,this)))},_dataReceived:function(e){c.unmask(this.$el),this.categories=e,this.categories.on("change",this.render,this),this.render(!0)},_dataError:function(e){c.unmask(this.$el),console.error("[PlanningPreview] Error loading Categories Data ",e),this.publish("error",e)},_setupColumnsConfig:function(){var e=[];for(var t=0;t<this.config.gridConfig.columnDefs.length;t++){var n=this.config.gridConfig.columnDefs[t];n=c.extend({parent:this},n),n.labelKey!==undefined&&(n.label=c.i18n.get(n.labelKey)),e.push(new h(n))}this.config.gridConfig.columns=e},onShow:function(){var e=this;this.config.gridConfig.filterFunction=this._getFilterFunction();var n=c.extend({},this.contextConfig,{config:this.config.gridConfig,container:this.ui.datagrid});this.datagrid=new s(n),this.datagrid.render(),c.map(this.scheduledTransactions,function(t){var n=e.categories,r=c.filter(n.models,function(e){var n=t.catId;return t.parentCatId&&(n=t.parentCatId),e.get("catId")==n});return r[0]?t.catHexrgbcolor=r[0].get("catHexrgbcolor"):t.catHexrgbcolor="c5c5c5",t}),this.transactionsList=new t(this.scheduledTransactions),this.datagrid.renderElements(this.transactionsList)},_getFilterFunction:function(){return this.transactionsService._getFilterFunction(this._getFilters())},_getFilters:function(){return c.merge({},this.filters,{computable:this.config.showExcluded?null:!0})}},{ID:"ok-to-spend-upcoming-tx-view",defaults:{showExcluded:!0,gridConfig:{emptyMessageKey:"transactions-datagrid.emptyMessage",visibleRows:15,sortField:"date",sortDirection:"DESC",isTagsActive:!1,columnDefs:[{field:"date",headerClass:"sf-date-header",columnClass:"sf-date-col",labelKey:"ok-to-spend-details.web.datagrid.date",formatter:function(e){return c.date.format(e.get("postedDateStr"),"dd/MM/yyyy")},sortable:!0},{field:"amount",headerClass:"sf-amount-header sf-numeric",columnClass:"sf-numeric sf-amount-col",labelKey:"ok-to-spend-details.web.datagrid.amount",formatter:function(e){var t=e.toJSON();return t.isPositive=t.amount>=0,f(t)},sortable:!0},{field:"name",headerClass:"sf-desc-header",columnClass:"sf-desc-col",labelKey:"ok-to-spend-details.web.datagrid.desc",formatter:o,serializeData:d,sortable:!0,comparator:"string"},{field:"accName",headerClass:"sf-acc-header",columnClass:"sf-acc-col",labelKey:"ok-to-spend-details.web.datagrid.account",sortable:!0,comparator:"string"},{field:"catId",headerClass:"sf-cat-header",columnClass:"sf-cat-col",labelKey:"ok-to-spend-details.web.datagrid.category",formatter:u,serializeData:v,sortable:!0,comparator:m}]}}});return p._descSerializer=d,p._categoryDataSerializer=v,p._categoryComparator=m,p._tagsSerializer=g,p}),define("hbs!modules/ok-to-spend-details/templates/ok-to-spend-real-tx",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-ok-to-spend-real-tx-content-placeholder"></div>'});return t.registerPartial("modules_ok-to-spend-details_templates_ok-to-spend-real-tx",n),n}),define("modules/ok-to-spend-details/views/ok-to-spend-real-tx-view",["classes/layout","classes/collection","services/categories-service","services/transactions-service","hbs!modules/ok-to-spend-details/templates/ok-to-spend-real-tx","ui/modules/datagrid/v-datagrid-module","hbs!modules/transactions-datagrid/templates/formatters/description","hbs!modules/transactions-datagrid/templates/formatters/category","hbs!modules/transactions-datagrid/templates/formatters/date","hbs!modules/transactions-datagrid/templates/formatters/amount","hbs!modules/transactions-datagrid/templates/formatters/tags","utils/mask","utils/amount","utils/date","utils/tooltip"],function(e,t,n,r,i,s,o,u,a,f,l,c){function d(e,t){return{name:e.get(t.field),isSplit:e.has("parentOpId"),editable:c.isFunction(t.editor),computable:e.get("computable")}}function v(e,t,n){return e.get("parentCatId")!==undefined?{hasParent:!0,parentName:e.get("parentCatName"),parentCatId:e.get("parentCatId"),catName:e.get("catName"),color:e.get("catHexrgbcolor")}:{hasParent:!1,catName:e.get("catName"),catId:e.get("catId"),color:e.get("catHexrgbcolor")}}function m(e,t,n,r){var i=e.get("catName"),o=t.get("catName");return s._basicComparator(i.toUpperCase(),o.toUpperCase(),e,t,r)}function g(e,t){return{name:e.get(t.field),isSplit:e.has("parentOpId"),editable:c.isFunction(t.editor),computable:e.get("computable"),tags:e.get("tags")}}var h=s.DatagridColumn,p=e.extend({template:i,ui:{datagrid:".sf-ok-to-spend-real-tx-content-placeholder"},initialize:function(){this._super.apply(this,arguments),this.realTransactions=arguments[0].realTransactions,this.realTotal=arguments[0].realTotal,this.categoriesService=n.getInstance(),this.transactionsService=r.getInstance(),this._setupColumnsConfig()},render:function(e){e===!0?this._super():typeof e=="undefined"&&(c.mask(this.$el,c.MASK_LOADING),c.when(this.categoriesService.get()).done(c.bind(this._dataReceived,this)).fail(c.bind(this._dataError,this)))},_dataReceived:function(e){c.unmask(this.$el),this.categories=e,this.categories.on("change",this.render,this),this.render(!0)},_dataError:function(e){c.unmask(this.$el),console.error("[PlanningPreview] Error loading ok To Spend Month Data ",e),this.publish("error",e)},_setupColumnsConfig:function(){var e=[];for(var t=0;t<this.config.gridConfig.columnDefs.length;t++){var n=this.config.gridConfig.columnDefs[t];n=c.extend({parent:this},n),n.labelKey!==undefined&&(n.label=c.i18n.get(n.labelKey)),e.push(new h(n))}this.config.gridConfig.columns=e},onShow:function(){var e=this;this.config.gridConfig.filterFunction=this._getFilterFunction();var n=c.extend({},this.contextConfig,{config:this.config.gridConfig,container:this.ui.datagrid});this.datagrid=new s(n),this.datagrid.render(),c.map(this.realTransactions,function(t){var n=e.categories,r=c.filter(n.models,function(e){var n=t.catId;return t.parentCatId&&(n=t.parentCatId),e.get("catId")==n});return r[0]?t.catHexrgbcolor=r[0].get("catHexrgbcolor"):t.catHexrgbcolor="c5c5c5",t}),this.transactionsList=new t(this.realTransactions),this.datagrid.renderElements(this.transactionsList)},_getFilterFunction:function(){return this.transactionsService._getFilterFunction(this._getFilters())},_getFilters:function(){return c.merge({},this.filters,{computable:this.config.showExcluded?null:!0})}},{ID:"ok-to-spend-real-tx-view",defaults:{showExcluded:!0,gridConfig:{emptyMessageKey:"transactions-datagrid.emptyMessage",visibleRows:15,sortField:"date",sortDirection:"DESC",isTagsActive:!1,columnDefs:[{field:"date",headerClass:"sf-date-header",columnClass:"sf-date-col",labelKey:"ok-to-spend-details.web.datagrid.date",formatter:function(e){return c.date.format(e.get("postedDateStr"),"dd/MM/yyyy")},sortable:!0},{field:"amount",headerClass:"sf-amount-header sf-numeric",columnClass:"sf-numeric sf-amount-col",labelKey:"ok-to-spend-details.web.datagrid.amount",formatter:function(e){var t=e.toJSON();return t.isPositive=t.amount>=0,f(t)},sortable:!0},{field:"name",headerClass:"sf-desc-header",columnClass:"sf-desc-col",labelKey:"ok-to-spend-details.web.datagrid.desc",formatter:o,serializeData:d,sortable:!0,comparator:"string"},{field:"accName",headerClass:"sf-acc-header",columnClass:"sf-acc-col",labelKey:"ok-to-spend-details.web.datagrid.account",sortable:!0,comparator:"string"},{field:"catId",headerClass:"sf-cat-header",columnClass:"sf-cat-col",labelKey:"ok-to-spend-details.web.datagrid.category",formatter:u,serializeData:v,sortable:!0,comparator:m}]}}});return p._descSerializer=d,p._categoryDataSerializer=v,p._categoryComparator=m,p._tagsSerializer=g,p}),define("hbs!modules/ok-to-spend-details/templates/ok-to-spend-details",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){var r="",i;r+='\n		<div class="sf-ok-to-spend-upcoming-tx" >\n			<div class="sf-ok-to-spend-upcoming-tx-placeholder" ></div>\n			',i=n["if"].call(e,e.noUpcomingData,{hash:{},inverse:l.noop,fn:l.program(2,h,t)});if(i||i===0)r+=i;r+="\n		</div>\n		",i=n.unless.call(e,e.noUpcomingData,{hash:{},inverse:l.noop,fn:l.program(4,p,t)});if(i||i===0)r+=i;r+='\n		<div class="sf-ok-to-spend-real-tx" >\n			<div class="sf-ok-to-spend-real-tx-placeholder" >\n			</div>\n			',i=n["if"].call(e,e.noRealData,{hash:{},inverse:l.noop,fn:l.program(6,d,t)});if(i||i===0)r+=i;return r+="\n		</div>\n	",r}function h(e,t){var r="",i,s,o;return r+='\n				<div class="sf-no-data sf-no-upcoming-data">',o={hash:{type:e.type}},r+=a((i=n.t,i?i.call(e,"ok-to-spend-details.web.noUpcomingData",o):u.call(e,"t","ok-to-spend-details.web.noUpcomingData",o)))+'</div>\n				<div class="sf-hide-upcoming-tx-button-container">\n					<span class="sf-upcoming-tx-button-icon">\n						<img src="resources/pfm/ui/css/icons/app-icons/dav-white-arrow-left.svg">\n					</span>\n					<span class="sf-hide-upcoming-tx-button">',(s=n.upcomingText)?s=s.call(e,{hash:{}}):(s=e.upcomingText,s=typeof s===f?s.apply(e):s),r+=a(s)+"</span>\n				</div>\n			",r}function p(e,t){var r="",i;return r+='\n			<div class="sf-hide-upcoming-tx-button-container">\n				<span class="sf-upcoming-tx-button-icon">\n					<img src="resources/pfm/ui/css/icons/app-icons/dav-white-arrow-left.svg">\n				</span>\n				<span class="sf-hide-upcoming-tx-button">',(i=n.upcomingText)?i=i.call(e,{hash:{}}):(i=e.upcomingText,i=typeof i===f?i.apply(e):i),r+=a(i)+"</span>\n			</div>\n		",r}function d(e,t){var r="",i,s;return r+='\n				<div class="sf-no-data">',s={hash:{}},r+=a((i=n.t,i?i.call(e,"ok-to-spend-details.web.noRealData",s):u.call(e,"t","ok-to-spend-details.web.noRealData",s)))+"</div>\n			",r}function v(e,t){var r="",i,s;return r+='\n		<div class="sf-no-data">',s={hash:{}},r+=a((i=n.t,i?i.call(e,"ok-to-spend-details.noData",s):u.call(e,"t","ok-to-spend-details.noData",s)))+"</div>\n	",r}this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u=n.helperMissing,a=this.escapeExpression,f="function",l=this;s+='<div class="sf-ok-to-spend-details">\n	',o=n["if"].call(t,t.availableData,{hash:{},inverse:l.program(8,v,i),fn:l.program(1,c,i)});if(o||o===0)s+=o;return s+="\n</div>",s});return t.registerPartial("modules_ok-to-spend-details_templates_ok-to-spend-details",n),n}),define("libs/require/css/css!modules/ok-to-spend-details/css/ok-to-spend-details",[],function(){}),define("modules/ok-to-spend-details/ok-to-spend-details-module",["classes/layout","modules/ok-to-spend-details/views/ok-to-spend-upcoming-tx-view","modules/ok-to-spend-details/views/ok-to-spend-real-tx-view","services/ok-to-spend-service","hbs!modules/ok-to-spend-details/templates/ok-to-spend-details","utils/mask","utils/amount","utils/tooltip","css!modules/ok-to-spend-details/css/ok-to-spend-details"],function(e,t,n,r,i,s){var o=e.extend({template:i,ui:{$hideUpcomingTxButton:".sf-hide-upcoming-tx-button-container",$upcomingTxMessage:".sf-upcoming-tx-message-container",$noUpcomingDataMessage:".sf-no-upcoming-data"},filtersList:["activeMonth"],events:{"click .sf-upcoming-tx-message-container":"showUpcomingTransactions"},regions:{upcomingTransactionsRegion:".sf-ok-to-spend-upcoming-tx-placeholder",realTransactionsRegion:".sf-ok-to-spend-real-tx-placeholder"},initialize:function(){this._super.apply(this,arguments),this.okToSpendService=r.getInstance(),this.id=arguments[0].id,this.upcomingText=this.options.upcomingText},render:function(e){e===!0?this._super():typeof e=="undefined"&&(s.mask(this.$el,s.MASK_LOADING),s.when(this.okToSpendService.getActiveMonth(this.filters.activeMonth)).done(s.bind(this._dataReceived,this)).fail(s.bind(this._dataError,this)))},_dataReceived:function(e){s.unmask(this.$el),this.okToSpendMonthData=e,this.okToSpendMonthData.on("change",this.render,this),this.render(!0)},_dataError:function(e){s.unmask(this.$el),console.error("[PlanningPreview] Error loading ok To Spend Month Data ",e),this.publish("error",e)},onRender:function(){var e=this;this.noUpcomingData||(this.upcomingTransactionsRegion.show(new t(s.merge({},e.contextConfig,{scheduledTransactions:e.scheduledTransactions}))),this.upcomingTransactionsRegion.$el.hide()),this.noRealData||this.realTransactionsRegion.show(new n(s.merge({},e.contextConfig,{realTransactions:e.realTransactions,realTotal:e.realTotal})))},_nextRemainingDays:function(){var e=this.scheduledTransactions[0];if(this.scheduledTransactions.length===0)return"";if(e.postedDate.substring(0,7)!==s.date.format(s.date.today(),"yyyy-mm-dd"))return"";var t=e.postedDate.split("-")[2]-s.date.today().getDate();return s.i18n.get("ok-to-spend-details.upcomingTransactionsMessage.part3",{numberDays:t})},_formatUpcomingTransactionsMessage:function(e,t){var n=(e>0?"+ ":"")+s.amount.format(e);return{part1:s.i18n.get("ok-to-spend-details.upcomingTransactionsMessage.part1",{numberTx:t}),part2:s.i18n.get("ok-to-spend-details.upcomingTransactionsMessage.part2"),part3:this._nextRemainingDays(),part4:n>0?s.i18n.get("ok-to-spend-details.upcomingTransactionsMessage.part4",{expectedAmount:n}):""}},serializeData:function(){var e=this.okToSpendMonthData.data,t,n=function(e){var t=Array.prototype.slice.call(arguments,1);return function(r,i){var s=r[e]-i[e];return e=="postedDate"&&(s=r[e]>i[e]),s===0&&arguments.length>1?n.apply(null,t)(r,i):s}};this.id==="expenses"?(this.realTotal=e.expenses.real.total,this.realTransactions=e.expenses.real.transactions,this.scheduledTransactions=e.expenses.scheduled.transactions,t=e.expenses.scheduled.total):(this.realTotal=e.income.real.total,this.realTransactions=e.income.real.transactions,this.scheduledTransactions=e.income.scheduled.transactions,t=e.income.scheduled.total),this.scheduledTransactions=this.scheduledTransactions.sort(n("postedDate")),this.realTransactions=this.realTransactions.sort(n("parentCatId","postedDate")),this.availableData=this.realTransactions.length>0||this.scheduledTransactions.length>0,this.noUpcomingData=this.scheduledTransactions.length===0,this.noRealData=this.realTransactions.length===0;var r=this.scheduledTransactions.length,i={availableData:this.availableData,noUpcomingData:this.noUpcomingData,noRealData:this.noRealData,upcomingText:this.upcomingText,type:this.id==="expenses"?"gastos":"ingresos"};if(!this.noUpcomingData){var s=this._formatUpcomingTransactionsMessage(t,r);i.upcomingMsgPart1=s.part1,i.upcomingMsgPart2=s.part2,i.upcomingMsgPart3=s.part3,i.upcomingMsgPart4=s.part4}return i},_filtersChanged:function(){this.render()},showUpcomingTransactions:function(){if(this.noUpcomingData)return;this.ui.$upcomingTxMessage.addClass("sf-hidden"),this.ui.$hideUpcomingTxButton.removeClass("sf-hidden"),this.noUpcomingData?this.ui.$noUpcomingDataMessage.show():this.upcomingTransactionsRegion.$el.show()}},{ID:"ok-to-spend-details",defaults:{}});return o}),define("hbs!modules/ok-to-spend-disposable/templates/ok-to-spend-disposable",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u="function",a=this.escapeExpression;s+='<div class="sf-ok-to-spend-disposable">\n\n	<div class="sf-ok-to-spend-disposable-amount">\n		<span class="sf-ok-to-spend-disposable-amount-value">',(o=n.disposableAmount)?o=o.call(t,{hash:{}}):(o=t.disposableAmount,o=typeof o===u?o.apply(t):o);if(o||o===0)s+=o;return s+='</span>\n	</div>\n	<div class="sf-ok-to-spend-disposable-message-container">\n		<div class="sf-ok-to-spend-disposable-message">',(o=n.disposableMessage)?o=o.call(t,{hash:{}}):(o=t.disposableMessage,o=typeof o===u?o.apply(t):o),s+=a(o)+"</div>\n	</div>\n</div>",s});return t.registerPartial("modules_ok-to-spend-disposable_templates_ok-to-spend-disposable",n),n}),define("libs/require/css/css!modules/ok-to-spend-disposable/css/ok-to-spend-disposable",[],function(){}),define("modules/ok-to-spend-disposable/ok-to-spend-disposable-module",["classes/item-view","services/ok-to-spend-service","hbs!modules/ok-to-spend-disposable/templates/ok-to-spend-disposable","utils/mask","utils/amount","utils/tooltip","css!modules/ok-to-spend-disposable/css/ok-to-spend-disposable"],function(e,t,n,r){var i=e.extend({template:n,filtersList:["activeMonth"],initialize:function(){this._super.apply(this,arguments),this.okToSpendService=t.getInstance()},render:function(e){e===!0?this._super():typeof e=="undefined"&&(r.mask(this.$el,r.MASK_LOADING),r.when(this.okToSpendService.getActiveMonth(this.filters.activeMonth)).done(r.bind(this._dataReceived,this)).fail(r.bind(this._dataError,this)))},_dataReceived:function(e){r.unmask(this.$el),this.okToSpendMonthData=e,this.okToSpendMonthData.on("change",this.render,this),this.render(!0)},_dataError:function(e){r.unmask(this.$el),console.error("[PlanningPreview] Error loading ok To Spend Month Data ",e),this.publish("error",e)},_filtersChanged:function(){this.render()},serializeData:function(){var e=this.okToSpendMonthData.data;return{disposableAmount:r.amount.format(e.disposable.disposableExcludingSavingsGoals),disposableMessage:r.i18n.get("ok-to-spend-disposable.message")}}},{ID:"ok-to-spend-disposable",defaults:{}});return i}),define("widgets/ok-to-spend/views/ok-to-spend-content-view",["classes/layout","services/ok-to-spend-service","modules/ok-to-spend-month-graph/ok-to-spend-month-graph-module","ui/modules/tabs/tabs-module","hbs!widgets/ok-to-spend/templates/ok-to-spend-content","utils/util","modules/ok-to-spend-details/ok-to-spend-details-module","modules/ok-to-spend-disposable/ok-to-spend-disposable-module"],function(e,t,n,r,i,s,o,u){var a=e.extend({template:i,filtersList:["activeMonth"],regions:{monthBarRegion:".sf-ok-to-spend-month-bar-placeholder",tabsRegion:".sf-ok-to-spend-tabs-placeholder"},initialize:function(){this._super.apply(this,arguments),this.okToSpendService=t.getInstance()},render:function(e){if(e===!0){this._super();return}s.mask(this.$el,s.MASK_LOADING),s.when(this.okToSpendService.getActiveMonth(this.filters.activeMonth)).done(s.bind(this._dataReceived,this)).fail(s.bind(this._dataError,this))},_dataReceived:function(e){s.unmask(this.$el),this.okToSpendMonthData=e,this.okToSpendMonthData.on("change",this.render,this),this.render(!0)},_dataError:function(e){s.unmask(this.$el),console.error("[OkToSpendContentView] Error loading Ok to Spend Data ",e),this.publish("error",e)},onRender:function(){var e=this,t=this.okToSpendMonthData.data,i=s.i18n.get("ok-to-spend.tabs.income.title"),a=" + "+s.amount.format(Math.abs(t.income.total)),f=s.i18n.get("ok-to-spend.tabs.expenses.title"),l=" - "+s.amount.format(Math.abs(t.expenses.total)),c=s.i18n.get("ok-to-spend.tabs.disposable.title"),h=s.amount.format(t.disposable.disposableExcludingSavingsGoals);this.monthBarRegion.show(new n(s.merge(e.contextConfig)));var p=[],d=new o(s.merge({},e.contextConfig,{id:"income"})),v=new o(s.merge({},e.contextConfig,{id:"expenses"}));p.push({id:"income",title:i,subTitle:a,content:d},{id:"expenses",title:f,subTitle:l,content:v},{id:"disposable",title:c,subTitle:h,content:new u(e.contextConfig)});var m=new r(s.merge({},e.contextConfig,{tabsModules:p}));this.tabsRegion.show(m)},serializeData:function(){return{dataAvailable:this.okToSpendMonthData.data!==null}},_filtersChanged:function(){this.render()}},{ID:"ok-to-spend-content-view"});return a}),define("widgets/ok-to-spend/views/ok-to-spend-content-view-extension",["widgets/ok-to-spend/views/ok-to-spend-content-view","ui/modules/tabs/tabs-module-extension","utils/util","modules/ok-to-spend-details/ok-to-spend-details-module","modules/ok-to-spend-disposable/ok-to-spend-disposable-module","jQuery"],function(e,t,n,r,i,s){var o=e.extend({events:{"click .sf-mode-filter .sf-button":"_switchTab","click .sf-popup-close":"_backToFincal"},_backToFincal:function(e){this.publish("show:widget",{widget:"financial-calendar"})},_switchTab:function(e){var t,n="expenses";e.target.className==="sf-button-text"?t=this.$(e.target.parentNode):t=this.$(e.target),t.hasClass("sf-button-income")&&(n="income"),t.closest(".sf-mode-filter").find(".sf-button").removeClass("sf-active"),t.addClass("sf-active"),this.publish("setActiveTab",n)},onRender:function(){var e=this,s=this.okToSpendMonthData.data,o=n.i18n.get("ok-to-spend.web.tabs.income.title"),u=n.amount.format(Math.abs(s.income.total)),a=n.i18n.get("ok-to-spend.web.tabs.expenses.title"),f=n.amount.format(Math.abs(s.expenses.total)),l=n.i18n.get("ok-to-spend.web.tabs.disposable.title"),c=n.amount.format(s.disposable.disposableExcludingSavingsGoals),h=s.disposable.disposableExcludingSavingsGoals<0,p=n.i18n.get("ok-to-spend.web.futureIncomes"),d=n.i18n.get("ok-to-spend.web.futureExpenses"),v=[],m=new r(n.merge({},e.contextConfig,{id:"income",upcomingText:p})),g=new r(n.merge({},e.contextConfig,{id:"expenses",upcomingText:d}));v.push({id:"income",title:o,subTitle:u,content:m},{id:"expenses",title:a,subTitle:f,content:g},{id:"disposable",title:l,subTitle:c,negative:h,content:new i(e.contextConfig)});var y=new t(n.merge({},e.contextConfig,{tabsModules:v}));y.tabClicked=function(){},this.tabsRegion.show(y),this.publish("setActiveTab","expenses")}},{});return o}),define("libs/require/css/css!widgets/ok-to-spend/css/ok-to-spend",[],function(){}),define("widgets/ok-to-spend/ok-to-spend-widget",["classes/ui/widget/widget","widgets/ok-to-spend/views/ok-to-spend-header-view","widgets/ok-to-spend/views/ok-to-spend-content-view","modules/ok-to-spend-summary/ok-to-spend-summary-module","modules/ok-to-spend-month-graph/ok-to-spend-month-graph-module","modules/ok-to-spend-disposable/ok-to-spend-disposable-module","ui/modules/tabs/tabs-module","modules/ok-to-spend-details/ok-to-spend-details-module","services/ok-to-spend-service","utils/mask","css!widgets/ok-to-spend/css/ok-to-spend"],function(e,t,n,r,i,s,o,u,a,f){var l=e.extend({filtersList:["activeMonth"],initialize:function(){this._super.apply(this,arguments);var e=f.date.constructor.MONTH,t=f.date.truncate(e,f.date.today());this.publish("filters:change",{filter:"activeMonth",data:f.date.formatBackendDate(t)})},onRender:function(){this._super();var e=this;this.contentRegion.on("show",function(){f.unmask(e.$el)}),f.mask(this.$el,f.MASK_LOADING),this.headerRegion.show(new t(this.contextConfig)),this.contentRegion.show(new n(this.contextConfig))}},{ID:"ok-to-spend",submodules:[r,i,o,u,s],services:[a],defaults:{initialRange:3}});return l}),define("hbs!widgets/ok-to-spend-overview/templates/ok-to-spend-overview-content",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-ok-to-spend-overview-content sf-widget-content">\n	<div class="sf-ok-to-spend-summary-placeholder">\n	</div>\n</div>'});return t.registerPartial("widgets_ok-to-spend-overview_templates_ok-to-spend-overview-content",n),n}),define("libs/require/css/css!widgets/ok-to-spend-overview/css/ok-to-spend-overview",[],function(){}),define("widgets/ok-to-spend-overview/views/ok-to-spend-overview-content-view",["classes/layout","modules/ok-to-spend-summary/ok-to-spend-summary-module","utils/util","hbs!widgets/ok-to-spend-overview/templates/ok-to-spend-overview-content","css!widgets/ok-to-spend-overview/css/ok-to-spend-overview","utils/percentage"],function(e,t,n,r){var i=e.extend({template:r,regions:{summaryRegion:".sf-ok-to-spend-summary-placeholder"},initialize:function(){this._super.apply(this,arguments)},onRender:function(){this.summaryRegion.show(new t(n.merge(this.contextConfig)))}});return i}),define("widgets/ok-to-spend-overview/ok-to-spend-overview-widget",["classes/ui/widget/widget","widgets/ok-to-spend-overview/views/ok-to-spend-overview-content-view","modules/ok-to-spend-summary/ok-to-spend-summary-module","services/ok-to-spend-service","services/dashboard-service","utils/util","utils/mask"],function(e,t,n,r,i,s){var o=e.extend({filtersList:["activeMonth"],initialize:function(){this._super.apply(this,arguments);var e=s.date.constructor.MONTH,t=s.date.truncate(e,s.date.today());this.publish("filters:change",{filter:"activeMonth",data:s.date.formatBackendDate(t)})},onRender:function(){this._super();var e=this;s.mask(this.$el,s.MASK_LOADING),this.contentRegion.on("show",function(){s.unmask(e.$el)}),this.contentRegion.show(new t(this.contextConfig))}},{ID:"ok-to-spend-overview",submodules:[n],services:[r,i],defaults:{useDashboardEndpoint:!1}});return o}),define("hbs!widgets/transactions-pdf/templates/transactions-pdf-header",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-davivienda-header">\n	<div class="wrap">\n		<h1>Davivienda</h1>\n	</div>\n</div>'});return t.registerPartial("widgets_transactions-pdf_templates_transactions-pdf-header",n),n}),define("widgets/transactions-pdf/views/transactions-pdf-header-view",["classes/layout","hbs!widgets/transactions-pdf/templates/transactions-pdf-header"],function(e,t){var n=e.extend({template:t});return n}),define("hbs!widgets/transactions-pdf/templates/transactions-pdf-content",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="sf-transactions-pdf-content sf-widget-content">\n	<div class="sf-tx-datagrid-placeholder">\n\n	</div>\n	<div class="sf-transactions-disclaimer">\n		',u={hash:{}},s+=f((o=n.t,o?o.call(t,"details.disclaimer",u):a.call(t,"t","details.disclaimer",u)))+"\n	</div>\n</div>\n",s});return t.registerPartial("widgets_transactions-pdf_templates_transactions-pdf-content",n),n}),define("widgets/transactions-pdf/views/transactions-pdf-content-view",["classes/layout","modules/transactions-datagrid/transactions-datagrid-module","utils/util","hbs!widgets/transactions-pdf/templates/transactions-pdf-content","jQuery"],function(e,t,n,r,i){var s=e.extend({template:r,regions:{transactionsDatagridRegion:".sf-tx-datagrid-placeholder"},initialize:function(){this._super.apply(this,arguments)},onRender:function(){this._super(),this.filters=this.config.filters;var e=new t(this.contextConfig);this.transactionsDatagridRegion.show(e)},applyPdfFilters:function(){this.config.filters.accounts&&this.publish("filters:change",{filter:"accounts",data:{selected:this.config.filters.accounts.selected}}),this.config.filters.freeText&&this.publish("extraFilters:change",{filter:"extraFilters:change",data:{freeText:this.config.filters.freeText}})}});return s}),define("hbs!widgets/transactions-pdf/templates/transactions-pdf-footer",["hbs","Handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[2,">= 1.0.0-rc.3"],n=n||e.helpers,'<div class="sf-davivienda-footer">\n\n	<div class="wrap">\n		<div class="legales">\n			<img src="resources/pfm/ui/css/icons/logos/vigilado.png" alt="Vigilado, Superintendecia Financiera de Colombia">\n\n			<p>Banco Davivienda S.A. todos los derechos reservados 2015.</p>\n		</div>\n\n		<img class="sf-footer-dav-image" src="resources/pfm/ui/css/icons/logos/logo-davivienda-footer.png" alt="Vigilado, Superintendecia Financiera de Colombia">\n	</div>\n</div>'});return t.registerPartial("widgets_transactions-pdf_templates_transactions-pdf-footer",n),n}),define("widgets/transactions-pdf/views/transactions-pdf-footer-view",["classes/item-view","hbs!widgets/transactions-pdf/templates/transactions-pdf-footer","utils/util"],function(e,t,n){var r=e.extend({template:t});return r}),define("libs/require/css/css!widgets/transactions-pdf/css/transactions-pdf",[],function(){}),define("widgets/transactions-pdf/transactions-pdf-widget",["classes/ui/widget/widget","widgets/transactions-pdf/views/transactions-pdf-header-view","widgets/transactions-pdf/views/transactions-pdf-content-view","widgets/transactions-pdf/views/transactions-pdf-footer-view","modules/transactions-datagrid/transactions-datagrid-module","services/transactions-service","services/categories-service","services/accounts-service","utils/util","utils/mask","css!widgets/transactions-pdf/css/transactions-pdf"],function(e,t,n,r,i,s,o,u,a){var f=e.extend({initialize:function(){this.accountsService=u.getInstance(),this._setupDatesRangeFilter()},onRender:function(){var e=this;this._setupAccountsFilter(this.accountsService,function(){e._renderRegions()})},_renderRegions:function(){var e=this;a.mask(this.$el,a.MASK_LOADING),this.config.pdfConfig&&this.setPdfFiltersConfig(),this.headerRegion.show(new t(this.contextConfig)),this.contentRegion.on("show",function(){a.unmask(e.$el)}),this.contentRegion.show(new n(this.contextConfig)),this.footerRegion.show(new r(this.contextConfig))},setPdfFiltersConfig:function(){var e=JSON.parse(this.config.pdfConfig);this.config.filters||(this.config.filters={}),e.accounts&&(this.config.filters.accounts=e.accounts),e.datesRange&&(this.config.filters.datesRange={fromDate:new Date(e.datesRange.fromDate),toDate:new Date(e.datesRange.toDate)}),e.freeText&&(this.config.filters.freeText=e.freeText),e.fullColumnGrid!==undefined&&(this.config.fullColumnGrid=e.fullColumnGrid)}},{ID:"transactions-pdf",submodules:[i],services:[u,s,o],defaults:{initialRangeMonths:1}});return f}),define("utils/ajax-config",["jQuery","utils/util","utils/session"],function(e,t){return e.ajaxSetup({traditional:!0,dataFilter:function(e,t){if(t!=="json"||!e)return e;try{var n=JSON.parse(e);return n.result!==undefined?JSON.stringify(n.result):e}catch(r){return e}},error:function(e){e.status=="403"&&t.session.publishSessionError("session:expired")}}),e}),define("libs/require/css/css!resources/pfm/ui/css/strands-core",[],function(){}),define("pfm/pfm",["integration/integration","utils/util","widgets/alerts/alerts-widget","widgets/details/details-widget","widgets/analysis/analysis-widget","widgets/budget/budget-widget","widgets/financial-calendar/financial-calendar-widget","widgets/balance/balance-widget","widgets/networth/networth-widget","widgets/ok-to-spend/ok-to-spend-widget","widgets/ok-to-spend-overview/ok-to-spend-overview-widget","widgets/transactions-pdf/transactions-pdf-widget","modules/balance-header/balance-header-module","ui/modules/navbar/navbar-module","Handlebars","utils/ajax-config","css!resources/pfm/ui/css/strands-core"],function(e,t){return e.version="0.2.26-SNAPSHOT",e.dependencies={"pfm-ui":"git+ssh://git@stash.strands.com:7999/pfm/pfm-ui.git#v6.10.0"},e.config=t.extend({},e.config,{environment:{contextPath:"/pfm-web"}}),e.config.projectId="dav",e.config.widgets={alerts:{name:"Alerts",id:"alerts",item:"alerts",type:"widget",placeholder:"#sf-alerts-placeholder",widget:"alerts",path:"widgets/alerts/alerts",itemPath:"widgets/alerts/alerts-widget"},details:{name:"Details",id:"details",item:"details",type:"widget",placeholder:"#sf-details-placeholder",widget:"details",path:"widgets/details/details",itemPath:"widgets/details/details-widget"},analysis:{name:"Analysis",id:"analysis",item:"analysis",type:"widget",placeholder:"#sf-analysis-placeholder",widget:"analysis",path:"widgets/analysis/analysis",itemPath:"widgets/analysis/analysis-widget"},budget:{name:"Budget",id:"budget",item:"budget",type:"widget",placeholder:"#sf-budget-placeholder",widget:"budget",path:"widgets/budget/budget",itemPath:"widgets/budget/budget-widget"},"financial-calendar":{name:"Financial Calendar",id:"financial-calendar",item:"financial-calendar",type:"widget",placeholder:"#sf-financial-calendar-placeholder",widget:"financial-calendar",path:"widgets/financial-calendar/financial-calendar",itemPath:"widgets/financial-calendar/financial-calendar-widget"},balance:{name:"Balance",id:"balance",item:"balance",type:"widget",placeholder:"#sf-balance-placeholder",widget:"balance",path:"widgets/balance/balance",itemPath:"widgets/balance/balance-widget"},networth:{name:"Networth",id:"networth",item:"networth",type:"widget",placeholder:"#sf-networth-placeholder",widget:"networth",path:"widgets/networth/networth",itemPath:"widgets/networth/networth-widget"},"ok-to-spend":{name:"Ok to Spend",id:"ok-to-spend",item:"ok-to-spend",type:"widget",placeholder:"#sf-ok-to-spend-placeholder",widget:"ok-to-spend",path:"widgets/ok-to-spend/ok-to-spend",itemPath:"widgets/ok-to-spend/ok-to-spend-widget"},"ok-to-spend-overview":{name:"Ok to Spend Overview",overview:!0,id:"ok-to-spend-overview",item:"ok-to-spend-overview",type:"widget",placeholder:"#sf-ok-to-spend-overview-placeholder",widget:"ok-to-spend-overview",path:"widgets/ok-to-spend-overview/ok-to-spend-overview",itemPath:"widgets/ok-to-spend-overview/ok-to-spend-overview-widget"},"transactions-pdf":{name:"Transactions PDF",id:"transactions-pdf",item:"transactions-pdf",type:"widget",placeholder:"#sf-transactions-pdf-placeholder",widget:"transactions-pdf",path:"widgets/transactions-pdf/transactions-pdf",itemPath:"widgets/transactions-pdf/transactions-pdf-widget"}},e.config.modules={"balance-header":{id:"balance-header",name:"balance-header",item:"balance-header",type:"module",placeholder:"#sf-balance-header-placeholder",module:"balance-header",path:"modules/balance-header/balance-header",itemPath:"modules/balance-header/balance-header-module"}},e.config.uiModules={navbar:{id:"navbar",name:"navbar",item:"navbar",type:"ui-module",placeholder:"#sf-navbar-placeholder",module:"navbar",path:"ui/modules/navbar/navbar",itemPath:"ui/modules/navbar/navbar-module"}},e.config.reports={"transactions-pdf":{items:["transactions-pdf"],id:"transactions-pdf",name:"transactions-pdf",item:"transactions-pdf",type:"report",placeholder:"#sf-transactions-pdf-placeholder",report:"transactions-pdf"}},e.config.tabs={analysis:{items:["analysis"]},details:{items:["details"]},budget:{items:["budget"]},balance:{items:["balance"]},calendar:{items:["financial-calendar"]},"ok-to-spend":{items:["ok-to-spend"]},networth:{items:["networth"]}},window.pfm=e,e}),require(["pfm/pfm"],function(){}),define("pfm/pfm-loader",function(){});